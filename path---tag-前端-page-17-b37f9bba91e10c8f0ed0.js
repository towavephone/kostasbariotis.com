webpackJsonp([0x74c800cdd545],{1345:function(n,a){n.exports={data:{site:{siteMetadata:{title:"女王控的博客",description:'前端工程师，黑猫女王控，欢迎勾搭，技术相关<a href="https://github.com/towavephone" target="_blank">@towavephone</a>，QQ闲聊<a href="tencent://AddContact/?fromId=45&fromSubId=1&subcmd=all&uin=634407147&website=www.oicqzone.com">@towave</a>，bili关注<a href="https://space.bilibili.com/11507708#/" target="_blank">@towave</a>',siteUrl:"https://blog.towavephone.com"}}},pathContext:{posts:[{excerpt:"React 生命周期很多人都了解，但通常我们所了解的都是  单个组件  的生命周期，但针对  Hooks 组件、多个关联组件 （父子组件和兄弟组件） 的生命周期又是怎么样的喃？你有思考和了解过吗，接下来我们将完整的了解 React 生命周期。 关于  组件  ，我们这里指的是   以及   ，但是否包括 Hooks 组件呢？ Hooks 组件 函数组件  的本质是函数，没有 state 的概念的，因此 不存在生命周期 一说，仅仅是一个  render 函数 而已。 但是引入  Hooks…",html:'<p>React 生命周期很多人都了解，但通常我们所了解的都是 <strong>单个组件</strong> 的生命周期，但针对 <strong>Hooks 组件、多个关联组件</strong>（父子组件和兄弟组件） 的生命周期又是怎么样的喃？你有思考和了解过吗，接下来我们将完整的了解 React 生命周期。</p>\n<p>关于 <strong>组件</strong> ，我们这里指的是 <code class="language-text">React.Component</code> 以及 <code class="language-text">React.PureComponent</code> ，但是否包括 Hooks 组件呢？</p>\n<h1 id="hooks-组件"><a href="#hooks-%E7%BB%84%E4%BB%B6" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Hooks 组件</h1>\n<p><strong>函数组件</strong> 的本质是函数，没有 state 的概念的，因此<strong>不存在生命周期</strong>一说，仅仅是一个 <strong>render 函数</strong>而已。</p>\n<p>但是引入 <strong>Hooks</strong> 之后就变得不同了，它能让组件在不使用 class 的情况下使用 state 以及其他的 React 特性，相比与 class 的生命周期概念来说，它更接近于实现状态同步，而不是响应生命周期事件。但我们可以利用 <code class="language-text">useState</code>、 <code class="language-text">useEffect()</code> 和 <code class="language-text">useLayoutEffect()</code> 来模拟实现生命周期。</p>\n<p>即：<strong>Hooks 组件更接近于实现状态同步，而不是响应生命周期事件</strong>。</p>\n<p>下面，是具体的 生命周期 与 Hooks 的<strong>对应关系</strong>：</p>\n<ul>\n<li>\n<p><code class="language-text">constructor</code>：函数组件不需要构造函数，我们可以通过调用 <strong><code class="language-text">useState</code> 来初始化 state</strong>。如果计算的代价比较昂贵，也可以传一个函数给 <code class="language-text">useState</code>。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="76998927352201630000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`const [num, UpdateNum] = useState(0);`, `76998927352201630000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                js 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">const</span> <span class="token punctuation">[</span>num<span class="token punctuation">,</span> UpdateNum<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n</li>\n<li>\n<p><code class="language-text">getDerivedStateFromProps</code>：一般情况下，我们不需要使用它，我们可以在<strong>渲染过程中更新 state</strong>，以达到实现 <code class="language-text">getDerivedStateFromProps</code> 的目的。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="53055553390095580000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`function ScrollView({ row }) {\nlet [isScrollingDown, setIsScrollingDown] = useState(false);\nlet [prevRow, setPrevRow] = useState(null);\n\nif (row !== prevRow) {\n  // Row 自上次渲染以来发生过改变。更新 isScrollingDown。\n  setIsScrollingDown(prevRow !== null && row > prevRow);\n  setPrevRow(row);\n}\n\nreturn \\`Scrolling down: \\${isScrollingDown}\\`;\n}`, `53055553390095580000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                js 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">function</span> <span class="token function">ScrollView</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> row <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n<span class="token keyword">let</span> <span class="token punctuation">[</span>isScrollingDown<span class="token punctuation">,</span> setIsScrollingDown<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">let</span> <span class="token punctuation">[</span>prevRow<span class="token punctuation">,</span> setPrevRow<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token keyword">if</span> <span class="token punctuation">(</span>row <span class="token operator">!==</span> prevRow<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token comment">// Row 自上次渲染以来发生过改变。更新 isScrollingDown。</span>\n  <span class="token function">setIsScrollingDown</span><span class="token punctuation">(</span>prevRow <span class="token operator">!==</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> row <span class="token operator">></span> prevRow<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token function">setPrevRow</span><span class="token punctuation">(</span>row<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Scrolling down: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>isScrollingDown<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>React 会立即退出第一次渲染并用更新后的 state 重新运行组件以避免耗费太多性能。</p>\n</li>\n<li>\n<p><code class="language-text">shouldComponentUpdate</code>：可以用 <strong><code class="language-text">React.memo</code></strong> 包裹一个组件来对它的 <code class="language-text">props</code> 进行浅比较</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="70014299857322590000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`const Button = React.memo((props) => {\n// 具体的组件\n});`, `70014299857322590000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                js 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">const</span> Button <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">memo</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n<span class="token comment">// 具体的组件</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>注意：<strong><code class="language-text">React.memo</code> 等效于 <code class="language-text">PureComponent</code></strong>，它只浅比较 props。这里也可以使用 <code class="language-text">useMemo</code> 优化每一个节点。</p>\n</li>\n<li>\n<p><code class="language-text">render</code>：这是函数组件体本身。</p>\n</li>\n<li>\n<p><code class="language-text">componentDidMount</code>, <code class="language-text">componentDidUpdate</code>： <code class="language-text">useLayoutEffect</code> 与它们两的调用阶段是一样的。但是，我们推荐你<strong>一开始先用 useEffect</strong>，只有当它出问题的时候再尝试使用 <code class="language-text">useLayoutEffect</code>。<code class="language-text">useEffect</code> 可以表达所有这些的组合。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="87816557337105370000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// componentDidMount\nuseEffect(() => {\n// 需要在 componentDidMount 执行的内容\n}, []);\n\nuseEffect(() => {\n// 在 componentDidMount，以及 count 更改时 componentDidUpdate 执行的内容\ndocument.title = \\`You clicked \\${count} times\\`;\nreturn () => {\n  // 需要在 count 更改时 componentDidUpdate（先于 document.title = ... 执行，遵守先清理后更新）\n  // 以及 componentWillUnmount 执行的内容\n}; // 当函数中 Cleanup 函数会按照在代码中定义的顺序先后执行，与函数本身的特性无关\n}, [count]); // 仅在 count 更改时更新`, `87816557337105370000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                js 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// componentDidMount</span>\n<span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n<span class="token comment">// 需要在 componentDidMount 执行的内容</span>\n<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n<span class="token comment">// 在 componentDidMount，以及 count 更改时 componentDidUpdate 执行的内容</span>\ndocument<span class="token punctuation">.</span>title <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">You clicked </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>count<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> times</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>\n<span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n  <span class="token comment">// 需要在 count 更改时 componentDidUpdate（先于 document.title = ... 执行，遵守先清理后更新）</span>\n  <span class="token comment">// 以及 componentWillUnmount 执行的内容</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token comment">// 当函数中 Cleanup 函数会按照在代码中定义的顺序先后执行，与函数本身的特性无关</span>\n<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>count<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 仅在 count 更改时更新</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p><strong>请记得 React 会等待浏览器完成画面渲染之后才会延迟调用 <code class="language-text">useEffect</code>，因此会使得额外操作很方便</strong></p>\n</li>\n<li>\n<p><code class="language-text">componentWillUnmount</code>：相当于 <code class="language-text">useEffect</code> 里面返回的 <code class="language-text">cleanup</code> 函数</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="87769639973709320000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// componentDidMount/componentWillUnmount\nuseEffect(() => {\n// 需要在 componentDidMount 执行的内容\nreturn function cleanup() {\n  // 需要在 componentWillUnmount 执行的内容\n};\n}, []);`, `87769639973709320000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                js 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// componentDidMount/componentWillUnmount</span>\n<span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n<span class="token comment">// 需要在 componentDidMount 执行的内容</span>\n<span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token function">cleanup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token comment">// 需要在 componentWillUnmount 执行的内容</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n</li>\n<li>\n<p><code class="language-text">componentDidCatch</code> and <code class="language-text">getDerivedStateFromError</code>：目前<strong>还没有</strong>这些方法的 Hook 等价写法，但很快会加上。</p>\n</li>\n</ul>\n<p>为方便记忆，大致汇总成表格如下。</p>\n<table>\n<thead>\n<tr>\n<th>class 组件</th>\n<th>Hooks 组件</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>constructor</td>\n<td>useState</td>\n</tr>\n<tr>\n<td>getDerivedStateFromProps</td>\n<td>useState 里面 update 函数</td>\n</tr>\n<tr>\n<td>shouldComponentUpdate</td>\n<td>useMemo</td>\n</tr>\n<tr>\n<td>render</td>\n<td>函数本身</td>\n</tr>\n<tr>\n<td>componentDidMount</td>\n<td>useEffect</td>\n</tr>\n<tr>\n<td>componentDidUpdate</td>\n<td>useEffect</td>\n</tr>\n<tr>\n<td>componentWillUnmount</td>\n<td>useEffect 里面返回的函数</td>\n</tr>\n<tr>\n<td>componentDidCatch</td>\n<td>无</td>\n</tr>\n<tr>\n<td>getDerivedStateFromError</td>\n<td>无</td>\n</tr>\n</tbody>\n</table>\n<h1 id="单个组件的生命周期"><a href="#%E5%8D%95%E4%B8%AA%E7%BB%84%E4%BB%B6%E7%9A%84%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>单个组件的生命周期</h1>\n<h2 id="生命周期"><a href="#%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>生命周期</h2>\n<h3 id="v163-之前"><a href="#v163-%E4%B9%8B%E5%89%8D" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>V16.3 之前</h3>\n<p>我们可以将生命周期分为三个阶段：</p>\n<ul>\n<li>挂载阶段</li>\n<li>组件更新阶段</li>\n<li>卸载阶段</li>\n</ul>\n<p>分开来讲：</p>\n<ol>\n<li>\n<p>挂载阶段</p>\n<ul>\n<li><code class="language-text">constructor</code>：避免将 props 的值复制给 state</li>\n<li><code class="language-text">componentWillMount</code></li>\n<li><code class="language-text">render</code>：react 最重要的步骤，创建虚拟 dom，进行 diff 算法，更新 dom 树都在此进行</li>\n<li><code class="language-text">componentDidMount</code></li>\n</ul>\n</li>\n<li>\n<p>组件更新阶段</p>\n<ul>\n<li><code class="language-text">componentWillReceiveProps</code></li>\n<li><code class="language-text">shouldComponentUpdate</code></li>\n<li><code class="language-text">componentWillUpdate</code></li>\n<li><code class="language-text">render</code></li>\n<li><code class="language-text">componentDidUpdate</code></li>\n</ul>\n</li>\n<li>\n<p>卸载阶段</p>\n<ul>\n<li><code class="language-text">componentWillUnMount</code></li>\n</ul>\n</li>\n</ol>\n<p>\n  <a\n    class="gatsby-resp-image-link"\n    href="/static/2019-09-19-15-39-27-eab55b0696e08d1c4eb1c06e80f91656-64b63.png"\n    style="display: block"\n    target="_blank"\n    rel="noopener"\n  >\n  \n  <span\n    class="gatsby-resp-image-wrapper"\n    style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;"\n  >\n    <span\n      class="gatsby-resp-image-background-image"\n      style="padding-bottom: 46.2%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAIAAAC9o5sfAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABMUlEQVQoz31RXW/DIAzs//9je16nqVXapkkWGkJKvgsGDMxptq4P207Iss53WLY3MUYDC3zwBK01IoYY6FFpZShSvpJUJcY5R8yGSCll0zTEGmOEEFRbpCEAZaDrutZLAvEOpRRp5nm+m9FCvYN6j1a3l/FybJqi84jHyb5U02tnQcOU7Nu3rWalj0EUskxqnkuPfuns4OZAoXei5+klrSRDjyOv+S6RaaaGiR1Yuc3anFM3C07fwIClGTbxGzQzH7pU8LKTzmPP2HV/7t4Pep4rIQrGunFYF/HAszmI3mZ85q1BH2QznBLGcnED9dGzo8ha1dEifjc/FyiX6nqW52pkM5ii1odyug42xr/NYYlxvQpv9S5vT9Vg7NflfAj/dPaPj0nk0INB4/BJHu6aH3wCvBUH6w2zt08AAAAASUVORK5CYII=\'); background-size: cover; display: block;"\n    >\n      <img\n        class="gatsby-resp-image-image"\n        style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;"\n        alt="2019 09 19 15 39 27"\n        title=""\n        src="/static/2019-09-19-15-39-27-eab55b0696e08d1c4eb1c06e80f91656-fee1c.png"\n        srcset="/static/2019-09-19-15-39-27-eab55b0696e08d1c4eb1c06e80f91656-a67b7.png 200w,\n/static/2019-09-19-15-39-27-eab55b0696e08d1c4eb1c06e80f91656-0b187.png 400w,\n/static/2019-09-19-15-39-27-eab55b0696e08d1c4eb1c06e80f91656-fee1c.png 800w,\n/static/2019-09-19-15-39-27-eab55b0696e08d1c4eb1c06e80f91656-b1a91.png 1200w,\n/static/2019-09-19-15-39-27-eab55b0696e08d1c4eb1c06e80f91656-95179.png 1600w,\n/static/2019-09-19-15-39-27-eab55b0696e08d1c4eb1c06e80f91656-64b63.png 2000w"\n        sizes="(max-width: 800px) 100vw, 800px"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<p>这种生命周期会存在一个问题，那就是当更新复杂组件的最上层组件时，调用栈会很长，如果在进行复杂的操作时，就可能长时间阻塞主线程，带来不好的用户体验，<strong>Fiber</strong> 就是为了解决该问题而生。</p>\n<h3 id="v163-之后"><a href="#v163-%E4%B9%8B%E5%90%8E" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>V16.3 之后</h3>\n<p><strong>Fiber 本质上是一个虚拟的堆栈帧，新的调度器会按照优先级自由调度这些帧，从而将之前的同步渲染改成了异步渲染，在不影响体验的情况下去分段计算更新。</strong></p>\n<p>对于异步渲染，分为两阶段：</p>\n<ul>\n<li>\n<p><code class="language-text">reconciliation</code>：</p>\n<ul>\n<li><code class="language-text">componentWillMount</code></li>\n<li><code class="language-text">componentWillReceiveProps</code></li>\n<li><code class="language-text">shouldConmponentUpdate</code></li>\n<li><code class="language-text">componentWillUpdate</code></li>\n</ul>\n</li>\n<li>\n<p><code class="language-text">commit</code></p>\n<ul>\n<li><code class="language-text">componentDidMount</code></li>\n<li><code class="language-text">componentDidUpdate</code></li>\n</ul>\n</li>\n</ul>\n<p>其中，<code class="language-text">reconciliation</code> 阶段是可以被打断的，所以 <code class="language-text">reconcilation</code> 阶段执行的函数就会出现多次调用的情况，显然，这是不合理的。</p>\n<p>所以 V16.3 引入了新的 API 来解决这个问题：</p>\n<ol>\n<li>\n<p><code class="language-text">static getDerivedStateFromProps</code>： 该函数在<strong>挂载阶段和组件更新阶段</strong>都会执行，即<strong>每次获取新的<code class="language-text">props</code> 或 <code class="language-text">state</code> 之后都会被执行</strong>，<strong>在挂载阶段用来代替<code class="language-text">componentWillMount</code></strong>；在组件更新阶段配合 <code class="language-text">componentDidUpdate</code>，可以覆盖 <code class="language-text">componentWillReceiveProps</code> 的所有用法。</p>\n<p>同时它是一个静态函数，所以函数体内不能访问 <code class="language-text">this</code>，会根据 <code class="language-text">nextProps</code> 和 <code class="language-text">prevState</code> 计算出预期的状态改变，返回结果会被送给 <code class="language-text">setState</code><strong>，</strong>返回 <code class="language-text">null</code> 则说明不需要更新 <code class="language-text">state</code>，并且这个返回是<strong>必须的</strong>。</p>\n</li>\n<li>\n<p><code class="language-text">getSnapshotBeforeUpdate</code>: 该函数会在 <strong><code class="language-text">render</code> 之后， DOM 更新前</strong>被调用，用于读取最新的 DOM 数据。</p>\n<p>返回一个值，<strong>作为 <code class="language-text">componentDidUpdate</code> 的第三个参数</strong>；配合 <code class="language-text">componentDidUpdate</code>, 可以覆盖<code class="language-text">componentWillUpdate</code> 的所有用法。</p>\n</li>\n</ol>\n<p>注意：V16.3 中只用在组件挂载或组件 <code class="language-text">props</code> 更新过程才会调用，即如果是因为自身 setState 引发或者 forceUpdate 引发，而不是由父组件引发的话，那么<code class="language-text">static getDerivedStateFromProps</code>也不会被调用，在 V16.4 中更正为都调用。</p>\n<p>即更新后的生命周期为：</p>\n<ol>\n<li>\n<p>挂载阶段</p>\n<ul>\n<li><code class="language-text">constructor</code></li>\n<li><code class="language-text">static getDerivedStateFromProps</code></li>\n<li><code class="language-text">render</code></li>\n<li><code class="language-text">componentDidMount</code></li>\n</ul>\n</li>\n<li>\n<p>更新阶段</p>\n<ul>\n<li><code class="language-text">static getDerivedStateFromProps</code></li>\n<li><code class="language-text">shouldComponentUpdate</code></li>\n<li><code class="language-text">render</code></li>\n<li><code class="language-text">getSnapshotBeforeUpdate</code></li>\n<li><code class="language-text">componentDidUpdate</code></li>\n</ul>\n</li>\n<li>\n<p>卸载阶段</p>\n<ul>\n<li><code class="language-text">componentWillUnmount</code></li>\n</ul>\n</li>\n</ol>\n<p>\n  <a\n    class="gatsby-resp-image-link"\n    href="/static/2019-09-19-15-42-52-c13f7d524b09e92ec31990247d36fa3c-60fa0.png"\n    style="display: block"\n    target="_blank"\n    rel="noopener"\n  >\n  \n  <span\n    class="gatsby-resp-image-wrapper"\n    style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;"\n  >\n    <span\n      class="gatsby-resp-image-background-image"\n      style="padding-bottom: 65.97845601436265%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAIAAAAmMtkJAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAB1ElEQVQoz11SibKqMAzl///OGRUVAVkLbaH7xuaNF0fvexkmCTk5zekSPf+1bdv2ZF6eZBCE4K7rCIS+36Ht1/ae6C/tA4P3IXAupJTWOcHYSIj3/oPuzV8yYONAT6ejFNwYbYwJIcDYy+VirQVUaw0JpfRwOHDOIY/ei22btr4jPMkqMiqptJIvgyaMe60UJEIIICilMMbg3+RdtdA+rfkxaQqkhLLQTShVSmNMhJAtQowxIJg/FoGetm0lLKt9iW2FbU3dtaCnFMVZl1ZjhU1N3KMzeFQ7F8bCFl5k0BbHMUJo3xX8QhV82Q7XrLuX5Jr3XBpQDrYP/JI/B6aNG7mG62HCwFd2HCbfkiZvOGEGD4Jzaf8jw5FCBD0A1URXWDfUtNQ8Gpo3tB8torodTEUUGeQuG3S9yRCqqur7PkxTCJO1DrxzfvW9FSlpjqg4UHSeVO40dT4474DmoMP7aFmW32sM62yec7949JyJk6VhueH5pOvF1BsUQzt7vq7fV7Su62tymqaE0HkyfMxxdxPsoUXDhmKgGcF30ieCFda0zoowBaE4GTB4yKN5nkEDeO3MrUzi7JJUd1DCLG9ZC/kZKuUdMaSsYmqMs9MlP98eZ6n5Dzwc3073oxEkAAAAAElFTkSuQmCC\'); background-size: cover; display: block;"\n    >\n      <img\n        class="gatsby-resp-image-image"\n        style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;"\n        alt="2019 09 19 15 42 52"\n        title=""\n        src="/static/2019-09-19-15-42-52-c13f7d524b09e92ec31990247d36fa3c-fee1c.png"\n        srcset="/static/2019-09-19-15-42-52-c13f7d524b09e92ec31990247d36fa3c-a67b7.png 200w,\n/static/2019-09-19-15-42-52-c13f7d524b09e92ec31990247d36fa3c-0b187.png 400w,\n/static/2019-09-19-15-42-52-c13f7d524b09e92ec31990247d36fa3c-fee1c.png 800w,\n/static/2019-09-19-15-42-52-c13f7d524b09e92ec31990247d36fa3c-b1a91.png 1200w,\n/static/2019-09-19-15-42-52-c13f7d524b09e92ec31990247d36fa3c-95179.png 1600w,\n/static/2019-09-19-15-42-52-c13f7d524b09e92ec31990247d36fa3c-60fa0.png 2228w"\n        sizes="(max-width: 800px) 100vw, 800px"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<h3 id="生命周期，误区"><a href="#%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F%EF%BC%8C%E8%AF%AF%E5%8C%BA" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>生命周期，误区</h3>\n<p><strong>误解一：</strong><code class="language-text">getDerivedStateFromProps</code> 和 <code class="language-text">componentWillReceiveProps</code> 只会在 <code class="language-text">props</code> <strong>改变</strong> 时才会调用</p>\n<p>实际上，<strong>只要父级重新渲染，<code class="language-text">getDerivedStateFromProps</code> 和 <code class="language-text">componentWillReceiveProps</code> 都会重新调用，不管 <code class="language-text">props</code> 有没有变化</strong>。所以，在这两个方法内直接将 props 赋值到 state 是不安全的。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="72732758639652720000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 子组件\nclass PhoneInput extends Component {\n  state = { phone: this.props.phone };\n\n  handleChange = (e) => {\n    this.setState({ phone: e.target.value });\n  };\n\n  render() {\n    const { phone } = this.state;\n    return <input onChange={this.handleChange} value={phone} />;\n  }\n\n  componentWillReceiveProps(nextProps) {\n    // 不要这样做。\n    // 这会覆盖掉之前所有的组件内 state 更新！\n    this.setState({ phone: nextProps.phone });\n  }\n}\n\n// 父组件\nclass App extends Component {\n  constructor() {\n    super();\n    this.state = {\n      count: 0\n    };\n  }\n\n  componentDidMount() {\n    // 使用了 setInterval，\n    // 每秒钟都会更新一下 state.count\n    // 这将导致 App 每秒钟重新渲染一次\n    this.interval = setInterval(\n      () =>\n        this.setState((prevState) => ({\n          count: prevState.count + 1\n        })),\n      1000\n    );\n  }\n\n  componentWillUnmount() {\n    clearInterval(this.interval);\n  }\n\n  render() {\n    return (\n      <>\n        <p>Start editing to see some magic happen :)</p>\n        <PhoneInput phone=\'call me!\' />\n        <p>\n          This component will re-render every second. Each time it renders, the text you type will be reset. This\n          illustrates a derived state anti-pattern.\n        </p>\n      </>\n    );\n  }\n}`, `72732758639652720000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                js 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// 子组件</span>\n<span class="token keyword">class</span> <span class="token class-name">PhoneInput</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span>\n  state <span class="token operator">=</span> <span class="token punctuation">{</span> phone<span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>phone <span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n  <span class="token function-variable function">handleChange</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span> phone<span class="token punctuation">:</span> e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>value <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">const</span> <span class="token punctuation">{</span> phone <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">;</span>\n    <span class="token keyword">return</span> <span class="token operator">&lt;</span>input onChange<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>handleChange<span class="token punctuation">}</span> value<span class="token operator">=</span><span class="token punctuation">{</span>phone<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n\n  <span class="token function">componentWillReceiveProps</span><span class="token punctuation">(</span><span class="token parameter">nextProps</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token comment">// 不要这样做。</span>\n    <span class="token comment">// 这会覆盖掉之前所有的组件内 state 更新！</span>\n    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span> phone<span class="token punctuation">:</span> nextProps<span class="token punctuation">.</span>phone <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n\n<span class="token comment">// 父组件</span>\n<span class="token keyword">class</span> <span class="token class-name">App</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span>\n  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token punctuation">{</span>\n      count<span class="token punctuation">:</span> <span class="token number">0</span>\n    <span class="token punctuation">}</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n\n  <span class="token function">componentDidMount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token comment">// 使用了 setInterval，</span>\n    <span class="token comment">// 每秒钟都会更新一下 state.count</span>\n    <span class="token comment">// 这将导致 App 每秒钟重新渲染一次</span>\n    <span class="token keyword">this</span><span class="token punctuation">.</span>interval <span class="token operator">=</span> <span class="token function">setInterval</span><span class="token punctuation">(</span>\n      <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span>\n        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">prevState</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">{</span>\n          count<span class="token punctuation">:</span> prevState<span class="token punctuation">.</span>count <span class="token operator">+</span> <span class="token number">1</span>\n        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n      <span class="token number">1000</span>\n    <span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n\n  <span class="token function">componentWillUnmount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token function">clearInterval</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>interval<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n\n  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">return</span> <span class="token punctuation">(</span>\n      <span class="token operator">&lt;</span><span class="token operator">></span>\n        <span class="token operator">&lt;</span>p<span class="token operator">></span>Start editing to see some magic happen <span class="token punctuation">:</span><span class="token punctuation">)</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">></span>\n        <span class="token operator">&lt;</span>PhoneInput phone<span class="token operator">=</span><span class="token string">\'call me!\'</span> <span class="token operator">/</span><span class="token operator">></span>\n        <span class="token operator">&lt;</span>p<span class="token operator">></span>\n          This component will re<span class="token operator">-</span>render every second<span class="token punctuation">.</span> Each time it renders<span class="token punctuation">,</span> the text you type will be reset<span class="token punctuation">.</span> This\n          illustrates a derived state anti<span class="token operator">-</span>pattern<span class="token punctuation">.</span>\n        <span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">></span>\n      <span class="token operator">&lt;</span><span class="token operator">/</span><span class="token operator">></span>\n    <span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p><a href="https://stackblitz.com/edit/react-yammav" target="_blank" rel="nofollow noreferrer noopener">实例可点击这里查看</a></p>\n<p>当然，我们可以在 父组件 App 中 <code class="language-text">shouldComponentUpdate</code> 比较 props 的 email 是不是修改再决定要不要重新渲染，但是如果子组件接受多个 props（较为复杂），就很难处理，而且 <code class="language-text">shouldComponentUpdate</code> 主要是用来性能提升的，不推荐开发者操作 <code class="language-text">shouldComponetUpdate</code>（可以使用 <code class="language-text">React.PureComponet</code>）。</p>\n<p>我们也可以使用 <strong>在 props 变化后修改 state</strong>。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="67523567389041770000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`class PhoneInput extends Component {\n  state = {\n    phone: this.props.phone\n  };\n\n  componentWillReceiveProps(nextProps) {\n    // 只要 props.phone 改变，就改变 state\n    if (nextProps.phone !== this.props.phone) {\n      this.setState({\n        phone: nextProps.phone\n      });\n    }\n  }\n\n  // ...\n}`, `67523567389041770000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                js 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">class</span> <span class="token class-name">PhoneInput</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span>\n  state <span class="token operator">=</span> <span class="token punctuation">{</span>\n    phone<span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>phone\n  <span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n  <span class="token function">componentWillReceiveProps</span><span class="token punctuation">(</span><span class="token parameter">nextProps</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token comment">// 只要 props.phone 改变，就改变 state</span>\n    <span class="token keyword">if</span> <span class="token punctuation">(</span>nextProps<span class="token punctuation">.</span>phone <span class="token operator">!==</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>phone<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n        phone<span class="token punctuation">:</span> nextProps<span class="token punctuation">.</span>phone\n      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n  <span class="token punctuation">}</span>\n\n  <span class="token comment">// ...</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>但这种也会导致一个问题，当 props 较为复杂时，props 与 state 的关系不好控制，可能导致问题</p>\n<p>解决方案一：<strong>完全可控的组件</strong></p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="63160966213018345000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`function PhoneInput(props) {\n  return <input onChange={props.onChange} value={props.phone} />;\n}`, `63160966213018345000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                js 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">function</span> <span class="token function">PhoneInput</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">return</span> <span class="token operator">&lt;</span>input onChange<span class="token operator">=</span><span class="token punctuation">{</span>props<span class="token punctuation">.</span>onChange<span class="token punctuation">}</span> value<span class="token operator">=</span><span class="token punctuation">{</span>props<span class="token punctuation">.</span>phone<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p><strong>完全由 props 控制，不派生 state</strong></p>\n<p>解决方案二：<strong>有 key 的非可控组件</strong></p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="11656640900655213000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`class PhoneInput extends Component {\n  state = { phone: this.props.defaultPhone };\n\n  handleChange = (event) => {\n    this.setState({ phone: event.target.value });\n  };\n\n  render() {\n    return <input onChange={this.handleChange} value={this.state.phone} />;\n  }\n}\n\n<PhoneInput defaultPhone={this.props.user.phone} key={this.props.user.id} />;`, `11656640900655213000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                js 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">class</span> <span class="token class-name">PhoneInput</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span>\n  state <span class="token operator">=</span> <span class="token punctuation">{</span> phone<span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>defaultPhone <span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n  <span class="token function-variable function">handleChange</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span> phone<span class="token punctuation">:</span> event<span class="token punctuation">.</span>target<span class="token punctuation">.</span>value <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">return</span> <span class="token operator">&lt;</span>input onChange<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>handleChange<span class="token punctuation">}</span> value<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>phone<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n\n<span class="token operator">&lt;</span>PhoneInput defaultPhone<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>user<span class="token punctuation">.</span>phone<span class="token punctuation">}</span> key<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>user<span class="token punctuation">.</span>id<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>当 <code class="language-text">key</code> 变化时， React 会<strong>创建一个新的而不是更新一个既有的组件</strong></p>\n<p><strong>误解二</strong>：将 props 的值直接复制给 state</p>\n<p><strong>应避免将 props 的值复制给 state</strong></p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="68655607325617725000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`constructor(props) {\n super(props);\n // 千万不要这样做\n // 直接用 props，保证单一数据源\n this.state = { phone: props.phone };\n}`, `68655607325617725000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                js 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n <span class="token keyword">super</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span><span class="token punctuation">;</span>\n <span class="token comment">// 千万不要这样做</span>\n <span class="token comment">// 直接用 props，保证单一数据源</span>\n <span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token punctuation">{</span> phone<span class="token punctuation">:</span> props<span class="token punctuation">.</span>phone <span class="token punctuation">}</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h1 id="多个组件的执行顺序"><a href="#%E5%A4%9A%E4%B8%AA%E7%BB%84%E4%BB%B6%E7%9A%84%E6%89%A7%E8%A1%8C%E9%A1%BA%E5%BA%8F" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>多个组件的执行顺序</h1>\n<h2 id="父子组件"><a href="#%E7%88%B6%E5%AD%90%E7%BB%84%E4%BB%B6" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>父子组件</h2>\n<ul>\n<li>\n<p><strong>挂载阶段</strong></p>\n<p>分 <strong>两个</strong> 阶段：</p>\n<ul>\n<li>第 <strong>一</strong> 阶段，由父组件开始执行到自身的 <code class="language-text">render</code>，解析其下有哪些子组件需要渲染，并对其中 <strong>同步的子组件</strong> 进行创建，按 <strong>递归顺序</strong> 挨个执行各个子组件至 <code class="language-text">render</code>，生成到父子组件对应的 Virtual DOM 树，并 commit 到 DOM。</li>\n<li>第 <strong>二</strong> 阶段，此时 DOM 节点已经生成完毕，组件挂载完成，开始后续流程。先依次触发同步子组件各自的 <code class="language-text">componentDidMount</code>，最后触发父组件的。</li>\n</ul>\n<p><strong>注意</strong>：如果父组件中包含异步子组件，则会在父组件挂载完成后被创建。</p>\n<p>所以执行顺序是：</p>\n<p>父组件 getDerivedStateFromProps —> 同步子组件 getDerivedStateFromProps —> 同步子组件 componentDidMount —> 父组件 componentDidMount —> 异步子组件 getDerivedStateFromProps —> 异步子组件 componentDidMount</p>\n</li>\n<li>\n<p><strong>更新阶段</strong></p>\n<p><strong>React 的设计遵循单向数据流模型</strong> ，也就是说，数据均是由父组件流向子组件。</p>\n<ul>\n<li>\n<p>第 <strong>一</strong> 阶段，由父组件开始，执行</p>\n</li>\n<li>\n<p><code class="language-text">static getDerivedStateFromProps</code></p>\n</li>\n<li>\n<p><code class="language-text">shouldComponentUpdate</code></p>\n</li>\n</ul>\n<p>更新到自身的 <code class="language-text">render</code>，解析其下有哪些子组件需要渲染，并对 <strong>子组件</strong> 进行创建，按 <strong>递归顺序</strong> 挨个执行各个子组件至 <code class="language-text">render</code>，生成到父子组件对应的 Virtual DOM 树，并与已有的 Virtual DOM 树 比较，计算出 <strong>Virtual DOM 真正变化的部分</strong> ，并只针对该部分进行的原生 DOM 操作。</p>\n<ul>\n<li>\n<p>第 <strong>二</strong> 阶段，此时 DOM 节点已经生成完毕，组件挂载完成，开始后续流程。先依次触发同步子组件以下函数，最后触发父组件的。</p>\n</li>\n<li>\n<p><code class="language-text">getSnapshotBeforeUpdate()</code></p>\n</li>\n<li>\n<p><code class="language-text">componentDidUpdate()</code></p>\n</li>\n</ul>\n<p>React 会按照上面的顺序依次执行这些函数，每个函数都是各个子组件的先执行，然后才是父组件的执行。</p>\n<p>所以执行顺序是：</p>\n<p>父组件 getDerivedStateFromProps —> 父组件 shouldComponentUpdate —> 子组件 getDerivedStateFromProps —> 子组件 shouldComponentUpdate —> 子组件 getSnapshotBeforeUpdate —> 父组件 getSnapshotBeforeUpdate —> 子组件 componentDidUpdate —> 父组件 componentDidUpdate</p>\n</li>\n<li>\n<p><strong>卸载阶段</strong></p>\n<p><code class="language-text">componentWillUnmount()</code>，顺序为 <strong>父组件的先执行，子组件按照在 JSX 中定义的顺序依次执行各自的方法</strong>。</p>\n<p><strong>注意</strong> ：如果卸载旧组件的同时伴随有新组件的创建，新组件会先被创建并执行完 <code class="language-text">render</code>，然后卸载不需要的旧组件，最后新组件执行挂载完成的回调。</p>\n</li>\n</ul>\n<h2 id="兄弟组件"><a href="#%E5%85%84%E5%BC%9F%E7%BB%84%E4%BB%B6" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>兄弟组件</h2>\n<ul>\n<li>\n<p><strong>挂载阶段</strong></p>\n<p>若是同步路由，它们的创建顺序和其在共同父组件中定义的先后顺序是 <strong>一致</strong> 的。</p>\n<p>若是异步路由，它们的创建顺序和 js 加载完成的顺序一致。</p>\n</li>\n<li>\n<p><strong>更新阶段、卸载阶段</strong></p>\n<p>兄弟节点之间的通信主要是经过父组件（Redux 和 Context 也是通过改变父组件传递下来的 <code class="language-text">props</code> 实现的），<strong>满足 React 的设计遵循单向数据流模型</strong>， <strong>因此任何两个组件之间的通信，本质上都可以归结为父子组件更新的情况</strong> 。</p>\n<p>所以，兄弟组件更新、卸载阶段，请参考 <strong>父子组件</strong>。</p>\n</li>\n</ul>',
id:"/github/workspace/blog/React生命周期入门学习/index.md absPath of file >>> MarkdownRemark",timeToRead:9,frontmatter:{date:"2019-09-19 15:29:20",path:"/react-lifecycle-practice-learn/",tags:"前端, React, 生命周期",title:"React生命周期入门学习",draft:null}},{excerpt:"接上文 Webpack 配置笔记 分包策略 在分支   上启动   脚本，得到分包策略如下： 首屏加载对比 原始首屏加载 升级后加载 分包优化步骤 echarts 只提取需要的包 immutable 指向同一份，避免 draft 与 antd 重复打包 分大模块改写法 根据路由来分 这里原来的路由引用模块已经是   形式的了，所以我在   里的   加了如下策略 经实验，可以看到各个页面只加载所需的包 根据组件来分 对其中比较大的组件进行了懒加载处理，react-player/draft…",html:'<p>接上文<a href="/webpack-config-note/">Webpack 配置笔记</a></p>\n<h1 id="分包策略"><a href="#%E5%88%86%E5%8C%85%E7%AD%96%E7%95%A5" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>分包策略</h1>\n<p>在分支 <code class="language-text">feature/optimize_webpack</code> 上启动 <code class="language-text">yarn analyze</code> 脚本，得到分包策略如下：</p>\n<p>\n  <a\n    class="gatsby-resp-image-link"\n    href="/static/2019-08-20-14-39-37-7859d5fffe6130839ec4ea995f4afe9a-de767.png"\n    style="display: block"\n    target="_blank"\n    rel="noopener"\n  >\n  \n  <span\n    class="gatsby-resp-image-wrapper"\n    style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;"\n  >\n    <span\n      class="gatsby-resp-image-background-image"\n      style="padding-bottom: 48.45840605002909%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAIAAAA7N+mxAAAACXBIWXMAAA7DAAAOwwHHb6hkAAACbUlEQVQozwFiAp39AO/kz/n28fv8/vr58eqrkuGBXtqBYeKDYeR5T+mZlNyfwN2WsdqV1sp728du1qhr6JBQ5IxU4YBW/25A+wD29vT7/P77/f/5/f/tvKnvkG7rgFnqd07iWCTtm43ptNTehKfWgs7FYt23UsifXOZ/NONxOMhrP+9VJ9oA8/T0+Pj4+Pj4+/397b+v7IZf7HZL6nBE3lkl5JCF46bH24Gl1aTPzavcwqberJThnYjqi3zpaGH5UkvqAN/f3+Hh4eXj4/j+/+6rl+trQuxwSPJwR9pPI9eWg97V1djFwOTW4tC13sW15LWq5p6W7IyH8klK+S802wDj4+Pk5OTo6Of7/P/q2KnkvnLguHPkvHTetmfm0a7q3N/cw77Gvc2lpcmssNuRmtmImOR3i+ZffPNNad4A5eXl5ubm6Ojo9vb49PbJ9vq25+yy5eq/+P3K8vPWz9HDzMu1wczOprnMssbfn7fgmLToh6jsbJn4RXvtAOLi4uPj4+jo6fz8+ff16fb06/Xzy+bkyuXixeTpyKvPoY/AeqrTup3QzKrU3arU6KHO7pLH9Xm0+Vyj/QDi4uLh4eHm5ub4+Pfz99vu89Lp6qrq6p/y8KXb6qmm0qCUwoGw2b604dWX3Nyb3ued3PGP1PeX2f6Mz/4A5eXl5ubm5+fm9PL32/qowPJstupite5bpN4+od92iN6MdNZwnN+wrejSjuXVkujljOjzru373sDA39bYAOTk5Obm5unp6Pz5/9f5or34YLLzSafxMn3CB4HBWG3gcEzFRXDVk2XapYbozIvy43329a/3/em+uuTa2O+lwnzOuk/fAAAAAElFTkSuQmCC\'); background-size: cover; display: block;"\n    >\n      <img\n        class="gatsby-resp-image-image"\n        style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;"\n        alt="分包策略"\n        title=""\n        src="/static/2019-08-20-14-39-37-7859d5fffe6130839ec4ea995f4afe9a-fee1c.png"\n        srcset="/static/2019-08-20-14-39-37-7859d5fffe6130839ec4ea995f4afe9a-a67b7.png 200w,\n/static/2019-08-20-14-39-37-7859d5fffe6130839ec4ea995f4afe9a-0b187.png 400w,\n/static/2019-08-20-14-39-37-7859d5fffe6130839ec4ea995f4afe9a-fee1c.png 800w,\n/static/2019-08-20-14-39-37-7859d5fffe6130839ec4ea995f4afe9a-b1a91.png 1200w,\n/static/2019-08-20-14-39-37-7859d5fffe6130839ec4ea995f4afe9a-95179.png 1600w,\n/static/2019-08-20-14-39-37-7859d5fffe6130839ec4ea995f4afe9a-de767.png 1719w"\n        sizes="(max-width: 800px) 100vw, 800px"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<h1 id="首屏加载对比"><a href="#%E9%A6%96%E5%B1%8F%E5%8A%A0%E8%BD%BD%E5%AF%B9%E6%AF%94" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>首屏加载对比</h1>\n<h2 id="原始首屏加载"><a href="#%E5%8E%9F%E5%A7%8B%E9%A6%96%E5%B1%8F%E5%8A%A0%E8%BD%BD" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>原始首屏加载</h2>\n<p>\n  <a\n    class="gatsby-resp-image-link"\n    href="/static/2019-08-20-14-42-05-a2bf22d39e0e36b58ed042d4b584c141-ed146.png"\n    style="display: block"\n    target="_blank"\n    rel="noopener"\n  >\n  \n  <span\n    class="gatsby-resp-image-wrapper"\n    style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;"\n  >\n    <span\n      class="gatsby-resp-image-background-image"\n      style="padding-bottom: 21.993127147766323%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAIAAAABPYjBAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAAkklEQVQI102O2xLDIAhE8/8fmnhBrUREaTvtxvShZxzcGdiF7fAxUKEQYip4++H24CLFlFLOmZnPP1prd8XHtW7o8hpRe6pqE4m9NpWxUB3SdZpdevyYc6Ka2XYn5VwoRoSg8Xm9L9NCRLz3tsAY0rHH5uzSu+oyny0/ig+eiCozDDgEfgDtnLv3QC/ztWDqwI1fXa3kU7K0VbQAAAAASUVORK5CYII=\'); background-size: cover; display: block;"\n    >\n      <img\n        class="gatsby-resp-image-image"\n        style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;"\n        alt="原始首屏加载大小"\n        title=""\n        src="/static/2019-08-20-14-42-05-a2bf22d39e0e36b58ed042d4b584c141-fee1c.png"\n        srcset="/static/2019-08-20-14-42-05-a2bf22d39e0e36b58ed042d4b584c141-a67b7.png 200w,\n/static/2019-08-20-14-42-05-a2bf22d39e0e36b58ed042d4b584c141-0b187.png 400w,\n/static/2019-08-20-14-42-05-a2bf22d39e0e36b58ed042d4b584c141-fee1c.png 800w,\n/static/2019-08-20-14-42-05-a2bf22d39e0e36b58ed042d4b584c141-b1a91.png 1200w,\n/static/2019-08-20-14-42-05-a2bf22d39e0e36b58ed042d4b584c141-95179.png 1600w,\n/static/2019-08-20-14-42-05-a2bf22d39e0e36b58ed042d4b584c141-ed146.png 1746w"\n        sizes="(max-width: 800px) 100vw, 800px"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<h2 id="升级后加载"><a href="#%E5%8D%87%E7%BA%A7%E5%90%8E%E5%8A%A0%E8%BD%BD" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>升级后加载</h2>\n<p>\n  <a\n    class="gatsby-resp-image-link"\n    href="/static/2019-08-20-14-42-42-9d4635b500dadc398310cd08fe4408c1-009aa.png"\n    style="display: block"\n    target="_blank"\n    rel="noopener"\n  >\n  \n  <span\n    class="gatsby-resp-image-wrapper"\n    style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;"\n  >\n    <span\n      class="gatsby-resp-image-background-image"\n      style="padding-bottom: 26.851851851851855%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAIAAADKYVtkAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAAoklEQVQY03VPyw7DIAzr/38oJVBKeCa0l7mwSrvMQigxsWO2nQ4foiNHPtARzL4TkfPOgw4h5ZT/IDFvORecmFPtrWpXVVHtgHQReVqR67r0xSIBkFsppdYa4wmgBnvfN7Q6LfDkvV961CiwEwatPQNfcYgnOYfpMdFamxEET8YY3BBjcomHDuQa7+YSmWmCmWGxIkjvcLHWov3dPBBK8Cv9AF+YHUoLUXbjAAAAAElFTkSuQmCC\'); background-size: cover; display: block;"\n    >\n      <img\n        class="gatsby-resp-image-image"\n        style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;"\n        alt="升级后加载大小"\n        title=""\n        src="/static/2019-08-20-14-42-42-9d4635b500dadc398310cd08fe4408c1-fee1c.png"\n        srcset="/static/2019-08-20-14-42-42-9d4635b500dadc398310cd08fe4408c1-a67b7.png 200w,\n/static/2019-08-20-14-42-42-9d4635b500dadc398310cd08fe4408c1-0b187.png 400w,\n/static/2019-08-20-14-42-42-9d4635b500dadc398310cd08fe4408c1-fee1c.png 800w,\n/static/2019-08-20-14-42-42-9d4635b500dadc398310cd08fe4408c1-b1a91.png 1200w,\n/static/2019-08-20-14-42-42-9d4635b500dadc398310cd08fe4408c1-95179.png 1600w,\n/static/2019-08-20-14-42-42-9d4635b500dadc398310cd08fe4408c1-009aa.png 1728w"\n        sizes="(max-width: 800px) 100vw, 800px"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<h1 id="分包优化步骤"><a href="#%E5%88%86%E5%8C%85%E4%BC%98%E5%8C%96%E6%AD%A5%E9%AA%A4" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>分包优化步骤</h1>\n<h2 id="echarts-只提取需要的包"><a href="#echarts-%E5%8F%AA%E6%8F%90%E5%8F%96%E9%9C%80%E8%A6%81%E7%9A%84%E5%8C%85" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>echarts 只提取需要的包</h2>\n<p><code class="language-text">app\\components\\ECharts\\component.js</code></p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="54434859526374170000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`import echarts from \'echarts/lib/echarts\';\nimport \'echarts/lib/chart/bar\';\nimport \'echarts/lib/chart/line\';\nimport \'echarts/lib/chart/pie\';\n\nimport \'echarts/lib/component/tooltip\';\nimport \'echarts/lib/component/legendScroll\';`, `54434859526374170000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                js 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">import</span> echarts <span class="token keyword">from</span> <span class="token string">\'echarts/lib/echarts\'</span><span class="token punctuation">;</span>\n<span class="token keyword">import</span> <span class="token string">\'echarts/lib/chart/bar\'</span><span class="token punctuation">;</span>\n<span class="token keyword">import</span> <span class="token string">\'echarts/lib/chart/line\'</span><span class="token punctuation">;</span>\n<span class="token keyword">import</span> <span class="token string">\'echarts/lib/chart/pie\'</span><span class="token punctuation">;</span>\n\n<span class="token keyword">import</span> <span class="token string">\'echarts/lib/component/tooltip\'</span><span class="token punctuation">;</span>\n<span class="token keyword">import</span> <span class="token string">\'echarts/lib/component/legendScroll\'</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id="immutable-指向同一份，避免-draft-与-antd-重复打包"><a href="#immutable-%E6%8C%87%E5%90%91%E5%90%8C%E4%B8%80%E4%BB%BD%EF%BC%8C%E9%81%BF%E5%85%8D-draft-%E4%B8%8E-antd-%E9%87%8D%E5%A4%8D%E6%89%93%E5%8C%85" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>immutable 指向同一份，避免 draft 与 antd 重复打包</h2>\n<p><code class="language-text">internals/webpack/webpack.base.babel.js</code></p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="43534965060929266000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`\'immutable\': path.resolve(process.cwd(), \'node_modules/immutable\'),`, `43534965060929266000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                js 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token string">\'immutable\'</span><span class="token punctuation">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span><span class="token function">cwd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">\'node_modules/immutable\'</span><span class="token punctuation">)</span><span class="token punctuation">,</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<h2 id="分大模块改写法"><a href="#%E5%88%86%E5%A4%A7%E6%A8%A1%E5%9D%97%E6%94%B9%E5%86%99%E6%B3%95" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>分大模块改写法</h2>\n<h3 id="根据路由来分"><a href="#%E6%A0%B9%E6%8D%AE%E8%B7%AF%E7%94%B1%E6%9D%A5%E5%88%86" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>根据路由来分</h3>\n<p>这里原来的路由引用模块已经是 <code class="language-text">import().then()</code> 形式的了，所以我在 <code class="language-text">webpack</code> 里的 <code class="language-text">splitChunks</code> 加了如下策略</p>\n<p><code class="language-text">internals/webpack/webpack.prod.babel.js</code></p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="52209051260246380000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`splitChunks: {\n  chunks: \'all\', // 不管文件是动态还是非动态载入，统一将文件分离。当页面首次载入会引入所有的包\n  maxInitialRequests: 10, // 最大初始化请求数\n  minSize: 0, // 默认30000，为了不合并 chunk\n  cacheGroups: {\n    vendor: {\n      test: /[\\\\/]node_modules[\\\\/]/,\n      name(module) {\n        const packageName = module.context.match(\n          /[\\\\/]node_modules[\\\\/](.*?)([\\\\/]|\\$)/,\n        )[1];\n        return \\`npm.\\${packageName.replace(\'@\', \'\')}\\`; // 提取各个第三方组件，只在需要时提取\n      },\n    },\n  },\n},`, `52209051260246380000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                js 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js">splitChunks<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n  chunks<span class="token punctuation">:</span> <span class="token string">\'all\'</span><span class="token punctuation">,</span> <span class="token comment">// 不管文件是动态还是非动态载入，统一将文件分离。当页面首次载入会引入所有的包</span>\n  maxInitialRequests<span class="token punctuation">:</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token comment">// 最大初始化请求数</span>\n  minSize<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token comment">// 默认30000，为了不合并 chunk</span>\n  cacheGroups<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n    vendor<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n      test<span class="token punctuation">:</span> <span class="token regex">/[\\\\/]node_modules[\\\\/]/</span><span class="token punctuation">,</span>\n      <span class="token function">name</span><span class="token punctuation">(</span><span class="token parameter">module</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        <span class="token keyword">const</span> packageName <span class="token operator">=</span> module<span class="token punctuation">.</span>context<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span>\n          <span class="token regex">/[\\\\/]node_modules[\\\\/](.*?)([\\\\/]|$)/</span><span class="token punctuation">,</span>\n        <span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n        <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">npm.</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>packageName<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token string">\'@\'</span><span class="token punctuation">,</span> <span class="token string">\'\'</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span> <span class="token comment">// 提取各个第三方组件，只在需要时提取</span>\n      <span class="token punctuation">}</span><span class="token punctuation">,</span>\n    <span class="token punctuation">}</span><span class="token punctuation">,</span>\n  <span class="token punctuation">}</span><span class="token punctuation">,</span>\n<span class="token punctuation">}</span><span class="token punctuation">,</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>经实验，可以看到各个页面只加载所需的包</p>\n<h3 id="根据组件来分"><a href="#%E6%A0%B9%E6%8D%AE%E7%BB%84%E4%BB%B6%E6%9D%A5%E5%88%86" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>根据组件来分</h3>\n<p>对其中比较大的组件进行了懒加载处理，react-player/draft/echarts</p>\n<p>其中有一个比较大的问题就是懒加载组件引用不到 ref 的问题，经多次实验，更改写法如下</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="32670125350457480000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`import React from \'react\';\nimport Loadable from \'react-loadable\';\n\nconst LoaderCache = new Map();\nexport default function loadComponent(loader, options) {\n  let component = LoaderCache.get(loader);\n  if (!component) {\n    component = Loadable({\n      loader,\n      loading: (props) => {\n        if (props.error) {\n          // eslint-disable-line\n          console.error(\'[chunk loader]\', props.error); // eslint-disable-line\n        }\n        return <div />;\n      },\n      render: (loaded, props) => {\n        const Component = loaded.default;\n        const { withRef, ...rest } = props; // eslint-disable-line\n        return (\n          <Component\n            ref={(r) => {\n              withRef && withRef(r);\n            }}\n            {...rest}\n          />\n        );\n      },\n      ...options\n    });\n    LoaderCache.set(loader, component);\n    // component.preload();\n  }\n  return component;\n}`, `32670125350457480000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                js{16-23} 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight has-highlighted-lines" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">\'react\'</span><span class="token punctuation">;</span>\n<span class="token keyword">import</span> Loadable <span class="token keyword">from</span> <span class="token string">\'react-loadable\'</span><span class="token punctuation">;</span>\n\n<span class="token keyword">const</span> LoaderCache <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Map</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">loadComponent</span><span class="token punctuation">(</span><span class="token parameter">loader<span class="token punctuation">,</span> options</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">let</span> component <span class="token operator">=</span> LoaderCache<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>loader<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>component<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    component <span class="token operator">=</span> <span class="token function">Loadable</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n      loader<span class="token punctuation">,</span>\n      <span class="token function-variable function">loading</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n        <span class="token keyword">if</span> <span class="token punctuation">(</span>props<span class="token punctuation">.</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n          <span class="token comment">// eslint-disable-line</span>\n          console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">\'[chunk loader]\'</span><span class="token punctuation">,</span> props<span class="token punctuation">.</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// eslint-disable-line</span>\n        <span class="token punctuation">}</span>\n        <span class="token keyword">return</span> <span class="token operator">&lt;</span>div <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">;</span>\n<span class="gatsby-highlight-code-line">      <span class="token punctuation">}</span><span class="token punctuation">,</span></span><span class="gatsby-highlight-code-line">      <span class="token function-variable function">render</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token parameter">loaded<span class="token punctuation">,</span> props</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span></span><span class="gatsby-highlight-code-line">        <span class="token keyword">const</span> Component <span class="token operator">=</span> loaded<span class="token punctuation">.</span>default<span class="token punctuation">;</span></span><span class="gatsby-highlight-code-line">        <span class="token keyword">const</span> <span class="token punctuation">{</span> withRef<span class="token punctuation">,</span> <span class="token operator">...</span>rest <span class="token punctuation">}</span> <span class="token operator">=</span> props<span class="token punctuation">;</span> <span class="token comment">// eslint-disable-line</span></span><span class="gatsby-highlight-code-line">        <span class="token keyword">return</span> <span class="token punctuation">(</span></span><span class="gatsby-highlight-code-line">          <span class="token operator">&lt;</span>Component</span><span class="gatsby-highlight-code-line">            ref<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token parameter">r</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span></span><span class="gatsby-highlight-code-line">              withRef <span class="token operator">&amp;&amp;</span> <span class="token function">withRef</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span><span class="token punctuation">;</span></span>            <span class="token punctuation">}</span><span class="token punctuation">}</span>\n            <span class="token punctuation">{</span><span class="token operator">...</span>rest<span class="token punctuation">}</span>\n          <span class="token operator">/</span><span class="token operator">></span>\n        <span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span><span class="token punctuation">,</span>\n      <span class="token operator">...</span>options\n    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    LoaderCache<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>loader<span class="token punctuation">,</span> component<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token comment">// component.preload();</span>\n  <span class="token punctuation">}</span>\n  <span class="token keyword">return</span> component<span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>用法：</p>\n<p><code class="language-text">app\\components\\GraphHintTextArea\\index.js</code></p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="81488633019406090000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`import loadComponent from \'utils/loader\';\n\nexport default loadComponent(() => import(/* webpackChunkName: &quot;c-graph-hint-text-area&quot; */ \'./component\'), null);`, `81488633019406090000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                js 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">import</span> loadComponent <span class="token keyword">from</span> <span class="token string">\'utils/loader\'</span><span class="token punctuation">;</span>\n\n<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">loadComponent</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token comment">/* webpackChunkName: "c-graph-hint-text-area" */</span> <span class="token string">\'./component\'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="55479443728339590000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`<GraphHintTextArea\n  withRef={(r) => {\n    this.graphHintTextArea = r;\n  }}\n/>`, `55479443728339590000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                jsx 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="jsx"><pre style="counter-reset: linenumber NaN" class="language-jsx line-numbers"><code class="language-jsx"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">GraphHintTextArea</span></span>\n  <span class="token attr-name">withRef</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token parameter">r</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n    <span class="token keyword">this</span><span class="token punctuation">.</span>graphHintTextArea <span class="token operator">=</span> r<span class="token punctuation">;</span>\n  <span class="token punctuation">}</span><span class="token punctuation">}</span></span>\n<span class="token punctuation">/></span></span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id="antd-只加载需要的-icon"><a href="#antd-%E5%8F%AA%E5%8A%A0%E8%BD%BD%E9%9C%80%E8%A6%81%E7%9A%84-icon" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>antd 只加载需要的 icon</h2>\n<p><code class="language-text">internals/webpack/webpack.base.babel.js</code></p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="68034528991342260000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`\'@ant-design/icons/lib/dist\\$\': path.resolve(\'app/icons\'),`, `68034528991342260000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                js 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token string">\'@ant-design/icons/lib/dist$\'</span><span class="token punctuation">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">\'app/icons\'</span><span class="token punctuation">)</span><span class="token punctuation">,</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p><code class="language-text">app/icons/index.js</code></p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="53629220766119220000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// fill\nexport { default as ExclamationCircleFill } from \'@ant-design/icons/lib/fill/ExclamationCircleFill\';\n// outline\nexport { default as QuestionCircleOutline } from \'@ant-design/icons/lib/outline/QuestionCircleOutline\';\n// twotone\nexport { default as ProfileTwoTone } from \'@ant-design/icons/lib/twotone/ProfileTwoTone\';`, `53629220766119220000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                js 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// fill</span>\n<span class="token keyword">export</span> <span class="token punctuation">{</span> <span class="token keyword">default</span> <span class="token keyword">as</span> ExclamationCircleFill <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">\'@ant-design/icons/lib/fill/ExclamationCircleFill\'</span><span class="token punctuation">;</span>\n<span class="token comment">// outline</span>\n<span class="token keyword">export</span> <span class="token punctuation">{</span> <span class="token keyword">default</span> <span class="token keyword">as</span> QuestionCircleOutline <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">\'@ant-design/icons/lib/outline/QuestionCircleOutline\'</span><span class="token punctuation">;</span>\n<span class="token comment">// twotone</span>\n<span class="token keyword">export</span> <span class="token punctuation">{</span> <span class="token keyword">default</span> <span class="token keyword">as</span> ProfileTwoTone <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">\'@ant-design/icons/lib/twotone/ProfileTwoTone\'</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>',
id:"/github/workspace/blog/Webpack升级优化——记一次产品端升级/index.md absPath of file >>> MarkdownRemark",timeToRead:4,frontmatter:{date:"2019-08-20 14:33:00",path:"/webpack-upgrade-about-product/",tags:"前端, 前端构建工具, webpack, 预研",title:"Webpack升级优化——记一次产品端升级",draft:null}},{excerpt:"广度优先搜索 以二叉树的层次遍历举例： 深度优先搜索 深度优先拷贝 目前只拷贝了 Object, Array",html:'<h1 id="广度优先搜索"><a href="#%E5%B9%BF%E5%BA%A6%E4%BC%98%E5%85%88%E6%90%9C%E7%B4%A2" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>广度优先搜索</h1>\n<p>以二叉树的层次遍历举例：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="37291908902947940000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`/*\n * @lc app=leetcode.cn id=102 lang=javascript\n *\n * [102] 二叉树的层次遍历\n *\n * https://leetcode-cn.com/problems/binary-tree-level-order-traversal/description/\n *\n * algorithms\n * Medium (53.64%)\n * Total Accepted:    17.4K\n * Total Submissions: 32.4K\n * Testcase Example:  \'[3,9,20,null,null,15,7]\'\n *\n * 给定一个二叉树，返回其按层次遍历的节点值。 （即逐层地，从左到右访问所有节点）。\n *\n * 例如:\n * 给定二叉树: [3,9,20,null,null,15,7],\n *\n * ⁠   3\n * ⁠  / \\\n * ⁠ 9  20\n * ⁠   /  \\\n * ⁠  15   7\n *\n *\n * 返回其层次遍历结果：\n *\n * [\n * ⁠ [3],\n * ⁠ [9,20],\n * ⁠ [15,7]\n * ]\n *\n *\n */\n/**\n * Definition for a binary tree node.\n * function TreeNode(val) {\n *     this.val = val;\n *     this.left = this.right = null;\n * }\n */\n/**\n * @param {TreeNode} root\n * @return {number[][]}\n */\nvar levelOrder = function(root) {\n  if (!root) {\n    return [];\n  }\n  const queue = [root];\n  const results = [];\n  while (queue.length) {\n    let count = queue.length;\n    const result = [];\n    while (count--) {\n      const t1 = queue.shift();\n      result.push(t1.val);\n      t1.left && queue.push(t1.left);\n      t1.right && queue.push(t1.right);\n    }\n    results.push(result);\n  }\n  return results;\n};`, `37291908902947940000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                js 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">/*\n * @lc app=leetcode.cn id=102 lang=javascript\n *\n * [102] 二叉树的层次遍历\n *\n * https://leetcode-cn.com/problems/binary-tree-level-order-traversal/description/\n *\n * algorithms\n * Medium (53.64%)\n * Total Accepted:    17.4K\n * Total Submissions: 32.4K\n * Testcase Example:  \'[3,9,20,null,null,15,7]\'\n *\n * 给定一个二叉树，返回其按层次遍历的节点值。 （即逐层地，从左到右访问所有节点）。\n *\n * 例如:\n * 给定二叉树: [3,9,20,null,null,15,7],\n *\n * ⁠   3\n * ⁠  / \\\n * ⁠ 9  20\n * ⁠   /  \\\n * ⁠  15   7\n *\n *\n * 返回其层次遍历结果：\n *\n * [\n * ⁠ [3],\n * ⁠ [9,20],\n * ⁠ [15,7]\n * ]\n *\n *\n */</span>\n<span class="token comment">/**\n * Definition for a binary tree node.\n * function TreeNode(val) {\n *     this.val = val;\n *     this.left = this.right = null;\n * }\n */</span>\n<span class="token comment">/**\n * @param {TreeNode} root\n * @return {number[][]}\n */</span>\n<span class="token keyword">var</span> <span class="token function-variable function">levelOrder</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">root</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>root<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n  <span class="token keyword">const</span> queue <span class="token operator">=</span> <span class="token punctuation">[</span>root<span class="token punctuation">]</span><span class="token punctuation">;</span>\n  <span class="token keyword">const</span> results <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n  <span class="token keyword">while</span> <span class="token punctuation">(</span>queue<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> count <span class="token operator">=</span> queue<span class="token punctuation">.</span>length<span class="token punctuation">;</span>\n    <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n    <span class="token keyword">while</span> <span class="token punctuation">(</span>count<span class="token operator">--</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token keyword">const</span> t1 <span class="token operator">=</span> queue<span class="token punctuation">.</span><span class="token function">shift</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n      result<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>t1<span class="token punctuation">.</span>val<span class="token punctuation">)</span><span class="token punctuation">;</span>\n      t1<span class="token punctuation">.</span>left <span class="token operator">&amp;&amp;</span> queue<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>t1<span class="token punctuation">.</span>left<span class="token punctuation">)</span><span class="token punctuation">;</span>\n      t1<span class="token punctuation">.</span>right <span class="token operator">&amp;&amp;</span> queue<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>t1<span class="token punctuation">.</span>right<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n    results<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n  <span class="token keyword">return</span> results<span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h1 id="深度优先搜索"><a href="#%E6%B7%B1%E5%BA%A6%E4%BC%98%E5%85%88%E6%90%9C%E7%B4%A2" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>深度优先搜索</h1>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="60142558788489800000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`/*深度优先遍历三种方式*/\nlet deepTraversal1 = (node, nodeList = []) => {\n  if (node !== null) {\n    nodeList.push(node);\n    let children = node.children;\n    for (let i = 0; i < children.length; i++) {\n      deepTraversal1(children[i], nodeList);\n    }\n  }\n  return nodeList;\n};\nlet deepTraversal2 = (node) => {\n  let nodes = [];\n  if (node !== null) {\n    nodes.push(node);\n    let children = node.children;\n    for (let i = 0; i < children.length; i++) {\n      nodes = nodes.concat(deepTraversal2(children[i]));\n    }\n  }\n  return nodes;\n};\n// 非递归\nlet deepTraversal3 = (node) => {\n  let stack = [];\n  let nodes = [];\n  if (node) {\n    // 推入当前处理的node\n    stack.push(node);\n    while (stack.length) {\n      let item = stack.pop();\n      let children = item.children;\n      nodes.push(item);\n      // node = [] stack = [parent]\n      // node = [parent] stack = [child3,child2,child1]\n      // node = [parent, child1] stack = [child3,child2,child1-2,child1-1]\n      // node = [parent, child1-1] stack = [child3,child2,child1-2]\n      for (let i = children.length - 1; i >= 0; i--) {\n        stack.push(children[i]);\n      }\n    }\n  }\n  return nodes;\n};`, `60142558788489800000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                js 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">/*深度优先遍历三种方式*/</span>\n<span class="token keyword">let</span> <span class="token function-variable function">deepTraversal1</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">node<span class="token punctuation">,</span> nodeList <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n  <span class="token keyword">if</span> <span class="token punctuation">(</span>node <span class="token operator">!==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    nodeList<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>node<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">let</span> children <span class="token operator">=</span> node<span class="token punctuation">.</span>children<span class="token punctuation">;</span>\n    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> children<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token function">deepTraversal1</span><span class="token punctuation">(</span>children<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> nodeList<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n  <span class="token punctuation">}</span>\n  <span class="token keyword">return</span> nodeList<span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span>\n<span class="token keyword">let</span> <span class="token function-variable function">deepTraversal2</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">node</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n  <span class="token keyword">let</span> nodes <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n  <span class="token keyword">if</span> <span class="token punctuation">(</span>node <span class="token operator">!==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    nodes<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>node<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">let</span> children <span class="token operator">=</span> node<span class="token punctuation">.</span>children<span class="token punctuation">;</span>\n    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> children<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      nodes <span class="token operator">=</span> nodes<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span><span class="token function">deepTraversal2</span><span class="token punctuation">(</span>children<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n  <span class="token punctuation">}</span>\n  <span class="token keyword">return</span> nodes<span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span>\n<span class="token comment">// 非递归</span>\n<span class="token keyword">let</span> <span class="token function-variable function">deepTraversal3</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">node</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n  <span class="token keyword">let</span> stack <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n  <span class="token keyword">let</span> nodes <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n  <span class="token keyword">if</span> <span class="token punctuation">(</span>node<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token comment">// 推入当前处理的node</span>\n    stack<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>node<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">while</span> <span class="token punctuation">(</span>stack<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token keyword">let</span> item <span class="token operator">=</span> stack<span class="token punctuation">.</span><span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token keyword">let</span> children <span class="token operator">=</span> item<span class="token punctuation">.</span>children<span class="token punctuation">;</span>\n      nodes<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token comment">// node = [] stack = [parent]</span>\n      <span class="token comment">// node = [parent] stack = [child3,child2,child1]</span>\n      <span class="token comment">// node = [parent, child1] stack = [child3,child2,child1-2,child1-1]</span>\n      <span class="token comment">// node = [parent, child1-1] stack = [child3,child2,child1-2]</span>\n      <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> children<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">>=</span> <span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">--</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        stack<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>children<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span>\n    <span class="token punctuation">}</span>\n  <span class="token punctuation">}</span>\n  <span class="token keyword">return</span> nodes<span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h1 id="深度优先拷贝"><a href="#%E6%B7%B1%E5%BA%A6%E4%BC%98%E5%85%88%E6%8B%B7%E8%B4%9D" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>深度优先拷贝</h1>\n<p>目前只拷贝了 Object, Array</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="4535704695055198000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 如果是对象/数组，返回一个空的对象/数组，\n// 都不是的话直接返回原对象\n// 判断返回的对象和原有对象是否相同就可以知道是否需要继续深拷贝\n// 处理其他的数据类型的话就在这里加判断\nfunction getEmpty(o) {\n  if (Object.prototype.toString.call(o) === \'[object Object]\') {\n    return {};\n  }\n  if (Object.prototype.toString.call(o) === \'[object Array]\') {\n    return [];\n  }\n  return o;\n}\n\nfunction deepCopyBFS(origin) {\n  let queue = [];\n  let map = new Map(); // 记录出现过的对象，用于处理环\n\n  let target = getEmpty(origin);\n  if (target !== origin) {\n    queue.push([origin, target]);\n    map.set(origin, target);\n  }\n\n  while (queue.length) {\n    let [ori, tar] = queue.shift();\n    for (let key in ori) {\n      // 处理环状\n      if (map.get(ori[key])) {\n        tar[key] = map.get(ori[key]);\n        continue;\n      }\n\n      tar[key] = getEmpty(ori[key]);\n      if (tar[key] !== ori[key]) {\n        queue.push([ori[key], tar[key]]);\n        map.set(ori[key], tar[key]);\n      }\n    }\n  }\n\n  return target;\n}\n\nfunction deepCopyDFS(origin) {\n  let stack = [];\n  let map = new Map(); // 记录出现过的对象，用于处理环\n\n  let target = getEmpty(origin);\n  if (target !== origin) {\n    stack.push([origin, target]);\n    map.set(origin, target);\n  }\n\n  while (stack.length) {\n    let [ori, tar] = stack.pop();\n    for (let key in ori) {\n      // 处理环状\n      if (map.get(ori[key])) {\n        tar[key] = map.get(ori[key]);\n        continue;\n      }\n\n      tar[key] = getEmpty(ori[key]);\n      if (tar[key] !== ori[key]) {\n        stack.push([ori[key], tar[key]]);\n        map.set(ori[key], tar[key]);\n      }\n    }\n  }\n\n  return target;\n}`, `4535704695055198000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                js 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// 如果是对象/数组，返回一个空的对象/数组，</span>\n<span class="token comment">// 都不是的话直接返回原对象</span>\n<span class="token comment">// 判断返回的对象和原有对象是否相同就可以知道是否需要继续深拷贝</span>\n<span class="token comment">// 处理其他的数据类型的话就在这里加判断</span>\n<span class="token keyword">function</span> <span class="token function">getEmpty</span><span class="token punctuation">(</span><span class="token parameter">o</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">Object</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>o<span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token string">\'[object Object]\'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">return</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">Object</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>o<span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token string">\'[object Array]\'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n  <span class="token keyword">return</span> o<span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">function</span> <span class="token function">deepCopyBFS</span><span class="token punctuation">(</span><span class="token parameter">origin</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">let</span> queue <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n  <span class="token keyword">let</span> map <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Map</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 记录出现过的对象，用于处理环</span>\n\n  <span class="token keyword">let</span> target <span class="token operator">=</span> <span class="token function">getEmpty</span><span class="token punctuation">(</span>origin<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token keyword">if</span> <span class="token punctuation">(</span>target <span class="token operator">!==</span> origin<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    queue<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">[</span>origin<span class="token punctuation">,</span> target<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    map<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>origin<span class="token punctuation">,</span> target<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n\n  <span class="token keyword">while</span> <span class="token punctuation">(</span>queue<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> <span class="token punctuation">[</span>ori<span class="token punctuation">,</span> tar<span class="token punctuation">]</span> <span class="token operator">=</span> queue<span class="token punctuation">.</span><span class="token function">shift</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> key <span class="token keyword">in</span> ori<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token comment">// 处理环状</span>\n      <span class="token keyword">if</span> <span class="token punctuation">(</span>map<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>ori<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        tar<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> map<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>ori<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token keyword">continue</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span>\n\n      tar<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">getEmpty</span><span class="token punctuation">(</span>ori<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token keyword">if</span> <span class="token punctuation">(</span>tar<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">!==</span> ori<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        queue<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">[</span>ori<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">,</span> tar<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n        map<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>ori<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">,</span> tar<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span>\n    <span class="token punctuation">}</span>\n  <span class="token punctuation">}</span>\n\n  <span class="token keyword">return</span> target<span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">function</span> <span class="token function">deepCopyDFS</span><span class="token punctuation">(</span><span class="token parameter">origin</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">let</span> stack <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n  <span class="token keyword">let</span> map <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Map</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 记录出现过的对象，用于处理环</span>\n\n  <span class="token keyword">let</span> target <span class="token operator">=</span> <span class="token function">getEmpty</span><span class="token punctuation">(</span>origin<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token keyword">if</span> <span class="token punctuation">(</span>target <span class="token operator">!==</span> origin<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    stack<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">[</span>origin<span class="token punctuation">,</span> target<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    map<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>origin<span class="token punctuation">,</span> target<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n\n  <span class="token keyword">while</span> <span class="token punctuation">(</span>stack<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> <span class="token punctuation">[</span>ori<span class="token punctuation">,</span> tar<span class="token punctuation">]</span> <span class="token operator">=</span> stack<span class="token punctuation">.</span><span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> key <span class="token keyword">in</span> ori<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token comment">// 处理环状</span>\n      <span class="token keyword">if</span> <span class="token punctuation">(</span>map<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>ori<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        tar<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> map<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>ori<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token keyword">continue</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span>\n\n      tar<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">getEmpty</span><span class="token punctuation">(</span>ori<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token keyword">if</span> <span class="token punctuation">(</span>tar<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">!==</span> ori<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        stack<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">[</span>ori<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">,</span> tar<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n        map<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>ori<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">,</span> tar<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span>\n    <span class="token punctuation">}</span>\n  <span class="token punctuation">}</span>\n\n  <span class="token keyword">return</span> target<span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>',
id:"/github/workspace/blog/树的遍历算法与深度拷贝函数/index.md absPath of file >>> MarkdownRemark",timeToRead:2,frontmatter:{date:"2019-07-19 11:47:41",path:"/tree-traversal-depth-copy/",tags:"前端, 深度拷贝, 树的遍历",title:"树的遍历算法与深度拷贝函数",draft:null}},{excerpt:"防抖动是将多次执行变为最后一次执行，节流是将多次执行变成每隔一段时间执行。 防抖 触发高频事件后 n 秒内函数只会执行一次，如果 n 秒内高频事件再次被触发，则重新计算时间 思路： 每次触发事件时都取消之前的延时调用方法 节流 高频事件触发，但在 n 秒内只会执行一次，所以节流会稀释函数的执行频率 思路： 每次触发事件时都判断当前是否有等待执行的延时函数",html:'<p>防抖动是将多次执行变为最后一次执行，节流是将多次执行变成每隔一段时间执行。</p>\n<h1 id="防抖"><a href="#%E9%98%B2%E6%8A%96" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>防抖</h1>\n<p>触发高频事件后 n 秒内函数只会执行一次，如果 n 秒内高频事件再次被触发，则重新计算时间</p>\n<h2 id="思路："><a href="#%E6%80%9D%E8%B7%AF%EF%BC%9A" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>思路：</h2>\n<p>每次触发事件时都取消之前的延时调用方法</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="66073117141667170000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`function debounce(fn) {\n  let timeout = null; // 创建一个标记用来存放定时器的返回值\n  return function() {\n    clearTimeout(timeout); // 每当用户输入的时候把前一个 setTimeout clear 掉\n    // 然后又创建一个新的 setTimeout, 这样就能保证输入字符后的 interval 间隔内如果还有字符输入的话，就不会执行 fn 函数\n    timeout = setTimeout(() => {\n      fn.apply(this, arguments);\n    }, 500);\n  };\n}\n\nfunction sayHi() {\n  console.log(\'防抖成功\');\n}\n\nvar inp = document.getElementById(\'inp\');\ninp.addEventListener(\'input\', debounce(sayHi)); // 防抖`, `66073117141667170000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                js 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">function</span> <span class="token function">debounce</span><span class="token punctuation">(</span><span class="token parameter">fn</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">let</span> timeout <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span> <span class="token comment">// 创建一个标记用来存放定时器的返回值</span>\n  <span class="token keyword">return</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token function">clearTimeout</span><span class="token punctuation">(</span>timeout<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 每当用户输入的时候把前一个 setTimeout clear 掉</span>\n    <span class="token comment">// 然后又创建一个新的 setTimeout, 这样就能保证输入字符后的 interval 间隔内如果还有字符输入的话，就不会执行 fn 函数</span>\n    timeout <span class="token operator">=</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n      <span class="token function">fn</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> arguments<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">function</span> <span class="token function">sayHi</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">\'防抖成功\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">var</span> inp <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">\'inp\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\ninp<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">\'input\'</span><span class="token punctuation">,</span> <span class="token function">debounce</span><span class="token punctuation">(</span>sayHi<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 防抖</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h1 id="节流"><a href="#%E8%8A%82%E6%B5%81" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>节流</h1>\n<p>高频事件触发，但在 n 秒内只会执行一次，所以节流会稀释函数的执行频率</p>\n<h2 id="思路：-1"><a href="#%E6%80%9D%E8%B7%AF%EF%BC%9A-1" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>思路：</h2>\n<p>每次触发事件时都判断当前是否有等待执行的延时函数</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="49205668397259350000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`function throttle(fn) {\n  let canRun = true; // 通过闭包保存一个标记\n  return function() {\n    if (!canRun) return; // 在函数开头判断标记是否为 true，不为 true 则 return\n    canRun = false; // 立即设置为 false\n    setTimeout(() => {\n      // 将外部传入的函数的执行放在 setTimeout 中\n      fn.apply(this, arguments);\n      // 最后在 setTimeout 执行完毕后再把标记设置为 true(关键) 表示可以执行下一次循环了\n      // 当定时器没有执行的时候标记永远是 false，在开头被 return 掉\n      canRun = true;\n    }, 500);\n  };\n}\n\nfunction sayHi(e) {\n  console.log(e.target.innerWidth, e.target.innerHeight);\n}\n\nwindow.addEventListener(\'resize\', throttle(sayHi));`, `49205668397259350000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                js 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">function</span> <span class="token function">throttle</span><span class="token punctuation">(</span><span class="token parameter">fn</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">let</span> canRun <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span> <span class="token comment">// 通过闭包保存一个标记</span>\n  <span class="token keyword">return</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>canRun<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span> <span class="token comment">// 在函数开头判断标记是否为 true，不为 true 则 return</span>\n    canRun <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span> <span class="token comment">// 立即设置为 false</span>\n    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n      <span class="token comment">// 将外部传入的函数的执行放在 setTimeout 中</span>\n      <span class="token function">fn</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> arguments<span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token comment">// 最后在 setTimeout 执行完毕后再把标记设置为 true(关键) 表示可以执行下一次循环了</span>\n      <span class="token comment">// 当定时器没有执行的时候标记永远是 false，在开头被 return 掉</span>\n      canRun <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">function</span> <span class="token function">sayHi</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>innerWidth<span class="token punctuation">,</span> e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>innerHeight<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\nwindow<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">\'resize\'</span><span class="token punctuation">,</span> <span class="token function">throttle</span><span class="token punctuation">(</span>sayHi<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>',id:"/github/workspace/blog/防抖节流的区别与实现/index.md absPath of file >>> MarkdownRemark",timeToRead:1,frontmatter:{date:"2019-07-19 11:31:28",path:"/debounce-throttle-difference-realize/",tags:"前端, JS, 防抖, 节流",title:"防抖节流的区别与实现",draft:null}},{excerpt:"需求背景 在做侧边抽屉时遇到了需要强行撑满剩余高度的情况，左边的外呼结果要强行撑满剩余高度，这考察了等高布局的应用 解决方案 首先明确侧边栏左边 html 的结构，其中 html 采用 react 写法，css 采用 less 写法 table 布局 比较 hack 的方法 margin 与 padding absolute 此方法需要对 html…",html:'<h1 id="需求背景"><a href="#%E9%9C%80%E6%B1%82%E8%83%8C%E6%99%AF" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>需求背景</h1>\n<p>在做侧边抽屉时遇到了需要强行撑满剩余高度的情况，左边的外呼结果要强行撑满剩余高度，这考察了等高布局的应用</p>\n<p>\n  <a\n    class="gatsby-resp-image-link"\n    href="/static/2019-06-20-15-48-45-f87613b3e70991756ee12e62144846b7-055ed.png"\n    style="display: block"\n    target="_blank"\n    rel="noopener"\n  >\n  \n  <span\n    class="gatsby-resp-image-wrapper"\n    style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;"\n  >\n    <span\n      class="gatsby-resp-image-background-image"\n      style="padding-bottom: 105.87570621468927%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAVCAIAAADJt1n/AAAACXBIWXMAAA7DAAAOwwHHb6hkAAACiklEQVQ4y31TTWsUQRCdX+VP8K5B9Gh+g2cPngTx5MmrCuLFkEAIHmTBIDEgHjQoSmKMCe5mP2Z2pqe/qqq7y+qZjURj9lEz9Ez366p6VVXU87ppmhCj2D9IcRkQqaibtm4UYgAxoD9mHbaOHJD/26wD58ADOg9FVc2HwyHIcSI+B6GNdIKYOGXkXynFlIwVFopnCrHQWk+mk2nGrD/TA1Buo0ALoAAgJXFAnCRG8e8LY2xVlXVdt2173rOQvZfwOiAaY5w1uyf4fI8+j1Gr+aysikapyfi0bZVsC1/8hRAkTiFnEnYPgPc+oN/ap/s7cec42J4cQpQtEVziF7K11jmX46QgC+/zCzvPWpsYgCOkSEq1ZVUVQCHlIOWSFCLLF1LMTI/dRRac5ohMPmWDmA2VUpksZR4OR500C+vUTS7HK/XAUUO/ajyemZPSnDYwrKGx2Komk9tWV2UpAesFWi1uEktJOcD3Ga6s8eomr27x7S2+sc5XX/DTjwHaaio5iyqSH/4BQOMZY1ZbIhw18GA3PXqfHr4L97bp7pt453Uc/Aho1bQXjP8HIWepwDG5hA6dppx8L9hZzhfJaUEOVopn7HhuqkaLAn1L5v7Cy8k9JGc5pB2MGzQOObpENntOfalUWZbLyIQiLLz9SdtHYXDgBvtW1oNDOiylw+pqXl9Kdp3a+zO8vsa3NnhlnW9u8LWXfOUJP/5ADFrGa5nnQFhpfHUQxNa+wOY3v/6Vnn2ivVOM6PNILlFbGkyGh4PhKNUzycvkgJg0aW7c5WRpa2X80UQpY/OQAVoPths175eTe7UtThRJcZyVwhk4QzczvshDH+JFsx6lvfvyGo/KeqWdLEz3X5xLTr8Bt9ezefNAny4AAAAASUVORK5CYII=\'); background-size: cover; display: block;"\n    >\n      <img\n        class="gatsby-resp-image-image"\n        style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;"\n        alt="2019 06 20 15 48 45"\n        title=""\n        src="/static/2019-06-20-15-48-45-f87613b3e70991756ee12e62144846b7-fee1c.png"\n        srcset="/static/2019-06-20-15-48-45-f87613b3e70991756ee12e62144846b7-a67b7.png 200w,\n/static/2019-06-20-15-48-45-f87613b3e70991756ee12e62144846b7-0b187.png 400w,\n/static/2019-06-20-15-48-45-f87613b3e70991756ee12e62144846b7-fee1c.png 800w,\n/static/2019-06-20-15-48-45-f87613b3e70991756ee12e62144846b7-055ed.png 885w"\n        sizes="(max-width: 800px) 100vw, 800px"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<h1 id="解决方案"><a href="#%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>解决方案</h1>\n<p>首先明确侧边栏左边 html 的结构，其中 html 采用 react 写法，css 采用 less 写法</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="92636273265060940000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`<div className=&quot;{styles.leftBody}&quot;>\n  <div className=&quot;{styles.leftBodyTop}&quot;></div>\n  <div className=&quot;{styles.leftBodyBottom}&quot;></div>\n</div>`, `92636273265060940000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                html 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="html"><pre style="counter-reset: linenumber NaN" class="language-html line-numbers"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>{styles.leftBody}<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>{styles.leftBodyTop}<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>{styles.leftBodyBottom}<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id="table-布局"><a href="#table-%E5%B8%83%E5%B1%80" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>table 布局</h2>\n<p>比较 hack 的方法</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="79130045437657060000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`.leftBody {\n  display: table;\n\n  .leftBodyTop {\n    background: #fff;\n    display: table-row;\n    height: 0; /* 尽可能的减小高度，即自适应内容 */\n  }\n\n  .leftBodyBottom {\n    background: #fff;\n    display: table-row; /* 占满剩余空间，自适应父类剩余高度 */\n    vertical-align: top; /* 将内容放在顶部 */\n\n    &::before {\n      /* 设置 display：table-row; 时，margin 和 padding 设置会失效，故这里用伪元素代替显示 */\n      content: \'\';\n      display: block;\n      width: 100%;\n      height: 16px;\n      background: #edf0f4;\n    }\n  }\n}`, `79130045437657060000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                css 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">.leftBody</span> <span class="token punctuation">{</span>\n  <span class="token property">display</span><span class="token punctuation">:</span> table<span class="token selector">;\n\n  .leftBodyTop</span> <span class="token punctuation">{</span>\n    <span class="token property">background</span><span class="token punctuation">:</span> #fff<span class="token punctuation">;</span>\n    <span class="token property">display</span><span class="token punctuation">:</span> table-row<span class="token punctuation">;</span>\n    <span class="token property">height</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span> <span class="token comment">/* 尽可能的减小高度，即自适应内容 */</span>\n  <span class="token punctuation">}</span>\n\n  <span class="token selector">.leftBodyBottom</span> <span class="token punctuation">{</span>\n    <span class="token property">background</span><span class="token punctuation">:</span> #fff<span class="token punctuation">;</span>\n    <span class="token property">display</span><span class="token punctuation">:</span> table-row<span class="token punctuation">;</span> <span class="token comment">/* 占满剩余空间，自适应父类剩余高度 */</span>\n    <span class="token property">vertical-align</span><span class="token punctuation">:</span> top<span class="token punctuation">;</span> <span class="token comment">/* 将内容放在顶部 */</span>\n\n    <span class="token selector">&amp;::before</span> <span class="token punctuation">{</span>\n      <span class="token comment">/* 设置 display：table-row; 时，margin 和 padding 设置会失效，故这里用伪元素代替显示 */</span>\n      <span class="token property">content</span><span class="token punctuation">:</span> <span class="token string">\'\'</span><span class="token punctuation">;</span>\n      <span class="token property">display</span><span class="token punctuation">:</span> block<span class="token punctuation">;</span>\n      <span class="token property">width</span><span class="token punctuation">:</span> 100%<span class="token punctuation">;</span>\n      <span class="token property">height</span><span class="token punctuation">:</span> 16px<span class="token punctuation">;</span>\n      <span class="token property">background</span><span class="token punctuation">:</span> #edf0f4<span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id="margin-与-padding"><a href="#margin-%E4%B8%8E-padding" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>margin 与 padding</h2>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="12154116910348157000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`.leftBody {\n  overflow: hidden; /* 必须设置，否则露底 */\n\n  .leftBodyTop {\n    background: #fff;\n  }\n\n  .leftBodyBottom {\n    background: #fff;\n    margin-top: 16px;\n    margin-bottom: -3000px; /* margin 与 padding 相互抵消来撑满剩余高度 */\n    padding-bottom: 3000px;\n  }\n}`, `12154116910348157000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                css 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">.leftBody</span> <span class="token punctuation">{</span>\n  <span class="token property">overflow</span><span class="token punctuation">:</span> hidden<span class="token punctuation">;</span> <span class="token comment">/* 必须设置，否则露底 */</span>\n\n  <span class="token selector">.leftBodyTop</span> <span class="token punctuation">{</span>\n    <span class="token property">background</span><span class="token punctuation">:</span> #fff<span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n\n  <span class="token selector">.leftBodyBottom</span> <span class="token punctuation">{</span>\n    <span class="token property">background</span><span class="token punctuation">:</span> #fff<span class="token punctuation">;</span>\n    <span class="token property">margin-top</span><span class="token punctuation">:</span> 16px<span class="token punctuation">;</span>\n    <span class="token property">margin-bottom</span><span class="token punctuation">:</span> -3000px<span class="token punctuation">;</span> <span class="token comment">/* margin 与 padding 相互抵消来撑满剩余高度 */</span>\n    <span class="token property">padding-bottom</span><span class="token punctuation">:</span> 3000px<span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id="absolute"><a href="#absolute" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>absolute</h2>\n<p>此方法需要对 html 做出改动</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="56923106148929150000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`<div className=&quot;{styles.leftBody}&quot;>\n  <div className=&quot;{styles.leftBodyTop}&quot;></div>\n  <div className=&quot;{styles.leftBodyBottom}&quot;>\n    <div className=&quot;{styles.equalHeight}&quot; />\n    <div className=&quot;{styles.content}&quot;></div>\n  </div>\n</div>`, `56923106148929150000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                html 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="html"><pre style="counter-reset: linenumber NaN" class="language-html line-numbers"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>{styles.leftBody}<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>{styles.leftBodyTop}<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>{styles.leftBodyBottom}<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>{styles.equalHeight}<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>{styles.content}<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>由于绝对定位元素无高度的特性无宽度的特性，我们可以伪造一个高度足够高的绝对定位层（设置背景色，边框等属性），同时设置父标签溢出隐藏，那么其多出来的高度就不会显示了，也就实现了看上去的等高布局效果了</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="38440178975770630000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`.leftBody {\n  overflow: hidden; /* 必须设置，否则露底 */\n\n  .leftBodyTop {\n    background: #fff;\n  }\n\n  .leftBodyBottom {\n    background: #fff;\n    margin-top: 16px;\n    position: relative;\n\n    .equalHeight {\n      background: #fff;\n      width: 100%;\n      height: 999em;\n      position: absolute;\n      left: 0;\n      top: 0;\n    }\n\n    .content {\n      position: relative;\n      z-index: 1; /* 内容必须在上方，否则被 equalHeight 覆盖 */\n    }\n  }\n}`, `38440178975770630000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                css 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">.leftBody</span> <span class="token punctuation">{</span>\n  <span class="token property">overflow</span><span class="token punctuation">:</span> hidden<span class="token punctuation">;</span> <span class="token comment">/* 必须设置，否则露底 */</span>\n\n  <span class="token selector">.leftBodyTop</span> <span class="token punctuation">{</span>\n    <span class="token property">background</span><span class="token punctuation">:</span> #fff<span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n\n  <span class="token selector">.leftBodyBottom</span> <span class="token punctuation">{</span>\n    <span class="token property">background</span><span class="token punctuation">:</span> #fff<span class="token punctuation">;</span>\n    <span class="token property">margin-top</span><span class="token punctuation">:</span> 16px<span class="token punctuation">;</span>\n    <span class="token property">position</span><span class="token punctuation">:</span> relative<span class="token selector">;\n\n    .equalHeight</span> <span class="token punctuation">{</span>\n      <span class="token property">background</span><span class="token punctuation">:</span> #fff<span class="token punctuation">;</span>\n      <span class="token property">width</span><span class="token punctuation">:</span> 100%<span class="token punctuation">;</span>\n      <span class="token property">height</span><span class="token punctuation">:</span> 999em<span class="token punctuation">;</span>\n      <span class="token property">position</span><span class="token punctuation">:</span> absolute<span class="token punctuation">;</span>\n      <span class="token property">left</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>\n      <span class="token property">top</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n\n    <span class="token selector">.content</span> <span class="token punctuation">{</span>\n      <span class="token property">position</span><span class="token punctuation">:</span> relative<span class="token punctuation">;</span>\n      <span class="token property">z-index</span><span class="token punctuation">:</span> 1<span class="token punctuation">;</span> <span class="token comment">/* 内容必须在上方，否则被 equalHeight 覆盖 */</span>\n    <span class="token punctuation">}</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id="flex"><a href="#flex" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>flex</h2>\n<p>代码最简洁</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="12732510769401405000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`.leftBody {\n  display: flex;\n  flex-direction: column;\n\n  .leftBodyTop {\n    background: #fff;\n  }\n\n  .leftBodyBottom {\n    background: #fff;\n    margin-top: 16px;\n    flex: 1;\n  }\n}`, `12732510769401405000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                css 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">.leftBody</span> <span class="token punctuation">{</span>\n  <span class="token property">display</span><span class="token punctuation">:</span> flex<span class="token punctuation">;</span>\n  <span class="token property">flex-direction</span><span class="token punctuation">:</span> column<span class="token selector">;\n\n  .leftBodyTop</span> <span class="token punctuation">{</span>\n    <span class="token property">background</span><span class="token punctuation">:</span> #fff<span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n\n  <span class="token selector">.leftBodyBottom</span> <span class="token punctuation">{</span>\n    <span class="token property">background</span><span class="token punctuation">:</span> #fff<span class="token punctuation">;</span>\n    <span class="token property">margin-top</span><span class="token punctuation">:</span> 16px<span class="token punctuation">;</span>\n    <span class="token property">flex</span><span class="token punctuation">:</span> 1<span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>以上更新于<code class="language-text">2019-6-20 16:39:27</code></p>\n<hr>',
id:"/github/workspace/blog/CSS等高布局的应用/index.md absPath of file >>> MarkdownRemark",timeToRead:2,frontmatter:{date:"2019-06-20 15:45:59",path:"/css-equal-height/",tags:"前端, CSS, 等高布局, 预研",title:"CSS等高布局的应用",draft:null}}],length:131,tag:"前端",pagesSum:27,page:17}}}});