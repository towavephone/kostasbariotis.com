webpackJsonp([21818679219157],{1352:function(n,s){n.exports={data:{site:{siteMetadata:{title:"女王控的博客",description:'前端工程师，黑猫女王控，欢迎勾搭，技术相关<a href="https://github.com/towavephone" target="_blank">@towavephone</a>，QQ闲聊<a href="tencent://AddContact/?fromId=45&fromSubId=1&subcmd=all&uin=634407147&website=www.oicqzone.com">@towave</a>，bili关注<a href="https://space.bilibili.com/11507708#/" target="_blank">@towave</a>',siteUrl:"https://blog.towavephone.com"}}},pathContext:{posts:[{excerpt:"出发点 主要是为了弥补当前 JS 没有标准的缺陷，以达到像 Python、Ruby 和 Java 具备开发大型应用的基础能力。CommonJS API 是以在浏览器环境之外构建 JS 生态系统为目标而产生的项目，比如服务器端 JS 应用程序、命令行工具、桌面图形界面应用程序等。如今，规范涵盖了模块、二进制、Buffer、字符集编码、I/O 流、进程环境、文件系统、套接字，单元测试、Web 服务器网管接口、包管理等。 CommonJS 的模块规范 CommonJS…",html:'<h1 id="出发点"><a href="#%E5%87%BA%E5%8F%91%E7%82%B9" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>出发点</h1>\n<p>主要是为了弥补当前 JS 没有标准的缺陷，以达到像 Python、Ruby 和 Java 具备开发大型应用的基础能力。CommonJS API 是以在浏览器环境之外构建 JS 生态系统为目标而产生的项目，比如服务器端 JS 应用程序、命令行工具、桌面图形界面应用程序等。如今，规范涵盖了模块、二进制、Buffer、字符集编码、I/O 流、进程环境、文件系统、套接字，单元测试、Web 服务器网管接口、包管理等。</p>\n<h1 id="commonjs-的模块规范"><a href="#commonjs-%E7%9A%84%E6%A8%A1%E5%9D%97%E8%A7%84%E8%8C%83" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>CommonJS 的模块规范</h1>\n<p>CommonJS 对模块的定义主要分为模块引用、模块定义和模块标识 3 个部分</p>\n<h2 id="模块引用"><a href="#%E6%A8%A1%E5%9D%97%E5%BC%95%E7%94%A8" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>模块引用</h2>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="3658371190236598000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`var math = require(\'math\');`, `3658371190236598000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                js 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">var</span> math <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'math\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>在 CommonJS 规范中，存在一个<code class="language-text">require()</code>方法，这个方法接收模块标识，一次引入一个模块的 API 到当前上下文中。</p>\n<h2 id="模块定义"><a href="#%E6%A8%A1%E5%9D%97%E5%AE%9A%E4%B9%89" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>模块定义</h2>\n<p>在模块中，上下文提供<code class="language-text">require()</code>方法引入外部模块。对应引入的功能，上下文提供一个<code class="language-text">exports</code>对象导出当前模块的方法或变量，并且它是唯一的导出出口，同时模块中还存在一个<code class="language-text">module</code>对象，它代表的是当前模块，<code class="language-text">exports</code>是<code class="language-text">module</code>的属性。所以，在 Node 中，一个文件就是一个模块，将方法或属性挂载在<code class="language-text">exports</code>对象上作为属性即可定义导出的方式。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="22158351893314544000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// math.js\nexports.add = function() {\n  var sum = 0,\n    i = 0,\n    args = arguments,\n    l = args.length;\n  while (i < 1) {\n    sum += args[i++];\n  }\n  return sum;\n};`, `22158351893314544000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                js 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// math.js</span>\nexports<span class="token punctuation">.</span><span class="token function-variable function">add</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">var</span> sum <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span>\n    i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span>\n    args <span class="token operator">=</span> arguments<span class="token punctuation">,</span>\n    l <span class="token operator">=</span> args<span class="token punctuation">.</span>length<span class="token punctuation">;</span>\n  <span class="token keyword">while</span> <span class="token punctuation">(</span>i <span class="token operator">&lt;</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    sum <span class="token operator">+=</span> args<span class="token punctuation">[</span>i<span class="token operator">++</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n  <span class="token keyword">return</span> sum<span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>在其他文件中，通过<code class="language-text">require()</code>方法引入模块</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="95257708458119050000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// program.js\nvar math = require(\'math\');\nexports.increment = function(val) {\n  return math.add(val, 1);\n};`, `95257708458119050000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                js 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// program.js</span>\n<span class="token keyword">var</span> math <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'math\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\nexports<span class="token punctuation">.</span><span class="token function-variable function">increment</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">val</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">return</span> math<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>val<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id="模块标识"><a href="#%E6%A8%A1%E5%9D%97%E6%A0%87%E8%AF%86" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>模块标识</h2>\n<p>模块标识就是传递给<code class="language-text">require()</code>方法的参数，采用小驼峰命名，或者以<code class="language-text">.</code>、<code class="language-text">..</code>开头的相对路径或绝对路径。它可以不加文件后缀.js。</p>\n<p>\n  <a\n    class="gatsby-resp-image-link"\n    href="/static/2019-09-24-14-41-43-27eea99fa3b798045719775e8a4014b6-bf330.png"\n    style="display: block"\n    target="_blank"\n    rel="noopener"\n  >\n  \n  <span\n    class="gatsby-resp-image-wrapper"\n    style="position: relative; display: block; ; max-width: 347px; margin-left: auto; margin-right: auto;"\n  >\n    <span\n      class="gatsby-resp-image-background-image"\n      style="padding-bottom: 44.38040345821326%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAIAAAC9o5sfAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAA40lEQVQoz42R2wqDMBBE8/9/KCpeQEHxUjXWW9SeZksQ24fOwxIzM5vZVVVVNQxD13Va66eFtjgtjuOgzvPctu3DwsmAKooijmPf98dxFMO+76iv5nVdy7IMwzCKIkcBRUt6TNO0LMts0fe9ayRmKNJBcaARB/RoVNM00HVde56XpqkxhlvioJNsSCUwsizLgiBIkoR0CBS327bRSebhPFrcZuZlKLcdnFgUH0ih4eQ1YlNvsUlrLkBMfcdGQc3znK1I7Nu2MaM+v/Ax88OYhFER8ez3wn6bZY1w6HhWkjPPP+YXWK8JxSBx7JoAAAAASUVORK5CYII=\'); background-size: cover; display: block;"\n    >\n      <img\n        class="gatsby-resp-image-image"\n        style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;"\n        alt="2019 09 24 14 41 43"\n        title=""\n        src="/static/2019-09-24-14-41-43-27eea99fa3b798045719775e8a4014b6-bf330.png"\n        srcset="/static/2019-09-24-14-41-43-27eea99fa3b798045719775e8a4014b6-637d1.png 200w,\n/static/2019-09-24-14-41-43-27eea99fa3b798045719775e8a4014b6-bf330.png 347w"\n        sizes="(max-width: 347px) 100vw, 347px"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<p>CommonJS 对模块的定义意义主要在于将类聚的方法或变量等限定在私有的作用域内，同时支持引入和导出功能以顺畅的连接上下游依赖。</p>\n<ul>\n<li>模块内所有的变量或方法都运行在模块作用域内，不会污染全局作用域</li>\n<li>模块可以多次加载，但每次加载只会运行一次，并将运行结果缓存，以待下次使用，如果想要模块再次运行，则需要清除缓存</li>\n<li>模块加载顺序和代码运行顺序一致</li>\n</ul>\n<p>CommonJS 构建的这套模块导出或引用机制使得用户完全不必考虑变量污染，命名空间等方案与之相比相形见绌。</p>\n<h1 id="module-对象"><a href="#module-%E5%AF%B9%E8%B1%A1" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>module 对象</h1>\n<h2 id="module"><a href="#module" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>module</h2>\n<p>通常一个<code class="language-text">module</code>有以下几个属性</p>\n<ul>\n<li>\n<p>module.id 模块的识别符，通常是带有绝对路径的模块文件名</p>\n</li>\n<li>\n<p>module.filename 模块文件名，带有绝对路径</p>\n</li>\n<li>\n<p>module.loaded 返回一个 boolean 值，标识模块是否已经加载完成</p>\n</li>\n<li>\n<p>module.parent 返回调用该模块的对象</p>\n</li>\n<li>\n<p>module.children 返回该模块调用的其他模块数组</p>\n</li>\n<li>\n<p>module.exports 返回该模块对外的输出</p>\n</li>\n<li>\n<p>module.paths 模块的搜索路径例如：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="42334693094165450000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// math.js\nexports.add = function() {\nvar sum = 0,\n  i = 0,\n  args = arguments,\n  l = args.length;\nwhile (i < 1) {\n  sum += args[i++];\n}\nreturn sum;\n};\nconsole.log(module);`, `42334693094165450000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                js 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// math.js</span>\nexports<span class="token punctuation">.</span><span class="token function-variable function">add</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n<span class="token keyword">var</span> sum <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span>\n  i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span>\n  args <span class="token operator">=</span> arguments<span class="token punctuation">,</span>\n  l <span class="token operator">=</span> args<span class="token punctuation">.</span>length<span class="token punctuation">;</span>\n<span class="token keyword">while</span> <span class="token punctuation">(</span>i <span class="token operator">&lt;</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  sum <span class="token operator">+=</span> args<span class="token punctuation">[</span>i<span class="token operator">++</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n<span class="token keyword">return</span> sum<span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span>\nconsole<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>module<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>它的输出是:</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="54613664266911924000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`Module {\nid: \'/Users/a123/Desktop/Study/wx/server/math.js\',\nexports: { add: [Function] },\nparent:\n Module {\n   id: \'.\',\n   exports: {},\n   parent: null,\n   filename: \'/Users/a123/Desktop/Study/wx/server/app.js\',\n   loaded: false,\n   children: [ [Module], [Module], [Module], [Module], [Module], [Circular] ],\n   paths:\n    [ \'/Users/a123/Desktop/Study/wx/server/node_modules\',\n      \'/Users/a123/Desktop/Study/wx/node_modules\',\n      \'/Users/a123/Desktop/Study/node_modules\',\n      \'/Users/a123/Desktop/node_modules\',\n      \'/Users/a123/node_modules\',\n      \'/Users/node_modules\',\n      \'/node_modules\' ] },\nfilename: \'/Users/a123/Desktop/Study/wx/server/math.js\',\nloaded: false,\nchildren: [],\npaths:\n [ \'/Users/a123/Desktop/Study/wx/server/node_modules\',\n   \'/Users/a123/Desktop/Study/wx/node_modules\',\n   \'/Users/a123/Desktop/Study/node_modules\',\n   \'/Users/a123/Desktop/node_modules\',\n   \'/Users/a123/node_modules\',\n   \'/Users/node_modules\',\n   \'/node_modules\' ] }`, `54613664266911924000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                js 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js">Module <span class="token punctuation">{</span>\nid<span class="token punctuation">:</span> <span class="token string">\'/Users/a123/Desktop/Study/wx/server/math.js\'</span><span class="token punctuation">,</span>\nexports<span class="token punctuation">:</span> <span class="token punctuation">{</span> add<span class="token punctuation">:</span> <span class="token punctuation">[</span>Function<span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>\nparent<span class="token punctuation">:</span>\n Module <span class="token punctuation">{</span>\n   id<span class="token punctuation">:</span> <span class="token string">\'.\'</span><span class="token punctuation">,</span>\n   exports<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>\n   parent<span class="token punctuation">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>\n   filename<span class="token punctuation">:</span> <span class="token string">\'/Users/a123/Desktop/Study/wx/server/app.js\'</span><span class="token punctuation">,</span>\n   loaded<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>\n   children<span class="token punctuation">:</span> <span class="token punctuation">[</span> <span class="token punctuation">[</span>Module<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>Module<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>Module<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>Module<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>Module<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>Circular<span class="token punctuation">]</span> <span class="token punctuation">]</span><span class="token punctuation">,</span>\n   paths<span class="token punctuation">:</span>\n    <span class="token punctuation">[</span> <span class="token string">\'/Users/a123/Desktop/Study/wx/server/node_modules\'</span><span class="token punctuation">,</span>\n      <span class="token string">\'/Users/a123/Desktop/Study/wx/node_modules\'</span><span class="token punctuation">,</span>\n      <span class="token string">\'/Users/a123/Desktop/Study/node_modules\'</span><span class="token punctuation">,</span>\n      <span class="token string">\'/Users/a123/Desktop/node_modules\'</span><span class="token punctuation">,</span>\n      <span class="token string">\'/Users/a123/node_modules\'</span><span class="token punctuation">,</span>\n      <span class="token string">\'/Users/node_modules\'</span><span class="token punctuation">,</span>\n      <span class="token string">\'/node_modules\'</span> <span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>\nfilename<span class="token punctuation">:</span> <span class="token string">\'/Users/a123/Desktop/Study/wx/server/math.js\'</span><span class="token punctuation">,</span>\nloaded<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>\nchildren<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>\npaths<span class="token punctuation">:</span>\n <span class="token punctuation">[</span> <span class="token string">\'/Users/a123/Desktop/Study/wx/server/node_modules\'</span><span class="token punctuation">,</span>\n   <span class="token string">\'/Users/a123/Desktop/Study/wx/node_modules\'</span><span class="token punctuation">,</span>\n   <span class="token string">\'/Users/a123/Desktop/Study/node_modules\'</span><span class="token punctuation">,</span>\n   <span class="token string">\'/Users/a123/Desktop/node_modules\'</span><span class="token punctuation">,</span>\n   <span class="token string">\'/Users/a123/node_modules\'</span><span class="token punctuation">,</span>\n   <span class="token string">\'/Users/node_modules\'</span><span class="token punctuation">,</span>\n   <span class="token string">\'/node_modules\'</span> <span class="token punctuation">]</span> <span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>当 Node.js 直接运行一个文件时，<code class="language-text">require.main</code> 会被设为它的 <code class="language-text">module</code>。 这意味着可以通过 <code class="language-text">require.main === module</code> 来判断一个文件是否被直接运行：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="1139308830863750000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// node app.js\nmath---require.main === module :  false\napp---require.main === module :  true`, `1139308830863750000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                js 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// node app.js</span>\nmath<span class="token operator">--</span><span class="token operator">-</span>require<span class="token punctuation">.</span>main <span class="token operator">===</span> module <span class="token punctuation">:</span>  <span class="token boolean">false</span>\napp<span class="token operator">--</span><span class="token operator">-</span>require<span class="token punctuation">.</span>main <span class="token operator">===</span> module <span class="token punctuation">:</span>  <span class="token boolean">true</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n</li>\n</ul>\n<h2 id="moduleexports"><a href="#moduleexports" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>module.exports</h2>\n<p>module.exports 对象是由模块系统创建的，表示当前文件对外输出的接口。</p>\n<p><strong>注意，对 <code class="language-text">module.exports</code> 的赋值必须立即完成。 不能在任何回调中完成。</strong></p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="11649731918588580000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 创建a.js文件\nconst EventEmitter = require(\'events\');\nmodule.exports = new EventEmitter(); // 赋值\n// 处理一些工作，并在一段时间后从模块自身触发 \'ready\' 事件。\nsetTimeout(() => {\n  module.exports.emit(\'ready\');\n}, 1000);`, `11649731918588580000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                js 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// 创建a.js文件</span>\n<span class="token keyword">const</span> EventEmitter <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'events\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\nmodule<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">EventEmitter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 赋值</span>\n<span class="token comment">// 处理一些工作，并在一段时间后从模块自身触发 \'ready\' 事件。</span>\n<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n  module<span class="token punctuation">.</span>exports<span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">\'ready\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="85229405647143830000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 创建b.js文件\nsetTimeout(() => {\n  module.exports = { a: \'hello\' };\n}, 0);`, `85229405647143830000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                js 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// 创建b.js文件</span>\n<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n  module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span> a<span class="token punctuation">:</span> <span class="token string">\'hello\'</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="97078058680773480000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// app.js 文件中分别调用a、b模块\n\n// 引入a模块\nconst a = require(\'./a\');\na.on(\'ready\', () => {\n  console.log(\'模块 a 已准备好\');\n});\n\n// 引入b模块\nconst b = require(\'./b\');\nconsole.log(b.a);`, `97078058680773480000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                js 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// app.js 文件中分别调用a、b模块</span>\n\n<span class="token comment">// 引入a模块</span>\n<span class="token keyword">const</span> a <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'./a\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\na<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">\'ready\'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">\'模块 a 已准备好\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token comment">// 引入b模块</span>\n<span class="token keyword">const</span> b <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'./b\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\nconsole<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>b<span class="token punctuation">.</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>执行 app.js 结果是：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="32733855808241574000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`undefined\n模块 a 已准备好`, `32733855808241574000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                js 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">undefined</span>\n模块 a 已准备好</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<h2 id="exports"><a href="#exports" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>exports</h2>\n<p><code class="language-text">exports</code> 变量是在模块的文件级别作用域内有效的，它在模块被执行前被赋予 <code class="language-text">module.exports</code> 的值。</p>\n<p>例如： <code class="language-text">module.exports.fun = …</code>，相当于<code class="language-text">exports.fun = ...</code></p>\n<p><strong>但注意，不能将一个值赋值给<code class="language-text">exports</code>，这样它将不在绑定到<code class="language-text">module.exports</code></strong></p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="14221618067242180000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`module.exports.hello = true; // 从对模块的引用中导出\nexports = { hello: false }; // 不导出，只在模块内有效`, `14221618067242180000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                js 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js">module<span class="token punctuation">.</span>exports<span class="token punctuation">.</span>hello <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span> <span class="token comment">// 从对模块的引用中导出</span>\nexports <span class="token operator">=</span> <span class="token punctuation">{</span> hello<span class="token punctuation">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token comment">// 不导出，只在模块内有效</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<h2 id="moduleexports-与-exports"><a href="#moduleexports-%E4%B8%8E-exports" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>module.exports 与 exports</h2>\n<p>在上述介绍中，<code class="language-text">module.exports</code> 与<code class="language-text">exports</code>很容易混淆，下面介绍<code class="language-text">module.exports</code> 与<code class="language-text">exports</code>内部的实现：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="93338943479778180000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 1. 模块引用\nvar module = require(\'./a\');\nmodule.a; // 重要的是 module 这里，module 是 Node 独有的一个变量\n\n// 2. 模块定义\nmodule.exports = {\n  a: 1\n};\n\n// 3.模块内部实现\nfunction require(/* ... */) {\n  const module = {\n    exports: {} // exports 就是一个空对象\n  }(\n    // 这里其实就是包装了一层立即执行函数，这样就不会污染全局变量了\n    (module, exports) => {\n      // 模块代码在这\n      var a = 1; // 如果定义了一个函数。则为 function someFunc() {}\n      exports = a;\n      // 此时，exports 不再是一个 module.exports 的快捷方式，\n      // 且这个模块依然导出一个空的默认对象。\n      module.exports = a; // 这个是为什么 exports 和 module.exports 用法相似的原因\n      // 此时，该模块导出 a，而不是默认对象。\n    }\n  )(module, module.exports);\n  return module.exports;\n}`, `93338943479778180000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                js 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// 1. 模块引用</span>\n<span class="token keyword">var</span> module <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'./a\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\nmodule<span class="token punctuation">.</span>a<span class="token punctuation">;</span> <span class="token comment">// 重要的是 module 这里，module 是 Node 独有的一个变量</span>\n\n<span class="token comment">// 2. 模块定义</span>\nmodule<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>\n  a<span class="token punctuation">:</span> <span class="token number">1</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n<span class="token comment">// 3.模块内部实现</span>\n<span class="token keyword">function</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token comment">/* ... */</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">const</span> module <span class="token operator">=</span> <span class="token punctuation">{</span>\n    exports<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token comment">// exports 就是一个空对象</span>\n  <span class="token punctuation">}</span><span class="token punctuation">(</span>\n    <span class="token comment">// 这里其实就是包装了一层立即执行函数，这样就不会污染全局变量了</span>\n    <span class="token punctuation">(</span><span class="token parameter">module<span class="token punctuation">,</span> exports</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n      <span class="token comment">// 模块代码在这</span>\n      <span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">// 如果定义了一个函数。则为 function someFunc() {}</span>\n      exports <span class="token operator">=</span> a<span class="token punctuation">;</span>\n      <span class="token comment">// 此时，exports 不再是一个 module.exports 的快捷方式，</span>\n      <span class="token comment">// 且这个模块依然导出一个空的默认对象。</span>\n      module<span class="token punctuation">.</span>exports <span class="token operator">=</span> a<span class="token punctuation">;</span> <span class="token comment">// 这个是为什么 exports 和 module.exports 用法相似的原因</span>\n      <span class="token comment">// 此时，该模块导出 a，而不是默认对象。</span>\n    <span class="token punctuation">}</span>\n  <span class="token punctuation">)</span><span class="token punctuation">(</span>module<span class="token punctuation">,</span> module<span class="token punctuation">.</span>exports<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token keyword">return</span> module<span class="token punctuation">.</span>exports<span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id="require"><a href="#require" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>require</h2>\n<p><code class="language-text">require</code>命令的功能是，引入模块。</p>\n<p><code class="language-text">require</code>命令用于加载文件，后缀名默认为<code class="language-text">.js</code>。</p>\n<p><code class="language-text">require</code>的加载顺序是：</p>\n<ul>\n<li>\n<p>以<code class="language-text">/</code>开头，加载绝对路径模块文件</p>\n</li>\n<li>\n<p>以<code class="language-text">./</code>开头，加载相对路径模块文件</p>\n</li>\n<li>\n<p>除以上两种情况外，加载的是一个默认提供的核心模块（位于 Node 的系统安装目录中），或者一个位于各级 node_modules 目录的已安装模块（全局安装或局部安装）。举例来说，脚本/Users/a123/projects/foo.js<code class="language-text">执行了</code>require(‘bar.js’)`命令，Node 会依次搜索以下文件。</p>\n<ul>\n<li>/usr/local/lib/node/bar.js</li>\n<li>/Users/a123/projects/node_modules/bar.js</li>\n<li>/Users/a123/node_modules/bar.js</li>\n<li>/Users/node_modules/bar.js</li>\n<li>/node_modules/bar.js</li>\n</ul>\n</li>\n<li>\n<p>如果指定的模块文件没有发现，Node 会尝试为文件名添加<code class="language-text">.js</code>、<code class="language-text">.json</code>、<code class="language-text">.node</code>后，再去搜索。<code class="language-text">.js</code>件会以文本格式的 JavaScript 脚本文件解析，<code class="language-text">.json</code>文件会以 JSON 格式的文本文件解析，<code class="language-text">.node</code>文件会以编译后的二进制文件解析。</p>\n</li>\n<li>\n<p>如果想得到<code class="language-text">require</code>命令加载的确切文件名，使用<code class="language-text">require.resolve()</code>方法。</p>\n</li>\n</ul>\n<p>通常，我们会把相关的文件放在一个目录里面，便于组织，这就需要给该目录设置一个入口文件，可以让<code class="language-text">require</code>方法通过这个入口文件，加载整个目录，例如<code class="language-text">package.json</code>：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="30699104236133003000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`{\n    &quot;name&quot;: &quot;wx_backend&quot;,\n    &quot;version&quot;: &quot;1.0.0&quot;,\n    &quot;description&quot;: &quot;&quot;,\n    &quot;main&quot;: &quot;app.js&quot;,\n    &quot;scripts&quot;: {\n        &quot;start:node-dev&quot;: &quot;pm2 start process.prod.json --no-daemon  --env development&quot;,\n        &quot;start:node-prod&quot;: &quot;pm2 start process.prod.json --no-daemon  --env production&quot;,\n        &quot;dev&quot;: &quot;nodemon --config nodemon.json app.js&quot;,\n        &quot;initdb&quot;: &quot;npm install && node tools/initdb.js&quot;\n    },\n...\n}`, `30699104236133003000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                js 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token punctuation">{</span>\n    <span class="token string">"name"</span><span class="token punctuation">:</span> <span class="token string">"wx_backend"</span><span class="token punctuation">,</span>\n    <span class="token string">"version"</span><span class="token punctuation">:</span> <span class="token string">"1.0.0"</span><span class="token punctuation">,</span>\n    <span class="token string">"description"</span><span class="token punctuation">:</span> <span class="token string">""</span><span class="token punctuation">,</span>\n    <span class="token string">"main"</span><span class="token punctuation">:</span> <span class="token string">"app.js"</span><span class="token punctuation">,</span>\n    <span class="token string">"scripts"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>\n        <span class="token string">"start:node-dev"</span><span class="token punctuation">:</span> <span class="token string">"pm2 start process.prod.json --no-daemon  --env development"</span><span class="token punctuation">,</span>\n        <span class="token string">"start:node-prod"</span><span class="token punctuation">:</span> <span class="token string">"pm2 start process.prod.json --no-daemon  --env production"</span><span class="token punctuation">,</span>\n        <span class="token string">"dev"</span><span class="token punctuation">:</span> <span class="token string">"nodemon --config nodemon.json app.js"</span><span class="token punctuation">,</span>\n        <span class="token string">"initdb"</span><span class="token punctuation">:</span> <span class="token string">"npm install &amp;&amp; node tools/initdb.js"</span>\n    <span class="token punctuation">}</span><span class="token punctuation">,</span>\n<span class="token operator">...</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p><code class="language-text">require</code>发现参数字符串指向一个目录时，就会自动查看该目录下的<code class="language-text">package.json</code>文件，然后加载<code class="language-text">main</code>指定的入口文件，如果<code class="language-text">package.json</code>中没有<code class="language-text">main</code>字段，或者根本没有<code class="language-text">package.json</code>文件，则会加载该目录下的<code class="language-text">index.js</code>文件或<code class="language-text">index.node</code>文件。</p>\n<p><a href="https://nodejs.org/api/modules.html" target="_blank" rel="nofollow noreferrer noopener">具体可查阅 nodeJS</a></p>\n<h1 id="扩展"><a href="#%E6%89%A9%E5%B1%95" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>扩展</h1>\n<p>前后端 JS 分别搁置在 HTTP 的两端，它们扮演的角色不同，侧重点也不一样。 <strong>浏览器端的 JS 需要经历从一个服务器端分发到多个客户端执行，而服务器端 JS 则是相同的代码需要多次执行。前者的瓶颈在于带宽，后者的瓶颈则在于 CPU 等内存资源。前者需要通过网络加载代码，后者则需要从磁盘中加载，</strong> 两者的加载速度也不是在一个数量级上的。</p>\n<p>纵观 Node 的模块引入过程，几乎全都是同步的，尽管与 Node 强调异步的行为有些相反，但它是合理的，但前端如果也用同步方式引入，试想一下，在 UI 加载的过程中需要花费很多时间来等待脚本加载完成，这会造成用户体验的很大问题。</p>\n<p>鉴于网络的原因， CommonJS 为后端 JS 制定的规范并不完全适合与前端的应用场景，下面来介绍 JS 前端的规范。</p>\n<h2 id="amd"><a href="#amd" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>AMD</h2>\n<p>AMD 是由 RequireJS 提出的，相对于 CommonJS 同步加载来说，AMD 是”Asynchronous Module Definition”（异步模块定义）的缩写。是为浏览器环境专门设计的。</p>\n<p>RequireJS 即为遵循 AMD 规范的模块化工具。 RequireJS 的基本思想是，通过一个函数来将所有所需要的或者说所依赖的模块实现装载进来，然后返回一个新的函数（模块），我们所有的关于新模块的业务代码都在这个函数内部操作，其内部也可无限制的使用已经加载进来的以来的模块。</p>\n<p><strong>define(id?, dependencies?, factory)</strong></p>\n<ul>\n<li>\n<p>id 为字符串类型，表示了模块标识，为可选参数。若不存在则模块标识应该默认定义为在加载器中被请求脚本的标识。如果存在，那么模块标识必须为顶层的或者一个绝对的标识。</p>\n</li>\n<li>\n<p>dependencies ，是一个当前模块依赖的，已被模块定义的模块标识的数组字面量。</p>\n</li>\n<li>\n<p>factory，是一个需要进行实例化的函数或者一个对象。</p>\n</li>\n<li>\n<p>定义模块</p>\n<ul>\n<li>\n<p>定义无依赖模块</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="10860332893422830000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`define({\nsum: function(x, y) {\n return x + y;\n}\n});`, `10860332893422830000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                js 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token function">define</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n<span class="token function-variable function">sum</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">x<span class="token punctuation">,</span> y</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n <span class="token keyword">return</span> x <span class="token operator">+</span> y<span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n</li>\n<li>\n<p>定义有依赖模块</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="49680036779323890000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`define([\'some\'], function(alpha) {\nreturn {\n add: function() {\n   return some.sum() + 1;\n }\n};\n});`, `49680036779323890000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                js 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token function">define</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">\'some\'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">alpha</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n<span class="token keyword">return</span> <span class="token punctuation">{</span>\n <span class="token function-variable function">add</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n   <span class="token keyword">return</span> some<span class="token punctuation">.</span><span class="token function">sum</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>\n <span class="token punctuation">}</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n</li>\n<li>\n<p>定义数据对象模块</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="51774643086604090000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`define({\nadd: [],\nsub: []\n});`, `51774643086604090000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                js 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token function">define</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\nadd<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>\nsub<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n</li>\n<li>\n<p>具名模块</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="17024061517239185000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`define(&quot;alpha&quot;, [ &quot;require&quot;, &quot;exports&quot;, &quot;beta&quot; ], function( require, exports, beta ){\n export.verb = function(){\n     return beta.verb();\n     // or:\n     return require(&quot;beta&quot;).verb();\n }\n});`, `17024061517239185000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                js 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token function">define</span><span class="token punctuation">(</span><span class="token string">"alpha"</span><span class="token punctuation">,</span> <span class="token punctuation">[</span> <span class="token string">"require"</span><span class="token punctuation">,</span> <span class="token string">"exports"</span><span class="token punctuation">,</span> <span class="token string">"beta"</span> <span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span> <span class="token parameter">require<span class="token punctuation">,</span> exports<span class="token punctuation">,</span> beta</span> <span class="token punctuation">)</span><span class="token punctuation">{</span>\n <span class="token keyword">export</span><span class="token punctuation">.</span><span class="token function-variable function">verb</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>\n     <span class="token keyword">return</span> beta<span class="token punctuation">.</span><span class="token function">verb</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n     <span class="token comment">// or:</span>\n     <span class="token keyword">return</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"beta"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">verb</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n <span class="token punctuation">}</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n</li>\n<li>包装模块</li>\n</ul>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="34963207960657550000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`define(function(require, exports, module) {\n  var a = require(\'a\'),\n    b = require(\'b\');\n\n  exports.action = function() {};\n});`, `34963207960657550000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                js 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token function">define</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">require<span class="token punctuation">,</span> exports<span class="token punctuation">,</span> module</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'a\'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n    b <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'b\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n  exports<span class="token punctuation">.</span><span class="token function-variable function">action</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p> 不考虑多了一层函数外，格式和 Node.js 是一样的：使用 require 获取依赖模块，使用 exports 导出 API。除了 define 外，AMD 还保留一个关键字 require。require 作为规范保留的全局标识符，可以实现为 module loader，也可以不实现。</p>\n</li>\n<li>\n<p>模块加载</p>\n<p><strong>require([module], callback)</strong></p>\n<ul>\n<li>[module]：是一个数组，里面的成员就是要加载的模块</li>\n<li>callback：是模块加载完成之后的回调函数</li>\n<li>require 方法允许添加第三个参数，即错误处理的回调函数。</li>\n</ul>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="73734708912234320000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`require([\'math\'], function(math) {\n math.add(2, 3);\n});`, `73734708912234320000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                js 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token function">require</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">\'math\'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">math</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n math<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n</li>\n</ul>\n<h2 id="cmd"><a href="#cmd" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>CMD</h2>\n<p>CMD 的规范由国内的玉伯提出，与 AMD 的区别主要在于 <strong>定义模块与依赖引入</strong> 的部分。</p>\n<ol>\n<li>\n<p>CMD 更接近与 Node 对 CommonJS 规范的定义： <strong>define(factory)</strong></p>\n</li>\n<li>\n<p>在依赖部分，CMD 支持动态引入</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="14803000189289660000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`define(function(require, exports, module) {\n   // 模块内容\n}`, `14803000189289660000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                js 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token function">define</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">require<span class="token punctuation">,</span> exports<span class="token punctuation">,</span> module</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n   <span class="token comment">// 模块内容</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>require、exports、module 通过形参传递给模块，在需要依赖模块时，可以通过 <code class="language-text">require()</code> 引入。</p>\n</li>\n</ol>\n<h2 id="es6-模块化"><a href="#es6-%E6%A8%A1%E5%9D%97%E5%8C%96" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>ES6 模块化</h2>\n<p>ES6 正式提出了内置的模块化语法。</p>\n<p>ES6 的模块自动采用严格模式，不管你有没有在模块头部加上<code class="language-text">&quot;use strict&quot;;</code>。</p>\n<p>模块功能主要由两个命令构成：<code class="language-text">export</code>和<code class="language-text">import</code>。<code class="language-text">export</code>命令用于规定模块的对外接口，<code class="language-text">import</code>命令用于输入其他模块提供的功能。</p>\n<ol>\n<li>\n<p>export</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="44568169726248440000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`//导出变量\nexport var a = 1;\n\n//导出函数\nexport function fun(){\n  ...\n}\n\n//导出类\nexport class Rectangle {\n   ...\n}\n\nfunction fun1() { ... }\nfunction fun2() { ... }\n//导出对象，即导出引用\nexport {fun1 as f1, fun2 as f2} // 重命名模块\n\n// 导出默认值\nexport default function fun3() { ... }\n\n// 错误, 后面不能跟变量声明语句。\nexport default var a = 1\n\n// 正确\nexport default 42`, `44568169726248440000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                js 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">//导出变量</span>\n<span class="token keyword">export</span> <span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>\n\n<span class="token comment">//导出函数</span>\n<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">fun</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>\n  <span class="token operator">...</span>\n<span class="token punctuation">}</span>\n\n<span class="token comment">//导出类</span>\n<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">Rectangle</span> <span class="token punctuation">{</span>\n   <span class="token operator">...</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">function</span> <span class="token function">fun1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token operator">...</span> <span class="token punctuation">}</span>\n<span class="token keyword">function</span> <span class="token function">fun2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token operator">...</span> <span class="token punctuation">}</span>\n<span class="token comment">//导出对象，即导出引用</span>\n<span class="token keyword">export</span> <span class="token punctuation">{</span>fun1 <span class="token keyword">as</span> f1<span class="token punctuation">,</span> fun2 <span class="token keyword">as</span> f2<span class="token punctuation">}</span> <span class="token comment">// 重命名模块</span>\n\n<span class="token comment">// 导出默认值</span>\n<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">fun3</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token operator">...</span> <span class="token punctuation">}</span>\n\n<span class="token comment">// 错误, 后面不能跟变量声明语句。</span>\n<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token number">1</span>\n\n<span class="token comment">// 正确</span>\n<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token number">42</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>另外，<code class="language-text">export</code>语句输出的接口，与其对应的值是动态绑定关系，即通过该接口，可以取到模块内部实时的值。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="87306802952481720000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`export var foo = \'bar\';\nsetTimeout(() => (foo = \'baz\'), 500);`, `87306802952481720000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                js 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">export</span> <span class="token keyword">var</span> foo <span class="token operator">=</span> <span class="token string">\'bar\'</span><span class="token punctuation">;</span>\n<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span>foo <span class="token operator">=</span> <span class="token string">\'baz\'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p>上面代码输出变量<code class="language-text">foo</code>，值为<code class="language-text">bar</code>，500 毫秒之后变成<code class="language-text">baz</code>。</p>\n</li>\n<li>\n<p>import</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="82930691393830600000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 第一组 example.js\nexport default function fun() {\n // 输出\n // ...\n}\n// app.js\nimport fun from \'./example\';\n\n// 第二组 example.js\nexport function fun() {\n // 输出\n // ...\n}\n// app.js\nimport { fun } from \'./example\'; // 输入\n// 或\nimport * as allFun from \'./example\';\n//allFun.fun`, `82930691393830600000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                js 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// 第一组 example.js</span>\n<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">fun</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n <span class="token comment">// 输出</span>\n <span class="token comment">// ...</span>\n<span class="token punctuation">}</span>\n<span class="token comment">// app.js</span>\n<span class="token keyword">import</span> fun <span class="token keyword">from</span> <span class="token string">\'./example\'</span><span class="token punctuation">;</span>\n\n<span class="token comment">// 第二组 example.js</span>\n<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">fun</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n <span class="token comment">// 输出</span>\n <span class="token comment">// ...</span>\n<span class="token punctuation">}</span>\n<span class="token comment">// app.js</span>\n<span class="token keyword">import</span> <span class="token punctuation">{</span> fun <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">\'./example\'</span><span class="token punctuation">;</span> <span class="token comment">// 输入</span>\n<span class="token comment">// 或</span>\n<span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> allFun <span class="token keyword">from</span> <span class="token string">\'./example\'</span><span class="token punctuation">;</span>\n<span class="token comment">//allFun.fun</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p><code class="language-text">export default</code>命令用于指定模块的默认输出。显然，一个模块只能有一个默认输出，因此<code class="language-text">export default</code>命令只能使用一次。所以，<code class="language-text">import</code>命令后面才不用加大括号，因为只可能对应一个方法。本质上，<code class="language-text">export default</code>就是输出一个叫做<code class="language-text">default</code>的变量或方法，然后系统允许你为它取任意名字。所以，下面的写法是有效的。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="41744453386097754000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// modules.js\nfunction fun() {\n ...\n}\nexport {fun as default};\n// 等同于\n// export default fun;\n\n// app.js\nimport { default as fun } from \'./modules\';\n// 等同于\n// import fun from \'modules\';`, `41744453386097754000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                js 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// modules.js</span>\n<span class="token keyword">function</span> <span class="token function">fun</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n <span class="token operator">...</span>\n<span class="token punctuation">}</span>\n<span class="token keyword">export</span> <span class="token punctuation">{</span>fun <span class="token keyword">as</span> <span class="token keyword">default</span><span class="token punctuation">}</span><span class="token punctuation">;</span>\n<span class="token comment">// 等同于</span>\n<span class="token comment">// export default fun;</span>\n\n<span class="token comment">// app.js</span>\n<span class="token keyword">import</span> <span class="token punctuation">{</span> <span class="token keyword">default</span> <span class="token keyword">as</span> fun <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">\'./modules\'</span><span class="token punctuation">;</span>\n<span class="token comment">// 等同于</span>\n<span class="token comment">// import fun from \'modules\';</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n</li>\n<li>\n<p><code class="language-text">CommonJS</code>和 ES6 中模块化的两者区别</p>\n<ul>\n<li>前者支持动态导入，也就是 <code class="language-text">require(${path}/xx.js)</code>，后者目前不支持，但是已有提案</li>\n<li>前者是同步导入，因为用于服务端，文件都在本地，同步导入即使卡住主线程影响也不大。而后者是异步导入，因为用于浏览器，需要下载文件，如果也采用同步导入会对渲染有很大影响</li>\n<li>前者在导出时都是值拷贝，就算导出的值变了，导入的值也不会改变，所以如果想更新值，必须重新导入一次。但是后者采用实时绑定的方式，导入导出的值都指向同一个内存地址，所以导入值会跟随导出值变化</li>\n<li>后者会编译成 <code class="language-text">require/exports</code> 来执行的</li>\n</ul>\n</li>\n</ol>',
id:"/github/workspace/blog/CommonJS规范总结与扩展/index.md absPath of file >>> MarkdownRemark",timeToRead:7,frontmatter:{date:"2019-09-24 14:32:18",path:"/commonjs-summary-extension/",tags:"前端, commonjs",title:"CommonJS规范总结与扩展",draft:null}},{excerpt:"初识 context 在典型的 React 应用中，  数据  是通过 props 属性显式的由父及子进行  传递  的，但这种方式，对于复杂情况（例如，跨多级传递，多个组件共享）来说，是极其繁琐的。 第一种解决方式是：  组件的封装与组合，将组件自身传递下去 在项目中，我们在父层获取数据，不同层级的子组件访问时，我们可以使用  将子组件的公共组件封装，将公共组件传递下去  。例如 这种对组件的  控制反转  减少了在应用中要传递的 props…",html:'<h1 id="初识-context"><a href="#%E5%88%9D%E8%AF%86-context" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>初识 context</h1>\n<p>在典型的 React 应用中， <strong>数据</strong> 是通过 props 属性显式的由父及子进行 <strong>传递</strong> 的，但这种方式，对于复杂情况（例如，跨多级传递，多个组件共享）来说，是极其繁琐的。</p>\n<ul>\n<li>\n<p>第一种解决方式是： <strong>组件的封装与组合，将组件自身传递下去</strong></p>\n<p>在项目中，我们在父层获取数据，不同层级的子组件访问时，我们可以使用 <strong>将子组件的公共组件封装，将公共组件传递下去</strong> 。例如</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="81821425481790900000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`function Page(props) {\n// 你可以传递多个子组件，甚至会为这些子组件（children）封装多个单独的接口（slots）\nconst localeCom = <span>{props.locale}</span>;\nreturn <Content localeCom={localeCom} />;\n} // 这种情况下，只有顶层 Page 才知道 localeCom 的具体实现，实现了组件的控制反转\n\nfunction Content(props) {\nreturn (\n  <div>\n    <FirstComponent localeCom={localeCom} />\n  </div>\n);\n}\n\nclass FirstComponent extends React.Component {\nrender() {\n  return <div>FirstComponent: {this.props.localeCom}</div>;\n}\n}`, `81821425481790900000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                js 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">function</span> <span class="token function">Page</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n<span class="token comment">// 你可以传递多个子组件，甚至会为这些子组件（children）封装多个单独的接口（slots）</span>\n<span class="token keyword">const</span> localeCom <span class="token operator">=</span> <span class="token operator">&lt;</span>span<span class="token operator">></span><span class="token punctuation">{</span>props<span class="token punctuation">.</span>locale<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>span<span class="token operator">></span><span class="token punctuation">;</span>\n<span class="token keyword">return</span> <span class="token operator">&lt;</span>Content localeCom<span class="token operator">=</span><span class="token punctuation">{</span>localeCom<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span> <span class="token comment">// 这种情况下，只有顶层 Page 才知道 localeCom 的具体实现，实现了组件的控制反转</span>\n\n<span class="token keyword">function</span> <span class="token function">Content</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n<span class="token keyword">return</span> <span class="token punctuation">(</span>\n  <span class="token operator">&lt;</span>div<span class="token operator">></span>\n    <span class="token operator">&lt;</span>FirstComponent localeCom<span class="token operator">=</span><span class="token punctuation">{</span>localeCom<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span>\n  <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>\n<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">class</span> <span class="token class-name">FirstComponent</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>\n<span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">return</span> <span class="token operator">&lt;</span>div<span class="token operator">></span>FirstComponent<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>localeCom<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>这种对组件的 <strong>控制反转</strong> 减少了在应用中要传递的 props 数量，这在很多场景下会使得你的 <strong>代码更加干净</strong> ，使你对根组件有更多的把控。但是，这并不适用于每一个场景： <strong>将逻辑提升到组件树的更高层次来处理，会使得这些高层组件变得更复杂，并且会强行将低层组件提到高层实现，这很多时候有违常理</strong>。</p>\n</li>\n<li>\n<p>第二种解决方式是：<strong>context</strong></p>\n<p><strong>context</strong> 提供了一种在 <strong>组件之间共享此类值</strong> 的方式，使得我们无需每层显式添加 props 或传递组件 ，就能够实现在 <strong>组件树中传递数据</strong> 。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="5575630378920326000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// Context 可以让我们无须显式地传遍每一个组件，就能将值深入传递进组件树。\n// 为当前的 locale 创建一个 context（默认值为 anan）。\n// context 会在每一个创建或使用 context 的组件上引入，所以，最好在单独一个文件中定义\n// 这里只做演示\nconst LocaleContext = React.createContext(\'anan\');\n\nclass App extends React.Component {\nrender() {\n  // 使用一个 Provider 来将当前的 name 传递给以下的组件树。\n  // 无论多深，任何组件都能读取这个值。\n  // 在这个例子中，我们将 “ananGe” 作为当前的值传递下去。\n  return (\n    // Provider 接收一个 value 属性，传递给消费组件\n    <LocaleContext.Provider value=\'ananGe\'>\n      <Content />\n    </LocaleContext.Provider>\n  );\n}\n}\n\n// 中间的组件再也不必指明往下传递 locale 了。\n// LocaleContext 分别在 FirstComponent 组件与 SecondComponent 的子组件 SubComponent 中使用\nfunction Content(props) {\nreturn (\n  <div>\n    <FirstComponent />\n    <SecondComponent />\n  </div>\n);\n}\n\n// 第一个子组件\nclass FirstComponent extends React.Component {\n// 指定 contextType 读取当前的 locale context。\n// React 会往上找到最近的 locale Provider，然后使用它的值。\n// 在这个例子中，当前的 locale 值为 ananGe\nstatic contextType = LocaleContext;\nrender() {\n  return (\n    <div>\n      FirstComponent: <span>{this.context}</span>\n    </div>\n  );\n}\n}\n\n// 第二个子组件（中间件）\nfunction SecondComponent(props) {\nreturn (\n  <div>\n    <SubComponent />\n  </div>\n);\n}\n// SecondComponent 的子组件\nclass SubComponent extends React.Component {\nstatic contextType = LocaleContext;\nrender() {\n  return (\n    <div>\n      SubComponent: <span>{this.context}</span>\n    </div>\n  ); // this.context 为传递过来的 value 值\n}\n}`, `5575630378920326000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                js 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// Context 可以让我们无须显式地传遍每一个组件，就能将值深入传递进组件树。</span>\n<span class="token comment">// 为当前的 locale 创建一个 context（默认值为 anan）。</span>\n<span class="token comment">// context 会在每一个创建或使用 context 的组件上引入，所以，最好在单独一个文件中定义</span>\n<span class="token comment">// 这里只做演示</span>\n<span class="token keyword">const</span> LocaleContext <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">createContext</span><span class="token punctuation">(</span><span class="token string">\'anan\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token keyword">class</span> <span class="token class-name">App</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>\n<span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token comment">// 使用一个 Provider 来将当前的 name 传递给以下的组件树。</span>\n  <span class="token comment">// 无论多深，任何组件都能读取这个值。</span>\n  <span class="token comment">// 在这个例子中，我们将 “ananGe” 作为当前的值传递下去。</span>\n  <span class="token keyword">return</span> <span class="token punctuation">(</span>\n    <span class="token comment">// Provider 接收一个 value 属性，传递给消费组件</span>\n    <span class="token operator">&lt;</span>LocaleContext<span class="token punctuation">.</span>Provider value<span class="token operator">=</span><span class="token string">\'ananGe\'</span><span class="token operator">></span>\n      <span class="token operator">&lt;</span>Content <span class="token operator">/</span><span class="token operator">></span>\n    <span class="token operator">&lt;</span><span class="token operator">/</span>LocaleContext<span class="token punctuation">.</span>Provider<span class="token operator">></span>\n  <span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n\n<span class="token comment">// 中间的组件再也不必指明往下传递 locale 了。</span>\n<span class="token comment">// LocaleContext 分别在 FirstComponent 组件与 SecondComponent 的子组件 SubComponent 中使用</span>\n<span class="token keyword">function</span> <span class="token function">Content</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n<span class="token keyword">return</span> <span class="token punctuation">(</span>\n  <span class="token operator">&lt;</span>div<span class="token operator">></span>\n    <span class="token operator">&lt;</span>FirstComponent <span class="token operator">/</span><span class="token operator">></span>\n    <span class="token operator">&lt;</span>SecondComponent <span class="token operator">/</span><span class="token operator">></span>\n  <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>\n<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token comment">// 第一个子组件</span>\n<span class="token keyword">class</span> <span class="token class-name">FirstComponent</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>\n<span class="token comment">// 指定 contextType 读取当前的 locale context。</span>\n<span class="token comment">// React 会往上找到最近的 locale Provider，然后使用它的值。</span>\n<span class="token comment">// 在这个例子中，当前的 locale 值为 ananGe</span>\n<span class="token keyword">static</span> contextType <span class="token operator">=</span> LocaleContext<span class="token punctuation">;</span>\n<span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">return</span> <span class="token punctuation">(</span>\n    <span class="token operator">&lt;</span>div<span class="token operator">></span>\n      FirstComponent<span class="token punctuation">:</span> <span class="token operator">&lt;</span>span<span class="token operator">></span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>context<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>span<span class="token operator">></span>\n    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>\n  <span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n\n<span class="token comment">// 第二个子组件（中间件）</span>\n<span class="token keyword">function</span> <span class="token function">SecondComponent</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n<span class="token keyword">return</span> <span class="token punctuation">(</span>\n  <span class="token operator">&lt;</span>div<span class="token operator">></span>\n    <span class="token operator">&lt;</span>SubComponent <span class="token operator">/</span><span class="token operator">></span>\n  <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>\n<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n<span class="token comment">// SecondComponent 的子组件</span>\n<span class="token keyword">class</span> <span class="token class-name">SubComponent</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>\n<span class="token keyword">static</span> contextType <span class="token operator">=</span> LocaleContext<span class="token punctuation">;</span>\n<span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">return</span> <span class="token punctuation">(</span>\n    <span class="token operator">&lt;</span>div<span class="token operator">></span>\n      SubComponent<span class="token punctuation">:</span> <span class="token operator">&lt;</span>span<span class="token operator">></span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>context<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>span<span class="token operator">></span>\n    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>\n  <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// this.context 为传递过来的 value 值</span>\n<span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p><strong>注意：在大多数情况下，context 一般用来做 中间件 的方式使用，例如 redux。</strong></p>\n<ul>\n<li><strong>React.createContext</strong></li>\n</ul>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="36027883278954830000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`const LocaleContext = React.createContext(defaultValue);\n// 创建一个 Context 对象。当 React 渲染一个订阅了这个 Context 对象的组件，这个组件会从组件树中 离自身最近 的那个匹配的 Provider 中读取到当前的 context 值。`, `36027883278954830000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                js 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">const</span> LocaleContext <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">createContext</span><span class="token punctuation">(</span>defaultValue<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token comment">// 创建一个 Context 对象。当 React 渲染一个订阅了这个 Context 对象的组件，这个组件会从组件树中 离自身最近 的那个匹配的 Provider 中读取到当前的 context 值。</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<ul>\n<li><strong>Context.Provider</strong></li>\n</ul>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="49004507836269860000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`<LocaleContext.Provider value={/* 某个值 */}>`, `49004507836269860000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                js 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token operator">&lt;</span>LocaleContext<span class="token punctuation">.</span>Provider value<span class="token operator">=</span><span class="token punctuation">{</span><span class="token comment">/* 某个值 */</span><span class="token punctuation">}</span><span class="token operator">></span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<ul>\n<li>\n<p>Provider 接收一个 <strong>value</strong> 属性，传递给消费组件。</p>\n</li>\n<li>\n<p>一个 Provider 可以和 <strong>多个消费组件</strong> 有对应关系。多个 Provider 可以 <strong>嵌套使用</strong> ，里层的会覆盖外层的数据。</p>\n</li>\n<li>\n<p>当 Provider 的 value 值发生变化时，它内部的所有消费组件都会 <strong>重新渲染</strong> 。</p>\n</li>\n<li>\n<p>Provider 及其内部 consumer 组件都 <strong>不受制于 shouldComponentUpdate</strong> 函数，因此当 consumer 组件在其祖先组件退出更新的情况下也能更新。</p>\n</li>\n<li>\n<p>通过新旧值检测来确定变化，使用了与 <strong>Object.is</strong> （<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object/is" target="_blank" rel="nofollow noreferrer noopener">Object.is MDN</a>） 相同的算法。</p>\n</li>\n<li>\n<p><strong>Class.contextType</strong></p>\n</li>\n</ul>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="78844551169827600000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 挂载在 SubComponent 上的 contextType 属性会被重赋值为 LocaleContext\nSubComponent.contextType = LocaleContext;\n// 使用 this.context 来消费最近 Context 上的那个值\nlet value = this.context;\n\n// 你可以使用这种方式来获取 context value，也可以使用 Context.Consumer 函数式订阅获取`, `78844551169827600000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                js 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// 挂载在 SubComponent 上的 contextType 属性会被重赋值为 LocaleContext</span>\nSubComponent<span class="token punctuation">.</span>contextType <span class="token operator">=</span> LocaleContext<span class="token punctuation">;</span>\n<span class="token comment">// 使用 this.context 来消费最近 Context 上的那个值</span>\n<span class="token keyword">let</span> value <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>context<span class="token punctuation">;</span>\n\n<span class="token comment">// 你可以使用这种方式来获取 context value，也可以使用 Context.Consumer 函数式订阅获取</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<ul>\n<li><strong>Context.Consumer</strong></li>\n</ul>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="78523474741604860000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 在函数式组件中完成订阅 context\n<LocaleContext.Consumer>\n  {value => /* 基于 context 值进行渲染*/}\n</LocaleContext.Consumer>`, `78523474741604860000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                js 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// 在函数式组件中完成订阅 context</span>\n<span class="token operator">&lt;</span>LocaleContext<span class="token punctuation">.</span>Consumer<span class="token operator">></span>\n  <span class="token punctuation">{</span><span class="token parameter">value</span> <span class="token operator">=></span> <span class="token comment">/* 基于 context 值进行渲染*/</span><span class="token punctuation">}</span>\n<span class="token operator">&lt;</span><span class="token operator">/</span>LocaleContext<span class="token punctuation">.</span>Consumer<span class="token operator">></span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n</li>\n</ul>\n<h1 id="深入-context"><a href="#%E6%B7%B1%E5%85%A5-context" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>深入 context</h1>\n<ul>\n<li>当 Provider 的 value 值发生变化时，它内部的所有消费组件都会 <strong>重新渲染</strong></li>\n<li>当需要在 <strong>Consumer 中触发 Provider 执行更新 context value 操作</strong> 时，可以通过 context 传递一个 <strong>函数</strong> ，使得 consumer 组件触发更新 context</li>\n<li>多个 context 可以 <strong>嵌套使用</strong></li>\n<li>注意： <strong>不要在 Provider value 直接赋值</strong> （<code class="language-text">&lt;LocaleProvider.Provider value={{name: &#39;AnGe&#39;}}&gt;</code>），因为这样会导致，每次 Provider 的父组件进行重渲染时，都会导致 Consumer 组件中重新渲染，因为 <code class="language-text">value</code> 属性总是被赋值为新的对象（Object.is 新旧值检测）</li>\n</ul>\n<p><strong>locale-context.js</strong></p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="13330338920777996000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`export const locales = {\n  An: {\n    name: \'an\',\n    color: \'red\'\n  },\n  AnGe: {\n    name: \'anGe\',\n    color: \'green\'\n  }\n};\n\nexport const LocaleContext = React.createContext(\n  locales.An // 默认值\n);\n\n// 确保传递给 createContext 的默认值数据结构是调用的组件（consumers）所能匹配的！\nexport const AddressContext = React.createContext({\n  address: \'Shanghai\',\n  updateAddress: () => {} // Consumer 更新 Provider value 函数\n});`, `13330338920777996000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                js 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">export</span> <span class="token keyword">const</span> locales <span class="token operator">=</span> <span class="token punctuation">{</span>\n  An<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n    name<span class="token punctuation">:</span> <span class="token string">\'an\'</span><span class="token punctuation">,</span>\n    color<span class="token punctuation">:</span> <span class="token string">\'red\'</span>\n  <span class="token punctuation">}</span><span class="token punctuation">,</span>\n  AnGe<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n    name<span class="token punctuation">:</span> <span class="token string">\'anGe\'</span><span class="token punctuation">,</span>\n    color<span class="token punctuation">:</span> <span class="token string">\'green\'</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n<span class="token keyword">export</span> <span class="token keyword">const</span> LocaleContext <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">createContext</span><span class="token punctuation">(</span>\n  locales<span class="token punctuation">.</span>An <span class="token comment">// 默认值</span>\n<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token comment">// 确保传递给 createContext 的默认值数据结构是调用的组件（consumers）所能匹配的！</span>\n<span class="token keyword">export</span> <span class="token keyword">const</span> AddressContext <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">createContext</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n  address<span class="token punctuation">:</span> <span class="token string">\'Shanghai\'</span><span class="token punctuation">,</span>\n  <span class="token function-variable function">updateAddress</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token comment">// Consumer 更新 Provider value 函数</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p><strong>app.js</strong></p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="15979614195318393000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`import { locales, LocaleContext, AddressContext } from \'./locale-context\';\nimport SubComponent from \'./SubComponent\';\n\nclass App extends React.Component {\n  state = {\n    locale: locales.An,\n    address: \'Beijing\'\n  };\n  // 更新 locale 函数\n  changePerson = () => {\n    this.setState((state) => ({\n      locale: state.locale === locales.An ? locales.AnGe : locales.An\n    }));\n  };\n  // 更新 address 函数\n  updateAddress = () => {\n    this.setState((state) => ({\n      address: state.address === \'Beijing\' ? \'Shanghai\' : \'Beijing\'\n    }));\n  };\n\n  render() {\n    const { locale, address } = this.state;\n\n    // addressValue 包含了 updateAddress 更新函数\n    const addressValue = {\n      address: \'Beijing\',\n      updateAddress: this.updateAddress\n    };\n    return (\n      <div>\n        // 在 LocaleProvider 内部的 SubComponent 组件使用 state 中的 locale 值 // 当 LocaleProvider 的 value\n        值发生变化时，它内部的所有消费组件都会重新渲染\n        <LocaleProvider.Provider value={locale}>\n          // addressValue 都被传递进 AddressContext.Provider\n          <AddressContext.Provider value={addressValue}>\n            <Toolbar changePerson={this.changePerson} />\n          </AddressContext.Provider>\n        </LocaleProvider.Provider>\n        // 而外部的组件，没有被 LocaleProvider.Provider 包裹，则使用默认的 locale 值\n        <div>\n          <SubComponent />\n        </div>\n      </div>\n    );\n  }\n}\n\n// 一个使用 SubComponent 的中间组件\nfunction Toolbar(props) {\n  return <SubComponent onClick={props.changePerson}>Change Person</SubComponent>;\n}\n\nReactDOM.render(<App />, document.root);`, `15979614195318393000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                js 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">import</span> <span class="token punctuation">{</span> locales<span class="token punctuation">,</span> LocaleContext<span class="token punctuation">,</span> AddressContext <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">\'./locale-context\'</span><span class="token punctuation">;</span>\n<span class="token keyword">import</span> SubComponent <span class="token keyword">from</span> <span class="token string">\'./SubComponent\'</span><span class="token punctuation">;</span>\n\n<span class="token keyword">class</span> <span class="token class-name">App</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>\n  state <span class="token operator">=</span> <span class="token punctuation">{</span>\n    locale<span class="token punctuation">:</span> locales<span class="token punctuation">.</span>An<span class="token punctuation">,</span>\n    address<span class="token punctuation">:</span> <span class="token string">\'Beijing\'</span>\n  <span class="token punctuation">}</span><span class="token punctuation">;</span>\n  <span class="token comment">// 更新 locale 函数</span>\n  <span class="token function-variable function">changePerson</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">state</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">{</span>\n      locale<span class="token punctuation">:</span> state<span class="token punctuation">.</span>locale <span class="token operator">===</span> locales<span class="token punctuation">.</span>An <span class="token operator">?</span> locales<span class="token punctuation">.</span>AnGe <span class="token punctuation">:</span> locales<span class="token punctuation">.</span>An\n    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span><span class="token punctuation">;</span>\n  <span class="token comment">// 更新 address 函数</span>\n  <span class="token function-variable function">updateAddress</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">state</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">{</span>\n      address<span class="token punctuation">:</span> state<span class="token punctuation">.</span>address <span class="token operator">===</span> <span class="token string">\'Beijing\'</span> <span class="token operator">?</span> <span class="token string">\'Shanghai\'</span> <span class="token punctuation">:</span> <span class="token string">\'Beijing\'</span>\n    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">const</span> <span class="token punctuation">{</span> locale<span class="token punctuation">,</span> address <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">;</span>\n\n    <span class="token comment">// addressValue 包含了 updateAddress 更新函数</span>\n    <span class="token keyword">const</span> addressValue <span class="token operator">=</span> <span class="token punctuation">{</span>\n      address<span class="token punctuation">:</span> <span class="token string">\'Beijing\'</span><span class="token punctuation">,</span>\n      updateAddress<span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>updateAddress\n    <span class="token punctuation">}</span><span class="token punctuation">;</span>\n    <span class="token keyword">return</span> <span class="token punctuation">(</span>\n      <span class="token operator">&lt;</span>div<span class="token operator">></span>\n        <span class="token comment">// 在 LocaleProvider 内部的 SubComponent 组件使用 state 中的 locale 值 // 当 LocaleProvider 的 value</span>\n        值发生变化时，它内部的所有消费组件都会重新渲染\n        <span class="token operator">&lt;</span>LocaleProvider<span class="token punctuation">.</span>Provider value<span class="token operator">=</span><span class="token punctuation">{</span>locale<span class="token punctuation">}</span><span class="token operator">></span>\n          <span class="token comment">// addressValue 都被传递进 AddressContext.Provider</span>\n          <span class="token operator">&lt;</span>AddressContext<span class="token punctuation">.</span>Provider value<span class="token operator">=</span><span class="token punctuation">{</span>addressValue<span class="token punctuation">}</span><span class="token operator">></span>\n            <span class="token operator">&lt;</span>Toolbar changePerson<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>changePerson<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span>\n          <span class="token operator">&lt;</span><span class="token operator">/</span>AddressContext<span class="token punctuation">.</span>Provider<span class="token operator">></span>\n        <span class="token operator">&lt;</span><span class="token operator">/</span>LocaleProvider<span class="token punctuation">.</span>Provider<span class="token operator">></span>\n        <span class="token comment">// 而外部的组件，没有被 LocaleProvider.Provider 包裹，则使用默认的 locale 值</span>\n        <span class="token operator">&lt;</span>div<span class="token operator">></span>\n          <span class="token operator">&lt;</span>SubComponent <span class="token operator">/</span><span class="token operator">></span>\n        <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>\n      <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>\n    <span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n\n<span class="token comment">// 一个使用 SubComponent 的中间组件</span>\n<span class="token keyword">function</span> <span class="token function">Toolbar</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">return</span> <span class="token operator">&lt;</span>SubComponent onClick<span class="token operator">=</span><span class="token punctuation">{</span>props<span class="token punctuation">.</span>changePerson<span class="token punctuation">}</span><span class="token operator">></span>Change Person<span class="token operator">&lt;</span><span class="token operator">/</span>SubComponent<span class="token operator">></span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\nReactDOM<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token operator">&lt;</span>App <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">,</span> document<span class="token punctuation">.</span>root<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p><strong>SubComponent.js</strong></p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="61485071189755350000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`import { LocaleContext, AddressContext } from \'./locale-context\';\n\nclass SubComponent extends React.Component {\n  render() {\n    const props = this.props;\n    return (\n      // 一个组件可能会消费多个 context\n      <LocaleContext.Consumer>\n        {(locale) => (\n          <div {...props} style={{ color: locale.color }}>\n            {locale.name}\n            <AddressContext.Consumer>\n              {\' \'}\n              // AddressContext.Consumer 可以从 context 中获取到 address 值 与 updateAddress 函数\n              {(\n                address,\n                updateAddress // 点击 button，执行 AddressContext.Provider 的 updateAddress 函数，更新 address\n              ) => <button onClick={updateAddress}>{address}</button>}\n            </AddressContext.Consumer>\n          </div>\n        )}\n      </LocaleContext.Consumer>\n    );\n  }\n}\n\nexport default SubComponent;`, `61485071189755350000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                js 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">import</span> <span class="token punctuation">{</span> LocaleContext<span class="token punctuation">,</span> AddressContext <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">\'./locale-context\'</span><span class="token punctuation">;</span>\n\n<span class="token keyword">class</span> <span class="token class-name">SubComponent</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>\n  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">const</span> props <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">;</span>\n    <span class="token keyword">return</span> <span class="token punctuation">(</span>\n      <span class="token comment">// 一个组件可能会消费多个 context</span>\n      <span class="token operator">&lt;</span>LocaleContext<span class="token punctuation">.</span>Consumer<span class="token operator">></span>\n        <span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token parameter">locale</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span>\n          <span class="token operator">&lt;</span>div <span class="token punctuation">{</span><span class="token operator">...</span>props<span class="token punctuation">}</span> style<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span> color<span class="token punctuation">:</span> locale<span class="token punctuation">.</span>color <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">></span>\n            <span class="token punctuation">{</span>locale<span class="token punctuation">.</span>name<span class="token punctuation">}</span>\n            <span class="token operator">&lt;</span>AddressContext<span class="token punctuation">.</span>Consumer<span class="token operator">></span>\n              <span class="token punctuation">{</span><span class="token string">\' \'</span><span class="token punctuation">}</span>\n              <span class="token comment">// AddressContext.Consumer 可以从 context 中获取到 address 值 与 updateAddress 函数</span>\n              <span class="token punctuation">{</span><span class="token punctuation">(</span>\n                address<span class="token punctuation">,</span>\n                updateAddress <span class="token comment">// 点击 button，执行 AddressContext.Provider 的 updateAddress 函数，更新 address</span>\n              <span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span>updateAddress<span class="token punctuation">}</span><span class="token operator">></span><span class="token punctuation">{</span>address<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">></span><span class="token punctuation">}</span>\n            <span class="token operator">&lt;</span><span class="token operator">/</span>AddressContext<span class="token punctuation">.</span>Consumer<span class="token operator">></span>\n          <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>\n        <span class="token punctuation">)</span><span class="token punctuation">}</span>\n      <span class="token operator">&lt;</span><span class="token operator">/</span>LocaleContext<span class="token punctuation">.</span>Consumer<span class="token operator">></span>\n    <span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">export</span> <span class="token keyword">default</span> SubComponent<span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h1 id="源码解读"><a href="#%E6%BA%90%E7%A0%81%E8%A7%A3%E8%AF%BB" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>源码解读</h1>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="66635725631194060000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`export function createContext<T>(\n  defaultValue: T, // context 默认值\n  calculateChangedBits: ?(a: T, b: T) => number // 计算新老 context 变化函数\n): ReactContext<T> {\n  if (calculateChangedBits === undefined) {\n    calculateChangedBits = null;\n  } else {\n    if (__DEV__) {\n      warningWithoutStack(\n        calculateChangedBits === null || typeof calculateChangedBits === \'function\',\n        \'createContext: Expected the optional second argument to be a \' + \'function. Instead received: %s\',\n        calculateChangedBits\n      );\n    }\n  }\n\n  // 声明了一个 context 对象\n  const context: ReactContext<T> = {\n    \\$\\$typeof: REACT_CONTEXT_TYPE,\n    _calculateChangedBits: calculateChangedBits,\n    // As a workaround to support multiple concurrent renderers, we categorize\n    // some renderers as primary and others as secondary. We only expect\n    // there to be two concurrent renderers at most: React Native (primary) and\n    // Fabric (secondary); React DOM (primary) and React ART (secondary).\n    // Secondary renderers store their context values on separate fields.\n    _currentValue: defaultValue, // 用来记录 context 最新值，当 Provider value 更新时，同步到 _currentValue 上\n    _currentValue2: defaultValue,\n    // Used to track how many concurrent renderers this context currently\n    // supports within in a single renderer. Such as parallel server rendering.\n    _threadCount: 0,\n    // These are circular\n    Provider: (null: any), // context Provider\n    Consumer: (null: any) // context Consumer\n  };\n\n  context.Provider = {\n    // context.Provider 的 _context 为 context\n    \\$\\$typeof: REACT_PROVIDER_TYPE,\n    _context: context\n  };\n\n  let hasWarnedAboutUsingNestedContextConsumers = false;\n  let hasWarnedAboutUsingConsumerProvider = false;\n\n  if (__DEV__) {\n    // A separate object, but proxies back to the original context object for\n    // backwards compatibility. It has a different \\$\\$typeof, so we can properly\n    // warn for the incorrect usage of Context as a Consumer.\n    const Consumer = {\n      //Consumer 的 _context 也为 context\n      \\$\\$typeof: REACT_CONTEXT_TYPE,\n      _context: context,\n      _calculateChangedBits: context._calculateChangedBits\n    };\n    // \\$FlowFixMe: Flow complains about not setting a value, which is intentional here\n    Object.defineProperties(Consumer, {\n      Provider: {\n        get() {\n          if (!hasWarnedAboutUsingConsumerProvider) {\n            hasWarnedAboutUsingConsumerProvider = true;\n            warning(\n              false,\n              \'Rendering <Context.Consumer.Provider> is not supported and will be removed in \' +\n                \'a future major release. Did you mean to render <Context.Provider> instead?\'\n            );\n          }\n          return context.Provider;\n        },\n        set(_Provider) {\n          context.Provider = _Provider;\n        }\n      },\n      _currentValue: {\n        get() {\n          return context._currentValue;\n        },\n        set(_currentValue) {\n          context._currentValue = _currentValue;\n        }\n      },\n      _currentValue2: {\n        get() {\n          return context._currentValue2;\n        },\n        set(_currentValue2) {\n          context._currentValue2 = _currentValue2;\n        }\n      },\n      _threadCount: {\n        get() {\n          return context._threadCount;\n        },\n        set(_threadCount) {\n          context._threadCount = _threadCount;\n        }\n      },\n      Consumer: {\n        get() {\n          if (!hasWarnedAboutUsingNestedContextConsumers) {\n            hasWarnedAboutUsingNestedContextConsumers = true;\n            warning(\n              false,\n              \'Rendering <Context.Consumer.Consumer> is not supported and will be removed in \' +\n                \'a future major release. Did you mean to render <Context.Consumer> instead?\'\n            );\n          }\n          return context.Consumer;\n        }\n      }\n    });\n    // \\$FlowFixMe: Flow complains about missing properties because it doesn\'t understand defineProperty\n    context.Consumer = Consumer;\n  } else {\n    context.Consumer = context;\n  }\n  // Provider 与 Consumer 均指向 context，也就是说，Provider 与 Consumer 使用同一个变量 _currentValue，当 Consumer 需要渲染时，直接从自身取得 context 最新值 _currentValue 去渲染\n  if (__DEV__) {\n    context._currentRenderer = null;\n    context._currentRenderer2 = null;\n  }\n\n  return context;\n}`, `66635725631194060000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                js 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">export</span> <span class="token keyword">function</span> createContext<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span><span class="token punctuation">(</span>\n  defaultValue<span class="token punctuation">:</span> <span class="token constant">T</span><span class="token punctuation">,</span> <span class="token comment">// context 默认值</span>\n  calculateChangedBits<span class="token punctuation">:</span> <span class="token operator">?</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">:</span> <span class="token constant">T</span><span class="token punctuation">,</span> b<span class="token punctuation">:</span> <span class="token constant">T</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> number <span class="token comment">// 计算新老 context 变化函数</span>\n<span class="token punctuation">)</span><span class="token punctuation">:</span> ReactContext<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span> <span class="token punctuation">{</span>\n  <span class="token keyword">if</span> <span class="token punctuation">(</span>calculateChangedBits <span class="token operator">===</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    calculateChangedBits <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>\n    <span class="token keyword">if</span> <span class="token punctuation">(</span>__DEV__<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token function">warningWithoutStack</span><span class="token punctuation">(</span>\n        calculateChangedBits <span class="token operator">===</span> <span class="token keyword">null</span> <span class="token operator">||</span> <span class="token keyword">typeof</span> calculateChangedBits <span class="token operator">===</span> <span class="token string">\'function\'</span><span class="token punctuation">,</span>\n        <span class="token string">\'createContext: Expected the optional second argument to be a \'</span> <span class="token operator">+</span> <span class="token string">\'function. Instead received: %s\'</span><span class="token punctuation">,</span>\n        calculateChangedBits\n      <span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n  <span class="token punctuation">}</span>\n\n  <span class="token comment">// 声明了一个 context 对象</span>\n  <span class="token keyword">const</span> context<span class="token punctuation">:</span> ReactContext<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span> <span class="token operator">=</span> <span class="token punctuation">{</span>\n    $$<span class="token keyword">typeof</span><span class="token punctuation">:</span> <span class="token constant">REACT_CONTEXT_TYPE</span><span class="token punctuation">,</span>\n    _calculateChangedBits<span class="token punctuation">:</span> calculateChangedBits<span class="token punctuation">,</span>\n    <span class="token comment">// As a workaround to support multiple concurrent renderers, we categorize</span>\n    <span class="token comment">// some renderers as primary and others as secondary. We only expect</span>\n    <span class="token comment">// there to be two concurrent renderers at most: React Native (primary) and</span>\n    <span class="token comment">// Fabric (secondary); React DOM (primary) and React ART (secondary).</span>\n    <span class="token comment">// Secondary renderers store their context values on separate fields.</span>\n    _currentValue<span class="token punctuation">:</span> defaultValue<span class="token punctuation">,</span> <span class="token comment">// 用来记录 context 最新值，当 Provider value 更新时，同步到 _currentValue 上</span>\n    _currentValue2<span class="token punctuation">:</span> defaultValue<span class="token punctuation">,</span>\n    <span class="token comment">// Used to track how many concurrent renderers this context currently</span>\n    <span class="token comment">// supports within in a single renderer. Such as parallel server rendering.</span>\n    _threadCount<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span>\n    <span class="token comment">// These are circular</span>\n    Provider<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">:</span> any<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// context Provider</span>\n    Consumer<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">:</span> any<span class="token punctuation">)</span> <span class="token comment">// context Consumer</span>\n  <span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n  context<span class="token punctuation">.</span>Provider <span class="token operator">=</span> <span class="token punctuation">{</span>\n    <span class="token comment">// context.Provider 的 _context 为 context</span>\n    $$<span class="token keyword">typeof</span><span class="token punctuation">:</span> <span class="token constant">REACT_PROVIDER_TYPE</span><span class="token punctuation">,</span>\n    _context<span class="token punctuation">:</span> context\n  <span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n  <span class="token keyword">let</span> hasWarnedAboutUsingNestedContextConsumers <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>\n  <span class="token keyword">let</span> hasWarnedAboutUsingConsumerProvider <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>\n\n  <span class="token keyword">if</span> <span class="token punctuation">(</span>__DEV__<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token comment">// A separate object, but proxies back to the original context object for</span>\n    <span class="token comment">// backwards compatibility. It has a different $$typeof, so we can properly</span>\n    <span class="token comment">// warn for the incorrect usage of Context as a Consumer.</span>\n    <span class="token keyword">const</span> Consumer <span class="token operator">=</span> <span class="token punctuation">{</span>\n      <span class="token comment">//Consumer 的 _context 也为 context</span>\n      $$<span class="token keyword">typeof</span><span class="token punctuation">:</span> <span class="token constant">REACT_CONTEXT_TYPE</span><span class="token punctuation">,</span>\n      _context<span class="token punctuation">:</span> context<span class="token punctuation">,</span>\n      _calculateChangedBits<span class="token punctuation">:</span> context<span class="token punctuation">.</span>_calculateChangedBits\n    <span class="token punctuation">}</span><span class="token punctuation">;</span>\n    <span class="token comment">// $FlowFixMe: Flow complains about not setting a value, which is intentional here</span>\n    Object<span class="token punctuation">.</span><span class="token function">defineProperties</span><span class="token punctuation">(</span>Consumer<span class="token punctuation">,</span> <span class="token punctuation">{</span>\n      Provider<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n        <span class="token keyword">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n          <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>hasWarnedAboutUsingConsumerProvider<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n            hasWarnedAboutUsingConsumerProvider <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>\n            <span class="token function">warning</span><span class="token punctuation">(</span>\n              <span class="token boolean">false</span><span class="token punctuation">,</span>\n              <span class="token string">\'Rendering &lt;Context.Consumer.Provider> is not supported and will be removed in \'</span> <span class="token operator">+</span>\n                <span class="token string">\'a future major release. Did you mean to render &lt;Context.Provider> instead?\'</span>\n            <span class="token punctuation">)</span><span class="token punctuation">;</span>\n          <span class="token punctuation">}</span>\n          <span class="token keyword">return</span> context<span class="token punctuation">.</span>Provider<span class="token punctuation">;</span>\n        <span class="token punctuation">}</span><span class="token punctuation">,</span>\n        <span class="token keyword">set</span><span class="token punctuation">(</span>_Provider<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n          context<span class="token punctuation">.</span>Provider <span class="token operator">=</span> _Provider<span class="token punctuation">;</span>\n        <span class="token punctuation">}</span>\n      <span class="token punctuation">}</span><span class="token punctuation">,</span>\n      _currentValue<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n        <span class="token keyword">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n          <span class="token keyword">return</span> context<span class="token punctuation">.</span>_currentValue<span class="token punctuation">;</span>\n        <span class="token punctuation">}</span><span class="token punctuation">,</span>\n        <span class="token keyword">set</span><span class="token punctuation">(</span>_currentValue<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n          context<span class="token punctuation">.</span>_currentValue <span class="token operator">=</span> _currentValue<span class="token punctuation">;</span>\n        <span class="token punctuation">}</span>\n      <span class="token punctuation">}</span><span class="token punctuation">,</span>\n      _currentValue2<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n        <span class="token keyword">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n          <span class="token keyword">return</span> context<span class="token punctuation">.</span>_currentValue2<span class="token punctuation">;</span>\n        <span class="token punctuation">}</span><span class="token punctuation">,</span>\n        <span class="token keyword">set</span><span class="token punctuation">(</span>_currentValue2<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n          context<span class="token punctuation">.</span>_currentValue2 <span class="token operator">=</span> _currentValue2<span class="token punctuation">;</span>\n        <span class="token punctuation">}</span>\n      <span class="token punctuation">}</span><span class="token punctuation">,</span>\n      _threadCount<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n        <span class="token keyword">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n          <span class="token keyword">return</span> context<span class="token punctuation">.</span>_threadCount<span class="token punctuation">;</span>\n        <span class="token punctuation">}</span><span class="token punctuation">,</span>\n        <span class="token keyword">set</span><span class="token punctuation">(</span>_threadCount<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n          context<span class="token punctuation">.</span>_threadCount <span class="token operator">=</span> _threadCount<span class="token punctuation">;</span>\n        <span class="token punctuation">}</span>\n      <span class="token punctuation">}</span><span class="token punctuation">,</span>\n      Consumer<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n        <span class="token keyword">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n          <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>hasWarnedAboutUsingNestedContextConsumers<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n            hasWarnedAboutUsingNestedContextConsumers <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>\n            <span class="token function">warning</span><span class="token punctuation">(</span>\n              <span class="token boolean">false</span><span class="token punctuation">,</span>\n              <span class="token string">\'Rendering &lt;Context.Consumer.Consumer> is not supported and will be removed in \'</span> <span class="token operator">+</span>\n                <span class="token string">\'a future major release. Did you mean to render &lt;Context.Consumer> instead?\'</span>\n            <span class="token punctuation">)</span><span class="token punctuation">;</span>\n          <span class="token punctuation">}</span>\n          <span class="token keyword">return</span> context<span class="token punctuation">.</span>Consumer<span class="token punctuation">;</span>\n        <span class="token punctuation">}</span>\n      <span class="token punctuation">}</span>\n    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token comment">// $FlowFixMe: Flow complains about missing properties because it doesn\'t understand defineProperty</span>\n    context<span class="token punctuation">.</span>Consumer <span class="token operator">=</span> Consumer<span class="token punctuation">;</span>\n  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>\n    context<span class="token punctuation">.</span>Consumer <span class="token operator">=</span> context<span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n  <span class="token comment">// Provider 与 Consumer 均指向 context，也就是说，Provider 与 Consumer 使用同一个变量 _currentValue，当 Consumer 需要渲染时，直接从自身取得 context 最新值 _currentValue 去渲染</span>\n  <span class="token keyword">if</span> <span class="token punctuation">(</span>__DEV__<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    context<span class="token punctuation">.</span>_currentRenderer <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>\n    context<span class="token punctuation">.</span>_currentRenderer2 <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n\n  <span class="token keyword">return</span> context<span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>',
id:"/github/workspace/blog/React之createContext入门学习/index.md absPath of file >>> MarkdownRemark",timeToRead:6,frontmatter:{date:"2019-09-22 01:16:10",path:"/react-createContext-practice-learn/",tags:"前端, React, createContext",title:"React之createContext入门学习",draft:null}},{excerpt:"ES…",html:'<h1 id="es5-继承"><a href="#es5-%E7%BB%A7%E6%89%BF" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>ES5 继承</h1>\n<p>先定义一个父类</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="84950634998720560000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`function SuperType() {\n  // 属性\n  this.name = \'SuperType\';\n}\n// 原型方法\nSuperType.prototype.sayName = function() {\n  return this.name;\n};`, `84950634998720560000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                js 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">function</span> <span class="token function">SuperType</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token comment">// 属性</span>\n  <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">\'SuperType\'</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n<span class="token comment">// 原型方法</span>\n<span class="token class-name">SuperType</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">sayName</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id="原型链继承"><a href="#%E5%8E%9F%E5%9E%8B%E9%93%BE%E7%BB%A7%E6%89%BF" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>原型链继承</h2>\n<p><strong>将父类的实例作为子类的原型</strong></p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="19477100429484140000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 父类\nfunction SuperType() {\n  this.name = \'SuperType\'; // 父类属性\n}\nSuperType.prototype.sayName = function() {\n  // 父类原型方法\n  return this.name;\n};\n\n// 子类\nfunction SubType() {\n  this.subName = \'SubType\'; // 子类属性\n}\n\nSubType.prototype = new SuperType(); // 重写原型对象，代之以一个新类型的实例\n// 这里实例化一个 SuperType 时， 实际上执行了两步\n// 1，新创建的对象复制了父类构造函数内的所有属性及方法\n// 2，并将原型 __proto__ 指向了父类的原型对象\n\nSubType.prototype.saySubName = function() {\n  // 子类原型方法\n  return this.subName;\n};\n\n// 子类实例\nlet instance = new SubType();\n\n// instanceof 通过判断对象的 prototype 链来确定对象是否是某个类的实例\ninstance instanceof SubType; // true\ninstance instanceof SuperType; // true\n\n// 注意\nSubType instanceof SuperType; // false\nSubType.prototype instanceof SuperType; // true`, `19477100429484140000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                js 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// 父类</span>\n<span class="token keyword">function</span> <span class="token function">SuperType</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">\'SuperType\'</span><span class="token punctuation">;</span> <span class="token comment">// 父类属性</span>\n<span class="token punctuation">}</span>\n<span class="token class-name">SuperType</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">sayName</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token comment">// 父类原型方法</span>\n  <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n<span class="token comment">// 子类</span>\n<span class="token keyword">function</span> <span class="token function">SubType</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">this</span><span class="token punctuation">.</span>subName <span class="token operator">=</span> <span class="token string">\'SubType\'</span><span class="token punctuation">;</span> <span class="token comment">// 子类属性</span>\n<span class="token punctuation">}</span>\n\n<span class="token class-name">SubType</span><span class="token punctuation">.</span>prototype <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SuperType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 重写原型对象，代之以一个新类型的实例</span>\n<span class="token comment">// 这里实例化一个 SuperType 时， 实际上执行了两步</span>\n<span class="token comment">// 1，新创建的对象复制了父类构造函数内的所有属性及方法</span>\n<span class="token comment">// 2，并将原型 __proto__ 指向了父类的原型对象</span>\n\n<span class="token class-name">SubType</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">saySubName</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token comment">// 子类原型方法</span>\n  <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>subName<span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n<span class="token comment">// 子类实例</span>\n<span class="token keyword">let</span> instance <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SubType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token comment">// instanceof 通过判断对象的 prototype 链来确定对象是否是某个类的实例</span>\ninstance <span class="token keyword">instanceof</span> <span class="token class-name">SubType</span><span class="token punctuation">;</span> <span class="token comment">// true</span>\ninstance <span class="token keyword">instanceof</span> <span class="token class-name">SuperType</span><span class="token punctuation">;</span> <span class="token comment">// true</span>\n\n<span class="token comment">// 注意</span>\nSubType <span class="token keyword">instanceof</span> <span class="token class-name">SuperType</span><span class="token punctuation">;</span> <span class="token comment">// false</span>\n<span class="token class-name">SubType</span><span class="token punctuation">.</span>prototype <span class="token keyword">instanceof</span> <span class="token class-name">SuperType</span><span class="token punctuation">;</span> <span class="token comment">// true</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>\n  <a\n    class="gatsby-resp-image-link"\n    href="/static/2019-09-21-02-55-32-650497183e53bdda43d578b83b47b2ff-83743.png"\n    style="display: block"\n    target="_blank"\n    rel="noopener"\n  >\n  \n  <span\n    class="gatsby-resp-image-wrapper"\n    style="position: relative; display: block; ; max-width: 738px; margin-left: auto; margin-right: auto;"\n  >\n    <span\n      class="gatsby-resp-image-background-image"\n      style="padding-bottom: 73.71273712737127%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAIAAABr+ngCAAAACXBIWXMAAAsSAAALEgHS3X78AAABv0lEQVQoz4VSi26cMBDk/z+sVZsmpEnJ8cgBBwJjfPgBfnFg6F6inGhF2hGWjFezO7O7nrW2qtGpKCuElmVZP7A4t95+t4ENvGmayrIMD2EUxi1uy6JIogjVtWVMx7FOYpVEjAqu98iQFIqf0y7/esIR4Yx1cUgefRaGknOIOWtnt7i90h6c8TJaYUXeD1helCZFHv30yyhK4ngG8Z/DW99SamHQA26PHQky4T+LrOieniRj74Y/J6+rc46fBT/156gjB9aVQho3KDPN87VVH9gnQ2AE4U3fvhB6pINQvbRGq/V/8N6ErdM80YqRQ0dTKpqBE0mZPHc0y7KqqtI0Ze8WdsjrOs/zaEbLrenspCbBeHjtV4wxNsZwzsdx3CHDnFpCUIObGjPKqwrhhsDaoKa5XC5bqw4G5pYtPKXHU4lfj1leFHlRFlXNhJBKg5Ztkf2GwSAJoc/BS5qfvt/7NWqE6CEXaEmOKdgW/SClhPuXb3cIt9tEHmgDVyDIzTN8cCBmjIV3cATLC0+gFi7Wjn/J8ZRSZd0UCFcNbhkPDlGYvOKWbNXeSi1/wtNa8yDgP+6G4Bd99EHFtdI/t/KG3xqYXbU55onmAAAAAElFTkSuQmCC\'); background-size: cover; display: block;"\n    >\n      <img\n        class="gatsby-resp-image-image"\n        style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;"\n        alt="2019 09 21 02 55 32"\n        title=""\n        src="/static/2019-09-21-02-55-32-650497183e53bdda43d578b83b47b2ff-83743.png"\n        srcset="/static/2019-09-21-02-55-32-650497183e53bdda43d578b83b47b2ff-1800c.png 200w,\n/static/2019-09-21-02-55-32-650497183e53bdda43d578b83b47b2ff-4ad31.png 400w,\n/static/2019-09-21-02-55-32-650497183e53bdda43d578b83b47b2ff-83743.png 738w"\n        sizes="(max-width: 738px) 100vw, 738px"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<ul>\n<li>\n<p><strong>特点</strong>：利用原型，让一个引用类型继承另一个引用类型的属性及方法</p>\n</li>\n<li>\n<p><strong>优点</strong>：<strong>继承了父类的模板，又继承了父类的原型对象</strong></p>\n</li>\n<li>\n<p><strong>缺点</strong>：</p>\n<ul>\n<li>\n<p>可以在子类构造函数中，为子类实例增加实例属性。如果要<strong>新增原型属性和方法</strong>，则必须放在 <code class="language-text">SubType.prototype = new SuperType(&#39;SubType&#39;);</code> 这样的语句<strong>之后</strong>执行。</p>\n</li>\n<li>\n<p>无法实现多继承</p>\n</li>\n<li>\n<p>来自原型对象的所有属性被<strong>所有实例共享</strong></p>\n</li>\n</ul>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="48007346745994090000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 父类\nfunction SuperType() {\n  this.colors = [\'red\', \'blue\', \'green\'];\n  this.name = \'SuperType\';\n}\n// 子类\nfunction SubType() {}\n\n// 原型链继承\nSubType.prototype = new SuperType();\n\n// 实例1\nvar instance1 = new SubType();\ninstance1.colors.push(\'blcak\');\ninstance1.name = \'change-super-type-name\';\nconsole.log(instance1.colors); // [&quot;red&quot;, &quot;blue&quot;, &quot;green&quot;, &quot;blcak&quot;]\nconsole.log(instance1.name); // change-super-type-name\n// 实例2\nvar instance2 = new SubType();\nconsole.log(instance2.colors); // [&quot;red&quot;, &quot;blue&quot;, &quot;green&quot;, &quot;blcak&quot;]\nconsole.log(instance2.name); // SuperType`, `48007346745994090000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                js 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// 父类</span>\n<span class="token keyword">function</span> <span class="token function">SuperType</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">this</span><span class="token punctuation">.</span>colors <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">\'red\'</span><span class="token punctuation">,</span> <span class="token string">\'blue\'</span><span class="token punctuation">,</span> <span class="token string">\'green\'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n  <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">\'SuperType\'</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n<span class="token comment">// 子类</span>\n<span class="token keyword">function</span> <span class="token function">SubType</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>\n\n<span class="token comment">// 原型链继承</span>\n<span class="token class-name">SubType</span><span class="token punctuation">.</span>prototype <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SuperType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token comment">// 实例1</span>\n<span class="token keyword">var</span> instance1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SubType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\ninstance1<span class="token punctuation">.</span>colors<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">\'blcak\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\ninstance1<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">\'change-super-type-name\'</span><span class="token punctuation">;</span>\nconsole<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>instance1<span class="token punctuation">.</span>colors<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ["red", "blue", "green", "blcak"]</span>\nconsole<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>instance1<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// change-super-type-name</span>\n<span class="token comment">// 实例2</span>\n<span class="token keyword">var</span> instance2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SubType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\nconsole<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>instance2<span class="token punctuation">.</span>colors<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ["red", "blue", "green", "blcak"]</span>\nconsole<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>instance2<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// SuperType</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>\n  <a\n    class="gatsby-resp-image-link"\n    href="/static/2019-09-21-03-12-19-05a308af2c534a0d56dae7c10f32d8cb-41127.png"\n    style="display: block"\n    target="_blank"\n    rel="noopener"\n  >\n  \n  <span\n    class="gatsby-resp-image-wrapper"\n    style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;"\n  >\n    <span\n      class="gatsby-resp-image-background-image"\n      style="padding-bottom: 68.76267748478702%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAIAAACgpqunAAAACXBIWXMAAAsSAAALEgHS3X78AAABnElEQVQoz5VS7XLcIAy893+8pkkvl1wuYLANBgzG5kMGXNx20rq9H+nOiBHMrFitdCqlSKWMMZExP46BsyBE0DpQEu0EUnpKo3PbtpV/cKqBcENp2yMkGO8QpgipQSRjUgzZOajJupZ7ONWSXc8455aQqLVnzIkhahMphdmCkr6l0fvtHk4pJUJbTMgg5cdrrfpL5125Hz8DQM9Y1/fjqLf/xCnnXBt+fHgihDJKrVKpbePbW8DII+QxrvodfjfWr2mXcSDXgADDVRhpLMby5SKen9X1NRBSDXct3fWtkH628NfPNVJJY6PlyzhJQzFqz+fuclmtrcNbfYhdG5Xar6RxQhzJPwrOw6KQXthg32/D06NTu3k5xpJzqWcdVUoF9uTodk5mmgYujJoKlBCCkDICfNawpmm+nc+UEjP7CLmUnHL+FHk3DMAwM3WTNQvtWd2wum3JuWSnFEKyds+9T5OBeb7Ts7qp/is3pDXXV/nwZW5wDiEOQyUDZ6D1GjxwHq09kOsIcslhCW700YZJKnS7zcvye9GO+HPDvgPlaiiAYy8MvwAAAABJRU5ErkJggg==\'); background-size: cover; display: block;"\n    >\n      <img\n        class="gatsby-resp-image-image"\n        style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;"\n        alt="2019 09 21 03 12 19"\n        title=""\n        src="/static/2019-09-21-03-12-19-05a308af2c534a0d56dae7c10f32d8cb-fee1c.png"\n        srcset="/static/2019-09-21-03-12-19-05a308af2c534a0d56dae7c10f32d8cb-a67b7.png 200w,\n/static/2019-09-21-03-12-19-05a308af2c534a0d56dae7c10f32d8cb-0b187.png 400w,\n/static/2019-09-21-03-12-19-05a308af2c534a0d56dae7c10f32d8cb-fee1c.png 800w,\n/static/2019-09-21-03-12-19-05a308af2c534a0d56dae7c10f32d8cb-41127.png 986w"\n        sizes="(max-width: 800px) 100vw, 800px"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<p><strong>注意</strong>：更改 <code class="language-text">SuperType</code> <strong>引用类型属性</strong>时，会使 <code class="language-text">SubType</code> 所有实例共享这一更新。基础类型属性更新则不会。</p>\n<ul>\n<li><strong>创建子类实例时，无法向父类构造函数传参</strong>，或者说是，没办法在不影响所有对象实例的情况下，向超类的构造函数传递参数</li>\n</ul>\n</li>\n</ul>\n<h2 id="构造继承"><a href="#%E6%9E%84%E9%80%A0%E7%BB%A7%E6%89%BF" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>构造继承</h2>\n<p><strong>基本思想</strong>：在子类型的构造函数内部调用父类型构造函数。</p>\n<p><strong>注意</strong>：函数只不过是在特定环境中执行代码的对象，所以这里使用 apply/call 来实现。</p>\n<p><strong>使用父类的构造函数来增强子类实例，等于是复制父类的实例属性给子类（没用到原型）</strong></p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="16204558560796990000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 父类\nfunction SuperType(name) {\n  this.name = name; // 父类属性\n}\nSuperType.prototype.sayName = function() {\n  // 父类原型方法\n  return this.name;\n};\n\n// 子类\nfunction SubType() {\n  // 调用 SuperType 构造函数\n  SuperType.call(this, \'SuperType\'); // 在子类构造函数中，向父类构造函数传参\n  // 为了保证子父类的构造函数不会重写子类的属性，需要在调用父类构造函数后，定义子类的属性\n  this.subName = \'SubType\'; // 子类属性\n}\n// 子类实例\nlet instance = new SubType(); // 运行子类构造函数，并在子类构造函数中运行父类构造函数，this绑定到子类`, `16204558560796990000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                js 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// 父类</span>\n<span class="token keyword">function</span> <span class="token function">SuperType</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span> <span class="token comment">// 父类属性</span>\n<span class="token punctuation">}</span>\n<span class="token class-name">SuperType</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">sayName</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token comment">// 父类原型方法</span>\n  <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n<span class="token comment">// 子类</span>\n<span class="token keyword">function</span> <span class="token function">SubType</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token comment">// 调用 SuperType 构造函数</span>\n  <span class="token function">SuperType</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token string">\'SuperType\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 在子类构造函数中，向父类构造函数传参</span>\n  <span class="token comment">// 为了保证子父类的构造函数不会重写子类的属性，需要在调用父类构造函数后，定义子类的属性</span>\n  <span class="token keyword">this</span><span class="token punctuation">.</span>subName <span class="token operator">=</span> <span class="token string">\'SubType\'</span><span class="token punctuation">;</span> <span class="token comment">// 子类属性</span>\n<span class="token punctuation">}</span>\n<span class="token comment">// 子类实例</span>\n<span class="token keyword">let</span> instance <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SubType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 运行子类构造函数，并在子类构造函数中运行父类构造函数，this绑定到子类</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>\n  <a\n    class="gatsby-resp-image-link"\n    href="/static/2019-09-21-03-12-49-aaefd94e92f026e95abae5b59cecb4d2-b855b.png"\n    style="display: block"\n    target="_blank"\n    rel="noopener"\n  >\n  \n  <span\n    class="gatsby-resp-image-wrapper"\n    style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;"\n  >\n    <span\n      class="gatsby-resp-image-background-image"\n      style="padding-bottom: 47.767857142857146%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAIAAAA7N+mxAAAACXBIWXMAAAsSAAALEgHS3X78AAABOUlEQVQoz4WSDW+DIBCG/f//bGuWtFs/tYoVFG0ryFcREB3N1mxJu+7N5UJeeMLd5SJUVqAouo6N0+S8H0M4N1ob8jSG5Ky1/mZ6awc/hpdfinCF402Ca4xzUCNkMJZJ3COoi8JoXZYlREgr2UOos1QiRIX1NzryzsOXst4eGcj5+4LPXjnIrjfjzw/fujMiY0yHGEmpYr0RwgthpbTuqlDt9FRR6FIxpc+6b7VmmjJ1gBiADEKolPoHVhdFWspOnDQdJTTZ74vQrTHXIf3SYzgvyiQFzemEm+bcEi6kMfau2T/glnbzxXL2Ngd5UUCE6waVeLFc5wc4DINzw7Oy6+a43SW7JP1YbVKQhwiHfQZW2ziswDZOlusNofQxzIVgjIclqXDNuTDWEkJbQtTlEgYupUIVDv5D+BNVbjykTj2skQAAAABJRU5ErkJggg==\'); background-size: cover; display: block;"\n    >\n      <img\n        class="gatsby-resp-image-image"\n        style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;"\n        alt="2019 09 21 03 12 49"\n        title=""\n        src="/static/2019-09-21-03-12-49-aaefd94e92f026e95abae5b59cecb4d2-fee1c.png"\n        srcset="/static/2019-09-21-03-12-49-aaefd94e92f026e95abae5b59cecb4d2-a67b7.png 200w,\n/static/2019-09-21-03-12-49-aaefd94e92f026e95abae5b59cecb4d2-0b187.png 400w,\n/static/2019-09-21-03-12-49-aaefd94e92f026e95abae5b59cecb4d2-fee1c.png 800w,\n/static/2019-09-21-03-12-49-aaefd94e92f026e95abae5b59cecb4d2-b855b.png 896w"\n        sizes="(max-width: 800px) 100vw, 800px"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<ul>\n<li><strong>优点</strong>：<strong>解决了 1 中子类实例共享父类引用对象的问题，实现多继承，创建子类实例时，可以向父类传递参数</strong></li>\n<li>\n<p><strong>缺点</strong>：</p>\n<ul>\n<li>实例并不是父类的实例，只是子类的实例</li>\n<li><strong>只能</strong>继承父类的实例属性和方法，<strong>不能</strong>继承原型属性/方法</li>\n<li><strong>无法实现函数复用</strong>，每个子类都有父类实例函数的副本，影响性能</li>\n</ul>\n</li>\n</ul>\n<h2 id="组合继承"><a href="#%E7%BB%84%E5%90%88%E7%BB%A7%E6%89%BF" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>组合继承</h2>\n<p>顾名思义，组合继承就是将原型链继承与构造函数继承组合在一起，从而发挥两者之长的一种继承模式。</p>\n<p><strong>基本思想</strong>：使用<strong>原型链</strong>继承使用对原型属性和方法的继承，通过<strong>构造函数</strong>继承来实现对实例属性的继承。这样既能通过在原型上定义方法实现函数复用，又能保证每个实例都有自己的属性。</p>\n<p><strong>通过调用父类构造，继承父类的属性并保留传参的优点，然后通过将父类实例作为子类原型，实现函数复用</strong></p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="80157281430741200000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 父类\nfunction SuperType(name) {\n  this.colors = [\'red\', \'blue\', \'green\'];\n  this.name = name; // 父类属性\n}\nSuperType.prototype.sayName = function() {\n  // 父类原型方法\n  return this.name;\n};\n\n// 子类\nfunction SubType(name, subName) {\n  // 调用 SuperType 构造函数\n  SuperType.call(this, name); // ----第二次调用 SuperType----\n  this.subName = subName;\n}\n\n// ----第一次调用 SuperType----\nSubType.prototype = new SuperType(); // 重写原型对象，代之以一个新类型的实例\n\nSubType.prototype.constructor = SubType; // 组合继承需要修复构造函数指向，不修复的话会指向SuperType\nSubType.prototype.saySubName = function() {\n  // 子类原型方法\n  return this.subName;\n};\n\n// 子类实例\nlet instance = new SubType(\'An\', \'sisterAn\');\ninstance.colors.push(\'black\');\nconsole.log(instance.colors); // [&quot;red&quot;, &quot;blue&quot;, &quot;green&quot;, &quot;black&quot;]\ninstance.sayName(); // An\ninstance.saySubName(); // sisterAn\n\nlet instance1 = new SubType(\'An1\', \'sisterAn1\');\nconsole.log(instance1.colors); //  [&quot;red&quot;, &quot;blue&quot;, &quot;green&quot;]\ninstance1.sayName(); // An1\ninstance1.saySubName(); // sisterAn1`, `80157281430741200000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                js 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// 父类</span>\n<span class="token keyword">function</span> <span class="token function">SuperType</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">this</span><span class="token punctuation">.</span>colors <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">\'red\'</span><span class="token punctuation">,</span> <span class="token string">\'blue\'</span><span class="token punctuation">,</span> <span class="token string">\'green\'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n  <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span> <span class="token comment">// 父类属性</span>\n<span class="token punctuation">}</span>\n<span class="token class-name">SuperType</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">sayName</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token comment">// 父类原型方法</span>\n  <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n<span class="token comment">// 子类</span>\n<span class="token keyword">function</span> <span class="token function">SubType</span><span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span> subName</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token comment">// 调用 SuperType 构造函数</span>\n  <span class="token function">SuperType</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ----第二次调用 SuperType----</span>\n  <span class="token keyword">this</span><span class="token punctuation">.</span>subName <span class="token operator">=</span> subName<span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token comment">// ----第一次调用 SuperType----</span>\n<span class="token class-name">SubType</span><span class="token punctuation">.</span>prototype <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SuperType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 重写原型对象，代之以一个新类型的实例</span>\n\n<span class="token class-name">SubType</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>constructor <span class="token operator">=</span> SubType<span class="token punctuation">;</span> <span class="token comment">// 组合继承需要修复构造函数指向，不修复的话会指向SuperType</span>\n<span class="token class-name">SubType</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">saySubName</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token comment">// 子类原型方法</span>\n  <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>subName<span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n<span class="token comment">// 子类实例</span>\n<span class="token keyword">let</span> instance <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SubType</span><span class="token punctuation">(</span><span class="token string">\'An\'</span><span class="token punctuation">,</span> <span class="token string">\'sisterAn\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\ninstance<span class="token punctuation">.</span>colors<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">\'black\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\nconsole<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>instance<span class="token punctuation">.</span>colors<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ["red", "blue", "green", "black"]</span>\ninstance<span class="token punctuation">.</span><span class="token function">sayName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// An</span>\ninstance<span class="token punctuation">.</span><span class="token function">saySubName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// sisterAn</span>\n\n<span class="token keyword">let</span> instance1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SubType</span><span class="token punctuation">(</span><span class="token string">\'An1\'</span><span class="token punctuation">,</span> <span class="token string">\'sisterAn1\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\nconsole<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>instance1<span class="token punctuation">.</span>colors<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//  ["red", "blue", "green"]</span>\ninstance1<span class="token punctuation">.</span><span class="token function">sayName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// An1</span>\ninstance1<span class="token punctuation">.</span><span class="token function">saySubName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// sisterAn1</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>\n  <a\n    class="gatsby-resp-image-link"\n    href="/static/2019-09-21-03-25-03-ece5d09e2ee8087f8f723614aa00244b-94c27.png"\n    style="display: block"\n    target="_blank"\n    rel="noopener"\n  >\n  \n  <span\n    class="gatsby-resp-image-wrapper"\n    style="position: relative; display: block; ; max-width: 616px; margin-left: auto; margin-right: auto;"\n  >\n    <span\n      class="gatsby-resp-image-background-image"\n      style="padding-bottom: 67.20779220779221%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAAAsSAAALEgHS3X78AAACIUlEQVQ4y42TyW7bQBBE9dFODkEOMRLAzhclyNl2YlteJe+WZC3Uwp0j7iLnpSkaFoX4EALF5hDdPdU1NS2NxjVc7IGJbS5Y2g6RaRHOZoS2TTydklsWStb+ZMIqTSmXIaskIS80SL3WEivI06pekZ3iPLikgSKaz4kch/999NZC1w3jlxHewQ3Luz7m1RXzwyP8TodIkD49EpydkQ1fIAzRwlAncR2zDLIqptsM094Q80cb8+AK67yL0+3i3XTwrq8JH+6xLs5Jnh7A99BLVUclcbkUqBrNhomvsE+esY+fCUYGpRSQ57BabSDrNaNKs9dRt6BrLdcNUQHerwOCn39YHh4zO2mzGAxwDANzPCYLAtk1QVfMqo1eD+HtMPRGyVYuCSqKUGFEWQiZosQXrXJJKiWhbAi/zWbDqolWLAL3HnsYwwmO6+CJVZTAE7t4pokSlvnEQIlmC3FAJrqt5H+FMEwpSt7Yvo2sZgnmjU0wX5BYNqnjrn1WFAVFIkUyRfmebu/aRuaMX8a47T7RYMzi8gLr9JRsaoAw0mLqQlhqx4bAl91VjTgWXePaSoLNKYuHkk4X93KEezvA7Y9w7h+x7m6xOteo3jNGu00ot4RBX2yzbDRM5FaENZoNs+kceyRjD31mpo+f1SMWDazTF/PtEf+5NtXIskv27SvxzmfyT7vYOx9wP36A/X3Y25Mo+C7fu1/Qv4/qwsoOTcs0rPMXY6ngqMroMT4AAAAASUVORK5CYII=\'); background-size: cover; display: block;"\n    >\n      <img\n        class="gatsby-resp-image-image"\n        style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;"\n        alt="2019 09 21 03 25 03"\n        title=""\n        src="/static/2019-09-21-03-25-03-ece5d09e2ee8087f8f723614aa00244b-94c27.png"\n        srcset="/static/2019-09-21-03-25-03-ece5d09e2ee8087f8f723614aa00244b-64932.png 200w,\n/static/2019-09-21-03-25-03-ece5d09e2ee8087f8f723614aa00244b-2fd6e.png 400w,\n/static/2019-09-21-03-25-03-ece5d09e2ee8087f8f723614aa00244b-94c27.png 616w"\n        sizes="(max-width: 616px) 100vw, 616px"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<p>第一次调用 <code class="language-text">SuperType</code> 构造函数时，<code class="language-text">SubType.prototype</code> 会得到两个属性<code class="language-text">name</code>和<code class="language-text">colors</code>；当调用 <code class="language-text">SubType</code> 构造函数时，第二次调用 <code class="language-text">SuperType</code> 构造函数，这一次又在新对象属性上创建了 <code class="language-text">name</code>和<code class="language-text">colors</code>，这两个属性就会屏蔽原型对象上的同名属性。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="42936321558742204000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// instanceof：instance 的原型链是针对 SuperType.prototype 进行检查的\ninstance instanceof SuperType; // true\ninstance instanceof SubType; // true\n\n// isPrototypeOf：instance 的原型链是针对 SuperType 本身进行检查的\nSuperType.prototype.isPrototypeOf(instance); // true\nSubType.prototype.isPrototypeOf(instance); // true`, `42936321558742204000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                js 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// instanceof：instance 的原型链是针对 SuperType.prototype 进行检查的</span>\ninstance <span class="token keyword">instanceof</span> <span class="token class-name">SuperType</span><span class="token punctuation">;</span> <span class="token comment">// true</span>\ninstance <span class="token keyword">instanceof</span> <span class="token class-name">SubType</span><span class="token punctuation">;</span> <span class="token comment">// true</span>\n\n<span class="token comment">// isPrototypeOf：instance 的原型链是针对 SuperType 本身进行检查的</span>\n<span class="token class-name">SuperType</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function">isPrototypeOf</span><span class="token punctuation">(</span>instance<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true</span>\n<span class="token class-name">SubType</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function">isPrototypeOf</span><span class="token punctuation">(</span>instance<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>\n  <a\n    class="gatsby-resp-image-link"\n    href="/static/2019-09-21-03-35-46-893a961d45f9af88f9053d69b2f2c0f7-9d536.png"\n    style="display: block"\n    target="_blank"\n    rel="noopener"\n  >\n  \n  <span\n    class="gatsby-resp-image-wrapper"\n    style="position: relative; display: block; ; max-width: 543px; margin-left: auto; margin-right: auto;"\n  >\n    <span\n      class="gatsby-resp-image-background-image"\n      style="padding-bottom: 29.65009208103131%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAAAsSAAALEgHS3X78AAAAxElEQVQY042R627DIAyF+/5vuanJ1CZgwNxikpwZWu3XlM2SxZGRP47NLcaMaV6xrAZCBWVi1GeCsYTHc4FzHj3O8/xX3mIquM92NO4skCWjUYUPAZYcfotroDq8Ty9g5oxIEclHBOYBTCkhZ3Veip4Z+75fA5k70Izm7soFD3IOzBHeBx3d6h0NbXUNddsuXSow4ePzAWNoQI15AbrjVXXfLWl9NWY88ufIKVXMX/oRdUNrDZs6EJG3lpEi7ad2HMdlfgMXxNNkPHqbvwAAAABJRU5ErkJggg==\'); background-size: cover; display: block;"\n    >\n      <img\n        class="gatsby-resp-image-image"\n        style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;"\n        alt="2019 09 21 03 35 46"\n        title=""\n        src="/static/2019-09-21-03-35-46-893a961d45f9af88f9053d69b2f2c0f7-9d536.png"\n        srcset="/static/2019-09-21-03-35-46-893a961d45f9af88f9053d69b2f2c0f7-cdad1.png 200w,\n/static/2019-09-21-03-35-46-893a961d45f9af88f9053d69b2f2c0f7-5653c.png 400w,\n/static/2019-09-21-03-35-46-893a961d45f9af88f9053d69b2f2c0f7-9d536.png 543w"\n        sizes="(max-width: 543px) 100vw, 543px"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<ul>\n<li><strong>优点</strong>：<strong>弥补了方式 2 的缺陷，可以继承实例属性/方法，也可以继承原型属性/方法，不存在引用属性共享问题，可传参，可复用</strong></li>\n<li>\n<p><strong>缺点</strong>：</p>\n<ul>\n<li>调用了两次父类构造函数，生成了<strong>两份实例</strong>（子类实例将子类原型上的那份屏蔽了）</li>\n</ul>\n</li>\n</ul>\n<h2 id="寄生组合继承"><a href="#%E5%AF%84%E7%94%9F%E7%BB%84%E5%90%88%E7%BB%A7%E6%89%BF" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>寄生组合继承</h2>\n<p>在组合继承中，调用了两次父类构造函数，这里 <strong>通过通过寄生方式，砍掉父类的实例属性，这样，在调用两次父类的构造的时候，就不会初始化两次实例方法/属性，避免的组合继承的缺点</strong></p>\n<p><strong>主要思想</strong>：借用 <strong>构造函数</strong> 继承 <strong>属性</strong> ，通过 <strong>原型链的混成形式</strong> 来继承 <strong>方法</strong></p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="86090822968578130000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 父类\nfunction SuperType(name) {\n  this.colors = [\'red\', \'blue\', \'green\'];\n  this.name = name; // 父类属性\n}\nSuperType.prototype.sayName = function() {\n  // 父类原型方法\n  return this.name;\n};\n\n// 子类\nfunction SubType(name, subName) {\n  // 调用 SuperType 构造函数\n  SuperType.call(this, name); // ----第二次调用 SuperType，继承实例属性----\n  this.subName = subName;\n}\n\n// ----第一次调用 SuperType，继承原型属性----\nSubType.prototype = Object.create(SuperType.prototype);\n\nSubType.prototype.constructor = SubType; // 注意：增强对象\n\nlet instance = new SubType(\'An\', \'sisterAn\');`, `86090822968578130000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                js 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// 父类</span>\n<span class="token keyword">function</span> <span class="token function">SuperType</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">this</span><span class="token punctuation">.</span>colors <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">\'red\'</span><span class="token punctuation">,</span> <span class="token string">\'blue\'</span><span class="token punctuation">,</span> <span class="token string">\'green\'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n  <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span> <span class="token comment">// 父类属性</span>\n<span class="token punctuation">}</span>\n<span class="token class-name">SuperType</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">sayName</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token comment">// 父类原型方法</span>\n  <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n<span class="token comment">// 子类</span>\n<span class="token keyword">function</span> <span class="token function">SubType</span><span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span> subName</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token comment">// 调用 SuperType 构造函数</span>\n  <span class="token function">SuperType</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ----第二次调用 SuperType，继承实例属性----</span>\n  <span class="token keyword">this</span><span class="token punctuation">.</span>subName <span class="token operator">=</span> subName<span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token comment">// ----第一次调用 SuperType，继承原型属性----</span>\n<span class="token class-name">SubType</span><span class="token punctuation">.</span>prototype <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token class-name">SuperType</span><span class="token punctuation">.</span>prototype<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token class-name">SubType</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>constructor <span class="token operator">=</span> SubType<span class="token punctuation">;</span> <span class="token comment">// 注意：增强对象</span>\n\n<span class="token keyword">let</span> instance <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SubType</span><span class="token punctuation">(</span><span class="token string">\'An\'</span><span class="token punctuation">,</span> <span class="token string">\'sisterAn\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>\n  <a\n    class="gatsby-resp-image-link"\n    href="/static/2019-09-21-03-42-49-aec6a13e2423869db22b2aea5bc5e57c-4c6f5.png"\n    style="display: block"\n    target="_blank"\n    rel="noopener"\n  >\n  \n  <span\n    class="gatsby-resp-image-wrapper"\n    style="position: relative; display: block; ; max-width: 607px; margin-left: auto; margin-right: auto;"\n  >\n    <span\n      class="gatsby-resp-image-background-image"\n      style="padding-bottom: 31.960461285008236%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAAAsSAAALEgHS3X78AAAA5UlEQVQY032QbW+EIBCE7///un7sl9b0TEB8Q09BBeQp6LVJe71uMkyWbGZn57IsC1JV9IPGe38iBDbncIlzH33ApT7PBufZ15WQ4FwgxvgDF+cd8kNSFRVNXdM3DaNS6LJEC8GQeLteGceRtm1x1hISe62xa+CsyFdd8jOLmfpFMdcNSxKxQkK4D6etB57Ug8P8aSaDfh+4iRtNWVG8FchKovXAbAxNdp0c/iVw7vslmHPqi47+tcMal/ILR14midl04pHd3XH8x+33yXvcmdoJowxmtAihqOvTVdd1bNv2xN0jPgFTndNHZSY6/wAAAABJRU5ErkJggg==\'); background-size: cover; display: block;"\n    >\n      <img\n        class="gatsby-resp-image-image"\n        style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;"\n        alt="2019 09 21 03 42 49"\n        title=""\n        src="/static/2019-09-21-03-42-49-aec6a13e2423869db22b2aea5bc5e57c-4c6f5.png"\n        srcset="/static/2019-09-21-03-42-49-aec6a13e2423869db22b2aea5bc5e57c-3bd24.png 200w,\n/static/2019-09-21-03-42-49-aec6a13e2423869db22b2aea5bc5e57c-52f0c.png 400w,\n/static/2019-09-21-03-42-49-aec6a13e2423869db22b2aea5bc5e57c-4c6f5.png 607w"\n        sizes="(max-width: 607px) 100vw, 607px"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<p><strong>优点</strong>：</p>\n<ul>\n<li>只调用一次 <code class="language-text">SuperType</code> 构造函数，只创建一份父类属性</li>\n<li>原型链保持不变</li>\n<li>能够正常使用 <code class="language-text">instanceof</code> 与 <code class="language-text">isPrototypeOf</code></li>\n</ul>\n<h2 id="原型式继承"><a href="#%E5%8E%9F%E5%9E%8B%E5%BC%8F%E7%BB%A7%E6%89%BF" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>原型式继承</h2>\n<p><strong>实现思路就是将子类的原型设置为父类的原型</strong></p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="69669864165665960000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 父类\nfunction SuperType(name) {\n  this.colors = [\'red\', \'blue\', \'green\'];\n  this.name = name; // 父类属性\n}\nSuperType.prototype.sayName = function() {\n  // 父类原型方法\n  return this.name;\n};\n\n/** 第一步 */\n// 子类，通过 call 继承父类的实例属性和方法，不能继承原型属性/方法\nfunction SubType(name, subName) {\n  SuperType.call(this, name); // 调用 SuperType 的构造函数，并向其传参\n  this.subName = subName;\n}\n\n/** 第二步 */\n// 解决 call 无法继承父类原型属性/方法的问题\n// Object.create 方法接受传入一个作为新创建对象的原型的对象，创建一个拥有指定原型和若干个指定属性的对象\n// 通过这种方法指定的任何属性都会覆盖原型对象上的同名属性\nSubType.prototype = Object.create(SuperType.prototype, {\n  constructor: {\n    // 注意指定 SubType.prototype.constructor = SubType\n    value: SubType,\n    enumerable: false,\n    writable: true,\n    configurable: true\n  },\n  run: {\n    value: function() {\n      // override\n      SuperType.prototype.run.apply(this, arguments);\n      // call super\n      // ...\n    },\n    enumerable: true,\n    configurable: true,\n    writable: true\n  }\n});\n\n/** 第三步 */\n// 最后：解决 SubType.prototype.constructor === SuperType 的问题\n// 这里，在上一步已经指定，这里不需要再操作\n// SubType.prototype.constructor = SubType;\n\nvar instance = new SubType(\'An\', \'sistenAn\');`, `69669864165665960000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                js 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// 父类</span>\n<span class="token keyword">function</span> <span class="token function">SuperType</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">this</span><span class="token punctuation">.</span>colors <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">\'red\'</span><span class="token punctuation">,</span> <span class="token string">\'blue\'</span><span class="token punctuation">,</span> <span class="token string">\'green\'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n  <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span> <span class="token comment">// 父类属性</span>\n<span class="token punctuation">}</span>\n<span class="token class-name">SuperType</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">sayName</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token comment">// 父类原型方法</span>\n  <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n<span class="token comment">/** 第一步 */</span>\n<span class="token comment">// 子类，通过 call 继承父类的实例属性和方法，不能继承原型属性/方法</span>\n<span class="token keyword">function</span> <span class="token function">SubType</span><span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span> subName</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token function">SuperType</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 调用 SuperType 的构造函数，并向其传参</span>\n  <span class="token keyword">this</span><span class="token punctuation">.</span>subName <span class="token operator">=</span> subName<span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token comment">/** 第二步 */</span>\n<span class="token comment">// 解决 call 无法继承父类原型属性/方法的问题</span>\n<span class="token comment">// Object.create 方法接受传入一个作为新创建对象的原型的对象，创建一个拥有指定原型和若干个指定属性的对象</span>\n<span class="token comment">// 通过这种方法指定的任何属性都会覆盖原型对象上的同名属性</span>\n<span class="token class-name">SubType</span><span class="token punctuation">.</span>prototype <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token class-name">SuperType</span><span class="token punctuation">.</span>prototype<span class="token punctuation">,</span> <span class="token punctuation">{</span>\n  constructor<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n    <span class="token comment">// 注意指定 SubType.prototype.constructor = SubType</span>\n    value<span class="token punctuation">:</span> SubType<span class="token punctuation">,</span>\n    enumerable<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>\n    writable<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>\n    configurable<span class="token punctuation">:</span> <span class="token boolean">true</span>\n  <span class="token punctuation">}</span><span class="token punctuation">,</span>\n  run<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n    <span class="token function-variable function">value</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token comment">// override</span>\n      <span class="token class-name">SuperType</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> arguments<span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token comment">// call super</span>\n      <span class="token comment">// ...</span>\n    <span class="token punctuation">}</span><span class="token punctuation">,</span>\n    enumerable<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>\n    configurable<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>\n    writable<span class="token punctuation">:</span> <span class="token boolean">true</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token comment">/** 第三步 */</span>\n<span class="token comment">// 最后：解决 SubType.prototype.constructor === SuperType 的问题</span>\n<span class="token comment">// 这里，在上一步已经指定，这里不需要再操作</span>\n<span class="token comment">// SubType.prototype.constructor = SubType;</span>\n\n<span class="token keyword">var</span> instance <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SubType</span><span class="token punctuation">(</span><span class="token string">\'An\'</span><span class="token punctuation">,</span> <span class="token string">\'sistenAn\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>\n  <a\n    class="gatsby-resp-image-link"\n    href="/static/2019-09-21-03-57-16-01f2f7a428b20c128919080569d83c63-68fa4.png"\n    style="display: block"\n    target="_blank"\n    rel="noopener"\n  >\n  \n  <span\n    class="gatsby-resp-image-wrapper"\n    style="position: relative; display: block; ; max-width: 641px; margin-left: auto; margin-right: auto;"\n  >\n    <span\n      class="gatsby-resp-image-background-image"\n      style="padding-bottom: 32.137285491419654%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAAAsSAAALEgHS3X78AAAA2ElEQVQY042Q6W7DIBCE/f4vWPVfLPXAjg+uxZgCk8FpoiiKqq40WnYFH7Pbee9x6nuM5zMkBAQROGMQ2Bdq1waZfd16zMU5/CwLtpBQKxiV+Tgc0RUUrJ8a47vCrBTCPCMQ7ocBwofx6xuRME9Y2neUbUPhpynl10CWkEkwvU3Y6EbTrSXsf1HxwPoFshNsgBs87Cow2mKmM6012jramAvrnPMVUeuDnut6BaaUsJ5WmN4cu4kxwnFXwtFuKqXcgX9F1y42WWXhPhxdeig1Hg5vug/45OaVLtdO1DxmdhEFAAAAAElFTkSuQmCC\'); background-size: cover; display: block;"\n    >\n      <img\n        class="gatsby-resp-image-image"\n        style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;"\n        alt="2019 09 21 03 57 16"\n        title=""\n        src="/static/2019-09-21-03-57-16-01f2f7a428b20c128919080569d83c63-68fa4.png"\n        srcset="/static/2019-09-21-03-57-16-01f2f7a428b20c128919080569d83c63-ea38f.png 200w,\n/static/2019-09-21-03-57-16-01f2f7a428b20c128919080569d83c63-bb505.png 400w,\n/static/2019-09-21-03-57-16-01f2f7a428b20c128919080569d83c63-68fa4.png 641w"\n        sizes="(max-width: 641px) 100vw, 641px"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<p>如果希望能 <strong>多继承</strong> ，可使用 <strong>混入</strong> 的方式</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="85067391492735430000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 父类 SuperType\nfunction SuperType() {}\n// 父类 OtherSuperType\nfunction OtherSuperType() {}\n\n// 多继承子类\nfunction AnotherType() {\n  SuperType.call(this); // 继承 SuperType 的实例属性和方法\n  OtherSuperType.call(this); // 继承 OtherSuperType 的实例属性和方法\n}\n\n// 继承一个类\nAnotherType.prototype = Object.create(SuperType.prototype);\n\n// 使用 Object.assign 混合其它\nObject.assign(AnotherType.prototype, OtherSuperType.prototype);\n// Object.assign 会把  OtherSuperType 原型上的函数拷贝到 AnotherType 原型上，使 AnotherType 的所有实例都可用 OtherSuperType 的方法\n\n// 重新指定 constructor\nAnotherType.prototype.constructor = AnotherType;\n\nAnotherType.prototype.myMethod = function() {\n  // do a thing\n};\n\nlet instance = new AnotherType();`, `85067391492735430000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                js 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// 父类 SuperType</span>\n<span class="token keyword">function</span> <span class="token function">SuperType</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>\n<span class="token comment">// 父类 OtherSuperType</span>\n<span class="token keyword">function</span> <span class="token function">OtherSuperType</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>\n\n<span class="token comment">// 多继承子类</span>\n<span class="token keyword">function</span> <span class="token function">AnotherType</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token function">SuperType</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 继承 SuperType 的实例属性和方法</span>\n  <span class="token function">OtherSuperType</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 继承 OtherSuperType 的实例属性和方法</span>\n<span class="token punctuation">}</span>\n\n<span class="token comment">// 继承一个类</span>\n<span class="token class-name">AnotherType</span><span class="token punctuation">.</span>prototype <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token class-name">SuperType</span><span class="token punctuation">.</span>prototype<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token comment">// 使用 Object.assign 混合其它</span>\nObject<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span><span class="token class-name">AnotherType</span><span class="token punctuation">.</span>prototype<span class="token punctuation">,</span> <span class="token class-name">OtherSuperType</span><span class="token punctuation">.</span>prototype<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token comment">// Object.assign 会把  OtherSuperType 原型上的函数拷贝到 AnotherType 原型上，使 AnotherType 的所有实例都可用 OtherSuperType 的方法</span>\n\n<span class="token comment">// 重新指定 constructor</span>\n<span class="token class-name">AnotherType</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>constructor <span class="token operator">=</span> AnotherType<span class="token punctuation">;</span>\n\n<span class="token class-name">AnotherType</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">myMethod</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token comment">// do a thing</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n<span class="token keyword">let</span> instance <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AnotherType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p><strong>最重要的部分是</strong>：</p>\n<ul>\n<li><code class="language-text">SuperType.call</code> 继承实例属性方法</li>\n<li>用 <code class="language-text">Object.create()</code> 来继承原型属性与方法</li>\n<li>修改 <code class="language-text">SubType.prototype.constructor</code>的指向</li>\n</ul>\n<h1 id="es6-继承"><a href="#es6-%E7%BB%A7%E6%89%BF" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>ES6 继承</h1>\n<p>首先，实现一个简单的 ES6 继承：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="70307642366743675000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`class People {\n  constructor(name) {\n    this.name = name;\n  }\n  run() {}\n}\n\n// extends 相当于方法的继承\n// 替换了上面的3行代码\nclass Man extends People {\n  constructor(name) {\n    // super 相当于属性的继承\n    // 替换了 People.call(this, name)\n    super(name);\n    this.gender = \'男\';\n  }\n  fight() {}\n}`, `70307642366743675000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                js 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">class</span> <span class="token class-name">People</span> <span class="token punctuation">{</span>\n  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n  <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n\n<span class="token comment">// extends 相当于方法的继承</span>\n<span class="token comment">// 替换了上面的3行代码</span>\n<span class="token keyword">class</span> <span class="token class-name">Man</span> <span class="token keyword">extends</span> <span class="token class-name">People</span> <span class="token punctuation">{</span>\n  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token comment">// super 相当于属性的继承</span>\n    <span class="token comment">// 替换了 People.call(this, name)</span>\n    <span class="token keyword">super</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">this</span><span class="token punctuation">.</span>gender <span class="token operator">=</span> <span class="token string">\'男\'</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n  <span class="token function">fight</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id="核心代码"><a href="#%E6%A0%B8%E5%BF%83%E4%BB%A3%E7%A0%81" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>核心代码</h2>\n<p><code class="language-text">extends</code> 继承的核心代码如下，其实现和上述的寄生组合式继承方式一样</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="80637538772691600000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`function _inherits(subType, superType) {\n    // 创建对象，Object.create 创建父类原型的一个副本\n    // 增强对象，弥补因重写原型而失去的默认的 constructor 属性\n    // 指定对象，将新创建的对象赋值给子类的原型 subType.prototype\n    subType.prototype = Object.create(superType && superType.prototype, {\n        constructor: { // 重写 constructor\n            value: subType,\n            enumerable: false,\n            writable: true,\n            configurable: true\n        }\n    });\n    if (superType) {\n        Object.setPrototypeOf\n            ? Object.setPrototypeOf(subType, superType)\n            : subType.__proto__ = superType;\n    }\n}`, `80637538772691600000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                Js 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">function</span> <span class="token function">_inherits</span><span class="token punctuation">(</span><span class="token parameter">subType<span class="token punctuation">,</span> superType</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token comment">// 创建对象，Object.create 创建父类原型的一个副本</span>\n    <span class="token comment">// 增强对象，弥补因重写原型而失去的默认的 constructor 属性</span>\n    <span class="token comment">// 指定对象，将新创建的对象赋值给子类的原型 subType.prototype</span>\n    subType<span class="token punctuation">.</span>prototype <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>superType <span class="token operator">&amp;&amp;</span> superType<span class="token punctuation">.</span>prototype<span class="token punctuation">,</span> <span class="token punctuation">{</span>\n        constructor<span class="token punctuation">:</span> <span class="token punctuation">{</span> <span class="token comment">// 重写 constructor</span>\n            value<span class="token punctuation">:</span> subType<span class="token punctuation">,</span>\n            enumerable<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>\n            writable<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>\n            configurable<span class="token punctuation">:</span> <span class="token boolean">true</span>\n        <span class="token punctuation">}</span>\n    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">if</span> <span class="token punctuation">(</span>superType<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        Object<span class="token punctuation">.</span>setPrototypeOf\n            <span class="token operator">?</span> Object<span class="token punctuation">.</span><span class="token function">setPrototypeOf</span><span class="token punctuation">(</span>subType<span class="token punctuation">,</span> superType<span class="token punctuation">)</span>\n            <span class="token punctuation">:</span> subType<span class="token punctuation">.</span>__proto__ <span class="token operator">=</span> superType<span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h1 id="继承的使用场景"><a href="#%E7%BB%A7%E6%89%BF%E7%9A%84%E4%BD%BF%E7%94%A8%E5%9C%BA%E6%99%AF" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>继承的使用场景</h1>\n<ul>\n<li>不要仅仅为了使用而使用它们，这只是在浪费时间而已。</li>\n<li>当需要创建 <strong>一系列拥有相似特性的对象</strong> 时，那么创建一个包含所有共有功能的通用对象，然后在更特殊的对象类型中继承这些特性。</li>\n<li>应避免多继承，造成混乱。</li>\n</ul>\n<p><strong>注:</strong> 考虑到 JavaScript 的工作方式，由于原型链等特性的存在，在不同对象之间功能的共享通常被叫做 <strong>委托</strong> - 特殊的对象将功能委托给通用的对象类型完成。这也许比将其称之为继承更为贴切，因为“被继承”了的功能并没有被拷贝到正在“进行继承”的对象中，相反它仍存在于通用的对象中。</p>\n<h2 id="扩展：new"><a href="#%E6%89%A9%E5%B1%95%EF%BC%9Anew" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>扩展：new</h2>\n<p><strong>new 关键字</strong>创建的对象<strong>实际上是对新对象 this 的不断赋值，并将 prototype 指向类的 prototype 所指向的对象</strong>。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="39003996177210690000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`var SuperType = function(name) {\n  var nose = \'nose\'; // 私有属性\n  function say() {} // 私有方法\n\n  // 特权方法\n  this.getName = function() {};\n  this.setName = function() {};\n\n  this.mouse = \'mouse\'; // 对象公有属性\n  this.listen = function() {}; // 对象公有方法\n\n  // 构造器\n  this.setName(name);\n};\n\nSuperType.age = 10; // 类静态公有属性（对象不能访问）\nSuperType.read = function() {}; // 类静态公有方法（对象无法访问）\n\nSuperType.prototype = {\n  // 对象赋值（也可以一一赋值）\n  isMan: \'true\', // 公有属性\n  write: function() {} // 公有方法\n};\n\nvar instance = new SuperType();`, `39003996177210690000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                js 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">var</span> <span class="token function-variable function">SuperType</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">var</span> nose <span class="token operator">=</span> <span class="token string">\'nose\'</span><span class="token punctuation">;</span> <span class="token comment">// 私有属性</span>\n  <span class="token keyword">function</span> <span class="token function">say</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token comment">// 私有方法</span>\n\n  <span class="token comment">// 特权方法</span>\n  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function-variable function">getName</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>\n  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function-variable function">setName</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n  <span class="token keyword">this</span><span class="token punctuation">.</span>mouse <span class="token operator">=</span> <span class="token string">\'mouse\'</span><span class="token punctuation">;</span> <span class="token comment">// 对象公有属性</span>\n  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function-variable function">listen</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token comment">// 对象公有方法</span>\n\n  <span class="token comment">// 构造器</span>\n  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span>\n\nSuperType<span class="token punctuation">.</span>age <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span> <span class="token comment">// 类静态公有属性（对象不能访问）</span>\nSuperType<span class="token punctuation">.</span><span class="token function-variable function">read</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token comment">// 类静态公有方法（对象无法访问）</span>\n\n<span class="token class-name">SuperType</span><span class="token punctuation">.</span>prototype <span class="token operator">=</span> <span class="token punctuation">{</span>\n  <span class="token comment">// 对象赋值（也可以一一赋值）</span>\n  isMan<span class="token punctuation">:</span> <span class="token string">\'true\'</span><span class="token punctuation">,</span> <span class="token comment">// 公有属性</span>\n  <span class="token function-variable function">write</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token comment">// 公有方法</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n<span class="token keyword">var</span> instance <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SuperType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>\n  <a\n    class="gatsby-resp-image-link"\n    href="/static/2019-09-21-04-20-04-6eb5875c171f52d6633fd7e6b8e3bea1-51685.png"\n    style="display: block"\n    target="_blank"\n    rel="noopener"\n  >\n  \n  <span\n    class="gatsby-resp-image-wrapper"\n    style="position: relative; display: block; ; max-width: 550px; margin-left: auto; margin-right: auto;"\n  >\n    <span\n      class="gatsby-resp-image-background-image"\n      style="padding-bottom: 32.72727272727273%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAAAsSAAALEgHS3X78AAAA3klEQVQoz52RyW7DMAxE/f8f10PRWwvUSGLDVl0tXiRZojWdKEHvDgGCAEm8GYnNre/RXi9YtxUp7di2Dfu+I+cM731NyYIQAiL7B6twRziPMdbdPWWIFJRS0IzDiPajRf/Voxt+0FFgnucKmqap5h1mtIZjX7RBGgbEe89a7jq4JSAJGATGNUK9jTCthelGpGXBa/F0GEgf3xXMxcDdBniq1nEpJ/PpMKUES3f6U8MvKzKf9a95GkogS3Vnvy3cr8OsFBI/vDwkT0cjwguuvKDlxXyGpUNF6CHHSw7/AIQhIzLPVvPsAAAAAElFTkSuQmCC\'); background-size: cover; display: block;"\n    >\n      <img\n        class="gatsby-resp-image-image"\n        style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;"\n        alt="2019 09 21 04 20 04"\n        title=""\n        src="/static/2019-09-21-04-20-04-6eb5875c171f52d6633fd7e6b8e3bea1-51685.png"\n        srcset="/static/2019-09-21-04-20-04-6eb5875c171f52d6633fd7e6b8e3bea1-b4476.png 200w,\n/static/2019-09-21-04-20-04-6eb5875c171f52d6633fd7e6b8e3bea1-1367e.png 400w,\n/static/2019-09-21-04-20-04-6eb5875c171f52d6633fd7e6b8e3bea1-51685.png 550w"\n        sizes="(max-width: 550px) 100vw, 550px"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<p>所以类的构造函数内定义的 <strong>私有变量或方法</strong> ，以及类定义的 <strong>静态公有属性及方法</strong> ，在 <strong>new</strong> 的实例对象中都将 <strong>无法访问</strong> 。</p>\n<h3 id="扩展：继承机制的设计思想··"><a href="#%E6%89%A9%E5%B1%95%EF%BC%9A%E7%BB%A7%E6%89%BF%E6%9C%BA%E5%88%B6%E7%9A%84%E8%AE%BE%E8%AE%A1%E6%80%9D%E6%83%B3%C2%B7%C2%B7" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>扩展：继承机制的设计思想··</h3>\n<p>关于继承机制的设计思想，请参见 <a href="http://www.ruanyifeng.com/blog/2011/06/designing_ideas_of_inheritance_mechanism_in_javascript.html" target="_blank" rel="nofollow noreferrer noopener">Javascript 继承机制的设计思想</a> 。</p>',
id:"/github/workspace/blog/JS基础之继承/index.md absPath of file >>> MarkdownRemark",timeToRead:8,frontmatter:{date:"2019-09-21 02:26:30",path:"/js-basic-of-extend/",tags:"前端, JS, 继承",title:"JS基础之继承",draft:null}},{excerpt:"引言 本篇从 React Refs 的使用场景、使用方式、注意事项，到   与 Hook   的对比使用，最后以 React   源码结束，剖析整个 React Refs，关于   会在下一篇文章深入探讨。 Refs React 的 核心思想 是每次对于界面 state 的改动，都会重新渲染整个 Virtual DOM，然后新老的两个 Virtual DOM 树进行 diff（ 协调算法 ），对比出变化的地方，然后通过 render 渲染到实际的 UI 界面， 使用 Refs…",html:'<h1 id="引言"><a href="#%E5%BC%95%E8%A8%80" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>引言</h1>\n<p>本篇从 React Refs 的使用场景、使用方式、注意事项，到 <code class="language-text">createRef</code> 与 Hook <code class="language-text">useRef</code> 的对比使用，最后以 React <code class="language-text">createRef</code> 源码结束，剖析整个 React Refs，关于 <code class="language-text">React.forwardRef</code> 会在下一篇文章深入探讨。</p>\n<h1 id="refs"><a href="#refs" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Refs</h1>\n<p>React 的<strong>核心思想</strong>是每次对于界面 state 的改动，都会重新渲染整个 Virtual DOM，然后新老的两个 Virtual DOM 树进行 diff（<strong>协调算法</strong>），对比出变化的地方，然后通过 render 渲染到实际的 UI 界面，</p>\n<p>使用 Refs 为我们提供了一种绕过状态更新和重新渲染时访问元素的方法；这在某些用例中很有用，但不应该作为 <code class="language-text">props</code> 和 <code class="language-text">state</code> 的替代方法。</p>\n<p>在项目开发中，如果我们可以使用 声明式 或 提升 state 所在的组件层级（状态提升） 的方法来更新组件，最好不要使用 refs。</p>\n<h2 id="使用场景"><a href="#%E4%BD%BF%E7%94%A8%E5%9C%BA%E6%99%AF" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>使用场景</h2>\n<ul>\n<li>\n<p><strong>管理焦点（如文本选择）或处理表单数据：</strong> Refs 将管理文本框当前焦点选中，或文本框其它属性。</p>\n<p>在大多数情况下，我们推荐使用受控组件来处理表单数据。在一个受控组件中，表单数据是由 React 组件来管理的，每个状态更新都编写数据处理函数。另一种替代方案是使用非受控组件，这时表单数据将交由 DOM 节点来处理。要编写一个非受控组件，就需要使用 Refs 来从 DOM 节点中获取表单数据。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="37580577684124350000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`class NameForm extends React.Component {\nconstructor(props) {\n  super(props);\n  this.input = React.createRef();\n}\n\nhandleSubmit = (e) => {\n  console.log(\'A name was submitted: \' + this.input.current.value);\n  e.preventDefault();\n};\n\nrender() {\n  return (\n    <form onSubmit={this.handleSubmit}>\n      <label>\n        Name:\n        <input type=\'text\' ref={this.input} />\n      </label>\n      <input type=\'submit\' value=\'Submit\' />\n    </form>\n  );\n}\n}`, `37580577684124350000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                js 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">class</span> <span class="token class-name">NameForm</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>\n<span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">super</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token keyword">this</span><span class="token punctuation">.</span>input <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">createRef</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token function-variable function">handleSubmit</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">\'A name was submitted: \'</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>input<span class="token punctuation">.</span>current<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  e<span class="token punctuation">.</span><span class="token function">preventDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n<span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">return</span> <span class="token punctuation">(</span>\n    <span class="token operator">&lt;</span>form onSubmit<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>handleSubmit<span class="token punctuation">}</span><span class="token operator">></span>\n      <span class="token operator">&lt;</span>label<span class="token operator">></span>\n        Name<span class="token punctuation">:</span>\n        <span class="token operator">&lt;</span>input type<span class="token operator">=</span><span class="token string">\'text\'</span> ref<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>input<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span>\n      <span class="token operator">&lt;</span><span class="token operator">/</span>label<span class="token operator">></span>\n      <span class="token operator">&lt;</span>input type<span class="token operator">=</span><span class="token string">\'submit\'</span> value<span class="token operator">=</span><span class="token string">\'Submit\'</span> <span class="token operator">/</span><span class="token operator">></span>\n    <span class="token operator">&lt;</span><span class="token operator">/</span>form<span class="token operator">></span>\n  <span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>因为非受控组件将真实数据储存在 DOM 节点中，所以在使用非受控组件时，有时候反而更容易同时集成 React 和非 React 代码。如果你不介意代码美观性，并且希望快速编写代码，使用非受控组件往往可以减少你的代码量。否则，你应该使用受控组件。</p>\n</li>\n<li>\n<p><strong>媒体播放：</strong>基于 React 的音乐或视频播放器可以利用 Refs 来管理其当前状态（播放/暂停），或管理播放进度等。这些更新不需要进行状态管理。</p>\n</li>\n<li>\n<p><strong>触发强制动画：</strong>如果要在元素上触发过强制动画时，可以使用 Refs 来执行此操作。</p>\n</li>\n<li>\n<p><strong>集成第三方 DOM 库</strong></p>\n</li>\n</ul>\n<h2 id="使用方式"><a href="#%E4%BD%BF%E7%94%A8%E6%96%B9%E5%BC%8F" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>使用方式</h2>\n<p>Refs 有 三种实现：</p>\n<h3 id="方法一：通过-createref-实现"><a href="#%E6%96%B9%E6%B3%95%E4%B8%80%EF%BC%9A%E9%80%9A%E8%BF%87-createref-%E5%AE%9E%E7%8E%B0" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>方法一：通过 createRef 实现</h3>\n<p><code class="language-text">createRef</code> 是 <strong>React v16.3</strong> 新增的 API，允许我们访问 DOM 节点或在 render 方法中创建的 React 元素。</p>\n<p>Refs 是使用 <code class="language-text">React.createRef()</code> 创建的，并通过 <code class="language-text">ref</code> 属性附加到 React 元素。</p>\n<p>Refs 通常在 React 组件的构造函数中定义，或者作为函数组件顶层的变量定义，然后附加到 <code class="language-text">render()</code> 函数中的元素。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="94380447436540530000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`export default class Hello extends React.Component {\n  constructor(props) {\n    super(props);\n    // 创建 ref 存储 textRef DOM 元素\n    this.textRef = React.createRef();\n  }\n  componentDidMount() {\n    // 注意：通过 &quot;current&quot; 取得 DOM 节点\n    // 直接使用原生 API 使 text 输入框获得焦点\n    this.textRef.current.focus();\n  }\n  render() {\n    // 把 <input> ref 关联到构造器里创建的 textRef 上\n    return <input ref={this.textRef} />;\n  }\n}`, `94380447436540530000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                js 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">Hello</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>\n  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">super</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token comment">// 创建 ref 存储 textRef DOM 元素</span>\n    <span class="token keyword">this</span><span class="token punctuation">.</span>textRef <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">createRef</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n  <span class="token function">componentDidMount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token comment">// 注意：通过 "current" 取得 DOM 节点</span>\n    <span class="token comment">// 直接使用原生 API 使 text 输入框获得焦点</span>\n    <span class="token keyword">this</span><span class="token punctuation">.</span>textRef<span class="token punctuation">.</span>current<span class="token punctuation">.</span><span class="token function">focus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token comment">// 把 &lt;input> ref 关联到构造器里创建的 textRef 上</span>\n    <span class="token keyword">return</span> <span class="token operator">&lt;</span>input ref<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>textRef<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>使用 <code class="language-text">React.createRef()</code> 给组件创建了 Refs 对象。在上面的示例中，ref 被命名 <code class="language-text">textRef</code>，然后将其附加到 <code class="language-text">&lt;input&gt;</code> DOM 元素。</p>\n<p>其中， <code class="language-text">textRef</code> 的属性 <code class="language-text">current</code> 指的是当前附加到 ref 的元素，并广泛用于访问和修改我们的附加元素。事实上，如果我们通过登录 <code class="language-text">myRef</code> 控制台进一步扩展我们的示例，我们将看到该 <code class="language-text">current</code> 属性确实是<em>唯一</em>可用的属性：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="30951788481816035000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`componentDidMount = () => {\n  // myRef 仅仅有一个 current 属性\n  console.log(this.textRef);\n  // myRef.current\n  console.log(this.textRef.current);\n  // component 渲染完成后，使 text 输入框获得焦点\n  this.textRef.current.focus();\n};`, `30951788481816035000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                js 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token function-variable function">componentDidMount</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n  <span class="token comment">// myRef 仅仅有一个 current 属性</span>\n  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>textRef<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token comment">// myRef.current</span>\n  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>textRef<span class="token punctuation">.</span>current<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token comment">// component 渲染完成后，使 text 输入框获得焦点</span>\n  <span class="token keyword">this</span><span class="token punctuation">.</span>textRef<span class="token punctuation">.</span>current<span class="token punctuation">.</span><span class="token function">focus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>在 <code class="language-text">componentDidMount</code> 生命周期阶段，<code class="language-text">myRef.current</code> 将按预期分配给我们的 <code class="language-text">&lt;input&gt;</code> 元素; <code class="language-text">componentDidMount</code> 通常是使用 refs 处理一些初始设置的安全位置。</p>\n<p>我们不能在 <code class="language-text">componentWillMount</code> 中更新 Refs，因为此时，组件还没渲染完成， Refs 还为 <code class="language-text">null</code>。</p>\n<h3 id="方法二：回调-refs"><a href="#%E6%96%B9%E6%B3%95%E4%BA%8C%EF%BC%9A%E5%9B%9E%E8%B0%83-refs" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>方法二：回调 Refs</h3>\n<p>不同于传递 <code class="language-text">createRef()</code> 创建的 <code class="language-text">ref</code> 属性，你会传递一个函数。这个函数中接受 React 组件实例或 HTML DOM 元素作为参数，以使它们能在其他地方被存储和访问。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="94819647361664090000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`import React from \'react\';\nexport default class Hello extends React.Component {\n  constructor(props) {\n    super(props);\n    this.textRef = null; // 创建 ref 为 null\n  }\n  componentDidMount() {\n    // 注意：这里没有使用 &quot;current&quot;\n    // 直接使用原生 API 使 text 输入框获得焦点\n    this.textRef.focus();\n  }\n  render() {\n    // 把 <input> ref 关联到构造器里创建的 textRef 上\n    return <input ref={(node) => (this.textRef = node)} />;\n  }\n}`, `94819647361664090000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                js 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">\'react\'</span><span class="token punctuation">;</span>\n<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">Hello</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>\n  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">super</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">this</span><span class="token punctuation">.</span>textRef <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span> <span class="token comment">// 创建 ref 为 null</span>\n  <span class="token punctuation">}</span>\n  <span class="token function">componentDidMount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token comment">// 注意：这里没有使用 "current"</span>\n    <span class="token comment">// 直接使用原生 API 使 text 输入框获得焦点</span>\n    <span class="token keyword">this</span><span class="token punctuation">.</span>textRef<span class="token punctuation">.</span><span class="token function">focus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token comment">// 把 &lt;input> ref 关联到构造器里创建的 textRef 上</span>\n    <span class="token keyword">return</span> <span class="token operator">&lt;</span>input ref<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token parameter">node</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>textRef <span class="token operator">=</span> node<span class="token punctuation">)</span><span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>React 将在组件挂载时将 DOM 元素传入<code class="language-text">ref</code> 回调函数并调用，当卸载时传入 <code class="language-text">null</code> 并调用它。在 <code class="language-text">componentDidMount</code> 或 <code class="language-text">componentDidUpdate</code> 触发前，React 会保证 refs 一定是最新的。</p>\n<p>像上例， <code class="language-text">ref</code> 回调函数是以内联函数的方式定义的，在更新过程中它会被执行两次，第一次传入参数 <code class="language-text">null</code>，然后第二次会传入参数 DOM 元素。</p>\n<p>这是因为在每次渲染时会创建一个新的函数实例，所以 React 清空旧的 ref 并且设置新的。我们可以通过将 ref 的回调函数定义成 class 的绑定函数的方式可以避免上述问题，但是大多数情况下它是无关紧要的。</p>\n<h3 id="方法三：通过-stringref-实现"><a href="#%E6%96%B9%E6%B3%95%E4%B8%89%EF%BC%9A%E9%80%9A%E8%BF%87-stringref-%E5%AE%9E%E7%8E%B0" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>方法三：通过 stringRef 实现</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="5978375114897072000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`export default class Hello extends React.Component {\n  constructor(props) {\n    super(props);\n  }\n  componentDidMount() {\n    // 通过 this.refs 调用\n    // 直接使用原生 API 使 text 输入框获得焦点\n    this.refs.textRef.focus();\n  }\n  render() {\n    // 把 <input> ref 关联到构造器里创建的 textRef 上\n    return <input ref=\'textRef\' />;\n  }\n}`, `5978375114897072000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                js 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">Hello</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>\n  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">super</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n  <span class="token function">componentDidMount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token comment">// 通过 this.refs 调用</span>\n    <span class="token comment">// 直接使用原生 API 使 text 输入框获得焦点</span>\n    <span class="token keyword">this</span><span class="token punctuation">.</span>refs<span class="token punctuation">.</span>textRef<span class="token punctuation">.</span><span class="token function">focus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token comment">// 把 &lt;input> ref 关联到构造器里创建的 textRef 上</span>\n    <span class="token keyword">return</span> <span class="token operator">&lt;</span>input ref<span class="token operator">=</span><span class="token string">\'textRef\'</span> <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>尽管字符串 stringRef 使用更方便，但是它有<a href="https://github.com/facebook/react/issues/1373" target="_blank" rel="nofollow noreferrer noopener">一些缺点</a>，因此严格模式使用 stringRef 会报警告。官方推荐采用回调 Refs。</p>\n<h2 id="注意"><a href="#%E6%B3%A8%E6%84%8F" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>注意</h2>\n<ul>\n<li>当 <code class="language-text">ref</code> 属性被用于一个普通的 HTML 元素时，<code class="language-text">React.createRef()</code> 将接收底层 DOM 元素作为它的 <code class="language-text">current</code> 属性以创建 <code class="language-text">ref</code> ，我们可以通过 Refs 访问 DOM 元素属性。</li>\n<li>当 <code class="language-text">ref</code> 属性被用于一个自定义 class 组件时，<code class="language-text">ref</code> 对象将接收该组件已挂载的实例作为它的 <code class="language-text">current</code>，与 <code class="language-text">ref</code> 用于 HTML 元素不同的是，我们能够通过 <code class="language-text">ref</code> 访问该组件的 props，state，方法以及它的整个原型 。</li>\n<li>ref 是为了获取某个节点是实例，所以 <strong>你不能在函数式组件上使用 ref 属性</strong>，因为它们没有实例。</li>\n<li>推荐使用 <strong>回调形式的 refs</strong>， <code class="language-text">stringRef</code> 将会废弃（严格模式下使用会报警告），<code class="language-text">React.createRef()</code> API 是 React v16.3 引入的更新。</li>\n<li>避免使用 refs 来做任何可以通过 <strong>声明式</strong> 实现来完成的事情</li>\n</ul>\n<h1 id="createref-与-hook-useref"><a href="#createref-%E4%B8%8E-hook-useref" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>createRef 与 Hook useRef</h1>\n<h2 id="useref"><a href="#useref" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>useRef</h2>\n<p><code class="language-text">useRef</code> 返回一个可变的 ref 对象，其 <code class="language-text">.current</code> 属性被初始化为传入的值。返回的 ref 对象在组件的整个生命周期内保持不变。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="44625149094152380000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`function Hello() {\n  const textRef = useRef(null);\n  const onButtonClick = () => {\n    // 注意：通过 &quot;current&quot; 取得 DOM 节点\n    textRef.current.focus();\n  };\n  return (\n    <>\n      <input ref={textRef} type=\'text\' />\n      <button onClick={onButtonClick}>Focus the input</button>\n    </>\n  );\n}`, `44625149094152380000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                js 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">function</span> <span class="token function">Hello</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">const</span> textRef <span class="token operator">=</span> <span class="token function">useRef</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token keyword">const</span> <span class="token function-variable function">onButtonClick</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n    <span class="token comment">// 注意：通过 "current" 取得 DOM 节点</span>\n    textRef<span class="token punctuation">.</span>current<span class="token punctuation">.</span><span class="token function">focus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span><span class="token punctuation">;</span>\n  <span class="token keyword">return</span> <span class="token punctuation">(</span>\n    <span class="token operator">&lt;</span><span class="token operator">></span>\n      <span class="token operator">&lt;</span>input ref<span class="token operator">=</span><span class="token punctuation">{</span>textRef<span class="token punctuation">}</span> type<span class="token operator">=</span><span class="token string">\'text\'</span> <span class="token operator">/</span><span class="token operator">></span>\n      <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span>onButtonClick<span class="token punctuation">}</span><span class="token operator">></span>Focus the input<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">></span>\n    <span class="token operator">&lt;</span><span class="token operator">/</span><span class="token operator">></span>\n  <span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id="区别"><a href="#%E5%8C%BA%E5%88%AB" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>区别</h2>\n<p><code class="language-text">useRef()</code> 比 <code class="language-text">ref</code> 属性更有用。<code class="language-text">useRef()</code> Hook 不仅可以用于 DOM refs， <code class="language-text">useRef()</code> 创建的 <code class="language-text">ref</code> 对象是一个 <code class="language-text">current</code> 属性可变且可以容纳任意值的通用容器，类似于一个 class 的实例属性。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="42575800173571630000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`function Timer() {\n  const intervalRef = useRef();\n\n  useEffect(() => {\n    const id = setInterval(() => {\n      // ...\n    });\n    intervalRef.current = id;\n    return () => {\n      clearInterval(intervalRef.current);\n    };\n  });\n\n  // ...\n}`, `42575800173571630000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                js 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">function</span> <span class="token function">Timer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">const</span> intervalRef <span class="token operator">=</span> <span class="token function">useRef</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n    <span class="token keyword">const</span> id <span class="token operator">=</span> <span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n      <span class="token comment">// ...</span>\n    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    intervalRef<span class="token punctuation">.</span>current <span class="token operator">=</span> id<span class="token punctuation">;</span>\n    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n      <span class="token function">clearInterval</span><span class="token punctuation">(</span>intervalRef<span class="token punctuation">.</span>current<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n  <span class="token comment">// ...</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>这是因为它创建的是一个普通 Javascript 对象。而 <code class="language-text">useRef()</code> 和自建一个 <code class="language-text">{current: ...}</code>对象的唯一区别是，<code class="language-text">useRef</code> 会在每次渲染时返回同一个 ref 对象。</p>\n<p>请记住，当 ref 对象内容发生变化时，<code class="language-text">useRef</code> 并<em>不会</em>通知你。变更 <code class="language-text">.current</code> 属性不会引发组件重新渲染。如果想要在 React 绑定或解绑 DOM 节点的 ref 时运行某些代码，则需要使用回调 ref 来实现。</p>\n<h1 id="createref-源码解析"><a href="#createref-%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>createRef 源码解析</h1>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="43285518552798990000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// ReactCreateRef.js 文件\nimport type { RefObject } from \'shared/ReactTypes\';\n\n// an immutable object with a single mutable value\nexport function createRef(): RefObject {\n  const refObject = {\n    current: null\n  };\n  if (__DEV__) {\n    // 封闭对象，阻止添加新属性并将所有现有属性标记为不可配置。当前属性的值只要可写就可以改变。\n    Object.seal(refObject);\n  }\n  return refObject;\n}`, `43285518552798990000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                js 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// ReactCreateRef.js 文件</span>\n<span class="token keyword">import</span> type <span class="token punctuation">{</span> RefObject <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">\'shared/ReactTypes\'</span><span class="token punctuation">;</span>\n\n<span class="token comment">// an immutable object with a single mutable value</span>\n<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">createRef</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> RefObject <span class="token punctuation">{</span>\n  <span class="token keyword">const</span> refObject <span class="token operator">=</span> <span class="token punctuation">{</span>\n    current<span class="token punctuation">:</span> <span class="token keyword">null</span>\n  <span class="token punctuation">}</span><span class="token punctuation">;</span>\n  <span class="token keyword">if</span> <span class="token punctuation">(</span>__DEV__<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token comment">// 封闭对象，阻止添加新属性并将所有现有属性标记为不可配置。当前属性的值只要可写就可以改变。</span>\n    Object<span class="token punctuation">.</span><span class="token function">seal</span><span class="token punctuation">(</span>refObject<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n  <span class="token keyword">return</span> refObject<span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>其中 <code class="language-text">RefObject</code> 为：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="27149364426876387000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`export type RefObject = {\n  current: any\n};`, `27149364426876387000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                js 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">export</span> type RefObject <span class="token operator">=</span> <span class="token punctuation">{</span>\n  current<span class="token punctuation">:</span> any\n<span class="token punctuation">}</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>这就是的 createRef 源码，实现很简单，但具体的它如何使用，如何挂载，将在后面的 React 渲染中介绍，敬请期待。</p>',
id:"/github/workspace/blog/React之createRef入门学习/index.md absPath of file >>> MarkdownRemark",timeToRead:5,frontmatter:{date:"2019-09-20 14:56:20",path:"/react-createRef-practice-learn/",tags:"前端, React, createRef",title:"React之createRef入门学习",draft:null}},{excerpt:"forwardRef 在   中已经介绍过，有三种方式可以使用 React 元素的 ref ref 是为了获取某个节点的实例，但是 函数式组件（PureComponent） 是没有实例的，不存在 this 的，这种时候是拿不到函数式组件的 ref 的。 为了解决这个问题，由此引入  ，   允许某些组件接收 ref，并将其向下传递给 子组件 只在使用   定义组件时， 第二个参数 ref…",html:'<h1 id="forwardref"><a href="#forwardref" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>forwardRef</h1>\n<p>在 <code class="language-text">React.createRef</code> 中已经介绍过，有三种方式可以使用 React 元素的 ref</p>\n<p>ref 是为了获取某个节点的实例，但是 函数式组件（PureComponent） 是没有实例的，不存在 this 的，这种时候是拿不到函数式组件的 ref 的。</p>\n<p>为了解决这个问题，由此引入 <code class="language-text">React.forwardRef</code>， <strong><code class="language-text">React.forwardRef</code> 允许某些组件接收 ref，并将其向下传递给 子组件</strong></p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="44912476439511015000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`const ForwardInput = React.forwardRef((props, ref) => (\n  <input ref={ref} />\n));\n\nclass TestComponent extends React.Component {\n  constructor(props) {\n    super(props);\n    this.inputRef = React.createRef(); // 创建 ref 存储 textRef DOM 元素\n  }\n  componentDidMount() {\n    this.inputRef.current.value = \'forwardRef\'\n  }\n  render() {\n    return ( // 可以直接获取到 ForwardInput input 的 ref：\n      <ForwardInput ref={this.inputRef}>\n    )\n  }\n}`, `44912476439511015000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                js 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">const</span> ForwardInput <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">forwardRef</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">props<span class="token punctuation">,</span> ref</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span>\n  <span class="token operator">&lt;</span>input ref<span class="token operator">=</span><span class="token punctuation">{</span>ref<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span>\n<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token keyword">class</span> <span class="token class-name">TestComponent</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>\n  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">super</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">this</span><span class="token punctuation">.</span>inputRef <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">createRef</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 创建 ref 存储 textRef DOM 元素</span>\n  <span class="token punctuation">}</span>\n  <span class="token function">componentDidMount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">this</span><span class="token punctuation">.</span>inputRef<span class="token punctuation">.</span>current<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token string">\'forwardRef\'</span>\n  <span class="token punctuation">}</span>\n  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">return</span> <span class="token punctuation">(</span> <span class="token comment">// 可以直接获取到 ForwardInput input 的 ref：</span>\n      <span class="token operator">&lt;</span>ForwardInput ref<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>inputRef<span class="token punctuation">}</span><span class="token operator">></span>\n    <span class="token punctuation">)</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<ul>\n<li>\n<p>只在使用 <code class="language-text">React.forwardRef</code> 定义组件时，<strong>第二个参数 ref</strong> 才存在</p>\n</li>\n<li>\n<p>在项目中组件库中尽量不要使用 <code class="language-text">React.forwardRef</code> ，因为它可能会导致子组件被 <strong>破坏性更改</strong></p>\n</li>\n<li>\n<p><strong>函数组件 和 class 组件均不接收 <code class="language-text">ref</code> 参数</strong> ，即 props 中不存在 <code class="language-text">ref</code>，<strong>ref 必须独立 props</strong> 出来，否则会被 React 特殊处理掉。</p>\n</li>\n<li>\n<p><strong>通常在 高阶组件（HOC） 中使用 <code class="language-text">React.forwardRef</code></strong></p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="97589624386226000000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`function enhance(WrappedComponent) {\nclass Enhance extends React.Component {\n  componentWillReceiveProps(nextProps) {\n    console.log(\'Current props: \', this.props);\n    console.log(\'Next props: \', nextProps);\n  }\n  render() {\n    const { forwardedRef, ...others } = this.props;\n    // 将自定义的 prop 属性 “forwardedRef” 定义为 ref\n    return <WrappedComponent ref={forwardedRef} {...others} />;\n  }\n}\n// 注意 React.forwardRef 回调的第二个参数 “ref”。\n// 我们可以将其作为常规 prop 属性传递给 Enhance，例如 “forwardedRef”\n// 然后它就可以被挂载到被 Enhance 包裹的子组件上。\nreturn React.forwardRef((props, ref) => {\n  return <Enhance {...props} forwardedRef={ref} />;\n});\n}\n\n// 子组件\nclass MyComponent extends React.Component {\nfocus() {\n  // ...\n}\n// ...\n}\n\n// EnhancedComponent 会渲染一个高阶组件 enhance(MyComponent)\nconst EnhancedComponent = enhance(MyComponent);\n\nconst ref = React.createRef();\n\n// 我们导入的 EnhancedComponent 组件是高阶组件（HOC）Enhance。\n// 通过React.forwardRef 将 ref 将指向了 Enhance 内部的 MyComponent 组件\n// 这意味着我们可以直接调用 ref.current.focus() 方法\n<EnhancedComponent label=\'Click Me\' handleClick={handleClick} ref={ref} />;`, `97589624386226000000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                js 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">function</span> <span class="token function">enhance</span><span class="token punctuation">(</span><span class="token parameter">WrappedComponent</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n<span class="token keyword">class</span> <span class="token class-name">Enhance</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>\n  <span class="token function">componentWillReceiveProps</span><span class="token punctuation">(</span><span class="token parameter">nextProps</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">\'Current props: \'</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">\'Next props: \'</span><span class="token punctuation">,</span> nextProps<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">const</span> <span class="token punctuation">{</span> forwardedRef<span class="token punctuation">,</span> <span class="token operator">...</span>others <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">;</span>\n    <span class="token comment">// 将自定义的 prop 属性 “forwardedRef” 定义为 ref</span>\n    <span class="token keyword">return</span> <span class="token operator">&lt;</span>WrappedComponent ref<span class="token operator">=</span><span class="token punctuation">{</span>forwardedRef<span class="token punctuation">}</span> <span class="token punctuation">{</span><span class="token operator">...</span>others<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n<span class="token comment">// 注意 React.forwardRef 回调的第二个参数 “ref”。</span>\n<span class="token comment">// 我们可以将其作为常规 prop 属性传递给 Enhance，例如 “forwardedRef”</span>\n<span class="token comment">// 然后它就可以被挂载到被 Enhance 包裹的子组件上。</span>\n<span class="token keyword">return</span> React<span class="token punctuation">.</span><span class="token function">forwardRef</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">props<span class="token punctuation">,</span> ref</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n  <span class="token keyword">return</span> <span class="token operator">&lt;</span>Enhance <span class="token punctuation">{</span><span class="token operator">...</span>props<span class="token punctuation">}</span> forwardedRef<span class="token operator">=</span><span class="token punctuation">{</span>ref<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token comment">// 子组件</span>\n<span class="token keyword">class</span> <span class="token class-name">MyComponent</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>\n<span class="token function">focus</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token comment">// ...</span>\n<span class="token punctuation">}</span>\n<span class="token comment">// ...</span>\n<span class="token punctuation">}</span>\n\n<span class="token comment">// EnhancedComponent 会渲染一个高阶组件 enhance(MyComponent)</span>\n<span class="token keyword">const</span> EnhancedComponent <span class="token operator">=</span> <span class="token function">enhance</span><span class="token punctuation">(</span>MyComponent<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token keyword">const</span> ref <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">createRef</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token comment">// 我们导入的 EnhancedComponent 组件是高阶组件（HOC）Enhance。</span>\n<span class="token comment">// 通过React.forwardRef 将 ref 将指向了 Enhance 内部的 MyComponent 组件</span>\n<span class="token comment">// 这意味着我们可以直接调用 ref.current.focus() 方法</span>\n<span class="token operator">&lt;</span>EnhancedComponent label<span class="token operator">=</span><span class="token string">\'Click Me\'</span> handleClick<span class="token operator">=</span><span class="token punctuation">{</span>handleClick<span class="token punctuation">}</span> ref<span class="token operator">=</span><span class="token punctuation">{</span>ref<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n</li>\n</ul>\n<h1 id="forwardref-与-hook-useimperativehandle"><a href="#forwardref-%E4%B8%8E-hook-useimperativehandle" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>forwardRef 与 Hook useImperativeHandle</h1>\n<p><code class="language-text">useImperativeHandle</code> 可以让你在使用 <code class="language-text">ref</code> 时自定义暴露给父组件的实例值。在大多数情况下，应当避免使用 ref 这样的命令式代码。<code class="language-text">useImperativeHandle</code> 应当与 <code class="language-text">forwardRef</code>一起使用：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="28951754972798116000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`function FancyInput(props, ref) {\n  const inputRef = useRef();\n  useImperativeHandle(ref, () => ({\n    focus: () => {\n      inputRef.current.focus();\n    }\n  }));\n  return <input ref={inputRef} ... />;\n}\nFancyInput = forwardRef(FancyInput);`, `28951754972798116000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                js 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">function</span> <span class="token function">FancyInput</span><span class="token punctuation">(</span><span class="token parameter">props<span class="token punctuation">,</span> ref</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">const</span> inputRef <span class="token operator">=</span> <span class="token function">useRef</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token function">useImperativeHandle</span><span class="token punctuation">(</span>ref<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">{</span>\n    <span class="token function-variable function">focus</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n      inputRef<span class="token punctuation">.</span>current<span class="token punctuation">.</span><span class="token function">focus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token keyword">return</span> <span class="token operator">&lt;</span>input ref<span class="token operator">=</span><span class="token punctuation">{</span>inputRef<span class="token punctuation">}</span> <span class="token operator">...</span> <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\nFancyInput <span class="token operator">=</span> <span class="token function">forwardRef</span><span class="token punctuation">(</span>FancyInput<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>在本例中，渲染 <code class="language-text">&lt;FancyInput ref={fancyInputRef} /&gt;</code> 的父组件可以调用 <code class="language-text">fancyInputRef.current.focus()</code>。</p>\n<h1 id="源码解读"><a href="#%E6%BA%90%E7%A0%81%E8%A7%A3%E8%AF%BB" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>源码解读</h1>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="75695866928988980000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`export default function forwardRef<Props, ElementType: React\\$ElementType>(\n  render: (props: Props, ref: React\\$Ref<ElementType>) => React\\$Node\n) {\n  if (__DEV__) {\n    if (render != null && render.\\$\\$typeof === REACT_MEMO_TYPE) {\n      warningWithoutStack(\n        false,\n        \'forwardRef requires a render function but received a \\`memo\\` \' +\n          \'component. Instead of forwardRef(memo(...)), use \' +\n          \'memo(forwardRef(...)).\'\n      );\n    } else if (typeof render !== \'function\') {\n      warningWithoutStack(\n        false,\n        \'forwardRef requires a render function but was given %s.\',\n        render === null ? \'null\' : typeof render\n      );\n    } else {\n      warningWithoutStack(\n        // Do not warn for 0 arguments because it could be due to usage of the \'arguments\' object\n        render.length === 0 || render.length === 2,\n        \'forwardRef render functions accept exactly two parameters: props and ref. %s\',\n        render.length === 1 ? \'Did you forget to use the ref parameter?\' : \'Any additional parameter will be undefined.\'\n      );\n    }\n\n    if (render != null) {\n      warningWithoutStack(\n        render.defaultProps == null && render.propTypes == null,\n        \'forwardRef render functions do not support propTypes or defaultProps. \' +\n          \'Did you accidentally pass a React component?\'\n      );\n    }\n  }\n\n  /**\n   * REACT_FORWARD_REF_TYPE 并不是 React.forwardRef 创建的实例的 \\$\\$typeof\n   * React.forwardRef 返回的是一个对象，而 ref 是通过实例的参数形式传递进去的，\n   * 实际上，React.forwardRef 返回的是一个 ReactElement，它的 \\$\\$typeof 也就是 REACT_ELEMENT_TYPE\n   * 而 返回的对象 是作为 ReactElement 的 type 存在\n   */\n  return {\n    // 返回一个对象\n    \\$\\$typeof: REACT_FORWARD_REF_TYPE, // 并不是 React.forwardRef 创建的实例的 \\$\\$typeof\n    render // 函数组件\n  };\n}`, `75695866928988980000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                js 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> forwardRef<span class="token operator">&lt;</span>Props<span class="token punctuation">,</span> ElementType<span class="token punctuation">:</span> React$ElementType<span class="token operator">></span><span class="token punctuation">(</span>\n  <span class="token function-variable function">render</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token parameter">props<span class="token punctuation">:</span> Props<span class="token punctuation">,</span> ref<span class="token punctuation">:</span> React$Ref<span class="token operator">&lt;</span>ElementType<span class="token operator">></span></span><span class="token punctuation">)</span> <span class="token operator">=></span> React$Node\n<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">if</span> <span class="token punctuation">(</span>__DEV__<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">if</span> <span class="token punctuation">(</span>render <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> render<span class="token punctuation">.</span>$$<span class="token keyword">typeof</span> <span class="token operator">===</span> <span class="token constant">REACT_MEMO_TYPE</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token function">warningWithoutStack</span><span class="token punctuation">(</span>\n        <span class="token boolean">false</span><span class="token punctuation">,</span>\n        <span class="token string">\'forwardRef requires a render function but received a `memo` \'</span> <span class="token operator">+</span>\n          <span class="token string">\'component. Instead of forwardRef(memo(...)), use \'</span> <span class="token operator">+</span>\n          <span class="token string">\'memo(forwardRef(...)).\'</span>\n      <span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> render <span class="token operator">!==</span> <span class="token string">\'function\'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token function">warningWithoutStack</span><span class="token punctuation">(</span>\n        <span class="token boolean">false</span><span class="token punctuation">,</span>\n        <span class="token string">\'forwardRef requires a render function but was given %s.\'</span><span class="token punctuation">,</span>\n        render <span class="token operator">===</span> <span class="token keyword">null</span> <span class="token operator">?</span> <span class="token string">\'null\'</span> <span class="token punctuation">:</span> <span class="token keyword">typeof</span> render\n      <span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>\n      <span class="token function">warningWithoutStack</span><span class="token punctuation">(</span>\n        <span class="token comment">// Do not warn for 0 arguments because it could be due to usage of the \'arguments\' object</span>\n        render<span class="token punctuation">.</span>length <span class="token operator">===</span> <span class="token number">0</span> <span class="token operator">||</span> render<span class="token punctuation">.</span>length <span class="token operator">===</span> <span class="token number">2</span><span class="token punctuation">,</span>\n        <span class="token string">\'forwardRef render functions accept exactly two parameters: props and ref. %s\'</span><span class="token punctuation">,</span>\n        render<span class="token punctuation">.</span>length <span class="token operator">===</span> <span class="token number">1</span> <span class="token operator">?</span> <span class="token string">\'Did you forget to use the ref parameter?\'</span> <span class="token punctuation">:</span> <span class="token string">\'Any additional parameter will be undefined.\'</span>\n      <span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n\n    <span class="token keyword">if</span> <span class="token punctuation">(</span>render <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token function">warningWithoutStack</span><span class="token punctuation">(</span>\n        render<span class="token punctuation">.</span>defaultProps <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> render<span class="token punctuation">.</span>propTypes <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">,</span>\n        <span class="token string">\'forwardRef render functions do not support propTypes or defaultProps. \'</span> <span class="token operator">+</span>\n          <span class="token string">\'Did you accidentally pass a React component?\'</span>\n      <span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n  <span class="token punctuation">}</span>\n\n  <span class="token comment">/**\n   * REACT_FORWARD_REF_TYPE 并不是 React.forwardRef 创建的实例的 $$typeof\n   * React.forwardRef 返回的是一个对象，而 ref 是通过实例的参数形式传递进去的，\n   * 实际上，React.forwardRef 返回的是一个 ReactElement，它的 $$typeof 也就是 REACT_ELEMENT_TYPE\n   * 而 返回的对象 是作为 ReactElement 的 type 存在\n   */</span>\n  <span class="token keyword">return</span> <span class="token punctuation">{</span>\n    <span class="token comment">// 返回一个对象</span>\n    $$<span class="token keyword">typeof</span><span class="token punctuation">:</span> <span class="token constant">REACT_FORWARD_REF_TYPE</span><span class="token punctuation">,</span> <span class="token comment">// 并不是 React.forwardRef 创建的实例的 $$typeof</span>\n    render <span class="token comment">// 函数组件</span>\n  <span class="token punctuation">}</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>',id:"/github/workspace/blog/React之forwardRef入门学习/index.md absPath of file >>> MarkdownRemark",timeToRead:3,frontmatter:{date:"2019-09-20 14:35:44",path:"/react-forwardRef-practice-learn/",tags:"前端, React, forwardRef",title:"React之forwardRef入门学习",draft:null}}],length:133,tag:"前端",pagesSum:27,page:16}}}});