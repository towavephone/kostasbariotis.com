webpackJsonp([53943148813198],{1266:function(n,s){n.exports={data:{site:{siteMetadata:{title:"女王控的博客",description:'前端工程师，黑猫女王控，欢迎勾搭，技术相关<a href="https://github.com/towavephone" target="_blank">@towavephone</a>，QQ闲聊<a href="tencent://AddContact/?fromId=45&fromSubId=1&subcmd=all&uin=634407147&website=www.oicqzone.com">@towave</a>，bili关注<a href="https://space.bilibili.com/11507708#/" target="_blank">@towave</a>',siteUrl:"https://blog.towavephone.com"}}},pathContext:{posts:[{excerpt:"出发点 主要是为了弥补当前 JS 没有标准的缺陷，以达到像 Python、Ruby 和 Java 具备开发大型应用的基础能力。CommonJS API 是以在浏览器环境之外构建 JS 生态系统为目标而产生的项目，比如服务器端 JS 应用程序、命令行工具、桌面图形界面应用程序等。如今，规范涵盖了模块、二进制、Buffer、字符集编码、I/O 流、进程环境、文件系统、套接字，单元测试、Web 服务器网管接口、包管理等。 CommonJS 的模块规范 CommonJS…",html:'<h1 id="出发点"><a href="#%E5%87%BA%E5%8F%91%E7%82%B9" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>出发点</h1>\n<p>主要是为了弥补当前 JS 没有标准的缺陷，以达到像 Python、Ruby 和 Java 具备开发大型应用的基础能力。CommonJS API 是以在浏览器环境之外构建 JS 生态系统为目标而产生的项目，比如服务器端 JS 应用程序、命令行工具、桌面图形界面应用程序等。如今，规范涵盖了模块、二进制、Buffer、字符集编码、I/O 流、进程环境、文件系统、套接字，单元测试、Web 服务器网管接口、包管理等。</p>\n<h1 id="commonjs-的模块规范"><a href="#commonjs-%E7%9A%84%E6%A8%A1%E5%9D%97%E8%A7%84%E8%8C%83" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>CommonJS 的模块规范</h1>\n<p>CommonJS 对模块的定义主要分为模块引用、模块定义和模块标识 3 个部分</p>\n<h2 id="模块引用"><a href="#%E6%A8%A1%E5%9D%97%E5%BC%95%E7%94%A8" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>模块引用</h2>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="3658371190236598000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`var math = require(\'math\');`, `3658371190236598000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                js 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">var</span> math <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'math\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>在 CommonJS 规范中，存在一个<code class="language-text">require()</code>方法，这个方法接收模块标识，一次引入一个模块的 API 到当前上下文中。</p>\n<h2 id="模块定义"><a href="#%E6%A8%A1%E5%9D%97%E5%AE%9A%E4%B9%89" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>模块定义</h2>\n<p>在模块中，上下文提供<code class="language-text">require()</code>方法引入外部模块。对应引入的功能，上下文提供一个<code class="language-text">exports</code>对象导出当前模块的方法或变量，并且它是唯一的导出出口，同时模块中还存在一个<code class="language-text">module</code>对象，它代表的是当前模块，<code class="language-text">exports</code>是<code class="language-text">module</code>的属性。所以，在 Node 中，一个文件就是一个模块，将方法或属性挂载在<code class="language-text">exports</code>对象上作为属性即可定义导出的方式。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="22158351893314544000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// math.js\nexports.add = function() {\n  var sum = 0,\n    i = 0,\n    args = arguments,\n    l = args.length;\n  while (i < 1) {\n    sum += args[i++];\n  }\n  return sum;\n};`, `22158351893314544000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                js 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// math.js</span>\nexports<span class="token punctuation">.</span><span class="token function-variable function">add</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">var</span> sum <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span>\n    i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span>\n    args <span class="token operator">=</span> arguments<span class="token punctuation">,</span>\n    l <span class="token operator">=</span> args<span class="token punctuation">.</span>length<span class="token punctuation">;</span>\n  <span class="token keyword">while</span> <span class="token punctuation">(</span>i <span class="token operator">&lt;</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    sum <span class="token operator">+=</span> args<span class="token punctuation">[</span>i<span class="token operator">++</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n  <span class="token keyword">return</span> sum<span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>在其他文件中，通过<code class="language-text">require()</code>方法引入模块</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="95257708458119050000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// program.js\nvar math = require(\'math\');\nexports.increment = function(val) {\n  return math.add(val, 1);\n};`, `95257708458119050000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                js 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// program.js</span>\n<span class="token keyword">var</span> math <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'math\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\nexports<span class="token punctuation">.</span><span class="token function-variable function">increment</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">val</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">return</span> math<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>val<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id="模块标识"><a href="#%E6%A8%A1%E5%9D%97%E6%A0%87%E8%AF%86" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>模块标识</h2>\n<p>模块标识就是传递给<code class="language-text">require()</code>方法的参数，采用小驼峰命名，或者以<code class="language-text">.</code>、<code class="language-text">..</code>开头的相对路径或绝对路径。它可以不加文件后缀.js。</p>\n<p>\n  <a\n    class="gatsby-resp-image-link"\n    href="/static/2019-09-24-14-41-43-27eea99fa3b798045719775e8a4014b6-bf330.png"\n    style="display: block"\n    target="_blank"\n    rel="noopener"\n  >\n  \n  <span\n    class="gatsby-resp-image-wrapper"\n    style="position: relative; display: block; ; max-width: 347px; margin-left: auto; margin-right: auto;"\n  >\n    <span\n      class="gatsby-resp-image-background-image"\n      style="padding-bottom: 44.38040345821326%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAIAAAC9o5sfAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAA40lEQVQoz42R2wqDMBBE8/9/KCpeQEHxUjXWW9SeZksQ24fOwxIzM5vZVVVVNQxD13Va66eFtjgtjuOgzvPctu3DwsmAKooijmPf98dxFMO+76iv5nVdy7IMwzCKIkcBRUt6TNO0LMts0fe9ayRmKNJBcaARB/RoVNM00HVde56XpqkxhlvioJNsSCUwsizLgiBIkoR0CBS327bRSebhPFrcZuZlKLcdnFgUH0ih4eQ1YlNvsUlrLkBMfcdGQc3znK1I7Nu2MaM+v/Ax88OYhFER8ez3wn6bZY1w6HhWkjPPP+YXWK8JxSBx7JoAAAAASUVORK5CYII=\'); background-size: cover; display: block;"\n    >\n      <img\n        class="gatsby-resp-image-image"\n        style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;"\n        alt="2019 09 24 14 41 43"\n        title=""\n        src="/static/2019-09-24-14-41-43-27eea99fa3b798045719775e8a4014b6-bf330.png"\n        srcset="/static/2019-09-24-14-41-43-27eea99fa3b798045719775e8a4014b6-637d1.png 200w,\n/static/2019-09-24-14-41-43-27eea99fa3b798045719775e8a4014b6-bf330.png 347w"\n        sizes="(max-width: 347px) 100vw, 347px"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<p>CommonJS 对模块的定义意义主要在于将类聚的方法或变量等限定在私有的作用域内，同时支持引入和导出功能以顺畅的连接上下游依赖。</p>\n<ul>\n<li>模块内所有的变量或方法都运行在模块作用域内，不会污染全局作用域</li>\n<li>模块可以多次加载，但每次加载只会运行一次，并将运行结果缓存，以待下次使用，如果想要模块再次运行，则需要清除缓存</li>\n<li>模块加载顺序和代码运行顺序一致</li>\n</ul>\n<p>CommonJS 构建的这套模块导出或引用机制使得用户完全不必考虑变量污染，命名空间等方案与之相比相形见绌。</p>\n<h1 id="module-对象"><a href="#module-%E5%AF%B9%E8%B1%A1" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>module 对象</h1>\n<h2 id="module"><a href="#module" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>module</h2>\n<p>通常一个<code class="language-text">module</code>有以下几个属性</p>\n<ul>\n<li>\n<p>module.id 模块的识别符，通常是带有绝对路径的模块文件名</p>\n</li>\n<li>\n<p>module.filename 模块文件名，带有绝对路径</p>\n</li>\n<li>\n<p>module.loaded 返回一个 boolean 值，标识模块是否已经加载完成</p>\n</li>\n<li>\n<p>module.parent 返回调用该模块的对象</p>\n</li>\n<li>\n<p>module.children 返回该模块调用的其他模块数组</p>\n</li>\n<li>\n<p>module.exports 返回该模块对外的输出</p>\n</li>\n<li>\n<p>module.paths 模块的搜索路径例如：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="42334693094165450000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// math.js\nexports.add = function() {\nvar sum = 0,\n  i = 0,\n  args = arguments,\n  l = args.length;\nwhile (i < 1) {\n  sum += args[i++];\n}\nreturn sum;\n};\nconsole.log(module);`, `42334693094165450000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                js 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// math.js</span>\nexports<span class="token punctuation">.</span><span class="token function-variable function">add</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n<span class="token keyword">var</span> sum <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span>\n  i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span>\n  args <span class="token operator">=</span> arguments<span class="token punctuation">,</span>\n  l <span class="token operator">=</span> args<span class="token punctuation">.</span>length<span class="token punctuation">;</span>\n<span class="token keyword">while</span> <span class="token punctuation">(</span>i <span class="token operator">&lt;</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  sum <span class="token operator">+=</span> args<span class="token punctuation">[</span>i<span class="token operator">++</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n<span class="token keyword">return</span> sum<span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span>\nconsole<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>module<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>它的输出是:</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="54613664266911924000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`Module {\nid: \'/Users/a123/Desktop/Study/wx/server/math.js\',\nexports: { add: [Function] },\nparent:\n Module {\n   id: \'.\',\n   exports: {},\n   parent: null,\n   filename: \'/Users/a123/Desktop/Study/wx/server/app.js\',\n   loaded: false,\n   children: [ [Module], [Module], [Module], [Module], [Module], [Circular] ],\n   paths:\n    [ \'/Users/a123/Desktop/Study/wx/server/node_modules\',\n      \'/Users/a123/Desktop/Study/wx/node_modules\',\n      \'/Users/a123/Desktop/Study/node_modules\',\n      \'/Users/a123/Desktop/node_modules\',\n      \'/Users/a123/node_modules\',\n      \'/Users/node_modules\',\n      \'/node_modules\' ] },\nfilename: \'/Users/a123/Desktop/Study/wx/server/math.js\',\nloaded: false,\nchildren: [],\npaths:\n [ \'/Users/a123/Desktop/Study/wx/server/node_modules\',\n   \'/Users/a123/Desktop/Study/wx/node_modules\',\n   \'/Users/a123/Desktop/Study/node_modules\',\n   \'/Users/a123/Desktop/node_modules\',\n   \'/Users/a123/node_modules\',\n   \'/Users/node_modules\',\n   \'/node_modules\' ] }`, `54613664266911924000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                js 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js">Module <span class="token punctuation">{</span>\nid<span class="token punctuation">:</span> <span class="token string">\'/Users/a123/Desktop/Study/wx/server/math.js\'</span><span class="token punctuation">,</span>\nexports<span class="token punctuation">:</span> <span class="token punctuation">{</span> add<span class="token punctuation">:</span> <span class="token punctuation">[</span>Function<span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>\nparent<span class="token punctuation">:</span>\n Module <span class="token punctuation">{</span>\n   id<span class="token punctuation">:</span> <span class="token string">\'.\'</span><span class="token punctuation">,</span>\n   exports<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>\n   parent<span class="token punctuation">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>\n   filename<span class="token punctuation">:</span> <span class="token string">\'/Users/a123/Desktop/Study/wx/server/app.js\'</span><span class="token punctuation">,</span>\n   loaded<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>\n   children<span class="token punctuation">:</span> <span class="token punctuation">[</span> <span class="token punctuation">[</span>Module<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>Module<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>Module<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>Module<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>Module<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>Circular<span class="token punctuation">]</span> <span class="token punctuation">]</span><span class="token punctuation">,</span>\n   paths<span class="token punctuation">:</span>\n    <span class="token punctuation">[</span> <span class="token string">\'/Users/a123/Desktop/Study/wx/server/node_modules\'</span><span class="token punctuation">,</span>\n      <span class="token string">\'/Users/a123/Desktop/Study/wx/node_modules\'</span><span class="token punctuation">,</span>\n      <span class="token string">\'/Users/a123/Desktop/Study/node_modules\'</span><span class="token punctuation">,</span>\n      <span class="token string">\'/Users/a123/Desktop/node_modules\'</span><span class="token punctuation">,</span>\n      <span class="token string">\'/Users/a123/node_modules\'</span><span class="token punctuation">,</span>\n      <span class="token string">\'/Users/node_modules\'</span><span class="token punctuation">,</span>\n      <span class="token string">\'/node_modules\'</span> <span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>\nfilename<span class="token punctuation">:</span> <span class="token string">\'/Users/a123/Desktop/Study/wx/server/math.js\'</span><span class="token punctuation">,</span>\nloaded<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>\nchildren<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>\npaths<span class="token punctuation">:</span>\n <span class="token punctuation">[</span> <span class="token string">\'/Users/a123/Desktop/Study/wx/server/node_modules\'</span><span class="token punctuation">,</span>\n   <span class="token string">\'/Users/a123/Desktop/Study/wx/node_modules\'</span><span class="token punctuation">,</span>\n   <span class="token string">\'/Users/a123/Desktop/Study/node_modules\'</span><span class="token punctuation">,</span>\n   <span class="token string">\'/Users/a123/Desktop/node_modules\'</span><span class="token punctuation">,</span>\n   <span class="token string">\'/Users/a123/node_modules\'</span><span class="token punctuation">,</span>\n   <span class="token string">\'/Users/node_modules\'</span><span class="token punctuation">,</span>\n   <span class="token string">\'/node_modules\'</span> <span class="token punctuation">]</span> <span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>当 Node.js 直接运行一个文件时，<code class="language-text">require.main</code> 会被设为它的 <code class="language-text">module</code>。 这意味着可以通过 <code class="language-text">require.main === module</code> 来判断一个文件是否被直接运行：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="1139308830863750000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// node app.js\nmath---require.main === module :  false\napp---require.main === module :  true`, `1139308830863750000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                js 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// node app.js</span>\nmath<span class="token operator">--</span><span class="token operator">-</span>require<span class="token punctuation">.</span>main <span class="token operator">===</span> module <span class="token punctuation">:</span>  <span class="token boolean">false</span>\napp<span class="token operator">--</span><span class="token operator">-</span>require<span class="token punctuation">.</span>main <span class="token operator">===</span> module <span class="token punctuation">:</span>  <span class="token boolean">true</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n</li>\n</ul>\n<h2 id="moduleexports"><a href="#moduleexports" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>module.exports</h2>\n<p>module.exports 对象是由模块系统创建的，表示当前文件对外输出的接口。</p>\n<p><strong>注意，对 <code class="language-text">module.exports</code> 的赋值必须立即完成。 不能在任何回调中完成。</strong></p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="11649731918588580000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 创建a.js文件\nconst EventEmitter = require(\'events\');\nmodule.exports = new EventEmitter(); // 赋值\n// 处理一些工作，并在一段时间后从模块自身触发 \'ready\' 事件。\nsetTimeout(() => {\n  module.exports.emit(\'ready\');\n}, 1000);`, `11649731918588580000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                js 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// 创建a.js文件</span>\n<span class="token keyword">const</span> EventEmitter <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'events\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\nmodule<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">EventEmitter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 赋值</span>\n<span class="token comment">// 处理一些工作，并在一段时间后从模块自身触发 \'ready\' 事件。</span>\n<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n  module<span class="token punctuation">.</span>exports<span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">\'ready\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="85229405647143830000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 创建b.js文件\nsetTimeout(() => {\n  module.exports = { a: \'hello\' };\n}, 0);`, `85229405647143830000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                js 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// 创建b.js文件</span>\n<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n  module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span> a<span class="token punctuation">:</span> <span class="token string">\'hello\'</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="97078058680773480000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// app.js 文件中分别调用a、b模块\n\n// 引入a模块\nconst a = require(\'./a\');\na.on(\'ready\', () => {\n  console.log(\'模块 a 已准备好\');\n});\n\n// 引入b模块\nconst b = require(\'./b\');\nconsole.log(b.a);`, `97078058680773480000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                js 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// app.js 文件中分别调用a、b模块</span>\n\n<span class="token comment">// 引入a模块</span>\n<span class="token keyword">const</span> a <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'./a\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\na<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">\'ready\'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">\'模块 a 已准备好\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token comment">// 引入b模块</span>\n<span class="token keyword">const</span> b <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'./b\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\nconsole<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>b<span class="token punctuation">.</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>执行 app.js 结果是：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="32733855808241574000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`undefined\n模块 a 已准备好`, `32733855808241574000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                js 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">undefined</span>\n模块 a 已准备好</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<h2 id="exports"><a href="#exports" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>exports</h2>\n<p><code class="language-text">exports</code> 变量是在模块的文件级别作用域内有效的，它在模块被执行前被赋予 <code class="language-text">module.exports</code> 的值。</p>\n<p>例如： <code class="language-text">module.exports.fun = …</code>，相当于<code class="language-text">exports.fun = ...</code></p>\n<p><strong>但注意，不能将一个值赋值给<code class="language-text">exports</code>，这样它将不在绑定到<code class="language-text">module.exports</code></strong></p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="14221618067242180000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`module.exports.hello = true; // 从对模块的引用中导出\nexports = { hello: false }; // 不导出，只在模块内有效`, `14221618067242180000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                js 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js">module<span class="token punctuation">.</span>exports<span class="token punctuation">.</span>hello <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span> <span class="token comment">// 从对模块的引用中导出</span>\nexports <span class="token operator">=</span> <span class="token punctuation">{</span> hello<span class="token punctuation">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token comment">// 不导出，只在模块内有效</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<h2 id="moduleexports-与-exports"><a href="#moduleexports-%E4%B8%8E-exports" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>module.exports 与 exports</h2>\n<p>在上述介绍中，<code class="language-text">module.exports</code> 与<code class="language-text">exports</code>很容易混淆，下面介绍<code class="language-text">module.exports</code> 与<code class="language-text">exports</code>内部的实现：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="93338943479778180000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 1. 模块引用\nvar module = require(\'./a\');\nmodule.a; // 重要的是 module 这里，module 是 Node 独有的一个变量\n\n// 2. 模块定义\nmodule.exports = {\n  a: 1\n};\n\n// 3.模块内部实现\nfunction require(/* ... */) {\n  const module = {\n    exports: {} // exports 就是一个空对象\n  }(\n    // 这里其实就是包装了一层立即执行函数，这样就不会污染全局变量了\n    (module, exports) => {\n      // 模块代码在这\n      var a = 1; // 如果定义了一个函数。则为 function someFunc() {}\n      exports = a;\n      // 此时，exports 不再是一个 module.exports 的快捷方式，\n      // 且这个模块依然导出一个空的默认对象。\n      module.exports = a; // 这个是为什么 exports 和 module.exports 用法相似的原因\n      // 此时，该模块导出 a，而不是默认对象。\n    }\n  )(module, module.exports);\n  return module.exports;\n}`, `93338943479778180000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                js 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// 1. 模块引用</span>\n<span class="token keyword">var</span> module <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'./a\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\nmodule<span class="token punctuation">.</span>a<span class="token punctuation">;</span> <span class="token comment">// 重要的是 module 这里，module 是 Node 独有的一个变量</span>\n\n<span class="token comment">// 2. 模块定义</span>\nmodule<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>\n  a<span class="token punctuation">:</span> <span class="token number">1</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n<span class="token comment">// 3.模块内部实现</span>\n<span class="token keyword">function</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token comment">/* ... */</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">const</span> module <span class="token operator">=</span> <span class="token punctuation">{</span>\n    exports<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token comment">// exports 就是一个空对象</span>\n  <span class="token punctuation">}</span><span class="token punctuation">(</span>\n    <span class="token comment">// 这里其实就是包装了一层立即执行函数，这样就不会污染全局变量了</span>\n    <span class="token punctuation">(</span><span class="token parameter">module<span class="token punctuation">,</span> exports</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n      <span class="token comment">// 模块代码在这</span>\n      <span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">// 如果定义了一个函数。则为 function someFunc() {}</span>\n      exports <span class="token operator">=</span> a<span class="token punctuation">;</span>\n      <span class="token comment">// 此时，exports 不再是一个 module.exports 的快捷方式，</span>\n      <span class="token comment">// 且这个模块依然导出一个空的默认对象。</span>\n      module<span class="token punctuation">.</span>exports <span class="token operator">=</span> a<span class="token punctuation">;</span> <span class="token comment">// 这个是为什么 exports 和 module.exports 用法相似的原因</span>\n      <span class="token comment">// 此时，该模块导出 a，而不是默认对象。</span>\n    <span class="token punctuation">}</span>\n  <span class="token punctuation">)</span><span class="token punctuation">(</span>module<span class="token punctuation">,</span> module<span class="token punctuation">.</span>exports<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token keyword">return</span> module<span class="token punctuation">.</span>exports<span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id="require"><a href="#require" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>require</h2>\n<p><code class="language-text">require</code>命令的功能是，引入模块。</p>\n<p><code class="language-text">require</code>命令用于加载文件，后缀名默认为<code class="language-text">.js</code>。</p>\n<p><code class="language-text">require</code>的加载顺序是：</p>\n<ul>\n<li>\n<p>以<code class="language-text">/</code>开头，加载绝对路径模块文件</p>\n</li>\n<li>\n<p>以<code class="language-text">./</code>开头，加载相对路径模块文件</p>\n</li>\n<li>\n<p>除以上两种情况外，加载的是一个默认提供的核心模块（位于 Node 的系统安装目录中），或者一个位于各级 node_modules 目录的已安装模块（全局安装或局部安装）。举例来说，脚本/Users/a123/projects/foo.js<code class="language-text">执行了</code>require(‘bar.js’)`命令，Node 会依次搜索以下文件。</p>\n<ul>\n<li>/usr/local/lib/node/bar.js</li>\n<li>/Users/a123/projects/node_modules/bar.js</li>\n<li>/Users/a123/node_modules/bar.js</li>\n<li>/Users/node_modules/bar.js</li>\n<li>/node_modules/bar.js</li>\n</ul>\n</li>\n<li>\n<p>如果指定的模块文件没有发现，Node 会尝试为文件名添加<code class="language-text">.js</code>、<code class="language-text">.json</code>、<code class="language-text">.node</code>后，再去搜索。<code class="language-text">.js</code>件会以文本格式的 JavaScript 脚本文件解析，<code class="language-text">.json</code>文件会以 JSON 格式的文本文件解析，<code class="language-text">.node</code>文件会以编译后的二进制文件解析。</p>\n</li>\n<li>\n<p>如果想得到<code class="language-text">require</code>命令加载的确切文件名，使用<code class="language-text">require.resolve()</code>方法。</p>\n</li>\n</ul>\n<p>通常，我们会把相关的文件放在一个目录里面，便于组织，这就需要给该目录设置一个入口文件，可以让<code class="language-text">require</code>方法通过这个入口文件，加载整个目录，例如<code class="language-text">package.json</code>：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="30699104236133003000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`{\n    &quot;name&quot;: &quot;wx_backend&quot;,\n    &quot;version&quot;: &quot;1.0.0&quot;,\n    &quot;description&quot;: &quot;&quot;,\n    &quot;main&quot;: &quot;app.js&quot;,\n    &quot;scripts&quot;: {\n        &quot;start:node-dev&quot;: &quot;pm2 start process.prod.json --no-daemon  --env development&quot;,\n        &quot;start:node-prod&quot;: &quot;pm2 start process.prod.json --no-daemon  --env production&quot;,\n        &quot;dev&quot;: &quot;nodemon --config nodemon.json app.js&quot;,\n        &quot;initdb&quot;: &quot;npm install && node tools/initdb.js&quot;\n    },\n...\n}`, `30699104236133003000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                js 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token punctuation">{</span>\n    <span class="token string">"name"</span><span class="token punctuation">:</span> <span class="token string">"wx_backend"</span><span class="token punctuation">,</span>\n    <span class="token string">"version"</span><span class="token punctuation">:</span> <span class="token string">"1.0.0"</span><span class="token punctuation">,</span>\n    <span class="token string">"description"</span><span class="token punctuation">:</span> <span class="token string">""</span><span class="token punctuation">,</span>\n    <span class="token string">"main"</span><span class="token punctuation">:</span> <span class="token string">"app.js"</span><span class="token punctuation">,</span>\n    <span class="token string">"scripts"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>\n        <span class="token string">"start:node-dev"</span><span class="token punctuation">:</span> <span class="token string">"pm2 start process.prod.json --no-daemon  --env development"</span><span class="token punctuation">,</span>\n        <span class="token string">"start:node-prod"</span><span class="token punctuation">:</span> <span class="token string">"pm2 start process.prod.json --no-daemon  --env production"</span><span class="token punctuation">,</span>\n        <span class="token string">"dev"</span><span class="token punctuation">:</span> <span class="token string">"nodemon --config nodemon.json app.js"</span><span class="token punctuation">,</span>\n        <span class="token string">"initdb"</span><span class="token punctuation">:</span> <span class="token string">"npm install &amp;&amp; node tools/initdb.js"</span>\n    <span class="token punctuation">}</span><span class="token punctuation">,</span>\n<span class="token operator">...</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p><code class="language-text">require</code>发现参数字符串指向一个目录时，就会自动查看该目录下的<code class="language-text">package.json</code>文件，然后加载<code class="language-text">main</code>指定的入口文件，如果<code class="language-text">package.json</code>中没有<code class="language-text">main</code>字段，或者根本没有<code class="language-text">package.json</code>文件，则会加载该目录下的<code class="language-text">index.js</code>文件或<code class="language-text">index.node</code>文件。</p>\n<p><a href="https://nodejs.org/api/modules.html" target="_blank" rel="nofollow noreferrer noopener">具体可查阅 nodeJS</a></p>\n<h1 id="扩展"><a href="#%E6%89%A9%E5%B1%95" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>扩展</h1>\n<p>前后端 JS 分别搁置在 HTTP 的两端，它们扮演的角色不同，侧重点也不一样。 <strong>浏览器端的 JS 需要经历从一个服务器端分发到多个客户端执行，而服务器端 JS 则是相同的代码需要多次执行。前者的瓶颈在于带宽，后者的瓶颈则在于 CPU 等内存资源。前者需要通过网络加载代码，后者则需要从磁盘中加载，</strong> 两者的加载速度也不是在一个数量级上的。</p>\n<p>纵观 Node 的模块引入过程，几乎全都是同步的，尽管与 Node 强调异步的行为有些相反，但它是合理的，但前端如果也用同步方式引入，试想一下，在 UI 加载的过程中需要花费很多时间来等待脚本加载完成，这会造成用户体验的很大问题。</p>\n<p>鉴于网络的原因， CommonJS 为后端 JS 制定的规范并不完全适合与前端的应用场景，下面来介绍 JS 前端的规范。</p>\n<h2 id="amd"><a href="#amd" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>AMD</h2>\n<p>AMD 是由 RequireJS 提出的，相对于 CommonJS 同步加载来说，AMD 是”Asynchronous Module Definition”（异步模块定义）的缩写。是为浏览器环境专门设计的。</p>\n<p>RequireJS 即为遵循 AMD 规范的模块化工具。 RequireJS 的基本思想是，通过一个函数来将所有所需要的或者说所依赖的模块实现装载进来，然后返回一个新的函数（模块），我们所有的关于新模块的业务代码都在这个函数内部操作，其内部也可无限制的使用已经加载进来的以来的模块。</p>\n<p><strong>define(id?, dependencies?, factory)</strong></p>\n<ul>\n<li>\n<p>id 为字符串类型，表示了模块标识，为可选参数。若不存在则模块标识应该默认定义为在加载器中被请求脚本的标识。如果存在，那么模块标识必须为顶层的或者一个绝对的标识。</p>\n</li>\n<li>\n<p>dependencies ，是一个当前模块依赖的，已被模块定义的模块标识的数组字面量。</p>\n</li>\n<li>\n<p>factory，是一个需要进行实例化的函数或者一个对象。</p>\n</li>\n<li>\n<p>定义模块</p>\n<ul>\n<li>\n<p>定义无依赖模块</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="10860332893422830000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`define({\nsum: function(x, y) {\n return x + y;\n}\n});`, `10860332893422830000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                js 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token function">define</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n<span class="token function-variable function">sum</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">x<span class="token punctuation">,</span> y</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n <span class="token keyword">return</span> x <span class="token operator">+</span> y<span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n</li>\n<li>\n<p>定义有依赖模块</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="49680036779323890000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`define([\'some\'], function(alpha) {\nreturn {\n add: function() {\n   return some.sum() + 1;\n }\n};\n});`, `49680036779323890000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                js 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token function">define</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">\'some\'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">alpha</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n<span class="token keyword">return</span> <span class="token punctuation">{</span>\n <span class="token function-variable function">add</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n   <span class="token keyword">return</span> some<span class="token punctuation">.</span><span class="token function">sum</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>\n <span class="token punctuation">}</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n</li>\n<li>\n<p>定义数据对象模块</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="51774643086604090000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`define({\nadd: [],\nsub: []\n});`, `51774643086604090000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                js 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token function">define</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\nadd<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>\nsub<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n</li>\n<li>\n<p>具名模块</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="17024061517239185000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`define(&quot;alpha&quot;, [ &quot;require&quot;, &quot;exports&quot;, &quot;beta&quot; ], function( require, exports, beta ){\n export.verb = function(){\n     return beta.verb();\n     // or:\n     return require(&quot;beta&quot;).verb();\n }\n});`, `17024061517239185000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                js 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token function">define</span><span class="token punctuation">(</span><span class="token string">"alpha"</span><span class="token punctuation">,</span> <span class="token punctuation">[</span> <span class="token string">"require"</span><span class="token punctuation">,</span> <span class="token string">"exports"</span><span class="token punctuation">,</span> <span class="token string">"beta"</span> <span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span> <span class="token parameter">require<span class="token punctuation">,</span> exports<span class="token punctuation">,</span> beta</span> <span class="token punctuation">)</span><span class="token punctuation">{</span>\n <span class="token keyword">export</span><span class="token punctuation">.</span><span class="token function-variable function">verb</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>\n     <span class="token keyword">return</span> beta<span class="token punctuation">.</span><span class="token function">verb</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n     <span class="token comment">// or:</span>\n     <span class="token keyword">return</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"beta"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">verb</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n <span class="token punctuation">}</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n</li>\n<li>包装模块</li>\n</ul>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="34963207960657550000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`define(function(require, exports, module) {\n  var a = require(\'a\'),\n    b = require(\'b\');\n\n  exports.action = function() {};\n});`, `34963207960657550000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                js 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token function">define</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">require<span class="token punctuation">,</span> exports<span class="token punctuation">,</span> module</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'a\'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n    b <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'b\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n  exports<span class="token punctuation">.</span><span class="token function-variable function">action</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p> 不考虑多了一层函数外，格式和 Node.js 是一样的：使用 require 获取依赖模块，使用 exports 导出 API。除了 define 外，AMD 还保留一个关键字 require。require 作为规范保留的全局标识符，可以实现为 module loader，也可以不实现。</p>\n</li>\n<li>\n<p>模块加载</p>\n<p><strong>require([module], callback)</strong></p>\n<ul>\n<li>[module]：是一个数组，里面的成员就是要加载的模块</li>\n<li>callback：是模块加载完成之后的回调函数</li>\n<li>require 方法允许添加第三个参数，即错误处理的回调函数。</li>\n</ul>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="73734708912234320000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`require([\'math\'], function(math) {\n math.add(2, 3);\n});`, `73734708912234320000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                js 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token function">require</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">\'math\'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">math</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n math<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n</li>\n</ul>\n<h2 id="cmd"><a href="#cmd" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>CMD</h2>\n<p>CMD 的规范由国内的玉伯提出，与 AMD 的区别主要在于 <strong>定义模块与依赖引入</strong> 的部分。</p>\n<ol>\n<li>\n<p>CMD 更接近与 Node 对 CommonJS 规范的定义： <strong>define(factory)</strong></p>\n</li>\n<li>\n<p>在依赖部分，CMD 支持动态引入</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="14803000189289660000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`define(function(require, exports, module) {\n   // 模块内容\n}`, `14803000189289660000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                js 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token function">define</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">require<span class="token punctuation">,</span> exports<span class="token punctuation">,</span> module</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n   <span class="token comment">// 模块内容</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>require、exports、module 通过形参传递给模块，在需要依赖模块时，可以通过 <code class="language-text">require()</code> 引入。</p>\n</li>\n</ol>\n<h2 id="es6-模块化"><a href="#es6-%E6%A8%A1%E5%9D%97%E5%8C%96" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>ES6 模块化</h2>\n<p>ES6 正式提出了内置的模块化语法。</p>\n<p>ES6 的模块自动采用严格模式，不管你有没有在模块头部加上<code class="language-text">&quot;use strict&quot;;</code>。</p>\n<p>模块功能主要由两个命令构成：<code class="language-text">export</code>和<code class="language-text">import</code>。<code class="language-text">export</code>命令用于规定模块的对外接口，<code class="language-text">import</code>命令用于输入其他模块提供的功能。</p>\n<ol>\n<li>\n<p>export</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="44568169726248440000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`//导出变量\nexport var a = 1;\n\n//导出函数\nexport function fun(){\n  ...\n}\n\n//导出类\nexport class Rectangle {\n   ...\n}\n\nfunction fun1() { ... }\nfunction fun2() { ... }\n//导出对象，即导出引用\nexport {fun1 as f1, fun2 as f2} // 重命名模块\n\n// 导出默认值\nexport default function fun3() { ... }\n\n// 错误, 后面不能跟变量声明语句。\nexport default var a = 1\n\n// 正确\nexport default 42`, `44568169726248440000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                js 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">//导出变量</span>\n<span class="token keyword">export</span> <span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>\n\n<span class="token comment">//导出函数</span>\n<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">fun</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>\n  <span class="token operator">...</span>\n<span class="token punctuation">}</span>\n\n<span class="token comment">//导出类</span>\n<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">Rectangle</span> <span class="token punctuation">{</span>\n   <span class="token operator">...</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">function</span> <span class="token function">fun1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token operator">...</span> <span class="token punctuation">}</span>\n<span class="token keyword">function</span> <span class="token function">fun2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token operator">...</span> <span class="token punctuation">}</span>\n<span class="token comment">//导出对象，即导出引用</span>\n<span class="token keyword">export</span> <span class="token punctuation">{</span>fun1 <span class="token keyword">as</span> f1<span class="token punctuation">,</span> fun2 <span class="token keyword">as</span> f2<span class="token punctuation">}</span> <span class="token comment">// 重命名模块</span>\n\n<span class="token comment">// 导出默认值</span>\n<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">fun3</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token operator">...</span> <span class="token punctuation">}</span>\n\n<span class="token comment">// 错误, 后面不能跟变量声明语句。</span>\n<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token number">1</span>\n\n<span class="token comment">// 正确</span>\n<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token number">42</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>另外，<code class="language-text">export</code>语句输出的接口，与其对应的值是动态绑定关系，即通过该接口，可以取到模块内部实时的值。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="87306802952481720000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`export var foo = \'bar\';\nsetTimeout(() => (foo = \'baz\'), 500);`, `87306802952481720000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                js 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">export</span> <span class="token keyword">var</span> foo <span class="token operator">=</span> <span class="token string">\'bar\'</span><span class="token punctuation">;</span>\n<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span>foo <span class="token operator">=</span> <span class="token string">\'baz\'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p>上面代码输出变量<code class="language-text">foo</code>，值为<code class="language-text">bar</code>，500 毫秒之后变成<code class="language-text">baz</code>。</p>\n</li>\n<li>\n<p>import</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="82930691393830600000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 第一组 example.js\nexport default function fun() {\n // 输出\n // ...\n}\n// app.js\nimport fun from \'./example\';\n\n// 第二组 example.js\nexport function fun() {\n // 输出\n // ...\n}\n// app.js\nimport { fun } from \'./example\'; // 输入\n// 或\nimport * as allFun from \'./example\';\n//allFun.fun`, `82930691393830600000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                js 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// 第一组 example.js</span>\n<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">fun</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n <span class="token comment">// 输出</span>\n <span class="token comment">// ...</span>\n<span class="token punctuation">}</span>\n<span class="token comment">// app.js</span>\n<span class="token keyword">import</span> fun <span class="token keyword">from</span> <span class="token string">\'./example\'</span><span class="token punctuation">;</span>\n\n<span class="token comment">// 第二组 example.js</span>\n<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">fun</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n <span class="token comment">// 输出</span>\n <span class="token comment">// ...</span>\n<span class="token punctuation">}</span>\n<span class="token comment">// app.js</span>\n<span class="token keyword">import</span> <span class="token punctuation">{</span> fun <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">\'./example\'</span><span class="token punctuation">;</span> <span class="token comment">// 输入</span>\n<span class="token comment">// 或</span>\n<span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> allFun <span class="token keyword">from</span> <span class="token string">\'./example\'</span><span class="token punctuation">;</span>\n<span class="token comment">//allFun.fun</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p><code class="language-text">export default</code>命令用于指定模块的默认输出。显然，一个模块只能有一个默认输出，因此<code class="language-text">export default</code>命令只能使用一次。所以，<code class="language-text">import</code>命令后面才不用加大括号，因为只可能对应一个方法。本质上，<code class="language-text">export default</code>就是输出一个叫做<code class="language-text">default</code>的变量或方法，然后系统允许你为它取任意名字。所以，下面的写法是有效的。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="41744453386097754000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// modules.js\nfunction fun() {\n ...\n}\nexport {fun as default};\n// 等同于\n// export default fun;\n\n// app.js\nimport { default as fun } from \'./modules\';\n// 等同于\n// import fun from \'modules\';`, `41744453386097754000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                js 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// modules.js</span>\n<span class="token keyword">function</span> <span class="token function">fun</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n <span class="token operator">...</span>\n<span class="token punctuation">}</span>\n<span class="token keyword">export</span> <span class="token punctuation">{</span>fun <span class="token keyword">as</span> <span class="token keyword">default</span><span class="token punctuation">}</span><span class="token punctuation">;</span>\n<span class="token comment">// 等同于</span>\n<span class="token comment">// export default fun;</span>\n\n<span class="token comment">// app.js</span>\n<span class="token keyword">import</span> <span class="token punctuation">{</span> <span class="token keyword">default</span> <span class="token keyword">as</span> fun <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">\'./modules\'</span><span class="token punctuation">;</span>\n<span class="token comment">// 等同于</span>\n<span class="token comment">// import fun from \'modules\';</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n</li>\n<li>\n<p><code class="language-text">CommonJS</code>和 ES6 中模块化的两者区别</p>\n<ul>\n<li>前者支持动态导入，也就是 <code class="language-text">require(${path}/xx.js)</code>，后者目前不支持，但是已有提案</li>\n<li>前者是同步导入，因为用于服务端，文件都在本地，同步导入即使卡住主线程影响也不大。而后者是异步导入，因为用于浏览器，需要下载文件，如果也采用同步导入会对渲染有很大影响</li>\n<li>前者在导出时都是值拷贝，就算导出的值变了，导入的值也不会改变，所以如果想更新值，必须重新导入一次。但是后者采用实时绑定的方式，导入导出的值都指向同一个内存地址，所以导入值会跟随导出值变化</li>\n<li>后者会编译成 <code class="language-text">require/exports</code> 来执行的</li>\n</ul>\n</li>\n</ol>',
id:"/github/workspace/blog/CommonJS规范总结与扩展/index.md absPath of file >>> MarkdownRemark",timeToRead:7,frontmatter:{date:"2019-09-24 14:32:18",path:"/commonjs-summary-extension/",tags:"前端, commonjs",title:"CommonJS规范总结与扩展",draft:null}}],length:1,tag:"commonjs",pagesSum:1,page:1}}}});