<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><script src="/js/smooth-scroll.js"></script><link rel="preload" href="/component---src-layouts-index-js-fd6f98b8f467d5a4ea97.js" as="script"/><link rel="preload" href="/component---src-templates-blog-post-js-c46de7a038aabbed0010.js" as="script"/><link rel="preload" href="/path---browser-working-principle-cycle-system-3be3b846f04ba9d2332f.js" as="script"/><link rel="preload" href="/app-55aebb8759ef5001bcc6.js" as="script"/><link rel="preload" href="/commons-28d40765c2ee508aaecc.js" as="script"/><style type="text/css">
    .anchor {
      float: left;
      padding-right: 4px;
      margin-left: -20px;
    }
    h1 .anchor svg,
    h2 .anchor svg,
    h3 .anchor svg,
    h4 .anchor svg,
    h5 .anchor svg,
    h6 .anchor svg {
      visibility: hidden;
    }
    h1:hover .anchor svg,
    h2:hover .anchor svg,
    h3:hover .anchor svg,
    h4:hover .anchor svg,
    h5:hover .anchor svg,
    h6:hover .anchor svg,
    h1 .anchor:focus svg,
    h2 .anchor:focus svg,
    h3 .anchor:focus svg,
    h4 .anchor:focus svg,
    h5 .anchor:focus svg,
    h6 .anchor:focus svg {
      visibility: visible;
    }
  </style><script>
    document.addEventListener("DOMContentLoaded", function(event) {
      var hash = window.decodeURI(location.hash.replace('#', ''))
      if (hash !== '') {
        var element = document.getElementById(hash)
        if (element) {
          var offset = element.offsetTop
          // Wait for the browser to finish rendering before scrolling.
          setTimeout((function() {
            window.scrollTo(0, offset - 0)
          }), 0)
        }
      }
    })
  </script><title data-react-helmet="true">浏览器工作原理与实践——页面循环系统 - 女王控的博客</title><meta data-react-helmet="true" charset="utf-8"/><meta data-react-helmet="true" name="viewport" content="width=device-width, initial-scale=1"/><meta data-react-helmet="true" http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/><meta data-react-helmet="true" name="HandheldFriendly" content="True"/><meta data-react-helmet="true" name="description" content="消息队列和事件循环：页面是怎么活起来的 前面我们讲到了每个渲染进程都有一个主线程，并且主线程非常繁忙，既要处理 DOM，又要计算样式，还要处理布局，同时还需要处理 JavaScript…"/><meta data-react-helmet="true" name="keywords" content="前端, 浏览器, 高级前端"/><meta data-react-helmet="true" property="og:site_name" content="女王控"/><meta data-react-helmet="true" property="og:type" content="website"/><meta data-react-helmet="true" property="og:title" content="浏览器工作原理与实践——页面循环系统"/><meta data-react-helmet="true" property="og:description" content="消息队列和事件循环：页面是怎么活起来的 前面我们讲到了每个渲染进程都有一个主线程，并且主线程非常繁忙，既要处理 DOM，又要计算样式，还要处理布局，同时还需要处理 JavaScript…"/><meta data-react-helmet="true" property="og:url" content="https://blog.towavephone.com/browser-working-principle-cycle-system/"/><meta data-react-helmet="true" property="og:image" content="https://blog.towavephone.com/static/avatar.a4ccbab8.png"/><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"/><meta data-react-helmet="true" name="twitter:title" content="浏览器工作原理与实践——页面循环系统"/><meta data-react-helmet="true" name="twitter:description" content="消息队列和事件循环：页面是怎么活起来的 前面我们讲到了每个渲染进程都有一个主线程，并且主线程非常繁忙，既要处理 DOM，又要计算样式，还要处理布局，同时还需要处理 JavaScript…"/><meta data-react-helmet="true" name="twitter:url" content="https://blog.towavephone.com/browser-working-principle-cycle-system/"/><meta data-react-helmet="true" name="twitter:image" content="https://blog.towavephone.com/static/avatar.a4ccbab8.png"/><link rel="manifest" href="/manifest.webmanifest"/><meta name="theme-color" content="#fafafa"/><link rel="sitemap" type="application/xml" href="/sitemap.xml"/><link rel="canonical" href="https://blog.towavephone.com/browser-working-principle-cycle-system/" data-baseprotocol="https:" data-basehost="blog.towavephone.com"/><link rel="alternate" type="application/rss+xml" href="/rss.xml"/><style>.gatsby-code-button-container{-ms-touch-action:none;touch-action:none;display:-ms-flexbox;display:flex;-ms-flex-pack:end;justify-content:flex-end;position:relative;z-index:100;pointer-events:none}.gatsby-code-button{position:absolute;cursor:pointer;pointer-events:auto;top:10px;right:14px;color:#999;font-size:14px}.gatsby-code-button:after{visibility:hidden;position:absolute;display:none;padding:5px;content:attr(data-tooltip);color:#fff;font-size:16px;background-color:#000;white-space:nowrap}.gatsby-code-button[data-tooltip]:after{top:26px;right:0}.gatsby-code-button[data-tooltip]:focus:after,.gatsby-code-button[data-tooltip]:hover:after{visibility:visible;display:block;z-index:200}.gatsby-code-button-toaster{z-index:500;position:fixed;top:0;bottom:0;left:0;right:0;display:-ms-flexbox;display:flex;-ms-flex-pack:center;justify-content:center;-ms-flex-align:center;align-items:center;height:100vh;width:100vw;pointer-events:none}.gatsby-code-button-toaster-text{width:100%;margin:0 15px;max-width:850px;padding:20px;font-size:24px;letter-spacing:-1px;font-family:monospace;color:#fff;background-color:#000;border-radius:2px;text-align:center;opacity:0;animation:animation 3s cubic-bezier(.98,.01,.53,.47)}.gatsby-code-button-buffer{position:fixed;top:-9999px;opacity:0}@keyframes animation{0%,50%{opacity:1}50%,to{opacity:0}}code[class*=language-],pre[class*=language-]{color:#000;background:none;text-shadow:0 1px #fff;font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none}code[class*=language-]::-moz-selection,code[class*=language-] ::-moz-selection,pre[class*=language-]::-moz-selection,pre[class*=language-] ::-moz-selection{text-shadow:none;background:#b3d4fc}code[class*=language-]::selection,code[class*=language-] ::selection,pre[class*=language-]::selection,pre[class*=language-] ::selection{text-shadow:none;background:#b3d4fc}@media print{code[class*=language-],pre[class*=language-]{text-shadow:none}}pre[class*=language-]{padding:1em;margin:.5em 0;overflow:auto}:not(pre)>code[class*=language-],pre[class*=language-]{background:#f5f2f0}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em;white-space:normal}.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#708090}.token.punctuation{color:#999}.namespace{opacity:.7}.token.boolean,.token.constant,.token.deleted,.token.number,.token.property,.token.symbol,.token.tag{color:#905}.token.attr-name,.token.builtin,.token.char,.token.inserted,.token.selector,.token.string{color:#690}.language-css .token.string,.style .token.string,.token.entity,.token.operator,.token.url{color:#9a6e3a;background:hsla(0,0%,100%,.5)}.token.atrule,.token.attr-value,.token.keyword{color:#07a}.token.class-name,.token.function{color:#dd4a68}.token.important,.token.regex,.token.variable{color:#e90}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}pre[class*=language-].line-numbers{position:relative;padding-left:3.8em;counter-reset:linenumber}pre[class*=language-].line-numbers>code{position:relative;white-space:inherit}.line-numbers .line-numbers-rows{position:absolute;pointer-events:none;top:0;font-size:100%;left:-3.8em;width:3em;letter-spacing:-1px;border-right:1px solid #999;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.line-numbers-rows>span{pointer-events:none;display:block;counter-increment:linenumber}.line-numbers-rows>span:before{content:counter(linenumber);color:#999;display:block;padding-right:.8em;text-align:right}.ais-Breadcrumb-list,.ais-CurrentRefinements-list,.ais-HierarchicalMenu-list,.ais-Hits-list,.ais-InfiniteHits-list,.ais-InfiniteResults-list,.ais-Menu-list,.ais-NumericMenu-list,.ais-Pagination-list,.ais-RatingMenu-list,.ais-RefinementList-list,.ais-Results-list,.ais-ToggleRefinement-list{margin:0;padding:0;list-style:none}.ais-ClearRefinements-button,.ais-CurrentRefinements-delete,.ais-CurrentRefinements-reset,.ais-GeoSearch-redo,.ais-GeoSearch-reset,.ais-HierarchicalMenu-showMore,.ais-InfiniteHits-loadMore,.ais-InfiniteHits-loadPrevious,.ais-InfiniteResults-loadMore,.ais-Menu-showMore,.ais-RangeInput-submit,.ais-RefinementList-showMore,.ais-SearchBox-reset,.ais-SearchBox-submit,.ais-VoiceSearch-button{padding:0;overflow:visible;font:inherit;line-height:normal;color:inherit;background:none;border:0;cursor:pointer;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.ais-ClearRefinements-button::-moz-focus-inner,.ais-CurrentRefinements-delete::-moz-focus-inner,.ais-CurrentRefinements-reset::-moz-focus-inner,.ais-GeoSearch-redo::-moz-focus-inner,.ais-GeoSearch-reset::-moz-focus-inner,.ais-HierarchicalMenu-showMore::-moz-focus-inner,.ais-InfiniteHits-loadMore::-moz-focus-inner,.ais-InfiniteHits-loadPrevious::-moz-focus-inner,.ais-InfiniteResults-loadMore::-moz-focus-inner,.ais-Menu-showMore::-moz-focus-inner,.ais-RangeInput-submit::-moz-focus-inner,.ais-RefinementList-showMore::-moz-focus-inner,.ais-SearchBox-reset::-moz-focus-inner,.ais-SearchBox-submit::-moz-focus-inner,.ais-VoiceSearch-button::-moz-focus-inner{padding:0;border:0}.ais-ClearRefinements-button[disabled],.ais-CurrentRefinements-delete[disabled],.ais-CurrentRefinements-reset[disabled],.ais-GeoSearch-redo[disabled],.ais-GeoSearch-reset[disabled],.ais-HierarchicalMenu-showMore[disabled],.ais-InfiniteHits-loadMore[disabled],.ais-InfiniteHits-loadPrevious[disabled],.ais-InfiniteResults-loadMore[disabled],.ais-Menu-showMore[disabled],.ais-RangeInput-submit[disabled],.ais-RefinementList-showMore[disabled],.ais-SearchBox-reset[disabled],.ais-SearchBox-submit[disabled],.ais-VoiceSearch-button[disabled]{cursor:default}.ais-Breadcrumb-item,.ais-Breadcrumb-list,.ais-Pagination-list,.ais-PoweredBy,.ais-RangeInput-form,.ais-RatingMenu-link{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-ms-flex-align:center;align-items:center}.ais-GeoSearch,.ais-GeoSearch-map{height:100%}.ais-HierarchicalMenu-list .ais-HierarchicalMenu-list{margin-left:1em}.ais-PoweredBy-logo{display:block;height:1.2em;width:auto}.ais-RatingMenu-starIcon{display:block;width:20px;height:20px}.ais-SearchBox-input::-ms-clear,.ais-SearchBox-input::-ms-reveal{display:none;width:0;height:0}.ais-SearchBox-input::-webkit-search-cancel-button,.ais-SearchBox-input::-webkit-search-decoration,.ais-SearchBox-input::-webkit-search-results-button,.ais-SearchBox-input::-webkit-search-results-decoration{display:none}.ais-RangeSlider .rheostat{overflow:visible;margin-top:40px;margin-bottom:40px}.ais-RangeSlider .rheostat-background{height:6px;top:0;width:100%}.ais-RangeSlider .rheostat-handle{margin-left:-12px;top:-7px}.ais-RangeSlider .rheostat-background{position:relative;background-color:#fff;border:1px solid #aaa}.ais-RangeSlider .rheostat-progress{position:absolute;top:1px;height:4px;background-color:#333}.rheostat-handle{position:relative;z-index:1;width:20px;height:20px;background-color:#fff;border:1px solid #333;border-radius:50%;cursor:-webkit-grab;cursor:grab}.rheostat-marker{margin-left:-1px;position:absolute;width:1px;height:5px;background-color:#aaa}.rheostat-marker--large{height:9px}.rheostat-value{padding-top:15px}.rheostat-tooltip,.rheostat-value{margin-left:50%;position:absolute;text-align:center;-webkit-transform:translateX(-50%);transform:translateX(-50%)}.rheostat-tooltip{top:-22px}.ais-Breadcrumb-list,.ais-CurrentRefinements-list,.ais-HierarchicalMenu-list,.ais-Hits-list,.ais-InfiniteHits-list,.ais-InfiniteResults-list,.ais-Menu-list,.ais-NumericMenu-list,.ais-Pagination-list,.ais-RatingMenu-list,.ais-RefinementList-list,.ais-Results-list,.ais-ToggleRefinement-list{margin:0;padding:0;list-style:none}.ais-ClearRefinements-button,.ais-CurrentRefinements-delete,.ais-CurrentRefinements-reset,.ais-GeoSearch-redo,.ais-GeoSearch-reset,.ais-HierarchicalMenu-showMore,.ais-InfiniteHits-loadMore,.ais-InfiniteHits-loadPrevious,.ais-InfiniteResults-loadMore,.ais-Menu-showMore,.ais-RangeInput-submit,.ais-RefinementList-showMore,.ais-SearchBox-reset,.ais-SearchBox-submit,.ais-VoiceSearch-button{padding:0;overflow:visible;font:inherit;line-height:normal;color:inherit;background:none;border:0;cursor:pointer;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.ais-ClearRefinements-button::-moz-focus-inner,.ais-CurrentRefinements-delete::-moz-focus-inner,.ais-CurrentRefinements-reset::-moz-focus-inner,.ais-GeoSearch-redo::-moz-focus-inner,.ais-GeoSearch-reset::-moz-focus-inner,.ais-HierarchicalMenu-showMore::-moz-focus-inner,.ais-InfiniteHits-loadMore::-moz-focus-inner,.ais-InfiniteHits-loadPrevious::-moz-focus-inner,.ais-InfiniteResults-loadMore::-moz-focus-inner,.ais-Menu-showMore::-moz-focus-inner,.ais-RangeInput-submit::-moz-focus-inner,.ais-RefinementList-showMore::-moz-focus-inner,.ais-SearchBox-reset::-moz-focus-inner,.ais-SearchBox-submit::-moz-focus-inner,.ais-VoiceSearch-button::-moz-focus-inner{padding:0;border:0}.ais-ClearRefinements-button[disabled],.ais-CurrentRefinements-delete[disabled],.ais-CurrentRefinements-reset[disabled],.ais-GeoSearch-redo[disabled],.ais-GeoSearch-reset[disabled],.ais-HierarchicalMenu-showMore[disabled],.ais-InfiniteHits-loadMore[disabled],.ais-InfiniteHits-loadPrevious[disabled],.ais-InfiniteResults-loadMore[disabled],.ais-Menu-showMore[disabled],.ais-RangeInput-submit[disabled],.ais-RefinementList-showMore[disabled],.ais-SearchBox-reset[disabled],.ais-SearchBox-submit[disabled],.ais-VoiceSearch-button[disabled]{cursor:default}.ais-Breadcrumb-item,.ais-Breadcrumb-list,.ais-Pagination-list,.ais-PoweredBy,.ais-RangeInput-form,.ais-RatingMenu-link{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-ms-flex-align:center;align-items:center}.ais-GeoSearch,.ais-GeoSearch-map{height:100%}.ais-HierarchicalMenu-list .ais-HierarchicalMenu-list{margin-left:1em}.ais-PoweredBy-logo{display:block;height:1.2em;width:auto}.ais-RatingMenu-starIcon{display:block;width:20px;height:20px}.ais-SearchBox-input::-ms-clear,.ais-SearchBox-input::-ms-reveal{display:none;width:0;height:0}.ais-SearchBox-input::-webkit-search-cancel-button,.ais-SearchBox-input::-webkit-search-decoration,.ais-SearchBox-input::-webkit-search-results-button,.ais-SearchBox-input::-webkit-search-results-decoration{display:none}.ais-RangeSlider .rheostat{overflow:visible;margin-top:40px;margin-bottom:40px}.ais-RangeSlider .rheostat-background{height:6px;top:0;width:100%}.ais-RangeSlider .rheostat-handle{margin-left:-12px;top:-7px}.ais-RangeSlider .rheostat-background{position:relative;background-color:#fff;border:1px solid #aaa}.ais-RangeSlider .rheostat-progress{position:absolute;top:1px;height:4px;background-color:#333}.rheostat-handle{position:relative;z-index:1;width:20px;height:20px;background-color:#fff;border:1px solid #333;border-radius:50%;cursor:-webkit-grab;cursor:grab}.rheostat-marker{margin-left:-1px;position:absolute;width:1px;height:5px;background-color:#aaa}.rheostat-marker--large{height:9px}.rheostat-value{padding-top:15px}.rheostat-tooltip,.rheostat-value{margin-left:50%;position:absolute;text-align:center;-webkit-transform:translateX(-50%);transform:translateX(-50%)}.rheostat-tooltip{top:-22px}[class^=ais-]{font-size:1rem;-webkit-box-sizing:border-box;box-sizing:border-box}a[class^=ais-]{text-decoration:none}.ais-Breadcrumb,.ais-ClearRefinements,.ais-CurrentRefinements,.ais-GeoSearch,.ais-HierarchicalMenu,.ais-Hits,.ais-HitsPerPage,.ais-InfiniteHits,.ais-InfiniteResults,.ais-Menu,.ais-MenuSelect,.ais-NumericMenu,.ais-NumericSelector,.ais-Pagination,.ais-Panel,.ais-PoweredBy,.ais-RangeInput,.ais-RangeSlider,.ais-RatingMenu,.ais-RefinementList,.ais-Results,.ais-ResultsPerPage,.ais-SearchBox,.ais-SortBy,.ais-Stats,.ais-ToggleRefinement{color:#3a4570}.ais-Breadcrumb-item--selected,.ais-HierarchicalMenu-item--selected,.ais-Menu-item--selected{font-weight:700}.ais-Breadcrumb-separator{margin:0 .3em;font-weight:400}.ais-Breadcrumb-link,.ais-HierarchicalMenu-link,.ais-Menu-link,.ais-Pagination-link,.ais-RatingMenu-link{color:#0096db;-webkit-transition:color .2s ease-out;transition:color .2s ease-out}.ais-Breadcrumb-link:focus,.ais-Breadcrumb-link:hover,.ais-HierarchicalMenu-link:focus,.ais-HierarchicalMenu-link:hover,.ais-Menu-link:focus,.ais-Menu-link:hover,.ais-Pagination-link:focus,.ais-Pagination-link:hover,.ais-RatingMenu-link:focus,.ais-RatingMenu-link:hover{color:#0073a8}.ais-ClearRefinements-button,.ais-CurrentRefinements-reset,.ais-GeoSearch-redo,.ais-GeoSearch-reset,.ais-HierarchicalMenu-showMore,.ais-InfiniteHits-loadMore,.ais-InfiniteHits-loadPrevious,.ais-InfiniteResults-loadMore,.ais-Menu-showMore,.ais-RefinementList-showMore{padding:.3rem .5rem;font-size:.8rem;color:#fff;background-color:#0096db;border-radius:5px;-webkit-transition:background-color .2s ease-out;transition:background-color .2s ease-out;outline:none}.ais-ClearRefinements-button:focus,.ais-ClearRefinements-button:hover,.ais-CurrentRefinements-reset:focus,.ais-CurrentRefinements-reset:hover,.ais-GeoSearch-redo:focus,.ais-GeoSearch-redo:hover,.ais-GeoSearch-reset:focus,.ais-GeoSearch-reset:hover,.ais-HierarchicalMenu-showMore:focus,.ais-HierarchicalMenu-showMore:hover,.ais-InfiniteHits-loadMore:focus,.ais-InfiniteHits-loadMore:hover,.ais-InfiniteHits-loadPrevious:focus,.ais-InfiniteHits-loadPrevious:hover,.ais-InfiniteResults-loadMore:focus,.ais-InfiniteResults-loadMore:hover,.ais-Menu-showMore:focus,.ais-Menu-showMore:hover,.ais-RefinementList-showMore:focus,.ais-RefinementList-showMore:hover{background-color:#0073a8}.ais-ClearRefinements-button--disabled,.ais-GeoSearch-redo--disabled,.ais-GeoSearch-reset--disabled,.ais-HierarchicalMenu-showMore--disabled,.ais-InfiniteHits-loadMore--disabled,.ais-InfiniteResults-loadMore--disabled,.ais-Menu-showMore--disabled,.ais-RefinementList-showMore--disabled{opacity:.6;cursor:not-allowed}.ais-ClearRefinements-button--disabled:focus,.ais-ClearRefinements-button--disabled:hover,.ais-GeoSearch-redo--disabled:focus,.ais-GeoSearch-redo--disabled:hover,.ais-GeoSearch-reset--disabled:focus,.ais-GeoSearch-reset--disabled:hover,.ais-HierarchicalMenu-showMore--disabled:focus,.ais-HierarchicalMenu-showMore--disabled:hover,.ais-InfiniteHits-loadMore--disabled:focus,.ais-InfiniteHits-loadMore--disabled:hover,.ais-InfiniteResults-loadMore--disabled:focus,.ais-InfiniteResults-loadMore--disabled:hover,.ais-Menu-showMore--disabled:focus,.ais-Menu-showMore--disabled:hover,.ais-RefinementList-showMore--disabled:focus,.ais-RefinementList-showMore--disabled:hover{background-color:#0096db}.ais-InfiniteHits-loadPrevious--disabled{display:none}.ais-CurrentRefinements{margin-top:-.3rem}.ais-CurrentRefinements,.ais-CurrentRefinements-list{display:-webkit-box;display:-ms-flexbox;display:flex;-ms-flex-wrap:wrap;flex-wrap:wrap}.ais-CurrentRefinements-item{margin-right:.3rem;margin-top:.3rem;padding:.3rem .5rem;display:-webkit-box;display:-ms-flexbox;display:flex;background-color:#495588;border-radius:5px}.ais-CurrentRefinements-category{margin-left:.3em;display:-webkit-box;display:-ms-flexbox;display:flex}.ais-CurrentRefinements-delete{margin-left:.3rem}.ais-CurrentRefinements-categoryLabel,.ais-CurrentRefinements-delete,.ais-CurrentRefinements-label{white-space:nowrap;font-size:.8rem;color:#fff}.ais-CurrentRefinements-reset{margin-top:.3rem;white-space:nowrap}.ais-CurrentRefinements-reset+.ais-CurrentRefinements-list{margin-left:.3rem}.ais-GeoSearch{position:relative}.ais-GeoSearch-control{position:absolute;top:.8rem;left:3.75rem}.ais-GeoSearch-label{display:block;padding:.3rem .5rem;font-size:.8rem;background-color:#fff;border-radius:5px;-webkit-transition:background-color .2s ease-out;transition:background-color .2s ease-out;-webkit-box-shadow:rgba(0,0,0,.1) 0 1px 1px;box-shadow:0 1px 1px rgba(0,0,0,.1);outline:none}.ais-GeoSearch-input{margin:0 .25rem 0 0}.ais-GeoSearch-label,.ais-GeoSearch-redo,.ais-GeoSearch-reset{white-space:nowrap}.ais-GeoSearch-reset{position:absolute;bottom:1.25rem;left:50%;-webkit-transform:translateX(-50%);transform:translateX(-50%)}.ais-HierarchicalMenu-link,.ais-Menu-link{display:block;line-height:1.5}.ais-HierarchicalMenu-list,.ais-Menu-list,.ais-NumericMenu-list,.ais-RatingMenu-list,.ais-RefinementList-list{font-weight:400;line-height:1.5}.ais-HierarchicalMenu-link:after{margin-left:.3em;content:"";width:10px;height:10px;display:none;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath d='M7.3 24l-2.8-2.8 9.3-9.2-9.3-9.2L7.3 0l12.2 12z' fill='%233A4570'/%3E%3C/svg%3E");background-size:100% 100%}.ais-HierarchicalMenu-item--parent>.ais-HierarchicalMenu-link:after{display:inline-block}.ais-HierarchicalMenu-item--selected>.ais-HierarchicalMenu-link:after{-webkit-transform:rotate(90deg);transform:rotate(90deg)}.ais-CurrentRefinements-count,.ais-RatingMenu-count{font-size:.8rem}.ais-CurrentRefinements-count:before,.ais-RatingMenu-count:before{content:"("}.ais-CurrentRefinements-count:after,.ais-RatingMenu-count:after{content:")"}.ais-HierarchicalMenu-count,.ais-Menu-count,.ais-RefinementList-count,.ais-ToggleRefinement-count{padding:.1rem .4rem;font-size:.8rem;color:#3a4570;background-color:#dfe2ee;border-radius:8px}.ais-HierarchicalMenu-showMore,.ais-Menu-showMore,.ais-RefinementList-showMore{margin-top:.5rem}.ais-Highlight-highlighted,.ais-Snippet-highlighted{background-color:#ffc168}.ais-Hits-list,.ais-InfiniteHits-list,.ais-InfiniteResults-list,.ais-Results-list{margin-top:-1rem;margin-left:-1rem;display:-webkit-box;display:-ms-flexbox;display:flex;-ms-flex-wrap:wrap;flex-wrap:wrap}.ais-Panel-body .ais-Hits-list,.ais-Panel-body .ais-InfiniteHits-list,.ais-Panel-body .ais-InfiniteResults-list,.ais-Panel-body .ais-Results-list{margin:.5rem 0 0 -1rem}.ais-Hits-item,.ais-InfiniteHits-item,.ais-InfiniteResults-item,.ais-Results-item{margin-top:1rem;margin-left:1rem;padding:1rem;width:calc(25% - 1rem);border:1px solid #c4c8d8;-webkit-box-shadow:0 2px 5px 0 #e3e5ec;box-shadow:0 2px 5px 0 #e3e5ec}.ais-Panel-body .ais-Hits-item,.ais-Panel-body .ais-InfiniteHits-item,.ais-Panel-body .ais-InfiniteResults-item,.ais-Panel-body .ais-Results-item{margin:.5rem 0 .5rem 1rem}.ais-InfiniteHits-loadMore,.ais-InfiniteResults-loadMore{margin-top:1rem}.ais-InfiniteHits-loadPrevious{margin-bottom:1rem}.ais-HitsPerPage-select,.ais-MenuSelect-select,.ais-NumericSelector-select,.ais-ResultsPerPage-select,.ais-SortBy-select{-webkit-appearance:none;-moz-appearance:none;appearance:none;padding:.3rem 2rem .3rem .3rem;max-width:100%;background-color:#fff;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath d='M0 7.3l2.8-2.8 9.2 9.3 9.2-9.3L24 7.3 12 19.5z' fill='%233A4570'/%3E%3C/svg%3E");background-repeat:no-repeat;background-size:10px 10px;background-position:92% 50%;border:1px solid #c4c8d8;border-radius:5px}.ais-Panel--collapsible{position:relative}.ais-Panel--collapsible.ais-Panel--collapsed .ais-Panel-body,.ais-Panel--collapsible.ais-Panel--collapsed .ais-Panel-footer{display:none}.ais-Panel--collapsible .ais-Panel-collapseButton{position:absolute;top:0;right:0;padding:0;border:none;background:none}.ais-Panel-header{margin-bottom:.5rem;padding-bottom:.5rem;font-size:.8rem;font-weight:700;text-transform:uppercase;border-bottom:1px solid #c4c8d8}.ais-Panel-footer{margin-top:.5rem;font-size:.8rem}.ais-RangeInput-input{padding:0 .2rem;width:5rem;height:1.5rem;line-height:1.5rem}.ais-RangeInput-separator{margin:0 .3rem}.ais-RangeInput-submit{margin-left:.3rem;-webkit-appearance:none;-moz-appearance:none;appearance:none;padding:0 .5rem;height:1.5rem;line-height:1.5rem;font-size:.8rem;color:#fff;background-color:#0096db;border:none;border-radius:5px;-webkit-transition:.2s ease-out;transition:.2s ease-out;outline:none}.ais-RangeInput-submit:focus,.ais-RangeInput-submit:hover{background-color:#0073a8}.ais-RatingMenu-count{color:#3a4570}.ais-Pagination-list{-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center}.ais-Pagination-item+.ais-Pagination-item{margin-left:.3rem}.ais-Pagination-link{padding:.3rem .6rem;display:block;border:1px solid #c4c8d8;border-radius:5px;-webkit-transition:background-color .2s ease-out;transition:background-color .2s ease-out}.ais-Pagination-link:focus,.ais-Pagination-link:hover{background-color:#e3e5ec}.ais-Pagination-item--disabled .ais-Pagination-link{opacity:.6;cursor:not-allowed;color:#a5abc4}.ais-Pagination-item--disabled .ais-Pagination-link:focus,.ais-Pagination-item--disabled .ais-Pagination-link:hover{color:#a5abc4;background-color:#fff}.ais-Pagination-item--selected .ais-Pagination-link{color:#fff;background-color:#0096db;border-color:#0096db}.ais-Pagination-item--selected .ais-Pagination-link:focus,.ais-Pagination-item--selected .ais-Pagination-link:hover{color:#fff}.ais-PoweredBy-text,.ais-Stats-text,.rheostat-tooltip,.rheostat-value{font-size:.8rem}.ais-PoweredBy-logo{margin-left:.3rem}.ais-RangeSlider .rheostat-progress{background-color:#495588}.ais-RangeSlider .rheostat-background{border-color:#878faf;-webkit-box-sizing:border-box;box-sizing:border-box}.ais-RangeSlider .rheostat-handle{border-color:#878faf}.ais-RangeSlider .rheostat-marker{background-color:#878faf}.ais-Panel-body .ais-RangeSlider{margin:2rem 0}.ais-RangeSlider-handle{width:20px;height:20px;position:relative;z-index:1;background:#fff;border:1px solid #46aeda;border-radius:50%;cursor:pointer}.ais-RangeSlider-tooltip{position:absolute;background:#fff;top:-22px;font-size:.8em}.ais-RangeSlider-value{width:40px;position:absolute;text-align:center;margin-left:-20px;padding-top:15px;font-size:.8em}.ais-RangeSlider-marker{position:absolute;background:#ddd;margin-left:-1px;width:1px;height:5px}.ais-RatingMenu-item--disabled .ais-RatingMenu-count,.ais-RatingMenu-item--disabled .ais-RatingMenu-label{color:#c4c8d8}.ais-RatingMenu-item--selected{font-weight:700}.ais-RatingMenu-link{line-height:1.5}.ais-RatingMenu-link>*+*{margin-left:.3rem}.ais-RatingMenu-starIcon{position:relative;top:-1px;width:15px;fill:#ffc168}.ais-RatingMenu-item--disabled .ais-RatingMenu-starIcon{fill:#c4c8d8}.ais-HierarchicalMenu-searchBox>*,.ais-Menu-searchBox>*,.ais-RefinementList-searchBox>*{margin-bottom:.5rem}.ais-SearchBox-form{display:block;position:relative}.ais-SearchBox-input{-webkit-appearance:none;-moz-appearance:none;appearance:none;padding:.3rem 1.7rem;width:100%;position:relative;background-color:#fff;border:1px solid #c4c8d8;border-radius:5px}.ais-SearchBox-input::-webkit-input-placeholder{color:#a5aed1}.ais-SearchBox-input::-moz-placeholder{color:#a5aed1}.ais-SearchBox-input:-ms-input-placeholder{color:#a5aed1}.ais-SearchBox-input:-moz-placeholder{color:#a5aed1}.ais-SearchBox-loadingIndicator,.ais-SearchBox-reset,.ais-SearchBox-submit{-webkit-appearance:none;-moz-appearance:none;appearance:none;position:absolute;z-index:1;width:20px;height:20px;top:50%;right:.3rem;-webkit-transform:translateY(-50%);transform:translateY(-50%)}.ais-SearchBox-submit{left:.3rem}.ais-SearchBox-reset{right:.3rem}.ais-SearchBox-loadingIcon,.ais-SearchBox-resetIcon,.ais-SearchBox-submitIcon{position:absolute;top:50%;left:50%;-webkit-transform:translateX(-50%) translateY(-50%);transform:translateX(-50%) translateY(-50%)}.ais-SearchBox-resetIcon path,.ais-SearchBox-submitIcon path{fill:#495588}.ais-SearchBox-submitIcon{width:14px;height:14px}.ais-SearchBox-resetIcon{width:12px;height:12px}.ais-SearchBox-loadingIcon{width:16px;height:16px}.ais-VoiceSearch-button{border:none;width:24px;height:24px;padding:4px;border-radius:50%;color:#3a4570;background-color:transparent}.ais-VoiceSearch-button svg{color:currentColor}.ais-VoiceSearch-button:hover{cursor:pointer;background-color:#a5aed1;color:#fff}.ais-VoiceSearch-button:disabled{color:#a5aed1}.ais-VoiceSearch-button:disabled:hover{color:#a5aed1;cursor:not-allowed;background:inherit}@font-face{font-family:KaTeX_AMS;src:url(/static/KaTeX_AMS-Regular.3d8245dc.woff2) format("woff2"),url(/static/KaTeX_AMS-Regular.ac1d46d9.woff) format("woff"),url(/static/KaTeX_AMS-Regular.c67be87a.ttf) format("truetype");font-weight:400;font-style:normal}@font-face{font-family:KaTeX_Caligraphic;src:url(/static/KaTeX_Caligraphic-Bold.970d3e76.woff2) format("woff2"),url(/static/KaTeX_Caligraphic-Bold.445f96a3.woff) format("woff"),url(/static/KaTeX_Caligraphic-Bold.3f61a84d.ttf) format("truetype");font-weight:700;font-style:normal}@font-face{font-family:KaTeX_Caligraphic;src:url(/static/KaTeX_Caligraphic-Regular.0ef0f2e3.woff2) format("woff2"),url(/static/KaTeX_Caligraphic-Regular.74f6918c.woff) format("woff"),url(/static/KaTeX_Caligraphic-Regular.c3bc8fce.ttf) format("truetype");font-weight:400;font-style:normal}@font-face{font-family:KaTeX_Fraktur;src:url(/static/KaTeX_Fraktur-Bold.950649ba.woff2) format("woff2"),url(/static/KaTeX_Fraktur-Bold.1aca7ef7.woff) format("woff"),url(/static/KaTeX_Fraktur-Bold.e11e6bf0.ttf) format("truetype");font-weight:700;font-style:normal}@font-face{font-family:KaTeX_Fraktur;src:url(/static/KaTeX_Fraktur-Regular.135ccd74.woff2) format("woff2"),url(/static/KaTeX_Fraktur-Regular.c5b430bf.woff) format("woff"),url(/static/KaTeX_Fraktur-Regular.a9509497.ttf) format("truetype");font-weight:400;font-style:normal}@font-face{font-family:KaTeX_Main;src:url(/static/KaTeX_Main-Bold.c5b67fb3.woff2) format("woff2"),url(/static/KaTeX_Main-Bold.0ba875a1.woff) format("woff"),url(/static/KaTeX_Main-Bold.aaaa1b76.ttf) format("truetype");font-weight:700;font-style:normal}@font-face{font-family:KaTeX_Main;src:url(/static/KaTeX_Main-BoldItalic.0719833c.woff2) format("woff2"),url(/static/KaTeX_Main-BoldItalic.5aeca883.woff) format("woff"),url(/static/KaTeX_Main-BoldItalic.bdbadb27.ttf) format("truetype");font-weight:700;font-style:italic}@font-face{font-family:KaTeX_Main;src:url(/static/KaTeX_Main-Italic.6bf61628.woff2) format("woff2"),url(/static/KaTeX_Main-Italic.bb7c45db.woff) format("woff"),url(/static/KaTeX_Main-Italic.2155d789.ttf) format("truetype");font-weight:400;font-style:italic}@font-face{font-family:KaTeX_Main;src:url(/static/KaTeX_Main-Regular.29b27903.woff2) format("woff2"),url(/static/KaTeX_Main-Regular.1fd21713.woff) format("woff"),url(/static/KaTeX_Main-Regular.7b8d1fa0.ttf) format("truetype");font-weight:400;font-style:normal}@font-face{font-family:KaTeX_Math;src:url(/static/KaTeX_Math-Italic.7a31741a.woff2) format("woff2"),url(/static/KaTeX_Math-Italic.8eb56b3f.woff) format("woff"),url(/static/KaTeX_Math-Italic.10740d74.ttf) format("truetype");font-weight:400;font-style:italic}@font-face{font-family:KaTeX_SansSerif;src:url(/static/KaTeX_SansSerif-Bold.e38d0f68.woff2) format("woff2"),url(/static/KaTeX_SansSerif-Bold.84299b01.woff) format("woff"),url(/static/KaTeX_SansSerif-Bold.9123667c.ttf) format("truetype");font-weight:700;font-style:normal}@font-face{font-family:KaTeX_SansSerif;src:url(/static/KaTeX_SansSerif-Italic.1057b702.woff2) format("woff2"),url(/static/KaTeX_SansSerif-Italic.95c5a3d4.woff) format("woff"),url(/static/KaTeX_SansSerif-Italic.f9c440ab.ttf) format("truetype");font-weight:400;font-style:italic}@font-face{font-family:KaTeX_SansSerif;src:url(/static/KaTeX_SansSerif-Regular.f9e06d59.woff2) format("woff2"),url(/static/KaTeX_SansSerif-Regular.35bda414.woff) format("woff"),url(/static/KaTeX_SansSerif-Regular.2eae604d.ttf) format("truetype");font-weight:400;font-style:normal}@font-face{font-family:KaTeX_Script;src:url(/static/KaTeX_Script-Regular.ae1fad1f.woff2) format("woff2"),url(/static/KaTeX_Script-Regular.60febfa1.woff) format("woff"),url(/static/KaTeX_Script-Regular.e9169ca7.ttf) format("truetype");font-weight:400;font-style:normal}@font-face{font-family:KaTeX_Size1;src:url(/static/KaTeX_Size1-Regular.fda0824e.woff2) format("woff2"),url(/static/KaTeX_Size1-Regular.1d6cf6b8.woff) format("woff"),url(/static/KaTeX_Size1-Regular.f2e296ef.ttf) format("truetype");font-weight:400;font-style:normal}@font-face{font-family:KaTeX_Size2;src:url(/static/KaTeX_Size2-Regular.a7a0eb93.woff2) format("woff2"),url(/static/KaTeX_Size2-Regular.f48e83b7.woff) format("woff"),url(/static/KaTeX_Size2-Regular.0767ede6.ttf) format("truetype");font-weight:400;font-style:normal}@font-face{font-family:KaTeX_Size3;src:url(/static/KaTeX_Size3-Regular.397bd687.woff2) format("woff2"),url(/static/KaTeX_Size3-Regular.0387ab38.woff) format("woff"),url(/static/KaTeX_Size3-Regular.882f7234.ttf) format("truetype");font-weight:400;font-style:normal}@font-face{font-family:KaTeX_Size4;src:url(/static/KaTeX_Size4-Regular.3c14ed11.woff2) format("woff2"),url(/static/KaTeX_Size4-Regular.726db3bd.woff) format("woff"),url(/static/KaTeX_Size4-Regular.27901d5c.ttf) format("truetype");font-weight:400;font-style:normal}@font-face{font-family:KaTeX_Typewriter;src:url(/static/KaTeX_Typewriter-Regular.f43e8696.woff2) format("woff2"),url(/static/KaTeX_Typewriter-Regular.ba01f72a.woff) format("woff"),url(/static/KaTeX_Typewriter-Regular.6b9645af.ttf) format("truetype");font-weight:400;font-style:normal}.katex-display{display:block;margin:1em 0;text-align:center}.katex-display>.katex{display:inline-block;text-align:initial}.katex{font:normal 1.21em KaTeX_Main,Times New Roman,serif;line-height:1.2;white-space:nowrap;text-indent:0;text-rendering:auto}.katex *{-ms-high-contrast-adjust:none!important}.katex .katex-html{display:inline-block}.katex .katex-mathml{position:absolute;clip:rect(1px,1px,1px,1px);padding:0;border:0;height:1px;width:1px;overflow:hidden}.katex .base{position:relative}.katex .base,.katex .strut{display:inline-block}.katex .textbf{font-weight:700}.katex .textit{font-style:italic}.katex .textrm{font-family:KaTeX_Main}.katex .textsf{font-family:KaTeX_SansSerif}.katex .texttt{font-family:KaTeX_Typewriter}.katex .mathit{font-family:KaTeX_Math;font-style:italic}.katex .mathrm{font-style:normal}.katex .mathbf{font-family:KaTeX_Main;font-weight:700}.katex .boldsymbol{font-family:KaTeX_Math;font-weight:700;font-style:italic}.katex .amsrm,.katex .mathbb{font-family:KaTeX_AMS}.katex .mathcal{font-family:KaTeX_Caligraphic}.katex .mathfrak{font-family:KaTeX_Fraktur}.katex .mathtt{font-family:KaTeX_Typewriter}.katex .mathscr{font-family:KaTeX_Script}.katex .mathsf{font-family:KaTeX_SansSerif}.katex .mainit{font-family:KaTeX_Main;font-style:italic}.katex .mainrm{font-family:KaTeX_Main;font-style:normal}.katex .vlist-t{display:inline-table;table-layout:fixed}.katex .vlist-r{display:table-row}.katex .vlist{display:table-cell;vertical-align:bottom;position:relative}.katex .vlist>span{display:block;height:0;position:relative}.katex .vlist>span>span{display:inline-block}.katex .vlist>span>.pstrut{overflow:hidden;width:0}.katex .vlist-t2{margin-right:-2px}.katex .vlist-s{display:table-cell;vertical-align:bottom;font-size:1px;width:2px}.katex .msupsub{text-align:left}.katex .mfrac>span>span{text-align:center}.katex .mfrac .frac-line{display:inline-block;width:100%}.katex .mspace{display:inline-block}.katex .mspace.negativethinspace{margin-left:-.16667em}.katex .mspace.muspace{width:.055556em}.katex .mspace.thinspace{width:.16667em}.katex .mspace.negativemediumspace{margin-left:-.22222em}.katex .mspace.mediumspace{width:.22222em}.katex .mspace.thickspace{width:.27778em}.katex .mspace.sixmuspace{width:.333333em}.katex .mspace.eightmuspace{width:.444444em}.katex .mspace.enspace{width:.5em}.katex .mspace.twelvemuspace{width:.666667em}.katex .mspace.quad{width:1em}.katex .mspace.qquad{width:2em}.katex .clap,.katex .llap,.katex .rlap{width:0;position:relative}.katex .clap>.inner,.katex .llap>.inner,.katex .rlap>.inner{position:absolute}.katex .clap>.fix,.katex .llap>.fix,.katex .rlap>.fix{display:inline-block}.katex .llap>.inner{right:0}.katex .clap>.inner,.katex .rlap>.inner{left:0}.katex .clap>.inner>span{margin-left:-50%;margin-right:50%}.katex .rule{display:inline-block;border:0 solid;position:relative}.katex .overline .overline-line,.katex .underline .underline-line{display:inline-block;width:100%}.katex .sqrt>.root{margin-left:.27777778em;margin-right:-.55555556em}.katex .fontsize-ensurer,.katex .sizing{display:inline-block}.katex .fontsize-ensurer.reset-size1.size1,.katex .sizing.reset-size1.size1{font-size:1em}.katex .fontsize-ensurer.reset-size1.size2,.katex .sizing.reset-size1.size2{font-size:1.2em}.katex .fontsize-ensurer.reset-size1.size3,.katex .sizing.reset-size1.size3{font-size:1.4em}.katex .fontsize-ensurer.reset-size1.size4,.katex .sizing.reset-size1.size4{font-size:1.6em}.katex .fontsize-ensurer.reset-size1.size5,.katex .sizing.reset-size1.size5{font-size:1.8em}.katex .fontsize-ensurer.reset-size1.size6,.katex .sizing.reset-size1.size6{font-size:2em}.katex .fontsize-ensurer.reset-size1.size7,.katex .sizing.reset-size1.size7{font-size:2.4em}.katex .fontsize-ensurer.reset-size1.size8,.katex .sizing.reset-size1.size8{font-size:2.88em}.katex .fontsize-ensurer.reset-size1.size9,.katex .sizing.reset-size1.size9{font-size:3.456em}.katex .fontsize-ensurer.reset-size1.size10,.katex .sizing.reset-size1.size10{font-size:4.148em}.katex .fontsize-ensurer.reset-size1.size11,.katex .sizing.reset-size1.size11{font-size:4.976em}.katex .fontsize-ensurer.reset-size2.size1,.katex .sizing.reset-size2.size1{font-size:.83333333em}.katex .fontsize-ensurer.reset-size2.size2,.katex .sizing.reset-size2.size2{font-size:1em}.katex .fontsize-ensurer.reset-size2.size3,.katex .sizing.reset-size2.size3{font-size:1.16666667em}.katex .fontsize-ensurer.reset-size2.size4,.katex .sizing.reset-size2.size4{font-size:1.33333333em}.katex .fontsize-ensurer.reset-size2.size5,.katex .sizing.reset-size2.size5{font-size:1.5em}.katex .fontsize-ensurer.reset-size2.size6,.katex .sizing.reset-size2.size6{font-size:1.66666667em}.katex .fontsize-ensurer.reset-size2.size7,.katex .sizing.reset-size2.size7{font-size:2em}.katex .fontsize-ensurer.reset-size2.size8,.katex .sizing.reset-size2.size8{font-size:2.4em}.katex .fontsize-ensurer.reset-size2.size9,.katex .sizing.reset-size2.size9{font-size:2.88em}.katex .fontsize-ensurer.reset-size2.size10,.katex .sizing.reset-size2.size10{font-size:3.45666667em}.katex .fontsize-ensurer.reset-size2.size11,.katex .sizing.reset-size2.size11{font-size:4.14666667em}.katex .fontsize-ensurer.reset-size3.size1,.katex .sizing.reset-size3.size1{font-size:.71428571em}.katex .fontsize-ensurer.reset-size3.size2,.katex .sizing.reset-size3.size2{font-size:.85714286em}.katex .fontsize-ensurer.reset-size3.size3,.katex .sizing.reset-size3.size3{font-size:1em}.katex .fontsize-ensurer.reset-size3.size4,.katex .sizing.reset-size3.size4{font-size:1.14285714em}.katex .fontsize-ensurer.reset-size3.size5,.katex .sizing.reset-size3.size5{font-size:1.28571429em}.katex .fontsize-ensurer.reset-size3.size6,.katex .sizing.reset-size3.size6{font-size:1.42857143em}.katex .fontsize-ensurer.reset-size3.size7,.katex .sizing.reset-size3.size7{font-size:1.71428571em}.katex .fontsize-ensurer.reset-size3.size8,.katex .sizing.reset-size3.size8{font-size:2.05714286em}.katex .fontsize-ensurer.reset-size3.size9,.katex .sizing.reset-size3.size9{font-size:2.46857143em}.katex .fontsize-ensurer.reset-size3.size10,.katex .sizing.reset-size3.size10{font-size:2.96285714em}.katex .fontsize-ensurer.reset-size3.size11,.katex .sizing.reset-size3.size11{font-size:3.55428571em}.katex .fontsize-ensurer.reset-size4.size1,.katex .sizing.reset-size4.size1{font-size:.625em}.katex .fontsize-ensurer.reset-size4.size2,.katex .sizing.reset-size4.size2{font-size:.75em}.katex .fontsize-ensurer.reset-size4.size3,.katex .sizing.reset-size4.size3{font-size:.875em}.katex .fontsize-ensurer.reset-size4.size4,.katex .sizing.reset-size4.size4{font-size:1em}.katex .fontsize-ensurer.reset-size4.size5,.katex .sizing.reset-size4.size5{font-size:1.125em}.katex .fontsize-ensurer.reset-size4.size6,.katex .sizing.reset-size4.size6{font-size:1.25em}.katex .fontsize-ensurer.reset-size4.size7,.katex .sizing.reset-size4.size7{font-size:1.5em}.katex .fontsize-ensurer.reset-size4.size8,.katex .sizing.reset-size4.size8{font-size:1.8em}.katex .fontsize-ensurer.reset-size4.size9,.katex .sizing.reset-size4.size9{font-size:2.16em}.katex .fontsize-ensurer.reset-size4.size10,.katex .sizing.reset-size4.size10{font-size:2.5925em}.katex .fontsize-ensurer.reset-size4.size11,.katex .sizing.reset-size4.size11{font-size:3.11em}.katex .fontsize-ensurer.reset-size5.size1,.katex .sizing.reset-size5.size1{font-size:.55555556em}.katex .fontsize-ensurer.reset-size5.size2,.katex .sizing.reset-size5.size2{font-size:.66666667em}.katex .fontsize-ensurer.reset-size5.size3,.katex .sizing.reset-size5.size3{font-size:.77777778em}.katex .fontsize-ensurer.reset-size5.size4,.katex .sizing.reset-size5.size4{font-size:.88888889em}.katex .fontsize-ensurer.reset-size5.size5,.katex .sizing.reset-size5.size5{font-size:1em}.katex .fontsize-ensurer.reset-size5.size6,.katex .sizing.reset-size5.size6{font-size:1.11111111em}.katex .fontsize-ensurer.reset-size5.size7,.katex .sizing.reset-size5.size7{font-size:1.33333333em}.katex .fontsize-ensurer.reset-size5.size8,.katex .sizing.reset-size5.size8{font-size:1.6em}.katex .fontsize-ensurer.reset-size5.size9,.katex .sizing.reset-size5.size9{font-size:1.92em}.katex .fontsize-ensurer.reset-size5.size10,.katex .sizing.reset-size5.size10{font-size:2.30444444em}.katex .fontsize-ensurer.reset-size5.size11,.katex .sizing.reset-size5.size11{font-size:2.76444444em}.katex .fontsize-ensurer.reset-size6.size1,.katex .sizing.reset-size6.size1{font-size:.5em}.katex .fontsize-ensurer.reset-size6.size2,.katex .sizing.reset-size6.size2{font-size:.6em}.katex .fontsize-ensurer.reset-size6.size3,.katex .sizing.reset-size6.size3{font-size:.7em}.katex .fontsize-ensurer.reset-size6.size4,.katex .sizing.reset-size6.size4{font-size:.8em}.katex .fontsize-ensurer.reset-size6.size5,.katex .sizing.reset-size6.size5{font-size:.9em}.katex .fontsize-ensurer.reset-size6.size6,.katex .sizing.reset-size6.size6{font-size:1em}.katex .fontsize-ensurer.reset-size6.size7,.katex .sizing.reset-size6.size7{font-size:1.2em}.katex .fontsize-ensurer.reset-size6.size8,.katex .sizing.reset-size6.size8{font-size:1.44em}.katex .fontsize-ensurer.reset-size6.size9,.katex .sizing.reset-size6.size9{font-size:1.728em}.katex .fontsize-ensurer.reset-size6.size10,.katex .sizing.reset-size6.size10{font-size:2.074em}.katex .fontsize-ensurer.reset-size6.size11,.katex .sizing.reset-size6.size11{font-size:2.488em}.katex .fontsize-ensurer.reset-size7.size1,.katex .sizing.reset-size7.size1{font-size:.41666667em}.katex .fontsize-ensurer.reset-size7.size2,.katex .sizing.reset-size7.size2{font-size:.5em}.katex .fontsize-ensurer.reset-size7.size3,.katex .sizing.reset-size7.size3{font-size:.58333333em}.katex .fontsize-ensurer.reset-size7.size4,.katex .sizing.reset-size7.size4{font-size:.66666667em}.katex .fontsize-ensurer.reset-size7.size5,.katex .sizing.reset-size7.size5{font-size:.75em}.katex .fontsize-ensurer.reset-size7.size6,.katex .sizing.reset-size7.size6{font-size:.83333333em}.katex .fontsize-ensurer.reset-size7.size7,.katex .sizing.reset-size7.size7{font-size:1em}.katex .fontsize-ensurer.reset-size7.size8,.katex .sizing.reset-size7.size8{font-size:1.2em}.katex .fontsize-ensurer.reset-size7.size9,.katex .sizing.reset-size7.size9{font-size:1.44em}.katex .fontsize-ensurer.reset-size7.size10,.katex .sizing.reset-size7.size10{font-size:1.72833333em}.katex .fontsize-ensurer.reset-size7.size11,.katex .sizing.reset-size7.size11{font-size:2.07333333em}.katex .fontsize-ensurer.reset-size8.size1,.katex .sizing.reset-size8.size1{font-size:.34722222em}.katex .fontsize-ensurer.reset-size8.size2,.katex .sizing.reset-size8.size2{font-size:.41666667em}.katex .fontsize-ensurer.reset-size8.size3,.katex .sizing.reset-size8.size3{font-size:.48611111em}.katex .fontsize-ensurer.reset-size8.size4,.katex .sizing.reset-size8.size4{font-size:.55555556em}.katex .fontsize-ensurer.reset-size8.size5,.katex .sizing.reset-size8.size5{font-size:.625em}.katex .fontsize-ensurer.reset-size8.size6,.katex .sizing.reset-size8.size6{font-size:.69444444em}.katex .fontsize-ensurer.reset-size8.size7,.katex .sizing.reset-size8.size7{font-size:.83333333em}.katex .fontsize-ensurer.reset-size8.size8,.katex .sizing.reset-size8.size8{font-size:1em}.katex .fontsize-ensurer.reset-size8.size9,.katex .sizing.reset-size8.size9{font-size:1.2em}.katex .fontsize-ensurer.reset-size8.size10,.katex .sizing.reset-size8.size10{font-size:1.44027778em}.katex .fontsize-ensurer.reset-size8.size11,.katex .sizing.reset-size8.size11{font-size:1.72777778em}.katex .fontsize-ensurer.reset-size9.size1,.katex .sizing.reset-size9.size1{font-size:.28935185em}.katex .fontsize-ensurer.reset-size9.size2,.katex .sizing.reset-size9.size2{font-size:.34722222em}.katex .fontsize-ensurer.reset-size9.size3,.katex .sizing.reset-size9.size3{font-size:.40509259em}.katex .fontsize-ensurer.reset-size9.size4,.katex .sizing.reset-size9.size4{font-size:.46296296em}.katex .fontsize-ensurer.reset-size9.size5,.katex .sizing.reset-size9.size5{font-size:.52083333em}.katex .fontsize-ensurer.reset-size9.size6,.katex .sizing.reset-size9.size6{font-size:.5787037em}.katex .fontsize-ensurer.reset-size9.size7,.katex .sizing.reset-size9.size7{font-size:.69444444em}.katex .fontsize-ensurer.reset-size9.size8,.katex .sizing.reset-size9.size8{font-size:.83333333em}.katex .fontsize-ensurer.reset-size9.size9,.katex .sizing.reset-size9.size9{font-size:1em}.katex .fontsize-ensurer.reset-size9.size10,.katex .sizing.reset-size9.size10{font-size:1.20023148em}.katex .fontsize-ensurer.reset-size9.size11,.katex .sizing.reset-size9.size11{font-size:1.43981481em}.katex .fontsize-ensurer.reset-size10.size1,.katex .sizing.reset-size10.size1{font-size:.24108004em}.katex .fontsize-ensurer.reset-size10.size2,.katex .sizing.reset-size10.size2{font-size:.28929605em}.katex .fontsize-ensurer.reset-size10.size3,.katex .sizing.reset-size10.size3{font-size:.33751205em}.katex .fontsize-ensurer.reset-size10.size4,.katex .sizing.reset-size10.size4{font-size:.38572806em}.katex .fontsize-ensurer.reset-size10.size5,.katex .sizing.reset-size10.size5{font-size:.43394407em}.katex .fontsize-ensurer.reset-size10.size6,.katex .sizing.reset-size10.size6{font-size:.48216008em}.katex .fontsize-ensurer.reset-size10.size7,.katex .sizing.reset-size10.size7{font-size:.57859209em}.katex .fontsize-ensurer.reset-size10.size8,.katex .sizing.reset-size10.size8{font-size:.69431051em}.katex .fontsize-ensurer.reset-size10.size9,.katex .sizing.reset-size10.size9{font-size:.83317261em}.katex .fontsize-ensurer.reset-size10.size10,.katex .sizing.reset-size10.size10{font-size:1em}.katex .fontsize-ensurer.reset-size10.size11,.katex .sizing.reset-size10.size11{font-size:1.19961427em}.katex .fontsize-ensurer.reset-size11.size1,.katex .sizing.reset-size11.size1{font-size:.20096463em}.katex .fontsize-ensurer.reset-size11.size2,.katex .sizing.reset-size11.size2{font-size:.24115756em}.katex .fontsize-ensurer.reset-size11.size3,.katex .sizing.reset-size11.size3{font-size:.28135048em}.katex .fontsize-ensurer.reset-size11.size4,.katex .sizing.reset-size11.size4{font-size:.32154341em}.katex .fontsize-ensurer.reset-size11.size5,.katex .sizing.reset-size11.size5{font-size:.36173633em}.katex .fontsize-ensurer.reset-size11.size6,.katex .sizing.reset-size11.size6{font-size:.40192926em}.katex .fontsize-ensurer.reset-size11.size7,.katex .sizing.reset-size11.size7{font-size:.48231511em}.katex .fontsize-ensurer.reset-size11.size8,.katex .sizing.reset-size11.size8{font-size:.57877814em}.katex .fontsize-ensurer.reset-size11.size9,.katex .sizing.reset-size11.size9{font-size:.69453376em}.katex .fontsize-ensurer.reset-size11.size10,.katex .sizing.reset-size11.size10{font-size:.83360129em}.katex .fontsize-ensurer.reset-size11.size11,.katex .sizing.reset-size11.size11{font-size:1em}.katex .delimsizing.size1{font-family:KaTeX_Size1}.katex .delimsizing.size2{font-family:KaTeX_Size2}.katex .delimsizing.size3{font-family:KaTeX_Size3}.katex .delimsizing.size4{font-family:KaTeX_Size4}.katex .delimsizing.mult .delim-size1>span{font-family:KaTeX_Size1}.katex .delimsizing.mult .delim-size4>span{font-family:KaTeX_Size4}.katex .nulldelimiter{display:inline-block;width:.12em}.katex .delimcenter,.katex .op-symbol{position:relative}.katex .op-symbol.small-op{font-family:KaTeX_Size1}.katex .op-symbol.large-op{font-family:KaTeX_Size2}.katex .accent>.vlist-t,.katex .op-limits>.vlist-t{text-align:center}.katex .accent .accent-body{width:0;position:relative}.katex .overlay{display:block}.katex .mtable .vertical-separator{display:inline-block;margin:0 -.125em;width:.25em;overflow:hidden;position:relative}.katex .mtable .arraycolsep{display:inline-block}.katex .mtable .col-align-c>.vlist-t{text-align:center}.katex .mtable .col-align-l>.vlist-t{text-align:left}.katex .mtable .col-align-r>.vlist-t{text-align:right}.katex .svg-align{text-align:left}.katex svg{display:block;position:absolute;width:100%;fill:currentColor;stroke:currentColor;fill-rule:nonzero;fill-opacity:1;stroke-width:1;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:1}.katex svg path{stroke:none}.katex .vertical-separator svg{width:.25em}.katex .stretchy{width:100%;display:block;position:relative;overflow:hidden}.katex .stretchy:after,.katex .stretchy:before{content:""}.katex .hide-tail{width:100%;position:relative;overflow:hidden}.katex .halfarrow-left{position:absolute;left:0;width:50.2%;overflow:hidden}.katex .halfarrow-right{position:absolute;right:0;width:50.2%;overflow:hidden}.katex .brace-left{position:absolute;left:0;width:25.1%;overflow:hidden}.katex .brace-center{position:absolute;left:25%;width:50%;overflow:hidden}.katex .brace-right{position:absolute;right:0;width:25.1%;overflow:hidden}.katex .x-arrow-pad{padding:0 .5em}.katex .mover,.katex .munder,.katex .x-arrow{text-align:center}.katex .boxpad{padding:0 .3em}.katex .fbox{box-sizing:border-box;border:.04em solid #000}.katex .fcolorbox{box-sizing:border-box;border:.04em solid}.katex .cancel-pad{padding:0 .2em}.katex .cancel-lap+.mbin,.katex .cancel-lap+.mord,.katex .cancel-lap+.msupsub,.katex .mbin+.cancel-lap,.katex .mord+.cancel-lap{margin-left:-.2em}.katex .sout{border-bottom-style:solid;border-bottom-width:.08em}@font-face{font-family:octicons-link;src:url(data:font/woff;charset=utf-8;base64,d09GRgABAAAAAAZwABAAAAAACFQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABEU0lHAAAGaAAAAAgAAAAIAAAAAUdTVUIAAAZcAAAACgAAAAoAAQAAT1MvMgAAAyQAAABJAAAAYFYEU3RjbWFwAAADcAAAAEUAAACAAJThvmN2dCAAAATkAAAABAAAAAQAAAAAZnBnbQAAA7gAAACyAAABCUM+8IhnYXNwAAAGTAAAABAAAAAQABoAI2dseWYAAAFsAAABPAAAAZwcEq9taGVhZAAAAsgAAAA0AAAANgh4a91oaGVhAAADCAAAABoAAAAkCA8DRGhtdHgAAAL8AAAADAAAAAwGAACfbG9jYQAAAsAAAAAIAAAACABiATBtYXhwAAACqAAAABgAAAAgAA8ASm5hbWUAAAToAAABQgAAAlXu73sOcG9zdAAABiwAAAAeAAAAME3QpOBwcmVwAAAEbAAAAHYAAAB/aFGpk3jaTY6xa8JAGMW/O62BDi0tJLYQincXEypYIiGJjSgHniQ6umTsUEyLm5BV6NDBP8Tpts6F0v+k/0an2i+itHDw3v2+9+DBKTzsJNnWJNTgHEy4BgG3EMI9DCEDOGEXzDADU5hBKMIgNPZqoD3SilVaXZCER3/I7AtxEJLtzzuZfI+VVkprxTlXShWKb3TBecG11rwoNlmmn1P2WYcJczl32etSpKnziC7lQyWe1smVPy/Lt7Kc+0vWY/gAgIIEqAN9we0pwKXreiMasxvabDQMM4riO+qxM2ogwDGOZTXxwxDiycQIcoYFBLj5K3EIaSctAq2kTYiw+ymhce7vwM9jSqO8JyVd5RH9gyTt2+J/yUmYlIR0s04n6+7Vm1ozezUeLEaUjhaDSuXHwVRgvLJn1tQ7xiuVv/ocTRF42mNgZGBgYGbwZOBiAAFGJBIMAAizAFoAAABiAGIAznjaY2BkYGAA4in8zwXi+W2+MjCzMIDApSwvXzC97Z4Ig8N/BxYGZgcgl52BCSQKAA3jCV8CAABfAAAAAAQAAEB42mNgZGBg4f3vACQZQABIMjKgAmYAKEgBXgAAeNpjYGY6wTiBgZWBg2kmUxoDA4MPhGZMYzBi1AHygVLYQUCaawqDA4PChxhmh/8ODDEsvAwHgMKMIDnGL0x7gJQCAwMAJd4MFwAAAHjaY2BgYGaA4DAGRgYQkAHyGMF8NgYrIM3JIAGVYYDT+AEjAwuDFpBmA9KMDEwMCh9i/v8H8sH0/4dQc1iAmAkALaUKLgAAAHjaTY9LDsIgEIbtgqHUPpDi3gPoBVyRTmTddOmqTXThEXqrob2gQ1FjwpDvfwCBdmdXC5AVKFu3e5MfNFJ29KTQT48Ob9/lqYwOGZxeUelN2U2R6+cArgtCJpauW7UQBqnFkUsjAY/kOU1cP+DAgvxwn1chZDwUbd6CFimGXwzwF6tPbFIcjEl+vvmM/byA48e6tWrKArm4ZJlCbdsrxksL1AwWn/yBSJKpYbq8AXaaTb8AAHja28jAwOC00ZrBeQNDQOWO//sdBBgYGRiYWYAEELEwMTE4uzo5Zzo5b2BxdnFOcALxNjA6b2ByTswC8jYwg0VlNuoCTWAMqNzMzsoK1rEhNqByEyerg5PMJlYuVueETKcd/89uBpnpvIEVomeHLoMsAAe1Id4AAAAAAAB42oWQT07CQBTGv0JBhagk7HQzKxca2sJCE1hDt4QF+9JOS0nbaaYDCQfwCJ7Au3AHj+LO13FMmm6cl7785vven0kBjHCBhfpYuNa5Ph1c0e2Xu3jEvWG7UdPDLZ4N92nOm+EBXuAbHmIMSRMs+4aUEd4Nd3CHD8NdvOLTsA2GL8M9PODbcL+hD7C1xoaHeLJSEao0FEW14ckxC+TU8TxvsY6X0eLPmRhry2WVioLpkrbp84LLQPGI7c6sOiUzpWIWS5GzlSgUzzLBSikOPFTOXqly7rqx0Z1Q5BAIoZBSFihQYQOOBEdkCOgXTOHA07HAGjGWiIjaPZNW13/+lm6S9FT7rLHFJ6fQbkATOG1j2OFMucKJJsxIVfQORl+9Jyda6Sl1dUYhSCm1dyClfoeDve4qMYdLEbfqHf3O/AdDumsjAAB42mNgYoAAZQYjBmyAGYQZmdhL8zLdDEydARfoAqIAAAABAAMABwAKABMAB///AA8AAQAAAAAAAAAAAAAAAAABAAAAAA==) format("woff")}.markdown-body{-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%;color:#24292e;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Helvetica,Arial,sans-serif;font-size:16px;line-height:1.5;word-wrap:break-word}.markdown-body .pl-c{color:#6a737d}.markdown-body .pl-c1,.markdown-body .pl-s .pl-v{color:#005cc5}.markdown-body .pl-e,.markdown-body .pl-en{color:#6f42c1}.markdown-body .pl-s .pl-s1,.markdown-body .pl-smi{color:#24292e}.markdown-body .pl-ent{color:#22863a}.markdown-body .pl-k{color:#d73a49}.markdown-body .pl-pds,.markdown-body .pl-s,.markdown-body .pl-s .pl-pse .pl-s1,.markdown-body .pl-sr,.markdown-body .pl-sr .pl-cce,.markdown-body .pl-sr .pl-sra,.markdown-body .pl-sr .pl-sre{color:#032f62}.markdown-body .pl-smw,.markdown-body .pl-v{color:#e36209}.markdown-body .pl-bu{color:#b31d28}.markdown-body .pl-ii{color:#fafbfc;background-color:#b31d28}.markdown-body .pl-c2{color:#fafbfc;background-color:#d73a49}.markdown-body .pl-c2:before{content:"^M"}.markdown-body .pl-sr .pl-cce{font-weight:700;color:#22863a}.markdown-body .pl-ml{color:#735c0f}.markdown-body .pl-mh,.markdown-body .pl-mh .pl-en,.markdown-body .pl-ms{font-weight:700;color:#005cc5}.markdown-body .pl-mi{font-style:italic;color:#24292e}.markdown-body .pl-mb{font-weight:700;color:#24292e}.markdown-body .pl-md{color:#b31d28;background-color:#ffeef0}.markdown-body .pl-mi1{color:#22863a;background-color:#f0fff4}.markdown-body .pl-mc{color:#e36209;background-color:#ffebda}.markdown-body .pl-mi2{color:#f6f8fa;background-color:#005cc5}.markdown-body .pl-mdr{font-weight:700;color:#6f42c1}.markdown-body .pl-ba{color:#586069}.markdown-body .pl-sg{color:#959da5}.markdown-body .pl-corl{text-decoration:underline;color:#032f62}.markdown-body .octicon{display:inline-block;vertical-align:text-top;fill:currentColor}.markdown-body a{background-color:transparent;-webkit-text-decoration-skip:objects}.markdown-body a:active,.markdown-body a:hover{outline-width:0}.markdown-body strong{font-weight:inherit;font-weight:bolder}.markdown-body h1{margin:.67em 0}.markdown-body img{border-style:none}.markdown-body svg:not(:root){overflow:hidden}.markdown-body code,.markdown-body kbd,.markdown-body pre{font-family:monospace,monospace;font-size:1em}.markdown-body hr{-webkit-box-sizing:content-box;box-sizing:content-box;overflow:visible}.markdown-body input{font:inherit;margin:0;overflow:visible}.markdown-body [type=checkbox]{padding:0}.markdown-body *,.markdown-body [type=checkbox]{-webkit-box-sizing:border-box;box-sizing:border-box}.markdown-body input{font-family:inherit;font-size:inherit;line-height:inherit}.markdown-body a{color:#0366d6;text-decoration:none}.markdown-body a:hover{text-decoration:underline}.markdown-body strong{font-weight:600}.markdown-body hr{height:0;margin:15px 0;overflow:hidden;background:transparent;border-bottom:1px solid #dfe2e5}.markdown-body hr:after,.markdown-body hr:before{display:table;content:""}.markdown-body hr:after{clear:both}.markdown-body table{border-spacing:0;border-collapse:collapse}.markdown-body td,.markdown-body th{padding:0}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{margin-top:0;margin-bottom:0}.markdown-body h1{font-size:32px;font-weight:600}.markdown-body h2{font-size:24px;font-weight:600}.markdown-body h3{font-size:20px;font-weight:600}.markdown-body h4{font-size:16px;font-weight:600}.markdown-body h5{font-size:14px;font-weight:600}.markdown-body h6{font-size:12px;font-weight:600}.markdown-body p{margin-top:0;margin-bottom:10px}.markdown-body blockquote{margin:0}.markdown-body ol,.markdown-body ul{padding-left:0;margin-top:0;margin-bottom:0}.markdown-body ol ol,.markdown-body ul ol{list-style-type:lower-roman}.markdown-body ol ol ol,.markdown-body ol ul ol,.markdown-body ul ol ol,.markdown-body ul ul ol{list-style-type:lower-alpha}.markdown-body dd{margin-left:0}.markdown-body code{font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,Courier,monospace;font-size:12px}.markdown-body pre{margin-top:0;margin-bottom:0;font:12px SFMono-Regular,Consolas,Liberation Mono,Menlo,Courier,monospace}.markdown-body .octicon{vertical-align:text-bottom}.markdown-body .pl-0{padding-left:0!important}.markdown-body .pl-1{padding-left:4px!important}.markdown-body .pl-2{padding-left:8px!important}.markdown-body .pl-3{padding-left:16px!important}.markdown-body .pl-4{padding-left:24px!important}.markdown-body .pl-5{padding-left:32px!important}.markdown-body .pl-6{padding-left:40px!important}.markdown-body:after,.markdown-body:before{display:table;content:""}.markdown-body:after{clear:both}.markdown-body>:first-child{margin-top:0!important}.markdown-body>:last-child{margin-bottom:0!important}.markdown-body a:not([href]){color:inherit;text-decoration:none}.markdown-body .anchor{float:left;padding-right:4px;margin-left:-20px;line-height:1}.markdown-body .anchor:focus{outline:none}.markdown-body blockquote,.markdown-body dl,.markdown-body ol,.markdown-body p,.markdown-body pre,.markdown-body table,.markdown-body ul{margin-top:0;margin-bottom:16px}.markdown-body hr{height:.25em;padding:0;margin:24px 0;background-color:#e1e4e8;border:0}.markdown-body blockquote{padding:0 1em;color:#6a737d;border-left:.25em solid #dfe2e5}.markdown-body blockquote>:first-child{margin-top:0}.markdown-body blockquote>:last-child{margin-bottom:0}.markdown-body kbd{font-size:11px;border:1px solid #c6cbd1;border-bottom-color:#959da5;-webkit-box-shadow:inset 0 -1px 0 #959da5;box-shadow:inset 0 -1px 0 #959da5}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{margin-top:24px;margin-bottom:16px;font-weight:600;line-height:1.25}.markdown-body h1 .octicon-link,.markdown-body h2 .octicon-link,.markdown-body h3 .octicon-link,.markdown-body h4 .octicon-link,.markdown-body h5 .octicon-link,.markdown-body h6 .octicon-link{color:#1b1f23;vertical-align:middle;visibility:hidden}.markdown-body h1:hover .anchor,.markdown-body h2:hover .anchor,.markdown-body h3:hover .anchor,.markdown-body h4:hover .anchor,.markdown-body h5:hover .anchor,.markdown-body h6:hover .anchor{text-decoration:none}.markdown-body h1:hover .anchor .octicon-link,.markdown-body h2:hover .anchor .octicon-link,.markdown-body h3:hover .anchor .octicon-link,.markdown-body h4:hover .anchor .octicon-link,.markdown-body h5:hover .anchor .octicon-link,.markdown-body h6:hover .anchor .octicon-link{visibility:visible}.markdown-body h1{font-size:2em}.markdown-body h1,.markdown-body h2{padding-bottom:.3em;border-bottom:1px solid #eaecef}.markdown-body h2{font-size:1.5em}.markdown-body h3{font-size:1.25em}.markdown-body h4{font-size:1em}.markdown-body h5{font-size:.875em}.markdown-body h6{font-size:.85em;color:#6a737d}.markdown-body ol,.markdown-body ul{padding-left:2em}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:0;margin-bottom:0}.markdown-body li>p{margin-top:16px}.markdown-body li+li{margin-top:.25em}.markdown-body dl{padding:0}.markdown-body dl dt{padding:0;margin-top:16px;font-size:1em;font-style:italic;font-weight:600}.markdown-body dl dd{padding:0 16px;margin-bottom:16px}.markdown-body table{display:block;width:100%;overflow:auto}.markdown-body table th{font-weight:600}.markdown-body table td,.markdown-body table th{padding:6px 13px;border:1px solid #dfe2e5}.markdown-body table tr{background-color:#fff;border-top:1px solid #c6cbd1}.markdown-body table tr:nth-child(2n){background-color:#f6f8fa}.markdown-body img{max-width:100%;-webkit-box-sizing:content-box;box-sizing:content-box;background-color:#fff}.markdown-body code{padding:0;padding-top:.2em;padding-bottom:.2em;margin:0;font-size:85%;background-color:rgba(27,31,35,.05);border-radius:3px}.markdown-body code:after,.markdown-body code:before{letter-spacing:-.2em;content:"\A0"}.markdown-body pre{word-wrap:normal}.markdown-body pre>code{padding:0;margin:0;font-size:100%;word-break:normal;white-space:pre;background:transparent;border:0}.markdown-body .highlight{margin-bottom:16px}.markdown-body .highlight pre{margin-bottom:0;word-break:normal}.markdown-body .highlight pre,.markdown-body pre{padding:16px;overflow:auto;font-size:85%;line-height:1.45;background-color:#f6f8fa;border-radius:3px}.markdown-body pre code{display:inline;max-width:auto;padding:0;margin:0;overflow:visible;line-height:inherit;word-wrap:normal;background-color:transparent;border:0}.markdown-body pre code:after,.markdown-body pre code:before{content:normal}.markdown-body .full-commit .btn-outline:not(:disabled):hover{color:#005cc5;border-color:#005cc5}.markdown-body kbd{display:inline-block;padding:3px 5px;font:11px SFMono-Regular,Consolas,Liberation Mono,Menlo,Courier,monospace;line-height:10px;color:#444d56;vertical-align:middle;background-color:#fafbfc;border:1px solid #d1d5da;border-bottom-color:#c6cbd1;border-radius:3px;-webkit-box-shadow:inset 0 -1px 0 #c6cbd1;box-shadow:inset 0 -1px 0 #c6cbd1}.markdown-body :checked+.radio-label{position:relative;z-index:1;border-color:#0366d6}.markdown-body .task-list-item{list-style-type:none}.markdown-body .task-list-item+.task-list-item{margin-top:3px}.markdown-body .task-list-item input{margin:0 .2em .25em -1.6em;vertical-align:middle}.markdown-body hr{border-bottom-color:#eee}.gt-container{font-size:16px}.gt-container,.gt-container *{-webkit-box-sizing:border-box;box-sizing:border-box}.gt-container a{color:#6190e8}.gt-container a:hover{color:#81a6ed;border-color:#81a6ed}.gt-container a.is--active{color:#333;cursor:default!important}.gt-container a.is--active:hover{color:#333}.gt-container .hide{display:none!important}.gt-container .gt-svg{display:inline-block;width:1em;height:1em;vertical-align:sub}.gt-container .gt-svg svg{width:100%;height:100%;fill:#6190e8}.gt-container .gt-ico{display:inline-block}.gt-container .gt-ico-text{margin-left:.3125em}.gt-container .gt-ico-github,.gt-container .gt-ico-github .gt-svg{width:100%;height:100%}.gt-container .gt-ico-github svg{fill:inherit}.gt-container .gt-spinner{position:relative}.gt-container .gt-spinner:before{content:"";-webkit-box-sizing:border-box;box-sizing:border-box;position:absolute;top:3px;width:.75em;height:.75em;margin-top:-.1875em;margin-left:-.375em;border-radius:50%;border:1px solid #fff;border-top-color:#6190e8;-webkit-animation:gt-kf-rotate .6s linear infinite;animation:gt-kf-rotate .6s linear infinite}.gt-container .gt-loader{position:relative;border:1px solid #999;-webkit-animation:ease gt-kf-rotate 1.5s infinite;animation:ease gt-kf-rotate 1.5s infinite;display:inline-block;font-style:normal;width:1.75em;height:1.75em;line-height:1.75em;border-radius:50%}.gt-container .gt-loader:before{content:"";position:absolute;display:block;top:0;left:50%;margin-top:-.1875em;margin-left:-.1875em;width:.375em;height:.375em;background-color:#999;border-radius:50%}.gt-container .gt-avatar{display:inline-block;width:3.125em;height:3.125em}@media (max-width:479px){.gt-container .gt-avatar{width:2em;height:2em}}.gt-container .gt-avatar img{width:100%;height:auto;border-radius:3px}.gt-container .gt-avatar-github{width:3em;height:3em;cursor:pointer}@media (max-width:479px){.gt-container .gt-avatar-github{width:1.875em;height:1.875em}}.gt-container .gt-btn{padding:.75em 1.25em;display:inline-block;line-height:1;text-decoration:none;white-space:nowrap;cursor:pointer;border:1px solid #6190e8;border-radius:5px;background-color:#6190e8;color:#fff;outline:none;font-size:.75em}.gt-container .gt-btn-text{font-weight:400}.gt-container .gt-btn-loading{position:relative;margin-left:.5em;display:inline-block;width:.75em;height:1em;vertical-align:top}.gt-container .gt-btn.is--disable{cursor:not-allowed;opacity:.5}.gt-container .gt-btn-login{margin-right:0}.gt-container .gt-btn-preview{background-color:#fff;color:#6190e8}.gt-container .gt-btn-preview:hover{background-color:#f2f2f2;border-color:#81a6ed}.gt-container .gt-btn-public:hover{background-color:#81a6ed;border-color:#81a6ed}.gt-container .gt-error{text-align:center;margin:.625em;color:#ff3860}.gt-container .gt-initing{padding:1.25em 0;text-align:center}.gt-container .gt-initing-text{margin:.625em auto;font-size:92%}.gt-container .gt-no-init{padding:1.25em 0;text-align:center}.gt-container .gt-link{border-bottom:1px dotted #6190e8}.gt-container .gt-link-counts,.gt-container .gt-link-project{text-decoration:none}.gt-container .gt-meta{margin:1.25em 0;padding:1em 0;border-bottom:1px solid #e9e9e9;font-size:1em;position:relative;z-index:10}.gt-container .gt-meta:after,.gt-container .gt-meta:before{content:" ";display:table}.gt-container .gt-meta:after{clear:both}.gt-container .gt-counts{margin:0 .625em 0 0}.gt-container .gt-user{float:right;margin:0;font-size:92%}.gt-container .gt-user-pic{width:16px;height:16px;vertical-align:top;margin-right:.5em}.gt-container .gt-user-inner{display:inline-block;cursor:pointer}.gt-container .gt-user .gt-ico{margin:0 0 0 .3125em}.gt-container .gt-user .gt-ico svg{fill:inherit}.gt-container .gt-user .is--poping .gt-ico svg{fill:#6190e8}.gt-container .gt-version{color:#a1a1a1;margin-left:.375em}.gt-container .gt-copyright{margin:0 .9375em .5em;border-top:1px solid #e9e9e9;padding-top:.5em}.gt-container .gt-popup{position:absolute;right:0;top:2.375em;background:#fff;display:inline-block;border:1px solid #e9e9e9;padding:.625em 0;font-size:.875em;letter-spacing:.5px}.gt-container .gt-popup .gt-action{cursor:pointer;display:block;margin:.5em 0;padding:0 1.125em;position:relative;text-decoration:none}.gt-container .gt-popup .gt-action.is--active:before{content:"";width:.25em;height:.25em;background:#6190e8;position:absolute;left:.5em;top:.4375em}.gt-container .gt-header{position:relative;display:-webkit-box;display:-ms-flexbox;display:flex}.gt-container .gt-header-comment{-webkit-box-flex:1;-ms-flex:1;flex:1;margin-left:1.25em}@media (max-width:479px){.gt-container .gt-header-comment{margin-left:.875em}}.gt-container .gt-header-textarea{padding:.75em;display:block;-webkit-box-sizing:border-box;box-sizing:border-box;width:100%;min-height:5.125em;max-height:15em;border-radius:5px;border:1px solid rgba(0,0,0,.1);font-size:.875em;word-wrap:break-word;resize:vertical;background-color:#f6f6f6;outline:none;-webkit-transition:all .25s ease;transition:all .25s ease}.gt-container .gt-header-textarea:hover{background-color:#fbfbfb}.gt-container .gt-header-preview{padding:.75em;border-radius:5px;border:1px solid rgba(0,0,0,.1);background-color:#f6f6f6}.gt-container .gt-header-controls{position:relative;margin:.75em 0 0}.gt-container .gt-header-controls:after,.gt-container .gt-header-controls:before{content:" ";display:table}.gt-container .gt-header-controls:after{clear:both}@media (max-width:479px){.gt-container .gt-header-controls{margin:0}}.gt-container .gt-header-controls-tip{font-size:.875em;color:#6190e8;text-decoration:none;vertical-align:sub}@media (max-width:479px){.gt-container .gt-header-controls-tip{display:none}}.gt-container .gt-header-controls .gt-btn{float:right;margin-left:1.25em}@media (max-width:479px){.gt-container .gt-header-controls .gt-btn{float:none;width:100%;margin:.75em 0 0}}.gt-container:after{content:"";position:fixed;bottom:100%;left:0;right:0;top:0;opacity:0}.gt-container.gt-input-focused{position:relative}.gt-container.gt-input-focused:after{content:"";position:fixed;bottom:0;left:0;right:0;top:0;background:#000;opacity:.6;-webkit-transition:opacity .3s,bottom 0s;transition:opacity .3s,bottom 0s;z-index:9999}.gt-container.gt-input-focused .gt-header-comment{z-index:10000}.gt-container .gt-comments{padding-top:1.25em}.gt-container .gt-comments-null{text-align:center}.gt-container .gt-comments-controls{margin:1.25em 0;text-align:center}.gt-container .gt-comment{position:relative;padding:.625em 0;display:-webkit-box;display:-ms-flexbox;display:flex}.gt-container .gt-comment-content{-webkit-box-flex:1;-ms-flex:1;flex:1;margin-left:1.25em;padding:.75em 1em;background-color:#f9f9f9;overflow:auto;-webkit-transition:all .25s ease;transition:all .25s ease}.gt-container .gt-comment-content:hover{-webkit-box-shadow:0 .625em 3.75em 0 #f4f4f4;box-shadow:0 .625em 3.75em 0 #f4f4f4}@media (max-width:479px){.gt-container .gt-comment-content{margin-left:.875em;padding:.625em .75em}}.gt-container .gt-comment-header{margin-bottom:.5em;font-size:.875em;position:relative}.gt-container .gt-comment-block-1{float:right;height:1.375em;width:2em}.gt-container .gt-comment-block-2{float:right;height:1.375em;width:4em}.gt-container .gt-comment-username{font-weight:500;color:#6190e8;text-decoration:none}.gt-container .gt-comment-username:hover{text-decoration:underline}.gt-container .gt-comment-date,.gt-container .gt-comment-text{margin-left:.5em;color:#a1a1a1}.gt-container .gt-comment-edit,.gt-container .gt-comment-like,.gt-container .gt-comment-reply{position:absolute;height:1.375em}.gt-container .gt-comment-edit:hover,.gt-container .gt-comment-like:hover,.gt-container .gt-comment-reply:hover{cursor:pointer}.gt-container .gt-comment-like{top:0;right:2em}.gt-container .gt-comment-edit,.gt-container .gt-comment-reply{top:0;right:0}.gt-container .gt-comment-body{color:#333!important}.gt-container .gt-comment-body .email-hidden-toggle a{display:inline-block;height:12px;padding:0 9px;font-size:12px;font-weight:600;line-height:6px;color:#444d56;text-decoration:none;vertical-align:middle;background:#dfe2e5;border-radius:1px}.gt-container .gt-comment-body .email-hidden-toggle a:hover{background-color:#c6cbd1}.gt-container .gt-comment-body .email-hidden-reply{display:none;white-space:pre-wrap}.gt-container .gt-comment-body .email-hidden-reply .email-signature-reply{padding:0 15px;margin:15px 0;color:#586069;border-left:4px solid #dfe2e5}.gt-container .gt-comment-body .email-hidden-reply.expanded{display:block}.gt-container .gt-comment-admin .gt-comment-content{background-color:#f6f9fe}@-webkit-keyframes gt-kf-rotate{0%{-webkit-transform:rotate(0);transform:rotate(0)}to{-webkit-transform:rotate(1turn);transform:rotate(1turn)}}@keyframes gt-kf-rotate{0%{-webkit-transform:rotate(0);transform:rotate(0)}to{-webkit-transform:rotate(1turn);transform:rotate(1turn)}}/*! normalize.css v3.0.3 | MIT License | github.com/necolas/normalize.css */html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}body{margin:0}article,aside,details,figcaption,figure,footer,header,hgroup,main,menu,nav,section,summary{display:block}audio,canvas,progress,video{display:inline-block;vertical-align:baseline}audio:not([controls]){display:none;height:0}[hidden],template{display:none}a{background-color:transparent}a:active,a:hover{outline:0}abbr[title]{border-bottom:none;text-decoration:underline;text-decoration:underline dotted}b,strong{font-weight:700}dfn{font-style:italic}h1{font-size:2em;margin:.67em 0}mark{background:#ff0;color:#000}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sup{top:-.5em}sub{bottom:-.25em}img{border:0}svg:not(:root){overflow:hidden}figure{margin:1em 40px}hr{box-sizing:content-box;height:0}pre{overflow:auto}code,kbd,pre,samp{font-family:monospace,monospace;font-size:1em}button,input,optgroup,select,textarea{color:inherit;font:inherit;margin:0}button{overflow:visible}button,select{text-transform:none}button,html input[type=button],input[type=reset],input[type=submit]{-webkit-appearance:button;cursor:pointer}button[disabled],html input[disabled]{cursor:default}button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}input{line-height:normal}input[type=checkbox],input[type=radio]{box-sizing:border-box;padding:0}input[type=number]::-webkit-inner-spin-button,input[type=number]::-webkit-outer-spin-button{height:auto}input[type=search]{-webkit-appearance:textfield;box-sizing:content-box}input[type=search]::-webkit-search-cancel-button,input[type=search]::-webkit-search-decoration{-webkit-appearance:none}fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}textarea{overflow:auto}optgroup{font-weight:700}table{border-collapse:collapse;border-spacing:0}td,th{padding:0}

/*! Source: https://github.com/h5bp/html5-boilerplate/blob/master/src/css/main.css */@media print{*,:after,:before{color:#000!important;text-shadow:none!important;background:transparent!important;box-shadow:none!important}a,a:visited{text-decoration:underline}a[href]:after{content:" (" attr(href) ")"}abbr[title]:after{content:" (" attr(title) ")"}a[href^="#"]:after,a[href^="javascript:"]:after{content:""}blockquote,pre{border:1px solid #999;page-break-inside:avoid}thead{display:table-header-group}img,tr{page-break-inside:avoid}img{max-width:100%!important}h2,h3,p{orphans:3;widows:3}h2,h3{page-break-after:avoid}.navbar{display:none}.btn>.caret,.dropup>.btn>.caret{border-top-color:#000!important}.label{border:1px solid #000}.table{border-collapse:collapse!important}.table td,.table th{background-color:#fff!important}.table-bordered td,.table-bordered th{border:1px solid #ddd!important}}@font-face{font-family:Glyphicons Halflings;src:url(twbs-font-path("bootstrap/glyphicons-halflings-regular.eot"));src:url(twbs-font-path("bootstrap/glyphicons-halflings-regular.eot?#iefix")) format("embedded-opentype"),url(twbs-font-path("bootstrap/glyphicons-halflings-regular.woff2")) format("woff2"),url(twbs-font-path("bootstrap/glyphicons-halflings-regular.woff")) format("woff"),url(twbs-font-path("bootstrap/glyphicons-halflings-regular.ttf")) format("truetype"),url(twbs-font-path("bootstrap/glyphicons-halflings-regular.svg#glyphicons_halflingsregular")) format("svg")}.glyphicon{position:relative;top:1px;display:inline-block;font-family:Glyphicons Halflings;font-style:normal;font-weight:400;line-height:1;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}.glyphicon-asterisk:before{content:"*"}.glyphicon-plus:before{content:"+"}.glyphicon-eur:before,.glyphicon-euro:before{content:"\20AC"}.glyphicon-minus:before{content:"\2212"}.glyphicon-cloud:before{content:"\2601"}.glyphicon-envelope:before{content:"\2709"}.glyphicon-pencil:before{content:"\270F"}.glyphicon-glass:before{content:"\E001"}.glyphicon-music:before{content:"\E002"}.glyphicon-search:before{content:"\E003"}.glyphicon-heart:before{content:"\E005"}.glyphicon-star:before{content:"\E006"}.glyphicon-star-empty:before{content:"\E007"}.glyphicon-user:before{content:"\E008"}.glyphicon-film:before{content:"\E009"}.glyphicon-th-large:before{content:"\E010"}.glyphicon-th:before{content:"\E011"}.glyphicon-th-list:before{content:"\E012"}.glyphicon-ok:before{content:"\E013"}.glyphicon-remove:before{content:"\E014"}.glyphicon-zoom-in:before{content:"\E015"}.glyphicon-zoom-out:before{content:"\E016"}.glyphicon-off:before{content:"\E017"}.glyphicon-signal:before{content:"\E018"}.glyphicon-cog:before{content:"\E019"}.glyphicon-trash:before{content:"\E020"}.glyphicon-home:before{content:"\E021"}.glyphicon-file:before{content:"\E022"}.glyphicon-time:before{content:"\E023"}.glyphicon-road:before{content:"\E024"}.glyphicon-download-alt:before{content:"\E025"}.glyphicon-download:before{content:"\E026"}.glyphicon-upload:before{content:"\E027"}.glyphicon-inbox:before{content:"\E028"}.glyphicon-play-circle:before{content:"\E029"}.glyphicon-repeat:before{content:"\E030"}.glyphicon-refresh:before{content:"\E031"}.glyphicon-list-alt:before{content:"\E032"}.glyphicon-lock:before{content:"\E033"}.glyphicon-flag:before{content:"\E034"}.glyphicon-headphones:before{content:"\E035"}.glyphicon-volume-off:before{content:"\E036"}.glyphicon-volume-down:before{content:"\E037"}.glyphicon-volume-up:before{content:"\E038"}.glyphicon-qrcode:before{content:"\E039"}.glyphicon-barcode:before{content:"\E040"}.glyphicon-tag:before{content:"\E041"}.glyphicon-tags:before{content:"\E042"}.glyphicon-book:before{content:"\E043"}.glyphicon-bookmark:before{content:"\E044"}.glyphicon-print:before{content:"\E045"}.glyphicon-camera:before{content:"\E046"}.glyphicon-font:before{content:"\E047"}.glyphicon-bold:before{content:"\E048"}.glyphicon-italic:before{content:"\E049"}.glyphicon-text-height:before{content:"\E050"}.glyphicon-text-width:before{content:"\E051"}.glyphicon-align-left:before{content:"\E052"}.glyphicon-align-center:before{content:"\E053"}.glyphicon-align-right:before{content:"\E054"}.glyphicon-align-justify:before{content:"\E055"}.glyphicon-list:before{content:"\E056"}.glyphicon-indent-left:before{content:"\E057"}.glyphicon-indent-right:before{content:"\E058"}.glyphicon-facetime-video:before{content:"\E059"}.glyphicon-picture:before{content:"\E060"}.glyphicon-map-marker:before{content:"\E062"}.glyphicon-adjust:before{content:"\E063"}.glyphicon-tint:before{content:"\E064"}.glyphicon-edit:before{content:"\E065"}.glyphicon-share:before{content:"\E066"}.glyphicon-check:before{content:"\E067"}.glyphicon-move:before{content:"\E068"}.glyphicon-step-backward:before{content:"\E069"}.glyphicon-fast-backward:before{content:"\E070"}.glyphicon-backward:before{content:"\E071"}.glyphicon-play:before{content:"\E072"}.glyphicon-pause:before{content:"\E073"}.glyphicon-stop:before{content:"\E074"}.glyphicon-forward:before{content:"\E075"}.glyphicon-fast-forward:before{content:"\E076"}.glyphicon-step-forward:before{content:"\E077"}.glyphicon-eject:before{content:"\E078"}.glyphicon-chevron-left:before{content:"\E079"}.glyphicon-chevron-right:before{content:"\E080"}.glyphicon-plus-sign:before{content:"\E081"}.glyphicon-minus-sign:before{content:"\E082"}.glyphicon-remove-sign:before{content:"\E083"}.glyphicon-ok-sign:before{content:"\E084"}.glyphicon-question-sign:before{content:"\E085"}.glyphicon-info-sign:before{content:"\E086"}.glyphicon-screenshot:before{content:"\E087"}.glyphicon-remove-circle:before{content:"\E088"}.glyphicon-ok-circle:before{content:"\E089"}.glyphicon-ban-circle:before{content:"\E090"}.glyphicon-arrow-left:before{content:"\E091"}.glyphicon-arrow-right:before{content:"\E092"}.glyphicon-arrow-up:before{content:"\E093"}.glyphicon-arrow-down:before{content:"\E094"}.glyphicon-share-alt:before{content:"\E095"}.glyphicon-resize-full:before{content:"\E096"}.glyphicon-resize-small:before{content:"\E097"}.glyphicon-exclamation-sign:before{content:"\E101"}.glyphicon-gift:before{content:"\E102"}.glyphicon-leaf:before{content:"\E103"}.glyphicon-fire:before{content:"\E104"}.glyphicon-eye-open:before{content:"\E105"}.glyphicon-eye-close:before{content:"\E106"}.glyphicon-warning-sign:before{content:"\E107"}.glyphicon-plane:before{content:"\E108"}.glyphicon-calendar:before{content:"\E109"}.glyphicon-random:before{content:"\E110"}.glyphicon-comment:before{content:"\E111"}.glyphicon-magnet:before{content:"\E112"}.glyphicon-chevron-up:before{content:"\E113"}.glyphicon-chevron-down:before{content:"\E114"}.glyphicon-retweet:before{content:"\E115"}.glyphicon-shopping-cart:before{content:"\E116"}.glyphicon-folder-close:before{content:"\E117"}.glyphicon-folder-open:before{content:"\E118"}.glyphicon-resize-vertical:before{content:"\E119"}.glyphicon-resize-horizontal:before{content:"\E120"}.glyphicon-hdd:before{content:"\E121"}.glyphicon-bullhorn:before{content:"\E122"}.glyphicon-bell:before{content:"\E123"}.glyphicon-certificate:before{content:"\E124"}.glyphicon-thumbs-up:before{content:"\E125"}.glyphicon-thumbs-down:before{content:"\E126"}.glyphicon-hand-right:before{content:"\E127"}.glyphicon-hand-left:before{content:"\E128"}.glyphicon-hand-up:before{content:"\E129"}.glyphicon-hand-down:before{content:"\E130"}.glyphicon-circle-arrow-right:before{content:"\E131"}.glyphicon-circle-arrow-left:before{content:"\E132"}.glyphicon-circle-arrow-up:before{content:"\E133"}.glyphicon-circle-arrow-down:before{content:"\E134"}.glyphicon-globe:before{content:"\E135"}.glyphicon-wrench:before{content:"\E136"}.glyphicon-tasks:before{content:"\E137"}.glyphicon-filter:before{content:"\E138"}.glyphicon-briefcase:before{content:"\E139"}.glyphicon-fullscreen:before{content:"\E140"}.glyphicon-dashboard:before{content:"\E141"}.glyphicon-paperclip:before{content:"\E142"}.glyphicon-heart-empty:before{content:"\E143"}.glyphicon-link:before{content:"\E144"}.glyphicon-phone:before{content:"\E145"}.glyphicon-pushpin:before{content:"\E146"}.glyphicon-usd:before{content:"\E148"}.glyphicon-gbp:before{content:"\E149"}.glyphicon-sort:before{content:"\E150"}.glyphicon-sort-by-alphabet:before{content:"\E151"}.glyphicon-sort-by-alphabet-alt:before{content:"\E152"}.glyphicon-sort-by-order:before{content:"\E153"}.glyphicon-sort-by-order-alt:before{content:"\E154"}.glyphicon-sort-by-attributes:before{content:"\E155"}.glyphicon-sort-by-attributes-alt:before{content:"\E156"}.glyphicon-unchecked:before{content:"\E157"}.glyphicon-expand:before{content:"\E158"}.glyphicon-collapse-down:before{content:"\E159"}.glyphicon-collapse-up:before{content:"\E160"}.glyphicon-log-in:before{content:"\E161"}.glyphicon-flash:before{content:"\E162"}.glyphicon-log-out:before{content:"\E163"}.glyphicon-new-window:before{content:"\E164"}.glyphicon-record:before{content:"\E165"}.glyphicon-save:before{content:"\E166"}.glyphicon-open:before{content:"\E167"}.glyphicon-saved:before{content:"\E168"}.glyphicon-import:before{content:"\E169"}.glyphicon-export:before{content:"\E170"}.glyphicon-send:before{content:"\E171"}.glyphicon-floppy-disk:before{content:"\E172"}.glyphicon-floppy-saved:before{content:"\E173"}.glyphicon-floppy-remove:before{content:"\E174"}.glyphicon-floppy-save:before{content:"\E175"}.glyphicon-floppy-open:before{content:"\E176"}.glyphicon-credit-card:before{content:"\E177"}.glyphicon-transfer:before{content:"\E178"}.glyphicon-cutlery:before{content:"\E179"}.glyphicon-header:before{content:"\E180"}.glyphicon-compressed:before{content:"\E181"}.glyphicon-earphone:before{content:"\E182"}.glyphicon-phone-alt:before{content:"\E183"}.glyphicon-tower:before{content:"\E184"}.glyphicon-stats:before{content:"\E185"}.glyphicon-sd-video:before{content:"\E186"}.glyphicon-hd-video:before{content:"\E187"}.glyphicon-subtitles:before{content:"\E188"}.glyphicon-sound-stereo:before{content:"\E189"}.glyphicon-sound-dolby:before{content:"\E190"}.glyphicon-sound-5-1:before{content:"\E191"}.glyphicon-sound-6-1:before{content:"\E192"}.glyphicon-sound-7-1:before{content:"\E193"}.glyphicon-copyright-mark:before{content:"\E194"}.glyphicon-registration-mark:before{content:"\E195"}.glyphicon-cloud-download:before{content:"\E197"}.glyphicon-cloud-upload:before{content:"\E198"}.glyphicon-tree-conifer:before{content:"\E199"}.glyphicon-tree-deciduous:before{content:"\E200"}.glyphicon-cd:before{content:"\E201"}.glyphicon-save-file:before{content:"\E202"}.glyphicon-open-file:before{content:"\E203"}.glyphicon-level-up:before{content:"\E204"}.glyphicon-copy:before{content:"\E205"}.glyphicon-paste:before{content:"\E206"}.glyphicon-alert:before{content:"\E209"}.glyphicon-equalizer:before{content:"\E210"}.glyphicon-king:before{content:"\E211"}.glyphicon-queen:before{content:"\E212"}.glyphicon-pawn:before{content:"\E213"}.glyphicon-bishop:before{content:"\E214"}.glyphicon-knight:before{content:"\E215"}.glyphicon-baby-formula:before{content:"\E216"}.glyphicon-tent:before{content:"\26FA"}.glyphicon-blackboard:before{content:"\E218"}.glyphicon-bed:before{content:"\E219"}.glyphicon-apple:before{content:"\F8FF"}.glyphicon-erase:before{content:"\E221"}.glyphicon-hourglass:before{content:"\231B"}.glyphicon-lamp:before{content:"\E223"}.glyphicon-duplicate:before{content:"\E224"}.glyphicon-piggy-bank:before{content:"\E225"}.glyphicon-scissors:before{content:"\E226"}.glyphicon-bitcoin:before,.glyphicon-btc:before,.glyphicon-xbt:before{content:"\E227"}.glyphicon-jpy:before,.glyphicon-yen:before{content:"\A5"}.glyphicon-rub:before,.glyphicon-ruble:before{content:"\20BD"}.glyphicon-scale:before{content:"\E230"}.glyphicon-ice-lolly:before{content:"\E231"}.glyphicon-ice-lolly-tasted:before{content:"\E232"}.glyphicon-education:before{content:"\E233"}.glyphicon-option-horizontal:before{content:"\E234"}.glyphicon-option-vertical:before{content:"\E235"}.glyphicon-menu-hamburger:before{content:"\E236"}.glyphicon-modal-window:before{content:"\E237"}.glyphicon-oil:before{content:"\E238"}.glyphicon-grain:before{content:"\E239"}.glyphicon-sunglasses:before{content:"\E240"}.glyphicon-text-size:before{content:"\E241"}.glyphicon-text-color:before{content:"\E242"}.glyphicon-text-background:before{content:"\E243"}.glyphicon-object-align-top:before{content:"\E244"}.glyphicon-object-align-bottom:before{content:"\E245"}.glyphicon-object-align-horizontal:before{content:"\E246"}.glyphicon-object-align-left:before{content:"\E247"}.glyphicon-object-align-vertical:before{content:"\E248"}.glyphicon-object-align-right:before{content:"\E249"}.glyphicon-triangle-right:before{content:"\E250"}.glyphicon-triangle-left:before{content:"\E251"}.glyphicon-triangle-bottom:before{content:"\E252"}.glyphicon-triangle-top:before{content:"\E253"}.glyphicon-console:before{content:"\E254"}.glyphicon-superscript:before{content:"\E255"}.glyphicon-subscript:before{content:"\E256"}.glyphicon-menu-left:before{content:"\E257"}.glyphicon-menu-right:before{content:"\E258"}.glyphicon-menu-down:before{content:"\E259"}.glyphicon-menu-up:before{content:"\E260"}*,:after,:before{-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box}html{font-size:10px;-webkit-tap-highlight-color:rgba(0,0,0,0)}body{font-family:Helvetica Neue,Helvetica,Arial,sans-serif;font-size:16px;line-height:1.42857;background-color:#fff}button,input,select,textarea{font-family:inherit;font-size:inherit;line-height:inherit}a{color:#337ab7;text-decoration:none}a:focus,a:hover{color:#23527c;text-decoration:underline}a:focus{outline:5px auto -webkit-focus-ring-color;outline-offset:-2px}figure{margin:0}img{vertical-align:middle}.img-responsive{display:block;max-width:100%;height:auto}.img-rounded{border-radius:6px}.img-thumbnail{padding:4px;line-height:1.42857;background-color:#fff;border:1px solid #ddd;border-radius:4px;-webkit-transition:all .2s ease-in-out;-o-transition:all .2s ease-in-out;transition:all .2s ease-in-out;display:inline-block;max-width:100%;height:auto}.img-circle{border-radius:50%}hr{margin-top:20px;margin-bottom:20px;border:0;border-top:1px solid #eee}.sr-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);border:0}.sr-only-focusable:active,.sr-only-focusable:focus{position:static;width:auto;height:auto;margin:0;overflow:visible;clip:auto}[role=button]{cursor:pointer}.h1,.h2,.h3,.h4,.h5,.h6,h1,h2,h3,h4,h5,h6{font-family:inherit;font-weight:500;line-height:1.1;color:inherit}.h1 .small,.h1 small,.h2 .small,.h2 small,.h3 .small,.h3 small,.h4 .small,.h4 small,.h5 .small,.h5 small,.h6 .small,.h6 small,h1 .small,h1 small,h2 .small,h2 small,h3 .small,h3 small,h4 .small,h4 small,h5 .small,h5 small,h6 .small,h6 small{font-weight:400;line-height:1;color:#777}.h1,.h2,.h3,h1,h2,h3{margin-top:20px;margin-bottom:10px}.h1 .small,.h1 small,.h2 .small,.h2 small,.h3 .small,.h3 small,h1 .small,h1 small,h2 .small,h2 small,h3 .small,h3 small{font-size:65%}.h4,.h5,.h6,h4,h5,h6{margin-top:10px;margin-bottom:10px}.h4 .small,.h4 small,.h5 .small,.h5 small,.h6 .small,.h6 small,h4 .small,h4 small,h5 .small,h5 small,h6 .small,h6 small{font-size:75%}.h1,h1{font-size:36px}.h2,h2{font-size:30px}.h3,h3{font-size:24px}.h4,h4{font-size:18px}.h5,h5{font-size:14px}.h6,h6{font-size:12px}p{margin:0 0 10px}.lead{margin-bottom:20px;font-size:18px;font-weight:300;line-height:1.4}@media (min-width:768px){.lead{font-size:24px}}.small,small{font-size:75%}.mark,mark{padding:.2em;background-color:#fcf8e3}.text-left{text-align:left}.text-right{text-align:right}.text-center{text-align:center}.text-justify{text-align:justify}.text-nowrap{white-space:nowrap}.text-lowercase{text-transform:lowercase}.initialism,.text-uppercase{text-transform:uppercase}.text-capitalize{text-transform:capitalize}.text-muted{color:#777}.text-primary{color:#337ab7}a.text-primary:focus,a.text-primary:hover{color:#286090}.text-success{color:#3c763d}a.text-success:focus,a.text-success:hover{color:#2b542c}.text-info{color:#31708f}a.text-info:focus,a.text-info:hover{color:#245269}.text-warning{color:#8a6d3b}a.text-warning:focus,a.text-warning:hover{color:#66512c}.text-danger{color:#a94442}a.text-danger:focus,a.text-danger:hover{color:#843534}.bg-primary{color:#fff;background-color:#337ab7}a.bg-primary:focus,a.bg-primary:hover{background-color:#286090}.bg-success{background-color:#dff0d8}a.bg-success:focus,a.bg-success:hover{background-color:#c1e2b3}.bg-info{background-color:#d9edf7}a.bg-info:focus,a.bg-info:hover{background-color:#afd9ee}.bg-warning{background-color:#fcf8e3}a.bg-warning:focus,a.bg-warning:hover{background-color:#f7ecb5}.bg-danger{background-color:#f2dede}a.bg-danger:focus,a.bg-danger:hover{background-color:#e4b9b9}.page-header{padding-bottom:9px;margin:40px 0 20px;border-bottom:1px solid #eee}ol,ul{margin-top:0;margin-bottom:10px}ol ol,ol ul,ul ol,ul ul{margin-bottom:0}.list-inline,.list-unstyled{padding-left:0;list-style:none}.list-inline{margin-left:-5px}.list-inline>li{display:inline-block;padding-right:5px;padding-left:5px}dl{margin-top:0;margin-bottom:20px}dd,dt{line-height:1.42857}dt{font-weight:700}dd{margin-left:0}.dl-horizontal dd:after,.dl-horizontal dd:before{display:table;content:" "}.dl-horizontal dd:after{clear:both}@media (min-width:768px){.dl-horizontal dt{float:left;width:160px;clear:left;text-align:right;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.dl-horizontal dd{margin-left:180px}}abbr[data-original-title],abbr[title]{cursor:help}.initialism{font-size:90%}blockquote{padding:10px 20px;margin:0 0 20px;font-size:17.5px;border-left:5px solid #eee}blockquote ol:last-child,blockquote p:last-child,blockquote ul:last-child{margin-bottom:0}blockquote .small,blockquote footer,blockquote small{display:block;font-size:80%;line-height:1.42857;color:#777}blockquote .small:before,blockquote footer:before,blockquote small:before{content:"\2014   \A0"}.blockquote-reverse,blockquote.pull-right{padding-right:15px;padding-left:0;text-align:right;border-right:5px solid #eee;border-left:0}.blockquote-reverse .small:before,.blockquote-reverse footer:before,.blockquote-reverse small:before,blockquote.pull-right .small:before,blockquote.pull-right footer:before,blockquote.pull-right small:before{content:""}.blockquote-reverse .small:after,.blockquote-reverse footer:after,.blockquote-reverse small:after,blockquote.pull-right .small:after,blockquote.pull-right footer:after,blockquote.pull-right small:after{content:"\A0   \2014"}address{margin-bottom:20px;font-style:normal;line-height:1.42857}code,kbd,pre,samp{font-family:Menlo,Monaco,Consolas,Courier New,monospace}code{color:#c7254e;background-color:#f9f2f4;border-radius:4px}code,kbd{padding:2px 4px;font-size:90%}kbd{color:#fff;background-color:#333;border-radius:3px;box-shadow:inset 0 -1px 0 rgba(0,0,0,.25)}kbd kbd{padding:0;font-size:100%;font-weight:700;box-shadow:none}pre{display:block;padding:9.5px;margin:0 0 10px;font-size:15px;line-height:1.42857;color:#333;word-break:break-all;word-wrap:break-word;background-color:#f5f5f5;border:1px solid #ccc;border-radius:4px}pre code{padding:0;font-size:inherit;color:inherit;white-space:pre-wrap;background-color:transparent;border-radius:0}.pre-scrollable{max-height:340px;overflow-y:scroll}fieldset{min-width:0;margin:0}fieldset,legend{padding:0;border:0}legend{display:block;width:100%;margin-bottom:20px;font-size:24px;line-height:inherit;color:#333;border-bottom:1px solid #e5e5e5}label{display:inline-block;max-width:100%;margin-bottom:5px;font-weight:700}input[type=search]{-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box;-webkit-appearance:none;appearance:none}input[type=checkbox],input[type=radio]{margin:4px 0 0;margin-top:1px\9;line-height:normal}fieldset[disabled] input[type=checkbox],fieldset[disabled] input[type=radio],input[type=checkbox].disabled,input[type=checkbox][disabled],input[type=radio].disabled,input[type=radio][disabled]{cursor:not-allowed}input[type=file]{display:block}input[type=range]{display:block;width:100%}select[multiple],select[size]{height:auto}input[type=checkbox]:focus,input[type=file]:focus,input[type=radio]:focus{outline:5px auto -webkit-focus-ring-color;outline-offset:-2px}output{padding-top:7px}.form-control,output{display:block;font-size:16px;line-height:1.42857;color:#555}.form-control{width:100%;height:34px;padding:6px 12px;background-color:#fff;background-image:none;border:1px solid #ccc;border-radius:4px;-webkit-box-shadow:inset 0 1px 1px rgba(0,0,0,.075);box-shadow:inset 0 1px 1px rgba(0,0,0,.075);-webkit-transition:border-color .15s ease-in-out,box-shadow .15s ease-in-out;-o-transition:border-color ease-in-out .15s,box-shadow ease-in-out .15s;transition:border-color .15s ease-in-out,box-shadow .15s ease-in-out}.form-control:focus{border-color:#66afe9;outline:0;-webkit-box-shadow:inset 0 1px 1px rgba(0,0,0,.075),0 0 8px rgba(102,175,233,.6);box-shadow:inset 0 1px 1px rgba(0,0,0,.075),0 0 8px rgba(102,175,233,.6)}.form-control::-moz-placeholder{color:#999;opacity:1}.form-control:-ms-input-placeholder{color:#999}.form-control::-webkit-input-placeholder{color:#999}.form-control::-ms-expand{background-color:transparent;border:0}.form-control[disabled],.form-control[readonly],fieldset[disabled] .form-control{background-color:#eee;opacity:1}.form-control[disabled],fieldset[disabled] .form-control{cursor:not-allowed}textarea.form-control{height:auto}@media screen and (-webkit-min-device-pixel-ratio:0){input[type=date].form-control,input[type=datetime-local].form-control,input[type=month].form-control,input[type=time].form-control{line-height:34px}.input-group-sm input[type=date],.input-group-sm input[type=datetime-local],.input-group-sm input[type=month],.input-group-sm input[type=time],input[type=date].input-sm,input[type=datetime-local].input-sm,input[type=month].input-sm,input[type=time].input-sm{line-height:30px}.input-group-lg input[type=date],.input-group-lg input[type=datetime-local],.input-group-lg input[type=month],.input-group-lg input[type=time],input[type=date].input-lg,input[type=datetime-local].input-lg,input[type=month].input-lg,input[type=time].input-lg{line-height:46px}}.form-group{margin-bottom:15px}.checkbox,.radio{position:relative;display:block;margin-top:10px;margin-bottom:10px}.checkbox.disabled label,.radio.disabled label,fieldset[disabled] .checkbox label,fieldset[disabled] .radio label{cursor:not-allowed}.checkbox label,.radio label{min-height:20px;padding-left:20px;margin-bottom:0;font-weight:400;cursor:pointer}.checkbox-inline input[type=checkbox],.checkbox input[type=checkbox],.radio-inline input[type=radio],.radio input[type=radio]{position:absolute;margin-top:4px\9;margin-left:-20px}.checkbox+.checkbox,.radio+.radio{margin-top:-5px}.checkbox-inline,.radio-inline{position:relative;display:inline-block;padding-left:20px;margin-bottom:0;font-weight:400;vertical-align:middle;cursor:pointer}.checkbox-inline.disabled,.radio-inline.disabled,fieldset[disabled] .checkbox-inline,fieldset[disabled] .radio-inline{cursor:not-allowed}.checkbox-inline+.checkbox-inline,.radio-inline+.radio-inline{margin-top:0;margin-left:10px}.form-control-static{min-height:36px;padding-top:7px;padding-bottom:7px;margin-bottom:0}.form-control-static.input-lg,.form-control-static.input-sm{padding-right:0;padding-left:0}.input-sm{height:30px;padding:5px 10px;font-size:12px;line-height:1.5;border-radius:3px}select.input-sm{height:30px;line-height:30px}select[multiple].input-sm,textarea.input-sm{height:auto}.form-group-sm .form-control{height:30px;padding:5px 10px;font-size:12px;line-height:1.5;border-radius:3px}.form-group-sm select.form-control{height:30px;line-height:30px}.form-group-sm select[multiple].form-control,.form-group-sm textarea.form-control{height:auto}.form-group-sm .form-control-static{height:30px;min-height:32px;padding:6px 10px;font-size:12px;line-height:1.5}.input-lg{height:46px;padding:10px 16px;font-size:18px;line-height:1.33333;border-radius:6px}select.input-lg{height:46px;line-height:46px}select[multiple].input-lg,textarea.input-lg{height:auto}.form-group-lg .form-control{height:46px;padding:10px 16px;font-size:18px;line-height:1.33333;border-radius:6px}.form-group-lg select.form-control{height:46px;line-height:46px}.form-group-lg select[multiple].form-control,.form-group-lg textarea.form-control{height:auto}.form-group-lg .form-control-static{height:46px;min-height:38px;padding:11px 16px;font-size:18px;line-height:1.33333}.has-feedback{position:relative}.has-feedback .form-control{padding-right:42.5px}.form-control-feedback{position:absolute;top:0;right:0;z-index:2;display:block;width:34px;height:34px;line-height:34px;text-align:center;pointer-events:none}.form-group-lg .form-control+.form-control-feedback,.input-group-lg+.form-control-feedback,.input-lg+.form-control-feedback{width:46px;height:46px;line-height:46px}.form-group-sm .form-control+.form-control-feedback,.input-group-sm+.form-control-feedback,.input-sm+.form-control-feedback{width:30px;height:30px;line-height:30px}.has-success .checkbox,.has-success .checkbox-inline,.has-success.checkbox-inline label,.has-success.checkbox label,.has-success .control-label,.has-success .help-block,.has-success .radio,.has-success .radio-inline,.has-success.radio-inline label,.has-success.radio label{color:#3c763d}.has-success .form-control{border-color:#3c763d;-webkit-box-shadow:inset 0 1px 1px rgba(0,0,0,.075);box-shadow:inset 0 1px 1px rgba(0,0,0,.075)}.has-success .form-control:focus{border-color:#2b542c;-webkit-box-shadow:inset 0 1px 1px rgba(0,0,0,.075),0 0 6px #67b168;box-shadow:inset 0 1px 1px rgba(0,0,0,.075),0 0 6px #67b168}.has-success .input-group-addon{color:#3c763d;background-color:#dff0d8;border-color:#3c763d}.has-success .form-control-feedback{color:#3c763d}.has-warning .checkbox,.has-warning .checkbox-inline,.has-warning.checkbox-inline label,.has-warning.checkbox label,.has-warning .control-label,.has-warning .help-block,.has-warning .radio,.has-warning .radio-inline,.has-warning.radio-inline label,.has-warning.radio label{color:#8a6d3b}.has-warning .form-control{border-color:#8a6d3b;-webkit-box-shadow:inset 0 1px 1px rgba(0,0,0,.075);box-shadow:inset 0 1px 1px rgba(0,0,0,.075)}.has-warning .form-control:focus{border-color:#66512c;-webkit-box-shadow:inset 0 1px 1px rgba(0,0,0,.075),0 0 6px #c0a16b;box-shadow:inset 0 1px 1px rgba(0,0,0,.075),0 0 6px #c0a16b}.has-warning .input-group-addon{color:#8a6d3b;background-color:#fcf8e3;border-color:#8a6d3b}.has-warning .form-control-feedback{color:#8a6d3b}.has-error .checkbox,.has-error .checkbox-inline,.has-error.checkbox-inline label,.has-error.checkbox label,.has-error .control-label,.has-error .help-block,.has-error .radio,.has-error .radio-inline,.has-error.radio-inline label,.has-error.radio label{color:#a94442}.has-error .form-control{border-color:#a94442;-webkit-box-shadow:inset 0 1px 1px rgba(0,0,0,.075);box-shadow:inset 0 1px 1px rgba(0,0,0,.075)}.has-error .form-control:focus{border-color:#843534;-webkit-box-shadow:inset 0 1px 1px rgba(0,0,0,.075),0 0 6px #ce8483;box-shadow:inset 0 1px 1px rgba(0,0,0,.075),0 0 6px #ce8483}.has-error .input-group-addon{color:#a94442;background-color:#f2dede;border-color:#a94442}.has-error .form-control-feedback{color:#a94442}.has-feedback label~.form-control-feedback{top:25px}.has-feedback label.sr-only~.form-control-feedback{top:0}.help-block{display:block;margin-top:5px;margin-bottom:10px;color:#737373}@media (min-width:768px){.form-inline .form-group{display:inline-block;margin-bottom:0;vertical-align:middle}.form-inline .form-control{display:inline-block;width:auto;vertical-align:middle}.form-inline .form-control-static{display:inline-block}.form-inline .input-group{display:inline-table;vertical-align:middle}.form-inline .input-group .form-control,.form-inline .input-group .input-group-addon,.form-inline .input-group .input-group-btn{width:auto}.form-inline .input-group>.form-control{width:100%}.form-inline .control-label{margin-bottom:0;vertical-align:middle}.form-inline .checkbox,.form-inline .radio{display:inline-block;margin-top:0;margin-bottom:0;vertical-align:middle}.form-inline .checkbox label,.form-inline .radio label{padding-left:0}.form-inline .checkbox input[type=checkbox],.form-inline .radio input[type=radio]{position:relative;margin-left:0}.form-inline .has-feedback .form-control-feedback{top:0}}.form-horizontal .checkbox,.form-horizontal .checkbox-inline,.form-horizontal .radio,.form-horizontal .radio-inline{padding-top:7px;margin-top:0;margin-bottom:0}.form-horizontal .checkbox,.form-horizontal .radio{min-height:27px}.form-horizontal .form-group{margin-right:-15px;margin-left:-15px}.form-horizontal .form-group:after,.form-horizontal .form-group:before{display:table;content:" "}.form-horizontal .form-group:after{clear:both}@media (min-width:768px){.form-horizontal .control-label{padding-top:7px;margin-bottom:0;text-align:right}}.form-horizontal .has-feedback .form-control-feedback{right:15px}@media (min-width:768px){.form-horizontal .form-group-lg .control-label{padding-top:11px;font-size:18px}}@media (min-width:768px){.form-horizontal .form-group-sm .control-label{padding-top:6px;font-size:12px}}.navbar{position:relative;min-height:50px;margin-bottom:20px;border:1px solid transparent}.navbar:after,.navbar:before{display:table;content:" "}.navbar:after{clear:both}@media (min-width:768px){.navbar{border-radius:4px}}.navbar-header:after,.navbar-header:before{display:table;content:" "}.navbar-header:after{clear:both}@media (min-width:768px){.navbar-header{float:left}}.navbar-collapse{padding-right:15px;padding-left:15px;overflow-x:visible;border-top:1px solid transparent;box-shadow:inset 0 1px 0 hsla(0,0%,100%,.1);-webkit-overflow-scrolling:touch}.navbar-collapse:after,.navbar-collapse:before{display:table;content:" "}.navbar-collapse:after{clear:both}.navbar-collapse.in{overflow-y:auto}@media (min-width:768px){.navbar-collapse{width:auto;border-top:0;box-shadow:none}.navbar-collapse.collapse{display:block!important;height:auto!important;padding-bottom:0;overflow:visible!important}.navbar-collapse.in{overflow-y:visible}.navbar-fixed-bottom .navbar-collapse,.navbar-fixed-top .navbar-collapse,.navbar-static-top .navbar-collapse{padding-right:0;padding-left:0}}.navbar-fixed-bottom,.navbar-fixed-top{position:fixed;right:0;left:0;z-index:1030}.navbar-fixed-bottom .navbar-collapse,.navbar-fixed-top .navbar-collapse{max-height:340px}@media (max-device-width:480px) and (orientation:landscape){.navbar-fixed-bottom .navbar-collapse,.navbar-fixed-top .navbar-collapse{max-height:200px}}@media (min-width:768px){.navbar-fixed-bottom,.navbar-fixed-top{border-radius:0}}.navbar-fixed-top{top:0;border-width:0 0 1px}.navbar-fixed-bottom{bottom:0;margin-bottom:0;border-width:1px 0 0}.container-fluid>.navbar-collapse,.container-fluid>.navbar-header,.container>.navbar-collapse,.container>.navbar-header{margin-right:-15px;margin-left:-15px}@media (min-width:768px){.container-fluid>.navbar-collapse,.container-fluid>.navbar-header,.container>.navbar-collapse,.container>.navbar-header{margin-right:0;margin-left:0}}.navbar-static-top{z-index:1000;border-width:0 0 1px}@media (min-width:768px){.navbar-static-top{border-radius:0}}.navbar-brand{float:left;height:50px;padding:15px;font-size:18px;line-height:20px}.navbar-brand:focus,.navbar-brand:hover{text-decoration:none}.navbar-brand>img{display:block}@media (min-width:768px){.navbar>.container-fluid .navbar-brand,.navbar>.container .navbar-brand{margin-left:-15px}}.navbar-toggle{position:relative;float:right;padding:9px 10px;margin-right:15px;margin-top:8px;margin-bottom:8px;background-color:transparent;background-image:none;border:1px solid transparent;border-radius:4px}.navbar-toggle:focus{outline:0}.navbar-toggle .icon-bar{display:block;width:22px;height:2px;border-radius:1px}.navbar-toggle .icon-bar+.icon-bar{margin-top:4px}@media (min-width:768px){.navbar-toggle{display:none}}.navbar-nav{margin:7.5px -15px}.navbar-nav>li>a{padding-top:10px;padding-bottom:10px;line-height:20px}@media (max-width:767px){.navbar-nav .open .dropdown-menu{position:static;float:none;width:auto;margin-top:0;background-color:transparent;border:0;box-shadow:none}.navbar-nav .open .dropdown-menu .dropdown-header,.navbar-nav .open .dropdown-menu>li>a{padding:5px 15px 5px 25px}.navbar-nav .open .dropdown-menu>li>a{line-height:20px}.navbar-nav .open .dropdown-menu>li>a:focus,.navbar-nav .open .dropdown-menu>li>a:hover{background-image:none}}@media (min-width:768px){.navbar-nav{float:left;margin:0}.navbar-nav>li{float:left}.navbar-nav>li>a{padding-top:15px;padding-bottom:15px}}.navbar-form{padding:10px 15px;margin:8px -15px;border-top:1px solid transparent;border-bottom:1px solid transparent;-webkit-box-shadow:inset 0 1px 0 hsla(0,0%,100%,.1),0 1px 0 hsla(0,0%,100%,.1);box-shadow:inset 0 1px 0 hsla(0,0%,100%,.1),0 1px 0 hsla(0,0%,100%,.1)}@media (min-width:768px){.navbar-form .form-group{display:inline-block;margin-bottom:0;vertical-align:middle}.navbar-form .form-control{display:inline-block;width:auto;vertical-align:middle}.navbar-form .form-control-static{display:inline-block}.navbar-form .input-group{display:inline-table;vertical-align:middle}.navbar-form .input-group .form-control,.navbar-form .input-group .input-group-addon,.navbar-form .input-group .input-group-btn{width:auto}.navbar-form .input-group>.form-control{width:100%}.navbar-form .control-label{margin-bottom:0;vertical-align:middle}.navbar-form .checkbox,.navbar-form .radio{display:inline-block;margin-top:0;margin-bottom:0;vertical-align:middle}.navbar-form .checkbox label,.navbar-form .radio label{padding-left:0}.navbar-form .checkbox input[type=checkbox],.navbar-form .radio input[type=radio]{position:relative;margin-left:0}.navbar-form .has-feedback .form-control-feedback{top:0}}@media (max-width:767px){.navbar-form .form-group{margin-bottom:5px}.navbar-form .form-group:last-child{margin-bottom:0}}@media (min-width:768px){.navbar-form{width:auto;padding-top:0;padding-bottom:0;margin-right:0;margin-left:0;border:0;-webkit-box-shadow:none;box-shadow:none}}.navbar-nav>li>.dropdown-menu{margin-top:0;border-top-left-radius:0;border-top-right-radius:0}.navbar-fixed-bottom .navbar-nav>li>.dropdown-menu{margin-bottom:0;border-top-left-radius:4px;border-top-right-radius:4px;border-bottom-right-radius:0;border-bottom-left-radius:0}.navbar-btn{margin-top:8px;margin-bottom:8px}.navbar-btn.btn-sm{margin-top:10px;margin-bottom:10px}.navbar-btn.btn-xs{margin-top:14px;margin-bottom:14px}.navbar-text{margin-top:15px;margin-bottom:15px}@media (min-width:768px){.navbar-text{float:left;margin-right:15px;margin-left:15px}}@media (min-width:768px){.navbar-left{float:left!important}.navbar-right{float:right!important;margin-right:-15px}.navbar-right~.navbar-right{margin-right:0}}.navbar-default{background-color:#f8f8f8;border-color:#e7e7e7}.navbar-default .navbar-brand{color:#777}.navbar-default .navbar-brand:focus,.navbar-default .navbar-brand:hover{color:#5e5e5e;background-color:transparent}.navbar-default .navbar-nav>li>a,.navbar-default .navbar-text{color:#777}.navbar-default .navbar-nav>li>a:focus,.navbar-default .navbar-nav>li>a:hover{color:#333;background-color:transparent}.navbar-default .navbar-nav>.active>a,.navbar-default .navbar-nav>.active>a:focus,.navbar-default .navbar-nav>.active>a:hover{color:#555;background-color:#e7e7e7}.navbar-default .navbar-nav>.disabled>a,.navbar-default .navbar-nav>.disabled>a:focus,.navbar-default .navbar-nav>.disabled>a:hover{color:#ccc;background-color:transparent}.navbar-default .navbar-nav>.open>a,.navbar-default .navbar-nav>.open>a:focus,.navbar-default .navbar-nav>.open>a:hover{color:#555;background-color:#e7e7e7}@media (max-width:767px){.navbar-default .navbar-nav .open .dropdown-menu>li>a{color:#777}.navbar-default .navbar-nav .open .dropdown-menu>li>a:focus,.navbar-default .navbar-nav .open .dropdown-menu>li>a:hover{color:#333;background-color:transparent}.navbar-default .navbar-nav .open .dropdown-menu>.active>a,.navbar-default .navbar-nav .open .dropdown-menu>.active>a:focus,.navbar-default .navbar-nav .open .dropdown-menu>.active>a:hover{color:#555;background-color:#e7e7e7}.navbar-default .navbar-nav .open .dropdown-menu>.disabled>a,.navbar-default .navbar-nav .open .dropdown-menu>.disabled>a:focus,.navbar-default .navbar-nav .open .dropdown-menu>.disabled>a:hover{color:#ccc;background-color:transparent}}.navbar-default .navbar-toggle{border-color:#ddd}.navbar-default .navbar-toggle:focus,.navbar-default .navbar-toggle:hover{background-color:#ddd}.navbar-default .navbar-toggle .icon-bar{background-color:#888}.navbar-default .navbar-collapse,.navbar-default .navbar-form{border-color:#e7e7e7}.navbar-default .navbar-link{color:#777}.navbar-default .navbar-link:hover{color:#333}.navbar-default .btn-link{color:#777}.navbar-default .btn-link:focus,.navbar-default .btn-link:hover{color:#333}.navbar-default .btn-link[disabled]:focus,.navbar-default .btn-link[disabled]:hover,fieldset[disabled] .navbar-default .btn-link:focus,fieldset[disabled] .navbar-default .btn-link:hover{color:#ccc}.navbar-inverse{background-color:#222;border-color:#090909}.navbar-inverse .navbar-brand{color:#9d9d9d}.navbar-inverse .navbar-brand:focus,.navbar-inverse .navbar-brand:hover{color:#fff;background-color:transparent}.navbar-inverse .navbar-nav>li>a,.navbar-inverse .navbar-text{color:#9d9d9d}.navbar-inverse .navbar-nav>li>a:focus,.navbar-inverse .navbar-nav>li>a:hover{color:#fff;background-color:transparent}.navbar-inverse .navbar-nav>.active>a,.navbar-inverse .navbar-nav>.active>a:focus,.navbar-inverse .navbar-nav>.active>a:hover{color:#fff;background-color:#090909}.navbar-inverse .navbar-nav>.disabled>a,.navbar-inverse .navbar-nav>.disabled>a:focus,.navbar-inverse .navbar-nav>.disabled>a:hover{color:#444;background-color:transparent}.navbar-inverse .navbar-nav>.open>a,.navbar-inverse .navbar-nav>.open>a:focus,.navbar-inverse .navbar-nav>.open>a:hover{color:#fff;background-color:#090909}@media (max-width:767px){.navbar-inverse .navbar-nav .open .dropdown-menu>.dropdown-header{border-color:#090909}.navbar-inverse .navbar-nav .open .dropdown-menu .divider{background-color:#090909}.navbar-inverse .navbar-nav .open .dropdown-menu>li>a{color:#9d9d9d}.navbar-inverse .navbar-nav .open .dropdown-menu>li>a:focus,.navbar-inverse .navbar-nav .open .dropdown-menu>li>a:hover{color:#fff;background-color:transparent}.navbar-inverse .navbar-nav .open .dropdown-menu>.active>a,.navbar-inverse .navbar-nav .open .dropdown-menu>.active>a:focus,.navbar-inverse .navbar-nav .open .dropdown-menu>.active>a:hover{color:#fff;background-color:#090909}.navbar-inverse .navbar-nav .open .dropdown-menu>.disabled>a,.navbar-inverse .navbar-nav .open .dropdown-menu>.disabled>a:focus,.navbar-inverse .navbar-nav .open .dropdown-menu>.disabled>a:hover{color:#444;background-color:transparent}}.navbar-inverse .navbar-toggle{border-color:#333}.navbar-inverse .navbar-toggle:focus,.navbar-inverse .navbar-toggle:hover{background-color:#333}.navbar-inverse .navbar-toggle .icon-bar{background-color:#fff}.navbar-inverse .navbar-collapse,.navbar-inverse .navbar-form{border-color:#101010}.navbar-inverse .navbar-link{color:#9d9d9d}.navbar-inverse .navbar-link:hover{color:#fff}.navbar-inverse .btn-link{color:#9d9d9d}.navbar-inverse .btn-link:focus,.navbar-inverse .btn-link:hover{color:#fff}.navbar-inverse .btn-link[disabled]:focus,.navbar-inverse .btn-link[disabled]:hover,fieldset[disabled] .navbar-inverse .btn-link:focus,fieldset[disabled] .navbar-inverse .btn-link:hover{color:#444}.nav{padding-left:0;margin-bottom:0;list-style:none}.nav:after,.nav:before{display:table;content:" "}.nav:after{clear:both}.nav>li,.nav>li>a{position:relative;display:block}.nav>li>a{padding:10px 15px}.nav>li>a:focus,.nav>li>a:hover{text-decoration:none;background-color:#eee}.nav>li.disabled>a{color:#777}.nav>li.disabled>a:focus,.nav>li.disabled>a:hover{color:#777;text-decoration:none;cursor:not-allowed;background-color:transparent}.nav .open>a,.nav .open>a:focus,.nav .open>a:hover{background-color:#eee;border-color:#337ab7}.nav .nav-divider{height:1px;margin:9px 0;overflow:hidden;background-color:#e5e5e5}.nav>li>a>img{max-width:none}.nav-tabs{border-bottom:1px solid #ddd}.nav-tabs>li{float:left;margin-bottom:-1px}.nav-tabs>li>a{margin-right:2px;line-height:1.42857;border:1px solid transparent;border-radius:4px 4px 0 0}.nav-tabs>li>a:hover{border-color:#eee #eee #ddd}.nav-tabs>li.active>a,.nav-tabs>li.active>a:focus,.nav-tabs>li.active>a:hover{color:#555;cursor:default;background-color:#fff;border:1px solid #ddd;border-bottom-color:transparent}.nav-pills>li{float:left}.nav-pills>li>a{border-radius:4px}.nav-pills>li+li{margin-left:2px}.nav-pills>li.active>a,.nav-pills>li.active>a:focus,.nav-pills>li.active>a:hover{color:#fff;background-color:#337ab7}.nav-stacked>li{float:none}.nav-stacked>li+li{margin-top:2px;margin-left:0}.nav-justified,.nav-tabs.nav-justified{width:100%}.nav-justified>li,.nav-tabs.nav-justified>li{float:none}.nav-justified>li>a,.nav-tabs.nav-justified>li>a{margin-bottom:5px;text-align:center}.nav-justified>.dropdown .dropdown-menu{top:auto;left:auto}@media (min-width:768px){.nav-justified>li,.nav-tabs.nav-justified>li{display:table-cell;width:1%}.nav-justified>li>a,.nav-tabs.nav-justified>li>a{margin-bottom:0}}.nav-tabs-justified,.nav-tabs.nav-justified{border-bottom:0}.nav-tabs-justified>li>a,.nav-tabs.nav-justified>li>a{margin-right:0;border-radius:4px}.nav-tabs-justified>.active>a,.nav-tabs-justified>.active>a:focus,.nav-tabs-justified>.active>a:hover,.nav-tabs.nav-justified>.active>a,.nav-tabs.nav-justified>.active>a:focus,.nav-tabs.nav-justified>.active>a:hover{border:1px solid #ddd}@media (min-width:768px){.nav-tabs-justified>li>a,.nav-tabs.nav-justified>li>a{border-bottom:1px solid #ddd;border-radius:4px 4px 0 0}.nav-tabs-justified>.active>a,.nav-tabs-justified>.active>a:focus,.nav-tabs-justified>.active>a:hover,.nav-tabs.nav-justified>.active>a,.nav-tabs.nav-justified>.active>a:focus,.nav-tabs.nav-justified>.active>a:hover{border-bottom-color:#fff}}.tab-content>.tab-pane{display:none}.tab-content>.active{display:block}.nav-tabs .dropdown-menu{margin-top:-1px;border-top-left-radius:0;border-top-right-radius:0}.fade{opacity:0;-webkit-transition:opacity .15s linear;-o-transition:opacity .15s linear;transition:opacity .15s linear}.fade.in{opacity:1}.collapse{display:none}.collapse.in{display:block}tr.collapse.in{display:table-row}tbody.collapse.in{display:table-row-group}.collapsing{position:relative;height:0;overflow:hidden;-webkit-transition-property:height,visibility;transition-property:height,visibility;-webkit-transition-duration:.35s;transition-duration:.35s;-webkit-transition-timing-function:ease;transition-timing-function:ease}.container{padding-right:15px;padding-left:15px;margin-right:auto;margin-left:auto}.container:after,.container:before{display:table;content:" "}.container:after{clear:both}@media (min-width:768px){.container{width:750px}}@media (min-width:992px){.container{width:970px}}@media (min-width:1200px){.container{width:1170px}}.container-fluid{padding-right:15px;padding-left:15px;margin-right:auto;margin-left:auto}.container-fluid:after,.container-fluid:before{display:table;content:" "}.container-fluid:after{clear:both}.row{margin-right:-15px;margin-left:-15px}.row:after,.row:before{display:table;content:" "}.row:after{clear:both}.col-lg-1,.col-md-1,.col-sm-1,.col-xs-1,.large-2,.large-3,.large-4,.large-5,.large-6,.large-7,.large-8,.large-9,.large-10,.large-11,.large-12,.medium-2,.medium-3,.medium-4,.medium-5,.medium-6,.medium-7,.medium-8,.medium-9,.medium-10,.medium-11,.medium-12,.small-2,.small-3,.small-4,.small-5,.small-6,.small-7,.small-8,.small-9,.small-10,.small-11,.small-12,.xsmall-2,.xsmall-3,.xsmall-4,.xsmall-5,.xsmall-6,.xsmall-7,.xsmall-8,.xsmall-9,.xsmall-10,.xsmall-11,.xsmall-12{position:relative;min-height:1px;padding-left:15px;padding-right:15px}.col-xsmall-1,.xsmall-2,.xsmall-3,.xsmall-4,.xsmall-5,.xsmall-6,.xsmall-7,.xsmall-8,.xsmall-9,.xsmall-10,.xsmall-11,.xsmall-12{float:left}.xsmall-1{width:8.33333%}.xsmall-2{width:16.66667%}.xsmall-3{width:25%}.xsmall-4{width:33.33333%}.xsmall-5{width:41.66667%}.xsmall-6{width:50%}.xsmall-7{width:58.33333%}.xsmall-8{width:66.66667%}.xsmall-9{width:75%}.xsmall-10{width:83.33333%}.xsmall-11{width:91.66667%}.xsmall-12{width:100%}.xsmall-pull-0{right:auto}.xsmall-pull-1{right:8.33333%}.xsmall-pull-2{right:16.66667%}.xsmall-pull-3{right:25%}.xsmall-pull-4{right:33.33333%}.xsmall-pull-5{right:41.66667%}.xsmall-pull-6{right:50%}.xsmall-pull-7{right:58.33333%}.xsmall-pull-8{right:66.66667%}.xsmall-pull-9{right:75%}.xsmall-pull-10{right:83.33333%}.xsmall-pull-11{right:91.66667%}.xsmall-pull-12{right:100%}.xsmall-push-0{left:auto}.xsmall-push-1{left:8.33333%}.xsmall-push-2{left:16.66667%}.xsmall-push-3{left:25%}.xsmall-push-4{left:33.33333%}.xsmall-push-5{left:41.66667%}.xsmall-push-6{left:50%}.xsmall-push-7{left:58.33333%}.xsmall-push-8{left:66.66667%}.xsmall-push-9{left:75%}.xsmall-push-10{left:83.33333%}.xsmall-push-11{left:91.66667%}.xsmall-push-12{left:100%}.xsmall-offset-0{margin-left:0}.xsmall-offset-1{margin-left:8.33333%}.xsmall-offset-2{margin-left:16.66667%}.xsmall-offset-3{margin-left:25%}.xsmall-offset-4{margin-left:33.33333%}.xsmall-offset-5{margin-left:41.66667%}.xsmall-offset-6{margin-left:50%}.xsmall-offset-7{margin-left:58.33333%}.xsmall-offset-8{margin-left:66.66667%}.xsmall-offset-9{margin-left:75%}.xsmall-offset-10{margin-left:83.33333%}.xsmall-offset-11{margin-left:91.66667%}.xsmall-offset-12{margin-left:100%}@media (min-width:768px){.col-small-1,.small-2,.small-3,.small-4,.small-5,.small-6,.small-7,.small-8,.small-9,.small-10,.small-11,.small-12{float:left}.small-1{width:8.33333%}.small-2{width:16.66667%}.small-3{width:25%}.small-4{width:33.33333%}.small-5{width:41.66667%}.small-6{width:50%}.small-7{width:58.33333%}.small-8{width:66.66667%}.small-9{width:75%}.small-10{width:83.33333%}.small-11{width:91.66667%}.small-12{width:100%}.small-pull-0{right:auto}.small-pull-1{right:8.33333%}.small-pull-2{right:16.66667%}.small-pull-3{right:25%}.small-pull-4{right:33.33333%}.small-pull-5{right:41.66667%}.small-pull-6{right:50%}.small-pull-7{right:58.33333%}.small-pull-8{right:66.66667%}.small-pull-9{right:75%}.small-pull-10{right:83.33333%}.small-pull-11{right:91.66667%}.small-pull-12{right:100%}.small-push-0{left:auto}.small-push-1{left:8.33333%}.small-push-2{left:16.66667%}.small-push-3{left:25%}.small-push-4{left:33.33333%}.small-push-5{left:41.66667%}.small-push-6{left:50%}.small-push-7{left:58.33333%}.small-push-8{left:66.66667%}.small-push-9{left:75%}.small-push-10{left:83.33333%}.small-push-11{left:91.66667%}.small-push-12{left:100%}.small-offset-0{margin-left:0}.small-offset-1{margin-left:8.33333%}.small-offset-2{margin-left:16.66667%}.small-offset-3{margin-left:25%}.small-offset-4{margin-left:33.33333%}.small-offset-5{margin-left:41.66667%}.small-offset-6{margin-left:50%}.small-offset-7{margin-left:58.33333%}.small-offset-8{margin-left:66.66667%}.small-offset-9{margin-left:75%}.small-offset-10{margin-left:83.33333%}.small-offset-11{margin-left:91.66667%}.small-offset-12{margin-left:100%}}@media (min-width:992px){.col-medium-1,.medium-2,.medium-3,.medium-4,.medium-5,.medium-6,.medium-7,.medium-8,.medium-9,.medium-10,.medium-11,.medium-12{float:left}.medium-1{width:8.33333%}.medium-2{width:16.66667%}.medium-3{width:25%}.medium-4{width:33.33333%}.medium-5{width:41.66667%}.medium-6{width:50%}.medium-7{width:58.33333%}.medium-8{width:66.66667%}.medium-9{width:75%}.medium-10{width:83.33333%}.medium-11{width:91.66667%}.medium-12{width:100%}.medium-pull-0{right:auto}.medium-pull-1{right:8.33333%}.medium-pull-2{right:16.66667%}.medium-pull-3{right:25%}.medium-pull-4{right:33.33333%}.medium-pull-5{right:41.66667%}.medium-pull-6{right:50%}.medium-pull-7{right:58.33333%}.medium-pull-8{right:66.66667%}.medium-pull-9{right:75%}.medium-pull-10{right:83.33333%}.medium-pull-11{right:91.66667%}.medium-pull-12{right:100%}.medium-push-0{left:auto}.medium-push-1{left:8.33333%}.medium-push-2{left:16.66667%}.medium-push-3{left:25%}.medium-push-4{left:33.33333%}.medium-push-5{left:41.66667%}.medium-push-6{left:50%}.medium-push-7{left:58.33333%}.medium-push-8{left:66.66667%}.medium-push-9{left:75%}.medium-push-10{left:83.33333%}.medium-push-11{left:91.66667%}.medium-push-12{left:100%}.medium-offset-0{margin-left:0}.medium-offset-1{margin-left:8.33333%}.medium-offset-2{margin-left:16.66667%}.medium-offset-3{margin-left:25%}.medium-offset-4{margin-left:33.33333%}.medium-offset-5{margin-left:41.66667%}.medium-offset-6{margin-left:50%}.medium-offset-7{margin-left:58.33333%}.medium-offset-8{margin-left:66.66667%}.medium-offset-9{margin-left:75%}.medium-offset-10{margin-left:83.33333%}.medium-offset-11{margin-left:91.66667%}.medium-offset-12{margin-left:100%}}@media (min-width:1200px){.col-large-1,.large-2,.large-3,.large-4,.large-5,.large-6,.large-7,.large-8,.large-9,.large-10,.large-11,.large-12{float:left}.large-1{width:8.33333%}.large-2{width:16.66667%}.large-3{width:25%}.large-4{width:33.33333%}.large-5{width:41.66667%}.large-6{width:50%}.large-7{width:58.33333%}.large-8{width:66.66667%}.large-9{width:75%}.large-10{width:83.33333%}.large-11{width:91.66667%}.large-12{width:100%}.large-pull-0{right:auto}.large-pull-1{right:8.33333%}.large-pull-2{right:16.66667%}.large-pull-3{right:25%}.large-pull-4{right:33.33333%}.large-pull-5{right:41.66667%}.large-pull-6{right:50%}.large-pull-7{right:58.33333%}.large-pull-8{right:66.66667%}.large-pull-9{right:75%}.large-pull-10{right:83.33333%}.large-pull-11{right:91.66667%}.large-pull-12{right:100%}.large-push-0{left:auto}.large-push-1{left:8.33333%}.large-push-2{left:16.66667%}.large-push-3{left:25%}.large-push-4{left:33.33333%}.large-push-5{left:41.66667%}.large-push-6{left:50%}.large-push-7{left:58.33333%}.large-push-8{left:66.66667%}.large-push-9{left:75%}.large-push-10{left:83.33333%}.large-push-11{left:91.66667%}.large-push-12{left:100%}.large-offset-0{margin-left:0}.large-offset-1{margin-left:8.33333%}.large-offset-2{margin-left:16.66667%}.large-offset-3{margin-left:25%}.large-offset-4{margin-left:33.33333%}.large-offset-5{margin-left:41.66667%}.large-offset-6{margin-left:50%}.large-offset-7{margin-left:58.33333%}.large-offset-8{margin-left:66.66667%}.large-offset-9{margin-left:75%}.large-offset-10{margin-left:83.33333%}.large-offset-11{margin-left:91.66667%}.large-offset-12{margin-left:100%}}.clearfix:after,.clearfix:before{content:" "}.center-block{display:block;margin-right:auto;margin-left:auto}.pull-right{float:right!important}.pull-left{float:left!important}.hide{display:none!important}.show{display:block!important}.invisible{visibility:hidden}.text-hide{font:0/0 a;color:transparent;text-shadow:none;background-color:transparent;border:0}.hidden{display:none!important}.affix{position:fixed}@-ms-viewport{width:device-width}.visible-lg,.visible-lg-block,.visible-lg-inline,.visible-lg-inline-block,.visible-md,.visible-md-block,.visible-md-inline,.visible-md-inline-block,.visible-sm,.visible-sm-block,.visible-sm-inline,.visible-sm-inline-block,.visible-xs,.visible-xs-block,.visible-xs-inline,.visible-xs-inline-block{display:none!important}@media (max-width:767px){.visible-xs{display:block!important}table.visible-xs{display:table!important}tr.visible-xs{display:table-row!important}td.visible-xs,th.visible-xs{display:table-cell!important}}@media (max-width:767px){.visible-xs-block{display:block!important}}@media (max-width:767px){.visible-xs-inline{display:inline!important}}@media (max-width:767px){.visible-xs-inline-block{display:inline-block!important}}@media (min-width:768px) and (max-width:991px){.visible-sm{display:block!important}table.visible-sm{display:table!important}tr.visible-sm{display:table-row!important}td.visible-sm,th.visible-sm{display:table-cell!important}}@media (min-width:768px) and (max-width:991px){.visible-sm-block{display:block!important}}@media (min-width:768px) and (max-width:991px){.visible-sm-inline{display:inline!important}}@media (min-width:768px) and (max-width:991px){.visible-sm-inline-block{display:inline-block!important}}@media (min-width:992px) and (max-width:1199px){.visible-md{display:block!important}table.visible-md{display:table!important}tr.visible-md{display:table-row!important}td.visible-md,th.visible-md{display:table-cell!important}}@media (min-width:992px) and (max-width:1199px){.visible-md-block{display:block!important}}@media (min-width:992px) and (max-width:1199px){.visible-md-inline{display:inline!important}}@media (min-width:992px) and (max-width:1199px){.visible-md-inline-block{display:inline-block!important}}@media (min-width:1200px){.visible-lg{display:block!important}table.visible-lg{display:table!important}tr.visible-lg{display:table-row!important}td.visible-lg,th.visible-lg{display:table-cell!important}}@media (min-width:1200px){.visible-lg-block{display:block!important}}@media (min-width:1200px){.visible-lg-inline{display:inline!important}}@media (min-width:1200px){.visible-lg-inline-block{display:inline-block!important}}@media (max-width:767px){.hidden-xs{display:none!important}}@media (min-width:768px) and (max-width:991px){.hidden-sm{display:none!important}}@media (min-width:992px) and (max-width:1199px){.hidden-md{display:none!important}}@media (min-width:1200px){.hidden-lg{display:none!important}}.visible-print{display:none!important}@media print{.visible-print{display:block!important}table.visible-print{display:table!important}tr.visible-print{display:table-row!important}td.visible-print,th.visible-print{display:table-cell!important}}.visible-print-block{display:none!important}@media print{.visible-print-block{display:block!important}}.visible-print-inline{display:none!important}@media print{.visible-print-inline{display:inline!important}}.visible-print-inline-block{display:none!important}@media print{.visible-print-inline-block{display:inline-block!important}}@media print{.hidden-print{display:none!important}}.grds-color{flex-basis:300px!important;max-width:300px!important}.grds-wrapper{color:#000;margin-bottom:24px}@media (max-width:700px){.grds-wrapper{flex-basis:100%!important;max-width:100%!important;margin:0 0 24px}}.grds-audio{margin-right:10px}.grds-audio__container{background:#f4f6f8;padding:20px;border-radius:10px;width:100%}.grds-audio__title{margin-bottom:1rem;display:flex;align-items:center}.grds-audio__title svg{height:25px;width:25px;fill:#48ba6f;margin-right:1.5rem}.grds-audio__audiofile{width:100%}.grds-color{display:inline-block!important;margin-right:10px}@media (max-width:700px){.grds-color{display:block!important}}.grds-color__container{border-radius:10px;width:300px;display:flex;flex-direction:column}@media (max-width:700px){.grds-color__container{width:100%}}.grds-color__swatch{height:150px;border-radius:10px 10px 0 0;position:relative;display:flex;align-items:flex-end;padding-bottom:10px;justify-content:center}.grds-color__swatch__a11y{display:flex;flex-direction:column;width:50px;margin:0 3px}.grds-color__swatch__a11y__char{color:#fff;text-align:center}.grds-color__swatch__a11y__status{color:#fff;background:#000;padding:2px 5px;display:inline-block;border-radius:5px;font-size:.9rem;text-align:center}.grds-color__info{display:flex;flex-wrap:wrap;padding:10px;background:#f4f6f8;border-radius:0 0 10px 10px}.grds-color__info__item{margin-bottom:1rem;margin-top:.5rem;flex-basis:50%}.grds-color__info__item .clippy{display:inline-block}.grds-color__info__item p:first-child{text-transform:uppercase;color:#7d858c;font-size:.75rem}.grds-color__info__item p{margin-bottom:.25rem;margin-top:.5rem}.grds-color-palette__container{background:#f4f6f8;border-radius:10px;width:100%}.grds-color-palette__item{padding:20px;border-bottom:2px solid #c5d3e0;display:flex;justify-content:space-between;flex-wrap:wrap}.grds-color-palette__item:last-child{border-bottom:none}.grds-color-palette__left,.grds-color-palette__right{display:flex;align-items:center;flex-wrap:wrap}.grds-color-palette__item__swatch{width:50px;height:50px;border-radius:10px;margin-right:20px;margin-top:10px;margin-bottom:10px}.grds-color-palette__item__name{padding:.5rem 1rem .5rem 0}.grds-color-palette__item__color:first-child{width:115px}.grds-color-palette__item__color{margin:.4rem 0;width:140px}.grds-color-palette__item__color span:first-child{background:#c5d3e0;color:#2e2e2e;padding:3px 5px;font-size:.7rem;border-radius:5px}.grds-color-palette__item__color span:last-child{margin-left:.25rem;font-size:.9rem}.grds-download{margin-right:10px}.grds-download__container{background:#f4f6f8;padding:20px;border-radius:10px;width:100%;text-decoration:none}.grds-download__info{justify-content:space-between}.grds-download__info,.grds-download__info__left{display:flex;align-items:center}.grds-download__info__left svg{height:25px;width:25px;fill:#48ba6f;margin-right:1.5rem}.grds-download__info__right{font-size:.75rem;color:#7d858c}.grds-download__preview{padding:20px;border-radius:10px;margin-top:40px;display:flex;justify-content:center;box-shadow:0 5px 15px rgba(0,0,0,.1)}.grds-download__image{object-fit:cover;height:100%;margin-bottom:0}.grds-example{border-radius:10px;border:1px solid #c5d3e0}.grds-example__container,.grds-hint{padding:20px}.grds-hint{border-radius:10px;background:#f4f6f8;color:#7a7d80;border:1px solid #d9eafa;width:100%}.grds-hint__directive{background:#ecfaea;color:#307c3f;border:1px solid #c0ebc8}.grds-hint__warning{background:#fef5f5;color:#c93a3c;border:1px solid #fcddde}.grds-typo__container{width:100%}.grds-typo__item{display:flex;flex-direction:column;border-bottom:2px solid #c5d3e0;padding-bottom:1rem;margin-bottom:2rem}.grds-typo__item__name{margin-bottom:1.5rem}.grds-typo__item__info{display:flex;flex-direction:row;flex-wrap:wrap;justify-content:flex-start;width:100%}.grds-typo__item__info p:first-child{text-transform:uppercase;font-size:.75rem;color:#7d858c;margin-bottom:0}.grds-typo__item__info p:last-child{margin-top:.5rem}.grds-typo__item__info__desc{margin-right:2rem}.grds-video{margin-right:10px}.grds-video__container{background:#f4f6f8;padding:20px;border-radius:10px;width:100%}.grds-video__title{margin-bottom:15px;display:flex;align-items:center}.grds-video__title svg{height:25px;width:25px;fill:#48ba6f;margin-right:1.5rem}.grds-video__videofile{width:100%}.clippy:hover{cursor:pointer}.tooltipped{position:relative}.tooltipped:after{z-index:1000000;padding:.1rem .3rem;font:normal normal 11px/1.5 sans-serif;-webkit-font-smoothing:subpixel-antialiased;color:#fff;text-align:center;text-shadow:none;text-transform:none;letter-spacing:normal;word-wrap:break-word;white-space:pre;content:attr(aria-label);background:#000;border-radius:3px}.tooltipped:after,.tooltipped:before{position:absolute;display:inline-block;text-decoration:none;pointer-events:none}.tooltipped:before{z-index:1000001;width:0;height:0;color:#000;content:"";border:6px solid transparent}.tooltipped-n:after{right:50%;bottom:100%;margin-bottom:6px}.tooltipped-n:before{top:-7px;right:50%;bottom:auto;margin-right:-6px;border-top-color:#000}.tooltipped-n:after{transform:translateX(50%)}@font-face{font-family:entypo;src:url(/static/entypo.2b67ec35.eot);src:url(/static/entypo.2b67ec35.eot#iefix) format("embedded-opentype"),url(/static/entypo.fdba4ace.woff) format("woff"),url(/static/entypo.6b5b2d30.ttf) format("truetype"),url(/static/entypo.c9f44e5a.svg#entypo) format("svg");font-weight:400;font-style:normal}[class*=" icon-"]:before,[class^=icon-]:before{font-family:entypo;font-style:normal;font-weight:400;speak:none;display:inline-block;text-decoration:inherit;width:1em;height:1em;margin-right:.2em;text-align:center;font-variant:normal;text-transform:none;line-height:1;margin-left:.2em;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}.icon-address:before{content:"\E800"}.icon-add-to-list:before{content:"\E801"}.icon-arrow-down:before{content:"\E802"}.icon-arrow-left:before{content:"\E803"}.icon-add-user:before{content:"\E804"}.icon-arrow-long-down:before{content:"\E805"}.icon-arrow-long-left:before{content:"\E806"}.icon-arrow-long-right:before{content:"\E807"}.icon-arrow-long-up:before{content:"\E808"}.icon-adjust:before{content:"\E809"}.icon-air:before{content:"\E80A"}.icon-aircraft-landing:before{content:"\E80B"}.icon-aircraft:before{content:"\E80C"}.icon-align-left:before{content:"\E80D"}.icon-controller-fast-forward:before{content:"\E80E"}.icon-controller-fast-backward:before{content:"\E80F"}.icon-compass:before{content:"\E810"}.icon-colours:before{content:"\E811"}.icon-cog:before{content:"\E812"}.icon-code:before{content:"\E813"}.icon-cloud:before{content:"\E814"}.icon-clipboard:before{content:"\E815"}.icon-classic-computer:before{content:"\E816"}.icon-clapperboard:before{content:"\E817"}.icon-chevron-left:before{content:"\E818"}.icon-blackboard:before{content:"\E819"}.icon-block:before{content:"\E81A"}.icon-chevron-right:before{content:"\E81B"}.icon-chevron-small-down:before{content:"\E81C"}.icon-book:before{content:"\E81D"}.icon-bookmark:before{content:"\E81E"}.icon-chevron-small-left:before{content:"\E81F"}.icon-chevron-small-right:before{content:"\E820"}.icon-bookmarks:before{content:"\E821"}.icon-bowl:before{content:"\E822"}.icon-chevron-thin-down:before{content:"\E823"}.icon-box:before{content:"\E824"}.icon-arrow-right:before{content:"\E825"}.icon-aircraft-take-off:before{content:"\E826"}.icon-chevron-small-up:before{content:"\E827"}.icon-chevron-thin-left:before{content:"\E828"}.icon-chevron-thin-right:before{content:"\E829"}.icon-browser:before{content:"\E82A"}.icon-arrow-with-circle-down:before{content:"\E82B"}.icon-align-bottom:before{content:"\E82C"}.icon-arrow-up:before{content:"\E82D"}.icon-briefcase:before{content:"\E82E"}.icon-brush:before{content:"\E82F"}.icon-arrow-with-circle-left:before{content:"\E830"}.icon-align-horizontal-middle:before{content:"\E831"}.icon-chevron-thin-up:before{content:"\E832"}.icon-chevron-up:before{content:"\E833"}.icon-bucket:before{content:"\E834"}.icon-arrow-with-circle-right:before{content:"\E835"}.icon-arrow-with-circle-up:before{content:"\E836"}.icon-align-right:before{content:"\E837"}.icon-tripadvisor:before{content:"\E838"}.icon-qq-with-circle:before{content:"\E839"}.icon-google+-with-circle:before{content:"\E83A"}.icon-app-store:before{content:"\E83B"}.icon-trophy:before{content:"\E83C"}.icon-tablet-mobile-combo:before{content:"\E83D"}.icon-shopping-bag:before{content:"\E83E"}.icon-quote:before{content:"\E83F"}.icon-old-mobile:before{content:"\E840"}.icon-megaphone:before{content:"\E841"}.icon-light-bulb:before{content:"\E842"}.icon-hour-glass:before{content:"\E843"}.icon-flow-tree:before{content:"\E844"}.icon-email:before{content:"\E845"}.icon-cross:before{content:"\E846"}.icon-controller-jump-to-start:before{content:"\E847"}.icon-chevron-with-circle-down:before{content:"\E848"}.icon-controller-next:before{content:"\E849"}.icon-controller-paus:before{content:"\E84A"}.icon-controller-play:before{content:"\E84B"}.icon-controller-record:before{content:"\E84C"}.icon-controller-stop:before{content:"\E84D"}.icon-controller-volume:before{content:"\E84E"}.icon-copy:before{content:"\E84F"}.icon-creative-commons-attribution:before{content:"\E850"}.icon-align-top:before{content:"\E851"}.icon-align-vertical-middle:before{content:"\E852"}.icon-archive:before{content:"\E853"}.icon-area-graph:before{content:"\E854"}.icon-arrow-bold-down:before{content:"\E855"}.icon-arrow-bold-left:before{content:"\E856"}.icon-arrow-bold-right:before{content:"\E857"}.icon-arrow-bold-up:before{content:"\E858"}.icon-attachment:before{content:"\E859"}.icon-awareness-ribbon:before{content:"\E85A"}.icon-back-in-time:before{content:"\E85B"}.icon-back:before{content:"\E85C"}.icon-bar-graph:before{content:"\E85D"}.icon-battery:before{content:"\E85E"}.icon-beamed-note:before{content:"\E85F"}.icon-bell:before{content:"\E860"}.icon-cake:before{content:"\E861"}.icon-calculator:before{content:"\E862"}.icon-calendar:before{content:"\E863"}.icon-camera:before{content:"\E864"}.icon-ccw:before{content:"\E865"}.icon-chat:before{content:"\E866"}.icon-check:before{content:"\E867"}.icon-chevron-down:before{content:"\E868"}.icon-cup:before{content:"\E869"}.icon-cw:before{content:"\E86A"}.icon-cycle:before{content:"\E86B"}.icon-database:before{content:"\E86C"}.icon-dial-pad:before{content:"\E86D"}.icon-direction:before{content:"\E86E"}.icon-document-landscape:before{content:"\E86F"}.icon-document:before{content:"\E870"}.icon-emoji-flirt:before{content:"\E871"}.icon-emoji-happy:before{content:"\E872"}.icon-emoji-neutral:before{content:"\E873"}.icon-emoji-sad:before{content:"\E874"}.icon-erase:before{content:"\E875"}.icon-eraser:before{content:"\E876"}.icon-export:before{content:"\E877"}.icon-eye-with-line:before{content:"\E878"}.icon-flower:before{content:"\E879"}.icon-folder-images:before{content:"\E87A"}.icon-folder-music:before{content:"\E87B"}.icon-folder-video:before{content:"\E87C"}.icon-folder:before{content:"\E87D"}.icon-forward:before{content:"\E87E"}.icon-funnel:before{content:"\E87F"}.icon-game-controller:before{content:"\E880"}.icon-image-inverted:before{content:"\E881"}.icon-image:before{content:"\E882"}.icon-images:before{content:"\E883"}.icon-inbox:before{content:"\E884"}.icon-infinity:before{content:"\E885"}.icon-info-with-circle:before{content:"\E886"}.icon-info:before{content:"\E887"}.icon-install:before{content:"\E888"}.icon-light-down:before{content:"\E889"}.icon-light-up:before{content:"\E88A"}.icon-line-graph:before{content:"\E88B"}.icon-link:before{content:"\E88C"}.icon-list:before{content:"\E88D"}.icon-location-pin:before{content:"\E88E"}.icon-location:before{content:"\E88F"}.icon-lock-open:before{content:"\E890"}.icon-menu:before{content:"\E891"}.icon-merge:before{content:"\E892"}.icon-message:before{content:"\E893"}.icon-mic:before{content:"\E894"}.icon-minus:before{content:"\E895"}.icon-mobile:before{content:"\E896"}.icon-modern-mic:before{content:"\E897"}.icon-moon:before{content:"\E898"}.icon-old-phone:before{content:"\E899"}.icon-open-book:before{content:"\E89A"}.icon-palette:before{content:"\E89B"}.icon-paper-plane:before{content:"\E89C"}.icon-pencil:before{content:"\E89D"}.icon-phone:before{content:"\E89E"}.icon-pie-chart:before{content:"\E89F"}.icon-pin:before{content:"\E8A0"}.icon-radio:before{content:"\E8A1"}.icon-remove-user:before{content:"\E8A2"}.icon-reply-all:before{content:"\E8A3"}.icon-reply:before{content:"\E8A4"}.icon-resize-full-screen:before{content:"\E8A6"}.icon-retweet:before{content:"\E8A7"}.icon-rocket:before{content:"\E8A8"}.icon-shopping-basket:before{content:"\E8A9"}.icon-shopping-cart:before{content:"\E8AA"}.icon-shuffle:before{content:"\E8AB"}.icon-signal:before{content:"\E8AC"}.icon-sound-mix:before{content:"\E8AD"}.icon-sound-mute:before{content:"\E8AE"}.icon-sound:before{content:"\E8AF"}.icon-sports-club:before{content:"\E8B0"}.icon-tablet:before{content:"\E8B1"}.icon-tag:before{content:"\E8B2"}.icon-text-document-inverted:before{content:"\E8B3"}.icon-text-document:before{content:"\E8B4"}.icon-text:before{content:"\E8B5"}.icon-thermometer:before{content:"\E8B6"}.icon-thumbs-down:before{content:"\E8B7"}.icon-thumbs-up:before{content:"\E8B8"}.icon-tv:before{content:"\E8B9"}.icon-typing:before{content:"\E8BA"}.icon-uninstall:before{content:"\E8BB"}.icon-unread:before{content:"\E8BC"}.icon-untag:before{content:"\E8BD"}.icon-upload-to-cloud:before{content:"\E8BE"}.icon-upload:before{content:"\E8BF"}.icon-user:before{content:"\E8C0"}.icon-baidu:before{content:"\E8C1"}.icon-basecamp:before{content:"\E8C2"}.icon-behance:before{content:"\E8C3"}.icon-creative-cloud:before{content:"\E8C4"}.icon-dribbble-with-circle:before{content:"\E8C5"}.icon-dribbble:before{content:"\E8C6"}.icon-dropbox:before{content:"\E8C7"}.icon-evernote:before{content:"\E8C8"}.icon-google+:before{content:"\E8C9"}.icon-grooveshark:before{content:"\E8CA"}.icon-houzz:before{content:"\E8CB"}.icon-icloud:before{content:"\E8CC"}.icon-instagram-with-circle:before{content:"\E8CD"}.icon-instagram:before{content:"\E8CE"}.icon-lastfm-with-circle:before{content:"\E8CF"}.icon-lastfm:before{content:"\E8D0"}.icon-qq:before{content:"\E8D1"}.icon-raft-with-circle:before{content:"\E8D2"}.icon-raft:before{content:"\E8D3"}.icon-rainbow:before{content:"\E8D4"}.icon-rdio-with-circle:before{content:"\E8D5"}.icon-rdio:before{content:"\E8D6"}.icon-renren:before{content:"\E8D7"}.icon-scribd:before{content:"\E8D8"}.icon-tumblr-with-circle:before{content:"\E8D9"}.icon-tumblr:before{content:"\E8DA"}.icon-twitter-with-circle:before{content:"\E8DB"}.icon-twitter:before{content:"\E8DC"}.icon-vimeo-with-circle:before{content:"\E8DD"}.icon-vimeo:before{content:"\E8DE"}.icon-vine-with-circle:before{content:"\E8DF"}.icon-vine:before{content:"\E8E0"}.icon-creative-commons-noderivs:before{content:"\E8E1"}.icon-creative-commons-noncommercial-eu:before{content:"\E8E2"}.icon-creative-commons-noncommercial-us:before{content:"\E8E3"}.icon-creative-commons-public-domain:before{content:"\E8E4"}.icon-creative-commons-remix:before{content:"\E8E5"}.icon-creative-commons-share:before{content:"\E8E6"}.icon-creative-commons-sharealike:before{content:"\E8E7"}.icon-creative-commons:before{content:"\E8E8"}.icon-credit-card:before{content:"\E8E9"}.icon-credit:before{content:"\E8EA"}.icon-crop:before{content:"\E8EB"}.icon-documents:before{content:"\E8EC"}.icon-dot-single:before{content:"\E8ED"}.icon-dots-three-horizontal:before{content:"\E8EE"}.icon-dots-three-vertical:before{content:"\E8EF"}.icon-dots-two-horizontal:before{content:"\E8F0"}.icon-dots-two-vertical:before{content:"\E8F1"}.icon-download:before{content:"\E8F2"}.icon-drink:before{content:"\E8F3"}.icon-drive:before{content:"\E8F4"}.icon-drop:before{content:"\E8F5"}.icon-edit:before{content:"\E8F6"}.icon-eye:before{content:"\E8F7"}.icon-feather:before{content:"\E8F8"}.icon-fingerprint:before{content:"\E8F9"}.icon-flag:before{content:"\E8FA"}.icon-flash:before{content:"\E8FB"}.icon-flashlight:before{content:"\E8FC"}.icon-flat-brush:before{content:"\E8FD"}.icon-flow-branch:before{content:"\E8FE"}.icon-flow-cascade:before{content:"\E8FF"}.icon-flow-line:before{content:"\E900"}.icon-flow-parallel:before{content:"\E901"}.icon-gauge:before{content:"\E902"}.icon-globe:before{content:"\E903"}.icon-graduation-cap:before{content:"\E904"}.icon-grid:before{content:"\E905"}.icon-hair-cross:before{content:"\E906"}.icon-hand:before{content:"\E907"}.icon-heart-outlined:before{content:"\E908"}.icon-heart:before{content:"\E909"}.icon-help-with-circle:before{content:"\E90A"}.icon-help:before{content:"\E90B"}.icon-home:before{content:"\E90C"}.icon-key:before{content:"\E90D"}.icon-keyboard:before{content:"\E90E"}.icon-lab-flask:before{content:"\E90F"}.icon-landline:before{content:"\E910"}.icon-language:before{content:"\E911"}.icon-laptop:before{content:"\E912"}.icon-layers:before{content:"\E913"}.icon-leaf:before{content:"\E914"}.icon-level-down:before{content:"\E915"}.icon-level-up:before{content:"\E916"}.icon-lifebuoy:before{content:"\E917"}.icon-lock:before{content:"\E918"}.icon-log-out:before{content:"\E919"}.icon-login:before{content:"\E91A"}.icon-loop:before{content:"\E91B"}.icon-magnet:before{content:"\E91C"}.icon-magnifying-glass:before{content:"\E91D"}.icon-mail:before{content:"\E91E"}.icon-man:before{content:"\E91F"}.icon-map:before{content:"\E920"}.icon-mask:before{content:"\E921"}.icon-medal:before{content:"\E922"}.icon-mouse-pointer:before{content:"\E923"}.icon-mouse:before{content:"\E924"}.icon-music:before{content:"\E925"}.icon-network:before{content:"\E926"}.icon-new-message:before{content:"\E927"}.icon-new:before{content:"\E928"}.icon-news:before{content:"\E929"}.icon-newsletter:before{content:"\E92A"}.icon-note:before{content:"\E92B"}.icon-notification:before{content:"\E92C"}.icon-notifications-off:before{content:"\E92D"}.icon-plus:before{content:"\E92E"}.icon-popup:before{content:"\E92F"}.icon-power-plug:before{content:"\E930"}.icon-price-ribbon:before{content:"\E931"}.icon-price-tag:before{content:"\E932"}.icon-print:before{content:"\E933"}.icon-progress-empty:before{content:"\E934"}.icon-progress-full:before{content:"\E935"}.icon-progress-one:before{content:"\E936"}.icon-progress-two:before{content:"\E937"}.icon-publish:before{content:"\E938"}.icon-round-brush:before{content:"\E939"}.icon-rss:before{content:"\E93A"}.icon-ruler:before{content:"\E93B"}.icon-save:before{content:"\E93C"}.icon-scissors:before{content:"\E93D"}.icon-select-arrows:before{content:"\E93E"}.icon-share-alternative:before{content:"\E93F"}.icon-share:before{content:"\E940"}.icon-shareable:before{content:"\E941"}.icon-shield:before{content:"\E942"}.icon-shop:before{content:"\E943"}.icon-spreadsheet:before{content:"\E944"}.icon-squared-cross:before{content:"\E945"}.icon-squared-minus:before{content:"\E946"}.icon-squared-plus:before{content:"\E947"}.icon-star-outlined:before{content:"\E948"}.icon-star:before{content:"\E949"}.icon-stopwatch:before{content:"\E94A"}.icon-suitcase:before{content:"\E94B"}.icon-swap:before{content:"\E94C"}.icon-sweden:before{content:"\E94D"}.icon-switch:before{content:"\E94E"}.icon-thunder-cloud:before{content:"\E94F"}.icon-ticket:before{content:"\E950"}.icon-time-slot:before{content:"\E951"}.icon-tools:before{content:"\E952"}.icon-traffic-cone:before{content:"\E953"}.icon-trash:before{content:"\E954"}.icon-tree:before{content:"\E955"}.icon-triangle-down:before{content:"\E956"}.icon-triangle-left:before{content:"\E957"}.icon-triangle-right:before{content:"\E958"}.icon-triangle-up:before{content:"\E959"}.icon-users:before{content:"\E95A"}.icon-v-card:before{content:"\E95B"}.icon-video-camera:before{content:"\E95C"}.icon-video:before{content:"\E95D"}.icon-vinyl:before{content:"\E95E"}.icon-voicemail:before{content:"\E95F"}.icon-wallet:before{content:"\E960"}.icon-warning:before{content:"\E961"}.icon-water:before{content:"\E962"}.icon-500px-with-circle:before{content:"\E963"}.icon-500px:before{content:"\E964"}.icon-facebook-with-circle:before{content:"\E965"}.icon-facebook:before{content:"\E966"}.icon-flattr:before{content:"\E967"}.icon-flickr-with-circle:before{content:"\E968"}.icon-flickr:before{content:"\E969"}.icon-foursquare:before{content:"\E96A"}.icon-github-with-circle:before{content:"\E96B"}.icon-github:before{content:"\E96C"}.icon-google-drive:before{content:"\E96D"}.icon-google-hangouts:before{content:"\E96E"}.icon-google-play:before{content:"\E96F"}.icon-linkedin-with-circle:before{content:"\E970"}.icon-linkedin:before{content:"\E971"}.icon-mail-with-circle:before{content:"\E972"}.icon-medium-with-circle:before{content:"\E973"}.icon-medium:before{content:"\E974"}.icon-mixi:before{content:"\E975"}.icon-onedrive:before{content:"\E976"}.icon-paypal:before{content:"\E977"}.icon-picasa:before{content:"\E978"}.icon-pinterest-with-circle:before{content:"\E979"}.icon-pinterest:before{content:"\E97A"}.icon-sina-weibo:before{content:"\E97B"}.icon-skype-with-circle:before{content:"\E97C"}.icon-skype:before{content:"\E97D"}.icon-slideshare:before{content:"\E97E"}.icon-smashing:before{content:"\E97F"}.icon-soundcloud:before{content:"\E980"}.icon-spotify-with-circle:before{content:"\E981"}.icon-spotify:before{content:"\E982"}.icon-stumbleupon-with-circle:before{content:"\E983"}.icon-stumbleupon:before{content:"\E984"}.icon-swarm:before{content:"\E985"}.icon-vk-alternitive:before{content:"\E986"}.icon-vk-with-circle:before{content:"\E987"}.icon-vk:before{content:"\E988"}.icon-windows-store:before{content:"\E989"}.icon-xing-with-circle:before{content:"\E98A"}.icon-xing:before{content:"\E98B"}.icon-yelp:before{content:"\E98C"}.icon-youko-with-circle:before{content:"\E98D"}.icon-youko:before{content:"\E98E"}.icon-youtube-with-circle:before{content:"\E98F"}.icon-youtube:before{content:"\E990"}.icon-bug:before{content:"\E991"}.icon-chevron-with-circle-left:before{content:"\E992"}.icon-chevron-with-circle-up:before{content:"\E993"}.icon-chevron-with-circle-right:before{content:"\E994"}.icon-circle-with-cross:before{content:"\E995"}.icon-circle-with-minus:before{content:"\E996"}.icon-circle-with-plus:before{content:"\E997"}.icon-circular-graph:before{content:"\E998"}.icon-circle:before{content:"\E999"}.icon-clock:before{content:"\E99A"}html{font-size:16px}body{color:#333;font-family:-apple-system,system-ui,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,sans-serif;line-height:1.75;background:#fff;-webkit-font-smoothing:antialiased;font-smoothing:antialiased;text-rendering:optimizeLegibility;word-wrap:break-word;hyphens:auto}@media (max-width:768px){body{font-size:.99em}}a,a:active,a:hover{color:#d23669}.nopadding{padding-right:0!important;padding-left:0!important}.not-found-section{text-align:center;margin-top:2.5em}.header{color:#d23669;font-size:1.5em;font-weight:700}.header-description{font-size:1.2em;line-height:1.4em}.clearfix:after,.clearfix:before{display:table;content:""}.clearfix:after{clear:both}.clearfix{*zoom:1}.totop{display:inline-flex;flex-direction:row;position:fixed;padding:8px;width:60px;height:24px;right:25px;bottom:-100px;transition:all .2s ease-in-out;border-radius:20px;box-shadow:0 0 20px #766592;background-color:#dadada;overflow:hidden;box-sizing:content-box;cursor:pointer;z-index:2}.totop i{flex-basis:24px;z-index:2}.totop .progress{color:#000;flex-basis:26px;text-align:right;z-index:2;font-size:.6em}.totop .bg{position:absolute;left:0;right:0;bottom:0;height:100%;background-color:#d23669;transition:all .2s ease-in-out;z-index:-1}.totop.show{bottom:40px}.fixed-header{position:fixed;top:0;left:0;width:100%;height:48px;display:inline-block;z-index:1000;overflow:hidden;background:#dadada;visibility:hidden;transform:translateY(-100%);transition:transform .3s;box-shadow:0 3px 4px #b7afc4}.fixed-header p{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);cursor:pointer;font-weight:700}.fixed-header i{font-size:48px;text-align:center;line-height:48px;cursor:pointer;z-index:101}.fixed-header.show{visibility:visible;transform:translateY(0)}.fixed-header div{position:absolute;right:0}.navbar-header .fixed{position:fixed;right:0;top:60px}.header-menu,html.disabled{overflow:hidden}.header-menu{position:fixed;top:50%;left:50%;right:50%;bottom:50%;text-align:center;background-color:#dadada;transition:all .4s cubic-bezier(.455,.03,.515,.955);opacity:0;z-index:100}.header-menu.active{top:0;right:0;bottom:0;left:0;opacity:1}.header-menu .menu-list{display:inline-block;position:absolute;list-style:none;top:50%;left:50%;transform:translate(-50%,-50%)}.header-menu .menu-item{padding:0 20px;line-height:2em;font-size:2em;font-weight:bolder;cursor:pointer}.header-menu a{padding:4px 10px;border:2px solid transparent;transition:all .2s ease-in-out;text-decoration:none}::-webkit-scrollbar{width:10px;height:10px}::-webkit-scrollbar-thumb,::-webkit-scrollbar-track{-webkit-box-shadow:inset 0 0 6px rgba(0,0,0,.6);border-radius:10px}::-webkit-scrollbar-thumb{height:10px}.navbar-default{background:none}.navbar-default .navbar-nav>li>a:focus,.navbar-default .navbar-nav>li>a:hover{color:#d23669}@media (max-width:768px){.navbar-header{text-align:center}}.navbar-header h1{font-size:1.8em}.navbar-header p{font-size:.9em;max-width:750px;line-height:1.4em}@media (max-width:1024px){.navbar-header p{max-width:500px}}@media (max-width:768px){.navbar-header p{padding:0 30px;max-width:100%}}@media (max-width:1200px){.navbar-header .header-logo{height:150px}}@media (max-width:768px){.navbar-header .header-logo{float:none}}.navbar-header .header-logo img{width:100px;margin-right:25px}@media (max-width:768px){.navbar-header .header-logo img{margin:0 auto}}.navbar-brand{font-size:1.5em;height:auto;padding:10px 15px}.navbar{border:none;margin-bottom:0}@media (max-width:768px){.nav>li>a{padding:10px 30px;text-align:right}}.navbar-default .navbar-nav>li>a{text-transform:uppercase;line-height:50px;font-weight:700}@media (max-width:768px){.navbar-default .navbar-nav>li>a{line-height:40px}}.navbar-collapse{overflow:hidden}.navbar-toggle{border:0}.navbar-default .navbar-toggle:focus,.navbar-default .navbar-toggle:hover{background:none}.navbar-default .navbar-collapse,.navbar-default .navbar-form{border:0}.navbar-default .navbar-toggle .icon-bar{background-color:#5a8eee}.footer-social{padding:40px 0;font-size:.9em}.footer-social ul.social{font-size:.5em;text-align:center;padding:0}.footer-social ul.social a{text-decoration:none}.footer-social ul.social li{display:inline-block;width:2em;height:2em;font-size:3em;text-align:center;line-height:2em;-webkit-border-radius:50%;border-radius:50%;margin:.5em;transition:all .1s ease}.footer-social ul.social li:focus,.footer-social ul.social li:hover{-webkit-transform:rotate(1turn);-moz-transform:rotate(1turn);-ms-transform:rotate(1turn);transform:rotate(1turn)}.footer-social ul.social li:focus a,.footer-social ul.social li:hover a{text-decoration:none}.home-template .blog{margin-top:5em}@media (max-width:768px){.blog .page-number{font-size:.8em;position:absolute;top:4em;left:50%;transform:translateX(-50%);white-space:nowrap}}.blog .list-inline{margin-bottom:0}.blog .newer-posts{float:left;font-size:.8em}.blog .older-posts{float:right;font-size:.8em}.blog .separator{height:2px;background:#4d71b7;width:100%;margin-bottom:.5em;margin-top:.5em;display:block;background:linear-gradient(90deg,#d23669 0,#d23669 25%,#b42b3e 0,#b42b3e 50%,#8ab2ff 0,#8ab2ff 75%,#4d71b7 0,#4d71b7)}.blog .post .post-title{color:#d23669;font-size:2em;margin-bottom:40px}@media (max-width:768px){.blog .post .post-title{text-align:left}}.blog .posts{margin-top:2em}.blog .posts .post-title{font-size:1.5em;font-weight:700;margin-bottom:.3em}@media (max-width:768px){.blog .posts .post-title{text-align:left}}.blog .posts .post{margin-bottom:2em}.blog .posts time{margin-top:.5em;font-size:.9em}.blog .posts .post-excerpt{margin-top:.5em}.blog article.main-post h1,.blog article.main-post h2,.blog article.main-post h3,.blog article.main-post h4,.blog article.main-post h5,.blog article.main-post h6{font-weight:700;margin:16px 0}.blog article.main-post h1{font-size:1.6em}.blog article.main-post h2{font-size:1.4em}.blog article.main-post h3{font-size:1.2em}.blog article.main-post h4{font-size:1em}.blog article.main-post h5{font-size:.8em}.blog article.main-post h6{font-size:.6em}.blog article.main-post img{max-width:100%}.blog article.main-post iframe{border:none}.blog article.main-post blockquote{border-left-color:#d23669;background:#dadada;font-size:1em;color:#666}.blog article.main-post table{margin-bottom:1em;display:block;overflow:auto;max-height:500px}.blog article.main-post table tbody,.blog article.main-post table thead{display:table;width:100%;table-layout:fixed}.blog article.main-post table td,.blog article.main-post table th{padding:10px;border:1px solid #333}.blog article.main-post table tr:nth-child(2n){background:#dadada}.blog article.main-post hr{border-top:1px dashed #dadada}.blog article.main-post pre{max-height:500px;overflow:auto}.blog article.main-post .post-footer{padding-top:2em;font-size:1.2em}@media (max-width:768px){.blog article.main-post .post-footer .share-buttons li{display:block;line-height:2em}}.blog article.main-post .post-footer .share-twitter{color:#00aced}@media (max-width:768px){.blog article.main-post .post-footer .share-twitter{background-color:#00aced;color:#fff;padding:.25em;width:100%;display:block}}.blog article.main-post .post-footer .share-reddit{color:#ff5700}@media (max-width:768px){.blog article.main-post .post-footer .share-reddit{background-color:#ff5700;color:#fff;padding:.25em;width:100%;display:block}}.blog article.main-post .post-footer .share-facebook{color:#3b5998}@media (max-width:768px){.blog article.main-post .post-footer .share-facebook{background-color:#3b5998;color:#fff;padding:.25em;width:100%;display:block}}.blog article.main-post .post-footer .share-google-plus{color:#dd4b39}@media (max-width:768px){.blog article.main-post .post-footer .share-google-plus{background-color:#dd4b39;color:#fff;padding:.25em;width:100%;display:block}}.blog .post-meta .author-name{line-height:2em}.blog .post-meta .author-avatar div{display:inline-block;width:2em;height:50px}.blog .post-meta .desc{float:left;text-align:left}@media (min-width:990px){.blog .post-meta .desc{float:right;text-align:right}}.blog .post-meta .timeSize{margin-top:-10px}.blog .post-meta .tags{margin-bottom:4px}.blog .post-meta .tags li{font-size:.8em;margin:5px;border:2px solid #5a8eee;text-align:center;border-radius:100px/100px}.blog .post-meta .tags li a{color:#5a8eee;display:block;width:auto;padding:4px 10px}.blog .post-meta .tags li a:active,.blog .post-meta .tags li a:hover{text-decoration:none}.blog .post-meta .tags li:hover{background:#5a8eee}.blog .post-meta .tags li:hover a{color:#fff}.blog .post-meta .tags li.draft-tag{border-color:#d23669}.blog .post-meta .tags li.draft-tag a{color:#d23669}.blog .post-meta .tags li.draft-tag:hover{background:#d23669}.blog .post-meta .tags li.draft-tag:hover a{color:#fff}.blog .headings{position:absolute;top:48px;left:-420px;bottom:0;transition:left .2s ease-in-out;z-index:3;height:calc(100% - 48px)}.blog .headings.fixed{position:fixed}.blog .headings .index-resizable{height:100%!important}.blog .headings .index-container{overflow:auto;box-shadow:3px 0 4px #b7afc4;background-color:#dadada;height:100%}.blog .headings .index-title{margin:10px 0;text-align:center}.blog .headings .index-list{padding-right:2em}.blog .headings .index-list ul{list-style:none;-webkit-padding-start:20px}.blog .headings .index-list li{position:relative}.blog .headings .index-list li,.blog .headings .index-list li p{margin-bottom:0;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.blog .headings .index-list li p{display:inline-block;max-width:calc(100% - 60px);vertical-align:bottom}.blog .headings .index-list li:before{content:"# ";color:#d23669}.blog .headings .index-list a.active{color:#333;font-weight:900}.blog .headings .catalog ul{counter-reset:catalog}.blog .headings .catalog li:before{content:"# " counters(catalog,".") " ";counter-increment:catalog}.blog .collapse-icon{padding:8px;position:fixed;bottom:40px;cursor:pointer;border-radius:30px;box-shadow:0 0 10px #766592;background-color:#dadada;transition:left .2s ease-in-out;z-index:3;width:50px;height:50px}.blog .collapse-icon.show{left:25px}.blog .collapse-icon [class*=" icon-"]:before,.blog .collapse-icon [class^=icon-]:before{vertical-align:4px}@media (min-width:768px){.blog.collapse-catalog .post{padding:0 24px;position:absolute;right:0;margin:0}}.blog.collapse-catalog .headings{left:0}@media (max-width:768px){.blog.collapse-catalog .headings{right:0;width:100%}}@media (min-width:768px){.blog.collapse-catalog .collapse-icon.show{left:375px}}.tags-collection .tag-title{color:#d23669}.tags-collection .tag-meta{margin-bottom:2.5em}.gatsby-highlight-code-line{background-color:#ccc;display:block;margin-right:-1em;margin-left:-1em;padding-right:1em;padding-left:.75em;border-left:.25em solid #f99}code[class*=language-]{word-wrap:break-word;word-break:break-all}:not(pre)>code[class*=language-]{color:#d23669}.gatsby-highlight{margin-bottom:1em;overflow:auto}.gatsby-highlight pre[class*=language-]{float:left;min-width:100%;overflow-y:auto!important;overflow-x:hidden!important}.gatsby-code-button-container{z-index:1}.gatsby-highlight pre[class*=language-].line-numbers{padding-left:2.8em}.line-numbers-rows>span:before{padding:0 .4em;text-align:center}pre[class*=language-]{padding:1.4em .8em}.line-numbers .line-numbers-rows{margin:1.4em 0;border-right:none}.blog-section{margin-top:2.5em}.blog-section .header{margin-bottom:1.25em}@media (max-width:1024px){.blog-section .text-right{text-align:left}}.blog-section .gt-container .gt-svg svg{fill:#6190e8}.blog-section .gt-container .gt-comment-content p,.blog-section .gt-container textarea{color:#000}.blog-section .gt-container .gt-meta{z-index:2}.navigate-link,.navigate-link:active,.navigate-link:focus{font-weight:700;font-size:1.5em}.navigate-desc{margin-top:20px}.drafts-description{margin-bottom:40px}.blog-header{display:block;margin-bottom:50px}.blog-header__link{font-size:1.5em;height:auto;padding:10px 15px;float:left;margin-top:-8px}@media (max-width:768px){.blog-header__link{float:none}}.blog-header__img{width:70px;margin-right:25px}@media (max-width:768px){.blog-header__img{margin:0 auto}}.anchor{color:#fff;fill:currentColor}.about a{text-decoration:underline}.about p{padding-bottom:.75em}.about header{color:#d23669}.about header .header-avatar{display:inline-block;width:150px}.about header .header-description{font-size:1.5em}.about .about-section-title{color:#d23669;font-weight:700}.about .about-section{margin-top:2em;margin-bottom:2em}.about .about-section .row{margin-bottom:1em}@media (max-width:768px){.about .about-section .text-right{text-align:left}}.search .ais-Hits-item{width:100%;box-shadow:none;border:none;padding:0;margin-top:0}.search a{text-decoration:none}.search .ais-SearchBox{float:left;width:70%}.search .ais-HitsPerPage{float:right;width:20%}.search .ais-HitsPerPage .ais-HitsPerPage-select{width:100%}.search .ais-Pagination{max-width:100%;margin-top:1em}.tags a{text-decoration:none}</style></head><body itemscope="" itemtype="http://schema.org/WebPage"><div id="___gatsby"><div data-reactroot="" data-reactid="1" data-react-checksum="-1850797923"><!-- react-empty: 2 --><div class="fixed-header" data-reactid="3"><p data-reactid="4">女王控的博客</p><div data-reactid="5"><i class="icon icon-menu" data-reactid="6"></i></div></div><nav class="navbar navbar-default" data-reactid="7"><div class="container" data-reactid="8"><div class="medium-8 medium-offset-2 large-10 large-offset-1" data-reactid="9"><div class="navbar-header" data-reactid="10"><button type="button" class="navbar-toggle collapsed" data-reactid="11"><span class="sr-only" data-reactid="12">Toggle navigation</span><span class="icon-bar" data-reactid="13"></span><span class="icon-bar" data-reactid="14"></span><span class="icon-bar" data-reactid="15"></span></button></div><div class="collapse navbar-collapse " id="main-menu" data-reactid="16"><ul class="nav navbar-nav navbar-right" data-reactid="17"><li data-reactid="18"><a href="/" data-reactid="19">首页</a></li><li data-reactid="20"><a href="/tags" data-reactid="21">标签</a></li><li data-reactid="22"><a href="/about" data-reactid="23">关于</a></li><li data-reactid="24"><a href="/search" data-reactid="25">搜索</a></li></ul></div></div></div></nav><div class="header-menu" data-reactid="26"><div class="menu-list" data-reactid="27"><li class="menu-item" data-reactid="28"><a href="/" data-reactid="29">首页</a></li><li class="menu-item" data-reactid="30"><a href="/tags" data-reactid="31">标签</a></li><li class="menu-item" data-reactid="32"><a href="/about" data-reactid="33">关于</a></li><li class="menu-item" data-reactid="34"><a href="/search" data-reactid="35">搜索</a></li></div></div><section class="main-content" data-reactid="36"><div data-reactid="37"><script type="application/ld+json" data-reactid="38">{
    "@context": "http://schema.org/",
    "@type": "BlogPosting",
    "author": "女王控",
    "headline": "浏览器工作原理与实践——页面循环系统",
    "datePublished": "2021-07-05 15:32:26",
    "description": "消息队列和事件循环：页面是怎么活起来的 前面我们讲到了每个渲染进程都有一个主线程，并且主线程非常繁忙，既要处理 DOM，又要计算样式，还要处理布局，同时还需要处理 JavaScript…",
    "publisher": {
      "@type": "Person",
      "name": "女王控",
      "logo": {
        "@type": "ImageObject",
        "url": "/schema/avatar.png"
      }
    }
  }</script><div data-reactid="39"><!-- react-empty: 40 --></div><main class="blog container" role="main" data-reactid="41"><div class="medium-10 medium-offset-1 large-10 large-offset-1 post" data-reactid="42"><header class="post-head" data-reactid="43"><h1 class="post-title" data-reactid="44">浏览器工作原理与实践——页面循环系统</h1></header><section class="post-meta" data-reactid="45"><div class="row" data-reactid="46"><div class="medium-6 small-12" data-reactid="47"><ul class="list-inline" data-reactid="48"><li data-reactid="49"><a class="author-avatar" itemprop="name" href="/" data-reactid="50"><div class=" gatsby-image-outer-wrapper" style="position:relative;" data-reactid="51"><div class=" gatsby-image-wrapper" style="position:relative;overflow:hidden;" data-reactid="52"><div style="width:100%;padding-bottom:150%;" data-reactid="53"></div><img alt="" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAeCAYAAAAsEj5rAAAACXBIWXMAAAsSAAALEgHS3X78AAAHlUlEQVRIx11WaWxU1xWewbQlrdofkSIhGiBpMPZ4Vs/2lpm3zupZPOOZ8Sz2YGzANkaAKaYQUrMkLYgiIlxCQjCYQAwYEoMQNJAIFBxaQgUhoCopYceBJo1pKFVDCbOc0/fesOZKV+fM1Tvf/c56R0VYOZW8lvAxtSybvbExAu1+mndGuaDQ2F4rNHVFhCZJZlMeZ1Qrf9Mt+H+qur/ihFORAFA64J0pVTcXVcDmcKFfruIzZ7rY1H89fAZivjbM1MzFxkAnZqWd9M7KJcTmv7zCN44sY+tflm12C79WLxLCqidWN9cwWpYvsfXL13vasZudgm4mgX4hW6h1teRjnrZCwjOzWO/twIR/FjZ7WnEZ35JvcUSeU4gwSXV7W1sJzEH6R8nSRArlXjr6r7S1DqNUvMAzCXCzSfDxDRAUmyDkaoawtEPi1LxHyGLMkby5gEqUy7atjnq1roosAXqE6Yq7DBXa7RLS6HRG8y4hhbwzDiJbj4IkXUwS5e1h07IOorMePUL6ruiKGmRblg2PesJlq9nxrJMMfydIbhIWP9jMPrBLkrIHgXfG0CdmgKMjwFARFKVvHEQo5xUyKDDRN2T7aE17mV5rfZQYm1lM0EQYWUe0aNTxoKl0Qnk5jVqNA/VaFu3SBS7SB7Ju0ougr2KKWg2DBi17mbCaxyghMzgeMTTp2W7CGkTKHshZqn0Q5Osg6opBhAmAzcADY/NheyQJBi2D8mXVehYMOgEsJg9aTIxSN2YTO+ohQ62G6rGZa5AmAjmj0YvzG5vhVP8f4fTO12FtVxfMjTfC6zPbwOsIQNybhK6GlmLCm5DA6cu2aoeSaaOeVheLxRKgpoJcZ5UAly94MeeiQ+jnQtBCcTBTZ8Ght9fDfy58DDdOHIRj2zdA/4uzYWBpZ6Fr6jR8/lfWP8n2usqA2mQgH7msr3Ks0WgEfGvN6lz/q6tgXqgZjgpZOGSLwsldA4CFG4j3rmP/osU47xkdrm5pLfjdETm+p64cf0fJME34HiVFV+VYajF50UGGc/Nnz4XDfW/ArQ09+M++XsCblwD+fQEL356HswuWwdedS+Dg2p5ilZQwa7VrpCHZ9nOl7Ojg44B0hxxg0hbMjx2rh2iwDk4feReKI58hfn8V8c5lwNyXiF+dRbz4Z1jY1g4TJ1rQbnHfc/ORihJDr5q0kw8AyVqDjpeSEpJLAyaMN6HRwMDuTa/B1fcPwcfbBuHc8SPw+cnDsGvzeim7HOg0DpAYoouPBWUMJxUo65y18X4MtbYJOo3zjgQoxwWen1iNDdPmwPu9+2BvfCXsXbQRehf9Hly0B8aN04OuioGqCipvt/hQ5GLzS4Dh0Tdv3+/nvm0qVVUlfUouboOWK8jxmaznMBXIwpbfroWN63th384tcHTfDpj0gg21lQxoK+m8TQGMb5UxAt6OUYSVkUuGK5MPKiuIHicZwWqDmNNqpE6pIFBjpGDxsqXwuxUroWtBN5w4NgSbNvcDIRW61CUFu9UrtV/si7Fjf/ajUmICSvxKgJMtdQxVK2XOU9RpGNBL3VBeQWIqPR3SjR3QOW8xrFmxCnrWbYJMaobEkr1HE/4zIpv4nrK7NIrbpF+tspoYZdpMLte+wNPRu6S1Bs1GqV/1DOqMPFjIMFbq3dg6cyFkGmagqZqHaoOAHF2XZ6ngWg+XBM4RVoLHOWrLVG4uWpo4FvsvfHz6NktFkbT6QafnQGsUoFLHYm1dFj44cgwYPgQVkymkbP6RWl+LNIRjL/uFhltuNjEoYySCXaNUojOsMPSw4aqwa+o9ga5DggiC1RFDmyMG1bYQVlTSIIhRMJq9RaPZJ4VF+DQZ6MCAmOkLurJ/DYiNt/R67VMKs4hrqjL+o+6mjrj0hjBEOG+1h8FOxcFO1oHVFgazPYQGqdfNthBYpUqwEME78nsT4tP7o96WwWSwA1nKb35iyCZ8M85EXE3oYBO3ab4RKWcSKCaFJJMCQprSpPQcUFwKzWQUKo1+lC9x0r7Fcc+0OVOj8zEkNrY8BAuLDV11ruZvDXrhuJ3NIu+bAYK/FXjfdOA8zegUp6DdmQKNMQD+8HTseW1LYeijE/jB4Q+/Wry8a5L01B6MeaetUcDSjfVjjOVM7da+bTMPvHfkbmrKb5DksjkLncmZqXTe6siAnWmAmkhbYUPvQP7cufO5L69fxyvD/8Ctb+/aI2PU8AmvRGqZAoiIityzb8/T165d3X3t2vD/Pjr+KW7b+R6u2/AOrli9CQfePYQXLg3jpSvDeOLkWTxw6Oh3uwYPrJTMlNHlFcLPeNk6/UOXZ7cuGP1A397fP/7v584vvzJ8o+dvn33+Zm/v9q9X/2EDbN+19+ybm3ds33/ww5f63uovf/D9woVL1A90P5dQqYaGhpQfg4N71BJbteoHqyk7Z+e8zlfuSupPHj+/eO2bso5ZcxQ9Fsiqgny6ZOv3+VTfjIwo+iefnFYN7BxQf3FxuEwGH1c+fgxBuIZnTFuIIh9U2qt3844fb9y0Vf0gXPKm7bzKzYZ+wGTKFFWNz1/6v8OLUiuaFKMJz00yEvaa/RQZnK086s6MutpEqRLx+kcT+rH1f+YikeeNfqnwAAAAAElFTkSuQmCC" style="position:absolute;top:0;left:0;transition:opacity 0.5s;width:100%;height:100%;object-fit:cover;object-position:center;opacity:1;transition-delay:0.25s;" data-reactid="54"/><noscript data-reactid="55"><img src="/static/avatar-a4ccbab8e7381acb89452773ce94d5a0-25c91.png" srcset="/static/avatar-a4ccbab8e7381acb89452773ce94d5a0-8a97b.png 200w,
/static/avatar-a4ccbab8e7381acb89452773ce94d5a0-0fdf3.png 400w,
/static/avatar-a4ccbab8e7381acb89452773ce94d5a0-25c91.png 600w" alt="" sizes="(max-width: 600px) 100vw, 600px" style="position:absolute;top:0;left:0;transition:opacity 0.5s;transition-delay:0.5s;opacity:1;width:100%;height:100%;object-fit:cover;object-position:center"/></noscript></div></div></a></li><li data-reactid="56"><div class="author-name" data-reactid="57">女王控</div><time class="post-date" datetime="2021-07-05 15:32:26" data-reactid="58">2021-07-05 15:32:26</time></li></ul></div><div class="medium-6 small-12 desc" data-reactid="59"><ul class="tags list-inline" data-reactid="60"><li data-reactid="61"><a href="/tag/前端" data-reactid="62">前端</a></li><li data-reactid="63"><a href="/tag/浏览器" data-reactid="64">浏览器</a></li><li data-reactid="65"><a href="/tag/高级前端" data-reactid="66">高级前端</a></li></ul><div class="timeSize" data-reactid="67"><!-- react-text: 68 -->阅读时间：<!-- /react-text --><!-- react-text: 69 -->32<!-- /react-text --><!-- react-text: 70 -->分钟 文章字数：<!-- /react-text --><!-- react-text: 71 -->3022<!-- /react-text --><!-- react-text: 72 -->字<!-- /react-text --></div></div></div></section><div class="separator" data-reactid="73"></div><article class="main-post" data-reactid="74"><section class="post-content" data-reactid="75"><h1 id="消息队列和事件循环：页面是怎么活起来的"><a href="#%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97%E5%92%8C%E4%BA%8B%E4%BB%B6%E5%BE%AA%E7%8E%AF%EF%BC%9A%E9%A1%B5%E9%9D%A2%E6%98%AF%E6%80%8E%E4%B9%88%E6%B4%BB%E8%B5%B7%E6%9D%A5%E7%9A%84" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>消息队列和事件循环：页面是怎么活起来的</h1>
<p>前面我们讲到了每个渲染进程都有一个主线程，并且主线程非常繁忙，既要处理 DOM，又要计算样式，还要处理布局，同时还需要处理 JavaScript 任务以及各种输入事件。要让这么多不同类型的任务在主线程中有条不紊地执行，这就需要一个系统来统筹调度这些任务，这个统筹调度系统就是我们今天要讲的消息队列和事件循环系统。</p>
<p>在写这篇文章之前，我翻阅了大量的资料，却发现没有一篇文章能把消息循环系统给讲清楚的，所以我决定用一篇文章来专门介绍页面的事件循环系统。事件循环非常底层且非常重要，学会它能让你理解页面到底是如何运行的，所以在本篇文章中，我们会将页面的事件循环给梳理清楚、讲透彻。</p>
<p>为了能让你更加深刻地理解事件循环机制，我们就从最简单的场景来分析，然后带你一步步了解浏览器页面主线程是如何运作的。</p>
<p>需要说明的是，文章中的代码我会采用 C++ 来示范。如果你不熟悉 C++，也没有关系，这里并没有涉及到任何复杂的知识点，只要你了解 JavaScript 或 Python，你就会看懂</p>
<h2 id="使用单线程处理安排好的任务"><a href="#%E4%BD%BF%E7%94%A8%E5%8D%95%E7%BA%BF%E7%A8%8B%E5%A4%84%E7%90%86%E5%AE%89%E6%8E%92%E5%A5%BD%E7%9A%84%E4%BB%BB%E5%8A%A1" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>使用单线程处理安排好的任务</h2>
<p>我们先从最简单的场景讲起，比如有如下一系列的任务：</p>
<ul>
<li>任务 1：1+2</li>
<li>任务 2：20/5</li>
<li>任务 3：7*8</li>
<li>任务 4：打印出任务 1、任务 2、任务 3 的运算结果</li>
</ul>
<p>现在要在一个线程中去执行这些任务，通常我们会这样编写代码</p>
<div
              class="gatsby-code-button-container"
              data-toaster-id="73742317157259076000"
              data-toaster-class="gatsby-code-button-toaster"
              data-toaster-text-class="gatsby-code-button-toaster-text"
              data-toaster-text="复制成功"
              data-toaster-duration="3500"
              onClick="copyToClipboard(`void MainThread() {
  int num1 = 1+2; // 任务 1
  int num2 = 20/5; // 任务 2
  int num3 = 7*8; // 任务 3
  print(&quot; 最终计算的值为:%d,%d,%d&quot;,num, num2, num3)； // 任务 4
}`, `73742317157259076000`)"
            >
              <div
                class="gatsby-code-button"
                
              >
                cpp 复制代码
              </div>
            </div>
<div class="gatsby-highlight" data-language="cpp"><pre style="counter-reset: linenumber NaN" class="language-cpp line-numbers"><code class="language-cpp"><span class="token keyword">void</span> <span class="token function">MainThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">int</span> num1 <span class="token operator">=</span> <span class="token number">1</span><span class="token operator">+</span><span class="token number">2</span><span class="token punctuation">;</span> <span class="token comment">// 任务 1</span>
  <span class="token keyword">int</span> num2 <span class="token operator">=</span> <span class="token number">20</span><span class="token operator">/</span><span class="token number">5</span><span class="token punctuation">;</span> <span class="token comment">// 任务 2</span>
  <span class="token keyword">int</span> num3 <span class="token operator">=</span> <span class="token number">7</span><span class="token operator">*</span><span class="token number">8</span><span class="token punctuation">;</span> <span class="token comment">// 任务 3</span>
  <span class="token function">print</span><span class="token punctuation">(</span><span class="token string">" 最终计算的值为:%d,%d,%d"</span><span class="token punctuation">,</span>num<span class="token punctuation">,</span> num2<span class="token punctuation">,</span> num3<span class="token punctuation">)</span>； <span class="token comment">// 任务 4</span>
<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>在上面的执行代码中，我们把所有任务代码按照顺序写进主线程里，等线程执行时，这些任务会按照顺序在线程中依次被执行；等所有任务执行完成之后，线程会自动退出。可以参考下图来直观地理解下其执行过程：</p>
<p>
  <a
    class="gatsby-resp-image-link"
    href="/static/2021-07-05-15-34-41-14ad4d9a6ca3928b729da147297fc26b-ed3f4.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
  
  <span
    class="gatsby-resp-image-wrapper"
    style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;"
  >
    <span
      class="gatsby-resp-image-background-image"
      style="padding-bottom: 55.590062111801245%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABc0lEQVQoz6VSuVLDMBDN31HyC/wNP5BjaGhS0FLQkDAThmFiQ0NBAUzuOD4kW7YTy5IV62AdTwJh0qF5eiPt6mlXq22Yf4zG742UknFeFAVMIQQwr7d7hqG1Pi1mjKfrNQ4jH6EoIsABxgDPDxAOwR6RuCzL0+I8z8ezGQpDL0ARIV4QgBKEwGB0Vu7naATZKX1SzNjHaOzjcLpwMImB3QDPl+7S9ebOaun6o9milBJOQu6AI3HBmcgiQYkWmWRJkcdiE5Z5zBLEUszXodkmr464+1KHyFUSQrDHQcdL6NULb1l526IdmzWHtDWksG5ZtG3nYO/YtGmLs25xcSsw1Q2onlSS88x67iZMPExNb6Jq9KeqP/nB/UQN5ur6TZ7fbC+ftutCV2nrKngVXytptDCKV5DsDyAEfIg9jnvvoSmpktujN0MNoJQ1diXZ3Vi7TOUqpQanMaWqDujGydaB/yCEZFmGEErTNEmSzWZj9rccuuQbn+duCydzpwcAAAAASUVORK5CYII='); background-size: cover; display: block;"
    >
      <img
        class="gatsby-resp-image-image"
        style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;"
        alt="2021 07 05 15 34 41"
        title=""
        src="/static/2021-07-05-15-34-41-14ad4d9a6ca3928b729da147297fc26b-fee1c.png"
        srcset="/static/2021-07-05-15-34-41-14ad4d9a6ca3928b729da147297fc26b-a67b7.png 200w,
/static/2021-07-05-15-34-41-14ad4d9a6ca3928b729da147297fc26b-0b187.png 400w,
/static/2021-07-05-15-34-41-14ad4d9a6ca3928b729da147297fc26b-fee1c.png 800w,
/static/2021-07-05-15-34-41-14ad4d9a6ca3928b729da147297fc26b-b1a91.png 1200w,
/static/2021-07-05-15-34-41-14ad4d9a6ca3928b729da147297fc26b-ed3f4.png 1288w"
        sizes="(max-width: 800px) 100vw, 800px"
      />
    </span>
  </span>
  
  </a>
    </p>
<h2 id="在线程运行过程中处理新任务"><a href="#%E5%9C%A8%E7%BA%BF%E7%A8%8B%E8%BF%90%E8%A1%8C%E8%BF%87%E7%A8%8B%E4%B8%AD%E5%A4%84%E7%90%86%E6%96%B0%E4%BB%BB%E5%8A%A1" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>在线程运行过程中处理新任务</h2>
<p>但并不是所有的任务都是在执行之前统一安排好的，大部分情况下，新的任务是在线程运行过程中产生的。比如在线程执行过程中，又接收到了一个新的任务要求计算“10+2”，那上面那种方式就无法处理这种情况了。</p>
<p>要想在线程运行过程中，能接收并执行新的任务，就需要采用事件循环机制。我们可以通过一个 for 循环语句来监听是否有新的任务，如下面的示例代码：</p>
<div
              class="gatsby-code-button-container"
              data-toaster-id="95784149505695290000"
              data-toaster-class="gatsby-code-button-toaster"
              data-toaster-text-class="gatsby-code-button-toaster-text"
              data-toaster-text="复制成功"
              data-toaster-duration="3500"
              onClick="copyToClipboard(`// GetInput
// 等待用户从键盘输入一个数字，并返回该输入的数字
int GetInput() {
  int input_number = 0;
  cout<<&quot;请输入一个数:&quot;;
  cin>>input_number;
  return input_number;
}

// 主线程(Main Thread)
void MainThread() {
  for(;;){
    int first_num = GetInput();
    int second_num = GetInput();
    result_num = first_num + second_num;
    print(&quot;最终计算的值为:%d&quot;,result_num);
  }
}`, `95784149505695290000`)"
            >
              <div
                class="gatsby-code-button"
                
              >
                cpp 复制代码
              </div>
            </div>
<div class="gatsby-highlight" data-language="cpp"><pre style="counter-reset: linenumber NaN" class="language-cpp line-numbers"><code class="language-cpp"><span class="token comment">// GetInput</span>
<span class="token comment">// 等待用户从键盘输入一个数字，并返回该输入的数字</span>
<span class="token keyword">int</span> <span class="token function">GetInput</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">int</span> input_number <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  cout<span class="token operator">&lt;&lt;</span><span class="token string">"请输入一个数:"</span><span class="token punctuation">;</span>
  cin<span class="token operator">>></span>input_number<span class="token punctuation">;</span>
  <span class="token keyword">return</span> input_number<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 主线程(Main Thread)</span>
<span class="token keyword">void</span> <span class="token function">MainThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token punctuation">;</span><span class="token punctuation">;</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">int</span> first_num <span class="token operator">=</span> <span class="token function">GetInput</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> second_num <span class="token operator">=</span> <span class="token function">GetInput</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    result_num <span class="token operator">=</span> first_num <span class="token operator">+</span> second_num<span class="token punctuation">;</span>
    <span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"最终计算的值为:%d"</span><span class="token punctuation">,</span>result_num<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>相较于第一版的线程，这一版的线程做了两点改进。</p>
<ul>
<li>第一点引入了循环机制，具体实现方式是在线程语句最后添加了一个 for 循环语句，线程会一直循环执行。</li>
<li>第二点是引入了事件，可以在线程运行过程中，等待用户输入的数字，等待过程中线程处于暂停状态，一旦接收到用户输入的信息，那么线程会被激活，然后执行相加运算，最后输出结果。</li>
</ul>
<p>通过引入事件循环机制，就可以让该线程“活”起来了，我们每次输入两个数字，都会打印出两数字相加的结果，你可以结合下图来参考下这个改进版的线程：</p>
<p>
  <a
    class="gatsby-resp-image-link"
    href="/static/2021-07-05-15-36-22-cf284cfa7deb324afd661f712c7b9a60-29961.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
  
  <span
    class="gatsby-resp-image-wrapper"
    style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;"
  >
    <span
      class="gatsby-resp-image-background-image"
      style="padding-bottom: 82.36272878535773%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAIAAACZeshMAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABqElEQVQoz42Ty07cMBSG86BsWCBYsIQdGxa8QCUkVAlWLFhxa4vUMiosgUpFDCBoCa3IaEqYXBzHThzfOYkJjBDT4ZdlHV8+H19+e3a0tNaqlZQSaugZnuCNIo0xeZ7jRi7IsowQAv3jYciTpmmv1/N9v9/vuxghNJz8f5lJoyYzyTCGOCf07cymlm4D055Zam2S6EGJAkaaMvrMQLlxN1HpunXdx4sHbH5fbF1JO7SA90RYS+K74OKbNapAUXJ/R5L73u0VRVHM7HpXbf8yP0M7/UnsXqt6U6aF3W7PLg8/rEzcILtyzFZP6NqP8uMR2ejy2S9yaofTHNky2jovJzZFIYzL70nFq4pCo3u6t742gyvzO7G3qC5+agNsD//qyW0+wMxy0rnhc19F+QzXt2RUfTzOBM1eXYlrLJ/Imc9i4bteOigroZ77PTtObl431J0/2v+X5hgxVoE45+Ph9kLrl0NJPBgM4jgGw4Bt3gU7XiodRVEYhgAHQZAkyXvhISO96G24KApKKWMMzAy/oixL2CR8DDD8+F8FGPBQg7FhFYBx4+1X8CMYAZeRWApgQAAAAABJRU5ErkJggg=='); background-size: cover; display: block;"
    >
      <img
        class="gatsby-resp-image-image"
        style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;"
        alt="2021 07 05 15 36 22"
        title=""
        src="/static/2021-07-05-15-36-22-cf284cfa7deb324afd661f712c7b9a60-fee1c.png"
        srcset="/static/2021-07-05-15-36-22-cf284cfa7deb324afd661f712c7b9a60-a67b7.png 200w,
/static/2021-07-05-15-36-22-cf284cfa7deb324afd661f712c7b9a60-0b187.png 400w,
/static/2021-07-05-15-36-22-cf284cfa7deb324afd661f712c7b9a60-fee1c.png 800w,
/static/2021-07-05-15-36-22-cf284cfa7deb324afd661f712c7b9a60-b1a91.png 1200w,
/static/2021-07-05-15-36-22-cf284cfa7deb324afd661f712c7b9a60-29961.png 1202w"
        sizes="(max-width: 800px) 100vw, 800px"
      />
    </span>
  </span>
  
  </a>
    </p>
<h2 id="处理其他线程发送过来的任务"><a href="#%E5%A4%84%E7%90%86%E5%85%B6%E4%BB%96%E7%BA%BF%E7%A8%8B%E5%8F%91%E9%80%81%E8%BF%87%E6%9D%A5%E7%9A%84%E4%BB%BB%E5%8A%A1" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>处理其他线程发送过来的任务</h2>
<p>上面我们改进了线程的执行方式，引入了事件循环机制，可以让其在执行过程中接受新的任务。不过在第二版的线程模型中，所有的任务都是来自于线程内部的，如果另外一个线程想让主线程执行一个任务，利用第二版的线程模型是无法做到的。</p>
<p>那下面我们就来看看其他线程是如何发送消息给渲染主线程的，具体形式你可以参考下图：</p>
<p>
  <a
    class="gatsby-resp-image-link"
    href="/static/2021-07-05-15-36-37-f640306f8b3ea0982b29ce147087fce9-5cdb5.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
  
  <span
    class="gatsby-resp-image-wrapper"
    style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;"
  >
    <span
      class="gatsby-resp-image-background-image"
      style="padding-bottom: 70.18072289156628%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAIAAACgpqunAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABqElEQVQoz41SbU/bQAzmL6P9nP0CJNBA6gZ8Qkj9tEpo00rE2sIUhaZpmijkck3uzrGNr1fe1lXaI+fii++xn3N8wMz9v8AvQMTdKBFJ6EBiSqluiza8jDHj8Xg0Gg2HwyRJnHNt60OySEhrLb4nSxoJ8A6KfJml83SerHUj21AqAAAkxQeyqKuLGHpUlsQ65IfH5TReTOJ0Ei/WwEVLsxKBPFnEfSB3XXN99bnU5nxGgzsYROYsMqeR/fKjObs15xM4+WUPL9x9RUzQvpLDBcTR9SrIw6eKNmq94EaJaAZnVaPcHtn8vr/Fipw/iKpGIUsKrQlg753JA7fkckXWbsgKNxL6bEFdR/wflbnI2Hkyq4p17R27ZrB7KwPYu+jKOFhqXuQ6q2y25rzlVS1fKNcYl+77HDuQ7ux22+ib0UnVum9TGkzpq9jv/vinPrqpT2/NxYyOI/x06f488Vu35YIyMaJExoiQJKvEmJwYoS2zefIwbepSLtOjk1NMfRhBT5ZHaGH/AguSwxuGP9cjhrg1JjhSckv+C5LrcYM0TfM8F0fW9+P5imenpyUDdr7C3AAAAABJRU5ErkJggg=='); background-size: cover; display: block;"
    >
      <img
        class="gatsby-resp-image-image"
        style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;"
        alt="2021 07 05 15 36 37"
        title=""
        src="/static/2021-07-05-15-36-37-f640306f8b3ea0982b29ce147087fce9-fee1c.png"
        srcset="/static/2021-07-05-15-36-37-f640306f8b3ea0982b29ce147087fce9-a67b7.png 200w,
/static/2021-07-05-15-36-37-f640306f8b3ea0982b29ce147087fce9-0b187.png 400w,
/static/2021-07-05-15-36-37-f640306f8b3ea0982b29ce147087fce9-fee1c.png 800w,
/static/2021-07-05-15-36-37-f640306f8b3ea0982b29ce147087fce9-b1a91.png 1200w,
/static/2021-07-05-15-36-37-f640306f8b3ea0982b29ce147087fce9-5cdb5.png 1328w"
        sizes="(max-width: 800px) 100vw, 800px"
      />
    </span>
  </span>
  
  </a>
    </p>
<p>从上图可以看出，渲染主线程会频繁接收到来自于 IO 线程的一些任务，接收到这些任务之后，渲染进程就需要着手处理，比如接收到资源加载完成的消息后，渲染进程就要着手进行 DOM 解析了；接收到鼠标点击的消息后，渲染主线程就要开始执行相应的 JavaScript 脚本来处理该点击事件。</p>
<p>那么如何设计好一个线程模型，能让其能够接收其他线程发送的消息呢？</p>
<p>一个通用模式是使用消息队列。在解释如何实现之前，我们先说说什么是消息队列，可以参考下图：</p>
<p>
  <a
    class="gatsby-resp-image-link"
    href="/static/2021-07-05-15-36-49-b9932e0a0b3732be6d12a4f8e7aec6b5-0a2a7.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
  
  <span
    class="gatsby-resp-image-wrapper"
    style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;"
  >
    <span
      class="gatsby-resp-image-background-image"
      style="padding-bottom: 33.43239227340268%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAIAAACHqfpvAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABFklEQVQY032QS0+DQBSF+WOuXPggGlf+Bn+Sr8RFY6ML122JTXwU4wot0CCEEoYCnaC0oVBmYJgZaXXTxnpzF+ec3JObfAJfHcrYP7t2LHBKGaVZlsYRxPMZ3zx1PUsmWTJFCP14gXxGnJAc40d1KPXdVzPomWPZGPU+whfDfzbDWsi1sKBsePeq+6A6uCzpLGFVJZD4i6dJalsnd/bODTy6VA6brnjxtnXlbJ++7zXcg4a9e6aIt1A8V/avwXHTRp5LgLMolzDkKMfz7MnwW/q4qwFpEEgqaOlBR/U6eiBpvtQH7QGsw7YWdHWfFEU1iRdlVhG+SoItbTKNwdCKwhEl5Z8AlsA2cC5KkiOM6yeU/oZ0nfk38Hd+EIyNiqYAAAAASUVORK5CYII='); background-size: cover; display: block;"
    >
      <img
        class="gatsby-resp-image-image"
        style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;"
        alt="2021 07 05 15 36 49"
        title=""
        src="/static/2021-07-05-15-36-49-b9932e0a0b3732be6d12a4f8e7aec6b5-fee1c.png"
        srcset="/static/2021-07-05-15-36-49-b9932e0a0b3732be6d12a4f8e7aec6b5-a67b7.png 200w,
/static/2021-07-05-15-36-49-b9932e0a0b3732be6d12a4f8e7aec6b5-0b187.png 400w,
/static/2021-07-05-15-36-49-b9932e0a0b3732be6d12a4f8e7aec6b5-fee1c.png 800w,
/static/2021-07-05-15-36-49-b9932e0a0b3732be6d12a4f8e7aec6b5-b1a91.png 1200w,
/static/2021-07-05-15-36-49-b9932e0a0b3732be6d12a4f8e7aec6b5-0a2a7.png 1346w"
        sizes="(max-width: 800px) 100vw, 800px"
      />
    </span>
  </span>
  
  </a>
    </p>
<p>从图中可以看出，消息队列是一种数据结构，可以存放要执行的任务。它符合队列“先进先出”的特点，也就是说要添加任务的话，添加到队列的尾部；要取出任务的话，从队列头部去取。</p>
<p>有了队列之后，我们就可以继续改造线程模型了，改造方案如下图所示：</p>
<p>
  <a
    class="gatsby-resp-image-link"
    href="/static/2021-07-05-15-37-02-0559f3d4e4ffa48ccad5e3695fcd821a-eb890.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
  
  <span
    class="gatsby-resp-image-wrapper"
    style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;"
  >
    <span
      class="gatsby-resp-image-background-image"
      style="padding-bottom: 66.13119143239625%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAIAAAAmMtkJAAAACXBIWXMAAA7DAAAOwwHHb6hkAAACCklEQVQoz3VS227TQBDNLyOhliIhfoBnoIAqISQeUQpJWim8FNpKbaER4DZx6jR2nNRJnNjry+5674ydUCoqjo6smdWcnTnrqRljWIXiHvIsS9OUUgqx4EWc0SijSnImBBdCa11TSuV5jjGWEo7ULQsuh67XvxrkhCql55l8e86eHfHzwWLcv3QdB/Q1uCDPie87/qhzGph6VzT7qrGiXX4/2ao9UI/afBDpSWY2W8nM96aTMed8JS4HVEowaQg3+ZoaV8yY0cbsX8nnZ6LhmAMXMgNtwWk5NliCXOkS5v9wQnHyzYV6KIO2pRgihFCCEF4uOYp+Wf0Xx+Odo+vXX69fHjivDofbh+6bY3f7i/Pu1AsuLbGYYUrFqjOIoyhKk6QI52YyPDmzNhqDp43u4/rFww/W1sfe5m73SdPeqlsbu/aFc2NwSihdd4Yx4C9JKSkhmJDR2Oc4MYLNJyNBUsPIIvAlzQ2nmuGCMcIYFIt/PANEQeIwAONKyuXsBk6yFGVJfP8t/o4Nm6CURGg6CElnGLmRdJH+4cVurJyQW34yjJWH9Ajp9z9VZ6rK1+aVGKIgCLI0cT3rs41bXb7XK/Z6rNVjzV6xb/MqLiBt99mDJt35DmMqWLp159UCSiFhU/+QVxR3gvI8wVBWykACfmt3neiKUmmUZuEimoeLJM1yTCKUwlbc1tziNySS08FDlEaXAAAAAElFTkSuQmCC'); background-size: cover; display: block;"
    >
      <img
        class="gatsby-resp-image-image"
        style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;"
        alt="2021 07 05 15 37 02"
        title=""
        src="/static/2021-07-05-15-37-02-0559f3d4e4ffa48ccad5e3695fcd821a-fee1c.png"
        srcset="/static/2021-07-05-15-37-02-0559f3d4e4ffa48ccad5e3695fcd821a-a67b7.png 200w,
/static/2021-07-05-15-37-02-0559f3d4e4ffa48ccad5e3695fcd821a-0b187.png 400w,
/static/2021-07-05-15-37-02-0559f3d4e4ffa48ccad5e3695fcd821a-fee1c.png 800w,
/static/2021-07-05-15-37-02-0559f3d4e4ffa48ccad5e3695fcd821a-b1a91.png 1200w,
/static/2021-07-05-15-37-02-0559f3d4e4ffa48ccad5e3695fcd821a-eb890.png 1494w"
        sizes="(max-width: 800px) 100vw, 800px"
      />
    </span>
  </span>
  
  </a>
    </p>
<p>从上图可以看出，我们的改造可以分为下面三个步骤：</p>
<ul>
<li>添加一个消息队列；</li>
<li>IO 线程中产生的新任务添加进消息队列尾部；</li>
<li>渲染主线程会循环地从消息队列头部中读取任务，执行任务。</li>
</ul>
<p>有了这些步骤之后，那么接下来我们就可以按步骤使用代码来实现第三版的线程模型。</p>
<p>首先，构造一个队列。当然，在本篇文章中我们不需要考虑队列实现的细节，只是构造队列的接口：</p>
<div
              class="gatsby-code-button-container"
              data-toaster-id="40814211050762280000"
              data-toaster-class="gatsby-code-button-toaster"
              data-toaster-text-class="gatsby-code-button-toaster-text"
              data-toaster-text="复制成功"
              data-toaster-duration="3500"
              onClick="copyToClipboard(`class TaskQueue{
  public:
  Task takeTask(); // 取出队列头部的一个任务
  void pushTask(Task task); // 添加一个任务到队列尾部
};`, `40814211050762280000`)"
            >
              <div
                class="gatsby-code-button"
                
              >
                cpp 复制代码
              </div>
            </div>
<div class="gatsby-highlight" data-language="cpp"><pre style="counter-reset: linenumber NaN" class="language-cpp line-numbers"><code class="language-cpp"><span class="token keyword">class</span> <span class="token class-name">TaskQueue</span><span class="token punctuation">{</span>
  <span class="token keyword">public</span><span class="token operator">:</span>
  Task <span class="token function">takeTask</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 取出队列头部的一个任务</span>
  <span class="token keyword">void</span> <span class="token function">pushTask</span><span class="token punctuation">(</span>Task task<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 添加一个任务到队列尾部</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>接下来，改造主线程，让主线程从队列中读取任务：</p>
<div
              class="gatsby-code-button-container"
              data-toaster-id="34335564412591178000"
              data-toaster-class="gatsby-code-button-toaster"
              data-toaster-text-class="gatsby-code-button-toaster-text"
              data-toaster-text="复制成功"
              data-toaster-duration="3500"
              onClick="copyToClipboard(`TaskQueue task_queue；
void ProcessTask();
void MainThread(){
  for(;;){
    Task task = task_queue.takeTask();
    ProcessTask(task);
  }
}`, `34335564412591178000`)"
            >
              <div
                class="gatsby-code-button"
                
              >
                cpp 复制代码
              </div>
            </div>
<div class="gatsby-highlight" data-language="cpp"><pre style="counter-reset: linenumber NaN" class="language-cpp line-numbers"><code class="language-cpp">TaskQueue task_queue；
<span class="token keyword">void</span> <span class="token function">ProcessTask</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">MainThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token punctuation">;</span><span class="token punctuation">;</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    Task task <span class="token operator">=</span> task_queue<span class="token punctuation">.</span><span class="token function">takeTask</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">ProcessTask</span><span class="token punctuation">(</span>task<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>在上面的代码中，我们添加了一个消息队列的对象，然后在主线程的 for 循环代码块中，从消息队列中读取一个任务，然后执行该任务，主线程就这样一直循环往下执行，因此只要消息队列中有任务，主线程就会去执行。</p>
<p>主线程的代码就这样改造完成了。这样改造后，主线程执行的任务都全部从消息队列中获取。所以如果有其他线程想要发送任务让主线程去执行，只需要将任务添加到该消息队列中就可以了，添加任务的代码如下：</p>
<div
              class="gatsby-code-button-container"
              data-toaster-id="93677938094949290000"
              data-toaster-class="gatsby-code-button-toaster"
              data-toaster-text-class="gatsby-code-button-toaster-text"
              data-toaster-text="复制成功"
              data-toaster-duration="3500"
              onClick="copyToClipboard(`Task clickTask;
task_queue.pushTask(clickTask)`, `93677938094949290000`)"
            >
              <div
                class="gatsby-code-button"
                
              >
                cpp 复制代码
              </div>
            </div>
<div class="gatsby-highlight" data-language="cpp"><pre style="counter-reset: linenumber NaN" class="language-cpp line-numbers"><code class="language-cpp">Task clickTask<span class="token punctuation">;</span>
task_queue<span class="token punctuation">.</span><span class="token function">pushTask</span><span class="token punctuation">(</span>clickTask<span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>
<p>由于是多个线程操作同一个消息队列，所以在添加任务和取出任务时还会加上一个同步锁，这块内容也要注意下。</p>
<h2 id="处理其他进程发送过来的任务"><a href="#%E5%A4%84%E7%90%86%E5%85%B6%E4%BB%96%E8%BF%9B%E7%A8%8B%E5%8F%91%E9%80%81%E8%BF%87%E6%9D%A5%E7%9A%84%E4%BB%BB%E5%8A%A1" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>处理其他进程发送过来的任务</h2>
<p>通过使用消息队列，我们实现了线程之间的消息通信。在 Chrome 中，跨进程之间的任务也是频繁发生的，那么如何处理其他进程发送过来的任务？你可以参考下图：</p>
<p>
  <a
    class="gatsby-resp-image-link"
    href="/static/2021-07-05-15-38-28-02da4c333940e73b4389e085ab5e2544-794d5.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
  
  <span
    class="gatsby-resp-image-wrapper"
    style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;"
  >
    <span
      class="gatsby-resp-image-background-image"
      style="padding-bottom: 78.69986168741356%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAIAAACZeshMAAAACXBIWXMAAA7DAAAOwwHHb6hkAAACW0lEQVQoz3VSX0/UQBC/r+mn0BD1RT6A8VkUE1+RBDlPxb9vEKIi+CD2jt5xd3CAR6+93Xa32223+9dpGwgQmUw2s7P7m5nfzLSklEVRlJUIVausT5HzJEYpJY1TSeEHxTQurC6LUoqyNMa0OOeUpkJkeani3CS5ibmmwk5Rurvf743OksIyoX+eqqUd8Xhbfu9Nx7/3DrtdDeAsy3CcnIy++QHr9N1G37yvdWNgP43dx2HlaffMvc/SOffr3C5+oRmehbOZUqqV5zkkt0a7WuylWmuMNdZqW/lXPfV0T610bR9Vdygb+LaAMFy0sVCGsdfg10I5t3/CD7wJ2BBRCFGBoWyEcUFIyRieHL36MX62dfRye/R8c7i0OXqxBTpc3p4sbx2u7Y7TkV+SJC+gqXVmxlgYRZJSFfzFfvfJ18HC28GjdwcL7e7d9d7DTu8B6Mbwfttb/DA4n85cSgoBVddg4AzU4S5FEROC5pHVMktpgiKnJSMJiZGW8JqDQk6gCfzKq5xtRcqFYZRQCkaEMElZY1CWVU2B/l10FOQ/YJpgzlIwGE1yXoEZiXnGGpQy7jw19ccLMIUVYbzk0c44WtlXa3/yjq/bvnrtiQ5M+ECteeKNr8GG8856uepVQy3EBRghHAbjk+kEZfo0JEfTeZDwIOYhKUDPInocxGHCz3De8djxPIdthRlVS9LwaMo2WqYkTnAE7YJlrqhKkaUEnDwlrqn4irQuLeghdBNjjBCCnWuIwSyi+XwWhs1QnLsWoXU1kq4FPsHZdPGG59bMN6JEEaSsBDbR3SL/AGN0f51WcJ54AAAAAElFTkSuQmCC'); background-size: cover; display: block;"
    >
      <img
        class="gatsby-resp-image-image"
        style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;"
        alt="2021 07 05 15 38 28"
        title=""
        src="/static/2021-07-05-15-38-28-02da4c333940e73b4389e085ab5e2544-fee1c.png"
        srcset="/static/2021-07-05-15-38-28-02da4c333940e73b4389e085ab5e2544-a67b7.png 200w,
/static/2021-07-05-15-38-28-02da4c333940e73b4389e085ab5e2544-0b187.png 400w,
/static/2021-07-05-15-38-28-02da4c333940e73b4389e085ab5e2544-fee1c.png 800w,
/static/2021-07-05-15-38-28-02da4c333940e73b4389e085ab5e2544-b1a91.png 1200w,
/static/2021-07-05-15-38-28-02da4c333940e73b4389e085ab5e2544-794d5.png 1446w"
        sizes="(max-width: 800px) 100vw, 800px"
      />
    </span>
  </span>
  
  </a>
    </p>
<p>从图中可以看出，渲染进程专门有一个 IO 线程用来接收其他进程传进来的消息，接收到消息之后，会将这些消息组装成任务发送给渲染主线程，后续的步骤就和前面讲解的“处理其他线程发送的任务”一样了，这里就不再重复了。</p>
<h2 id="消息队列中的任务类型"><a href="#%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97%E4%B8%AD%E7%9A%84%E4%BB%BB%E5%8A%A1%E7%B1%BB%E5%9E%8B" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>消息队列中的任务类型</h2>
<p>现在你知道页面主线程是如何接收外部任务的了，那接下来我们再来看看消息队列中的任务类型有哪些。你可以参考下 Chromium 的<a href="https://cs.chromium.org/chromium/src/third_party/blink/public/platform/task_type.h" target="_blank" rel="nofollow noreferrer noopener">官方源码</a>，这里面包含了很多内部消息类型，如输入事件（鼠标滚动、点击、移动）、微任务、文件读写、WebSocket、JavaScript 定时器等等。</p>
<p>除此之外，消息队列中还包含了很多与页面相关的事件，如 JavaScript 执行、解析 DOM、样式计算、布局计算、CSS 动画等。</p>
<p>以上这些事件都是在主线程中执行的，所以在编写 Web 应用时，你还需要衡量这些事件所占用的时长，并想办法解决单个任务占用主线程过久的问题。</p>
<h2 id="如何安全退出"><a href="#%E5%A6%82%E4%BD%95%E5%AE%89%E5%85%A8%E9%80%80%E5%87%BA" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>如何安全退出</h2>
<p>当页面主线程执行完成之后，又该如何保证页面主线程能够安全退出呢？Chrome 是这样解决的，确定要退出当前页面时，页面主线程会设置一个退出标志的变量，在每次执行完一个任务时，判断是否有设置退出标志。</p>
<p>如果设置了，那么就直接中断当前的所有任务，退出线程，你可以参考下面代码：</p>
<div
              class="gatsby-code-button-container"
              data-toaster-id="97569735340406550000"
              data-toaster-class="gatsby-code-button-toaster"
              data-toaster-text-class="gatsby-code-button-toaster-text"
              data-toaster-text="复制成功"
              data-toaster-duration="3500"
              onClick="copyToClipboard(`TaskQueue task_queue；
void ProcessTask();
bool keep_running = true;
void MainThread() {
  for(;;){
    Task task = task_queue.takeTask();
    ProcessTask(task);
    if(!keep_running) // 如果设置了退出标志，那么直接退出线程循环
      break;
  }
}`, `97569735340406550000`)"
            >
              <div
                class="gatsby-code-button"
                
              >
                cpp 复制代码
              </div>
            </div>
<div class="gatsby-highlight" data-language="cpp"><pre style="counter-reset: linenumber NaN" class="language-cpp line-numbers"><code class="language-cpp">TaskQueue task_queue；
<span class="token keyword">void</span> <span class="token function">ProcessTask</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">bool</span> keep_running <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">MainThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token punctuation">;</span><span class="token punctuation">;</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    Task task <span class="token operator">=</span> task_queue<span class="token punctuation">.</span><span class="token function">takeTask</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">ProcessTask</span><span class="token punctuation">(</span>task<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>keep_running<span class="token punctuation">)</span> <span class="token comment">// 如果设置了退出标志，那么直接退出线程循环</span>
      <span class="token keyword">break</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<h2 id="页面使用单线程的缺点"><a href="#%E9%A1%B5%E9%9D%A2%E4%BD%BF%E7%94%A8%E5%8D%95%E7%BA%BF%E7%A8%8B%E7%9A%84%E7%BC%BA%E7%82%B9" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>页面使用单线程的缺点</h2>
<p>上面讲述的就是页面线程的循环系统是如何工作的，那接下来，我们继续探讨页面线程的一些特征。</p>
<p>通过上面的介绍，你应该清楚了，页面线程所有执行的任务都来自于消息队列。消息队列是“先进先出”的属性，也就是说放入队列中的任务，需要等待前面的任务被执行完，才会被执行。鉴于这个属性，就有如下两个问题需要解决。</p>
<h3 id="如何处理高优先级的任务"><a href="#%E5%A6%82%E4%BD%95%E5%A4%84%E7%90%86%E9%AB%98%E4%BC%98%E5%85%88%E7%BA%A7%E7%9A%84%E4%BB%BB%E5%8A%A1" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>如何处理高优先级的任务</h3>
<p>比如一个典型的场景是监控 DOM 节点的变化情况（节点的插入、修改、删除等动态变化），然后根据这些变化来处理相应的业务逻辑。一个通用的设计的是，利用 JavaScript 设计一套监听接口，当变化发生时，渲染引擎同步调用这些接口，这是一个典型的观察者模式。</p>
<p>不过这个模式有个问题，因为 DOM 变化非常频繁，如果每次发生变化的时候，都直接调用相应的 JavaScript 接口，那么这个当前的任务执行时间会被拉长，从而导致执行效率的下降。</p>
<p>如果将这些 DOM 变化做成异步的消息事件，添加到消息队列的尾部，那么又会影响到监控的实时性，因为在添加到消息队列的过程中，可能前面就有很多任务在排队了。</p>
<p>这也就是说，如果 DOM 发生变化，采用同步通知的方式，会影响当前任务的执行效率；如果采用异步方式，又会影响到监控的实时性</p>
<p>那该如何权衡效率和实时性呢？</p>
<p>针对这种情况，微任务就应用而生了，下面我们来看看微任务是如何权衡效率和实时性的。</p>
<p>通常我们把消息队列中的任务称为宏任务，每个宏任务中都包含了一个微任务队列，在执行宏任务的过程中，如果 DOM 有变化，那么就会将该变化添加到微任务列表中，这样就不会影响到宏任务的继续执行，因此也就解决了执行效率的问题。</p>
<p>等宏任务中的主要功能都直接完成之后，这时候，渲染引擎并不着急去执行下一个宏任务，而是执行当前宏任务中的微任务，因为 DOM 变化的事件都保存在这些微任务队列中，这样也就解决了实时性问题。</p>
<h3 id="如何解决单个任务执行时长过久的问题"><a href="#%E5%A6%82%E4%BD%95%E8%A7%A3%E5%86%B3%E5%8D%95%E4%B8%AA%E4%BB%BB%E5%8A%A1%E6%89%A7%E8%A1%8C%E6%97%B6%E9%95%BF%E8%BF%87%E4%B9%85%E7%9A%84%E9%97%AE%E9%A2%98" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>如何解决单个任务执行时长过久的问题</h3>
<p>因为所有的任务都是在单线程中执行的，所以每次只能执行一个任务，而其他任务就都处于等待状态。如果其中一个任务执行时间过久，那么下一个任务就要等待很长时间。可以参考下图：</p>
<p>
  <a
    class="gatsby-resp-image-link"
    href="/static/2021-07-05-15-40-26-fbe86c8a14dcdaf3adaf8d1ce8e6c092-e7341.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
  
  <span
    class="gatsby-resp-image-wrapper"
    style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;"
  >
    <span
      class="gatsby-resp-image-background-image"
      style="padding-bottom: 52.22052067381316%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAIAAAA7N+mxAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABQUlEQVQoz5VQa0vCUBjejy36IkIfhKAgocCoP9CXoCK6fFogpMYSxUg3DWKgYm4MraPn5BzbnCv1XDpraXSvw8N7Xp7zPOe9COwPh0xB3/PCTyYaiEeuA04O4OEe2N95MnsvNP3dHIp8BPWVmB6LqpF5r2UEPCHfmkMPjwRjnjwiqC0t1qML9cjc1+ZZJ5/btpqNByltlWUrnx07TigO5W+V+X+OZZqoa0Jg2xa6qdjiMRSPtN1tlDp1Msl+23A9x7V6GE9eK/Pu+NUyKrBvFqtAkmu569ucamTF89L6ViaeSMU3MqsJeW2zkL4sVO+UWlvtjM6aZDimAiHBYFojr3V7cocpgMr3VAGsBNhVlykogIxYEXKG87QMqKTj5Ytxx6UC+//hA9MPC+MUmWKCydD3B5438IYcPMeEzl7DbfHwDK/qLvi4DRj8AAAAAElFTkSuQmCC'); background-size: cover; display: block;"
    >
      <img
        class="gatsby-resp-image-image"
        style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;"
        alt="2021 07 05 15 40 26"
        title=""
        src="/static/2021-07-05-15-40-26-fbe86c8a14dcdaf3adaf8d1ce8e6c092-fee1c.png"
        srcset="/static/2021-07-05-15-40-26-fbe86c8a14dcdaf3adaf8d1ce8e6c092-a67b7.png 200w,
/static/2021-07-05-15-40-26-fbe86c8a14dcdaf3adaf8d1ce8e6c092-0b187.png 400w,
/static/2021-07-05-15-40-26-fbe86c8a14dcdaf3adaf8d1ce8e6c092-fee1c.png 800w,
/static/2021-07-05-15-40-26-fbe86c8a14dcdaf3adaf8d1ce8e6c092-b1a91.png 1200w,
/static/2021-07-05-15-40-26-fbe86c8a14dcdaf3adaf8d1ce8e6c092-e7341.png 1306w"
        sizes="(max-width: 800px) 100vw, 800px"
      />
    </span>
  </span>
  
  </a>
    </p>
<p>从图中你可以看到，如果在执行动画过程中，其中有个 JavaScript 任务因执行时间过久，占用了动画单帧的时间，这样会给用户制造了卡顿的感觉，这当然是极不好的用户体验。针对这种情况，JavaScript 可以通过回调功能来规避这种问题，也就是让要执行的 JavaScript 任务滞后执行。至于浏览器是如何实现回调功能的，我们在后面的章节中再详细介绍。</p>
<h2 id="实践：浏览器页面是如何运行的"><a href="#%E5%AE%9E%E8%B7%B5%EF%BC%9A%E6%B5%8F%E8%A7%88%E5%99%A8%E9%A1%B5%E9%9D%A2%E6%98%AF%E5%A6%82%E4%BD%95%E8%BF%90%E8%A1%8C%E7%9A%84" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>实践：浏览器页面是如何运行的</h2>
<p>有了上面的基础知识之后，我们最后来看看浏览器的页面是如何运行的。</p>
<p>你可以打开开发者工具，点击“Performance”标签，选择左上角的“start porfiling and load page”来记录整个页面加载过程中的事件执行情况，如下图所示：</p>
<p>
  <a
    class="gatsby-resp-image-link"
    href="/static/2021-07-05-15-40-55-fe1a25c4b0d62bf2788fbf2f76146412-604fe.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
  
  <span
    class="gatsby-resp-image-wrapper"
    style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;"
  >
    <span
      class="gatsby-resp-image-background-image"
      style="padding-bottom: 68.09338521400778%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAIAAACgpqunAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABwUlEQVQoz32SaW+bQBCG/f//UKV8y4ekquTa5jAOMTc+MDbgZS+Ohe3s2jhK02b06GUG5t0RMDOMMaXkRl1jQlTCGOWcQXDOu64FHgEpPBJCSClngR/EcZIm+yTZbb04DKIk2afpIYpiP4QqCqM4CEGiOI6UprHnvWNcK7PtrpeOtVwvTde0t5a9NW84/toJ1rZna5xN6LxFoHDHXL0taqLN75sXz/2ZXcq8KEpUn4rS2u42Uf4yN55ff63M1W/Lni9eDWNuGAvLNo95djz4bdcr8wmdzuTS9pK1I29BJaID5jLdFX6Q5Vl1KcpznoRL331y9ouUtQMmTdO0ykyaAWy0GR5wdcrYDbIfZdMrOimLQ+0+bTLjxHuJuYAPp8zQzZpPZno/ThAudCm4kMURrX9YuXthnWoeRjlN1h2aYdJPwLTyhJN5gs5MN3+YR5ijkVMy8k4pnUqdSEoEJj3rJJR3c3XF1yuqqmsFqpOyAkVqXyiDDarht+CJmmCluO/1kiBUEYxwXTGKH3AGEIBpOCwco0wr5yq5b9j5UgoB7/BXyOkqxy9xf2Mw92KQX0K7lN4m/C9m/3QihK46yrL8xvwHgEMaMgvgciAAAAAASUVORK5CYII='); background-size: cover; display: block;"
    >
      <img
        class="gatsby-resp-image-image"
        style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;"
        alt="2021 07 05 15 40 55"
        title=""
        src="/static/2021-07-05-15-40-55-fe1a25c4b0d62bf2788fbf2f76146412-fee1c.png"
        srcset="/static/2021-07-05-15-40-55-fe1a25c4b0d62bf2788fbf2f76146412-a67b7.png 200w,
/static/2021-07-05-15-40-55-fe1a25c4b0d62bf2788fbf2f76146412-0b187.png 400w,
/static/2021-07-05-15-40-55-fe1a25c4b0d62bf2788fbf2f76146412-fee1c.png 800w,
/static/2021-07-05-15-40-55-fe1a25c4b0d62bf2788fbf2f76146412-b1a91.png 1200w,
/static/2021-07-05-15-40-55-fe1a25c4b0d62bf2788fbf2f76146412-604fe.png 1542w"
        sizes="(max-width: 800px) 100vw, 800px"
      />
    </span>
  </span>
  
  </a>
    </p>
<p>从图中可以看出，我们点击展开了 Main 这个项目，其记录了主线程执行过程中的所有任务。图中灰色的就是一个个任务，每个任务下面还有子任务，其中的 Parse HTML 任务，是把 HTML 解析为 DOM 的任务。值得注意的是，在执行 Parse HTML 的时候，如果遇到 JavaScript 脚本，那么会暂停当前的 HTML 解析而去执行 JavaScript 脚本。</p>
<p>至于 Performance 工具，在后面的章节中我们还会详细介绍，在这里你只需要建立一个直观的印象就可以了。</p>
<h2 id="总结"><a href="#%E6%80%BB%E7%BB%93" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>总结</h2>
<ul>
<li>如果有一些确定好的任务，可以使用一个单线程来按照顺序处理这些任务，这是第一版线程模型。</li>
<li>要在线程执行过程中接收并处理新的任务，就需要引入循环语句和事件系统，这是第二版线程模型。</li>
<li>如果要接收其他线程发送过来的任务，就需要引入消息队列，这是第三版线程模型。</li>
<li>如果其他进程想要发送任务给页面主线程，那么先通过 IPC 把任务发送给渲染进程的 IO 线程，IO 线程再把任务发送给页面主线程。</li>
<li>消息队列机制并不是太灵活，为了适应效率和实时性，引入了微任务</li>
</ul>
<p>基于消息队列的设计是目前使用最广的消息架构，无论是安卓还是 Chrome 都采用了类似的任务机制，所以理解了本篇文章的内容后，你再理解其他项目的任务机制也会比较轻松。</p>
<h1 id="webapi：settimeout-是怎么实现的"><a href="#webapi%EF%BC%9Asettimeout-%E6%98%AF%E6%80%8E%E4%B9%88%E5%AE%9E%E7%8E%B0%E7%9A%84" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Webapi：setTimeout 是怎么实现的</h1>
<p>本篇文章主要介绍的是 setTimeout。其实说起 setTimeout 方法，从事开发的同学想必都不会陌生，它就是一个定时器，用来指定某个函数在多少毫秒之后执行。它会返回一个整数，表示定时器的编号，同时你还可以通过该编号来取消这个定时器。下面的示例代码就演示了定时器最基础的使用方式：</p>
<div
              class="gatsby-code-button-container"
              data-toaster-id="99074114387711050000"
              data-toaster-class="gatsby-code-button-toaster"
              data-toaster-text-class="gatsby-code-button-toaster-text"
              data-toaster-text="复制成功"
              data-toaster-duration="3500"
              onClick="copyToClipboard(`function showName() {
  console.log('极客时间');
}
var timerID = setTimeout(showName, 200);`, `99074114387711050000`)"
            >
              <div
                class="gatsby-code-button"
                
              >
                js 复制代码
              </div>
            </div>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">function</span> <span class="token function">showName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'极客时间'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">var</span> timerID <span class="token operator">=</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span>showName<span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>
<p>执行上述代码，输出的结果也很明显，通过 setTimeout 指定在 200 毫秒之后调用 showName 函数，并输出“极客时间”四个字。</p>
<p>简单了解了 setTimeout 的使用方法后，那接下来我们就来看看浏览器是如何实现定时器的，然后再介绍下定时器在使用过程中的一些注意事项</p>
<h2 id="浏览器怎么实现-settimeout"><a href="#%E6%B5%8F%E8%A7%88%E5%99%A8%E6%80%8E%E4%B9%88%E5%AE%9E%E7%8E%B0-settimeout" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>浏览器怎么实现 setTimeout</h2>
<p>要了解定时器的工作原理，就得先来回顾下之前讲的事件循环系统，我们知道渲染进程中所有运行在主线程上的任务都需要先添加到消息队列，然后事件循环系统再按照顺序执行消息队列中的任务。下面我们来看看那些典型的事件</p>
<ul>
<li>当接收到 HTML 文档数据，渲染引擎就会将“解析 DOM”事件添加到消息队列中，</li>
<li>当用户改变了 Web 页面的窗口大小，渲染引擎就会将“重新布局”的事件添加到消息队列中。</li>
<li>当触发了 JavaScript 引擎垃圾回收机制，渲染引擎会将“垃圾回收”任务添加到消息队列中。</li>
<li>同样，如果要执行一段异步 JavaScript 代码，也是需要将执行任务添加到消息队列中</li>
</ul>
<p>以上列举的只是一小部分事件，这些事件被添加到消息队列之后，事件循环系统就会按照消息队列中的顺序来执行事件。</p>
<p>所以说要执行一段异步任务，需要先将任务添加到消息队列中。不过通过定时器设置回调函数有点特别，它们需要在指定的时间间隔内被调用，但消息队列中的任务是按照顺序执行的，所以为了保证回调函数能在指定时间内执行，你不能将定时器的回调函数直接添加到消息队列中。</p>
<p>那么该怎么设计才能让定时器设置的回调事件在规定时间内被执行呢？你也可以思考下，如果让你在消息循环系统的基础之上加上定时器的功能，你会如何设计？</p>
<p>在 Chrome 中除了正常使用的消息队列之外，还有另外一个消息队列，这个队列中维护了需要延迟执行的任务列表，包括了定时器和 Chromium 内部一些需要延迟执行的任务。所以当通过 JavaScript 创建一个定时器时，渲染进程会将该定时器的回调任务添加到延迟队列中</p>
<p>源码中延迟执行队列的定义如下所示：</p>
<div
              class="gatsby-code-button-container"
              data-toaster-id="84595980445958570000"
              data-toaster-class="gatsby-code-button-toaster"
              data-toaster-text-class="gatsby-code-button-toaster-text"
              data-toaster-text="复制成功"
              data-toaster-duration="3500"
              onClick="copyToClipboard(`DelayedIncomingQueue delayed_incoming_queue;`, `84595980445958570000`)"
            >
              <div
                class="gatsby-code-button"
                
              >
                cpp 复制代码
              </div>
            </div>
<div class="gatsby-highlight" data-language="cpp"><pre style="counter-reset: linenumber NaN" class="language-cpp line-numbers"><code class="language-cpp">DelayedIncomingQueue delayed_incoming_queue<span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>
<p>当通过 JavaScript 调用 setTimeout 设置回调函数的时候，渲染进程将会创建一个回调任务，包含了回调函数 showName、当前发起时间、延迟执行时间，其模拟代码如下所示：</p>
<div
              class="gatsby-code-button-container"
              data-toaster-id="52528996960828424000"
              data-toaster-class="gatsby-code-button-toaster"
              data-toaster-text-class="gatsby-code-button-toaster-text"
              data-toaster-text="复制成功"
              data-toaster-duration="3500"
              onClick="copyToClipboard(`struct DelayTask{
  int64 id；
  CallBackFunction cbf;
  int start_time;
  int delay_time;
};
DelayTask timerTask;
timerTask.cbf = showName;
timerTask.start_time = getCurrentTime(); // 获取当前时间
timerTask.delay_time = 200; // 设置延迟执行时间`, `52528996960828424000`)"
            >
              <div
                class="gatsby-code-button"
                
              >
                cpp 复制代码
              </div>
            </div>
<div class="gatsby-highlight" data-language="cpp"><pre style="counter-reset: linenumber NaN" class="language-cpp line-numbers"><code class="language-cpp"><span class="token keyword">struct</span> <span class="token class-name">DelayTask</span><span class="token punctuation">{</span>
  int64 id；
  CallBackFunction cbf<span class="token punctuation">;</span>
  <span class="token keyword">int</span> start_time<span class="token punctuation">;</span>
  <span class="token keyword">int</span> delay_time<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
DelayTask timerTask<span class="token punctuation">;</span>
timerTask<span class="token punctuation">.</span>cbf <span class="token operator">=</span> showName<span class="token punctuation">;</span>
timerTask<span class="token punctuation">.</span>start_time <span class="token operator">=</span> <span class="token function">getCurrentTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 获取当前时间</span>
timerTask<span class="token punctuation">.</span>delay_time <span class="token operator">=</span> <span class="token number">200</span><span class="token punctuation">;</span> <span class="token comment">// 设置延迟执行时间</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>创建好回调任务之后，再将该任务添加到延迟执行队列中，代码如下所示：</p>
<div
              class="gatsby-code-button-container"
              data-toaster-id="85238204109529020000"
              data-toaster-class="gatsby-code-button-toaster"
              data-toaster-text-class="gatsby-code-button-toaster-text"
              data-toaster-text="复制成功"
              data-toaster-duration="3500"
              onClick="copyToClipboard(`delayed_incoming_queue.push(timerTask);`, `85238204109529020000`)"
            >
              <div
                class="gatsby-code-button"
                
              >
                cpp 复制代码
              </div>
            </div>
<div class="gatsby-highlight" data-language="cpp"><pre style="counter-reset: linenumber NaN" class="language-cpp line-numbers"><code class="language-cpp">delayed_incoming_queue<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>timerTask<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>
<p>现在通过定时器发起的任务就被保存到延迟队列中了，那接下来我们再来看看消息循环系统是怎么触发延迟队列的。</p>
<p>我们可以来完善上一篇文章中消息循环的代码，在其中加入执行延迟队列的代码，如下所示</p>
<div
              class="gatsby-code-button-container"
              data-toaster-id="89510031744191250000"
              data-toaster-class="gatsby-code-button-toaster"
              data-toaster-text-class="gatsby-code-button-toaster-text"
              data-toaster-text="复制成功"
              data-toaster-duration="3500"
              onClick="copyToClipboard(`void ProcessTimerTask(){
  // 从 delayed_incoming_queue 中取出已经到期的定时器任务
  // 依次执行这些任务
}

TaskQueue task_queue；
void ProcessTask();
bool keep_running = true;
void MainTherad(){
  for(;;){
    // 执行消息队列中的任务
    Task task = task_queue.takeTask();
    ProcessTask(task);

    // 执行延迟队列中的任务
    ProcessDelayTask()

    if(!keep_running) // 如果设置了退出标志，那么直接退出线程循环
        break;
  }
}`, `89510031744191250000`)"
            >
              <div
                class="gatsby-code-button"
                
              >
                cpp 复制代码
              </div>
            </div>
<div class="gatsby-highlight" data-language="cpp"><pre style="counter-reset: linenumber NaN" class="language-cpp line-numbers"><code class="language-cpp"><span class="token keyword">void</span> <span class="token function">ProcessTimerTask</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token comment">// 从 delayed_incoming_queue 中取出已经到期的定时器任务</span>
  <span class="token comment">// 依次执行这些任务</span>
<span class="token punctuation">}</span>

TaskQueue task_queue；
<span class="token keyword">void</span> <span class="token function">ProcessTask</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">bool</span> keep_running <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">MainTherad</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token punctuation">;</span><span class="token punctuation">;</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">// 执行消息队列中的任务</span>
    Task task <span class="token operator">=</span> task_queue<span class="token punctuation">.</span><span class="token function">takeTask</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">ProcessTask</span><span class="token punctuation">(</span>task<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 执行延迟队列中的任务</span>
    <span class="token function">ProcessDelayTask</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>keep_running<span class="token punctuation">)</span> <span class="token comment">// 如果设置了退出标志，那么直接退出线程循环</span>
        <span class="token keyword">break</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>从上面代码可以看出来，我们添加了一个 ProcessDelayTask 函数，该函数是专门用来处理延迟执行任务的。这里我们要重点关注它的执行时机，在上段代码中，处理完消息队列中的一个任务之后，就开始执行 ProcessDelayTask 函数。ProcessDelayTask 函数会根据发起时间和延迟时间计算出到期的任务，然后依次执行这些到期的任务。等到期的任务执行完成之后，再继续下一个循环过程。通过这样的方式，一个完整的定时器就实现了。</p>
<p>设置一个定时器，JavaScript 引擎会返回一个定时器的 ID。那通常情况下，当一个定时器的任务还没有被执行的时候，也是可以取消的，具体方法是调用 clearTimeout 函数，并传入需要取消的定时器的 ID。如下面代码所示：</p>
<div
              class="gatsby-code-button-container"
              data-toaster-id="19548283328464056000"
              data-toaster-class="gatsby-code-button-toaster"
              data-toaster-text-class="gatsby-code-button-toaster-text"
              data-toaster-text="复制成功"
              data-toaster-duration="3500"
              onClick="copyToClipboard(`clearTimeout(timer_id)`, `19548283328464056000`)"
            >
              <div
                class="gatsby-code-button"
                
              >
                cpp 复制代码
              </div>
            </div>
<div class="gatsby-highlight" data-language="cpp"><pre style="counter-reset: linenumber NaN" class="language-cpp line-numbers"><code class="language-cpp"><span class="token function">clearTimeout</span><span class="token punctuation">(</span>timer_id<span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>
<p>其实浏览器内部实现取消定时器的操作也是非常简单的，就是直接从 <code class="language-text">delayed_incoming_queue</code> 延迟队列中，通过 ID 查找到对应的任务，然后再将其从队列中删除掉就可以了。</p>
<h2 id="使用-settimeout-的一些注意事项"><a href="#%E4%BD%BF%E7%94%A8-settimeout-%E7%9A%84%E4%B8%80%E4%BA%9B%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>使用 setTimeout 的一些注意事项</h2>
<p>现在你应该知道在浏览器内部定时器是如何工作的了。不过在使用定时器的过程中，如果你不了解定时器的一些细节，那么很有可能掉进定时器的一些陷阱里。所以接下来，我们就来讲解一下在使用定时器过程中存在的那些陷阱。</p>
<h3 id="如果当前任务执行时间过久，会影延迟到期定时器任务的执行"><a href="#%E5%A6%82%E6%9E%9C%E5%BD%93%E5%89%8D%E4%BB%BB%E5%8A%A1%E6%89%A7%E8%A1%8C%E6%97%B6%E9%97%B4%E8%BF%87%E4%B9%85%EF%BC%8C%E4%BC%9A%E5%BD%B1%E5%BB%B6%E8%BF%9F%E5%88%B0%E6%9C%9F%E5%AE%9A%E6%97%B6%E5%99%A8%E4%BB%BB%E5%8A%A1%E7%9A%84%E6%89%A7%E8%A1%8C" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>如果当前任务执行时间过久，会影延迟到期定时器任务的执行</h3>
<p>在使用 setTimeout 的时候，有很多因素会导致回调函数执行比设定的预期值要久，其中一个就是当前任务执行时间过久从而导致定时器设置的任务被延后执行。我们先看下面这段代码：</p>
<div
              class="gatsby-code-button-container"
              data-toaster-id="18080992972020015000"
              data-toaster-class="gatsby-code-button-toaster"
              data-toaster-text-class="gatsby-code-button-toaster-text"
              data-toaster-text="复制成功"
              data-toaster-duration="3500"
              onClick="copyToClipboard(`function bar() {
  console.log('bar');
}
function foo() {
  setTimeout(bar, 0);
  for (let i = 0; i < 5000; i++) {
    let i = 5 + 8 + 8 + 8;
    console.log(i);
  }
}
foo();`, `18080992972020015000`)"
            >
              <div
                class="gatsby-code-button"
                
              >
                js 复制代码
              </div>
            </div>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">function</span> <span class="token function">bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'bar'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">setTimeout</span><span class="token punctuation">(</span>bar<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">5000</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">5</span> <span class="token operator">+</span> <span class="token number">8</span> <span class="token operator">+</span> <span class="token number">8</span> <span class="token operator">+</span> <span class="token number">8</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>这段代码中，在执行 foo 函数的时候使用 setTimeout 设置了一个 0 延时的回调任务，设置好回调任务后，foo 函数会继续执行 5000 次 for 循环。</p>
<p>通过 setTimeout 设置的回调任务被放入了消息队列中并且等待下一次执行，这里并不是立即执行的；要执行消息队列中的下个任务，需要等待当前的任务执行完成，由于当前这段代码要执行 5000 次的 for 循环，所以当前这个任务的执行时间会比较久一点。这势必会影响到下个任务的执行时间。</p>
<p>你也可以打开 Performance 来看看其执行过程，如下图所示：</p>
<p>
  <a
    class="gatsby-resp-image-link"
    href="/static/2021-07-06-15-26-14-7bb0e7e6c04df25dfd7d09d82763354e-44aed.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
  
  <span
    class="gatsby-resp-image-wrapper"
    style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;"
  >
    <span
      class="gatsby-resp-image-background-image"
      style="padding-bottom: 49.67741935483871%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAIAAAA7N+mxAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAByElEQVQoz2P4+fPn9eu3rl69ef3Grdu3boMAiLyDYCMEQeSdO3dv37n7/fuP////Mzx9+qS5Mm1ye25LdYZfoI+vv7ePn5dfgI+3r6dvgA+QDRTxAzOAsj7+Xt7eTh4uVjdv3gBpfv78eUtTXXdnc3NTXVJyckxsTFx8XExsbGx8XGwcCMXEAYViQWygeHREZu2kggmb7z96BtJ85+5deUUlAUFhYRFRCQkJSTCQgpBgIAkFUlIycqJCvIHVqzNWfrxxD6z5xYtXNeU1jfVNLa2dza3dTS2dDc0dDc0gsh6EOoGosbWrqamtqbG5trLeIrBE2TLm0tVbIM2vX32YWDtxdsfUOR1TZ7VNWtI3e/30JWsmL1g3bcnWOcu2zVywbvLsxd2T53ROW9Azc3L9NE1DVyF583MXwX7+9v3nsTPXjpy6evj4xcNHzx09fuH4iUsnTl48eOxy46Lz1XNOlc062bX05LGTlw6funr01JVzF66du3j969dvIM3/cYP2fb9il31PXPmjbe9vIPffP3QFIM1/0QFU1emHv3de/7n7xs9TD37++4dFBRabf//+/fbt21evXn399Pbzu5ffPr398/s7VqcBACg8m/5TKF3FAAAAAElFTkSuQmCC'); background-size: cover; display: block;"
    >
      <img
        class="gatsby-resp-image-image"
        style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;"
        alt="2021 07 06 15 26 14"
        title=""
        src="/static/2021-07-06-15-26-14-7bb0e7e6c04df25dfd7d09d82763354e-fee1c.png"
        srcset="/static/2021-07-06-15-26-14-7bb0e7e6c04df25dfd7d09d82763354e-a67b7.png 200w,
/static/2021-07-06-15-26-14-7bb0e7e6c04df25dfd7d09d82763354e-0b187.png 400w,
/static/2021-07-06-15-26-14-7bb0e7e6c04df25dfd7d09d82763354e-fee1c.png 800w,
/static/2021-07-06-15-26-14-7bb0e7e6c04df25dfd7d09d82763354e-b1a91.png 1200w,
/static/2021-07-06-15-26-14-7bb0e7e6c04df25dfd7d09d82763354e-44aed.png 1550w"
        sizes="(max-width: 800px) 100vw, 800px"
      />
    </span>
  </span>
  
  </a>
    </p>
<p>从图中可以看到，执行 foo 函数所消耗的时长是 500 毫秒，这也就意味着通过 setTimeout 设置的任务会被推迟到 500 毫秒以后再去执行，而设置 setTimeout 的回调延迟时间是 0。</p>
<h3 id="如果-settimeout-存在嵌套调用，那么系统会设置最短时间间隔为-4-毫秒"><a href="#%E5%A6%82%E6%9E%9C-settimeout-%E5%AD%98%E5%9C%A8%E5%B5%8C%E5%A5%97%E8%B0%83%E7%94%A8%EF%BC%8C%E9%82%A3%E4%B9%88%E7%B3%BB%E7%BB%9F%E4%BC%9A%E8%AE%BE%E7%BD%AE%E6%9C%80%E7%9F%AD%E6%97%B6%E9%97%B4%E9%97%B4%E9%9A%94%E4%B8%BA-4-%E6%AF%AB%E7%A7%92" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>如果 setTimeout 存在嵌套调用，那么系统会设置最短时间间隔为 4 毫秒</h3>
<p>也就是说在定时器函数里面嵌套调用定时器，也会延长定时器的执行时间，可以先看下面的这段代码：</p>
<div
              class="gatsby-code-button-container"
              data-toaster-id="76011835488694120000"
              data-toaster-class="gatsby-code-button-toaster"
              data-toaster-text-class="gatsby-code-button-toaster-text"
              data-toaster-text="复制成功"
              data-toaster-duration="3500"
              onClick="copyToClipboard(`function cb() {
  setTimeout(cb, 0);
}
setTimeout(cb, 0);`, `76011835488694120000`)"
            >
              <div
                class="gatsby-code-button"
                
              >
                js 复制代码
              </div>
            </div>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">function</span> <span class="token function">cb</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">setTimeout</span><span class="token punctuation">(</span>cb<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token function">setTimeout</span><span class="token punctuation">(</span>cb<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>
<p>上述这段代码你有没有看出存在什么问题？</p>
<p>你还是可以通过 Performance 来记录下这段代码的执行过程，如下图所示</p>
<p>
  <a
    class="gatsby-resp-image-link"
    href="/static/2021-07-06-15-27-09-d3fa068a4d0d5ef6fc33dae934bd357a-68b8a.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
  
  <span
    class="gatsby-resp-image-wrapper"
    style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;"
  >
    <span
      class="gatsby-resp-image-background-image"
      style="padding-bottom: 40.07537688442211%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAIAAAB2/0i6AAAACXBIWXMAAA7DAAAOwwHHb6hkAAABiUlEQVQY03WOS0sCURiG3RWmEmnM1JyZ0+Ro2lTaLpK8T7eFLU1nnEydGaVVkxIUBFbQHxCidbZo2T8SpTLX3SB1OmcWbqKXh4/nfPB+HMv9Q3M/KxYVNZ3JlhRV0crp/cxhoahqlUxWlOV8uXIk5mRRyqnlinyQz4iSomrdt65hGJZ6/dLucLjdHAVoFAjnTGGQAEAjIIRogYRhIIKiAMuyrVYLl8+vGgQXWllP0XyC9EbhsuAObsKlJM0n6cUE5Y8TnijpjSEB/gRe8klvINZ9fcbls+vbMXKNDe6SC8IUlyB8woxfcHFJlwchoOnkMNOmT3sFp0eAfOzluYPLFzd347Oh+dU9wO8Svi2K3yF9W6R/e8ZkJCMnFrbRvzods3xab1hsAXRyko1bwYaDidroyAQI25iwnYlgp/HEMBG0sYKIiw21221cbj4+pdLagVqTinpOrcpaTSzoUqkqK9UconQiFhE6Qirp5lPPq8e9Xg+XjT8ZDAbfXx9fn+/9/o8x7BvG0Pgnv/cXvdBpUYdPAAAAAElFTkSuQmCC'); background-size: cover; display: block;"
    >
      <img
        class="gatsby-resp-image-image"
        style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;"
        alt="2021 07 06 15 27 09"
        title=""
        src="/static/2021-07-06-15-27-09-d3fa068a4d0d5ef6fc33dae934bd357a-fee1c.png"
        srcset="/static/2021-07-06-15-27-09-d3fa068a4d0d5ef6fc33dae934bd357a-a67b7.png 200w,
/static/2021-07-06-15-27-09-d3fa068a4d0d5ef6fc33dae934bd357a-0b187.png 400w,
/static/2021-07-06-15-27-09-d3fa068a4d0d5ef6fc33dae934bd357a-fee1c.png 800w,
/static/2021-07-06-15-27-09-d3fa068a4d0d5ef6fc33dae934bd357a-b1a91.png 1200w,
/static/2021-07-06-15-27-09-d3fa068a4d0d5ef6fc33dae934bd357a-68b8a.png 1592w"
        sizes="(max-width: 800px) 100vw, 800px"
      />
    </span>
  </span>
  
  </a>
    </p>
<p>上图中的竖线就是定时器的函数回调过程，从图中可以看出，前面五次调用的时间间隔比较小，嵌套调用超过五次以上，后面每次的调用最小时间间隔是 4 毫秒。之所以出现这样的情况，是因为在 Chrome 中，定时器被嵌套调用 5 次以上，系统会判断该函数方法被阻塞了，如果定时器的调用时间间隔小于 4 毫秒，那么浏览器会将每次调用的时间间隔设置为 4 毫秒。下面是 Chromium 实现 4 毫秒延迟的代码，你可以看下：</p>
<div
              class="gatsby-code-button-container"
              data-toaster-id="29013476552235717000"
              data-toaster-class="gatsby-code-button-toaster"
              data-toaster-text-class="gatsby-code-button-toaster-text"
              data-toaster-text="复制成功"
              data-toaster-duration="3500"
              onClick="copyToClipboard(`static const int kMaxTimerNestingLevel = 5;

// Chromium uses a minimum timer interval of 4ms. We'd like to go
// lower; however, there are poorly coded websites out there which do
// create CPU-spinning loops.  Using 4ms prevents the CPU from
// spinning too busily and provides a balance between CPU spinning and
// the smallest possible interval timer.
static constexpr base::TimeDelta kMinimumInterval = base::TimeDelta::FromMilliseconds(4);`, `29013476552235717000`)"
            >
              <div
                class="gatsby-code-button"
                
              >
                cpp 复制代码
              </div>
            </div>
<div class="gatsby-highlight" data-language="cpp"><pre style="counter-reset: linenumber NaN" class="language-cpp line-numbers"><code class="language-cpp"><span class="token keyword">static</span> <span class="token keyword">const</span> <span class="token keyword">int</span> kMaxTimerNestingLevel <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>

<span class="token comment">// Chromium uses a minimum timer interval of 4ms. We'd like to go</span>
<span class="token comment">// lower; however, there are poorly coded websites out there which do</span>
<span class="token comment">// create CPU-spinning loops.  Using 4ms prevents the CPU from</span>
<span class="token comment">// spinning too busily and provides a balance between CPU spinning and</span>
<span class="token comment">// the smallest possible interval timer.</span>
<span class="token keyword">static</span> <span class="token keyword">constexpr</span> base<span class="token operator">::</span>TimeDelta kMinimumInterval <span class="token operator">=</span> base<span class="token operator">::</span>TimeDelta<span class="token operator">::</span><span class="token function">FromMilliseconds</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<div
              class="gatsby-code-button-container"
              data-toaster-id="24697145563853406000"
              data-toaster-class="gatsby-code-button-toaster"
              data-toaster-text-class="gatsby-code-button-toaster-text"
              data-toaster-text="复制成功"
              data-toaster-duration="3500"
              onClick="copyToClipboard(`base::TimeDelta interval_milliseconds =
      std::max(base::TimeDelta::FromMilliseconds(1), interval);

  if (interval_milliseconds < kMinimumInterval &&
      nesting_level_ >= kMaxTimerNestingLevel)
    interval_milliseconds = kMinimumInterval;

  if (single_shot)
    StartOneShot(interval_milliseconds, FROM_HERE);
  else
    StartRepeating(interval_milliseconds, FROM_HERE);`, `24697145563853406000`)"
            >
              <div
                class="gatsby-code-button"
                
              >
                cpp 复制代码
              </div>
            </div>
<div class="gatsby-highlight" data-language="cpp"><pre style="counter-reset: linenumber NaN" class="language-cpp line-numbers"><code class="language-cpp">base<span class="token operator">::</span>TimeDelta interval_milliseconds <span class="token operator">=</span>
      std<span class="token operator">::</span><span class="token function">max</span><span class="token punctuation">(</span>base<span class="token operator">::</span>TimeDelta<span class="token operator">::</span><span class="token function">FromMilliseconds</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> interval<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>interval_milliseconds <span class="token operator">&lt;</span> kMinimumInterval <span class="token operator">&amp;&amp;</span>
      nesting_level_ <span class="token operator">>=</span> kMaxTimerNestingLevel<span class="token punctuation">)</span>
    interval_milliseconds <span class="token operator">=</span> kMinimumInterval<span class="token punctuation">;</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>single_shot<span class="token punctuation">)</span>
    <span class="token function">StartOneShot</span><span class="token punctuation">(</span>interval_milliseconds<span class="token punctuation">,</span> FROM_HERE<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">else</span>
    <span class="token function">StartRepeating</span><span class="token punctuation">(</span>interval_milliseconds<span class="token punctuation">,</span> FROM_HERE<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>所以，一些实时性较高的需求就不太适合使用 setTimeout 了，比如你用 setTimeout 来实现 JavaScript 动画就不是一个很好的主意。</p>
<h3 id="未激活的页面，settimeout-执行最小间隔是-1000-毫秒"><a href="#%E6%9C%AA%E6%BF%80%E6%B4%BB%E7%9A%84%E9%A1%B5%E9%9D%A2%EF%BC%8Csettimeout-%E6%89%A7%E8%A1%8C%E6%9C%80%E5%B0%8F%E9%97%B4%E9%9A%94%E6%98%AF-1000-%E6%AF%AB%E7%A7%92" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>未激活的页面，setTimeout 执行最小间隔是 1000 毫秒</h3>
<p>除了前面的 4 毫秒延迟，还有一个很容易被忽略的地方，那就是未被激活的页面中定时器最小值大于 1000 毫秒，也就是说，如果标签不是当前的激活标签，那么定时器最小的时间间隔是 1000 毫秒，目的是为了优化后台页面的加载损耗以及降低耗电量。这一点你在使用定时器的时候要注意。</p>
<h3 id="延时执行时间有最大值"><a href="#%E5%BB%B6%E6%97%B6%E6%89%A7%E8%A1%8C%E6%97%B6%E9%97%B4%E6%9C%89%E6%9C%80%E5%A4%A7%E5%80%BC" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>延时执行时间有最大值</h3>
<p>除了要了解定时器的回调函数时间比实际设定值要延后之外，还有一点需要注意下，那就是 Chrome、Safari、Firefox 都是以 32 个 bit 来存储延时值的，32bit 最大只能存放的数字是 2147483647 毫秒，这就意味着，如果 setTimeout 设置的延迟值大于 2147483647 毫秒（大约 24.8 天）时就会溢出，这导致定时器会被立即执行。你可以运行下面这段代码：</p>
<div
              class="gatsby-code-button-container"
              data-toaster-id="10628466206646682000"
              data-toaster-class="gatsby-code-button-toaster"
              data-toaster-text-class="gatsby-code-button-toaster-text"
              data-toaster-text="复制成功"
              data-toaster-duration="3500"
              onClick="copyToClipboard(`function showName() {
  console.log('极客时间');
}
var timerID = setTimeout(showName, 2147483648); // 会被理解调用执行`, `10628466206646682000`)"
            >
              <div
                class="gatsby-code-button"
                
              >
                js 复制代码
              </div>
            </div>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">function</span> <span class="token function">showName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'极客时间'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">var</span> timerID <span class="token operator">=</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span>showName<span class="token punctuation">,</span> <span class="token number">2147483648</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 会被理解调用执行</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>
<p>运行后可以看到，这段代码是立即被执行的。但如果将延时值修改为小于 2147483647 毫秒的某个值，那么执行时就没有问题了。</p>
<h3 id="使用-settimeout-设置的回调函数中的-this-不符合直觉"><a href="#%E4%BD%BF%E7%94%A8-settimeout-%E8%AE%BE%E7%BD%AE%E7%9A%84%E5%9B%9E%E8%B0%83%E5%87%BD%E6%95%B0%E4%B8%AD%E7%9A%84-this-%E4%B8%8D%E7%AC%A6%E5%90%88%E7%9B%B4%E8%A7%89" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>使用 setTimeout 设置的回调函数中的 this 不符合直觉</h3>
<p>如果被 setTimeout 推迟执行的回调函数是某个对象的方法，那么该方法中的 this 关键字将指向全局环境，而不是定义时所在的那个对象。这点在前面介绍 this 的时候也提过，你可以看下面这段代码的执行结果：</p>
<div
              class="gatsby-code-button-container"
              data-toaster-id="88064492062092410000"
              data-toaster-class="gatsby-code-button-toaster"
              data-toaster-text-class="gatsby-code-button-toaster-text"
              data-toaster-text="复制成功"
              data-toaster-duration="3500"
              onClick="copyToClipboard(`var name = 1;
var MyObj = {
  name: 2,
  showName: function() {
    console.log(this.name);
  }
};
setTimeout(MyObj.showName, 1000);`, `88064492062092410000`)"
            >
              <div
                class="gatsby-code-button"
                
              >
                js 复制代码
              </div>
            </div>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">var</span> name <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> MyObj <span class="token operator">=</span> <span class="token punctuation">{</span>
  name<span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
  <span class="token function-variable function">showName</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token function">setTimeout</span><span class="token punctuation">(</span>MyObj<span class="token punctuation">.</span>showName<span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>这里输出的是 1，因为这段代码在编译的时候，执行上下文中的 this 会被设置为全局 window，如果是严格模式，会被设置为 undefined。</p>
<p>那么该怎么解决这个问题呢？通常可以使用下面这两种方法。</p>
<p>第一种是将 MyObj.showName 放在匿名函数中执行，如下所示：</p>
<div
              class="gatsby-code-button-container"
              data-toaster-id="15135900741048648000"
              data-toaster-class="gatsby-code-button-toaster"
              data-toaster-text-class="gatsby-code-button-toaster-text"
              data-toaster-text="复制成功"
              data-toaster-duration="3500"
              onClick="copyToClipboard(`// 箭头函数
setTimeout(() => {
  MyObj.showName();
}, 1000);
// 或者 function 函数
setTimeout(function() {
  MyObj.showName();
}, 1000);`, `15135900741048648000`)"
            >
              <div
                class="gatsby-code-button"
                
              >
                js 复制代码
              </div>
            </div>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// 箭头函数</span>
<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  MyObj<span class="token punctuation">.</span><span class="token function">showName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 或者 function 函数</span>
<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  MyObj<span class="token punctuation">.</span><span class="token function">showName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>第二种是使用 bind 方法，将 showName 绑定在 MyObj 上面，代码如下所示：</p>
<div
              class="gatsby-code-button-container"
              data-toaster-id="56112384213191180000"
              data-toaster-class="gatsby-code-button-toaster"
              data-toaster-text-class="gatsby-code-button-toaster-text"
              data-toaster-text="复制成功"
              data-toaster-duration="3500"
              onClick="copyToClipboard(`setTimeout(MyObj.showName.bind(MyObj), 1000);`, `56112384213191180000`)"
            >
              <div
                class="gatsby-code-button"
                
              >
                js 复制代码
              </div>
            </div>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token function">setTimeout</span><span class="token punctuation">(</span>MyObj<span class="token punctuation">.</span><span class="token function">showName</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span>MyObj<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>
<h2 id="总结-1"><a href="#%E6%80%BB%E7%BB%93-1" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>总结</h2>
<ul>
<li>首先，为了支持定时器的实现，浏览器增加了延时队列。</li>
<li>其次，由于消息队列排队和一些系统级别的限制，通过 setTimeout 设置的回调任务并非总是可以实时地被执行，这样就不能满足一些实时性要求较高的需求了。</li>
<li>最后，在定时器中使用过程中，还存在一些陷阱，需要你多加注意。</li>
</ul>
<p>通过分析和讲解，你会发现函数 setTimeout 在时效性上面有很多先天的不足，所以对于一些时间精度要求比较高的需求，应该有针对性地采取一些其他的方案</p>
<h1 id="webapi：xmlhttprequest-是怎么实现的"><a href="#webapi%EF%BC%9Axmlhttprequest-%E6%98%AF%E6%80%8E%E4%B9%88%E5%AE%9E%E7%8E%B0%E7%9A%84" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Webapi：XMLHttpRequest 是怎么实现的</h1>
<p>自从网页中引入了 JavaScript，我们就可以操作 DOM 树中任意一个节点，例如隐藏/显示节点、改变颜色、获得或改变文本内容、为元素添加事件响应函数等等，几乎可以“为所欲为”了。</p>
<p>不过在 XMLHttpRequest 出现之前，如果服务器数据有更新，依然需要重新刷新整个页面。而 XMLHttpRequest 提供了从 Web 服务器获取数据的能力，如果你想要更新某条数据，只需要通过 XMLHttpRequest 请求服务器提供的接口，就可以获取到服务器的数据，然后再操作 DOM 来更新页面内容，整个过程只需要更新网页的一部分就可以了，而不用像之前那样还得刷新整个页面，这样既有效率又不会打扰到用户。</p>
<p>关于 XMLHttpRequest，本来我是想一带而过的，后来发现这个 WebAPI 用于教学非常好。首先前面讲了那么网络内容，现在可以通过它把 HTTP 协议实践一遍；其次，XMLHttpRequest 是一个非常典型的 WebAPI，通过它来讲解浏览器是如何实现 WebAPI 的很合适，这对于你理解其他 WebAPI 也有非常大的帮助，同时在这个过程中我们还可以把一些安全问题给串起来。</p>
<p>但在深入讲解 XMLHttpRequest 之前，我们得先介绍下同步回调和异步回调这两个概念，这会帮助你更加深刻地理解 WebAPI 是怎么工作的</p>
<h2 id="回调函数-vs-系统调用栈"><a href="#%E5%9B%9E%E8%B0%83%E5%87%BD%E6%95%B0-vs-%E7%B3%BB%E7%BB%9F%E8%B0%83%E7%94%A8%E6%A0%88" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>回调函数 VS 系统调用栈</h2>
<p>那什么是回调函数呢（Callback Function）？</p>
<p>将一个函数作为参数传递给另外一个函数，那作为参数的这个函数就是回调函数。简化的代码如下所示：</p>
<div
              class="gatsby-code-button-container"
              data-toaster-id="10514541727159600000"
              data-toaster-class="gatsby-code-button-toaster"
              data-toaster-text-class="gatsby-code-button-toaster-text"
              data-toaster-text="复制成功"
              data-toaster-duration="3500"
              onClick="copyToClipboard(`let callback = function() {
  console.log('i am do homework');
};
function doWork(cb) {
  console.log('start do work');
  cb();
  console.log('end do work');
}
doWork(callback);`, `10514541727159600000`)"
            >
              <div
                class="gatsby-code-button"
                
              >
                js 复制代码
              </div>
            </div>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">let</span> <span class="token function-variable function">callback</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'i am do homework'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">doWork</span><span class="token punctuation">(</span><span class="token parameter">cb</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'start do work'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">cb</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'end do work'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token function">doWork</span><span class="token punctuation">(</span>callback<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>在上面示例代码中，我们将一个匿名函数赋值给变量 callback，同时将 callback 作为参数传递给了 doWork() 函数，这时在函数 doWork() 中 callback 就是回调函数。</p>
<p>上面的回调方法有个特点，就是回调函数 callback 是在主函数 doWork 返回之前执行的，我们把这个回调过程称为同步回调。</p>
<p>既然有同步回调，那肯定也有异步回调。下面我们再来看看异步回调的例子：</p>
<div
              class="gatsby-code-button-container"
              data-toaster-id="28982796989499593000"
              data-toaster-class="gatsby-code-button-toaster"
              data-toaster-text-class="gatsby-code-button-toaster-text"
              data-toaster-text="复制成功"
              data-toaster-duration="3500"
              onClick="copyToClipboard(`let callback = function() {
  console.log('i am do homework');
};
function doWork(cb) {
  console.log('start do work');
  setTimeout(cb, 1000);
  console.log('end do work');
}
doWork(callback);`, `28982796989499593000`)"
            >
              <div
                class="gatsby-code-button"
                
              >
                js 复制代码
              </div>
            </div>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">let</span> <span class="token function-variable function">callback</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'i am do homework'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">doWork</span><span class="token punctuation">(</span><span class="token parameter">cb</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'start do work'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">setTimeout</span><span class="token punctuation">(</span>cb<span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'end do work'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token function">doWork</span><span class="token punctuation">(</span>callback<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>在这个例子中，我们使用了 setTimeout 函数让 callback 在 doWork 函数执行结束后，又延时了 1 秒再执行，这次 callback 并没有在主函数 doWork 内部被调用，我们把这种回调函数在主函数外部执行的过程称为异步回调。</p>
<p>现在你应该知道什么是同步回调和异步回调了，那下面我们再深入点，站在消息循环的视角来看看同步回调和异步回调的区别。理解了这些，可以让你从本质上理解什么是回调。</p>
<p>你应该已经知道浏览器页面是通过事件循环机制来驱动的，每个渲染进程都有一个消息队列，页面主线程按照顺序来执行消息队列中的事件，如执行 JavaScript 事件、解析 DOM 事件、计算布局事件、用户输入事件等等，如果页面有新的事件产生，那新的事件将会追加到事件队列的尾部。所以可以说是消息队列和主线程循环机制保证了页面有条不紊地运行。</p>
<p>这里还需要补充一点，那就是当循环系统在执行一个任务的时候，都要为这个任务维护一个系统调用栈。这个系统调用栈类似于 JavaScript 的调用栈，只不过系统调用栈是 Chromium 的开发语言 C++ 来维护的，其完整的调用栈信息你可以通过 chrome://tracing/ 来抓取。当然，你也可以通过 Performance 来抓取它核心的调用信息，如下图所示：</p>
<p>
  <a
    class="gatsby-resp-image-link"
    href="/static/2021-07-06-17-50-52-6f37242a303832ef121ac1f50821cbde-d868f.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
  
  <span
    class="gatsby-resp-image-wrapper"
    style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;"
  >
    <span
      class="gatsby-resp-image-background-image"
      style="padding-bottom: 31.25827814569536%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAIAAABM9SnKAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABEklEQVQY021Pa0/CQBDs//8dRhPRpDFRUlKkFaStpFYD+EoRSMQg0gd9XO/a7a2rxQ8mTvZ2Z2cnm1tFlGXOWMHyIk85SwGElCAlUtS1rGWDH06P9BpriQBArbL+jNULXRtMWvr04Nxr6U+67WuG1TGdnuVeDr2OeaMZdm/oda/vSdf7o+5g1Hf9jAlFVLD0nU2YjOeJPf3wZtlqE78+Gg/jW/Xo2DLt5YtlGe3TQ/V54t45+tlJ+0ozVuudRFSgliWgqOiHSD1l4oDIRbWYv0dhRmKSFovZW5pxXmG0g+02y5kgp4KI+6ukbILcZVkyxugsLjiRCuDXRsNvNEXB/1AULAyDXRyHQRBFkeD873y/4guajEtjKmtvyQAAAABJRU5ErkJggg=='); background-size: cover; display: block;"
    >
      <img
        class="gatsby-resp-image-image"
        style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;"
        alt="2021 07 06 17 50 52"
        title=""
        src="/static/2021-07-06-17-50-52-6f37242a303832ef121ac1f50821cbde-fee1c.png"
        srcset="/static/2021-07-06-17-50-52-6f37242a303832ef121ac1f50821cbde-a67b7.png 200w,
/static/2021-07-06-17-50-52-6f37242a303832ef121ac1f50821cbde-0b187.png 400w,
/static/2021-07-06-17-50-52-6f37242a303832ef121ac1f50821cbde-fee1c.png 800w,
/static/2021-07-06-17-50-52-6f37242a303832ef121ac1f50821cbde-b1a91.png 1200w,
/static/2021-07-06-17-50-52-6f37242a303832ef121ac1f50821cbde-d868f.png 1510w"
        sizes="(max-width: 800px) 100vw, 800px"
      />
    </span>
  </span>
  
  </a>
    </p>
<p>这幅图记录了一个 Parse HTML 的任务执行过程，其中黄色的条目表示执行 JavaScript 的过程，其他颜色的条目表示浏览器内部系统的执行过程。</p>
<p>通过该图你可以看出来，Parse HTML 任务在执行过程中会遇到一系列的子过程，比如在解析页面的过程中遇到了 JavaScript 脚本，那么就暂停解析过程去执行该脚本，等执行完成之后，再恢复解析过程。然后又遇到了样式表，这时候又开始解析样式表……直到整个任务执行完成。</p>
<p>需要说明的是，整个 Parse HTML 是一个完整的任务，在执行过程中的脚本解析、样式表解析都是该任务的子过程，其下拉的长条就是执行过程中调用栈的信息。</p>
<p>每个任务在执行过程中都有自己的调用栈，那么同步回调就是在当前主函数的上下文中执行回调函数，这个没有太多可讲的。下面我们主要来看看异步回调过程，异步回调是指回调函数在主函数之外执行，一般有两种方式</p>
<ul>
<li>第一种是把异步函数做成一个任务，添加到消息队列尾部；</li>
<li>第二种是把异步函数添加到微任务队列中，这样就可以在当前任务的末尾处执行微任务了</li>
</ul>
<h2 id="xmlhttprequest-运作机制"><a href="#xmlhttprequest-%E8%BF%90%E4%BD%9C%E6%9C%BA%E5%88%B6" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>XMLHttpRequest 运作机制</h2>
<p>理解了什么是同步回调和异步回调，接下来我们就来分析 XMLHttpRequest 背后的实现机制，具体工作过程你可以参考下图：</p>
<p>
  <a
    class="gatsby-resp-image-link"
    href="/static/2021-07-06-17-51-21-3b86b8c6f2c0d3d3341a6661100522e4-b0aef.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
  
  <span
    class="gatsby-resp-image-wrapper"
    style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;"
  >
    <span
      class="gatsby-resp-image-background-image"
      style="padding-bottom: 57.42574257425742%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABmElEQVQoz3VS227bMAzNJ/Vhv7S/6QcMfeg/JMjzsA4Dhr20WNJla2pnTerUjWMpsq37hRztFF2BoAeUQFA8PJSoESICQOoRaZE/RFKMiaLDIQ4Gx6O3GFHIWuu8TzFA9HX1XDxuqtZBCkz6VW2CD1o7qZTUzrn4tkRPVko3gvGGc4u7xnzL5XSZ8r19Enp8y0AyI0UK7lW/d17JUqq62uZlOdvjHYfxEqdLWFTpScbJnYqqicFjUnjaNt3TDn2n4KNVySlt7I/FWh/2GY/j3y0lzXZwdd8WwiOGnKWrh7QR8KLcdh0ry2w+v5nN89XfLMtuZz/N83ZRNJNfnJI+TvyHC3fxXaDZnn9pzj65y+vwX5meohG8Ltecs7re1axGr+8rPf3Tuo7fFPZrbtZ7iWBzDqS8PioTmZj9eKxGKVAJlAeQB/Td6mDHpBy6BBrR4QlelPudM1MUpixN8WiqCqPftPB5pahsBEzDUw9fYPCPZFohBBKnUTvqfzBPoPl6H0PA9zE6DZGC1lrR9LWmpqSUnHOqdpr5D9Ztc8a8+Ms6AAAAAElFTkSuQmCC'); background-size: cover; display: block;"
    >
      <img
        class="gatsby-resp-image-image"
        style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;"
        alt="2021 07 06 17 51 21"
        title=""
        src="/static/2021-07-06-17-51-21-3b86b8c6f2c0d3d3341a6661100522e4-fee1c.png"
        srcset="/static/2021-07-06-17-51-21-3b86b8c6f2c0d3d3341a6661100522e4-a67b7.png 200w,
/static/2021-07-06-17-51-21-3b86b8c6f2c0d3d3341a6661100522e4-0b187.png 400w,
/static/2021-07-06-17-51-21-3b86b8c6f2c0d3d3341a6661100522e4-fee1c.png 800w,
/static/2021-07-06-17-51-21-3b86b8c6f2c0d3d3341a6661100522e4-b1a91.png 1200w,
/static/2021-07-06-17-51-21-3b86b8c6f2c0d3d3341a6661100522e4-b0aef.png 1414w"
        sizes="(max-width: 800px) 100vw, 800px"
      />
    </span>
  </span>
  
  </a>
    </p>
<p>这是 XMLHttpRequest 的总执行流程图，下面我们就来分析从发起请求到接收数据的完整流程。</p>
<p>我们先从 XMLHttpRequest 的用法开始，首先看下面这样一段请求代码：</p>
<div
              class="gatsby-code-button-container"
              data-toaster-id="14200472077575578000"
              data-toaster-class="gatsby-code-button-toaster"
              data-toaster-text-class="gatsby-code-button-toaster-text"
              data-toaster-text="复制成功"
              data-toaster-duration="3500"
              onClick="copyToClipboard(`function GetWebData(URL) {
  /**
   * 1: 新建 XMLHttpRequest 请求对象
   */
  let xhr = new XMLHttpRequest();

  /**
   * 2: 注册相关事件回调处理函数
   */
  xhr.onreadystatechange = function() {
    switch (xhr.readyState) {
      case 0: // 请求未初始化
        console.log('请求未初始化');
        break;
      case 1: // OPENED
        console.log('OPENED');
        break;
      case 2: // HEADERS_RECEIVED
        console.log('HEADERS_RECEIVED');
        break;
      case 3: // LOADING
        console.log('LOADING');
        break;
      case 4: // DONE
        if (this.status == 200 || this.status == 304) {
          console.log(this.responseText);
        }
        console.log('DONE');
        break;
    }
  };

  xhr.ontimeout = function(e) {
    console.log('ontimeout');
  };
  xhr.onerror = function(e) {
    console.log('onerror');
  };

  /**
   * 3: 打开请求
   */
  xhr.open('Get', URL, true); // 创建一个 Get 请求, 采用异步

  /**
   * 4: 配置参数
   */
  xhr.timeout = 3000; // 设置 xhr 请求的超时时间
  xhr.responseType = 'text'; // 设置响应返回的数据格式
  xhr.setRequestHeader('X_TEST', 'time.geekbang');

  /**
   * 5: 发送请求
   */
  xhr.send();
}`, `14200472077575578000`)"
            >
              <div
                class="gatsby-code-button"
                
              >
                js 复制代码
              </div>
            </div>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">function</span> <span class="token function">GetWebData</span><span class="token punctuation">(</span><span class="token parameter"><span class="token constant">URL</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">/**
   * 1: 新建 XMLHttpRequest 请求对象
   */</span>
  <span class="token keyword">let</span> xhr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XMLHttpRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">/**
   * 2: 注册相关事件回调处理函数
   */</span>
  xhr<span class="token punctuation">.</span><span class="token function-variable function">onreadystatechange</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">switch</span> <span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>readyState<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">case</span> <span class="token number">0</span><span class="token punctuation">:</span> <span class="token comment">// 请求未初始化</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'请求未初始化'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">break</span><span class="token punctuation">;</span>
      <span class="token keyword">case</span> <span class="token number">1</span><span class="token punctuation">:</span> <span class="token comment">// OPENED</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'OPENED'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">break</span><span class="token punctuation">;</span>
      <span class="token keyword">case</span> <span class="token number">2</span><span class="token punctuation">:</span> <span class="token comment">// HEADERS_RECEIVED</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'HEADERS_RECEIVED'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">break</span><span class="token punctuation">;</span>
      <span class="token keyword">case</span> <span class="token number">3</span><span class="token punctuation">:</span> <span class="token comment">// LOADING</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'LOADING'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">break</span><span class="token punctuation">;</span>
      <span class="token keyword">case</span> <span class="token number">4</span><span class="token punctuation">:</span> <span class="token comment">// DONE</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">==</span> <span class="token number">200</span> <span class="token operator">||</span> <span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">==</span> <span class="token number">304</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>responseText<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'DONE'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  xhr<span class="token punctuation">.</span><span class="token function-variable function">ontimeout</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'ontimeout'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  xhr<span class="token punctuation">.</span><span class="token function-variable function">onerror</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'onerror'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token comment">/**
   * 3: 打开请求
   */</span>
  xhr<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">'Get'</span><span class="token punctuation">,</span> <span class="token constant">URL</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 创建一个 Get 请求, 采用异步</span>

  <span class="token comment">/**
   * 4: 配置参数
   */</span>
  xhr<span class="token punctuation">.</span>timeout <span class="token operator">=</span> <span class="token number">3000</span><span class="token punctuation">;</span> <span class="token comment">// 设置 xhr 请求的超时时间</span>
  xhr<span class="token punctuation">.</span>responseType <span class="token operator">=</span> <span class="token string">'text'</span><span class="token punctuation">;</span> <span class="token comment">// 设置响应返回的数据格式</span>
  xhr<span class="token punctuation">.</span><span class="token function">setRequestHeader</span><span class="token punctuation">(</span><span class="token string">'X_TEST'</span><span class="token punctuation">,</span> <span class="token string">'time.geekbang'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">/**
   * 5: 发送请求
   */</span>
  xhr<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>上面是一段利用了 XMLHttpRequest 来请求数据的代码，再结合上面的流程图，我们可以分析下这段代码是怎么执行的</p>
<h3 id="创建-xmlhttprequest-对象"><a href="#%E5%88%9B%E5%BB%BA-xmlhttprequest-%E5%AF%B9%E8%B1%A1" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>创建 XMLHttpRequest 对象</h3>
<p>当执行到 let xhr = new XMLHttpRequest() 后，JavaScript 会创建一个 XMLHttpRequest 对象 xhr，用来执行实际的网络请求操作。</p>
<h3 id="为-xhr-对象注册回调函数"><a href="#%E4%B8%BA-xhr-%E5%AF%B9%E8%B1%A1%E6%B3%A8%E5%86%8C%E5%9B%9E%E8%B0%83%E5%87%BD%E6%95%B0" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>为 xhr 对象注册回调函数</h3>
<p>因为网络请求比较耗时，所以要注册回调函数，这样后台任务执行完成之后就会通过调用回调函数来告诉其执行结果。</p>
<p>XMLHttpRequest 的回调函数主要有下面几种：</p>
<ul>
<li>ontimeout，用来监控超时请求，如果后台请求超时了，该函数会被调用；</li>
<li>onerror，用来监控出错信息，如果后台请求出错了，该函数会被调用；</li>
<li>onreadystatechange，用来监控后台请求过程中的状态，比如可以监控到 HTTP 头加载完成的消息、HTTP 响应体消息以及数据加载完成的消息等。</li>
</ul>
<h3 id="配置基础的请求信息"><a href="#%E9%85%8D%E7%BD%AE%E5%9F%BA%E7%A1%80%E7%9A%84%E8%AF%B7%E6%B1%82%E4%BF%A1%E6%81%AF" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>配置基础的请求信息</h3>
<p>注册好回调事件之后，接下来就需要配置基础的请求信息了，首先要通过 open 接口配置一些基础的请求信息，包括请求的地址、请求方法（是 get 还是 post）和请求方式（同步还是异步请求）。</p>
<p>然后通过 xhr 内部属性类配置一些其他可选的请求信息，你可以参考文中示例代码，我们通过 xhr.timeout = 3000 来配置超时时间，也就是说如果请求超过 3000 毫秒还没有响应，那么这次请求就被判断为失败了。</p>
<p>我们还可以通过 xhr.responseType = “text” 来配置服务器返回的格式，将服务器返回的数据自动转换为自己想要的格式，如果将 responseType 的值设置为 json，那么系统会自动将服务器返回的数据转换为 JavaScript 对象格式。下面的图表是我列出的一些返回类型的描述：</p>
<p>
  <a
    class="gatsby-resp-image-link"
    href="/static/2021-07-06-17-52-35-d6dd01b803d27862029c63d9610c71ea-c7aa5.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
  
  <span
    class="gatsby-resp-image-wrapper"
    style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;"
  >
    <span
      class="gatsby-resp-image-background-image"
      style="padding-bottom: 52.40174672489083%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAIAAAA7N+mxAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABvUlEQVQoz01Qy27TQBTNFyGhpqxYIvEN8BVIkHTDAj4A/gRiRxVZIbY0qloEDbbr1zw8M/b47dgex+6C6zpApaOrozNz5twzs7I56Fu8uQrWW7K6QKsLPEHbAghgc0XPL+mk3E+ib8nn7zgu1czm+dO35y8/fnv2bjNfrJ6crU/P9HEu9ZOFdvJGe/Hh6/P3Xx6/1uYL7XS5ni91OHr06tOlI2ddp7KMFWVYVUIIx/N2ANO8RsgIApsQUwjPcW+AY2xy7lB667o3GBt9r2ZD39UFHdrwrpNNFUTclNwKmVGmqN2zQzPqg5IwJzLxvgkHMPd9xwOzyHCvZBb7AfkdMiuVnmAWowaQrom6Jnw4D23U7vnRHHG7qfjdIalykiV+keJ9QYsU5SmKhF1mBN4Fw0Oo+q+Zop17+yMOHbCJwJoIIwbFu7pkg4onw33yEdDo2BluZwkCqS4hEAOqnOYJymIviVxYATYqM6zq8N8K/5MDvEulq2qRJ37ErSRyoCqQWNiefY29n4KZnBr7gjQVg7Y9mMfO7ZicSB95vwJiVDlLpZ8nuMgoiOn4f4ZgNihpjFKJeGDBjr1KVB1B8h/Q9gegQgkMNQAAAABJRU5ErkJggg=='); background-size: cover; display: block;"
    >
      <img
        class="gatsby-resp-image-image"
        style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;"
        alt="2021 07 06 17 52 35"
        title=""
        src="/static/2021-07-06-17-52-35-d6dd01b803d27862029c63d9610c71ea-fee1c.png"
        srcset="/static/2021-07-06-17-52-35-d6dd01b803d27862029c63d9610c71ea-a67b7.png 200w,
/static/2021-07-06-17-52-35-d6dd01b803d27862029c63d9610c71ea-0b187.png 400w,
/static/2021-07-06-17-52-35-d6dd01b803d27862029c63d9610c71ea-fee1c.png 800w,
/static/2021-07-06-17-52-35-d6dd01b803d27862029c63d9610c71ea-b1a91.png 1200w,
/static/2021-07-06-17-52-35-d6dd01b803d27862029c63d9610c71ea-c7aa5.png 1374w"
        sizes="(max-width: 800px) 100vw, 800px"
      />
    </span>
  </span>
  
  </a>
    </p>
<p>假如你还需要添加自己专用的请求头属性，可以通过 xhr.setRequestHeader 来添加。</p>
<h3 id="发起请求"><a href="#%E5%8F%91%E8%B5%B7%E8%AF%B7%E6%B1%82" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>发起请求</h3>
<p>一切准备就绪之后，就可以调用 xhr.send 来发起网络请求了。你可以对照上面那张请求流程图，可以看到：渲染进程会将请求发送给网络进程，然后网络进程负责资源的下载，等网络进程接收到数据之后，就会利用 IPC 来通知渲染进程；渲染进程接收到消息之后，会将 xhr 的回调函数封装成任务并添加到消息队列中，等主线程循环系统执行到该任务的时候，就会根据相关的状态来调用对应的回调函数</p>
<ul>
<li>如果网络请求出错了，就会执行 xhr.onerror；</li>
<li>如果超时了，就会执行 xhr.ontimeout；</li>
<li>如果是正常的数据接收，就会执行 onreadystatechange 来反馈相应的状态。</li>
</ul>
<p>这就是一个完整的 XMLHttpRequest 请求流程，如果你感兴趣，可以参考下 Chromium 对 <a href="https://chromium.googlesource.com/chromium/src/+/refs/heads/master/third_party/blink/renderer/core/xmlhttprequest/" target="_blank" rel="nofollow noreferrer noopener">XMLHttpRequest 的实现</a>。</p>
<h2 id="xmlhttprequest-使用过程中的坑"><a href="#xmlhttprequest-%E4%BD%BF%E7%94%A8%E8%BF%87%E7%A8%8B%E4%B8%AD%E7%9A%84%E5%9D%91" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>XMLHttpRequest 使用过程中的“坑”</h2>
<p>上述过程看似简单，但由于浏览器很多安全策略的限制，所以会导致你在使用过程中踩到非常多的“坑”。</p>
<p>浏览器安全问题是前端工程师避不开的一道坎，通常在使用过程中遇到的“坑”，很大一部分都是由安全策略引起的，不管你喜不喜欢，它都在这里。本来很完美的一个方案，正是由于加了安全限制，导致使用起来非常麻烦。</p>
<p>而你要做的就是去正视这各种的安全问题。也就是说要想更加完美地使用 XMLHttpRequest，你就要了解浏览器的安全策略。</p>
<p>下面我们就来看看在使用 XMLHttpRequest 的过程中所遇到的跨域问题和混合内容问题。</p>
<h3 id="跨域问题"><a href="#%E8%B7%A8%E5%9F%9F%E9%97%AE%E9%A2%98" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>跨域问题</h3>
<p>比如在极客邦的官网使用 XMLHttpRequest 请求极客时间的页面内容，由于极客邦的官网是 www.geekbang.org，极客时间的官网是 time.geekbang.org，它们不是同一个源，所以就涉及到了跨域（在 A 站点中去访问不同源的 B 站点的内容）。默认情况下，跨域请求是不被允许的，你可以看下面的示例代码：</p>
<div
              class="gatsby-code-button-container"
              data-toaster-id="36435383049948310000"
              data-toaster-class="gatsby-code-button-toaster"
              data-toaster-text-class="gatsby-code-button-toaster-text"
              data-toaster-text="复制成功"
              data-toaster-duration="3500"
              onClick="copyToClipboard(`var xhr = new XMLHttpRequest();
var url = 'https://time.geekbang.org/';
function handler() {
  switch (xhr.readyState) {
    case 0: // 请求未初始化
      console.log(' 请求未初始化 ');
      break;
    case 1: // OPENED
      console.log('OPENED');
      break;
    case 2: // HEADERS_RECEIVED
      console.log('HEADERS_RECEIVED');
      break;
    case 3: // LOADING
      console.log('LOADING');
      break;
    case 4: // DONE
      if (this.status == 200 || this.status == 304) {
        console.log(this.responseText);
      }
      console.log('DONE');
      break;
  }
}

function callOtherDomain() {
  if (xhr) {
    xhr.open('GET', url, true);
    xhr.onreadystatechange = handler;
    xhr.send();
  }
}
callOtherDomain();`, `36435383049948310000`)"
            >
              <div
                class="gatsby-code-button"
                
              >
                js 复制代码
              </div>
            </div>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">var</span> xhr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XMLHttpRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> url <span class="token operator">=</span> <span class="token string">'https://time.geekbang.org/'</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">handler</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">switch</span> <span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>readyState<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">case</span> <span class="token number">0</span><span class="token punctuation">:</span> <span class="token comment">// 请求未初始化</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">' 请求未初始化 '</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token keyword">case</span> <span class="token number">1</span><span class="token punctuation">:</span> <span class="token comment">// OPENED</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'OPENED'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token keyword">case</span> <span class="token number">2</span><span class="token punctuation">:</span> <span class="token comment">// HEADERS_RECEIVED</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'HEADERS_RECEIVED'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token keyword">case</span> <span class="token number">3</span><span class="token punctuation">:</span> <span class="token comment">// LOADING</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'LOADING'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token keyword">case</span> <span class="token number">4</span><span class="token punctuation">:</span> <span class="token comment">// DONE</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">==</span> <span class="token number">200</span> <span class="token operator">||</span> <span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">==</span> <span class="token number">304</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>responseText<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'DONE'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">break</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">callOtherDomain</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>xhr<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    xhr<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">'GET'</span><span class="token punctuation">,</span> url<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    xhr<span class="token punctuation">.</span>onreadystatechange <span class="token operator">=</span> handler<span class="token punctuation">;</span>
    xhr<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token function">callOtherDomain</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>你可以在控制台测试下。首先通过浏览器打开 www.geekbang.org，然后打开控制台，在控制台输入以上示例代码，再执行，会看到请求被 Block 了。控制台的提示信息如下：</p>
<div
              class="gatsby-code-button-container"
              data-toaster-id="68140295773522050000"
              data-toaster-class="gatsby-code-button-toaster"
              data-toaster-text-class="gatsby-code-button-toaster-text"
              data-toaster-text="复制成功"
              data-toaster-duration="3500"
              onClick="copyToClipboard(`Access to XMLHttpRequest at 'https://time.geekbang.org/' from origin 'https://www.geekbang.org' has been blocked by CORS policy: No 'Access-Control-Allow-Origin' header is present on the requested resource.`, `68140295773522050000`)"
            >
              <div
                class="gatsby-code-button"
                
              >
                复制代码
              </div>
            </div>
<div class="gatsby-highlight" data-language="text"><pre style="counter-reset: linenumber NaN" class="language-text line-numbers"><code class="language-text">Access to XMLHttpRequest at &#39;https://time.geekbang.org/&#39; from origin &#39;https://www.geekbang.org&#39; has been blocked by CORS policy: No &#39;Access-Control-Allow-Origin&#39; header is present on the requested resource.</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>
<p>因为 www.geekbang.org 和 time.geekbang.com 不属于一个域，所以以上访问就属于跨域访问了，这次访问失败就是由于跨域问题导致的。</p>
<h3 id="https-混合内容的问题"><a href="#https-%E6%B7%B7%E5%90%88%E5%86%85%E5%AE%B9%E7%9A%84%E9%97%AE%E9%A2%98" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>HTTPS 混合内容的问题</h3>
<p>了解完跨域问题后，我们再来看看 HTTPS 的混合内容。HTTPS 混合内容是 HTTPS 页面中包含了不符合 HTTPS 安全要求的内容，比如包含了 HTTP 资源，通过 HTTP 加载的图像、视频、样式表、脚本等，都属于混合内容。</p>
<p>通常，如果 HTTPS 请求页面中使用混合内容，浏览器会针对 HTTPS 混合内容显示警告，用来向用户表明此 HTTPS 页面包含不安全的资源。比如打开站点 <a href="https://www.iteye.com/groups" target="_blank" rel="nofollow noreferrer noopener">https://www.iteye.com/groups</a> ，可以通过控制台看到混合内容的警告，参考下图：</p>
<p>
  <a
    class="gatsby-resp-image-link"
    href="/static/2021-07-06-17-55-02-6993958a4ad8300358f3b888530c3d6b-4be21.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
  
  <span
    class="gatsby-resp-image-wrapper"
    style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;"
  >
    <span
      class="gatsby-resp-image-background-image"
      style="padding-bottom: 37.532467532467535%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAIAAAB2/0i6AAAACXBIWXMAAA7DAAAOwwHHb6hkAAABZUlEQVQY03WO2XKjMBRE+f+PSqqCx8bYGLMYs4lVYg+SzNixkQSB5HXm1Klbdbv6oaUXJQ9MXhQ/SbdKP79wN97wIhsIG/CvfCD8L10S8bjxOx0HMgkmVVc59/ddplexVkYaBFoeHjNfTT0VhUcEDk2q98j8hEabalV0uNVOX9hlqPKhk0h+yC5vDVBqoBTBDnp/KqAml48yUFJHht4WmO/Aei9DBcNTn2tDZTXJCUNdvKiEmyT0zCJzqtxGiZUAI4st4GkwsdYQeVlkxuG5Kbw7ze4kGx81JXCg+SSeUhudgL6pfRU5culuc2cHDDky5NjapPY2NjfoqsDrrvL3eNkfazg91+GxDfY/s10dGbvSNdDl1AGnCew6uNSBXSxzXBM559I1K9+q19xuQruL1k4b2OIxSHxkgnHO+HpH9iMXXExczGKepnme5t8CG9kCX2vru+TS/C+ezy9Kad/3bdsszP/hG/Hrsj26RDttAAAAAElFTkSuQmCC'); background-size: cover; display: block;"
    >
      <img
        class="gatsby-resp-image-image"
        style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;"
        alt="2021 07 06 17 55 02"
        title=""
        src="/static/2021-07-06-17-55-02-6993958a4ad8300358f3b888530c3d6b-fee1c.png"
        srcset="/static/2021-07-06-17-55-02-6993958a4ad8300358f3b888530c3d6b-a67b7.png 200w,
/static/2021-07-06-17-55-02-6993958a4ad8300358f3b888530c3d6b-0b187.png 400w,
/static/2021-07-06-17-55-02-6993958a4ad8300358f3b888530c3d6b-fee1c.png 800w,
/static/2021-07-06-17-55-02-6993958a4ad8300358f3b888530c3d6b-b1a91.png 1200w,
/static/2021-07-06-17-55-02-6993958a4ad8300358f3b888530c3d6b-4be21.png 1540w"
        sizes="(max-width: 800px) 100vw, 800px"
      />
    </span>
  </span>
  
  </a>
    </p>
<p>从上图可以看出，通过 HTML 文件加载的混合资源，虽然给出警告，但大部分类型还是能加载的。而使用 XMLHttpRequest 请求时，浏览器认为这种请求可能是攻击者发起的，会阻止此类危险的请求。比如我通过浏览器打开地址 <code class="language-text">https://www.iteye.com/groups</code>，然后通过控制台，使用 XMLHttpRequest 来请求 <code class="language-text">http://img-ads.csdn.net/2018/201811150919211586.jpg</code>，这时候请求就会报错，出错信息如下图所示：</p>
<p>
  <a
    class="gatsby-resp-image-link"
    href="/static/2021-07-06-17-55-11-fd0668221db3d0cc98c4a7935b9e93f5-ff8ad.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
  
  <span
    class="gatsby-resp-image-wrapper"
    style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;"
  >
    <span
      class="gatsby-resp-image-background-image"
      style="padding-bottom: 48.883666274970615%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAIAAAA7N+mxAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABAElEQVQoz52R3WrDMAyF+/5PNpouScMKK+xiNCRNE//Ltpw4dqexi/ZmkE0cbGH4JB1rl3NeU1xzuv89dgQro40RyxxJPnicvfUQ12UTjDPGuKSUqX2iyGmJM91b4PvIWXfrtEENkqmRq5FqbRqbGjCuur5jE3OSM9YP/adgw1bPxgF4+M+HifF2bdug5CxFUAKl9HxybPKc0UtCnwOSKEkBnTHo7APWdaHLva0PUO6hKa/14VK8XKqibaqhqcampHM6Hd35hO9v0/FVfpyfPFuzgl7NjxRyhoJ/DwIajXJKeK2iswlt8jaTAj7gZw+0LHDOhwCOVu0pl0qBtb95/gJibERyYvjvZQAAAABJRU5ErkJggg=='); background-size: cover; display: block;"
    >
      <img
        class="gatsby-resp-image-image"
        style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;"
        alt="2021 07 06 17 55 11"
        title=""
        src="/static/2021-07-06-17-55-11-fd0668221db3d0cc98c4a7935b9e93f5-fee1c.png"
        srcset="/static/2021-07-06-17-55-11-fd0668221db3d0cc98c4a7935b9e93f5-a67b7.png 200w,
/static/2021-07-06-17-55-11-fd0668221db3d0cc98c4a7935b9e93f5-0b187.png 400w,
/static/2021-07-06-17-55-11-fd0668221db3d0cc98c4a7935b9e93f5-fee1c.png 800w,
/static/2021-07-06-17-55-11-fd0668221db3d0cc98c4a7935b9e93f5-b1a91.png 1200w,
/static/2021-07-06-17-55-11-fd0668221db3d0cc98c4a7935b9e93f5-95179.png 1600w,
/static/2021-07-06-17-55-11-fd0668221db3d0cc98c4a7935b9e93f5-ff8ad.png 1702w"
        sizes="(max-width: 800px) 100vw, 800px"
      />
    </span>
  </span>
  
  </a>
    </p>
<h2 id="总结-2"><a href="#%E6%80%BB%E7%BB%93-2" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>总结</h2>
<p>首先我们介绍了回调函数和系统调用栈；接下来我们站在循环系统的视角，分析了 XMLHttpRequest 是怎么工作的；最后又说明了由于一些安全因素的限制，在使用 XMLHttpRequest 的过程中会遇到跨域问题和混合内容的问题。</p>
<p>本篇文章跨度比较大，不是单纯地讲一个问题，而是将回调类型、循环系统、网络请求和安全问题“串联”起来了。</p>
<p>对比上一篇文章，setTimeout 是直接将延迟任务添加到延迟队列中，而 XMLHttpRequest 发起请求，是由浏览器的其他进程或者线程去执行，然后再将执行结果利用 IPC 的方式通知渲染进程，之后渲染进程再将对应的消息添加到消息队列中。如果你搞懂了 setTimeout 和 XMLHttpRequest 的工作机制后，再来理解其他 WebAPI 就会轻松很多了，因为大部分 WebAPI 的工作逻辑都是类似的。</p>
<h1 id="宏任务和微任务：不是所有的任务都是一个待遇"><a href="#%E5%AE%8F%E4%BB%BB%E5%8A%A1%E5%92%8C%E5%BE%AE%E4%BB%BB%E5%8A%A1%EF%BC%9A%E4%B8%8D%E6%98%AF%E6%89%80%E6%9C%89%E7%9A%84%E4%BB%BB%E5%8A%A1%E9%83%BD%E6%98%AF%E4%B8%80%E4%B8%AA%E5%BE%85%E9%81%87" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>宏任务和微任务：不是所有的任务都是一个待遇</h1>
<p>在前面几篇文章中，我们介绍了消息队列，并结合消息队列介绍了两种典型的 WebAPI——setTimeout 和 XMLHttpRequest，通过这两个 WebAPI 我们搞清楚了浏览器的消息循环系统是怎么工作的。不过随着浏览器的应用领域越来越广泛，消息队列中这种粗时间颗粒度的任务已经不能胜任部分领域的需求，所以又出现了一种新的技术——微任务。微任务可以在实时性和效率之间做一个有效的权衡。</p>
<p>从目前的情况来看，微任务已经被广泛地应用，基于微任务的技术有 MutationObserver、Promise 以及以 Promise 为基础开发出来的很多其他的技术。所以微任务的重要性也与日俱增，了解其底层的工作原理对于你读懂别人的代码，以及写出更高效、更具现代的代码有着决定性的作用。</p>
<p>有微任务，也就有宏任务，那这二者到底有什么区别？它们又是如何相互取长补短的？</p>
<h2 id="宏任务"><a href="#%E5%AE%8F%E4%BB%BB%E5%8A%A1" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>宏任务</h2>
<p>前面我们已经介绍过了，页面中的大部分任务都是在主线程上执行的，这些任务包括了：</p>
<ul>
<li>渲染事件（如解析 DOM、计算布局、绘制）；</li>
<li>用户交互事件（如鼠标点击、滚动页面、放大缩小等）；</li>
<li>JavaScript 脚本执行事件；</li>
<li>网络请求完成、文件读写完成事件。</li>
</ul>
<p>为了协调这些任务有条不紊地在主线程上执行，页面进程引入了消息队列和事件循环机制，渲染进程内部会维护多个消息队列，比如延迟执行队列和普通的消息队列。然后主线程采用一个 for 循环，不断地从这些任务队列中取出任务并执行任务。我们把这些消息队列中的任务称为宏任务。</p>
<p>消息队列中的任务是通过事件循环系统来执行的，这里我们可以看看在 WHATWG 规范中是怎么定义事件循环机制的。</p>
<p>由于规范需要支持语义上的完备性，所以通常写得都会比较啰嗦，这里我就大致总结了下 WHATWG 规范定义的大致流程：</p>
<ul>
<li>先从多个消息队列中选出一个最老的任务，这个任务称为 oldestTask；</li>
<li>然后循环系统记录任务开始执行的时间，并把这个 oldestTask 设置为当前正在执行的任务；</li>
<li>当任务执行完成之后，删除当前正在执行的任务，并从对应的消息队列中删除掉这个 oldestTask；</li>
<li>最后统计执行完成的时长等信息。</li>
</ul>
<p>以上就是消息队列中宏任务的执行过程，通过前面的学习，相信你也很熟悉这套执行流程了。</p>
<p>宏任务可以满足我们大部分的日常需求，不过如果有对时间精度要求较高的需求，宏任务就难以胜任了，下面我们就来分析下为什么宏任务难以满足对时间精度要求较高的任务。</p>
<p>前面我们说过，页面的渲染事件、各种 IO 的完成事件、执行 JavaScript 脚本的事件、用户交互的事件等都随时有可能被添加到消息队列中，而且添加事件是由系统操作的，JavaScript 代码不能准确掌控任务要添加到队列中的位置，控制不了任务在消息队列中的位置，所以很难控制开始执行任务的时间。为了直观理解，你可以看下面这段代码：</p>
<div
              class="gatsby-code-button-container"
              data-toaster-id="76598148833379190000"
              data-toaster-class="gatsby-code-button-toaster"
              data-toaster-text-class="gatsby-code-button-toaster-text"
              data-toaster-text="复制成功"
              data-toaster-duration="3500"
              onClick="copyToClipboard(`<!DOCTYPE html>
<html>
  <body>
    <div id=&quot;demo&quot;>
      <ol>
        <li>test</li>
      </ol>
    </div>
  </body>
  <script type=&quot;text/javascript&quot;>
    function timerCallback2() {
      console.log(2);
    }
    function timerCallback() {
      console.log(1);
      setTimeout(timerCallback2, 0);
    }
    setTimeout(timerCallback, 0);
  </script>
</html>`, `76598148833379190000`)"
            >
              <div
                class="gatsby-code-button"
                
              >
                html 复制代码
              </div>
            </div>
<div class="gatsby-highlight" data-language="html"><pre style="counter-reset: linenumber NaN" class="language-html line-numbers"><code class="language-html"><span class="token doctype">&lt;!DOCTYPE html></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>demo<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ol</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">></span></span>test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">></span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ol</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>text/javascript<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">
    <span class="token keyword">function</span> <span class="token function">timerCallback2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">function</span> <span class="token function">timerCallback</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">setTimeout</span><span class="token punctuation">(</span>timerCallback2<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span>timerCallback<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>在这段代码中，我的目的是想通过 setTimeout 来设置两个回调任务，并让它们按照前后顺序来执行，中间也不要再插入其他的任务，因为如果这两个任务的中间插入了其他的任务，就很有可能会影响到第二个定时器的执行时间了。</p>
<p>但实际情况是我们不能控制的，比如在你调用 setTimeout 来设置回调任务的间隙，消息队列中就有可能被插入很多系统级的任务。你可以打开 Performance 工具，来记录下这段任务的执行过程，也可参考文中我记录的图片：</p>
<p>
  <a
    class="gatsby-resp-image-link"
    href="/static/2021-07-06-17-57-31-729686ac6d9ac5e589055eaaeb1f77b9-3c94e.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
  
  <span
    class="gatsby-resp-image-wrapper"
    style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;"
  >
    <span
      class="gatsby-resp-image-background-image"
      style="padding-bottom: 43.279172821270315%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAIAAAC9o5sfAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABrElEQVQoz32RPW/TUBSG/RuYkGBm6dK9IAQDA8rCyoQYWZDgXzAjZiRagVqQAqhQaJQPRQgatylxaxc7aUnSOrXje23XubHv9+XSEokO8OgsRzrvkc55DCUl51wIoX4jZ/UPpEbIU3RnFAU+HoUUM0o5YZIwVRBZYJwXf8jzHOshDWFCKl2MS86YzhtpelJv1Wutqu3a7S9ly/zo2c2h6x1ud0bdg4Hj9p0f4X7f3/N6HXNna23gNiDwMVVCSINzGSRwOB6lCI97687yTb96Hxd8cnQc1yrxuzew/DqufEo2WtMs6a4/7L69Q5IuFTosjMkUBSCkku+NrEbPLFefvXj/9KtvbTZftecv1eYufpu/vHHlwv6Du0SpVv+kvIvMIxYhpH9ljOOg0f7ctOr2Qf1JY3hjUd1aEivOz35n1StdbZcWtkoLm9fm7Ef33KjzeBVcf65uL+KKsytFbui7JxmCIFGM7oRq6Tt9aVE/078UDCGVT2mawsMhDAKUZeag+OCyNY+G8VQJbpwTMZMk/2PrL86HpTr1pwghAAAIQAxhFEW6PRs4UyVmm38BrgrfBu/ZH9gAAAAASUVORK5CYII='); background-size: cover; display: block;"
    >
      <img
        class="gatsby-resp-image-image"
        style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;"
        alt="2021 07 06 17 57 31"
        title=""
        src="/static/2021-07-06-17-57-31-729686ac6d9ac5e589055eaaeb1f77b9-fee1c.png"
        srcset="/static/2021-07-06-17-57-31-729686ac6d9ac5e589055eaaeb1f77b9-a67b7.png 200w,
/static/2021-07-06-17-57-31-729686ac6d9ac5e589055eaaeb1f77b9-0b187.png 400w,
/static/2021-07-06-17-57-31-729686ac6d9ac5e589055eaaeb1f77b9-fee1c.png 800w,
/static/2021-07-06-17-57-31-729686ac6d9ac5e589055eaaeb1f77b9-b1a91.png 1200w,
/static/2021-07-06-17-57-31-729686ac6d9ac5e589055eaaeb1f77b9-3c94e.png 1354w"
        sizes="(max-width: 800px) 100vw, 800px"
      />
    </span>
  </span>
  
  </a>
    </p>
<p>setTimeout 函数触发的回调函数都是宏任务，如图中，左右两个黄色块就是 setTimeout 触发的两个定时器任务。</p>
<p>现在你可以重点观察上图中间浅红色区域，这里有很多一段一段的任务，这些是被渲染引擎插在两个定时器任务中间的任务。试想一下，如果中间被插入的任务执行时间过久的话，那么就会影响到后面任务的执行了。</p>
<p>所以说宏任务的时间粒度比较大，执行的时间间隔是不能精确控制的，对一些高实时性的需求就不太符合了，比如后面要介绍的监听 DOM 变化的需求。</p>
<h2 id="微任务"><a href="#%E5%BE%AE%E4%BB%BB%E5%8A%A1" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>微任务</h2>
<p>在理解了宏任务之后，下面我们就可以来看看什么是微任务了。在上一篇文章中，我们介绍过异步回调的概念，其主要有两种方式。</p>
<p>第一种是把异步回调函数封装成一个宏任务，添加到消息队列尾部，当循环系统执行到该任务的时候执行回调函数。这种比较好理解，我们前面介绍的 setTimeout 和 XMLHttpRequest 的回调函数都是通过这种方式来实现的。</p>
<p>第二种方式的执行时机是在主函数执行结束之后、当前宏任务结束之前执行回调函数，这通常都是以微任务形式体现的。</p>
<p>那这里说的微任务到底是什么呢？</p>
<p>微任务就是一个需要异步执行的函数，执行时机是在主函数执行结束之后、当前宏任务结束之前。</p>
<p>不过要搞清楚微任务系统是怎么运转起来的，就得站在 V8 引擎的层面来分析下。</p>
<p>我们知道当 JavaScript 执行一段脚本的时候，V8 会为其创建一个全局执行上下文，在创建全局执行上下文的同时，V8 引擎也会在内部创建一个微任务队列。顾名思义，这个微任务队列就是用来存放微任务的，因为在当前宏任务执行的过程中，有时候会产生多个微任务，这时候就需要使用这个微任务队列来保存这些微任务了。不过这个微任务队列是给 V8 引擎内部使用的，所以你是无法通过 JavaScript 直接访问的。</p>
<p>也就是说每个宏任务都关联了一个微任务队列。那么接下来，我们就需要分析两个重要的时间点——微任务产生的时机和执行微任务队列的时机。</p>
<p>我们先来看看微任务是怎么产生的？在现代浏览器里面，产生微任务有两种方式。</p>
<p>第一种方式是使用 MutationObserver 监控某个 DOM 节点，然后再通过 JavaScript 来修改这个节点，或者为这个节点添加、删除部分子节点，当 DOM 节点发生变化时，就会产生 DOM 变化记录的微任务。</p>
<p>第二种方式是使用 Promise，当调用 Promise.resolve() 或者 Promise.reject() 的时候，也会产生微任务。</p>
<p>通过 DOM 节点变化产生的微任务或者使用 Promise 产生的微任务都会被 JavaScript 引擎按照顺序保存到微任务队列中。</p>
<p>好了，现在微任务队列中有了微任务了，那接下来就要看看微任务队列是何时被执行的。</p>
<p>通常情况下，在当前宏任务中的 JavaScript 快执行完成时，也就在 JavaScript 引擎准备退出全局执行上下文并清空调用栈的时候，JavaScript 引擎会检查全局执行上下文中的微任务队列，然后按照顺序执行队列中的微任务。WHATWG 把执行微任务的时间点称为检查点。当然除了在退出全局执行上下文式这个检查点之外，还有其他的检查点，不过不是太重要，这里就不做介绍了。</p>
<p>如果在执行微任务的过程中，产生了新的微任务，同样会将该微任务添加到微任务队列中，V8 引擎一直循环执行微任务队列中的任务，直到队列为空才算执行结束。也就是说在执行微任务过程中产生的新的微任务并不会推迟到下个宏任务中执行，而是在当前的宏任务中继续执行。</p>
<p>为了直观地理解什么是微任务，你可以参考下面我画的示意图（由于内容比较多，我将其分为了两张）：</p>
<p>
  <a
    class="gatsby-resp-image-link"
    href="/static/2021-07-06-17-58-03-916d1ee0ce7a4f58a92960abc8e3ead3-62dab.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
  
  <span
    class="gatsby-resp-image-wrapper"
    style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;"
  >
    <span
      class="gatsby-resp-image-background-image"
      style="padding-bottom: 47.447447447447445%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAIAAAC9o5sfAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABxUlEQVQoz1VR30/aUBjlrxsxPvtAptPs2Sdf92I0ZsmSZS8+sGQuRigiiGgGBqPZFEdCIkqBgtoSNbZ3/UF7W/qLtvT2rkCIevIl934599zvyzkRPEUQBBij8Jx04zt+zfpvgRCKTBiM/Hsgn3dhmZYu7oUyo1S6smFa4SN3DMd1oKpa9sC07ElpmhYJlb5tY8/O1EAsxy6mqPkdciHDLBcB1HTXcQAAiqIgf+i5zutdDMMIxci3bKwreZKfI+iFRONDqh1LtFYKj5puBgESBDGcPHC9XFNKNCBByskmTLX1Bx6OJ5smVqXkFb9R1b9V/n0pc5t1Y/mkJ8iq1deUXs+zDFZU187Yg7r485zOX4Ovl2KpI47EKFzb1gsVmjn7LR1leqVf4lH283EXyH3sOchx8NBlebh92qKJHSqdftgjDoniKa2MDENjn4uU+CnbWCP+ru9VV3er6ydPat+cshiag/nUbTR+MxuvzX6/iW7dXtwJE/HI8RzJv8+Dj/vMUrq9dPi8UhoZ9iLWrdguE92m38WvZ340o8nnPx0QwdNkWyzMNqR8nc3Vng5IvtCWwmCm+WNvOOxwkOJUilUoDrY4NfzuP6NF0aqXxnOsAAAAAElFTkSuQmCC'); background-size: cover; display: block;"
    >
      <img
        class="gatsby-resp-image-image"
        style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;"
        alt="2021 07 06 17 58 03"
        title=""
        src="/static/2021-07-06-17-58-03-916d1ee0ce7a4f58a92960abc8e3ead3-fee1c.png"
        srcset="/static/2021-07-06-17-58-03-916d1ee0ce7a4f58a92960abc8e3ead3-a67b7.png 200w,
/static/2021-07-06-17-58-03-916d1ee0ce7a4f58a92960abc8e3ead3-0b187.png 400w,
/static/2021-07-06-17-58-03-916d1ee0ce7a4f58a92960abc8e3ead3-fee1c.png 800w,
/static/2021-07-06-17-58-03-916d1ee0ce7a4f58a92960abc8e3ead3-b1a91.png 1200w,
/static/2021-07-06-17-58-03-916d1ee0ce7a4f58a92960abc8e3ead3-62dab.png 1332w"
        sizes="(max-width: 800px) 100vw, 800px"
      />
    </span>
  </span>
  
  </a>
    </p>
<p>该示意图是在执行一个 ParseHTML 的宏任务，在执行过程中，遇到了 JavaScript 脚本，那么就暂停解析流程，进入到 JavaScript 的执行环境。从图中可以看到，全局上下文中包含了微任务列表。</p>
<p>在 JavaScript 脚本的后续执行过程中，分别通过 Promise 和 removeChild 创建了两个微任务，并被添加到微任务列表中。接着 JavaScript 执行结束，准备退出全局执行上下文，这时候就到了检查点了，JavaScript 引擎会检查微任务列表，发现微任务列表中有微任务，那么接下来，依次执行这两个微任务。等微任务队列清空之后，就退出全局执行上下文。</p>
<p>以上就是微任务的工作流程，从上面分析我们可以得出如下几个结论：</p>
<ul>
<li>微任务和宏任务是绑定的，每个宏任务在执行时，会创建自己的微任务队列。</li>
<li>微任务的执行时长会影响到当前宏任务的时长。比如一个宏任务在执行过程中，产生了 100 个微任务，执行每个微任务的时间是 10 毫秒，那么执行这 100 个微任务的时间就是 1000 毫秒，也可以说这 100 个微任务让宏任务的执行时间延长了 1000 毫秒。所以你在写代码的时候一定要注意控制微任务的执行时长。</li>
<li>在一个宏任务中，分别创建一个用于回调的宏任务和微任务，无论什么情况下，微任务都早于宏任务执行。</li>
</ul>
<h2 id="监听-dom-变化方法演变"><a href="#%E7%9B%91%E5%90%AC-dom-%E5%8F%98%E5%8C%96%E6%96%B9%E6%B3%95%E6%BC%94%E5%8F%98" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>监听 DOM 变化方法演变</h2>
<p>现在知道了微任务是怎么工作的，那接下来我们再来看看微任务是如何应用在 MutationObserver 中的。MutationObserver 是用来监听 DOM 变化的一套方法，而监听 DOM 变化一直是前端工程师一项非常核心的需求。</p>
<p>比如许多 Web 应用都利用 HTML 与 JavaScript 构建其自定义控件，与一些内置控件不同，这些控件不是固有的。为了与内置控件一起良好地工作，这些控件必须能够适应内容更改、响应事件和用户交互。因此，Web 应用需要监视 DOM 变化并及时地做出响应。</p>
<p>虽然监听 DOM 的需求是如此重要，不过早期页面并没有提供对监听的支持，所以那时要观察 DOM 是否变化，唯一能做的就是轮询检测，比如使用 setTimeout 或者 setInterval 来定时检测 DOM 是否有改变。这种方式简单粗暴，但是会遇到两个问题：如果时间间隔设置过长，DOM 变化响应不够及时；反过来如果时间间隔设置过短，又会浪费很多无用的工作量去检查 DOM，会让页面变得低效。</p>
<p>直到 2000 年的时候引入了 Mutation Event，Mutation Event 采用了观察者的设计模式，当 DOM 有变动时就会立刻触发相应的事件，这种方式属于同步回调。</p>
<p>采用 Mutation Event 解决了实时性的问题，因为 DOM 一旦发生变化，就会立即调用 JavaScript 接口。但也正是这种实时性造成了严重的性能问题，因为每次 DOM 变动，渲染引擎都会去调用 JavaScript，这样会产生较大的性能开销。比如利用 JavaScript 动态创建或动态修改 50 个节点内容，就会触发 50 次回调，而且每个回调函数都需要一定的执行时间，这里我们假设每次回调的执行时间是 4 毫秒，那么 50 次回调的执行时间就是 200 毫秒，若此时浏览器正在执行一个动画效果，由于 Mutation Event 触发回调事件，就会导致动画的卡顿。</p>
<p>也正是因为使用 Mutation Event 会导致页面性能问题，所以 Mutation Event 被反对使用，并逐步从 Web 标准事件中删除了。</p>
<p>为了解决了 Mutation Event 由于同步调用 JavaScript 而造成的性能问题，从 DOM4 开始，推荐使用 MutationObserver 来代替 Mutation Event。MutationObserver API 可以用来监视 DOM 的变化，包括属性的变化、节点的增减、内容的变化等。</p>
<p>那么相比较 Mutation Event，MutationObserver 到底做了哪些改进呢？</p>
<p>首先，MutationObserver 将响应函数改成异步调用，可以不用在每次 DOM 变化都触发异步调用，而是等多次 DOM 变化后，一次触发异步调用，并且还会使用一个数据结构来记录这期间所有的 DOM 变化。这样即使频繁地操纵 DOM，也不会对性能造成太大的影响。</p>
<p>我们通过异步调用和减少触发次数来缓解了性能问题，那么如何保持消息通知的及时性呢？如果采用 setTimeout 创建宏任务来触发回调的话，那么实时性就会大打折扣，因为上面我们分析过，在两个任务之间，可能会被渲染进程插入其他的事件，从而影响到响应的实时性。</p>
<p>这时候，微任务就可以上场了，在每次 DOM 节点发生变化的时候，渲染引擎将变化记录封装成微任务，并将微任务添加进当前的微任务队列中。这样当执行到检查点的时候，V8 引擎就会按照顺序执行微任务了。</p>
<p>综上所述， MutationObserver 采用了“异步 + 微任务”的策略。</p>
<ul>
<li>通过异步操作解决了同步操作的性能问题；</li>
<li>通过微任务解决了实时性的问题。</li>
</ul>
<h2 id="总结-3"><a href="#%E6%80%BB%E7%BB%93-3" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>总结</h2>
<p>首先我们回顾了宏任务，然后在宏任务的基础之上，我们分析了异步回调函数的两种形式，其中最后一种回调的方式就是通过微任务来实现的。</p>
<p>接下来我们详细分析了浏览器是如何实现微任务的，包括微任务队列、检查点等概念。</p>
<p>最后我们介绍了监听 DOM 变化技术方案的演化史，从轮询到 Mutation Event 再到最新使用的 MutationObserver。MutationObserver 方案的核心就是采用了微任务机制，有效地权衡了实时性和执行效率的问题。</p>
<h1 id="使用-promise-告别回调函数"><a href="#%E4%BD%BF%E7%94%A8-promise-%E5%91%8A%E5%88%AB%E5%9B%9E%E8%B0%83%E5%87%BD%E6%95%B0" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>使用 Promise 告别回调函数</h1>
<p>在上一篇文章中我们聊到了微任务是如何工作的，并介绍了 MutationObserver 是如何利用微任务来权衡性能和效率的。今天我们就接着来聊聊微任务的另外一个应用 Promise，DOM/BOM API 中新加入的 API 大多数都是建立在 Promise 上的，而且新的前端框架也使用了大量的 Promise。可以这么说，Promise 已经成为现代前端的“水”和“电”，很是关键，所以深入学习 Promise 势在必行。</p>
<p>不过，Promise 的知识点有那么多，而我们只有一篇文章来介绍，那应该怎么讲解呢？具体讲解思路是怎样的呢？</p>
<p>如果你想要学习一门新技术，最好的方式是先了解这门技术是如何诞生的，以及它所解决的问题是什么。了解了这些后，你才能抓住这门技术的本质。所以本文我们就来重点聊聊 JavaScript 引入 Promise 的动机，以及解决问题的几个核心关键点。</p>
<p>要谈动机，我们一般都是先从问题切入，那么 Promise 到底解决了什么问题呢？在正式开始介绍之前，我想有必要明确下，Promise 解决的是异步编码风格的问题，而不是一些其他的问题，所以接下来我们聊的话题都是围绕编码风格展开的</p>
<h2 id="异步编程的问题：代码逻辑不连续"><a href="#%E5%BC%82%E6%AD%A5%E7%BC%96%E7%A8%8B%E7%9A%84%E9%97%AE%E9%A2%98%EF%BC%9A%E4%BB%A3%E7%A0%81%E9%80%BB%E8%BE%91%E4%B8%8D%E8%BF%9E%E7%BB%AD" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>异步编程的问题：代码逻辑不连续</h2>
<p>首先我们来回顾下 JavaScript 的异步编程模型，你应该已经非常熟悉页面的事件循环系统了，也知道页面中任务都是执行在主线程之上的，相对于页面来说，主线程就是它整个的世界，所以在执行一项耗时的任务时，比如下载网络文件任务、获取摄像头等设备信息任务，这些任务都会放到页面主线程之外的进程或者线程中去执行，这样就避免了耗时任务“霸占”页面主线程的情况。你可以结合下图来看看这个处理过程：</p>
<p>
  <a
    class="gatsby-resp-image-link"
    href="/static/2021-07-07-09-21-26-007246b0e3bebe20095091d4e5b51a4e-2cdbf.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
  
  <span
    class="gatsby-resp-image-wrapper"
    style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;"
  >
    <span
      class="gatsby-resp-image-background-image"
      style="padding-bottom: 68.9041095890411%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAIAAACgpqunAAAACXBIWXMAAA7DAAAOwwHHb6hkAAACfUlEQVQoz21SS08TURTuf/E3GF249JEY/RdudEPcuNCd0YgxcSE+CljjQjEElAWKTUtfUKGUtrYUpICdGdppKe2087jPmbkz1zsFGxP5cnJy7jn3O/ecLzfk+T7FyLeRR09NxNyB3Pk3iYdJRBlzXVtUHYIEMcQ9Vu8Ya02cG9pGE2UUEJfgsgTTCsipKKcGyfQhTkqwU93ZqTW/yc6OqnOfhTj3lna1jzk5WVWiW41ktfEgpV+cdy7MufdSZrIifS9J2V+N+7HW9XdKeezOxLOZc5/oVL4riMHLcg/8UMB6vb+m0mxlO7k8+zX+eTH+JRH9kFtPzK/V3sc238ZKC5tyv7a/d9CKq17tyAxedl0XIcQFHBr4UsQdP289uYaeXmXjl/hqRFKUleXv2US0Ud8Tdd/3hIcQCmJISAAgYsyzCWGck3YVZGb1zGInPncUnelV8l3dMAGEmBDbEddc5jGfWwCyIZkhhEVHzpxhY184WT5IJGMrq+mVTCKfTROM/pZOIYYVRCEYi9d6Lzb60xvdcNEIFwZT653nmeaj6MFEqv4qLT2OSy9zvcmi8aaghwv6ZFGfyBuZ/Z4gCrLf6KNSwywfDootWFJBUdLKbbR1TPc1+rtPt49JpQ3LLXBilTYoqqCli2F5iHkeApaLLAYN7hHOMMeG8L6DbQwphg6GLkEjcwhkFFmGHowtRBPbizY/D83bi827se7YknprQQ5vaiLp+fxk0dG6J8FIbdYf6EKtVK17+XXhZmTrxnTpSmT3YfqYuxQJkf8DpXQwGARk0ca2bXEm1LaIbeHAAHUxdUawh6BDjAI/+NtnwaYEQWAYhmmamqaJIc+89gdS6e5pSRHYswAAAABJRU5ErkJggg=='); background-size: cover; display: block;"
    >
      <img
        class="gatsby-resp-image-image"
        style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;"
        alt="2021 07 07 09 21 26"
        title=""
        src="/static/2021-07-07-09-21-26-007246b0e3bebe20095091d4e5b51a4e-fee1c.png"
        srcset="/static/2021-07-07-09-21-26-007246b0e3bebe20095091d4e5b51a4e-a67b7.png 200w,
/static/2021-07-07-09-21-26-007246b0e3bebe20095091d4e5b51a4e-0b187.png 400w,
/static/2021-07-07-09-21-26-007246b0e3bebe20095091d4e5b51a4e-fee1c.png 800w,
/static/2021-07-07-09-21-26-007246b0e3bebe20095091d4e5b51a4e-b1a91.png 1200w,
/static/2021-07-07-09-21-26-007246b0e3bebe20095091d4e5b51a4e-2cdbf.png 1460w"
        sizes="(max-width: 800px) 100vw, 800px"
      />
    </span>
  </span>
  
  </a>
    </p>
<p>上图展示的是一个标准的异步编程模型，页面主线程发起了一个耗时的任务，并将任务交给另外一个进程去处理，这时页面主线程会继续执行消息队列中的任务。等该进程处理完这个任务后，会将该任务添加到渲染进程的消息队列中，并排队等待循环系统的处理。排队结束之后，循环系统会取出消息队列中的任务进行处理，并触发相关的回调操作。</p>
<p>这就是页面编程的一大特点：异步回调。</p>
<p>Web 页面的单线程架构决定了异步回调，而异步回调影响到了我们的编码方式，到底是如何影响的呢？</p>
<p>假设有一个下载的需求，使用 XMLHttpRequest 来实现，具体的实现方式你可以参考下面这段代码：</p>
<div
              class="gatsby-code-button-container"
              data-toaster-id="68489788457813746000"
              data-toaster-class="gatsby-code-button-toaster"
              data-toaster-text-class="gatsby-code-button-toaster-text"
              data-toaster-text="复制成功"
              data-toaster-duration="3500"
              onClick="copyToClipboard(`// 执行状态
function onResolve(response) {
  console.log(response);
}
function onReject(error) {
  console.log(error);
}

let xhr = new XMLHttpRequest();
xhr.ontimeout = function(e) {
  onReject(e);
};
xhr.onerror = function(e) {
  onReject(e);
};
xhr.onreadystatechange = function() {
  onResolve(xhr.response);
};

// 设置请求类型，请求 URL，是否同步信息
let URL = 'https://time.geekbang.com';
xhr.open('Get', URL, true);

// 设置参数
xhr.timeout = 3000; // 设置 xhr 请求的超时时间
xhr.responseType = 'text'; // 设置响应返回的数据格式
xhr.setRequestHeader('X_TEST', 'time.geekbang');

// 发出请求
xhr.send();`, `68489788457813746000`)"
            >
              <div
                class="gatsby-code-button"
                
              >
                js 复制代码
              </div>
            </div>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// 执行状态</span>
<span class="token keyword">function</span> <span class="token function">onResolve</span><span class="token punctuation">(</span><span class="token parameter">response</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">onReject</span><span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">let</span> xhr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XMLHttpRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
xhr<span class="token punctuation">.</span><span class="token function-variable function">ontimeout</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">onReject</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
xhr<span class="token punctuation">.</span><span class="token function-variable function">onerror</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">onReject</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
xhr<span class="token punctuation">.</span><span class="token function-variable function">onreadystatechange</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">onResolve</span><span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>response<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// 设置请求类型，请求 URL，是否同步信息</span>
<span class="token keyword">let</span> <span class="token constant">URL</span> <span class="token operator">=</span> <span class="token string">'https://time.geekbang.com'</span><span class="token punctuation">;</span>
xhr<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">'Get'</span><span class="token punctuation">,</span> <span class="token constant">URL</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 设置参数</span>
xhr<span class="token punctuation">.</span>timeout <span class="token operator">=</span> <span class="token number">3000</span><span class="token punctuation">;</span> <span class="token comment">// 设置 xhr 请求的超时时间</span>
xhr<span class="token punctuation">.</span>responseType <span class="token operator">=</span> <span class="token string">'text'</span><span class="token punctuation">;</span> <span class="token comment">// 设置响应返回的数据格式</span>
xhr<span class="token punctuation">.</span><span class="token function">setRequestHeader</span><span class="token punctuation">(</span><span class="token string">'X_TEST'</span><span class="token punctuation">,</span> <span class="token string">'time.geekbang'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 发出请求</span>
xhr<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>我们执行上面这段代码，可以正常输出结果的。但是，这短短的一段代码里面竟然出现了五次回调，这么多的回调会导致代码的逻辑不连贯、不线性，非常不符合人的直觉，这就是异步回调影响到我们的编码方式。</p>
<p>那有什么方法可以解决这个问题吗？当然有，我们可以封装这堆凌乱的代码，降低处理异步回调的次数。</p>
<h2 id="封装异步代码，让处理流程变得线性"><a href="#%E5%B0%81%E8%A3%85%E5%BC%82%E6%AD%A5%E4%BB%A3%E7%A0%81%EF%BC%8C%E8%AE%A9%E5%A4%84%E7%90%86%E6%B5%81%E7%A8%8B%E5%8F%98%E5%BE%97%E7%BA%BF%E6%80%A7" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>封装异步代码，让处理流程变得线性</h2>
<p>由于我们重点关注的是输入内容（请求信息）和输出内容（回复信息），至于中间的异步请求过程，我们不想在代码里面体现太多，因为这会干扰核心的代码逻辑。整体思路如下图所示：</p>
<p>
  <a
    class="gatsby-resp-image-link"
    href="/static/2021-07-07-09-22-21-653caa17dff3967dd4c65dbe4f8088d3-abd93.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
  
  <span
    class="gatsby-resp-image-wrapper"
    style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;"
  >
    <span
      class="gatsby-resp-image-background-image"
      style="padding-bottom: 49.36886395511922%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAIAAAA7N+mxAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABW0lEQVQoz5WRTU7CQBiGuZlbV17CC7jwAC5deAU2LkwgGE2MIcaGUBPUtKGmJE1LQdvOtNDfYaydIrRTnBZJ1MDCN5nNfO/z/dZWu5XTFXgvnLjYZaixV/xW9VPGwrQ4uFgcXi/oH5yFK0dta8rlMmNKyKIppzdKmi2ZMkrplsoYY9u2w0pxHDPj1AbmSAWWEdiGBw3rbWy9aniG8jxPCEk8d64MaEpKGELIcZxQSR9qISbjTl043dOFO32oW8BRWifi2f7E0JzJNJ4hNFTDq2aGohJ2HKfb7fb7fVmWIQTsB+gD5fEWAMv0PzoPPb7d0kWOxJg1jzAONTW4bORrmFXmeV4URUmSLFDCEEBlZKrPbfn86L5V7wkvhgmSJGEhNvl6qd8zE0IQYhlxFEVrBwr8ieubEjduHLvqk+tH3tT5nM83y/4Bb9fmbrT4552r9oog8H3fY03twr8AklwuG3/VCaAAAAAASUVORK5CYII='); background-size: cover; display: block;"
    >
      <img
        class="gatsby-resp-image-image"
        style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;"
        alt="2021 07 07 09 22 21"
        title=""
        src="/static/2021-07-07-09-22-21-653caa17dff3967dd4c65dbe4f8088d3-fee1c.png"
        srcset="/static/2021-07-07-09-22-21-653caa17dff3967dd4c65dbe4f8088d3-a67b7.png 200w,
/static/2021-07-07-09-22-21-653caa17dff3967dd4c65dbe4f8088d3-0b187.png 400w,
/static/2021-07-07-09-22-21-653caa17dff3967dd4c65dbe4f8088d3-fee1c.png 800w,
/static/2021-07-07-09-22-21-653caa17dff3967dd4c65dbe4f8088d3-b1a91.png 1200w,
/static/2021-07-07-09-22-21-653caa17dff3967dd4c65dbe4f8088d3-abd93.png 1426w"
        sizes="(max-width: 800px) 100vw, 800px"
      />
    </span>
  </span>
  
  </a>
    </p>
<p>从图中你可以看到，我们将 XMLHttpRequest 请求过程的代码封装起来了，重点关注输入数据和输出结果。</p>
<p>那我们就按照这个思路来改造代码。首先，我们把输入的 HTTP 请求信息全部保存到一个 request 的结构中，包括请求地址、请求头、请求方式、引用地址、同步请求还是异步请求、安全设置等信息。request 结构如下所示：</p>
<div
              class="gatsby-code-button-container"
              data-toaster-id="65931521719030290000"
              data-toaster-class="gatsby-code-button-toaster"
              data-toaster-text-class="gatsby-code-button-toaster-text"
              data-toaster-text="复制成功"
              data-toaster-duration="3500"
              onClick="copyToClipboard(`//makeRequest 用来构造 request 对象
function makeRequest(request_url) {
  let request = {
    method: 'Get',
    url: request_url,
    headers: '',
    body: '',
    credentials: false,
    sync: true,
    responseType: 'text',
    referrer: ''
  };
  return request;
}`, `65931521719030290000`)"
            >
              <div
                class="gatsby-code-button"
                
              >
                js 复制代码
              </div>
            </div>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">//makeRequest 用来构造 request 对象</span>
<span class="token keyword">function</span> <span class="token function">makeRequest</span><span class="token punctuation">(</span><span class="token parameter">request_url</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> request <span class="token operator">=</span> <span class="token punctuation">{</span>
    method<span class="token punctuation">:</span> <span class="token string">'Get'</span><span class="token punctuation">,</span>
    url<span class="token punctuation">:</span> request_url<span class="token punctuation">,</span>
    headers<span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
    body<span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
    credentials<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    sync<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    responseType<span class="token punctuation">:</span> <span class="token string">'text'</span><span class="token punctuation">,</span>
    referrer<span class="token punctuation">:</span> <span class="token string">''</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> request<span class="token punctuation">;</span>
<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>然后就可以封装请求过程了，这里我们将所有的请求细节封装进 XFetch 函数，XFetch 代码如下所示：</p>
<div
              class="gatsby-code-button-container"
              data-toaster-id="5809508707555322000"
              data-toaster-class="gatsby-code-button-toaster"
              data-toaster-text-class="gatsby-code-button-toaster-text"
              data-toaster-text="复制成功"
              data-toaster-duration="3500"
              onClick="copyToClipboard(`//[in] request，请求信息，请求头，延时值，返回类型等
//[out] resolve, 执行成功，回调该函数
//[out] reject  执行失败，回调该函数
function XFetch(request, resolve, reject) {
  let xhr = new XMLHttpRequest();
  xhr.ontimeout = function(e) {
    reject(e);
  };
  xhr.onerror = function(e) {
    reject(e);
  };
  xhr.onreadystatechange = function() {
    if ((xhr.status = 200)) resolve(xhr.response);
  };
  xhr.open(request.method, URL, request.sync);
  xhr.timeout = request.timeout;
  xhr.responseType = request.responseType;
  // 补充其他请求信息
  //...
  xhr.send();
}`, `5809508707555322000`)"
            >
              <div
                class="gatsby-code-button"
                
              >
                js 复制代码
              </div>
            </div>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">//[in] request，请求信息，请求头，延时值，返回类型等</span>
<span class="token comment">//[out] resolve, 执行成功，回调该函数</span>
<span class="token comment">//[out] reject  执行失败，回调该函数</span>
<span class="token keyword">function</span> <span class="token function">XFetch</span><span class="token punctuation">(</span><span class="token parameter">request<span class="token punctuation">,</span> resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> xhr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XMLHttpRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  xhr<span class="token punctuation">.</span><span class="token function-variable function">ontimeout</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">reject</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  xhr<span class="token punctuation">.</span><span class="token function-variable function">onerror</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">reject</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  xhr<span class="token punctuation">.</span><span class="token function-variable function">onreadystatechange</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>status <span class="token operator">=</span> <span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token function">resolve</span><span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>response<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  xhr<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span>method<span class="token punctuation">,</span> <span class="token constant">URL</span><span class="token punctuation">,</span> request<span class="token punctuation">.</span>sync<span class="token punctuation">)</span><span class="token punctuation">;</span>
  xhr<span class="token punctuation">.</span>timeout <span class="token operator">=</span> request<span class="token punctuation">.</span>timeout<span class="token punctuation">;</span>
  xhr<span class="token punctuation">.</span>responseType <span class="token operator">=</span> request<span class="token punctuation">.</span>responseType<span class="token punctuation">;</span>
  <span class="token comment">// 补充其他请求信息</span>
  <span class="token comment">//...</span>
  xhr<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>这个 XFetch 函数需要一个 request 作为输入，然后还需要两个回调函数 resolve 和 reject，当请求成功时回调 resolve 函数，当请求出现问题时回调 reject 函数。</p>
<p>有了这些后，我们就可以来实现业务代码了，具体的实现方式如下所示：</p>
<div
              class="gatsby-code-button-container"
              data-toaster-id="96379613649906060000"
              data-toaster-class="gatsby-code-button-toaster"
              data-toaster-text-class="gatsby-code-button-toaster-text"
              data-toaster-text="复制成功"
              data-toaster-duration="3500"
              onClick="copyToClipboard(`XFetch(
  makeRequest('https://time.geekbang.org'),
  function resolve(data) {
    console.log(data);
  },
  function reject(e) {
    console.log(e);
  }
);`, `96379613649906060000`)"
            >
              <div
                class="gatsby-code-button"
                
              >
                js 复制代码
              </div>
            </div>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token function">XFetch</span><span class="token punctuation">(</span>
  <span class="token function">makeRequest</span><span class="token punctuation">(</span><span class="token string">'https://time.geekbang.org'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token keyword">function</span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token keyword">function</span> <span class="token function">reject</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<h2 id="新的问题：回调地狱"><a href="#%E6%96%B0%E7%9A%84%E9%97%AE%E9%A2%98%EF%BC%9A%E5%9B%9E%E8%B0%83%E5%9C%B0%E7%8B%B1" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>新的问题：回调地狱</h2>
<p>上面的示例代码已经比较符合人的线性思维了，在一些简单的场景下运行效果也是非常好的，不过一旦接触到稍微复杂点的项目时，你就会发现，如果嵌套了太多的回调函数就很容易使得自己陷入了回调地狱，不能自拔。你可以参考下面这段让人凌乱的代码：</p>
<div
              class="gatsby-code-button-container"
              data-toaster-id="4146038213688485400"
              data-toaster-class="gatsby-code-button-toaster"
              data-toaster-text-class="gatsby-code-button-toaster-text"
              data-toaster-text="复制成功"
              data-toaster-duration="3500"
              onClick="copyToClipboard(`XFetch(makeRequest('https://time.geekbang.org/?category'),
  function resolve(response) {
      console.log(response)
      XFetch(makeRequest('https://time.geekbang.org/column'),
          function resolve(response) {
              console.log(response)
              XFetch(makeRequest('https://time.geekbang.org')
                  function resolve(response) {
                      console.log(response)
                  }, function reject(e) {
                      console.log(e)
                  })
          }, function reject(e) {
              console.log(e)
          })
  }, function reject(e) {
      console.log(e)
  })`, `4146038213688485400`)"
            >
              <div
                class="gatsby-code-button"
                
              >
                js 复制代码
              </div>
            </div>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token function">XFetch</span><span class="token punctuation">(</span><span class="token function">makeRequest</span><span class="token punctuation">(</span><span class="token string">'https://time.geekbang.org/?category'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token keyword">function</span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token parameter">response</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span>
      <span class="token function">XFetch</span><span class="token punctuation">(</span><span class="token function">makeRequest</span><span class="token punctuation">(</span><span class="token string">'https://time.geekbang.org/column'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
          <span class="token keyword">function</span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token parameter">response</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
              console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span>
              <span class="token function">XFetch</span><span class="token punctuation">(</span><span class="token function">makeRequest</span><span class="token punctuation">(</span><span class="token string">'https://time.geekbang.org'</span><span class="token punctuation">)</span>
                  <span class="token keyword">function</span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token parameter">response</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span>
                  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token function">reject</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>
                  <span class="token punctuation">}</span><span class="token punctuation">)</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token function">reject</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
              console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>
          <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token function">reject</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>这段代码是先请求 time.geekbang.org/?category，如果请求成功的话，那么再请求 time.geekbang.org/column，如果再次请求成功的话，就继续请求 time.geekbang.org。也就是说这段代码用了三层嵌套请求，就已经让代码变得混乱不堪，所以，我们还需要解决这种嵌套调用后混乱的代码结构。</p>
<p>这段代码之所以看上去很乱，归结其原因有两点：</p>
<ul>
<li>第一是嵌套调用，下面的任务依赖上个任务的请求结果，并在上个任务的回调函数内部执行新的业务逻辑，这样当嵌套层次多了之后，代码的可读性就变得非常差了。</li>
<li>第二是任务的不确定性，执行每个任务都有两种可能的结果（成功或者失败），所以体现在代码中就需要对每个任务的执行结果做两次判断，这种对每个任务都要进行一次额外的错误处理的方式，明显增加了代码的混乱程度。</li>
</ul>
<p>原因分析出来后，那么问题的解决思路就很清晰了：</p>
<ul>
<li>第一是消灭嵌套调用；</li>
<li>第二是合并多个任务的错误处理。</li>
</ul>
<p>这么讲可能有点抽象，不过 Promise 已经帮助我们解决了这两个问题。那么接下来我们就来看看 Promise 是怎么消灭嵌套调用和合并多个任务的错误处理的。</p>
<h2 id="promise：消灭嵌套调用和多次错误处理"><a href="#promise%EF%BC%9A%E6%B6%88%E7%81%AD%E5%B5%8C%E5%A5%97%E8%B0%83%E7%94%A8%E5%92%8C%E5%A4%9A%E6%AC%A1%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Promise：消灭嵌套调用和多次错误处理</h2>
<p>首先，我们使用 Promise 来重构 XFetch 的代码，示例代码如下所示：</p>
<div
              class="gatsby-code-button-container"
              data-toaster-id="51937466637395530000"
              data-toaster-class="gatsby-code-button-toaster"
              data-toaster-text-class="gatsby-code-button-toaster-text"
              data-toaster-text="复制成功"
              data-toaster-duration="3500"
              onClick="copyToClipboard(`function XFetch(request) {
  function executor(resolve, reject) {
    let xhr = new XMLHttpRequest();
    xhr.open('GET', request.url, true);
    xhr.ontimeout = function(e) {
      reject(e);
    };
    xhr.onerror = function(e) {
      reject(e);
    };
    xhr.onreadystatechange = function() {
      if (this.readyState === 4) {
        if (this.status === 200) {
          resolve(this.responseText, this);
        } else {
          let error = {
            code: this.status,
            response: this.response
          };
          reject(error, this);
        }
      }
    };
    xhr.send();
  }
  return new Promise(executor);
}`, `51937466637395530000`)"
            >
              <div
                class="gatsby-code-button"
                
              >
                js 复制代码
              </div>
            </div>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">function</span> <span class="token function">XFetch</span><span class="token punctuation">(</span><span class="token parameter">request</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">function</span> <span class="token function">executor</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> xhr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XMLHttpRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    xhr<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">'GET'</span><span class="token punctuation">,</span> request<span class="token punctuation">.</span>url<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    xhr<span class="token punctuation">.</span><span class="token function-variable function">ontimeout</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">reject</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    xhr<span class="token punctuation">.</span><span class="token function-variable function">onerror</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">reject</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    xhr<span class="token punctuation">.</span><span class="token function-variable function">onreadystatechange</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>readyState <span class="token operator">===</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token number">200</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>responseText<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
          <span class="token keyword">let</span> error <span class="token operator">=</span> <span class="token punctuation">{</span>
            code<span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>status<span class="token punctuation">,</span>
            response<span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>response
          <span class="token punctuation">}</span><span class="token punctuation">;</span>
          <span class="token function">reject</span><span class="token punctuation">(</span>error<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    xhr<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span>executor<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>接下来，我们再利用 XFetch 来构造请求流程，代码如下：</p>
<div
              class="gatsby-code-button-container"
              data-toaster-id="52160263593709930000"
              data-toaster-class="gatsby-code-button-toaster"
              data-toaster-text-class="gatsby-code-button-toaster-text"
              data-toaster-text="复制成功"
              data-toaster-duration="3500"
              onClick="copyToClipboard(`var x1 = XFetch(makeRequest('https://time.geekbang.org/?category'));
var x2 = x1.then((value) => {
  console.log(value);
  return XFetch(makeRequest('https://www.geekbang.org/column'));
});
var x3 = x2.then((value) => {
  console.log(value);
  return XFetch(makeRequest('https://time.geekbang.org'));
});
x3.catch((error) => {
  console.log(error);
});`, `52160263593709930000`)"
            >
              <div
                class="gatsby-code-button"
                
              >
                js 复制代码
              </div>
            </div>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">var</span> x1 <span class="token operator">=</span> <span class="token function">XFetch</span><span class="token punctuation">(</span><span class="token function">makeRequest</span><span class="token punctuation">(</span><span class="token string">'https://time.geekbang.org/?category'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> x2 <span class="token operator">=</span> x1<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token function">XFetch</span><span class="token punctuation">(</span><span class="token function">makeRequest</span><span class="token punctuation">(</span><span class="token string">'https://www.geekbang.org/column'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> x3 <span class="token operator">=</span> x2<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token function">XFetch</span><span class="token punctuation">(</span><span class="token function">makeRequest</span><span class="token punctuation">(</span><span class="token string">'https://time.geekbang.org'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
x3<span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>你可以观察上面这两段代码，重点关注下 Promise 的使用方式。</p>
<ul>
<li>首先我们引入了 Promise，在调用 XFetch 时，会返回一个 Promise 对象。</li>
<li>构建 Promise 对象时，需要传入一个 executor 函数，XFetch 的主要业务流程都在 executor 函数中执行。</li>
<li>如果运行在 excutor 函数中的业务执行成功了，会调用 resolve 函数；如果执行失败了，则调用 reject 函数。</li>
<li>在 excutor 函数中调用 resolve 函数时，会触发 promise.then 设置的回调函数；而调用 reject 函数时，会触发 promise.catch 设置的回调函数</li>
</ul>
<p>以上简单介绍了 Promise 一些主要的使用方法，通过引入 Promise，上面这段代码看起来就非常线性了，也非常符合人的直觉，是不是很酷？基于这段代码，我们就可以来分析 Promise 是如何消灭嵌套回调和合并多个错误处理了。</p>
<p>我们先来看看 Promise 是怎么消灭嵌套回调的。产生嵌套函数的一个主要原因是在发起任务请求时会带上回调函数，这样当任务处理结束之后，下个任务就只能在回调函数中来处理了。</p>
<p>Promise 主要通过下面两步解决嵌套回调问题的。</p>
<p>首先，Promise 实现了回调函数的延时绑定。回调函数的延时绑定在代码上体现就是先创建 Promise 对象 x1，通过 Promise 的构造函数 executor 来执行业务逻辑；创建好 Promise 对象 x1 之后，再使用 x1.then 来设置回调函数。示范代码如下：</p>
<div
              class="gatsby-code-button-container"
              data-toaster-id="50028437679240140000"
              data-toaster-class="gatsby-code-button-toaster"
              data-toaster-text-class="gatsby-code-button-toaster-text"
              data-toaster-text="复制成功"
              data-toaster-duration="3500"
              onClick="copyToClipboard(`// 创建 Promise 对象 x1，并在 executor 函数中执行业务逻辑
function executor(resolve, reject) {
  resolve(100);
}
let x1 = new Promise(executor);

//x1 延迟绑定回调函数 onResolve
function onResolve(value) {
  console.log(value);
}
x1.then(onResolve);`, `50028437679240140000`)"
            >
              <div
                class="gatsby-code-button"
                
              >
                js 复制代码
              </div>
            </div>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// 创建 Promise 对象 x1，并在 executor 函数中执行业务逻辑</span>
<span class="token keyword">function</span> <span class="token function">executor</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">let</span> x1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span>executor<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//x1 延迟绑定回调函数 onResolve</span>
<span class="token keyword">function</span> <span class="token function">onResolve</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
x1<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>onResolve<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>其次，需要将回调函数 onResolve 的返回值穿透到最外层。因为我们会根据 onResolve 函数的传入值来决定创建什么类型的 Promise 任务，创建好的 Promise 对象需要返回到最外层，这样就可以摆脱嵌套循环了。你可以先看下面的代码：</p>
<p>
  <a
    class="gatsby-resp-image-link"
    href="/static/2021-07-07-09-26-17-4eedf9f9ac4ef89eccb3ce4b18a2644d-311f8.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
  
  <span
    class="gatsby-resp-image-wrapper"
    style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;"
  >
    <span
      class="gatsby-resp-image-background-image"
      style="padding-bottom: 86.61971830985915%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAARCAIAAABSJhvpAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABzUlEQVQ4y6WS224TMRCG86aIq3IDXFXc8CaIG3rTt0CqQKBIiFYKqGqU0j0kbLIeez1rr49r47RN2RwqKvHLsrSr+Twz/8wobsv3Dg3TXnW2S8d63TmZ7tZwrnmr26ZjfejvgkcPWAjrG6WZFaSslvnialHnixXJq6oCOisLQIIaqYS+97vwnaxNSY1sOeMEZRt8TGn6dHyIYSd2D1YqaBWsDUpF5XrRGd5oRBU2pQ7f2IW1tRVblXSekyyHbMmrZVNra4atbcEuu+Yn79vTk/bDO5xc/uaxIpxAQci8WlECzDobD2kNy/Nv5y+ef3919PPomRp/liEWC04Bshs2KyjhSJlgrBPCAJVd540ZGKYmF9M3r6/eHv86fonjL6k5Z60xRgjFUXc6teJ8mk9y2acrhE31azhI0d9ch3mhvn6yANgs62yC1SVvWDI/Pq6/hjnvAZEwquYXavpRFmNrlHMp2ybdQAM4faQf3itlIP8B0zNERnnXUFjVAkAYY2+jDsJbo/KNkOsloc2DMf8u+37DTC8FUo41IGsk5yoZ9VQ4tYjKlKwFWi/KeZpN3F/LRzOnzQwhPk2j+B86AKfBEELqugaA+laUUufcfuQf9J7Wa/K5hOwAAAAASUVORK5CYII='); background-size: cover; display: block;"
    >
      <img
        class="gatsby-resp-image-image"
        style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;"
        alt="2021 07 07 09 26 17"
        title=""
        src="/static/2021-07-07-09-26-17-4eedf9f9ac4ef89eccb3ce4b18a2644d-fee1c.png"
        srcset="/static/2021-07-07-09-26-17-4eedf9f9ac4ef89eccb3ce4b18a2644d-a67b7.png 200w,
/static/2021-07-07-09-26-17-4eedf9f9ac4ef89eccb3ce4b18a2644d-0b187.png 400w,
/static/2021-07-07-09-26-17-4eedf9f9ac4ef89eccb3ce4b18a2644d-fee1c.png 800w,
/static/2021-07-07-09-26-17-4eedf9f9ac4ef89eccb3ce4b18a2644d-b1a91.png 1200w,
/static/2021-07-07-09-26-17-4eedf9f9ac4ef89eccb3ce4b18a2644d-311f8.png 1420w"
        sizes="(max-width: 800px) 100vw, 800px"
      />
    </span>
  </span>
  
  </a>
    </p>
<p>现在我们知道了 Promise 通过回调函数延迟绑定和回调函数返回值穿透的技术，解决了循环嵌套。</p>
<p>那接下来我们再来看看 Promise 是怎么处理异常的，你可以回顾上篇文章思考题留的那段代码，我把这段代码也贴在文中了，如下所示：</p>
<div
              class="gatsby-code-button-container"
              data-toaster-id="23868784034069602000"
              data-toaster-class="gatsby-code-button-toaster"
              data-toaster-text-class="gatsby-code-button-toaster-text"
              data-toaster-text="复制成功"
              data-toaster-duration="3500"
              onClick="copyToClipboard(`function executor(resolve, reject) {
  let rand = Math.random();
  console.log(1);
  console.log(rand);
  if (rand > 0.5) resolve();
  else reject();
}
var p0 = new Promise(executor);

var p1 = p0.then((value) => {
  console.log('succeed-1');
  return new Promise(executor);
});

var p3 = p1.then((value) => {
  console.log('succeed-2');
  return new Promise(executor);
});

var p4 = p3.then((value) => {
  console.log('succeed-3');
  return new Promise(executor);
});

p4.catch((error) => {
  console.log('error');
});
console.log(2);`, `23868784034069602000`)"
            >
              <div
                class="gatsby-code-button"
                
              >
                js 复制代码
              </div>
            </div>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">function</span> <span class="token function">executor</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> rand <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>rand<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>rand <span class="token operator">></span> <span class="token number">0.5</span><span class="token punctuation">)</span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">else</span> <span class="token function">reject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">var</span> p0 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span>executor<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> p1 <span class="token operator">=</span> p0<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'succeed-1'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span>executor<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> p3 <span class="token operator">=</span> p1<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'succeed-2'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span>executor<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> p4 <span class="token operator">=</span> p3<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'succeed-3'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span>executor<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

p4<span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'error'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>这段代码有四个 Promise 对象：p0 ～ p4。无论哪个对象里面抛出异常，都可以通过最后一个对象 p4.catch 来捕获异常，通过这种方式可以将所有 Promise 对象的错误合并到一个函数来处理，这样就解决了每个任务都需要单独处理异常的问题。</p>
<p>之所以可以使用最后一个对象来捕获所有异常，是因为 Promise 对象的错误具有“冒泡”性质，会一直向后传递，直到被 onReject 函数处理或 catch 语句捕获为止。具备了这样“冒泡”的特性后，就不需要在每个 Promise 对象中单独捕获异常了。至于 Promise 错误的“冒泡”性质是怎么实现的，就留给你课后思考了。</p>
<p>通过这种方式，我们就消灭了嵌套调用和频繁的错误处理，这样使得我们写出来的代码更加优雅，更加符合人的线性思维。</p>
<h2 id="promise-与微任务"><a href="#promise-%E4%B8%8E%E5%BE%AE%E4%BB%BB%E5%8A%A1" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Promise 与微任务</h2>
<p>讲了这么多，我们似乎还没有将微任务和 Promise 关联起来，那么 Promise 和微任务的关系到底体现哪里呢？</p>
<p>我们可以结合下面这个简单的 Promise 代码来回答这个问题：</p>
<div
              class="gatsby-code-button-container"
              data-toaster-id="45475635347123640000"
              data-toaster-class="gatsby-code-button-toaster"
              data-toaster-text-class="gatsby-code-button-toaster-text"
              data-toaster-text="复制成功"
              data-toaster-duration="3500"
              onClick="copyToClipboard(`function executor(resolve, reject) {
  resolve(100);
}
let demo = new Promise(executor);

function onResolve(value) {
  console.log(value);
}
demo.then(onResolve);`, `45475635347123640000`)"
            >
              <div
                class="gatsby-code-button"
                
              >
                js 复制代码
              </div>
            </div>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">function</span> <span class="token function">executor</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">let</span> demo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span>executor<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">onResolve</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
demo<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>onResolve<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>对于上面这段代码，我们需要重点关注下它的执行顺序。</p>
<p>首先执行 new Promise 时，Promise 的构造函数会被执行，不过由于 Promise 是 V8 引擎提供的，所以暂时看不到 Promise 构造函数的细节。</p>
<p>接下来，Promise 的构造函数会调用 Promise 的参数 executor 函数。然后在 executor 中执行了 resolve，resolve 函数也是在 V8 内部实现的，那么 resolve 函数到底做了什么呢？我们知道，执行 resolve 函数，会触发 demo.then 设置的回调函数 onResolve，所以可以推测，resolve 函数内部调用了通过 demo.then 设置的 onResolve 函数。</p>
<p>不过这里需要注意一下，由于 Promise 采用了回调函数延迟绑定技术，所以在执行 resolve 函数的时候，回调函数还没有绑定，那么只能推迟回调函数的执行。</p>
<p>这样按顺序陈述可能把你绕晕了，下面来模拟实现一个 Promise，我们会实现它的构造函数、resolve 方法以及 then 方法，以方便你能看清楚 Promise 的背后都发生了什么。这里我们就把这个对象称为 Bromise，下面就是 Bromise 的实现代码：</p>
<div
              class="gatsby-code-button-container"
              data-toaster-id="37930356298877710000"
              data-toaster-class="gatsby-code-button-toaster"
              data-toaster-text-class="gatsby-code-button-toaster-text"
              data-toaster-text="复制成功"
              data-toaster-duration="3500"
              onClick="copyToClipboard(`function Bromise(executor) {
  var onResolve_ = null;
  var onReject_ = null;
  // 模拟实现 resolve 和 then，暂不支持 rejcet
  this.then = function(onResolve, onReject) {
    onResolve_ = onResolve;
  };
  function resolve(value) {
    //setTimeout(()=>{
    onResolve_(value);
    // },0)
  }
  executor(resolve, null);
}`, `37930356298877710000`)"
            >
              <div
                class="gatsby-code-button"
                
              >
                js 复制代码
              </div>
            </div>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">function</span> <span class="token function">Bromise</span><span class="token punctuation">(</span><span class="token parameter">executor</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> onResolve_ <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> onReject_ <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
  <span class="token comment">// 模拟实现 resolve 和 then，暂不支持 rejcet</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function-variable function">then</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">onResolve<span class="token punctuation">,</span> onReject</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    onResolve_ <span class="token operator">=</span> onResolve<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token keyword">function</span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//setTimeout(()=>{</span>
    <span class="token function">onResolve_</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// },0)</span>
  <span class="token punctuation">}</span>
  <span class="token function">executor</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>观察上面这段代码，我们实现了自己的构造函数、resolve、then 方法。接下来我们使用 Bromise 来实现我们的业务代码，实现后的代码如下所示：</p>
<div
              class="gatsby-code-button-container"
              data-toaster-id="85671273354143330000"
              data-toaster-class="gatsby-code-button-toaster"
              data-toaster-text-class="gatsby-code-button-toaster-text"
              data-toaster-text="复制成功"
              data-toaster-duration="3500"
              onClick="copyToClipboard(`function executor(resolve, reject) {
  resolve(100);
}
// 将 Promise 改成我们自己的 Bromsie
let demo = new Bromise(executor);

function onResolve(value) {
  console.log(value);
}
demo.then(onResolve);`, `85671273354143330000`)"
            >
              <div
                class="gatsby-code-button"
                
              >
                js 复制代码
              </div>
            </div>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">function</span> <span class="token function">executor</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// 将 Promise 改成我们自己的 Bromsie</span>
<span class="token keyword">let</span> demo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Bromise</span><span class="token punctuation">(</span>executor<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">onResolve</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
demo<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>onResolve<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>执行这段代码，我们发现执行出错，输出的内容是：</p>
<div
              class="gatsby-code-button-container"
              data-toaster-id="79712731180619840000"
              data-toaster-class="gatsby-code-button-toaster"
              data-toaster-text-class="gatsby-code-button-toaster-text"
              data-toaster-text="复制成功"
              data-toaster-duration="3500"
              onClick="copyToClipboard(`Uncaught TypeError: onResolve_ is not a function
    at resolve (<anonymous>:10:13)
    at executor (<anonymous>:17:5)
    at new Bromise (<anonymous>:13:5)
    at <anonymous>:19:12`, `79712731180619840000`)"
            >
              <div
                class="gatsby-code-button"
                
              >
                复制代码
              </div>
            </div>
<div class="gatsby-highlight" data-language="text"><pre style="counter-reset: linenumber NaN" class="language-text line-numbers"><code class="language-text">Uncaught TypeError: onResolve_ is not a function
    at resolve (&lt;anonymous&gt;:10:13)
    at executor (&lt;anonymous&gt;:17:5)
    at new Bromise (&lt;anonymous&gt;:13:5)
    at &lt;anonymous&gt;:19:12</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>之所以出现这个错误，是由于 Bromise 的延迟绑定导致的，在调用到 onResolve* 函数的时候，Bromise.then 还没有执行，所以执行上述代码的时候，当然会报“onResolve* is not a function“的错误了。</p>
<p>也正是因为此，我们要改造 Bromise 中的 resolve 方法，让 resolve 延迟调用 onResolve_。</p>
<p>要让 resolve 中的 onResolve* 函数延后执行，可以在 resolve 函数里面加上一个定时器，让其延时执行 onResolve* 函数，你可以参考下面改造后的代码：</p>
<div
              class="gatsby-code-button-container"
              data-toaster-id="1675128057104702200"
              data-toaster-class="gatsby-code-button-toaster"
              data-toaster-text-class="gatsby-code-button-toaster-text"
              data-toaster-text="复制成功"
              data-toaster-duration="3500"
              onClick="copyToClipboard(`function resolve(value) {
  setTimeout(() => {
    onResolve_(value);
  }, 0);
}`, `1675128057104702200`)"
            >
              <div
                class="gatsby-code-button"
                
              >
                js 复制代码
              </div>
            </div>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">function</span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token function">onResolve_</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>上面采用了定时器来推迟 onResolve 的执行，不过使用定时器的效率并不是太高，好在我们有微任务，所以 Promise 又把这个定时器改造成了微任务了，这样既可以让 onResolve_ 延时被调用，又提升了代码的执行效率。这就是 Promise 中使用微任务的原因了</p>
<h2 id="总结-4"><a href="#%E6%80%BB%E7%BB%93-4" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>总结</h2>
<p>首先，我们回顾了 Web 页面是单线程架构模型，这种模型决定了我们编写代码的形式——异步编程。基于异步编程模型写出来的代码会把一些关键的逻辑点打乱，所以这种风格的代码不符合人的线性思维方式。接下来我们试着把一些不必要的回调接口封装起来，简单封装取得了一定的效果，不过，在稍微复杂点的场景下依然存在着回调地狱的问题。然后我们分析了产生回调地狱的原因：</p>
<ul>
<li>多层嵌套的问题；</li>
<li>每种任务的处理结果存在两种可能性（成功或失败），那么需要在每种任务执行结束后分别处理这两种可能性。</li>
</ul>
<p>Promise 通过回调函数延迟绑定、回调函数返回值穿透和错误“冒泡”技术解决了上面的两个问题。</p>
<p>最后，我们还分析了 Promise 之所以要使用微任务是由 Promise 回调函数延迟绑定技术导致的。</p>
<h1 id="async-await-使用同步方式写异步代码"><a href="#async-await-%E4%BD%BF%E7%94%A8%E5%90%8C%E6%AD%A5%E6%96%B9%E5%BC%8F%E5%86%99%E5%BC%82%E6%AD%A5%E4%BB%A3%E7%A0%81" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>async await 使用同步方式写异步代码</h1>
<p>在上篇文章中，我们介绍了怎么使用 Promise 来实现回调操作，使用 Promise 能很好地解决回调地狱的问题，但是这种方式充满了 Promise 的 then() 方法，如果处理流程比较复杂的话，那么整段代码将充斥着 then，语义化不明显，代码不能很好地表示执行流程。</p>
<p>比如下面这样一个实际的使用场景：我先请求极客邦的内容，等返回信息之后，我再请求极客邦的另外一个资源。下面代码展示的是使用 fetch 来实现这样的需求，fetch 被定义在 window 对象中，可以用它来发起对远程资源的请求，该方法返回的是一个 Promise 对象，这和我们上篇文章中讲的 XFetch 很像，只不过 fetch 是浏览器原生支持的，没有利用 XMLHttpRequest 来封装。</p>
<div
              class="gatsby-code-button-container"
              data-toaster-id="83552829925782500000"
              data-toaster-class="gatsby-code-button-toaster"
              data-toaster-text-class="gatsby-code-button-toaster-text"
              data-toaster-text="复制成功"
              data-toaster-duration="3500"
              onClick="copyToClipboard(`fetch('https://www.geekbang.org')
  .then((response) => {
    console.log(response);
    return fetch('https://www.geekbang.org/test');
  })
  .then((response) => {
    console.log(response);
  })
  .catch((error) => {
    console.log(error);
  });`, `83552829925782500000`)"
            >
              <div
                class="gatsby-code-button"
                
              >
                js 复制代码
              </div>
            </div>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">'https://www.geekbang.org'</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">response</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">'https://www.geekbang.org/test'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">response</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>从这段 Promise 代码可以看出来，使用 promise.then 也是相当复杂，虽然整个请求流程已经线性化了，但是代码里面包含了大量的 then 函数，使得代码依然不是太容易阅读。基于这个原因，ES7 引入了 async/await，这是 JavaScript 异步编程的一个重大改进，提供了在不阻塞主线程的情况下使用同步代码实现异步访问资源的能力，并且使得代码逻辑更加清晰。你可以参考下面这段代码：</p>
<div
              class="gatsby-code-button-container"
              data-toaster-id="2458778871204381000"
              data-toaster-class="gatsby-code-button-toaster"
              data-toaster-text-class="gatsby-code-button-toaster-text"
              data-toaster-text="复制成功"
              data-toaster-duration="3500"
              onClick="copyToClipboard(`async function foo() {
  try {
    let response1 = await fetch('https://www.geekbang.org');
    console.log('response1');
    console.log(response1);
    let response2 = await fetch('https://www.geekbang.org/test');
    console.log('response2');
    console.log(response2);
  } catch (err) {
    console.error(err);
  }
}
foo();`, `2458778871204381000`)"
            >
              <div
                class="gatsby-code-button"
                
              >
                js 复制代码
              </div>
            </div>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> response1 <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">'https://www.geekbang.org'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'response1'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>response1<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> response2 <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">'https://www.geekbang.org/test'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'response2'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>response2<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>通过上面代码，你会发现整个异步处理的逻辑都是使用同步代码的方式来实现的，而且还支持 try catch 来捕获异常，这就是完全在写同步代码，所以是非常符合人的线性思维的。但是很多人都习惯了异步回调的编程思维，对于这种采用同步代码实现异步逻辑的方式，还需要一个转换的过程，因为这中间隐藏了一些容易让人迷惑的细节。</p>
<p>那么本篇文章我们继续深入，看看 JavaScript 引擎是如何实现 async/await 的。如果上来直接介绍 async/await 的使用方式的话，那么你可能会有点懵，所以我们就从其最底层的技术点一步步往上讲解，从而带你彻底弄清楚 async 和 await 到底是怎么工作的。</p>
<p>本文我们首先介绍生成器（Generator）是如何工作的，接着讲解 Generator 的底层实现机制——协程（Coroutine）；又因为 async/await 使用了 Generator 和 Promise 两种技术，所以紧接着我们就通过 Generator 和 Promise 来分析 async/await 到底是如何以同步的方式来编写异步代码的。</p>
<h2 id="生成器-vs-协程"><a href="#%E7%94%9F%E6%88%90%E5%99%A8-vs-%E5%8D%8F%E7%A8%8B" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>生成器 VS 协程</h2>
<p>我们先来看看什么是生成器函数？</p>
<p>生成器函数是一个带星号函数，而且是可以暂停执行和恢复执行的。我们可以看下面这段代码：</p>
<div
              class="gatsby-code-button-container"
              data-toaster-id="97547176847940930000"
              data-toaster-class="gatsby-code-button-toaster"
              data-toaster-text-class="gatsby-code-button-toaster-text"
              data-toaster-text="复制成功"
              data-toaster-duration="3500"
              onClick="copyToClipboard(`function* genDemo() {
  console.log(' 开始执行第一段 ');
  yield 'generator 2';

  console.log(' 开始执行第二段 ');
  yield 'generator 2';

  console.log(' 开始执行第三段 ');
  yield 'generator 2';

  console.log(' 执行结束 ');
  return 'generator 2';
}

console.log('main 0');
let gen = genDemo();
console.log(gen.next().value);
console.log('main 1');
console.log(gen.next().value);
console.log('main 2');
console.log(gen.next().value);
console.log('main 3');
console.log(gen.next().value);
console.log('main 4');`, `97547176847940930000`)"
            >
              <div
                class="gatsby-code-button"
                
              >
                js 复制代码
              </div>
            </div>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">function</span><span class="token operator">*</span> <span class="token function">genDemo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">' 开始执行第一段 '</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">yield</span> <span class="token string">'generator 2'</span><span class="token punctuation">;</span>

  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">' 开始执行第二段 '</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">yield</span> <span class="token string">'generator 2'</span><span class="token punctuation">;</span>

  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">' 开始执行第三段 '</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">yield</span> <span class="token string">'generator 2'</span><span class="token punctuation">;</span>

  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">' 执行结束 '</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token string">'generator 2'</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'main 0'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> gen <span class="token operator">=</span> <span class="token function">genDemo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>gen<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'main 1'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>gen<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'main 2'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>gen<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'main 3'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>gen<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'main 4'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>执行上面这段代码，观察输出结果，你会发现函数 genDemo 并不是一次执行完的，全局代码和 genDemo 函数交替执行。其实这就是生成器函数的特性，可以暂停执行，也可以恢复执行。下面我们就来看看生成器函数的具体使用方式：</p>
<ul>
<li>在生成器函数内部执行一段代码，如果遇到 yield 关键字，那么 JavaScript 引擎将返回关键字后面的内容给外部，并暂停该函数的执行。</li>
<li>外部函数可以通过 next 方法恢复函数的执行</li>
</ul>
<p>关于函数的暂停和恢复，相信你一定很好奇这其中的原理，那么接下来我们就来简单介绍下 JavaScript 引擎 V8 是如何实现一个函数的暂停和恢复的，这也会有助于你理解后面要介绍的 async/await。</p>
<p>要搞懂函数为何能暂停和恢复，那你首先要了解协程的概念。协程是一种比线程更加轻量级的存在。你可以把协程看成是跑在线程上的任务，一个线程上可以存在多个协程，但是在线程上同时只能执行一个协程，比如当前执行的是 A 协程，要启动 B 协程，那么 A 协程就需要将主线程的控制权交给 B 协程，这就体现在 A 协程暂停执行，B 协程恢复执行；同样，也可以从 B 协程中启动 A 协程。通常，如果从 A 协程启动 B 协程，我们就把 A 协程称为 B 协程的父协程。</p>
<p>正如一个进程可以拥有多个线程一样，一个线程也可以拥有多个协程。最重要的是，协程不是被操作系统内核所管理，而完全是由程序所控制（也就是在用户态执行）。这样带来的好处就是性能得到了很大的提升，不会像线程切换那样消耗资源。</p>
<p>为了让你更好地理解协程是怎么执行的，我结合上面那段代码的执行过程，画出了下面的“协程执行流程图”，你可以对照着代码来分析：</p>
<p>
  <a
    class="gatsby-resp-image-link"
    href="/static/2021-07-07-09-33-10-f9e23b8a93102e501743b8445cce4c3d-205ae.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
  
  <span
    class="gatsby-resp-image-wrapper"
    style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;"
  >
    <span
      class="gatsby-resp-image-background-image"
      style="padding-bottom: 53.648648648648646%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABTElEQVQoz6WSO04DMRCG9y4cB07ADXIHbgAIJPpUIKF0FHQIGkRExSsSBSKkQEDIbrJr7449Mx6H2c0KBQkQElP4+X/ze2wn839EsjyJsW5HOW2ej/cuU4tSL/4FlhgpBO3vxn51f7jee5xYXGQkDkQk9W4tC3VoH5NmOwZEACwKY02u8zfjUh0XBSGpc+l8aS16r2JktqUtK5AWro0psxV4ZGLNRZ7AWu8gSBAWV1auqtRcdcaANZYJ22PfT7B7nZ+NIOgaoqYUEfSoVhxYJDIF7xw28OmwXDt42r7IWvhwkK9s3XavpnNBcE510PhoAIDTejQLMzivR7p5zjdOXnqDaQsDiXH4kGHn+HWnn6o/OSfNnSjDSiJqLRyCjoXpy21/vlDnaLTbf//9bWOjXyDJTyJ19l7rRq3iT59kORTLsmw2m6VpGuP3P+UDbAl6la0gdsQAAAAASUVORK5CYII='); background-size: cover; display: block;"
    >
      <img
        class="gatsby-resp-image-image"
        style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;"
        alt="2021 07 07 09 33 10"
        title=""
        src="/static/2021-07-07-09-33-10-f9e23b8a93102e501743b8445cce4c3d-fee1c.png"
        srcset="/static/2021-07-07-09-33-10-f9e23b8a93102e501743b8445cce4c3d-a67b7.png 200w,
/static/2021-07-07-09-33-10-f9e23b8a93102e501743b8445cce4c3d-0b187.png 400w,
/static/2021-07-07-09-33-10-f9e23b8a93102e501743b8445cce4c3d-fee1c.png 800w,
/static/2021-07-07-09-33-10-f9e23b8a93102e501743b8445cce4c3d-b1a91.png 1200w,
/static/2021-07-07-09-33-10-f9e23b8a93102e501743b8445cce4c3d-205ae.png 1480w"
        sizes="(max-width: 800px) 100vw, 800px"
      />
    </span>
  </span>
  
  </a>
    </p>
<p>从图中可以看出来协程的四点规则：</p>
<ul>
<li>通过调用生成器函数 genDemo 来创建一个协程 gen，创建之后，gen 协程并没有立即执行。</li>
<li>要让 gen 协程执行，需要通过调用 gen.next。</li>
<li>当协程正在执行的时候，可以通过 yield 关键字来暂停 gen 协程的执行，并返回主要信息给父协程。</li>
<li>如果协程在执行期间，遇到了 return 关键字，那么 JavaScript 引擎会结束当前协程，并将 return 后面的内容返回给父协程。</li>
</ul>
<p>不过，对于上面这段代码，你可能又有这样疑问：父协程有自己的调用栈，gen 协程时也有自己的调用栈，当 gen 协程通过 yield 把控制权交给父协程时，V8 是如何切换到父协程的调用栈？当父协程通过 gen.next 恢复 gen 协程时，又是如何切换 gen 协程的调用栈？</p>
<p>要搞清楚上面的问题，你需要关注以下两点内容。</p>
<p>第一点：gen 协程和父协程是在主线程上交互执行的，并不是并发执行的，它们之前的切换是通过 yield 和 gen.next 来配合完成的。</p>
<p>第二点：当在 gen 协程中调用了 yield 方法时，JavaScript 引擎会保存 gen 协程当前的调用栈信息，并恢复父协程的调用栈信息。同样，当在父协程中执行 gen.next 时，JavaScript 引擎会保存父协程的调用栈信息，并恢复 gen 协程的调用栈信息。</p>
<p>为了直观理解父协程和 gen 协程是如何切换调用栈的，你可以参考下图</p>
<p>
  <a
    class="gatsby-resp-image-link"
    href="/static/2021-07-07-09-33-58-971ddbb92ba939af1476f008fd2421e0-ea453.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
  
  <span
    class="gatsby-resp-image-wrapper"
    style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;"
  >
    <span
      class="gatsby-resp-image-background-image"
      style="padding-bottom: 88.32335329341318%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAASCAIAAADUsmlHAAAACXBIWXMAAA7DAAAOwwHHb6hkAAACbElEQVQ4y6VTW2sTQRTOv/AHSIv4YqE1oD6oD76If8CCQh+KiReqtKCiDyYq1TZpQCI21ggiFFqkVqitCFIopU0rFHpP1Nzaprltdje7O7M7OzM7zm6qraWaBw+HgTmH75xvzvnGxf7DXHsvlmVhE1HG0PoYmArCmTCMRagu13J1wBDCTCoJCGPjXhw8RMINJHKMyRkHTA8AW47VLqIoplIpwzDeRvo6rly+3eG93+kVittOY3pwZ2oxk1jcDUy588jMcmZoMv5u6tvodELRdB7iWZ7hJyIWoTvNXOVyWZUFp7bJCGREp6ZGMfpdHiOdBxkGzML7OxtQm1hT+mPg9bwandcG5sDwCqlqBiUUE8oIXsnp/bNqdE6JfgVvFowXs9p0GtX42rQffAGN3Wl3KNMSTDUF0udeiVmRD40R55mDC2qDb/14INkS2nSHsof9cf+nspO1bPC9sUKjf83dm3AHfjT1JM+/3BK0XfDoknL0afZkON/8ZO3Es40j3elHn4Vd8OCS2T5cuvlB6HhfvjZS9k3qCsT2cuwtkNiGefUj7hwHN0aKXRPQM2YOLeMd2pIkyWJl3ySAjnSTD9+CiCDT/KvCqtUqh9ujoXYryymJKmkjv2oU4np+FUGFOCRttxj3X5v6U2FcHoqiIgMKI9c3w2dyAxdyz0/j/GIdhdVExlkkvicpqPT1PG713PF0PbzU1p5PLtkvpPRf2uZ4WZa2tgtYKdz19Ta3+k+19Zy9eCubWKwP3vu7uMi3i0K+JBaKJf7PasH6YIyxoqqqoiAd6FA1dChKkqZp9f9zjR4fm2YbsB3YhhA6EPwTvWbTJh66KZgAAAAASUVORK5CYII='); background-size: cover; display: block;"
    >
      <img
        class="gatsby-resp-image-image"
        style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;"
        alt="2021 07 07 09 33 58"
        title=""
        src="/static/2021-07-07-09-33-58-971ddbb92ba939af1476f008fd2421e0-fee1c.png"
        srcset="/static/2021-07-07-09-33-58-971ddbb92ba939af1476f008fd2421e0-a67b7.png 200w,
/static/2021-07-07-09-33-58-971ddbb92ba939af1476f008fd2421e0-0b187.png 400w,
/static/2021-07-07-09-33-58-971ddbb92ba939af1476f008fd2421e0-fee1c.png 800w,
/static/2021-07-07-09-33-58-971ddbb92ba939af1476f008fd2421e0-b1a91.png 1200w,
/static/2021-07-07-09-33-58-971ddbb92ba939af1476f008fd2421e0-ea453.png 1336w"
        sizes="(max-width: 800px) 100vw, 800px"
      />
    </span>
  </span>
  
  </a>
    </p>
<p>到这里相信你已经弄清楚了协程是怎么工作的，其实在 JavaScript 中，生成器就是协程的一种实现方式，这样相信你也就理解什么是生成器了。那么接下来，我们使用生成器和 Promise 来改造开头的那段 Promise 代码。改造后的代码如下所示：</p>
<div
              class="gatsby-code-button-container"
              data-toaster-id="42239123261874225000"
              data-toaster-class="gatsby-code-button-toaster"
              data-toaster-text-class="gatsby-code-button-toaster-text"
              data-toaster-text="复制成功"
              data-toaster-duration="3500"
              onClick="copyToClipboard(`//foo 函数
function* foo() {
  let response1 = yield fetch('https://www.geekbang.org');
  console.log('response1');
  console.log(response1);
  let response2 = yield fetch('https://www.geekbang.org/test');
  console.log('response2');
  console.log(response2);
}

// 执行 foo 函数的代码
let gen = foo();
function getGenPromise(gen) {
  return gen.next().value;
}
getGenPromise(gen)
  .then((response) => {
    console.log('response1');
    console.log(response);
    return getGenPromise(gen);
  })
  .then((response) => {
    console.log('response2');
    console.log(response);
  });`, `42239123261874225000`)"
            >
              <div
                class="gatsby-code-button"
                
              >
                js 复制代码
              </div>
            </div>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">//foo 函数</span>
<span class="token keyword">function</span><span class="token operator">*</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> response1 <span class="token operator">=</span> <span class="token keyword">yield</span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">'https://www.geekbang.org'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'response1'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>response1<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> response2 <span class="token operator">=</span> <span class="token keyword">yield</span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">'https://www.geekbang.org/test'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'response2'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>response2<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 执行 foo 函数的代码</span>
<span class="token keyword">let</span> gen <span class="token operator">=</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">getGenPromise</span><span class="token punctuation">(</span><span class="token parameter">gen</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> gen<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>value<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token function">getGenPromise</span><span class="token punctuation">(</span>gen<span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">response</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'response1'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token function">getGenPromise</span><span class="token punctuation">(</span>gen<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">response</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'response2'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>从图中可以看到，foo 函数是一个生成器函数，在 foo 函数里面实现了用同步代码形式来实现异步操作；但是在 foo 函数外部，我们还需要写一段执行 foo 函数的代码，如上述代码的后半部分所示，那下面我们就来分析下这段代码是如何工作的。</p>
<ul>
<li>首先执行的是 let gen = foo()，创建了 gen 协程。</li>
<li>然后在父协程中通过执行 gen.next 把主线程的控制权交给 gen 协程。</li>
<li>gen 协程获取到主线程的控制权后，就调用 fetch 函数创建了一个 Promise 对象 response1，然后通过 yield 暂停 gen 协程的执行，并将 response1 返回给父协程。</li>
<li>父协程恢复执行后，调用 response1.then 方法等待请求结果。</li>
<li>等通过 fetch 发起的请求完成之后，会调用 then 中的回调函数，then 中的回调函数拿到结果之后，通过调用 gen.next 放弃主线程的控制权，将控制权交 gen 协程继续执行下个请求。</li>
</ul>
<p>以上就是协程和 Promise 相互配合执行的一个大致流程。不过通常，我们把执行生成器的代码封装成一个函数，并把这个执行生成器代码的函数称为执行器（可参考著名的 co 框架），如下面这种方式：</p>
<div
              class="gatsby-code-button-container"
              data-toaster-id="18355360287429634000"
              data-toaster-class="gatsby-code-button-toaster"
              data-toaster-text-class="gatsby-code-button-toaster-text"
              data-toaster-text="复制成功"
              data-toaster-duration="3500"
              onClick="copyToClipboard(`function* foo() {
  let response1 = yield fetch('https://www.geekbang.org');
  console.log('response1');
  console.log(response1);
  let response2 = yield fetch('https://www.geekbang.org/test');
  console.log('response2');
  console.log(response2);
}
co(foo());`, `18355360287429634000`)"
            >
              <div
                class="gatsby-code-button"
                
              >
                js 复制代码
              </div>
            </div>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">function</span><span class="token operator">*</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> response1 <span class="token operator">=</span> <span class="token keyword">yield</span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">'https://www.geekbang.org'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'response1'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>response1<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> response2 <span class="token operator">=</span> <span class="token keyword">yield</span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">'https://www.geekbang.org/test'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'response2'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>response2<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token function">co</span><span class="token punctuation">(</span><span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>通过使用生成器配合执行器，就能实现使用同步的方式写出异步代码了，这样也大大加强了代码的可读性。</p>
<h2 id="asyncawait"><a href="#asyncawait" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>async/await</h2>
<p>虽然生成器已经能很好地满足我们的需求了，但是程序员的追求是无止境的，这不又在 ES7 中引入了 async/await，这种方式能够彻底告别执行器和生成器，实现更加直观简洁的代码。其实 async/await 技术背后的秘密就是 Promise 和生成器应用，往底层说就是微任务和协程应用。要搞清楚 async 和 await 的工作原理，我们就得对 async 和 await 分开分析。</p>
<h3 id="async"><a href="#async" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>async</h3>
<p>我们先来看看 async 到底是什么？根据 MDN 定义，async 是一个通过异步执行并隐式返回 Promise 作为结果的函数。</p>
<p>对 async 函数的理解，这里需要重点关注两个词：异步执行和隐式返回 Promise。</p>
<p>关于异步执行的原因，我们一会儿再分析。这里我们先来看看是如何隐式返回 Promise 的，你可以参考下面的代码：</p>
<div
              class="gatsby-code-button-container"
              data-toaster-id="8339754391815357000"
              data-toaster-class="gatsby-code-button-toaster"
              data-toaster-text-class="gatsby-code-button-toaster-text"
              data-toaster-text="复制成功"
              data-toaster-duration="3500"
              onClick="copyToClipboard(`async function foo() {
  return 2;
}

console.log(foo()); // Promise {<resolved>: 2}`, `8339754391815357000`)"
            >
              <div
                class="gatsby-code-button"
                
              >
                js 复制代码
              </div>
            </div>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token number">2</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Promise {&lt;resolved>: 2}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>执行这段代码，我们可以看到调用 async 声明的 foo 函数返回了一个 Promise 对象，状态是 resolved，返回结果如下所示：</p>
<div
              class="gatsby-code-button-container"
              data-toaster-id="5949174852437733000"
              data-toaster-class="gatsby-code-button-toaster"
              data-toaster-text-class="gatsby-code-button-toaster-text"
              data-toaster-text="复制成功"
              data-toaster-duration="3500"
              onClick="copyToClipboard(`Promise {<resolved>: 2}`, `5949174852437733000`)"
            >
              <div
                class="gatsby-code-button"
                
              >
                复制代码
              </div>
            </div>
<div class="gatsby-highlight" data-language="text"><pre style="counter-reset: linenumber NaN" class="language-text line-numbers"><code class="language-text">Promise {&lt;resolved&gt;: 2}</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>
<h3 id="await"><a href="#await" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>await</h3>
<p>我们知道了 async 函数返回的是一个 Promise 对象，那下面我们再结合文中这段代码来看看 await 到底是什么。</p>
<div
              class="gatsby-code-button-container"
              data-toaster-id="13191699624244068000"
              data-toaster-class="gatsby-code-button-toaster"
              data-toaster-text-class="gatsby-code-button-toaster-text"
              data-toaster-text="复制成功"
              data-toaster-duration="3500"
              onClick="copyToClipboard(`async function foo() {
  console.log(1);
  let a = await 100;
  console.log(a);
  console.log(2);
}
console.log(0);
foo();
console.log(3);`, `13191699624244068000`)"
            >
              <div
                class="gatsby-code-button"
                
              >
                js 复制代码
              </div>
            </div>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> a <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token number">100</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>观察上面这段代码，你能判断出打印出来的内容是什么吗？这得先来分析 async 结合 await 到底会发生什么。在详细介绍之前，我们先站在协程的视角来看看这段代码的整体执行流程图：</p>
<p>
  <a
    class="gatsby-resp-image-link"
    href="/static/2021-07-07-09-37-14-71c0b4b2a21afa0107815d2005fccec4-a368f.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
  
  <span
    class="gatsby-resp-image-wrapper"
    style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;"
  >
    <span
      class="gatsby-resp-image-background-image"
      style="padding-bottom: 56.89149560117303%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABhklEQVQoz42SSUvDQBTH+w31Lorgh/As3rx60VtPIgpuB0HxIHhwt+0kTVpBROwiaZI22+zzxpdaFaWCj19m/zPv/yYVOyXgL4SybIwy5bmK/UfAuDVgV8/V0r5Y3OObd+pbDIB7UHY4ljnQCFgMfILhseWxpMPlkwKVc7ti4/ZTLKQEUCxPBOc41WlHBUQNPPbm0p7D+3XWq5mAyM5D/OoImjJtpS6vqWAjGCVdfuTklAlcUmmXB66N/NYjWTm8Xzu+vyK19dMHHOxc3Gkaf1mpjDO1Z09m29UWyjpA3lehZ5N2vd2cqTbmt8hJzVvYIrNVsnzQUCz5FuOXZZnWpQdKGWWchs95t057ZPBKrpvOrUt6L+5N07l0nYZPslEwSjJWFBOxMRoAsJgc3UvJhx0Us7cm2sbkbeBC5NmRb4eIJ4thwbgUYvpTyaSfdupZt5FjtQJfRS0VtlTULgl9EOmPtH+HEVazCYaXgABFJxj9dXD6T8K5SLMcQXthFAfBAD4K+zPeAbGralM4bwnIAAAAAElFTkSuQmCC'); background-size: cover; display: block;"
    >
      <img
        class="gatsby-resp-image-image"
        style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;"
        alt="2021 07 07 09 37 14"
        title=""
        src="/static/2021-07-07-09-37-14-71c0b4b2a21afa0107815d2005fccec4-fee1c.png"
        srcset="/static/2021-07-07-09-37-14-71c0b4b2a21afa0107815d2005fccec4-a67b7.png 200w,
/static/2021-07-07-09-37-14-71c0b4b2a21afa0107815d2005fccec4-0b187.png 400w,
/static/2021-07-07-09-37-14-71c0b4b2a21afa0107815d2005fccec4-fee1c.png 800w,
/static/2021-07-07-09-37-14-71c0b4b2a21afa0107815d2005fccec4-b1a91.png 1200w,
/static/2021-07-07-09-37-14-71c0b4b2a21afa0107815d2005fccec4-a368f.png 1364w"
        sizes="(max-width: 800px) 100vw, 800px"
      />
    </span>
  </span>
  
  </a>
    </p>
<p>结合上图，我们来一起分析下 async/await 的执行流程。</p>
<p>首先，执行 console.log(0)这个语句，打印出来 0。</p>
<p>紧接着就是执行 foo 函数，由于 foo 函数是被 async 标记过的，所以当进入该函数的时候，JavaScript 引擎会保存当前的调用栈等信息，然后执行 foo 函数中的 console.log(1)语句，并打印出 1。</p>
<p>接下来就执行到 foo 函数中的 await 100 这个语句了，这里是我们分析的重点，因为在执行 await 100 这个语句时，JavaScript 引擎在背后为我们默默做了太多的事情，那么下面我们就把这个语句拆开，来看看 JavaScript 到底都做了哪些事情。</p>
<p>当执行到 await 100 时，会默认创建一个 Promise 对象，代码如下所示：</p>
<div
              class="gatsby-code-button-container"
              data-toaster-id="24792995128972284000"
              data-toaster-class="gatsby-code-button-toaster"
              data-toaster-text-class="gatsby-code-button-toaster-text"
              data-toaster-text="复制成功"
              data-toaster-duration="3500"
              onClick="copyToClipboard(`let promise_ = new Promise((resolve,reject){
  resolve(100)
})`, `24792995128972284000`)"
            >
              <div
                class="gatsby-code-button"
                
              >
                js 复制代码
              </div>
            </div>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">let</span> promise_ <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span>reject<span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>
<p>在这个 promise_ 对象创建的过程中，我们可以看到在 executor 函数中调用了 resolve 函数，JavaScript 引擎会将该任务提交给微任务队列（上一篇文章中我们讲解过）。</p>
<p>然后 JavaScript 引擎会暂停当前协程的执行，将主线程的控制权转交给父协程执行，同时会将 promise_ 对象返回给父协程。</p>
<p>主线程的控制权已经交给父协程了，这时候父协程要做的一件事是调用 promise_.then 来监控 promise 状态的改变。</p>
<p>接下来继续执行父协程的流程，这里我们执行 console.log(3)，并打印出来 3。随后父协程将执行结束，在结束之前，会进入微任务的检查点，然后执行微任务队列，微任务队列中有 resolve(100)的任务等待执行，执行到这里的时候，会触发 promise_.then 中的回调函数，如下所示：</p>
<div
              class="gatsby-code-button-container"
              data-toaster-id="10351872503478954000"
              data-toaster-class="gatsby-code-button-toaster"
              data-toaster-text-class="gatsby-code-button-toaster-text"
              data-toaster-text="复制成功"
              data-toaster-duration="3500"
              onClick="copyToClipboard(`promise_.then((value) => {
  // 回调函数被激活后
  // 将主线程控制权交给 foo 协程，并将 value 值传给协程
});`, `10351872503478954000`)"
            >
              <div
                class="gatsby-code-button"
                
              >
                js 复制代码
              </div>
            </div>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js">promise_<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token comment">// 回调函数被激活后</span>
  <span class="token comment">// 将主线程控制权交给 foo 协程，并将 value 值传给协程</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>
<p>该回调函数被激活以后，会将主线程的控制权交给 foo 函数的协程，并同时将 value 值传给该协程。</p>
<p>foo 协程激活之后，会把刚才的 value 值赋给了变量 a，然后 foo 协程继续执行后续语句，执行完成之后，将控制权归还给父协程。</p>
<p>以上就是 await/async 的执行流程。正是因为 async 和 await 在背后为我们做了大量的工作，所以我们才能用同步的方式写出异步代码来</p>
<h2 id="总结-5"><a href="#%E6%80%BB%E7%BB%93-5" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>总结</h2>
<ul>
<li>Promise 的编程模型依然充斥着大量的 then 方法，虽然解决了回调地狱的问题，但是在语义方面依然存在缺陷，代码中充斥着大量的 then 函数，这就是 async/await 出现的原因。</li>
<li>使用 async/await 可以实现用同步代码的风格来编写异步代码，这是因为 async/await 的基础技术使用了生成器和 Promise，生成器是协程的实现，利用生成器能实现生成器函数的暂停和恢复。</li>
<li>另外，V8 引擎还为 async/await 做了大量的语法层面包装，所以了解隐藏在背后的代码有助于加深你对 async/await 的理解。</li>
<li>async/await 无疑是异步编程领域非常大的一个革新，也是未来的一个主流的编程风格。其实，除了 JavaScript，Python、Dart、C# 等语言也都引入了 async/await，使用它不仅能让代码更加整洁美观，而且还能确保该函数始终都能返回 Promise</li>
</ul></section><div class="separator" data-reactid="76"></div><footer class="post-footer" data-reactid="77"><section class="share text-center" data-reactid="78"><ul class="share-buttons list-inline" data-reactid="79"><li data-reactid="80"><b data-reactid="81">分享到</b></li><li class="link-twitter" data-reactid="82"><div role="button" tabindex="0" class="SocialMediaShareButton SocialMediaShareButton--twitter share-twitter" data-reactid="83"><span data-reactid="84">Twitter</span></div></li><li class="link-facebook" data-reactid="85"><div role="button" tabindex="0" class="SocialMediaShareButton SocialMediaShareButton--facebook share-facebook" data-reactid="86"><span data-reactid="87">Facebook</span></div></li><li class="link-google-plus" data-reactid="88"><div role="button" tabindex="0" class="SocialMediaShareButton SocialMediaShareButton--googlePlus share-google-plus" data-reactid="89"><span data-reactid="90">Google+</span></div></li><li class="link-reddit" title="浏览器工作原理与实践——页面循环系统" data-reactid="91"><div role="button" tabindex="0" class="SocialMediaShareButton SocialMediaShareButton--reddit share-reddit" data-reactid="92"><span data-reactid="93">Reddit</span></div></li></ul></section></footer><section class="blog-section" data-reactid="94"><div data-reactid="95"><header class="header" data-reactid="96"><h2 data-reactid="97">评论</h2></header><div id="gitalk-container" data-reactid="98"></div></div></section><section class="blog-section" data-reactid="99"><header class="header" data-reactid="100"><h2 data-reactid="101">阅读上一篇</h2></header><div data-reactid="102"><a class="navigate-link" href="/browser-working-principle-page/" data-reactid="103">浏览器工作原理与实践——浏览器中的页面</a><div data-reactid="104">2021-07-07 09:41:05</div><p class="navigate-desc" data-reactid="105">页面性能分析：利用 chrome 做 web…</p></div></section><section class="blog-section" data-reactid="106"><header class="header" data-reactid="107"><h2 data-reactid="108">阅读下一篇</h2></header><div data-reactid="109"><a class="navigate-link" href="/browser-working-principle-v8/" data-reactid="110">浏览器工作原理与实践——V8工作原理</a><div data-reactid="111">2021-07-05 11:30:26</div><p class="navigate-desc" data-reactid="112">栈空间和堆空间：数据是如何存储的 对于前端开发者来说，JavaScript 的内存机制是一个不被经常提及的概念，因此很容易被忽视。特别是一些非计算机专业的同学，对内存机制可能没有非常清晰的认识，甚至有些同学根本就不知道 JavaScript…</p></div></section></article></div><div class="headings" style="width:350px;left:-420px;" data-reactid="113"><div style="position:relative;user-select:auto;width:350px;height:auto;min-width:200px;box-sizing:border-box;flex-shrink:0;" class="index-resizable" data-reactid="114"><div class="index-container" data-reactid="115"><div class="index-title" data-reactid="116">目录</div><div class="index-list catalog" data-reactid="117"><ul>
<li>
<p><a href="/browser-working-principle-cycle-system/#%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97%E5%92%8C%E4%BA%8B%E4%BB%B6%E5%BE%AA%E7%8E%AF%EF%BC%9A%E9%A1%B5%E9%9D%A2%E6%98%AF%E6%80%8E%E4%B9%88%E6%B4%BB%E8%B5%B7%E6%9D%A5%E7%9A%84">消息队列和事件循环：页面是怎么活起来的</a></p>
<ul>
<li><a href="/browser-working-principle-cycle-system/#%E4%BD%BF%E7%94%A8%E5%8D%95%E7%BA%BF%E7%A8%8B%E5%A4%84%E7%90%86%E5%AE%89%E6%8E%92%E5%A5%BD%E7%9A%84%E4%BB%BB%E5%8A%A1">使用单线程处理安排好的任务</a></li>
<li><a href="/browser-working-principle-cycle-system/#%E5%9C%A8%E7%BA%BF%E7%A8%8B%E8%BF%90%E8%A1%8C%E8%BF%87%E7%A8%8B%E4%B8%AD%E5%A4%84%E7%90%86%E6%96%B0%E4%BB%BB%E5%8A%A1">在线程运行过程中处理新任务</a></li>
<li><a href="/browser-working-principle-cycle-system/#%E5%A4%84%E7%90%86%E5%85%B6%E4%BB%96%E7%BA%BF%E7%A8%8B%E5%8F%91%E9%80%81%E8%BF%87%E6%9D%A5%E7%9A%84%E4%BB%BB%E5%8A%A1">处理其他线程发送过来的任务</a></li>
<li><a href="/browser-working-principle-cycle-system/#%E5%A4%84%E7%90%86%E5%85%B6%E4%BB%96%E8%BF%9B%E7%A8%8B%E5%8F%91%E9%80%81%E8%BF%87%E6%9D%A5%E7%9A%84%E4%BB%BB%E5%8A%A1">处理其他进程发送过来的任务</a></li>
<li><a href="/browser-working-principle-cycle-system/#%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97%E4%B8%AD%E7%9A%84%E4%BB%BB%E5%8A%A1%E7%B1%BB%E5%9E%8B">消息队列中的任务类型</a></li>
<li><a href="/browser-working-principle-cycle-system/#%E5%A6%82%E4%BD%95%E5%AE%89%E5%85%A8%E9%80%80%E5%87%BA">如何安全退出</a></li>
<li>
<p><a href="/browser-working-principle-cycle-system/#%E9%A1%B5%E9%9D%A2%E4%BD%BF%E7%94%A8%E5%8D%95%E7%BA%BF%E7%A8%8B%E7%9A%84%E7%BC%BA%E7%82%B9">页面使用单线程的缺点</a></p>
<ul>
<li><a href="/browser-working-principle-cycle-system/#%E5%A6%82%E4%BD%95%E5%A4%84%E7%90%86%E9%AB%98%E4%BC%98%E5%85%88%E7%BA%A7%E7%9A%84%E4%BB%BB%E5%8A%A1">如何处理高优先级的任务</a></li>
<li><a href="/browser-working-principle-cycle-system/#%E5%A6%82%E4%BD%95%E8%A7%A3%E5%86%B3%E5%8D%95%E4%B8%AA%E4%BB%BB%E5%8A%A1%E6%89%A7%E8%A1%8C%E6%97%B6%E9%95%BF%E8%BF%87%E4%B9%85%E7%9A%84%E9%97%AE%E9%A2%98">如何解决单个任务执行时长过久的问题</a></li>
</ul>
</li>
<li><a href="/browser-working-principle-cycle-system/#%E5%AE%9E%E8%B7%B5%EF%BC%9A%E6%B5%8F%E8%A7%88%E5%99%A8%E9%A1%B5%E9%9D%A2%E6%98%AF%E5%A6%82%E4%BD%95%E8%BF%90%E8%A1%8C%E7%9A%84">实践：浏览器页面是如何运行的</a></li>
<li><a href="/browser-working-principle-cycle-system/#%E6%80%BB%E7%BB%93">总结</a></li>
</ul>
</li>
<li>
<p><a href="/browser-working-principle-cycle-system/#webapi%EF%BC%9Asettimeout-%E6%98%AF%E6%80%8E%E4%B9%88%E5%AE%9E%E7%8E%B0%E7%9A%84">Webapi：setTimeout 是怎么实现的</a></p>
<ul>
<li><a href="/browser-working-principle-cycle-system/#%E6%B5%8F%E8%A7%88%E5%99%A8%E6%80%8E%E4%B9%88%E5%AE%9E%E7%8E%B0-settimeout">浏览器怎么实现 setTimeout</a></li>
<li>
<p><a href="/browser-working-principle-cycle-system/#%E4%BD%BF%E7%94%A8-settimeout-%E7%9A%84%E4%B8%80%E4%BA%9B%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9">使用 setTimeout 的一些注意事项</a></p>
<ul>
<li><a href="/browser-working-principle-cycle-system/#%E5%A6%82%E6%9E%9C%E5%BD%93%E5%89%8D%E4%BB%BB%E5%8A%A1%E6%89%A7%E8%A1%8C%E6%97%B6%E9%97%B4%E8%BF%87%E4%B9%85%EF%BC%8C%E4%BC%9A%E5%BD%B1%E5%BB%B6%E8%BF%9F%E5%88%B0%E6%9C%9F%E5%AE%9A%E6%97%B6%E5%99%A8%E4%BB%BB%E5%8A%A1%E7%9A%84%E6%89%A7%E8%A1%8C">如果当前任务执行时间过久，会影延迟到期定时器任务的执行</a></li>
<li><a href="/browser-working-principle-cycle-system/#%E5%A6%82%E6%9E%9C-settimeout-%E5%AD%98%E5%9C%A8%E5%B5%8C%E5%A5%97%E8%B0%83%E7%94%A8%EF%BC%8C%E9%82%A3%E4%B9%88%E7%B3%BB%E7%BB%9F%E4%BC%9A%E8%AE%BE%E7%BD%AE%E6%9C%80%E7%9F%AD%E6%97%B6%E9%97%B4%E9%97%B4%E9%9A%94%E4%B8%BA-4-%E6%AF%AB%E7%A7%92">如果 setTimeout 存在嵌套调用，那么系统会设置最短时间间隔为 4 毫秒</a></li>
<li><a href="/browser-working-principle-cycle-system/#%E6%9C%AA%E6%BF%80%E6%B4%BB%E7%9A%84%E9%A1%B5%E9%9D%A2%EF%BC%8Csettimeout-%E6%89%A7%E8%A1%8C%E6%9C%80%E5%B0%8F%E9%97%B4%E9%9A%94%E6%98%AF-1000-%E6%AF%AB%E7%A7%92">未激活的页面，setTimeout 执行最小间隔是 1000 毫秒</a></li>
<li><a href="/browser-working-principle-cycle-system/#%E5%BB%B6%E6%97%B6%E6%89%A7%E8%A1%8C%E6%97%B6%E9%97%B4%E6%9C%89%E6%9C%80%E5%A4%A7%E5%80%BC">延时执行时间有最大值</a></li>
<li><a href="/browser-working-principle-cycle-system/#%E4%BD%BF%E7%94%A8-settimeout-%E8%AE%BE%E7%BD%AE%E7%9A%84%E5%9B%9E%E8%B0%83%E5%87%BD%E6%95%B0%E4%B8%AD%E7%9A%84-this-%E4%B8%8D%E7%AC%A6%E5%90%88%E7%9B%B4%E8%A7%89">使用 setTimeout 设置的回调函数中的 this 不符合直觉</a></li>
</ul>
</li>
<li><a href="/browser-working-principle-cycle-system/#%E6%80%BB%E7%BB%93-1">总结</a></li>
</ul>
</li>
<li>
<p><a href="/browser-working-principle-cycle-system/#webapi%EF%BC%9Axmlhttprequest-%E6%98%AF%E6%80%8E%E4%B9%88%E5%AE%9E%E7%8E%B0%E7%9A%84">Webapi：XMLHttpRequest 是怎么实现的</a></p>
<ul>
<li><a href="/browser-working-principle-cycle-system/#%E5%9B%9E%E8%B0%83%E5%87%BD%E6%95%B0-vs-%E7%B3%BB%E7%BB%9F%E8%B0%83%E7%94%A8%E6%A0%88">回调函数 VS 系统调用栈</a></li>
<li>
<p><a href="/browser-working-principle-cycle-system/#xmlhttprequest-%E8%BF%90%E4%BD%9C%E6%9C%BA%E5%88%B6">XMLHttpRequest 运作机制</a></p>
<ul>
<li><a href="/browser-working-principle-cycle-system/#%E5%88%9B%E5%BB%BA-xmlhttprequest-%E5%AF%B9%E8%B1%A1">创建 XMLHttpRequest 对象</a></li>
<li><a href="/browser-working-principle-cycle-system/#%E4%B8%BA-xhr-%E5%AF%B9%E8%B1%A1%E6%B3%A8%E5%86%8C%E5%9B%9E%E8%B0%83%E5%87%BD%E6%95%B0">为 xhr 对象注册回调函数</a></li>
<li><a href="/browser-working-principle-cycle-system/#%E9%85%8D%E7%BD%AE%E5%9F%BA%E7%A1%80%E7%9A%84%E8%AF%B7%E6%B1%82%E4%BF%A1%E6%81%AF">配置基础的请求信息</a></li>
<li><a href="/browser-working-principle-cycle-system/#%E5%8F%91%E8%B5%B7%E8%AF%B7%E6%B1%82">发起请求</a></li>
</ul>
</li>
<li>
<p><a href="/browser-working-principle-cycle-system/#xmlhttprequest-%E4%BD%BF%E7%94%A8%E8%BF%87%E7%A8%8B%E4%B8%AD%E7%9A%84%E5%9D%91">XMLHttpRequest 使用过程中的“坑”</a></p>
<ul>
<li><a href="/browser-working-principle-cycle-system/#%E8%B7%A8%E5%9F%9F%E9%97%AE%E9%A2%98">跨域问题</a></li>
<li><a href="/browser-working-principle-cycle-system/#https-%E6%B7%B7%E5%90%88%E5%86%85%E5%AE%B9%E7%9A%84%E9%97%AE%E9%A2%98">HTTPS 混合内容的问题</a></li>
</ul>
</li>
<li><a href="/browser-working-principle-cycle-system/#%E6%80%BB%E7%BB%93-2">总结</a></li>
</ul>
</li>
<li>
<p><a href="/browser-working-principle-cycle-system/#%E5%AE%8F%E4%BB%BB%E5%8A%A1%E5%92%8C%E5%BE%AE%E4%BB%BB%E5%8A%A1%EF%BC%9A%E4%B8%8D%E6%98%AF%E6%89%80%E6%9C%89%E7%9A%84%E4%BB%BB%E5%8A%A1%E9%83%BD%E6%98%AF%E4%B8%80%E4%B8%AA%E5%BE%85%E9%81%87">宏任务和微任务：不是所有的任务都是一个待遇</a></p>
<ul>
<li><a href="/browser-working-principle-cycle-system/#%E5%AE%8F%E4%BB%BB%E5%8A%A1">宏任务</a></li>
<li><a href="/browser-working-principle-cycle-system/#%E5%BE%AE%E4%BB%BB%E5%8A%A1">微任务</a></li>
<li><a href="/browser-working-principle-cycle-system/#%E7%9B%91%E5%90%AC-dom-%E5%8F%98%E5%8C%96%E6%96%B9%E6%B3%95%E6%BC%94%E5%8F%98">监听 DOM 变化方法演变</a></li>
<li><a href="/browser-working-principle-cycle-system/#%E6%80%BB%E7%BB%93-3">总结</a></li>
</ul>
</li>
<li>
<p><a href="/browser-working-principle-cycle-system/#%E4%BD%BF%E7%94%A8-promise-%E5%91%8A%E5%88%AB%E5%9B%9E%E8%B0%83%E5%87%BD%E6%95%B0">使用 Promise 告别回调函数</a></p>
<ul>
<li><a href="/browser-working-principle-cycle-system/#%E5%BC%82%E6%AD%A5%E7%BC%96%E7%A8%8B%E7%9A%84%E9%97%AE%E9%A2%98%EF%BC%9A%E4%BB%A3%E7%A0%81%E9%80%BB%E8%BE%91%E4%B8%8D%E8%BF%9E%E7%BB%AD">异步编程的问题：代码逻辑不连续</a></li>
<li><a href="/browser-working-principle-cycle-system/#%E5%B0%81%E8%A3%85%E5%BC%82%E6%AD%A5%E4%BB%A3%E7%A0%81%EF%BC%8C%E8%AE%A9%E5%A4%84%E7%90%86%E6%B5%81%E7%A8%8B%E5%8F%98%E5%BE%97%E7%BA%BF%E6%80%A7">封装异步代码，让处理流程变得线性</a></li>
<li><a href="/browser-working-principle-cycle-system/#%E6%96%B0%E7%9A%84%E9%97%AE%E9%A2%98%EF%BC%9A%E5%9B%9E%E8%B0%83%E5%9C%B0%E7%8B%B1">新的问题：回调地狱</a></li>
<li><a href="/browser-working-principle-cycle-system/#promise%EF%BC%9A%E6%B6%88%E7%81%AD%E5%B5%8C%E5%A5%97%E8%B0%83%E7%94%A8%E5%92%8C%E5%A4%9A%E6%AC%A1%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86">Promise：消灭嵌套调用和多次错误处理</a></li>
<li><a href="/browser-working-principle-cycle-system/#promise-%E4%B8%8E%E5%BE%AE%E4%BB%BB%E5%8A%A1">Promise 与微任务</a></li>
<li><a href="/browser-working-principle-cycle-system/#%E6%80%BB%E7%BB%93-4">总结</a></li>
</ul>
</li>
<li>
<p><a href="/browser-working-principle-cycle-system/#async-await-%E4%BD%BF%E7%94%A8%E5%90%8C%E6%AD%A5%E6%96%B9%E5%BC%8F%E5%86%99%E5%BC%82%E6%AD%A5%E4%BB%A3%E7%A0%81">async await 使用同步方式写异步代码</a></p>
<ul>
<li><a href="/browser-working-principle-cycle-system/#%E7%94%9F%E6%88%90%E5%99%A8-vs-%E5%8D%8F%E7%A8%8B">生成器 VS 协程</a></li>
<li>
<p><a href="/browser-working-principle-cycle-system/#asyncawait">async/await</a></p>
<ul>
<li><a href="/browser-working-principle-cycle-system/#async">async</a></li>
<li><a href="/browser-working-principle-cycle-system/#await">await</a></li>
</ul>
</li>
<li><a href="/browser-working-principle-cycle-system/#%E6%80%BB%E7%BB%93-5">总结</a></li>
</ul>
</li>
</ul></div></div><div data-reactid="118"><div class="" style="position:absolute;user-select:none;width:10px;height:100%;top:0px;right:-5px;cursor:col-resize;" data-reactid="119"></div></div></div></div><div class="collapse-icon" style="left:-100px;" data-reactid="120"><i class="icon icon-text-document" style="font-size:24px;" data-reactid="121"></i></div></main></div></section><div data-reactid="122"><footer class="footer-social" data-reactid="123"><ul class="social" data-reactid="124"><li data-reactid="125"><a href="tencent://AddContact/?fromId=45&amp;fromSubId=1&amp;subcmd=all&amp;uin=634407147&amp;website=www.oicqzone.com" title="qq" data-reactid="126"><i class="icon-qq" data-reactid="127"></i></a></li><li data-reactid="128"><a rel="noopener noreferrer" target="_blank" href="https://github.com/towavephone" title="github" data-reactid="129"><i class="icon-github" data-reactid="130"></i></a></li><li data-reactid="131"><a title="订阅我" href="/rss.xml" data-reactid="132"><i class="icon-rss" data-reactid="133"></i></a></li><li data-reactid="134"><a href="mailto:634407147@qq.com" title="634407147@qq.com" data-reactid="135"><i class="icon-mail" data-reactid="136"></i></a></li></ul><div class="text-center" data-reactid="137"><!-- react-text: 138 -->Copyright <!-- /react-text --><!-- react-text: 139 -->2021<!-- /react-text --><!-- react-text: 140 --> <!-- /react-text --><a title="女王控" href="/" data-reactid="141">女王控</a><span class="separator" data-reactid="142"> • </span><!-- react-text: 143 --> Design by<!-- /react-text --><!-- react-text: 144 --> <!-- /react-text --><a rel="noopener noreferrer" href="http://www.attheo.do" target="_blank" data-reactid="145">Thanos Theodoridis</a></div></footer></div><div class="totop" data-reactid="146"><i class="icon icon-arrow-up" data-reactid="147"></i><span class="progress" data-reactid="148"><!-- react-text: 149 -->0<!-- /react-text --><!-- react-text: 150 -->%<!-- /react-text --></span><div class="bg" style="height:0%;" data-reactid="151"></div></div></div></div><script id="webpack-manifest">/*<![CDATA[*/window.webpackManifest={"231608221292675":"app-55aebb8759ef5001bcc6.js","99219681209289":"component---node-modules-gatsby-plugin-offline-app-shell-js-5c4c5a0f7af9dc69d6d7.js","107818501498521":"component---src-templates-blog-post-js-c46de7a038aabbed0010.js","50739212244294":"component---src-templates-tags-js-745fac34d9c2957ee313.js","96961042003272":"component---src-templates-page-js-ffe7514ae4cba9ce6b67.js","162898551421021":"component---src-pages-404-js-7c37afdedb298cb7570b.js","263791100135453":"component---src-pages-about-js-de0b4869988a9d741904.js","31982145417011":"component---src-pages-drafts-js-b71b96814250b09e4db0.js","35783957827783":"component---src-pages-index-js-99fe18aea744a3f20606.js","142807904292071":"component---src-pages-search-js-cd6631034269136b8957.js","195850678278728":"component---src-pages-tags-js-cc05870a8fb0bb34f2c9.js","60335399758886":"path----9abe2c42e691328dc88a.js","210333531512890":"path---offline-plugin-app-shell-fallback-a0e39f21c11f6a62c5ab.js","29664229663391":"path---browser-working-principle-e57e54c062b0dd36ad4f.js","165731217802763":"path---deep-learn-browser-cache-cae879f417c1d83e1bd2.js","66692416344048":"path---browser-working-principle-network-09996c18cd0b2ef76345.js","73602225439089":"path---browser-working-principle-page-eaab1039f9bea8a86ffa.js","492532704081":"path---browser-working-principle-cycle-system-3be3b846f04ba9d2332f.js","251976105315209":"path---browser-working-principle-v-8-f2f69f03fe827dc5e812.js","206917093457610":"path---browser-working-principle-macro-view-556a67365c423cbadcc4.js","126633788188374":"path---browser-cross-page-message-ed03a927dc0f282d6fc1.js","210694630403324":"path---deep-learn-generators-72eebb5162f4313ff388.js","78440977445721":"path---js-event-loop-249348df67218fcbf458.js","233970388780779":"path---v-8-garbage-collection-0036370ee9e31eb2d9ca.js","23843792806586":"path---qiankun-code-note-15eda0dcae7fb8cff3c8.js","241269254124122":"path---arcgis-map-component-build-deploy-0721db8a7eb057f15480.js","249319820248966":"path---nodejs-interview-introduce-learn-bc35691e3bde35d98fb8.js","154644243914344":"path---react-technology-notes-realization-b39a87e6b2ae916b0c94.js","219666366619082":"path---react-technology-notes-framework-b93a0d18f17f0ea73b66.js","173308893671871":"path---react-technology-notes-idea-284015673cdf850a9618.js","209575525104292":"path---clean-code-js-7511a311e929f4fc7cce.js","6709471654091":"path---plug-interceptor-middleware-74fe3aeb3272110ca082.js","132595871305077":"path---async-exception-throw-evolution-7217c67bea7ac6aca9fa.js","144742700921027":"path---async-await-simplest-implementation-234b11009f20ed8928b8.js","138127542190632":"path---sequelize-one-to-many-find-solution-e9064e9224e660b8584d.js","198510910721196":"path---nodemon-monitor-link-changes-307dbc33c4035ada9817.js","27415825092918":"path---promise-implementation-principle-7d234f7aced8b9b6d35e.js","264874119113479":"path---vim-shortcut-key-practice-learn-8f7c94c8c087b78eabd2.js","227875603435760":"path---webpack-principle-introduction-6102f690197d1f23fbc5.js","264168148062257":"path---type-script-introduce-learn-1891a71ada3f926f9856.js","173935164423494":"path---javascript-es-6-note-7cabaef7951168c5b733.js","117732534929967":"path---module-federation-principle-research-daf267f0e30e6712cf81.js","213245857996204":"path---new-window-technology-research-1947ea1c0e8fc84c91fc.js","119805349474264":"path---mobile-h-5-startup-way-50e9947e1de326bcde39.js","182499067408490":"path---mobile-page-adaptation-e516bc191261aea982f9.js","68006741273571":"path---webpack-v-5-new-feature-5118574359c214c61291.js","110988585264394":"path---javascript-subject-note-b141f3094bc2e77c9a27.js","198141680726347":"path---javascript-deep-learn-note-7ab749146e9f7b7c8beb.js","140488902913988":"path---handle-service-worker-updates-422a26cc6b758b7bba69.js","193855178077404":"path---advanced-front-end-knowledge-points-2da5d21cc4ca6a352a41.js","154641886463502":"path---middle-front-end-knowledge-points-bfaeceddc222a006681f.js","78808260981090":"path---react-fiber-data-struct-76d49f389be98dcc60fb.js","187160597537092":"path---git-code-statistics-script-101ba9faa06ddf996f3c.js","265278845270929":"path---micro-front-end-demo-practice-aa7e1327967f85fface9.js","59754615026819":"path---mobile-adaptation-summary-6e78cdefd28951e6fe0c.js","38593257236695":"path---tour-of-compiler-if-statements-d02d485c0902aa1d5b2f.js","230536583370633":"path---tour-of-compiler-comparison-operators-00d271000971ab1536d7.js","264484976136942":"path---tour-of-compiler-variables-80bd5900a187465846d0.js","31039800244851":"path---tour-of-compiler-declarative-statement-30da2b17430fd7d9971b.js","92273702718447":"path---tour-of-compiler-real-compiler-79a57471fc7b62504815.js","226680921848275":"path---tour-of-compiler-operator-precedence-5696e0255e431469ea42.js","274483352016785":"path---tour-of-compiler-analysis-introduction-fb6f1f4e08029776fdbb.js","170668952363537":"path---tour-of-compiler-lexical-analysis-0be8666f71b8fb3b2ebd.js","82802516877727":"path---summary-of-technology-selection-in-2019-2193bd844bb1032b928e.js","269915331335885":"path---tips-blank-character-chinese-align-a14a3e86801b9e766f58.js","49441064980499":"path---js-relative-absolute-path-c24db83b2aca37626d03.js","109110832112880":"path---css-world-flow-destroy-protect-a00e6bc7dbfe7cf011b3.js","141992300323963":"path---html-5-canvas-image-compress-upload-25e4759e6d318a651687.js","82548825117353":"path---canvas-picture-watermark-synthesis-87be012e88e8770611d4.js","159609538554957":"path---css-focus-within-pseudo-class-selector-cc3cb1f05c77716d536e.js","101417603278349":"path---svg-canvas-nonzero-evenodd-01b8e7b55e9ce6fb69c5.js","247968284594616":"path---css-js-scroll-smooth-437d7cff85e12da5c2db.js","216105761065771":"path---css-world-text-processing-2aa89949683d002df35e.js","95541628699068":"path---css-world-stacking-rule-9eee92375eb662ff3b09.js","46951400172558":"path---text-selected-shared-628e7e8c95e259bf2703.js","110619198058412":"path---simplify-your-css-code-db6992beb8be268d3ae0.js","233462761007109":"path---page-visibility-api-introduction-extend-5aedce3ad6cb6e78499e.js","195172636032870":"path---browser-style-decimal-9ff6cfa185bf67fa4b9f.js","272195067543221":"path---html-body-some-feature-b7f65dc76c10b6294d57.js","163889365749263":"path---checkbox-radio-text-align-ad5b4efe907d87b5bf9b.js","72541711572225":"path---css-3-animation-requestanimationframe-tween-f65ab33053eaea5f1964.js","104847515272882":"path---dom-practice-test-1aeba03f38b610ed978a.js","151439111480636":"path---js-practice-test-c653dbaa0d2b4e213336.js","30374064348324":"path---css-practice-test-0dc21a8ddd749e454703.js","98631712756975":"path---treated-as-passive-error-handle-b29d8056140be4991758.js","266574558670767":"path---css-flex-deep-faa83bb3dcebdd2147b9.js","21823713651784":"path---html-5-canvas-video-barrage-fac92d60faceed701677.js","95626578819758":"path---js-api-pointer-lock-25d43fa3101d6547b87f.js","240315923619403":"path---css-data-report-html-validate-c8b71acad7694a7171cc.js","127813417734943":"path---disabled-all-form-elements-1aef42b829bb9314ca77.js","188475446395154":"path---crossorigin-canvas-getimagedata-cors-323a6a30249fb2b88baf.js","187494725313217":"path---js-text-string-download-as-html-json-file-50c8f3ebd7499fd99439.js","272511819627113":"path---html-download-attribute-417364e66c9fd7744025.js","248846600346262":"path---js-dom-innertext-textcontent-0f7d71ef570b7c126caa.js","202335988892822":"path---document-readystate-116ce57f9b89d64a5a6a.js","61022664142917":"path---htmlunknownelement-html-5-custom-elements-86529a77e1bcf06987e1.js","19734167489592":"path---content-css-var-19be2b532addafd6fea4.js","66989148915586":"path---css-not-pseudo-class-26b901796d580c11cd3e.js","141417946962394":"path---iframe-html-5-blob-code-view-326000abb219ed32b35b.js","49300589254192":"path---js-css-supports-detect-eaac5dc3c6b741f940e7.js","76438789647706":"path---nodejs-introduce-learn-031d41a915d1054c7aa7.js","37794390829194":"path---lightweight-website-construction-458d34021b1262db4bbe.js","134962980590853":"path---building-platform-lightweight-components-9b0331fcd901fb998762.js","115042040031774":"path---webpack-template-new-project-db86b7f1bb4098aaf846.js","32322750695760":"path---commonjs-summary-extension-a5d26ff86a8a18b34f49.js","16887684178233":"path---react-create-context-practice-learn-da47635a9cdada93b369.js","189993371551974":"path---js-basic-of-extend-b7bf9135390ac9986c49.js","111070682281443":"path---react-create-ref-practice-learn-6fda47995b8ad862d572.js","23621578112341":"path---react-forward-ref-practice-learn-73eef1a61fa07a1d7ddc.js","215901486510903":"path---react-component-practice-learn-693f70c2fb67c18994bb.js","180991392895427":"path---react-purecomponent-practice-learn-89cb2d8d9ad3d2fe23a8.js","37985464542653":"path---react-lifecycle-practice-learn-a15b0c79b59b98bbee58.js","178492137542081":"path---webpack-upgrade-about-product-3d5dd51542fa50e206e7.js","102543393368289":"path---regex-introduce-learn-7c72251b753d6dd5b02f.js","26795806700048":"path---tree-traversal-depth-copy-61fe04b6b455958380b6.js","262384701263052":"path---debounce-throttle-difference-realize-a3818dcfe37e738becfa.js","141526626617229":"path---css-equal-height-3918bd4cdf582f85ad03.js","256518113803814":"path---sip-protocol-practice-40e6b0c4978a045d734e.js","1482970639750":"path---sip-protocol-introduction-learning-2e69297799e16a75df14.js","206755618451597":"path---nginx-common-configurations-techniques-0280360e568233e72277.js","67481178795841":"path---write-resilient-components-422866a1db294901d63e.js","84017562852647":"path---frontend-debug-skill-383b79b2c60d1238f75e.js","240569215673226":"path---react-16-new-feature-98713b3e09645f3f99bc.js","99361632293659":"path---frontend-module-development-57490bb84b4c906b5e0f.js","109582715248421":"path---components-pack-as-library-dd416591eec778567771.js","135746070171372":"path---webpack-config-note-3ff2344ce02d4e240011.js","26409159992655":"path---ui-auto-test-note-eb3223d8b6e223c2f28b.js","55192805921463":"path---react-interview-question-95a51b35b5e2ed6ed3d9.js","189837882542944":"path---react-design-pattern-ac7f60f5dad638783190.js","120474358904736":"path---chrome-debug-practice-54791406e5fed1ac6d07.js","96783395857140":"path---js-constructor-prototype-proto-dc09d9d20a9316108eab.js","125414828153565":"path---wavesurfer-voice-wave-research-f490b844001c484b0d74.js","4677310189427":"path---rich-input-question-8faacf207574a1875fd5.js","133380808647674":"path---reactplayer-ie-compatibility-45a01d105dd685358922.js","189819586673572":"path---you-dont-know-js-asynchronism-and-performance-76d5c171aef4d1553760.js","239009554120018":"path---git-flight-rules-f307acec879939c55011.js","166593258765218":"path---css-classic-example-6c838d2b6c225cbbfe81.js","298824337312":"path---css-world-inline-element-flow-32f615bad27b133c19c0.js","192529106435518":"path---css-world-four-kinds-of-box-43e70e084d3787d77bbe.js","29858146650202":"path---rxjs-deep-learn-1e081e67f0bdae8345a5.js","154101502709845":"path---rxjs-introduce-learn-e17500718dbb95b96fb9.js","246826653707843":"path---redux-calculating-derived-data-2b28ba08ae869405133e.js","56688832912952":"path---redux-saga-introduce-learn-22a1feb867e6f0488763.js","35215107077800":"path---redux-deep-learn-4045afad0656c051d047.js","250319174066818":"path---immutable-introduce-learn-05f87a90a048a944911d.js","266856770294758":"path---redux-introduce-learn-3ce3262e8d0d0f129583.js","74874845339421":"path---interview-question-analysis-a9ad62e774557e7a222a.js","127390024272194":"path---you-dont-know-js-this-f6bd2c75f59bf23c3b98.js","46048776209243":"path---you-dont-know-js-scope-closure-36e22684886d2e243ae1.js","3203333590612":"path---css-world-flow-element-size-26874b72f9212f0e83e5.js","151576129033544":"path---css-world-overview-term-4d082fe226a1a99c0806.js","130609919784473":"path---react-virtual-dom-5e2ed02b386551fd2380.js","157650046329573":"path---mvvm-principle-0424248721d56dc136bf.js","181823707396581":"path---design-pattern-behavior-3-7f78a1e56a1a2116714f.js","77780585648407":"path---design-pattern-behavior-2-97595506c30cbfaedb6b.js","140068777058045":"path---design-pattern-behavior-1-23e2f8c282aadc5ec2b1.js","140863066927165":"path---design-pattern-structure-2-aafa161235a324a70844.js","57683576168785":"path---design-pattern-structure-1-06c795057d0638fa35e6.js","279644622097558":"path---design-pattern-construction-bf034642dde43439f0fc.js","233796934417334":"path---front-end-interview-js-b8be84d31b7152a38ab6.js","172338214531871":"path---front-end-interview-css-da6205cd99e928b21140.js","172792547499645":"path---front-end-interview-html-fb91255d1d8fb170df63.js","153003541832976":"path---code-readability-826e9c811e319297a2e0.js","238950460306079":"path---code-restructure-ccd4c65d9591bedee5ed.js","186817101542729":"path---mysql-introduce-7756b037af4ad440dcc3.js","67868663466541":"path---sql-must-know-e5c4ff5fdaa95456e236.js","179123734216878":"path---database-principle-78ffdf1102daee6a824d.js","197528540878311":"path---object-oriented-thinking-0da97b3357ec0165d24f.js","255809964947665":"path---database-commonly-used-statements-d16d389f1b32ed4b2869.js","39260881961776":"path---linux-introduce-8a4a0474b53d9987e25f.js","247575535157272":"path---os-principle-b11bda224b82c90a4097.js","220391400373878":"path---http-reading-notes-9e09ef70e04582209b78.js","152766969759832":"path---mathjax-usage-3ecb9993127747e0ba42.js","191048638926708":"path---computer-network-notes-2fc3d5e201319bcea953.js","16029065190934":"path---find-java-b4d95f611ee788e693e5.js","131858814825615":"path---sort-java-4ab0277ae2dfa422f244.js","179513461417981":"path---offer-connexity-0a54b1ca173bcb1cbe40.js","2077809429520":"path---stack-queue-java-dfc497d3cf60288dd012.js","94884530434318":"path---offer-sort-e13c020007fe6cc45956.js","269098541434364":"path---offer-stack-queue-82ebd8a1a500a15bf5cf.js","22537169709993":"path---offer-binary-tree-ca625ffe98bb80405e3c.js","200193712851722":"path---offer-linked-list-e6fe5d0307c9fd644d7a.js","94907309432306":"path---offer-find-b84e4130307bec8f6587.js","158498598503450":"path---snow-css-78658f7b46514c93d0d9.js","209763765154159":"path---front-end-performance-optimization-5185603766ba3a68a56c.js","255113926979057":"path---front-end-interview-777fc070c76d8f15ebdb.js","116349555253862":"path---commit-message-f871f3cd001fbc3559a2.js","228154231362593":"path---webpack-code-split-f4725833d0833c2662bb.js","70747314155962":"path---optimize-react-023940fffc1534dc34e7.js","246937419070161":"path---react-usage-part-3-c0768a4354a3293a6ff9.js","5694392597594":"path---docker-origin-guonei-bf895936eeab48766664.js","256465420633148":"path---docker-know-269bee4a48446c24544d.js","215705572723171":"path---docker-install-d7693656ba0800eade1d.js","165757041900087":"path---react-usage-part-2-95d38bb841cb68f260be.js","99572342228114":"path---react-usage-part-1-dcc3cbaf667d8fb0f4d7.js","124652324222989":"path---windows-port-0881b9de30e584906978.js","236695045588082":"path---githook-usage-0fa8450feccdcf20e699.js","79993016894138":"path---css-center-0870fce54a6346389e65.js","182899130353333":"path---gitignore-invalid-e80660860d573c47ccda.js","277987419415630":"path---js-design-pattern-9e677a0169fdbe8230b4.js","280217338959103":"path---tag-前端-8117801c2f01395f15b0.js","144619525831214":"path---tag-前端-page-2-2447685877ecb68bf54d.js","134768160992730":"path---tag-前端-page-3-42594db3f6edd6bd1f1e.js","235700789028774":"path---tag-前端-page-4-f29a09198211fd8fb2d8.js","225704977515667":"path---tag-前端-page-5-59ac7120f591bbbdd2fb.js","271595351081153":"path---tag-前端-page-6-1a9c476166451025bcb9.js","116526339399102":"path---tag-前端-page-7-aaba02b0dea41c0f17cf.js","167419548736750":"path---tag-前端-page-8-77f8b604f8cff894df59.js","144565916427361":"path---tag-前端-page-9-1c5221e746e88bd67bdc.js","69805246205965":"path---tag-前端-page-10-f8aab7481149da61fda3.js","166194159146504":"path---tag-前端-page-11-44eb2ef06b7196d31d1c.js","13136377985470":"path---tag-前端-page-12-5aec778aa3278057deb4.js","169681553618413":"path---tag-前端-page-13-74b2a43d039469f6370c.js","112772301067383":"path---tag-前端-page-14-e686ff3a145c06031354.js","255971987764058":"path---tag-前端-page-15-a20b4cc8ae61493ac8ba.js","21818679219157":"path---tag-前端-page-16-1f397d942c3c17f0dda1.js","128402355770693":"path---tag-前端-page-17-78a800d64d66796bf436.js","226488181208339":"path---tag-前端-page-18-ca0f5ec4688b229bbea2.js","51590185498547":"path---tag-前端-page-19-d8f0dbff480e59473a1d.js","187255363806570":"path---tag-前端-page-20-13fb1de13f9e5a75a0d0.js","236915051321587":"path---tag-前端-page-21-a6e6d93b8f215f74c798.js","170231020820745":"path---tag-前端-page-22-663cf237f776ca60f09f.js","255109872729121":"path---tag-前端-page-23-b376a9c863613bd49dd0.js","101071383335311":"path---tag-前端-page-24-c59d481e065955fc16c5.js","99383999428036":"path---tag-前端-page-25-7a44ed111c2ab9aa2c65.js","144380153295286":"path---tag-前端-page-26-7deb8d6d0993add2ef16.js","36422437585920":"path---tag-前端-page-27-4c39e09d92da7091f380.js","170390721126745":"path---tag-浏览器-d72e835f107cf6766920.js","117302061067003":"path---tag-浏览器-page-2-db33145cb6acb8c53232.js","207729938765415":"path---tag-高级前端-a19aa00ecb08e677882a.js","50623193433078":"path---tag-高级前端-page-2-3be60327afe40a816e9b.js","192616484687150":"path---tag-高级前端-page-3-1be660dafd12bef901d4.js","113162919196161":"path---tag-高级前端-page-4-d9b67a27aaf1a0252779.js","128685919153162":"path---tag-高级前端-page-5-c1d18f95c48f21e8726e.js","33668472382135":"path---tag-js-412569e6220d6083ac4b.js","247229810038570":"path---tag-js-page-2-656d8fbc60c7b634779b.js","106314807094431":"path---tag-js-page-3-393ad19b32039be3a918.js","251448199717119":"path---tag-js-page-4-0466d4bccd74356ae308.js","95399022353888":"path---tag-js-page-5-e87665be9d1068f4bb31.js","121601231696452":"path---tag-js-page-6-a7bd9e7d67cfefb9bac7.js","98304590994254":"path---tag-js-page-7-186f90ca13b9c599271c.js","159636287766597":"path---tag-事件循环-05b25c099f4f90a01adc.js","13915931333708":"path---tag-垃圾回收-ef1f398a754e71b15e0d.js","106987270341371":"path---tag-微前端-83a196ef16a00653b481.js","148138180873878":"path---tag-arcgis-baa3da221f5b6ec06410.js","40118790249721":"path---tag-地图-b8c5269057ebc80baa3d.js","3112546720375":"path---tag-预研-821bf50fc48a457e897f.js","175904578583099":"path---tag-预研-page-2-a40561953e86c3141f74.js","139547808704971":"path---tag-预研-page-3-ba18c42427cb3502184e.js","65116756252467":"path---tag-预研-page-4-360d9ee6abb8f805a4f0.js","188115791097782":"path---tag-后端-2e3df73fdb884b2db857.js","175926551659039":"path---tag-后端-page-2-c70d025848d415a367f9.js","222032430269809":"path---tag-后端-page-3-2b2ccfa101b54b619728.js","210141546779958":"path---tag-nodejs-ce451dd212469a0ad3ff.js","279290322679409":"path---tag-react-620ecf0b266dc1a4082c.js","72356264004862":"path---tag-react-page-2-687561846e9d0a9718e9.js","156365063712372":"path---tag-react-page-3-972eb28e02ee44166d41.js","274294878482829":"path---tag-react-page-4-fb3208a35fca2a97ea86.js","73619400011093":"path---tag-js风格-86876edacf81d14b13a6.js","169881772473193":"path---tag-代码风格-7ee942b92b1521523bb2.js","27213340347409":"path---tag-sequelize-9e77f39398d7147d965c.js","236015796260796":"path---tag-sql-402718afcdd3c65e3517.js","216964011399890":"path---tag-nodemon-e285ad7d16d7914ae9b9.js","136558777394075":"path---tag-vim-b54fefcfe4da995b2d67.js","46883582140183":"path---tag-前端构建工具-081f811f73cc3d7e8ad4.js","216092612467307":"path---tag-前端构建工具-page-2-8a7d909f0109fe1e5978.js","214332279260767":"path---tag-webpack-c22287cfff2efa21104c.js","275302807227065":"path---tag-webpack-page-2-6b42528939f20120290b.js","246642745296185":"path---tag-typescript-d77eee656c8bd7f5f7b5.js","112744683526212":"path---tag-跨域通信-02574d5330377e56032e.js","161708165456681":"path---tag-移动端-e2db85609edb75911452.js","67876575737478":"path---tag-h-5-秒开-a8d640241c65481d4d96.js","137101871598456":"path---tag-页面适配-a7bc8baec20fe8abd830.js","148741462354591":"path---tag-service-worker-b15927e3588a5d2cfc70.js","120830084542416":"path---tag-中级前端-77170401506999edb20d.js","264910603292921":"path---tag-react-fiber-dfe58c136d760e0e1caf.js","100106430134091":"path---tag-数据结构-f64255730505fa7ee6c4.js","76183262367588":"path---tag-git-13d982d69db028abe98a.js","47817495489441":"path---tag-git-代码统计-51ddb42fe7365b2308a2.js","141543887851370":"path---tag-兼容性-6aff76db2942988825db.js","136622922599015":"path---tag-编译原理-8b4a6fc4ccb3a56f0852.js","135623521460029":"path---tag-编译原理-page-2-0e5b0ba2c64bc64668bf.js","99329431726685":"path---tag-if语句-0f752ea81e7310955c0d.js","33678702584530":"path---tag-比较运算符-31dadf228b1a47e8d093.js","207953707139114":"path---tag-变量-39bede81f351879bba80.js","89724312631592":"path---tag-声明语句-53e14e0f4fc839d34aaa.js","224756936447063":"path---tag-代码生成-021bbe6b51d4decbf8fa.js","134624525137057":"path---tag-语法分析-7041ebf3788c1f516dbf.js","239036712589926":"path---tag-词法分析-fce81dbb53e3db51439c.js","157828576223872":"path---tag-技术选型-18ccbd448fb7e398190e.js","168271920233154":"path---tag-总结-19a0a5254404d12f2370.js","158044312981956":"path---tag-css-abc94ab488513091ebdd.js","36482110888888":"path---tag-css-page-2-7f8b675c778a5f113dcf.js","20735708223292":"path---tag-css-page-3-d298ff61d471a1a97b4b.js","66025328700304":"path---tag-css-page-4-37aa85afb70f106670cc.js","75036630219270":"path---tag-css-page-5-fd2f85927c32d0bde1a7.js","175842416185399":"path---tag-css知识点-a7ab8d688d14b5dba5d7.js","28595561929447":"path---tag-css知识点-page-2-de31f9f054aff535b53e.js","10948302720247":"path---tag-css知识点-page-3-c96a272b521b780ec1a5.js","15127192101541":"path---tag-js知识点-87acadd61df008cab166.js","237370589647213":"path---tag-js知识点-page-2-b0bfdcdeac29285f14dd.js","118988535768012":"path---tag-js知识点-page-3-ad1c62372877a0d51411.js","47420523622978":"path---tag-css世界-3efd20b74c9c9f233184.js","58378761960698":"path---tag-css世界-page-2-1c07a4e9bf32e8833b60.js","207793193350173":"path---tag-dom-56c7815ec71496f0c107.js","81605620053349":"path---tag-练手测试-0327c01672fe9b02a104.js","250389947503448":"path---tag-dom知识点-178047cac427c570327a.js","269946260161815":"path---tag-轻量级网站-6404cf47e7bc67362463.js","109081405058155":"path---tag-组件轻量化-dda7feb2614d1c0eda19.js","53943148813198":"path---tag-commonjs-d3495ece782363e6538d.js","39355436030835":"path---tag-createcontext-85cfbe8b24bfc065e58b.js","219059167858027":"path---tag-继承-b5d69efd1048810354d9.js","25557126236255":"path---tag-createref-9780afa1d409fe413a6b.js","222411628126134":"path---tag-forwardref-e459299b5fa34109be00.js","138909214601654":"path---tag-purecomponent-7567a445e4da07fdc125.js","248049963584624":"path---tag-生命周期-d987fbc910388bfc6fdd.js","129965793551538":"path---tag-正则表达式-88ecb25cff05d0282812.js","199104359207265":"path---tag-深度拷贝-9beb0cb6aef7b6c7a9eb.js","156877434152751":"path---tag-树的遍历-0dccd6faaeb3d36390ee.js","25860037774440":"path---tag-防抖-3f55da881587c3b30976.js","115363311855183":"path---tag-节流-9fc02fe872e5ed487bc3.js","217003866274046":"path---tag-等高布局-9b4b35fdf2a4a0471689.js","229546239521472":"path---tag-sip-cbb90a65e9f404a54b4c.js","216136966659717":"path---tag-webrtc-41f35ba27844bd57ea5c.js","143446159783939":"path---tag-nginx-62e918f1bfde170224d3.js","63016845154026":"path---tag-组件-75ad5b22ea109a085207.js","209771045166328":"path---tag-调试-07c3433a27594439f12e.js","58912517482029":"path---tag-前端模块化-c8fbdad416827c41e927.js","47274048537731":"path---tag-测试-4d649cc119aaf7d9e2e3.js","221365960632546":"path---tag-ui自动化测试-824fed5e140518fe4696.js","172281229550470":"path---tag-面试-b9d37bef7907b4201d11.js","223171976435229":"path---tag-面试-page-2-3a3e6d342ec71a09b257.js","142786436347975":"path---tag-面试-page-3-ae007b6f847cf6c1ee56.js","238935357380661":"path---tag-面试-page-4-ea19d26d9478b0892efe.js","245880621862883":"path---tag-面试-page-5-f7c223d4e0e5611d69f8.js","246669227103960":"path---tag-面试-page-6-6c380742d8f987a2924f.js","60323078534330":"path---tag-面试-page-7-35f905f8e3d0869b13e7.js","6126622387049":"path---tag-设计模式-33ca58bf912117fac29c.js","141678249858998":"path---tag-设计模式-page-2-7884bf2ac60e1255ae15.js","227646423861100":"path---tag-原型链-017ecb161918f2c059f5.js","270844286153164":"path---tag-wavesurfer-9492d8ac98db117d76de.js","267774730432137":"path---tag-声音波形图-91e590d3ef1276c84d65.js","208664617786477":"path---tag-富文本框-60c145d51a91bd50fd0e.js","10646094735096":"path---tag-contenteditable-c248ba665e1b08b026d5.js","62655446722822":"path---tag-reactplayer-a4d7bfff859f0b87189b.js","56987201576482":"path---tag-ie兼容性-75710002dfcc6b7587b9.js","77409178505926":"path---tag-你不知道的js-107b20e4c5bd36a12c1b.js","42304193969392":"path---tag-git-飞行规则-ac420286b42a23b9350b.js","67875956743494":"path---tag-css实践-b8430a31354fc752d4e5.js","268682248610272":"path---tag-rxjs-b45308aae5669d5a4e1e.js","89311683856469":"path---tag-redux-69b8345c364ad3158e6d.js","180159039882109":"path---tag-redux-saga-fbb7b4bf4a1185d4e2ff.js","16127437772087":"path---tag-immutable-9c4c298fb4ce990ef990.js","27737245621530":"path---tag-虚拟dom-06cf2d4d96606495b5c2.js","86858602159029":"path---tag-mvvm-4e11ad7e49ecd89c85ba.js","181344580895377":"path---tag-html-aea4f3af074dc57bcb26.js","113336163118905":"path---tag-编码实践-fa1ba41048aa7fd74cf8.js","213495445956996":"path---tag-代码可读性-49c7aa1865ea4db66819.js","68023419151070":"path---tag-代码重构-2b83fad3076f8bbcca5f.js","76391135627889":"path---tag-数据库-04005398a753642a68ed.js","62578285138703":"path---tag-面向对象-7f6be8ed53a9b01cbf77.js","127326217713950":"path---tag-系统-1b11fab23289e5de4db4.js","206938361286353":"path---tag-linux-776059c82c1b5d5863e7.js","39089212571995":"path---tag-操作系统-a4103a12d0ab81f7ee3a.js","264705075801869":"path---tag-计算机网络-b32f1a25fa527ddf3fa5.js","182651556077521":"path---tag-markdown-c9c2ed0304c03612493b.js","69359442682475":"path---tag-mathjax-964924d9e15299ad1268.js","262424194971224":"path---tag-算法-cb65edfde369e8ba2df7.js","93223738411919":"path---tag-算法-page-2-ecf99f88e5a67ee704f3.js","85290250346840":"path---tag-前端性能优化-f33aadcf518c5a45819f.js","101664424200443":"path---tag-git规范化-0b4e7630ff6ce4cf9a4d.js","2910128324144":"path---tag-react-性能-233f4fd453befc26c994.js","46846056092474":"path---tag-docker-e508ad4b9b795b5435c7.js","85535873151340":"path---tag-docker源-cfacb8f191bca6c95179.js","87860903228536":"path---tag-docker初级入门-d219a682670a9e256858.js","123528777417731":"path---tag-docker安装-6e4cdd3cc311642de21a.js","136964432507671":"path---tag-windows-e0f963d5d262508598ba.js","32755072520275":"path---tag-githook-49b341abac513cf07583.js","75895805060978":"path---tag-居中-8e9108d2ad16ace59873.js","220717035913248":"path---tag-gitignore-1eedee28ca37c8fd0ed0.js","274038599397233":"path---page-1-b9a1de4517a343e17e67.js","135728916539164":"path---page-2-80e784e389e8a24e4352.js","217820771614769":"path---page-3-90829a8379e839ee1388.js","192681129940542":"path---page-4-4568c7d86e9259d27201.js","10891958300999":"path---page-5-3029d3bd954598884736.js","195745506856481":"path---page-6-03c94398ca959421513c.js","16783939301590":"path---page-7-4857a5e80255605d4dc5.js","244335847057972":"path---page-8-5ec02ccde21b4cd7945a.js","194163173290519":"path---page-9-363e48a27ac7472d0417.js","118850167530626":"path---page-10-83be6e638b663e1fc037.js","152218003751186":"path---page-11-03db83c03003b3dd8e34.js","166622523189001":"path---page-12-5467279dd8c8e0a869de.js","224497949994338":"path---page-13-075a6d917a69df661d82.js","2878687696391":"path---page-14-e3f7ff7d71a05f36da2d.js","215981401426538":"path---page-15-0cdb815cbfa256e694ac.js","161875067699755":"path---page-16-35cf9f4f0b8a0b417faa.js","3465889432845":"path---page-17-eea40680b7a85c2b3337.js","33450389461711":"path---page-18-80109ed0b4847b657128.js","41156843682903":"path---page-19-dc20718aa88c9d2b589c.js","88544223563419":"path---page-20-8e7aa83a5126481c16fe.js","9469948045756":"path---page-21-3e34b92f62f8a7d4fae9.js","156031618981499":"path---page-22-bdfbb97b91da34a3d3f5.js","245630869752575":"path---page-23-309856b1165cc3491f79.js","63652884590058":"path---page-24-70ad0dcb2918355e10b2.js","117448474024632":"path---page-25-0ac08281d2d698f5e24b.js","72835731821973":"path---page-26-82a26328b83c03753b71.js","227544857169625":"path---page-27-3f4271bf2bbc8a40b42a.js","57534992332446":"path---page-28-3fd78b35646bd7579ef9.js","162519313768533":"path---page-29-a72e3225db8881afb14c.js","3603790633319":"path---page-30-72962d88fb84d85ae63f.js","204137852806792":"path---page-31-ee8141b77d7ac68f181b.js","180790688453952":"path---page-32-597fb38c95c10bd9ea67.js","134076066164666":"path---page-33-15579f101cba095b1643.js","238834444319282":"path---page-34-520ae5b62c8f1d696c06.js","182946348612542":"path---page-35-62880b854cbd03a10e7e.js","242319353231456":"path---page-36-04ba39871a04d3f159b7.js","122055260935994":"path---page-37-5bd8f9d03dfe05c56eff.js","281023364537823":"path---page-38-69598c072d7a61788ca3.js","132157361455169":"path---written-examination-record-0c0f82c00e0666d0eab6.js","87301782745465":"path---multi-dimension-analysis-structure-analyzing-2c3eeac235e574dc1503.js","155049361902267":"path---personal-resume-2021-print-9e319287962b20a44b3d.js","130849465771344":"path---personal-resume-2021-175e9232bee60eb63345.js","240149536883285":"path---interview-record-33e81bdaeb0c706e0a50.js","99230332435911":"path---reverse-interview-89b63fe0e06dce1b4dd1.js","21721269591276":"path---interview-record-summary-96a44878aee8a429ebc5.js","22486905293576":"path---personal-resume-2020-348a88fbd870931baf71.js","197297040802783":"path---weekly-summary-2018-e1fcbf644bbc9c64ffcc.js","144342403179678":"path---hello-world-91c081d10c370d40dc5b.js","236643250588249":"path---personal-resume-1ef1a34cb4d6af0ec78f.js","56240726505197":"path---drafts-page-1-71f770412aa6be06161b.js","139912377317252":"path---drafts-page-2-caf5ec930359b194cda0.js","53950094676651":"path---drafts-page-3-a9efe47e09ed525edc33.js","254022195166212":"path---404-a0e39f21c11f6a62c5ab.js","273950069227526":"path---about-b5874c74fd98d3a1807e.js","252549247087927":"path---drafts-7e35e5b0f82d1d994e5b.js","142629428675168":"path---index-da5b1d0546ccae163f8b.js","254572558124955":"path---search-e52692bf2e6dcc7beae8.js","55702396619907":"path---tags-aaa199e252ca0dc482b4.js","178698757827068":"path---404-html-a0e39f21c11f6a62c5ab.js","114276838955818":"component---src-layouts-index-js-fd6f98b8f467d5a4ea97.js"}/*]]>*/</script><script>/*<![CDATA[*/["/commons-28d40765c2ee508aaecc.js","/app-55aebb8759ef5001bcc6.js","/path---browser-working-principle-cycle-system-3be3b846f04ba9d2332f.js","/component---src-templates-blog-post-js-c46de7a038aabbed0010.js","/component---src-layouts-index-js-fd6f98b8f467d5a4ea97.js"].forEach(function(s){document.write('<script src="'+s+'" defer></'+'script>')})/*]]>*/</script></body></html>