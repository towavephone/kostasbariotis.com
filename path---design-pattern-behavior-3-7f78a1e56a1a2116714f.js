webpackJsonp([0xa55e217db9e5],{1101:function(n,s){n.exports={data:{file:{childImageSharp:{sizes:{base64:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAeCAYAAAAsEj5rAAAACXBIWXMAAAsSAAALEgHS3X78AAAHlUlEQVRIx11WaWxU1xWewbQlrdofkSIhGiBpMPZ4Vs/2lpm3zupZPOOZ8Sz2YGzANkaAKaYQUrMkLYgiIlxCQjCYQAwYEoMQNJAIFBxaQgUhoCopYceBJo1pKFVDCbOc0/fesOZKV+fM1Tvf/c56R0VYOZW8lvAxtSybvbExAu1+mndGuaDQ2F4rNHVFhCZJZlMeZ1Qrf9Mt+H+qur/ihFORAFA64J0pVTcXVcDmcKFfruIzZ7rY1H89fAZivjbM1MzFxkAnZqWd9M7KJcTmv7zCN44sY+tflm12C79WLxLCqidWN9cwWpYvsfXL13vasZudgm4mgX4hW6h1teRjnrZCwjOzWO/twIR/FjZ7WnEZ35JvcUSeU4gwSXV7W1sJzEH6R8nSRArlXjr6r7S1DqNUvMAzCXCzSfDxDRAUmyDkaoawtEPi1LxHyGLMkby5gEqUy7atjnq1roosAXqE6Yq7DBXa7RLS6HRG8y4hhbwzDiJbj4IkXUwS5e1h07IOorMePUL6ruiKGmRblg2PesJlq9nxrJMMfydIbhIWP9jMPrBLkrIHgXfG0CdmgKMjwFARFKVvHEQo5xUyKDDRN2T7aE17mV5rfZQYm1lM0EQYWUe0aNTxoKl0Qnk5jVqNA/VaFu3SBS7SB7Ju0ougr2KKWg2DBi17mbCaxyghMzgeMTTp2W7CGkTKHshZqn0Q5Osg6opBhAmAzcADY/NheyQJBi2D8mXVehYMOgEsJg9aTIxSN2YTO+ohQ62G6rGZa5AmAjmj0YvzG5vhVP8f4fTO12FtVxfMjTfC6zPbwOsIQNybhK6GlmLCm5DA6cu2aoeSaaOeVheLxRKgpoJcZ5UAly94MeeiQ+jnQtBCcTBTZ8Ght9fDfy58DDdOHIRj2zdA/4uzYWBpZ6Fr6jR8/lfWP8n2usqA2mQgH7msr3Ks0WgEfGvN6lz/q6tgXqgZjgpZOGSLwsldA4CFG4j3rmP/osU47xkdrm5pLfjdETm+p64cf0fJME34HiVFV+VYajF50UGGc/Nnz4XDfW/ArQ09+M++XsCblwD+fQEL356HswuWwdedS+Dg2p5ilZQwa7VrpCHZ9nOl7Ojg44B0hxxg0hbMjx2rh2iwDk4feReKI58hfn8V8c5lwNyXiF+dRbz4Z1jY1g4TJ1rQbnHfc/ORihJDr5q0kw8AyVqDjpeSEpJLAyaMN6HRwMDuTa/B1fcPwcfbBuHc8SPw+cnDsGvzeim7HOg0DpAYoouPBWUMJxUo65y18X4MtbYJOo3zjgQoxwWen1iNDdPmwPu9+2BvfCXsXbQRehf9Hly0B8aN04OuioGqCipvt/hQ5GLzS4Dh0Tdv3+/nvm0qVVUlfUouboOWK8jxmaznMBXIwpbfroWN63th384tcHTfDpj0gg21lQxoK+m8TQGMb5UxAt6OUYSVkUuGK5MPKiuIHicZwWqDmNNqpE6pIFBjpGDxsqXwuxUroWtBN5w4NgSbNvcDIRW61CUFu9UrtV/si7Fjf/ajUmICSvxKgJMtdQxVK2XOU9RpGNBL3VBeQWIqPR3SjR3QOW8xrFmxCnrWbYJMaobEkr1HE/4zIpv4nrK7NIrbpF+tspoYZdpMLte+wNPRu6S1Bs1GqV/1DOqMPFjIMFbq3dg6cyFkGmagqZqHaoOAHF2XZ6ngWg+XBM4RVoLHOWrLVG4uWpo4FvsvfHz6NktFkbT6QafnQGsUoFLHYm1dFj44cgwYPgQVkymkbP6RWl+LNIRjL/uFhltuNjEoYySCXaNUojOsMPSw4aqwa+o9ga5DggiC1RFDmyMG1bYQVlTSIIhRMJq9RaPZJ4VF+DQZ6MCAmOkLurJ/DYiNt/R67VMKs4hrqjL+o+6mjrj0hjBEOG+1h8FOxcFO1oHVFgazPYQGqdfNthBYpUqwEME78nsT4tP7o96WwWSwA1nKb35iyCZ8M85EXE3oYBO3ab4RKWcSKCaFJJMCQprSpPQcUFwKzWQUKo1+lC9x0r7Fcc+0OVOj8zEkNrY8BAuLDV11ruZvDXrhuJ3NIu+bAYK/FXjfdOA8zegUp6DdmQKNMQD+8HTseW1LYeijE/jB4Q+/Wry8a5L01B6MeaetUcDSjfVjjOVM7da+bTMPvHfkbmrKb5DksjkLncmZqXTe6siAnWmAmkhbYUPvQP7cufO5L69fxyvD/8Ctb+/aI2PU8AmvRGqZAoiIityzb8/T165d3X3t2vD/Pjr+KW7b+R6u2/AOrli9CQfePYQXLg3jpSvDeOLkWTxw6Oh3uwYPrJTMlNHlFcLPeNk6/UOXZ7cuGP1A397fP/7v584vvzJ8o+dvn33+Zm/v9q9X/2EDbN+19+ybm3ds33/ww5f63uovf/D9woVL1A90P5dQqYaGhpQfg4N71BJbteoHqyk7Z+e8zlfuSupPHj+/eO2bso5ZcxQ9Fsiqgny6ZOv3+VTfjIwo+iefnFYN7BxQf3FxuEwGH1c+fgxBuIZnTFuIIh9U2qt3844fb9y0Vf0gXPKm7bzKzYZ+wGTKFFWNz1/6v8OLUiuaFKMJz00yEvaa/RQZnK086s6MutpEqRLx+kcT+rH1f+YikeeNfqnwAAAAAElFTkSuQmCC",aspectRatio:.6666666666666666,src:"/static/avatar-a4ccbab8e7381acb89452773ce94d5a0-25c91.png",srcSet:"/static/avatar-a4ccbab8e7381acb89452773ce94d5a0-8a97b.png 200w,\n/static/avatar-a4ccbab8e7381acb89452773ce94d5a0-0fdf3.png 400w,\n/static/avatar-a4ccbab8e7381acb89452773ce94d5a0-25c91.png 600w",srcWebp:"/static/avatar-a4ccbab8e7381acb89452773ce94d5a0-216f6.webp",srcSetWebp:"/static/avatar-a4ccbab8e7381acb89452773ce94d5a0-5d70e.webp 200w,\n/static/avatar-a4ccbab8e7381acb89452773ce94d5a0-d1677.webp 400w,\n/static/avatar-a4ccbab8e7381acb89452773ce94d5a0-216f6.webp 600w",sizes:"(max-width: 600px) 100vw, 600px"}}},site:{siteMetadata:{title:"女王控的博客",description:'前端工程师，黑猫女王控，欢迎勾搭，技术相关<a href="https://github.com/towavephone" target="_blank">@towavephone</a>，QQ闲聊<a href="tencent://AddContact/?fromId=45&fromSubId=1&subcmd=all&uin=634407147&website=www.oicqzone.com">@towave</a>，bili关注<a href="https://space.bilibili.com/11507708#/" target="_blank">@towave</a>',siteUrl:"https://blog.towavephone.com"}},mainPost:{html:'<h2 id="模板方法模式template-method"><a href="#%E6%A8%A1%E6%9D%BF%E6%96%B9%E6%B3%95%E6%A8%A1%E5%BC%8Ftemplate-method" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>模板方法模式(Template Method)</h2>\n<p>定义一个操作中的算法的骨架，而将一些步骤延迟到子类中。TemplateMethod 使得子类可以不改变一个算法的结构即可重定义该算法的某些特定步骤。</p>\n<h3 id="模式背景"><a href="#%E6%A8%A1%E5%BC%8F%E8%83%8C%E6%99%AF" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>模式背景</h3>\n<p>题目抄错，会做也白搭</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="5353749914548022000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`class TestPaperA\n{\n    //试题1\n    public void TestQuestion1()\n    {\n        Console.WriteLine(&quot; 杨过得到，后来给了郭靖，炼成倚天剑、屠龙刀的玄铁可能是[ ] a.球磨铸铁 b.马口铁 c.高速合金钢 d.碳素纤维 &quot;);\n        Console.WriteLine(&quot;答案：b&quot;);\n    }\n    //试题2\n    public void TestQuestion2()\n    {\n        Console.WriteLine(&quot; 杨过、程英、陆无双铲除了情花，造成[ ] a.使这种植物不再害人b.使一种珍稀物种灭绝 c.破坏了那个生物圈的生态平衡 d.造成该地区沙漠化  &quot;);\n        Console.WriteLine(&quot;答案：a&quot;);\n    }\n    //试题3\n    public void TestQuestion3()\n    {\n        Console.WriteLine(&quot; 蓝凤凰的致使华山师徒、桃谷六仙呕吐不止,如果你是大夫,会给他们开什么药[ ] a.阿司匹林 b.牛黄解毒片 c.氟哌酸 d.让他们喝大量的生牛奶 e.以上全不对   &quot;);\n        Console.WriteLine(&quot;答案：c&quot;);\n    }\n}\n\nclass TestPaperB\n{\n    //试题1\n    public void TestQuestion1()\n    {\n        Console.WriteLine(&quot; 杨过得到，后来给了郭靖，炼成倚天剑、屠龙刀的玄铁可能是[ ] a.球磨铸铁 b.马口铁 c.高速合金钢 d.碳素纤维 &quot;);\n        Console.WriteLine(&quot;答案：d&quot;);\n    }\n    //试题2\n    public void TestQuestion2()\n    {\n        Console.WriteLine(&quot; 杨过、程英、陆无双铲除了情花，造成[ ] a.使这种植物不再害人b.使一种珍稀物种灭绝 c.破坏了那个生物圈的生态平衡 d.造成该地区沙漠化  &quot;);\n        Console.WriteLine(&quot;答案：b&quot;);\n    }\n    //试题3\n    public void TestQuestion3()\n    {\n        Console.WriteLine(&quot; 蓝凤凰的致使华山师徒、桃谷六仙呕吐不止,如果你是大夫,会给他们开什么药[ ] a.阿司匹林 b.牛黄解毒片 c.氟哌酸 d.让他们喝大量的生牛奶 e.以上全不对   &quot;);\n        Console.WriteLine(&quot;答案：a&quot;);\n    }\n}\n\nstatic void Main(string[] args)\n{\n    Console.WriteLine(&quot;学生甲的试卷：&quot;);\n    TestPaperA studentA = new TestPaperA();\n    studentA.TestQuestion1();\n    studentA.TestQuestion2();\n    studentA.TestQuestion3();\n\n    Console.WriteLine(&quot;学生乙的试卷：&quot;);\n    TestPaperB studentB = new TestPaperB();\n    studentB.TestQuestion1();\n    studentB.TestQuestion2();\n    studentB.TestQuestion3();\n\n    Console.Read();\n}`, `5353749914548022000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                cpp 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="cpp"><pre style="counter-reset: linenumber NaN" class="language-cpp line-numbers"><code class="language-cpp"><span class="token keyword">class</span> <span class="token class-name">TestPaperA</span>\n<span class="token punctuation">{</span>\n    <span class="token comment">//试题1</span>\n    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">TestQuestion1</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n    <span class="token punctuation">{</span>\n        Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">" 杨过得到，后来给了郭靖，炼成倚天剑、屠龙刀的玄铁可能是[ ] a.球磨铸铁 b.马口铁 c.高速合金钢 d.碳素纤维 "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n        Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">"答案：b"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n    <span class="token comment">//试题2</span>\n    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">TestQuestion2</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n    <span class="token punctuation">{</span>\n        Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">" 杨过、程英、陆无双铲除了情花，造成[ ] a.使这种植物不再害人b.使一种珍稀物种灭绝 c.破坏了那个生物圈的生态平衡 d.造成该地区沙漠化  "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n        Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">"答案：a"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n    <span class="token comment">//试题3</span>\n    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">TestQuestion3</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n    <span class="token punctuation">{</span>\n        Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">" 蓝凤凰的致使华山师徒、桃谷六仙呕吐不止,如果你是大夫,会给他们开什么药[ ] a.阿司匹林 b.牛黄解毒片 c.氟哌酸 d.让他们喝大量的生牛奶 e.以上全不对   "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n        Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">"答案：c"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">class</span> <span class="token class-name">TestPaperB</span>\n<span class="token punctuation">{</span>\n    <span class="token comment">//试题1</span>\n    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">TestQuestion1</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n    <span class="token punctuation">{</span>\n        Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">" 杨过得到，后来给了郭靖，炼成倚天剑、屠龙刀的玄铁可能是[ ] a.球磨铸铁 b.马口铁 c.高速合金钢 d.碳素纤维 "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n        Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">"答案：d"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n    <span class="token comment">//试题2</span>\n    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">TestQuestion2</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n    <span class="token punctuation">{</span>\n        Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">" 杨过、程英、陆无双铲除了情花，造成[ ] a.使这种植物不再害人b.使一种珍稀物种灭绝 c.破坏了那个生物圈的生态平衡 d.造成该地区沙漠化  "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n        Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">"答案：b"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n    <span class="token comment">//试题3</span>\n    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">TestQuestion3</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n    <span class="token punctuation">{</span>\n        Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">" 蓝凤凰的致使华山师徒、桃谷六仙呕吐不止,如果你是大夫,会给他们开什么药[ ] a.阿司匹林 b.牛黄解毒片 c.氟哌酸 d.让他们喝大量的生牛奶 e.以上全不对   "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n        Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">"答案：a"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">Main</span><span class="token punctuation">(</span>string<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span>\n<span class="token punctuation">{</span>\n    Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">"学生甲的试卷："</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    TestPaperA studentA <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">TestPaperA</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    studentA<span class="token punctuation">.</span><span class="token function">TestQuestion1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    studentA<span class="token punctuation">.</span><span class="token function">TestQuestion2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    studentA<span class="token punctuation">.</span><span class="token function">TestQuestion3</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">"学生乙的试卷："</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    TestPaperB studentB <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">TestPaperB</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    studentB<span class="token punctuation">.</span><span class="token function">TestQuestion1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    studentB<span class="token punctuation">.</span><span class="token function">TestQuestion2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    studentB<span class="token punctuation">.</span><span class="token function">TestQuestion3</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    Console<span class="token punctuation">.</span><span class="token function">Read</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>学生甲和学生乙的试卷类非常类似，除了答案不同，没什么区别，如果老师修改题目，2 个类都需要修改。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="16805775183425808000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`class TestPaper\n{\n    //试题1\n    public void TestQuestion1()\n    {\n        Console.WriteLine(&quot; 杨过得到，后来给了郭靖，炼成倚天剑、屠龙刀的玄铁可能是[ ] a.球磨铸铁 b.马口铁 c.高速合金钢 d.碳素纤维 &quot;);\n        Console.WriteLine(&quot;答案：b&quot;);\n    }\n    //试题2\n    public void TestQuestion2()\n    {\n        Console.WriteLine(&quot; 杨过、程英、陆无双铲除了情花，造成[ ] a.使这种植物不再害人 b.使一种珍稀物种灭绝 c.破坏了那个生物圈的生态平衡 d.造成该地区沙漠化  &quot;);\n        Console.WriteLine(&quot;答案：a&quot;);\n    }\n    //试题3\n    public void TestQuestion3()\n    {\n        Console.WriteLine(&quot; 蓝凤凰的致使华山师徒、桃谷六仙呕吐不止,如果你是大夫,会给他们开什么药[ ] a.阿司匹林 b.牛黄解毒片 c.氟哌酸 d.让他们喝大量的生牛奶 e.以上全不对   &quot;);\n        Console.WriteLine(&quot;答案：c&quot;);\n    }\n}\n\nclass TestPaperA : TestPaper\n{\n    public new void TestQuestion1()\n    {\n        base.TestQuestion1();\n        Console.WriteLine(&quot;答案：c&quot;);\n    }\n\n    public new void TestQuestion2()\n    {\n        base.TestQuestion2();\n        Console.WriteLine(&quot;答案：b&quot;);\n    }\n\n    public new void TestQuestion3()\n    {\n        base.TestQuestion3();\n        Console.WriteLine(&quot;答案：a&quot;);\n    }\n}\n\nclass TestPaperB : TestPaper\n{\n    public new void TestQuestion1()\n    {\n        base.TestQuestion1();\n        Console.WriteLine(&quot;答案：d&quot;);\n    }\n\n    public new void TestQuestion2()\n    {\n        base.TestQuestion2();\n        Console.WriteLine(&quot;答案：c&quot;);\n    }\n\n    public new void TestQuestion3()\n    {\n        base.TestQuestion3();\n        Console.WriteLine(&quot;答案：a&quot;);\n    }\n}`, `16805775183425808000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                cpp 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="cpp"><pre style="counter-reset: linenumber NaN" class="language-cpp line-numbers"><code class="language-cpp"><span class="token keyword">class</span> <span class="token class-name">TestPaper</span>\n<span class="token punctuation">{</span>\n    <span class="token comment">//试题1</span>\n    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">TestQuestion1</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n    <span class="token punctuation">{</span>\n        Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">" 杨过得到，后来给了郭靖，炼成倚天剑、屠龙刀的玄铁可能是[ ] a.球磨铸铁 b.马口铁 c.高速合金钢 d.碳素纤维 "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n        Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">"答案：b"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n    <span class="token comment">//试题2</span>\n    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">TestQuestion2</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n    <span class="token punctuation">{</span>\n        Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">" 杨过、程英、陆无双铲除了情花，造成[ ] a.使这种植物不再害人 b.使一种珍稀物种灭绝 c.破坏了那个生物圈的生态平衡 d.造成该地区沙漠化  "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n        Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">"答案：a"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n    <span class="token comment">//试题3</span>\n    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">TestQuestion3</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n    <span class="token punctuation">{</span>\n        Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">" 蓝凤凰的致使华山师徒、桃谷六仙呕吐不止,如果你是大夫,会给他们开什么药[ ] a.阿司匹林 b.牛黄解毒片 c.氟哌酸 d.让他们喝大量的生牛奶 e.以上全不对   "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n        Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">"答案：c"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">class</span> <span class="token class-name">TestPaperA</span> <span class="token operator">:</span> TestPaper\n<span class="token punctuation">{</span>\n    <span class="token keyword">public</span> <span class="token keyword">new</span> <span class="token keyword">void</span> <span class="token function">TestQuestion1</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n    <span class="token punctuation">{</span>\n        base<span class="token punctuation">.</span><span class="token function">TestQuestion1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n        Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">"答案：c"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n\n    <span class="token keyword">public</span> <span class="token keyword">new</span> <span class="token keyword">void</span> <span class="token function">TestQuestion2</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n    <span class="token punctuation">{</span>\n        base<span class="token punctuation">.</span><span class="token function">TestQuestion2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n        Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">"答案：b"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n\n    <span class="token keyword">public</span> <span class="token keyword">new</span> <span class="token keyword">void</span> <span class="token function">TestQuestion3</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n    <span class="token punctuation">{</span>\n        base<span class="token punctuation">.</span><span class="token function">TestQuestion3</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n        Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">"答案：a"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">class</span> <span class="token class-name">TestPaperB</span> <span class="token operator">:</span> TestPaper\n<span class="token punctuation">{</span>\n    <span class="token keyword">public</span> <span class="token keyword">new</span> <span class="token keyword">void</span> <span class="token function">TestQuestion1</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n    <span class="token punctuation">{</span>\n        base<span class="token punctuation">.</span><span class="token function">TestQuestion1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n        Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">"答案：d"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n\n    <span class="token keyword">public</span> <span class="token keyword">new</span> <span class="token keyword">void</span> <span class="token function">TestQuestion2</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n    <span class="token punctuation">{</span>\n        base<span class="token punctuation">.</span><span class="token function">TestQuestion2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n        Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">"答案：c"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n\n    <span class="token keyword">public</span> <span class="token keyword">new</span> <span class="token keyword">void</span> <span class="token function">TestQuestion3</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n    <span class="token punctuation">{</span>\n        base<span class="token punctuation">.</span><span class="token function">TestQuestion3</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n        Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">"答案：a"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>是不是可以进一步的优化？</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="81610878568420070000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`class TestPaper\n{\n    public void TestQuestion1()\n    {\n        Console.WriteLine(&quot; 杨过得到，后来给了郭靖，炼成倚天剑、屠龙刀的玄铁可能是[ ] a.球磨铸铁 b.马口铁 c.高速合金钢 d.碳素纤维 &quot;);\n        Console.WriteLine(&quot;答案：&quot; + Answer1());\n    }\n\n    protected virtual string Answer1()\n    {\n        return &quot;&quot;;\n    }\n}\n\n//学生甲抄的试卷\nclass TestPaperA : TestPaper\n{\n    protected override string Answer1()\n    {\n        return &quot;b&quot;;\n    }\n\n    protected override string Answer2()\n    {\n        return &quot;c&quot;;\n    }\n\n    protected override string Answer3()\n    {\n        return &quot;a&quot;;\n    }\n}\n\n//学生乙抄的试卷\nclass TestPaperB : TestPaper\n{\n    protected override string Answer1()\n    {\n        return &quot;c&quot;;\n    }\n\n    protected override string Answer2()\n    {\n        return &quot;a&quot;;\n    }\n\n    protected override string Answer3()\n    {\n        return &quot;a&quot;;\n    }\n}\n\nstatic void Main(string[] args)\n{\n    Console.WriteLine(&quot;学生甲抄的试卷：&quot;);\n    TestPaper studentA = new TestPaperA();\n    studentA.TestQuestion1();\n    studentA.TestQuestion2();\n    studentA.TestQuestion3();\n\n    Console.WriteLine(&quot;学生乙抄的试卷：&quot;);\n    TestPaper studentB = new TestPaperB();\n    studentB.TestQuestion1();\n    studentB.TestQuestion2();\n    studentB.TestQuestion3();\n\n    Console.Read();\n}`, `81610878568420070000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                cpp 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="cpp"><pre style="counter-reset: linenumber NaN" class="language-cpp line-numbers"><code class="language-cpp"><span class="token keyword">class</span> <span class="token class-name">TestPaper</span>\n<span class="token punctuation">{</span>\n    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">TestQuestion1</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n    <span class="token punctuation">{</span>\n        Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">" 杨过得到，后来给了郭靖，炼成倚天剑、屠龙刀的玄铁可能是[ ] a.球磨铸铁 b.马口铁 c.高速合金钢 d.碳素纤维 "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n        Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">"答案："</span> <span class="token operator">+</span> <span class="token function">Answer1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n\n    <span class="token keyword">protected</span> <span class="token keyword">virtual</span> string <span class="token function">Answer1</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n    <span class="token punctuation">{</span>\n        <span class="token keyword">return</span> <span class="token string">""</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n\n<span class="token comment">//学生甲抄的试卷</span>\n<span class="token keyword">class</span> <span class="token class-name">TestPaperA</span> <span class="token operator">:</span> TestPaper\n<span class="token punctuation">{</span>\n    <span class="token keyword">protected</span> override string <span class="token function">Answer1</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n    <span class="token punctuation">{</span>\n        <span class="token keyword">return</span> <span class="token string">"b"</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n\n    <span class="token keyword">protected</span> override string <span class="token function">Answer2</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n    <span class="token punctuation">{</span>\n        <span class="token keyword">return</span> <span class="token string">"c"</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n\n    <span class="token keyword">protected</span> override string <span class="token function">Answer3</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n    <span class="token punctuation">{</span>\n        <span class="token keyword">return</span> <span class="token string">"a"</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n\n<span class="token comment">//学生乙抄的试卷</span>\n<span class="token keyword">class</span> <span class="token class-name">TestPaperB</span> <span class="token operator">:</span> TestPaper\n<span class="token punctuation">{</span>\n    <span class="token keyword">protected</span> override string <span class="token function">Answer1</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n    <span class="token punctuation">{</span>\n        <span class="token keyword">return</span> <span class="token string">"c"</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n\n    <span class="token keyword">protected</span> override string <span class="token function">Answer2</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n    <span class="token punctuation">{</span>\n        <span class="token keyword">return</span> <span class="token string">"a"</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n\n    <span class="token keyword">protected</span> override string <span class="token function">Answer3</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n    <span class="token punctuation">{</span>\n        <span class="token keyword">return</span> <span class="token string">"a"</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">Main</span><span class="token punctuation">(</span>string<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span>\n<span class="token punctuation">{</span>\n    Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">"学生甲抄的试卷："</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    TestPaper studentA <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">TestPaperA</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    studentA<span class="token punctuation">.</span><span class="token function">TestQuestion1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    studentA<span class="token punctuation">.</span><span class="token function">TestQuestion2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    studentA<span class="token punctuation">.</span><span class="token function">TestQuestion3</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">"学生乙抄的试卷："</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    TestPaper studentB <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">TestPaperB</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    studentB<span class="token punctuation">.</span><span class="token function">TestQuestion1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    studentB<span class="token punctuation">.</span><span class="token function">TestQuestion2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    studentB<span class="token punctuation">.</span><span class="token function">TestQuestion3</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    Console<span class="token punctuation">.</span><span class="token function">Read</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="模式动机"><a href="#%E6%A8%A1%E5%BC%8F%E5%8A%A8%E6%9C%BA" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>模式动机</h3>\n<ul>\n<li>准备一个抽象类，将部分逻辑以具体方法以及具体构造函数的形式实现，然后声明一些抽象方法来迫使子类实现剩余的逻辑。不同的子类可以以不同的方式实现这些抽象方法，从而对剩余的逻辑有不同的实现。这就是模版方法模式的用意。</li>\n<li>很多人可能没有想到，模版方法模式实际上是所有模式中最为常见的几个模式之一，而且很多人可能使用过模版方法模式而没有意识到自己已经使用了这个模式。模版方法模式是基于继承的代码复用的基本技术，模版方法模式的结构和用法也是面向对象设计的核心。</li>\n<li>模版方法模式需要开发抽象类和具体子类的设计师之间的协作。一个设计师负责给出一个算法的轮廓和骨架，另一些设计师则负责给出这个算法的各个逻辑步骤。代表这些具体逻辑步骤的方法称做基本方法（primitive method）；而将这些基本法方法总汇起来的方法叫做模版方法（template method），这个设计模式的名字就是从此而来。</li>\n</ul>\n<h3 id="模式定义"><a href="#%E6%A8%A1%E5%BC%8F%E5%AE%9A%E4%B9%89" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>模式定义</h3>\n<p>定义一个操作中算法的骨架，而将一些步骤延迟到子类中。模板方法使得子类可以不改变一个算法的结构即可重定义该算法的某些特定步骤。模板方法是一种类行为型模式。</p>\n<h3 id="模式结构"><a href="#%E6%A8%A1%E5%BC%8F%E7%BB%93%E6%9E%84" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>模式结构</h3>\n<p>\n  <a\n    class="gatsby-resp-image-link"\n    href="/static/微信截图_20180418114919-921c3fc7114a95a5c5656a2b2960d0cb-02abd.png"\n    style="display: block"\n    target="_blank"\n    rel="noopener"\n  >\n  \n  <span\n    class="gatsby-resp-image-wrapper"\n    style="position: relative; display: block; ; max-width: 715px; margin-left: auto; margin-right: auto;"\n  >\n    <span\n      class="gatsby-resp-image-background-image"\n      style="padding-bottom: 111.88811188811188%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAWCAYAAADAQbwGAAAACXBIWXMAABnWAAAZ1gEY0crtAAADZElEQVQ4y51US08aURRmpkkXGmkjW2OMO3Xl/3CtLjXqxk1/Q39BE7eVLhqjq5pYHhqs0UYRGZUAgiKPEQ2+8AmOCgwzt9+55TrFYtv0Jl/u65zvnnPuOcdms9kkQP4PkN7vY2NjY/r8/Dx8cnISPDw8VCKRiKKqqpJMJvm8u7ur7O3tKZlMRqF7yAWAuN/v/0D6mqbJs7OzFmE8Hk+y2igWiywajbJcLsdAyEDIjo6O+JxOpxmUmWmaXBZy30gfS9nn81mE29vbYRLM5/OVy8vL6vX1dfXq6orj+b52Vn58fGSKorhIX9d12eVyWYSxWCxCLz48PBj39/eMgDWH2BPI+hp0kg+Hwx5h4cLCgkWIWETIRcTJEG7iEQ7Eje3v77NEIsEuLi4YLCTo5XKZLPQ0tBBEUbImm80aZ2dnDC6R+zx2cJeviYiGYRisUqlwC/HYk4Vra2sWIX41RIqnp6dlkOhkAfY6PkHHb9IjOu50ZIKOX9axLxEhLP8qCFdWVupimK3FkMdKDLKK9rCIkYs06PPEGg9+F4Srq6sWodfrfR8KhT7jcBJw4tedm5ubk8vLy5/m5+cVOgsGg85AIOCEa3T/ETGdRqq8I314IU1NTdn+Onp6ejpmZmb8WDpekoF1DQ9l4NUz0KvNw8PDHfiU1y/IyIK0jnhgYEAaGxuTRkZGpNHRUWloaEiamJiQarXaQjKDg4NP9wL9/f1cf3x83NbX12f712H/02VTU1PD8+aaor21tdXe1dVl7+zstLe3t791OBztvb29Ld3d3fa2tja7kAPeEF9DNpSQ9+7uLndzc5M+Pj5WaSDfMkh0FamRzfwcKnJURdKrkEsBecoG0kezkD0ej0WIBE2I3KM8Ozg4YCBkSGQ+4xFejrQWOUgDbc0nPnVpackiRM6FqeipIlCvBhLagCUGrWkmiDM8QqhQwqOP8gIulUry3NxcnctRqga4Ydze3vL6xZoVCgVGewLtCbV79AOdwRDuJ+pbdrvdFuH6+jrvNohXFe6bcM1EvMydnR0TsTPhLp/pLJVK0V6vVqsM1eUWLqPa6rpNjCykLkMtSvRDeuRXCym+dA8LecsGsbdht9na2goi8DqsKMICDbWpYa+haWhQ4sBHaXhAgwc0F8gA3H8RhIuLi098PwCaPP3/SBo7vgAAAABJRU5ErkJggg==\'); background-size: cover; display: block;"\n    >\n      <img\n        class="gatsby-resp-image-image"\n        style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;"\n        alt="     20180418114919"\n        title=""\n        src="/static/微信截图_20180418114919-921c3fc7114a95a5c5656a2b2960d0cb-02abd.png"\n        srcset="/static/微信截图_20180418114919-921c3fc7114a95a5c5656a2b2960d0cb-c2d90.png 200w,\n/static/微信截图_20180418114919-921c3fc7114a95a5c5656a2b2960d0cb-3b989.png 400w,\n/static/微信截图_20180418114919-921c3fc7114a95a5c5656a2b2960d0cb-02abd.png 715w"\n        sizes="(max-width: 715px) 100vw, 715px"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<ul>\n<li>AbstractClass：抽象类</li>\n<li>ConcreteClass：具体子类</li>\n</ul>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="74327430444949700000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`public abstract class AbstractCar\n{\n    protected abstract string StartUp();\n    protected abstract string Run();\n    protected abstract string Stop();\n\n    public void DriveOnTheRoad()\n    {\n        Console.WriteLine(StartUp());\n        Console.WriteLine(Run());\n        Console.WriteLine(Stop());\n    }\n}\npublic class BORA : AbstractCar\n{\n    protected override string StartUp()\n    {\n        return &quot;BORA is StartUp&quot;;\n    }\n\n    protected override string Run()\n    {\n        return &quot;BORA is Running&quot;;\n    }\n\n    protected override string Stop()\n    {\n        return &quot;BORA is Stoped&quot;;\n    }\n}\n\nstatic void Main(string[] args)\n{\n     AbstractCar car = new BORA();\n     car.DriveOnTheRoad();\n     Console.Read();\n}`, `74327430444949700000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                cpp 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="cpp"><pre style="counter-reset: linenumber NaN" class="language-cpp line-numbers"><code class="language-cpp"><span class="token keyword">public</span> abstract <span class="token keyword">class</span> <span class="token class-name">AbstractCar</span>\n<span class="token punctuation">{</span>\n    <span class="token keyword">protected</span> abstract string <span class="token function">StartUp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">protected</span> abstract string <span class="token function">Run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">protected</span> abstract string <span class="token function">Stop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">DriveOnTheRoad</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n    <span class="token punctuation">{</span>\n        Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token function">StartUp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n        Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token function">Run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n        Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token function">Stop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">BORA</span> <span class="token operator">:</span> AbstractCar\n<span class="token punctuation">{</span>\n    <span class="token keyword">protected</span> override string <span class="token function">StartUp</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n    <span class="token punctuation">{</span>\n        <span class="token keyword">return</span> <span class="token string">"BORA is StartUp"</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n\n    <span class="token keyword">protected</span> override string <span class="token function">Run</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n    <span class="token punctuation">{</span>\n        <span class="token keyword">return</span> <span class="token string">"BORA is Running"</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n\n    <span class="token keyword">protected</span> override string <span class="token function">Stop</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n    <span class="token punctuation">{</span>\n        <span class="token keyword">return</span> <span class="token string">"BORA is Stoped"</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">Main</span><span class="token punctuation">(</span>string<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span>\n<span class="token punctuation">{</span>\n     AbstractCar car <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">BORA</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n     car<span class="token punctuation">.</span><span class="token function">DriveOnTheRoad</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n     Console<span class="token punctuation">.</span><span class="token function">Read</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>AbstractCar 中的 DriveOnTheRoad 方法叫做 template method（模板方法），template method 用 primitive operation 定义一个算法，是相对稳定的部分。（子类中重新定义 primitive operation）。</p>\n<p>在这段代码中，抽象方法 StartUp、Run、Stop 叫做 primitive operation（原语操作），它们是在子类中的扩展点。</p>\n<h3 id="优缺点"><a href="#%E4%BC%98%E7%BC%BA%E7%82%B9" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>优缺点</h3>\n<ul>\n<li>\n<p>优点</p>\n<ul>\n<li>模板方法模式在一个类中形式化地定义算法，而由它的子类实现细节的处理。模板方法模式的优势是，在子类定义详细的处理算法时不会改变算法的结构。</li>\n<li>模板方法是一种代码复用的基本技术，它们在类库中尤为重要，它们提取了类库中的公共行为。</li>\n<li>模板方法导致一种反向的控制结构，一个父类调用一个子类的操作，而不是相反。</li>\n</ul>\n</li>\n<li>\n<p>缺点</p>\n<ul>\n<li>每个不同的实现都需要定义一个子类，这会导致类的个数增加，但是更加符合类职责的分配原则，使得类的内聚性得以提高。</li>\n</ul>\n</li>\n</ul>\n<h3 id="模式使用"><a href="#%E6%A8%A1%E5%BC%8F%E4%BD%BF%E7%94%A8" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>模式使用</h3>\n<ul>\n<li>一次性实现一个算法的不变的部分，并将可变的行为留给子类来实现。</li>\n<li>各子类中公共的行为应被提取出来并集中到一个公共父类中以避免代码重复。</li>\n<li>对一些复杂的算法进行分割，将其算法中固定不变的部分设计为模板方法和父类具体方法，而一些可以改变的细节由其子类来实现。</li>\n</ul>\n<h3 id="模式应用"><a href="#%E6%A8%A1%E5%BC%8F%E5%BA%94%E7%94%A8" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>模式应用</h3>\n<ul>\n<li>模板方法模式主要应用于框架设计，以确保父类控制处理流程的逻辑顺序（如框架的初始化）。</li>\n<li>模板方法模式鼓励我们恰当使用继承，此模式可以用来改写一些拥有相同功能的相关类，将可复用的一般性的行为代码移到父类里面，而将特殊化的行为代码移到子类里面。这也进一步说明，虽然继承复用存在一些问题，但是在某些情况下还是可以给开发人员带来方便，模板方法模式就是体现继承优势的模式之一。</li>\n<li>在模板方法模式中，子类不显式调用父类的方法，而是通过覆盖父类的方法来实现某些具体的业务逻辑，父类控制对子类的调用，这种机制被称为好莱坞原则(Hollywood Principle)，即“不要给我们打电话，我们会给你打电话(Don‘t call us, we’ll call you)”。</li>\n<li>在模板方法模式中，好莱坞原则体现在：子类不需要调用父类，而通过父类来调用子类，将某些步骤的实现写在子类中，由父类来控制整个过程。</li>\n</ul>\n<h2 id="访问者模式visitor"><a href="#%E8%AE%BF%E9%97%AE%E8%80%85%E6%A8%A1%E5%BC%8Fvisitor" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>访问者模式(Visitor)</h2>\n<p>表示一个作用于某对象结构中的各元素的操作，它使你可以在不改变各元素的类的前提下定义作用于这些元素的新操作。</p>\n<h3 id="模式背景-1"><a href="#%E6%A8%A1%E5%BC%8F%E8%83%8C%E6%99%AF-1" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>模式背景</h3>\n<p>学校有教师和工程师</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="46929043299317510000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`abstract class Employee\n{\n    private string name;\n    private double income;\n    private int vacationDays;\n\n    public string Name\n    {\n        get { return name; }\n        set { name = value; }\n    }\n    public double Income\n    {\n        get { return income; }\n        set { income = value; }\n    }\n    public int VacationDays\n    {\n        get { return vacationDays; }\n        set { vacationDays = value; }\n    }\n}\n\nclass Teacher : Employee\n{\n    public Teacher(string name, double income,int vacationDays)\n    {\n        Name = name;\n        Income = income;\n        VacationDays = vacationDays;\n    }\n}\n\nclass Engineer : Employee\n{\n    public Engineer(string name, double income,int vacationDays)\n    {\n        Name = name;\n        Income = income;\n        VacationDays = vacationDays;\n    }\n}\n\nstatic void Main(string[] args)\n{\n    Teacher zhangsan = new Teacher(&quot;张三&quot;, 2500.0, 14);\n    Engineer lisi    = new Engineer(&quot;李四&quot;, 3500.0, 16);\n\n    Console.WriteLine(zhangsan.Name + &quot;的收入是&quot;+ zhangsan.Income +\n                                &quot;, 假期是&quot;+ zhangsan.VacationDays);\n\n    Console.WriteLine(lisi.Name + &quot;的收入是&quot; + lisi.Income + \v                                       &quot;, 假期是&quot; + lisi.VacationDays);\n\n    Console.ReadKey();\n}`, `46929043299317510000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                cpp 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="cpp"><pre style="counter-reset: linenumber NaN" class="language-cpp line-numbers"><code class="language-cpp">abstract <span class="token keyword">class</span> <span class="token class-name">Employee</span>\n<span class="token punctuation">{</span>\n    <span class="token keyword">private</span> string name<span class="token punctuation">;</span>\n    <span class="token keyword">private</span> <span class="token keyword">double</span> income<span class="token punctuation">;</span>\n    <span class="token keyword">private</span> <span class="token keyword">int</span> vacationDays<span class="token punctuation">;</span>\n\n    <span class="token keyword">public</span> string Name\n    <span class="token punctuation">{</span>\n        get <span class="token punctuation">{</span> <span class="token keyword">return</span> name<span class="token punctuation">;</span> <span class="token punctuation">}</span>\n        set <span class="token punctuation">{</span> name <span class="token operator">=</span> value<span class="token punctuation">;</span> <span class="token punctuation">}</span>\n    <span class="token punctuation">}</span>\n    <span class="token keyword">public</span> <span class="token keyword">double</span> Income\n    <span class="token punctuation">{</span>\n        get <span class="token punctuation">{</span> <span class="token keyword">return</span> income<span class="token punctuation">;</span> <span class="token punctuation">}</span>\n        set <span class="token punctuation">{</span> income <span class="token operator">=</span> value<span class="token punctuation">;</span> <span class="token punctuation">}</span>\n    <span class="token punctuation">}</span>\n    <span class="token keyword">public</span> <span class="token keyword">int</span> VacationDays\n    <span class="token punctuation">{</span>\n        get <span class="token punctuation">{</span> <span class="token keyword">return</span> vacationDays<span class="token punctuation">;</span> <span class="token punctuation">}</span>\n        set <span class="token punctuation">{</span> vacationDays <span class="token operator">=</span> value<span class="token punctuation">;</span> <span class="token punctuation">}</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">class</span> <span class="token class-name">Teacher</span> <span class="token operator">:</span> Employee\n<span class="token punctuation">{</span>\n    <span class="token keyword">public</span> <span class="token function">Teacher</span><span class="token punctuation">(</span>string name<span class="token punctuation">,</span> <span class="token keyword">double</span> income<span class="token punctuation">,</span><span class="token keyword">int</span> vacationDays<span class="token punctuation">)</span>\n    <span class="token punctuation">{</span>\n        Name <span class="token operator">=</span> name<span class="token punctuation">;</span>\n        Income <span class="token operator">=</span> income<span class="token punctuation">;</span>\n        VacationDays <span class="token operator">=</span> vacationDays<span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">class</span> <span class="token class-name">Engineer</span> <span class="token operator">:</span> Employee\n<span class="token punctuation">{</span>\n    <span class="token keyword">public</span> <span class="token function">Engineer</span><span class="token punctuation">(</span>string name<span class="token punctuation">,</span> <span class="token keyword">double</span> income<span class="token punctuation">,</span><span class="token keyword">int</span> vacationDays<span class="token punctuation">)</span>\n    <span class="token punctuation">{</span>\n        Name <span class="token operator">=</span> name<span class="token punctuation">;</span>\n        Income <span class="token operator">=</span> income<span class="token punctuation">;</span>\n        VacationDays <span class="token operator">=</span> vacationDays<span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">Main</span><span class="token punctuation">(</span>string<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span>\n<span class="token punctuation">{</span>\n    Teacher zhangsan <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">Teacher</span><span class="token punctuation">(</span><span class="token string">"张三"</span><span class="token punctuation">,</span> <span class="token number">2500.0</span><span class="token punctuation">,</span> <span class="token number">14</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    Engineer lisi    <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">Engineer</span><span class="token punctuation">(</span><span class="token string">"李四"</span><span class="token punctuation">,</span> <span class="token number">3500.0</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span>zhangsan<span class="token punctuation">.</span>Name <span class="token operator">+</span> <span class="token string">"的收入是"</span><span class="token operator">+</span> zhangsan<span class="token punctuation">.</span>Income <span class="token operator">+</span>\n                                <span class="token string">", 假期是"</span><span class="token operator">+</span> zhangsan<span class="token punctuation">.</span>VacationDays<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span>lisi<span class="token punctuation">.</span>Name <span class="token operator">+</span> <span class="token string">"的收入是"</span> <span class="token operator">+</span> lisi<span class="token punctuation">.</span>Income <span class="token operator">+</span> \v                                       <span class="token string">", 假期是"</span> <span class="token operator">+</span> lisi<span class="token punctuation">.</span>VacationDays<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    Console<span class="token punctuation">.</span><span class="token function">ReadKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>如何批量给员工加薪，加假期？</p>\n<h3 id="模式动机-1"><a href="#%E6%A8%A1%E5%BC%8F%E5%8A%A8%E6%9C%BA-1" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>模式动机</h3>\n<ul>\n<li>对于系统中的某些对象，它们存储在同一个集合中，且具有不同的类型，而且对于该集合中的对象，可以接受一类称为访问者的对象来访问，而且不同的访问者其访问方式有所不同，访问者模式为解决这类问题而诞生。</li>\n<li>在实际使用时，对同一集合对象的操作并不是唯一的，对相同的元素对象可能存在多种不同的操作方式。</li>\n<li>而且这些操作方式并不稳定，可能还需要增加新的操作，以满足新的业务需求。</li>\n<li>此时，访问者模式就是一个值得考虑的解决方案。</li>\n</ul>\n<h3 id="模式定义-1"><a href="#%E6%A8%A1%E5%BC%8F%E5%AE%9A%E4%B9%89-1" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>模式定义</h3>\n<p>表示一个作用于某对象结构中的各元素的操作。它使我们可以在不改变各元素的类的前提下定义作用于这些元素的新操作。访问者模式是一种对象行为型模式。</p>\n<h3 id="模式结构-1"><a href="#%E6%A8%A1%E5%BC%8F%E7%BB%93%E6%9E%84-1" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>模式结构</h3>\n<p>\n  <a\n    class="gatsby-resp-image-link"\n    href="/static/微信截图_20180418121437-b0ec74a789752742d192aa76c0099f7e-6cf7b.png"\n    style="display: block"\n    target="_blank"\n    rel="noopener"\n  >\n  \n  <span\n    class="gatsby-resp-image-wrapper"\n    style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;"\n  >\n    <span\n      class="gatsby-resp-image-background-image"\n      style="padding-bottom: 69.29196499602227%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAABnWAAAZ1gEY0crtAAACpElEQVQ4y51UXWiSURj+nM6fLvImiBC66aaLxsS62oIokCDSu0YjhthF7D52V1iDpMVaOClYUI5hQ7vZheDFFoP8QcSJbnNz/m3m3PwZ/qJTRD0952vGZmtBDxy+c877nvc87/u852Oy2exYLBZ7FolEnhcKhbHx8fFzDDA4OMiZnJzk0vna2tr1fD7/9eDg4Es0Gp3P5XLzmJvW19evUXswGOQwHVQqFdJBs9kkGo3mEt3v7+/njY6OCuh8ZWXl0XGfDkDiPrWHQiGuUqn8FTCRSDwES9X+/r46nU4PGwwGPt2HPwejl87BpG9ra2saB3Uej8e0ubmpg69uZ2fn6pFvL/Vn/oZGo9HD/AfYoOFweAY3Gjc2NuZ3d3dnrFbreWrc29u7l0qlPmB/IhAITMXj8Wlk8RLpizOZzKvt7W0dajuFs6+R4XvY77BR4URarRZpt9sEhScmk4mtIYT6SLpQKpWIw+G4TL8d0LMUyWRygg0IBgMo7i2wuA22A3Nzc4Kjug1hvQBVZ8HCgAs+g8kbn88nxPod9j/BTm2zYLyAgIqzanFiLZVKOV6vV2KxWCRms/mK3W6XuFwuCUycP84Vi8Ueo9HIlcvlQpVKxReJRDzYuDKZjKfVaoXU0e/3P6Bp1et1AnUJRGNTBcO7RyLyukn8hlgsZm/V6/U9i4uLbPput/sm2uY70voGsdwIuozvMkS5Qe0IzD/R3P9K+TgUCsWFM9umGyg2uwlGMoj1BG0ygpqpweYxmAyhrQT4DkNEtdPpVKOWI9QP4vSdegvSoTVk0Fdvad2gIDsODw8J+rJos9kkaLVatVoleM8EqbNtg1ejOTUgbmcDrq6uvqDOOJSv1WoljDp+CuGlpaWLYP8Dj6BWLpdLECpP3zfq+5Se+wkpbiULnmBjKAAAAABJRU5ErkJggg==\'); background-size: cover; display: block;"\n    >\n      <img\n        class="gatsby-resp-image-image"\n        style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;"\n        alt="     20180418121437"\n        title=""\n        src="/static/微信截图_20180418121437-b0ec74a789752742d192aa76c0099f7e-fee1c.png"\n        srcset="/static/微信截图_20180418121437-b0ec74a789752742d192aa76c0099f7e-a67b7.png 200w,\n/static/微信截图_20180418121437-b0ec74a789752742d192aa76c0099f7e-0b187.png 400w,\n/static/微信截图_20180418121437-b0ec74a789752742d192aa76c0099f7e-fee1c.png 800w,\n/static/微信截图_20180418121437-b0ec74a789752742d192aa76c0099f7e-b1a91.png 1200w,\n/static/微信截图_20180418121437-b0ec74a789752742d192aa76c0099f7e-6cf7b.png 1257w"\n        sizes="(max-width: 800px) 100vw, 800px"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<ul>\n<li>Vistor：抽象访问者</li>\n<li>ConcreteVisitor：具体访问者</li>\n<li>Element：抽象元素</li>\n<li>ConcreteElement：具体元素</li>\n<li>ObjectStructure：对象结构</li>\n</ul>\n<p>\n  <a\n    class="gatsby-resp-image-link"\n    href="/static/微信截图_20180418121632-0330a4570cc579dca757405757503454-6cf69.png"\n    style="display: block"\n    target="_blank"\n    rel="noopener"\n  >\n  \n  <span\n    class="gatsby-resp-image-wrapper"\n    style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;"\n  >\n    <span\n      class="gatsby-resp-image-background-image"\n      style="padding-bottom: 69.25872093023257%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAABnWAAAZ1gEY0crtAAAClklEQVQ4y4VU3WuSURjXTV+XEXS3QOgimASDAhl4MYhYLAiCpIuGwSTpT8i6yiy8aMQYzLHR7mrUIscY5q0XCooXbmx+f39O50ebDjU35vTt97zpaFuuBw7nvOf3PM/5nef5nZdXKBRexuPx17FYTLu7u/tKr9eLeTCZTNan1Wr7ae12u0fK5bIR+Ff4Lu/t7S1j/c3j8QwTHgwG+byu1Wo1tmtHR0esTqe7RvtSqZRRKpUDtHY6naquT6vVOvEPhUIPCcfcr1Kp/iTMZDLKYrH4LJvNPs/n809XV1cZ2oc/H0NIa7/ffysSicxFo1HDxsbGdyQwIGY2mUze7PgKyZ/Xy9rtdm/wAuOSooYfceIXMFhGnRZNJtMVAre3tx/s7+/P+3y+KdRwBuwNOzs77xwOx1XEvE+n07Obm5szYD0FtvOpVGqMy4oPFoy4mlQqFRYJuRomEolF9ozhABYJr9fr9ZO9bmwul/vAJQSDUZxyFyzugeno2tqaiPa9Xu8EOmrCWEIXl3DA51KpNL2+vj4Avzmo4hMGh4H9DyR8dFEtTn2r1Wo+EkmMRqNkZWXlhtVqlaDzEkD8c3HHx8d9CwsLArlcflmhUIgYhqHOCoaGhoQajeYSObpcrgmSC0kMdWQPDw/ZZrNJsrlPODDBWRK8zml8sVjMzSRqs9ks6ujwDoLtkJYVw4Ur0mzb2toaIRxlYU6J+39X/tvGx8cHe2HhcPh8UnSa33lOtyEPNUStpJcCRpOQ1mPUUIRmPIFsJm02mwp7SmDqQCAw3EvUAprxCqa7UoE+OWngqhW73S7B3CS54D1zOBn83/4zIRwEHdm8gbjZn7BGo1H+BcNPIWCxWAZxtRSwWrVaLR8cHBBOzXpBcb8BEXgmKR+A7xcAAAAASUVORK5CYII=\'); background-size: cover; display: block;"\n    >\n      <img\n        class="gatsby-resp-image-image"\n        style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;"\n        alt="     20180418121632"\n        title=""\n        src="/static/微信截图_20180418121632-0330a4570cc579dca757405757503454-fee1c.png"\n        srcset="/static/微信截图_20180418121632-0330a4570cc579dca757405757503454-a67b7.png 200w,\n/static/微信截图_20180418121632-0330a4570cc579dca757405757503454-0b187.png 400w,\n/static/微信截图_20180418121632-0330a4570cc579dca757405757503454-fee1c.png 800w,\n/static/微信截图_20180418121632-0330a4570cc579dca757405757503454-b1a91.png 1200w,\n/static/微信截图_20180418121632-0330a4570cc579dca757405757503454-6cf69.png 1376w"\n        sizes="(max-width: 800px) 100vw, 800px"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="41280823413872270000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`abstract class Employee\n{\n    private string name;\n    private double income;\n    private int vacationDays;\n\n    public string Name\n    {\n        get { return name; }\n        set { name = value; }\n    }\n    public double Income\n    {\n        get { return income; }\n        set { income = value; }\n    }\n    public int VacationDays\n    {\n        get { return vacationDays; }\n        set { vacationDays = value; }\n    }\n\n    abstract public void Accept(Visitor visitor);\n}\nclass Teacher : Employee\n{\n    public Teacher(string name, double income,int vacationDays)\n    {\n        Name = name;\n        Income = income;\n        VacationDays = vacationDays;\n    }\n    public override void Accept(Visitor visitor)\n    {\n        visitor.Visit(this);\n    }\n}\nclass Engineer : Employee\n{\n    public Engineer(string name, double income,int vacationDays)\n    {\n        Name = name;\n        Income = income;\n        VacationDays = vacationDays;\n    }\n    public override void Accept(Visitor visitor)\n    {\n        visitor.Visit(this);\n    }\n}\n\nabstract class Visitor\n{\n    abstract public void Visit(Employee element);\n}\n\nclass IncomeVisitor : Visitor\n{\n    public override void Visit(Employee element)\n    {\n        element.Income *= 1.10;\n        Console.WriteLine(element.Name + &quot;的新工资是: &quot; + element.Income);\n    }\n}\n\nclass VacationVisitor : Visitor\n{\n    public override void Visit(Employee element)\n    {\n        element.VacationDays += 3;\n        Console.WriteLine(element.Name + &quot;的新假期是&quot; + element.VacationDays);\n    }\n}\n\nclass Employees\n{\n    private ArrayList employees = new ArrayList();\n    public void Attach(Employee employee)\n    {\n        employees.Add(employee);\n    }\n    public void Detach(Employee employee)\n    {\n        employees.Remove(employee);\n    }\n    public void Accept(Visitor visitor)\n    {\n        foreach (Employee e in employees)\n            e.Accept(visitor);\n    }\n}\n\nstatic void Main(string[] args)\n{\n    Teacher zhangsan = new Teacher(&quot;张三&quot;, 2500.0, 14);\n    Engineer lisi    = new Engineer(&quot;李四&quot;, 3500.0, 16);\n\n    Employees e = new Employees();\n    e.Attach(zhangsan);\n    e.Attach(lisi);\n\n    IncomeVisitor v1 = new IncomeVisitor();\n    VacationVisitor v2 = new VacationVisitor();\n\n    e.Accept(v1);\n    e.Accept(v2);\n    Console.Read();\n}`, `41280823413872270000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                cpp 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="cpp"><pre style="counter-reset: linenumber NaN" class="language-cpp line-numbers"><code class="language-cpp">abstract <span class="token keyword">class</span> <span class="token class-name">Employee</span>\n<span class="token punctuation">{</span>\n    <span class="token keyword">private</span> string name<span class="token punctuation">;</span>\n    <span class="token keyword">private</span> <span class="token keyword">double</span> income<span class="token punctuation">;</span>\n    <span class="token keyword">private</span> <span class="token keyword">int</span> vacationDays<span class="token punctuation">;</span>\n\n    <span class="token keyword">public</span> string Name\n    <span class="token punctuation">{</span>\n        get <span class="token punctuation">{</span> <span class="token keyword">return</span> name<span class="token punctuation">;</span> <span class="token punctuation">}</span>\n        set <span class="token punctuation">{</span> name <span class="token operator">=</span> value<span class="token punctuation">;</span> <span class="token punctuation">}</span>\n    <span class="token punctuation">}</span>\n    <span class="token keyword">public</span> <span class="token keyword">double</span> Income\n    <span class="token punctuation">{</span>\n        get <span class="token punctuation">{</span> <span class="token keyword">return</span> income<span class="token punctuation">;</span> <span class="token punctuation">}</span>\n        set <span class="token punctuation">{</span> income <span class="token operator">=</span> value<span class="token punctuation">;</span> <span class="token punctuation">}</span>\n    <span class="token punctuation">}</span>\n    <span class="token keyword">public</span> <span class="token keyword">int</span> VacationDays\n    <span class="token punctuation">{</span>\n        get <span class="token punctuation">{</span> <span class="token keyword">return</span> vacationDays<span class="token punctuation">;</span> <span class="token punctuation">}</span>\n        set <span class="token punctuation">{</span> vacationDays <span class="token operator">=</span> value<span class="token punctuation">;</span> <span class="token punctuation">}</span>\n    <span class="token punctuation">}</span>\n\n    abstract <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">Accept</span><span class="token punctuation">(</span>Visitor visitor<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n<span class="token keyword">class</span> <span class="token class-name">Teacher</span> <span class="token operator">:</span> Employee\n<span class="token punctuation">{</span>\n    <span class="token keyword">public</span> <span class="token function">Teacher</span><span class="token punctuation">(</span>string name<span class="token punctuation">,</span> <span class="token keyword">double</span> income<span class="token punctuation">,</span><span class="token keyword">int</span> vacationDays<span class="token punctuation">)</span>\n    <span class="token punctuation">{</span>\n        Name <span class="token operator">=</span> name<span class="token punctuation">;</span>\n        Income <span class="token operator">=</span> income<span class="token punctuation">;</span>\n        VacationDays <span class="token operator">=</span> vacationDays<span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n    <span class="token keyword">public</span> override <span class="token keyword">void</span> <span class="token function">Accept</span><span class="token punctuation">(</span>Visitor visitor<span class="token punctuation">)</span>\n    <span class="token punctuation">{</span>\n        visitor<span class="token punctuation">.</span><span class="token function">Visit</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n<span class="token keyword">class</span> <span class="token class-name">Engineer</span> <span class="token operator">:</span> Employee\n<span class="token punctuation">{</span>\n    <span class="token keyword">public</span> <span class="token function">Engineer</span><span class="token punctuation">(</span>string name<span class="token punctuation">,</span> <span class="token keyword">double</span> income<span class="token punctuation">,</span><span class="token keyword">int</span> vacationDays<span class="token punctuation">)</span>\n    <span class="token punctuation">{</span>\n        Name <span class="token operator">=</span> name<span class="token punctuation">;</span>\n        Income <span class="token operator">=</span> income<span class="token punctuation">;</span>\n        VacationDays <span class="token operator">=</span> vacationDays<span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n    <span class="token keyword">public</span> override <span class="token keyword">void</span> <span class="token function">Accept</span><span class="token punctuation">(</span>Visitor visitor<span class="token punctuation">)</span>\n    <span class="token punctuation">{</span>\n        visitor<span class="token punctuation">.</span><span class="token function">Visit</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n\nabstract <span class="token keyword">class</span> <span class="token class-name">Visitor</span>\n<span class="token punctuation">{</span>\n    abstract <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">Visit</span><span class="token punctuation">(</span>Employee element<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">class</span> <span class="token class-name">IncomeVisitor</span> <span class="token operator">:</span> Visitor\n<span class="token punctuation">{</span>\n    <span class="token keyword">public</span> override <span class="token keyword">void</span> <span class="token function">Visit</span><span class="token punctuation">(</span>Employee element<span class="token punctuation">)</span>\n    <span class="token punctuation">{</span>\n        element<span class="token punctuation">.</span>Income <span class="token operator">*=</span> <span class="token number">1.10</span><span class="token punctuation">;</span>\n        Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span>element<span class="token punctuation">.</span>Name <span class="token operator">+</span> <span class="token string">"的新工资是: "</span> <span class="token operator">+</span> element<span class="token punctuation">.</span>Income<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">class</span> <span class="token class-name">VacationVisitor</span> <span class="token operator">:</span> Visitor\n<span class="token punctuation">{</span>\n    <span class="token keyword">public</span> override <span class="token keyword">void</span> <span class="token function">Visit</span><span class="token punctuation">(</span>Employee element<span class="token punctuation">)</span>\n    <span class="token punctuation">{</span>\n        element<span class="token punctuation">.</span>VacationDays <span class="token operator">+=</span> <span class="token number">3</span><span class="token punctuation">;</span>\n        Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span>element<span class="token punctuation">.</span>Name <span class="token operator">+</span> <span class="token string">"的新假期是"</span> <span class="token operator">+</span> element<span class="token punctuation">.</span>VacationDays<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">class</span> <span class="token class-name">Employees</span>\n<span class="token punctuation">{</span>\n    <span class="token keyword">private</span> ArrayList employees <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">ArrayList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">Attach</span><span class="token punctuation">(</span>Employee employee<span class="token punctuation">)</span>\n    <span class="token punctuation">{</span>\n        employees<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span>employee<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">Detach</span><span class="token punctuation">(</span>Employee employee<span class="token punctuation">)</span>\n    <span class="token punctuation">{</span>\n        employees<span class="token punctuation">.</span><span class="token function">Remove</span><span class="token punctuation">(</span>employee<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">Accept</span><span class="token punctuation">(</span>Visitor visitor<span class="token punctuation">)</span>\n    <span class="token punctuation">{</span>\n        foreach <span class="token punctuation">(</span>Employee e in employees<span class="token punctuation">)</span>\n            e<span class="token punctuation">.</span><span class="token function">Accept</span><span class="token punctuation">(</span>visitor<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">Main</span><span class="token punctuation">(</span>string<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span>\n<span class="token punctuation">{</span>\n    Teacher zhangsan <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">Teacher</span><span class="token punctuation">(</span><span class="token string">"张三"</span><span class="token punctuation">,</span> <span class="token number">2500.0</span><span class="token punctuation">,</span> <span class="token number">14</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    Engineer lisi    <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">Engineer</span><span class="token punctuation">(</span><span class="token string">"李四"</span><span class="token punctuation">,</span> <span class="token number">3500.0</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    Employees e <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">Employees</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    e<span class="token punctuation">.</span><span class="token function">Attach</span><span class="token punctuation">(</span>zhangsan<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    e<span class="token punctuation">.</span><span class="token function">Attach</span><span class="token punctuation">(</span>lisi<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    IncomeVisitor v1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">IncomeVisitor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    VacationVisitor v2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">VacationVisitor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    e<span class="token punctuation">.</span><span class="token function">Accept</span><span class="token punctuation">(</span>v1<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    e<span class="token punctuation">.</span><span class="token function">Accept</span><span class="token punctuation">(</span>v2<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    Console<span class="token punctuation">.</span><span class="token function">Read</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="优缺点-1"><a href="#%E4%BC%98%E7%BC%BA%E7%82%B9-1" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>优缺点</h3>\n<ul>\n<li>\n<p>优点</p>\n<ul>\n<li>使得增加新的操作变得很容易。如果一些操作依赖于一个复杂的结构对象的话，那么一般而言，增加新的操作会很复杂。而使用访问者模式，增加新的操作就意味着增加一个新的访问者类，因此将变得很容易。</li>\n<li>将有关的行为集中到一个访问者对象中，而不是分散到一个个的节点类中。</li>\n<li>可以跨过几个类的等级结构访问属于不同的等级结构的成员类。</li>\n</ul>\n</li>\n<li>\n<p>缺点</p>\n<ul>\n<li>破坏封装。访问者模式要求访问者对象访问并调用每一个节点对象的操作，这隐含了一个对所有节点对象的要求：它们必须暴露一些自己的操作和内部状态。不然，访问者的访问就变得没有意义。由于访问者对象自己会积累访问操作所需的状态，从而使这些状态不再存储在节点对象中，这也是破坏封装的。</li>\n<li>增加新的节点类变得很困难。每增加一个新的节点都意味着要在抽象访问者角色中增加一个新的抽象操作，并在每一个具体访问者类中增加相应的具体操作。</li>\n</ul>\n</li>\n</ul>\n<h3 id="模式使用-1"><a href="#%E6%A8%A1%E5%BC%8F%E4%BD%BF%E7%94%A8-1" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>模式使用</h3>\n<ul>\n<li>定义对象结构的类很少改变，但经常需要在此结构上定义新的操作。</li>\n<li>对象需要添加很多不同的并且不相关的操作，而我们想避免让这些操作“污染”这些对象的类。访问者模式使得我们可以将相关的操作集中起来定义在一个类中。当该对象结构被很多应用共享时，用访问者模式让每个应用仅包含需要用到的操作。</li>\n</ul>\n<h3 id="模式应用-1"><a href="#%E6%A8%A1%E5%BC%8F%E5%BA%94%E7%94%A8-1" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>模式应用</h3>\n<ul>\n<li>访问者模式中对象结构存储了不同类型的元素对象，以供不同访问者访问。访问者模式包括两个层次结构，一个是访问者层次结构，提供了抽象访问者和具体访问者，一个是元素层次结构，提供了抽象元素和具体元素。相同的访问者可以以不同的方式访问不同的元素，相同的元素可以接受不同访问者以不同访问方式访问。</li>\n<li>在访问者模式中，增加新的访问者无须修改原有系统，系统具有较好的可扩展性。</li>\n</ul>\n<h3 id="模式小结"><a href="#%E6%A8%A1%E5%BC%8F%E5%B0%8F%E7%BB%93" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>模式小结</h3>\n<p>访问者模式的主要优点在于使得增加新的访问操作变得很容易，将有关元素对象的访问行为集中到一个访问者对象中，而不是分散到一个个的元素类中，还可以跨过类的等级结构访问属于不同的等级结构的元素类，让用户能够在不修改现有类层次结构的情况下，定义该类层次结构的操作；其主要缺点在于增加新的元素类很困难，而且在一定程度上破坏系统的封装性。</p>\n<h2 id="解释器模式interpreter"><a href="#%E8%A7%A3%E9%87%8A%E5%99%A8%E6%A8%A1%E5%BC%8Finterpreter" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>解释器模式(Interpreter)</h2>\n<p>给定一个语言，定义它的文法的一种表示，并定义一个解释器，这个解释器使用该表示来解释语言中的句子。</p>\n<h3 id="模式背景-2"><a href="#%E6%A8%A1%E5%BC%8F%E8%83%8C%E6%99%AF-2" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>模式背景</h3>\n<p>设计与实现一个四则算术运算解释器</p>\n<ul>\n<li>可以分析任意+、-、*、/表达式，并计算其数值</li>\n<li>输入表达式为一个字符串表达式</li>\n<li>输出结果为双精度浮点数(Double)</li>\n</ul>\n<p>输入是一个用字符串表达的四则运算，比如 1 + 2 * 3 。目的是试图去理解这个字符串表达的运算指令，然后计算出结果 7。之所以是一个解释器 Interpreter，而不是一个编译器 Compiler，是因为程序是去理解指令并且执行指令，而不是把指令编译成机器代码来运行；后者是编译器的目标。</p>\n<p>第一个部分，是截取输入字符串，然后返回单元指令。比如，对于指令 1 + 2 * 3 – 4 / 5，就需要被分解成如下所示的单元指令集：</p>\n<p>\n  <a\n    class="gatsby-resp-image-link"\n    href="/static/微信截图_20180418123729-6ff7d61c721cbf00f9ea46989844841c-dc56b.png"\n    style="display: block"\n    target="_blank"\n    rel="noopener"\n  >\n  \n  <span\n    class="gatsby-resp-image-wrapper"\n    style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;"\n  >\n    <span\n      class="gatsby-resp-image-background-image"\n      style="padding-bottom: 58.307210031347964%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAABnWAAAZ1gEY0crtAAACWElEQVQoz32T3UtTYRzH97cU3nRR4XwjU2fmy6ZpOhOJ3ugi7QVJwmmolYRQIk7aZjbLuTCdcyqhpXjbyNIWBNaFtZllQpkTUcm2nc/p2Y6F2urAh+ech8OH7/l9n6NaX4fV1WjIUYCNgIwkbycokAV2uyypZDmEJAUBBSm8ij058hI7kPnqfc9zp4MJVx8vBvp5OejC7XDgdY/j6EVWyZv2nWy9JEmK7K0sLGDRabmdlEjTgSQa9+8T7KU+JoaBk3p6u0OoJt+M4xyxMDhqZXDMSt+IGbdneJv0t3DJ56NDl0P38VLsxUW0Zx6iTZOKMSGB8Qtn6AkLLzUmcO56LGU31JQ3xHG2bg+W/nJFuCkipIzA/3GWjlwdXcf0dBYexZKehiklmeY4NWPlp5SEBqOGOlMutSatWHUYjOnYnxqUeS0vM7+4yFogoCSc9WEVn9xVUiyEBbRlpCtC9RZh7Z1srpnzqTfl0XBXT7UxA9uTKqSNn3hHhpl5PMSMs4+lt9P4P38SCbVKwqJ/JWzRUGPMoqY1k6ut2VxpTlWEgSDfpqdZFKIvU5P45+YiWLU5EeGDgnzMaSl/J6y4FU9l00EuNyWLNYWLjbF0CWG05v2zYoZ5ygxt+sLtCc+fVoT3+iuxugx0uKoE1bQ5Knjnc0cEoVAwUoy0pZT7R3J5WFqCLdxy1mEsouWWxERGy04oLf/vHP6532z7u9eLWZMmismhPTuTlng1zeIc3ty9i2cN1biG5LCQqNfOwx1+/rGygqe3B4/4JV4LXvU8wiOY6LSxNv8Bp0vmFxM47S+z4SUmAAAAAElFTkSuQmCC\'); background-size: cover; display: block;"\n    >\n      <img\n        class="gatsby-resp-image-image"\n        style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;"\n        alt="     20180418123729"\n        title=""\n        src="/static/微信截图_20180418123729-6ff7d61c721cbf00f9ea46989844841c-fee1c.png"\n        srcset="/static/微信截图_20180418123729-6ff7d61c721cbf00f9ea46989844841c-a67b7.png 200w,\n/static/微信截图_20180418123729-6ff7d61c721cbf00f9ea46989844841c-0b187.png 400w,\n/static/微信截图_20180418123729-6ff7d61c721cbf00f9ea46989844841c-fee1c.png 800w,\n/static/微信截图_20180418123729-6ff7d61c721cbf00f9ea46989844841c-dc56b.png 957w"\n        sizes="(max-width: 800px) 100vw, 800px"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<p>第二个部分，把单元指令集组成一个树结构，称之为 Abstract Syntax Tree。按照将来需要解释的顺序，优先执行的指令放在树的叶的位置，最后执行的指令是树根 Root。</p>\n<p>\n  <a\n    class="gatsby-resp-image-link"\n    href="/static/微信截图_20180418123855-9d5bf691f24549c4ae1a0d5a166d10af-5bcb1.png"\n    style="display: block"\n    target="_blank"\n    rel="noopener"\n  >\n  \n  <span\n    class="gatsby-resp-image-wrapper"\n    style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;"\n  >\n    <span\n      class="gatsby-resp-image-background-image"\n      style="padding-bottom: 49.184339314845026%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAABnWAAAZ1gEY0crtAAACDklEQVQoz21SW2sTURDefyIUX8VSi/hQ7E0fKgbv+IPEJ7Eh1iRW0tIiiDYqaS1NQa2kSGiTjZWmFpqSlnTT2ETjZrP32/k8e3a7teLAcGbODN/MNzOc2AGBL+TYsFxAVQk0DYGSQOk/fQ0dEGUHXwXJj6uE6DpBh2JxXVFD+cMyWX/3BqXFBay/TaPxfSuAdr06OBES+s2ujGRhG4ZphP1YFgHHp9+T2OAAYiND5NHFfjw424N8dNxPcVyaRk6pJxptS9d1ZiuKCtMwWIA+hCu+ymAqcg0zd28jMTqMaF8v+ETcp25ZYW8ucdk7U9pBvlpntu36BTKbu8hWDhghrvh6HqnrY5i+cwvx4UE8Pn8OxQCwJQgwZZl26oQT2Dn6BbHbZa4TFDkUFey32iA2A8zg+dhVpG5E8HToMgPkJ5OwKa2DTx+xn12C0jiCakvIbbxkACu7Ar7sHTK7VFmG8GMLpinhMz9HZzi3gOmbEczev0cpjyB6oReF+IRPiVK2bYvtQTUkbNdyPkj9J77Vm8yuNni0OjWYtoqNygq4tRdpTAxcQvLKKMb7+/Cw5wz4Z8lgKQ7+ld9SC7rSgUNvp9kWTsUITef2imXkJxNYm0ph9UkMObrhdrXqJ7h/b9mf1+rmLGrNMjRDRrYQg2WbwQET6IYLzrDwXzk+ER/sxPcAHNq551uWEcY9QO96/gBTMsf2fczlpwAAAABJRU5ErkJggg==\'); background-size: cover; display: block;"\n    >\n      <img\n        class="gatsby-resp-image-image"\n        style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;"\n        alt="     20180418123855"\n        title=""\n        src="/static/微信截图_20180418123855-9d5bf691f24549c4ae1a0d5a166d10af-fee1c.png"\n        srcset="/static/微信截图_20180418123855-9d5bf691f24549c4ae1a0d5a166d10af-a67b7.png 200w,\n/static/微信截图_20180418123855-9d5bf691f24549c4ae1a0d5a166d10af-0b187.png 400w,\n/static/微信截图_20180418123855-9d5bf691f24549c4ae1a0d5a166d10af-fee1c.png 800w,\n/static/微信截图_20180418123855-9d5bf691f24549c4ae1a0d5a166d10af-b1a91.png 1200w,\n/static/微信截图_20180418123855-9d5bf691f24549c4ae1a0d5a166d10af-5bcb1.png 1226w"\n        sizes="(max-width: 800px) 100vw, 800px"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<p>程序只有 2 种单元指令：操作数 NumExpression 和 运算符 OpExpression 。</p>\n<p>定义了一个抽象类，叫做 Expression，然后 NumExpression 和 OpExpression 继承了该抽象类。</p>\n<p>\n  <a\n    class="gatsby-resp-image-link"\n    href="/static/微信截图_20180418123939-2460bcf31c9375f1d855a5be2d669928-88ef2.png"\n    style="display: block"\n    target="_blank"\n    rel="noopener"\n  >\n  \n  <span\n    class="gatsby-resp-image-wrapper"\n    style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;"\n  >\n    <span\n      class="gatsby-resp-image-background-image"\n      style="padding-bottom: 51.751751751751755%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAABnWAAAZ1gEY0crtAAAB50lEQVQoz41Sy2sacRDeuH9BaCHgIZBTr0lJSMghARHRU46xgZAQA8k/4slT8Gqpl1oPUePFgyg+wCeIwSeI4gPfL1S0uu42k5ntWiqUNAMDMzvffvPNzI9hJFOpVAwAiHG1Wn3GGMrlMnS7XajX65RCoVB4pDqGrEKhYN40jUbzh7DdbvuJgOd5Dl1YLpcLyrHRN4lQplQq3yZUq9UE3KC4WCx6J5MJdDqdGfpP9OlsNoNcLvd1pZAE/NMQLBsOh2w2m2Wps9Fo3AgGg58ymcye2+0+cblcDz6fbzeVSh14vd4dmoJwtVqNRfVss9mUSU2Y9xgrl8u3/wdaI4tEIuexWEyHKq49Hs99PB6/SSQSOvRbp9P5kTBWq3UrmUwSRhcIBHR+v/8e61fpdPouFAqdEgbV/iZsNBoj2k+pVIJerweDwQBGoxHM53OIRqP7hMFRjzmOg1arBTgi4IoADydeHkd/Wh1KJMzn81UCIBmPT0RA5/v9vlCpVATc4R5hUOkh/shhs19Ul3DcdDoF3O33NUJUKD4yVPRCKhaLBT0XUWU4HP4sKTwaj8cCfcf6CifQf9j4xxqh2Ww+czgcFzabTbtyzLUWi0VrMBg2CaPX6z/gHs/tdvuXv3CUX5pMpmPC4B1Evle7LZ/Fn1XiNgAAAABJRU5ErkJggg==\'); background-size: cover; display: block;"\n    >\n      <img\n        class="gatsby-resp-image-image"\n        style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;"\n        alt="     20180418123939"\n        title=""\n        src="/static/微信截图_20180418123939-2460bcf31c9375f1d855a5be2d669928-fee1c.png"\n        srcset="/static/微信截图_20180418123939-2460bcf31c9375f1d855a5be2d669928-a67b7.png 200w,\n/static/微信截图_20180418123939-2460bcf31c9375f1d855a5be2d669928-0b187.png 400w,\n/static/微信截图_20180418123939-2460bcf31c9375f1d855a5be2d669928-fee1c.png 800w,\n/static/微信截图_20180418123939-2460bcf31c9375f1d855a5be2d669928-88ef2.png 999w"\n        sizes="(max-width: 800px) 100vw, 800px"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="28426641039295820000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`abstract class Expression\n{\n    abstract public double Interpreter(Syntax root);\n}\n\nclass NumExpression : Expression\n{\n    private double _value;\n\n    public NumExpression(double value)\n    {\n        this._value = value;\n    }\n    public double Value\n    {\n        get { return this._value; }\n    }\n    public override double Interpreter(Syntax root)\n    {\n        return ((NumExpression)(root.Expression)).Value;\n    }\n}\n\nenum Op : int\n{\n    Plus = \'+\',\n    Minus = \'-\',\n    Multiply = \'*\',\n    Divide = \'/\'\n}\nenum Prioirty\n{\n    Lv2 = 2,\n    Lv1 = 1,\n    Lv0 = 0\n}\n\nclass OpExpression : Expression\n{\n    private Op _value;\n    ……\n    public override double Interpreter(Syntax root)\n    {\n        double lvalue, rvalue;\n        if (root.LeftChild == null)\n            lvalue = 0;\n        else\n            lvalue = ((Expression)root.LeftChild.Expression).Interpreter(root.LeftChild);\n\n        if (root.RightChild == null)\n            rvalue = 0;\n        else\n            rvalue = ((Expression)root.RightChild.Expression).Interpreter(root.RightChild);\n        switch (((OpExpression)root.Expression).Value)\n        {\n            case Op.Plus:\n                return lvalue + rvalue;\n            case Op.Minus:\n                return lvalue - rvalue;\n            case Op.Multiply:\n                return lvalue * rvalue;\n            case Op.Divide:\n                return lvalue / rvalue;\n            default:\n                return 0;\n        }\n    }\n}\n\nclass Syntax\n{\n    private Expression _Expression;\n    private Syntax _left;\n    private Syntax _right;\n    public Syntax(Expression Expression)\n    {\n        this._Expression = Expression;\n        this._left = null;\n        this._right = null;\n    }\n    public Expression Expression\n    {\n        get { return this._Expression; }\n    }\n    public Syntax LeftChild\n    {\n        get { return this._left; }\n        set { this._left = value; }\n    }\n    public Syntax RightChild\n    {\n        get { return this._right; }\n        set { this._right = value; }\n    }\n}\n\nclass SyntaxTree\n{\n    private Syntax _root;\n    private int _count;\n\n    public SyntaxTree()\n    {\n        this._root = null;\n        this._count = 0;\n    }\n    public Syntax Root\n    {\n        get { return this._root; }\n    }\n    public void Append(Expression Expression)\n    {\n        this._root = this.Append(this._root, Expression);\n        this._count++;\n    }\n    private Syntax Append(Syntax root, Expression Expression)\n    {\n        ……\n    }\n}\n\nclass Interpreter\n{\n    private Expressionizer Expressionizer = new Expressionizer();\n\n    public SyntaxTree Eval(String expr)\n    {\n        Expression[] Expressions = Expressionizer.Parse(expr);\n        SyntaxTree astree = new SyntaxTree();\n\n        foreach (Expression Expression in Expressions)\n        {\n            astree.Append(Expression);\n        }\n        return astree;\n    }\n}`, `28426641039295820000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                cpp 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="cpp"><pre style="counter-reset: linenumber NaN" class="language-cpp line-numbers"><code class="language-cpp">abstract <span class="token keyword">class</span> <span class="token class-name">Expression</span>\n<span class="token punctuation">{</span>\n    abstract <span class="token keyword">public</span> <span class="token keyword">double</span> <span class="token function">Interpreter</span><span class="token punctuation">(</span>Syntax root<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">class</span> <span class="token class-name">NumExpression</span> <span class="token operator">:</span> Expression\n<span class="token punctuation">{</span>\n    <span class="token keyword">private</span> <span class="token keyword">double</span> _value<span class="token punctuation">;</span>\n\n    <span class="token keyword">public</span> <span class="token function">NumExpression</span><span class="token punctuation">(</span><span class="token keyword">double</span> value<span class="token punctuation">)</span>\n    <span class="token punctuation">{</span>\n        <span class="token keyword">this</span><span class="token punctuation">.</span>_value <span class="token operator">=</span> value<span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n    <span class="token keyword">public</span> <span class="token keyword">double</span> Value\n    <span class="token punctuation">{</span>\n        get <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_value<span class="token punctuation">;</span> <span class="token punctuation">}</span>\n    <span class="token punctuation">}</span>\n    <span class="token keyword">public</span> override <span class="token keyword">double</span> <span class="token function">Interpreter</span><span class="token punctuation">(</span>Syntax root<span class="token punctuation">)</span>\n    <span class="token punctuation">{</span>\n        <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>NumExpression<span class="token punctuation">)</span><span class="token punctuation">(</span>root<span class="token punctuation">.</span>Expression<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Value<span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">enum</span> <span class="token class-name">Op</span> <span class="token operator">:</span> <span class="token keyword">int</span>\n<span class="token punctuation">{</span>\n    Plus <span class="token operator">=</span> <span class="token string">\'+\'</span><span class="token punctuation">,</span>\n    Minus <span class="token operator">=</span> <span class="token string">\'-\'</span><span class="token punctuation">,</span>\n    Multiply <span class="token operator">=</span> <span class="token string">\'*\'</span><span class="token punctuation">,</span>\n    Divide <span class="token operator">=</span> <span class="token string">\'/\'</span>\n<span class="token punctuation">}</span>\n<span class="token keyword">enum</span> <span class="token class-name">Prioirty</span>\n<span class="token punctuation">{</span>\n    Lv2 <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">,</span>\n    Lv1 <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span>\n    Lv0 <span class="token operator">=</span> <span class="token number">0</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">class</span> <span class="token class-name">OpExpression</span> <span class="token operator">:</span> Expression\n<span class="token punctuation">{</span>\n    <span class="token keyword">private</span> Op _value<span class="token punctuation">;</span>\n    ……\n    <span class="token keyword">public</span> override <span class="token keyword">double</span> <span class="token function">Interpreter</span><span class="token punctuation">(</span>Syntax root<span class="token punctuation">)</span>\n    <span class="token punctuation">{</span>\n        <span class="token keyword">double</span> lvalue<span class="token punctuation">,</span> rvalue<span class="token punctuation">;</span>\n        <span class="token keyword">if</span> <span class="token punctuation">(</span>root<span class="token punctuation">.</span>LeftChild <span class="token operator">==</span> null<span class="token punctuation">)</span>\n            lvalue <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>\n        <span class="token keyword">else</span>\n            lvalue <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>Expression<span class="token punctuation">)</span>root<span class="token punctuation">.</span>LeftChild<span class="token punctuation">.</span>Expression<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Interpreter</span><span class="token punctuation">(</span>root<span class="token punctuation">.</span>LeftChild<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n        <span class="token keyword">if</span> <span class="token punctuation">(</span>root<span class="token punctuation">.</span>RightChild <span class="token operator">==</span> null<span class="token punctuation">)</span>\n            rvalue <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>\n        <span class="token keyword">else</span>\n            rvalue <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>Expression<span class="token punctuation">)</span>root<span class="token punctuation">.</span>RightChild<span class="token punctuation">.</span>Expression<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Interpreter</span><span class="token punctuation">(</span>root<span class="token punctuation">.</span>RightChild<span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token keyword">switch</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span>OpExpression<span class="token punctuation">)</span>root<span class="token punctuation">.</span>Expression<span class="token punctuation">)</span><span class="token punctuation">.</span>Value<span class="token punctuation">)</span>\n        <span class="token punctuation">{</span>\n            <span class="token keyword">case</span> Op<span class="token punctuation">.</span>Plus<span class="token operator">:</span>\n                <span class="token keyword">return</span> lvalue <span class="token operator">+</span> rvalue<span class="token punctuation">;</span>\n            <span class="token keyword">case</span> Op<span class="token punctuation">.</span>Minus<span class="token operator">:</span>\n                <span class="token keyword">return</span> lvalue <span class="token operator">-</span> rvalue<span class="token punctuation">;</span>\n            <span class="token keyword">case</span> Op<span class="token punctuation">.</span>Multiply<span class="token operator">:</span>\n                <span class="token keyword">return</span> lvalue <span class="token operator">*</span> rvalue<span class="token punctuation">;</span>\n            <span class="token keyword">case</span> Op<span class="token punctuation">.</span>Divide<span class="token operator">:</span>\n                <span class="token keyword">return</span> lvalue <span class="token operator">/</span> rvalue<span class="token punctuation">;</span>\n            <span class="token keyword">default</span><span class="token operator">:</span>\n                <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>\n        <span class="token punctuation">}</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">class</span> <span class="token class-name">Syntax</span>\n<span class="token punctuation">{</span>\n    <span class="token keyword">private</span> Expression _Expression<span class="token punctuation">;</span>\n    <span class="token keyword">private</span> Syntax _left<span class="token punctuation">;</span>\n    <span class="token keyword">private</span> Syntax _right<span class="token punctuation">;</span>\n    <span class="token keyword">public</span> <span class="token function">Syntax</span><span class="token punctuation">(</span>Expression Expression<span class="token punctuation">)</span>\n    <span class="token punctuation">{</span>\n        <span class="token keyword">this</span><span class="token punctuation">.</span>_Expression <span class="token operator">=</span> Expression<span class="token punctuation">;</span>\n        <span class="token keyword">this</span><span class="token punctuation">.</span>_left <span class="token operator">=</span> null<span class="token punctuation">;</span>\n        <span class="token keyword">this</span><span class="token punctuation">.</span>_right <span class="token operator">=</span> null<span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n    <span class="token keyword">public</span> Expression Expression\n    <span class="token punctuation">{</span>\n        get <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_Expression<span class="token punctuation">;</span> <span class="token punctuation">}</span>\n    <span class="token punctuation">}</span>\n    <span class="token keyword">public</span> Syntax LeftChild\n    <span class="token punctuation">{</span>\n        get <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_left<span class="token punctuation">;</span> <span class="token punctuation">}</span>\n        set <span class="token punctuation">{</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_left <span class="token operator">=</span> value<span class="token punctuation">;</span> <span class="token punctuation">}</span>\n    <span class="token punctuation">}</span>\n    <span class="token keyword">public</span> Syntax RightChild\n    <span class="token punctuation">{</span>\n        get <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_right<span class="token punctuation">;</span> <span class="token punctuation">}</span>\n        set <span class="token punctuation">{</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_right <span class="token operator">=</span> value<span class="token punctuation">;</span> <span class="token punctuation">}</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">class</span> <span class="token class-name">SyntaxTree</span>\n<span class="token punctuation">{</span>\n    <span class="token keyword">private</span> Syntax _root<span class="token punctuation">;</span>\n    <span class="token keyword">private</span> <span class="token keyword">int</span> _count<span class="token punctuation">;</span>\n\n    <span class="token keyword">public</span> <span class="token function">SyntaxTree</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n    <span class="token punctuation">{</span>\n        <span class="token keyword">this</span><span class="token punctuation">.</span>_root <span class="token operator">=</span> null<span class="token punctuation">;</span>\n        <span class="token keyword">this</span><span class="token punctuation">.</span>_count <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n    <span class="token keyword">public</span> Syntax Root\n    <span class="token punctuation">{</span>\n        get <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_root<span class="token punctuation">;</span> <span class="token punctuation">}</span>\n    <span class="token punctuation">}</span>\n    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">Append</span><span class="token punctuation">(</span>Expression Expression<span class="token punctuation">)</span>\n    <span class="token punctuation">{</span>\n        <span class="token keyword">this</span><span class="token punctuation">.</span>_root <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">Append</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>_root<span class="token punctuation">,</span> Expression<span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token keyword">this</span><span class="token punctuation">.</span>_count<span class="token operator">++</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n    <span class="token keyword">private</span> Syntax <span class="token function">Append</span><span class="token punctuation">(</span>Syntax root<span class="token punctuation">,</span> Expression Expression<span class="token punctuation">)</span>\n    <span class="token punctuation">{</span>\n        ……\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">class</span> <span class="token class-name">Interpreter</span>\n<span class="token punctuation">{</span>\n    <span class="token keyword">private</span> Expressionizer Expressionizer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">Expressionizer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">public</span> SyntaxTree <span class="token function">Eval</span><span class="token punctuation">(</span>String expr<span class="token punctuation">)</span>\n    <span class="token punctuation">{</span>\n        Expression<span class="token punctuation">[</span><span class="token punctuation">]</span> Expressions <span class="token operator">=</span> Expressionizer<span class="token punctuation">.</span><span class="token function">Parse</span><span class="token punctuation">(</span>expr<span class="token punctuation">)</span><span class="token punctuation">;</span>\n        SyntaxTree astree <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">SyntaxTree</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n        foreach <span class="token punctuation">(</span>Expression Expression in Expressions<span class="token punctuation">)</span>\n        <span class="token punctuation">{</span>\n            astree<span class="token punctuation">.</span><span class="token function">Append</span><span class="token punctuation">(</span>Expression<span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token punctuation">}</span>\n        <span class="token keyword">return</span> astree<span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="模式动机-2"><a href="#%E6%A8%A1%E5%BC%8F%E5%8A%A8%E6%9C%BA-2" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>模式动机</h3>\n<ul>\n<li>如果在系统中某一特定类型的问题发生的频率很高，此时可以考虑将这些问题的实例表述为一个语言中的句子，因此可以构建一个解释器，该解释器通过解释这些句子来解决这些问题。</li>\n<li>解释器模式描述了如何构成一个简单的语言解释器，主要应用在使用面向对象语言开发的编译器中。</li>\n</ul>\n<h3 id="模式定义-2"><a href="#%E6%A8%A1%E5%BC%8F%E5%AE%9A%E4%B9%89-2" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>模式定义</h3>\n<p>定义语言的文法，并且建立一个解释器来解释该语言中的句子，这里的“语言”意思是使用规定格式和语法的代码，它是一种类行为型模式。</p>\n<h3 id="模式结构-2"><a href="#%E6%A8%A1%E5%BC%8F%E7%BB%93%E6%9E%84-2" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>模式结构</h3>\n<p>\n  <a\n    class="gatsby-resp-image-link"\n    href="/static/微信截图_20180418124653-8bebd269e4ab77df241fd1d03ce10d92-5f38b.png"\n    style="display: block"\n    target="_blank"\n    rel="noopener"\n  >\n  \n  <span\n    class="gatsby-resp-image-wrapper"\n    style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;"\n  >\n    <span\n      class="gatsby-resp-image-background-image"\n      style="padding-bottom: 62.904498816101025%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAABnWAAAZ1gEY0crtAAACvUlEQVQ4y31TS0wTURQd21Ig7YqFLly6cGlcu3EhP0MiJiJuWGJcGRbGhTGBjVuVKETZGKEgVMQWrNA60k5LUVKmU1taC22Z6YeZaaF8CmUCpe/6plOBSOpNzmTuPXfuvJxzH0HI0Q0E0QPnTsO0DBqZSuTQyz0ACIp7BZsvhhZ4qfBLArCmUKfMO0RQE2dCGVKFof6Lh1aolilmA/pSeKB3E8CTA7BnAJz4D+NxuC/z5uQ/A3EvccuQV13pL2iUHB3X5ZhPo8uuNLppWyvWm7nDhol4sf5jHJoHo+iizI+wQFQIfMqT99JzKHS6djaMHDpb5HNQ88Yaq33u3NeFN4o1VBKqAfaOeW7zUEsFeL0jlNaRwYyOzoCOZA/0k6uKxk8cJf0VyCFIwCxERYZaEb2+LViaSyPb0zmk73WBqsw/DibWI5Q/RpN+lpn2cfQsl1umMnBb5mOS0lf2giCwxsBhhMqwrCHUZUd1ncZ8SWyvIA1mcd2/DUBjuDawQTg3cvBI5u+asHnd+LQ95cEOEbVZeWibSsGdTwnUPspBS2/gxDlbLHd11LPaMbaQeGD08F2vnJH2t4tix3sWLsn8s8XjVdNUFNsy/kH1btqtGnNGNP8zxe4Pqu3kV9UL86K6aUDQrkmSinBnkNqVAU1/YFdV6UPDhKAdGM9q+z6nqwYtW9X6a8sVewl+V3EHL7+WW8/fmHF5mg2TZNOQhWocJukWO7t/3Q2KPgDFUm/mAM6Tc75WEznfOPxlttEwM9869J1po5JSA8HlUGnXEnm4gB0FoYDN2SoCk0Xgx/ksf7T5OgR6uSe6jUoSsDm4d4iNiewUIbSt3KKf2DkvLhJOdqc08Ad/VOeMZekpZjUyuSSER+n4b4M3xRqj0rcBEWrlHldScd6dlOqplbRgZrigKSCER+h4eNifDpsSxfAfUWvsony7erIAAAAASUVORK5CYII=\'); background-size: cover; display: block;"\n    >\n      <img\n        class="gatsby-resp-image-image"\n        style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;"\n        alt="     20180418124653"\n        title=""\n        src="/static/微信截图_20180418124653-8bebd269e4ab77df241fd1d03ce10d92-fee1c.png"\n        srcset="/static/微信截图_20180418124653-8bebd269e4ab77df241fd1d03ce10d92-a67b7.png 200w,\n/static/微信截图_20180418124653-8bebd269e4ab77df241fd1d03ce10d92-0b187.png 400w,\n/static/微信截图_20180418124653-8bebd269e4ab77df241fd1d03ce10d92-fee1c.png 800w,\n/static/微信截图_20180418124653-8bebd269e4ab77df241fd1d03ce10d92-b1a91.png 1200w,\n/static/微信截图_20180418124653-8bebd269e4ab77df241fd1d03ce10d92-5f38b.png 1267w"\n        sizes="(max-width: 800px) 100vw, 800px"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<ul>\n<li>AbstractExpression: 抽象表达式</li>\n<li>TerminalExpression: 终结符表达式</li>\n<li>NonterminalExpression: 非终结符表达式</li>\n<li>Context: 环境类</li>\n<li>Client: 客户类</li>\n</ul>\n<h3 id="模式分析"><a href="#%E6%A8%A1%E5%BC%8F%E5%88%86%E6%9E%90" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>模式分析</h3>\n<p>解释器模式描述了如何为简单的语言定义一个文法，如何在该语言中表示一个句子，以及如何解释这些句子。</p>\n<p>文法规则实例：</p>\n<ul>\n<li>expression ::= value | symbol</li>\n<li>symbol ::= expression ’+’ expression | expression ’-‘</li>\n<li>value ::= an integer //一个整数值</li>\n<li>在文法规则定义中可以使用一些符号来表示不同的含义，如使用“|”表示或，使用“{”和“}”表示组合，使用“*”表示出现 0 次或多次等。</li>\n</ul>\n<p>抽象语法树：</p>\n<p>除了使用文法规则来定义一个语言，在解释器模式中还可以通过一种称之为抽象语法树(Abstract Syntax Tree, AST)的图形方式来直观地表示语言的构成，每一棵抽象语法树对应一个语言实例。</p>\n<ul>\n<li>抽象语法树描述了如何构成一个复杂的句子，通过对抽象语法树的分析，可以识别出语言中的终结符和非终结符类。</li>\n<li>在解释器模式中，每一种终结符和非终结符都有一个具体类与之对应，正因为使用类来表示每一个语法规则，使得系统具有较好的扩展性和灵活性。</li>\n</ul>\n<h3 id="优缺点-2"><a href="#%E4%BC%98%E7%BC%BA%E7%82%B9-2" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>优缺点</h3>\n<ul>\n<li>\n<p>优点</p>\n<ul>\n<li>易于改变和扩展文法。</li>\n<li>易于实现文法。</li>\n<li>增加了新的解释表达式的方式。</li>\n</ul>\n</li>\n<li>\n<p>缺点</p>\n<ul>\n<li>对于复杂文法难以维护。</li>\n<li>执行效率较低。</li>\n<li>应用场景很有限。</li>\n</ul>\n</li>\n</ul>\n<h3 id="模式使用-2"><a href="#%E6%A8%A1%E5%BC%8F%E4%BD%BF%E7%94%A8-2" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>模式使用</h3>\n<ul>\n<li>可以将一个需要解释执行的语言中的句子表示为一个抽象语法树。</li>\n<li>一些重复出现的问题可以用一种简单的语言来进行表达。</li>\n<li>文法较为简单。</li>\n<li>效率不是关键问题。</li>\n</ul>\n<h3 id="模式应用-2"><a href="#%E6%A8%A1%E5%BC%8F%E5%BA%94%E7%94%A8-2" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>模式应用</h3>\n<ul>\n<li>解释器模式在使用面向对象语言实现的编译器中得到了广泛的应用，如 Smalltalk 语言的编译器。</li>\n<li>目前有一些基于 Java 抽象语法树的源代码处理工具，如在 Eclipse 中就提供了 Eclipse AST，它是 Eclipse JDT 的一个重要组成部分，用来表示 Java 语言的语法结构，用户可以通过扩展其功能，创建自己的文法规则。</li>\n<li>可以使用解释器模式，通过 C++、Java、C#等面向对象语言开发简单的编译器，如数学表达式解析器、正则表达式解析器等，用于增强这些语言的功能，使之增加一些新的文法规则，用于解释一些特定类型的语句。</li>\n<li>在实际项目开发中如果需要解析数学公式，无须再运用解释器模式进行设计，可以直接使用一些第三方解析工具包，它们可以统称为数学表达式解析器(Math Expression Parser, MEP)，如 Expression4J、Jep、JbcParser、Symja、Math Expression String Parser(MESP)等来取代解释器模式，它们可以方便地解释一些较为复杂的文法，功能强大，且使用简单，效率较好。</li>\n<li>Expression4J：Expression4J 是一个基于 Java 的开源框架，它用于对数学表达式进行操作，是一个数学公式解析器，在 Expression4J 中可以将数学表达式存储在字符串对象中。Expression4J 是高度定制的，用户可以自定义文法，其主要功能包括实数和复数的基本数学运算，支持基本数学函数、复杂函数以及用户使用 Java 语言自定义的函数和文法，还可以定义函数目录（函数集）、支持 XML 配置文件等。</li>\n</ul>\n<h3 id="模式总结"><a href="#%E6%A8%A1%E5%BC%8F%E6%80%BB%E7%BB%93" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>模式总结</h3>\n<ul>\n<li>解释器模式定义语言的文法，并且建立一个解释器来解释该语言中的句子，这里的“语言”意思是使用规定格式和语法的代码，它是一种类行为型模式。</li>\n<li>解释器模式描述了如何为简单的语言定义一个文法，如何在该语言中表示一个句子，以及如何解释这些句子。</li>\n<li>解释器模式主要包含如下四个角色：在抽象表达式中声明了抽象的解释操作，它是所有的终结符表达式和非终结符表达式的公共父类；终结符表达式是抽象表达式的子类，它实现了与文法中的终结符相关联的解释操作；非终结符表达式也是抽象表达式的子类，它实现了文法中非终结符的解释操作；环境类又称为上下文类，它用于存储解释器之外的一些全局信息。</li>\n<li>对于一个简单的语言可以使用一些文法规则来进行定义，还可以通过抽象语法树的图形方式来直观地表示语言的构成，每一棵抽象语法树对应一个语言实例。</li>\n<li>解释器模式的主要优点包括易于改变和扩展文法，易于实现文法并增加了新的解释表达式的方式；其主要缺点是对于复杂文法难以维护，执行效率较低且应用场景很有限。</li>\n<li>解释器模式适用情况包括：可以将一个需要解释执行的语言中的句子表示为一个抽象语法树；一些重复出现的问题可以用一种简单的语言来进行表达；文法较为简单且效率不是关键问题。</li>\n</ul>',
excerpt:"模板方法模式(Template Method) 定义一个操作中的算法的骨架，而将一些步骤延迟到子类中。TemplateMethod…",timeToRead:11,tableOfContents:'<ul>\n<li>\n<p><a href="/design-pattern-behavior-3/#%E6%A8%A1%E6%9D%BF%E6%96%B9%E6%B3%95%E6%A8%A1%E5%BC%8Ftemplate-method">模板方法模式(Template Method)</a></p>\n<ul>\n<li><a href="/design-pattern-behavior-3/#%E6%A8%A1%E5%BC%8F%E8%83%8C%E6%99%AF">模式背景</a></li>\n<li><a href="/design-pattern-behavior-3/#%E6%A8%A1%E5%BC%8F%E5%8A%A8%E6%9C%BA">模式动机</a></li>\n<li><a href="/design-pattern-behavior-3/#%E6%A8%A1%E5%BC%8F%E5%AE%9A%E4%B9%89">模式定义</a></li>\n<li><a href="/design-pattern-behavior-3/#%E6%A8%A1%E5%BC%8F%E7%BB%93%E6%9E%84">模式结构</a></li>\n<li><a href="/design-pattern-behavior-3/#%E4%BC%98%E7%BC%BA%E7%82%B9">优缺点</a></li>\n<li><a href="/design-pattern-behavior-3/#%E6%A8%A1%E5%BC%8F%E4%BD%BF%E7%94%A8">模式使用</a></li>\n<li><a href="/design-pattern-behavior-3/#%E6%A8%A1%E5%BC%8F%E5%BA%94%E7%94%A8">模式应用</a></li>\n</ul>\n</li>\n<li>\n<p><a href="/design-pattern-behavior-3/#%E8%AE%BF%E9%97%AE%E8%80%85%E6%A8%A1%E5%BC%8Fvisitor">访问者模式(Visitor)</a></p>\n<ul>\n<li><a href="/design-pattern-behavior-3/#%E6%A8%A1%E5%BC%8F%E8%83%8C%E6%99%AF-1">模式背景</a></li>\n<li><a href="/design-pattern-behavior-3/#%E6%A8%A1%E5%BC%8F%E5%8A%A8%E6%9C%BA-1">模式动机</a></li>\n<li><a href="/design-pattern-behavior-3/#%E6%A8%A1%E5%BC%8F%E5%AE%9A%E4%B9%89-1">模式定义</a></li>\n<li><a href="/design-pattern-behavior-3/#%E6%A8%A1%E5%BC%8F%E7%BB%93%E6%9E%84-1">模式结构</a></li>\n<li><a href="/design-pattern-behavior-3/#%E4%BC%98%E7%BC%BA%E7%82%B9-1">优缺点</a></li>\n<li><a href="/design-pattern-behavior-3/#%E6%A8%A1%E5%BC%8F%E4%BD%BF%E7%94%A8-1">模式使用</a></li>\n<li><a href="/design-pattern-behavior-3/#%E6%A8%A1%E5%BC%8F%E5%BA%94%E7%94%A8-1">模式应用</a></li>\n<li><a href="/design-pattern-behavior-3/#%E6%A8%A1%E5%BC%8F%E5%B0%8F%E7%BB%93">模式小结</a></li>\n</ul>\n</li>\n<li>\n<p><a href="/design-pattern-behavior-3/#%E8%A7%A3%E9%87%8A%E5%99%A8%E6%A8%A1%E5%BC%8Finterpreter">解释器模式(Interpreter)</a></p>\n<ul>\n<li><a href="/design-pattern-behavior-3/#%E6%A8%A1%E5%BC%8F%E8%83%8C%E6%99%AF-2">模式背景</a></li>\n<li><a href="/design-pattern-behavior-3/#%E6%A8%A1%E5%BC%8F%E5%8A%A8%E6%9C%BA-2">模式动机</a></li>\n<li><a href="/design-pattern-behavior-3/#%E6%A8%A1%E5%BC%8F%E5%AE%9A%E4%B9%89-2">模式定义</a></li>\n<li><a href="/design-pattern-behavior-3/#%E6%A8%A1%E5%BC%8F%E7%BB%93%E6%9E%84-2">模式结构</a></li>\n<li><a href="/design-pattern-behavior-3/#%E6%A8%A1%E5%BC%8F%E5%88%86%E6%9E%90">模式分析</a></li>\n<li><a href="/design-pattern-behavior-3/#%E4%BC%98%E7%BC%BA%E7%82%B9-2">优缺点</a></li>\n<li><a href="/design-pattern-behavior-3/#%E6%A8%A1%E5%BC%8F%E4%BD%BF%E7%94%A8-2">模式使用</a></li>\n<li><a href="/design-pattern-behavior-3/#%E6%A8%A1%E5%BC%8F%E5%BA%94%E7%94%A8-2">模式应用</a></li>\n<li><a href="/design-pattern-behavior-3/#%E6%A8%A1%E5%BC%8F%E6%80%BB%E7%BB%93">模式总结</a></li>\n</ul>\n</li>\n</ul>',wordCount:{words:500},frontmatter:{date:"2018-04-19 00:04:46",path:"/design-pattern-behavior-3/",tags:"面试, 设计模式",title:"设计模式之行为型模式（三）",draft:null,catalog_number:null}},nextPost:{html:'<h2 id="备忘录模式memento"><a href="#%E5%A4%87%E5%BF%98%E5%BD%95%E6%A8%A1%E5%BC%8Fmemento" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>备忘录模式(Memento)</h2>\n<p>在不破坏封装性的前提下，捕获一个对象的内部状态，并在该对象之外保存这个状态。这样以后就可将该对象恢复到原先保存的状态。</p>\n<h3 id="模式背景"><a href="#%E6%A8%A1%E5%BC%8F%E8%83%8C%E6%99%AF" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>模式背景</h3>\n<p>我要保存游戏进度</p>\n<ul>\n<li>游戏角色，生命力、攻击力、防御力</li>\n<li>模拟战斗代码，读取进度</li>\n</ul>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="37369388587151130000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`class GameRole\n{\n    //生命力\n    private int vit;\n    public int Vitality\n    {\n        get { return vit; }\n        set { vit = value; }\n    }\n\n    //攻击力\n    private int atk;\n    public int Attack\n    {\n        get { return atk; }\n        set { atk = value; }\n    }\n\n    //防御力\n    private int def;\n    public int Defense\n    {\n        get { return def; }\n        set { def = value; }\n    }\n    //状态显示\n    public void StateDisplay()\n    {\n        Console.WriteLine(&quot;角色当前状态：&quot;);\n        Console.WriteLine(&quot;体力：{0}&quot;, this.vit);\n        Console.WriteLine(&quot;攻击力：{0}&quot;, this.atk);\n        Console.WriteLine(&quot;防御力：{0}&quot;, this.def);\n        Console.WriteLine(&quot;&quot;);\n    }\n\n    //获得初始状态\n    public void GetInitState()\n    {\n        this.vit = 100;\n        this.atk = 100;\n        this.def = 100;\n    }\n\n    //战斗\n    public void Fight()\n    {\n        this.vit = 0;\n        this.atk = 0;\n        this.def = 0;\n    }\n}\n\nstatic void Main(string[] args)\n{\n    //大战Boss前\n    GameRole lixiaoyao = new GameRole();\n    lixiaoyao.GetInitState();\n    lixiaoyao.StateDisplay();\n\n    //保存进度\n    GameRole backup = new GameRole();\n    backup.Vitality = lixiaoyao.Vitality;\n    backup.Attack = lixiaoyao.Attack;\n    backup.Defense = lixiaoyao.Defense;\n\n    //大战Boss时，损耗严重\n    lixiaoyao.Fight();\n    lixiaoyao.StateDisplay();\n\n    //恢复之前状态\n    lixiaoyao.Vitality = backup.Vitality;\n    lixiaoyao.Attack = backup.Attack;\n    lixiaoyao.Defense = backup.Defense;\n\n    lixiaoyao.StateDisplay();\n    Console.Read();\n}`, `37369388587151130000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                cpp 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="cpp"><pre style="counter-reset: linenumber NaN" class="language-cpp line-numbers"><code class="language-cpp"><span class="token keyword">class</span> <span class="token class-name">GameRole</span>\n<span class="token punctuation">{</span>\n    <span class="token comment">//生命力</span>\n    <span class="token keyword">private</span> <span class="token keyword">int</span> vit<span class="token punctuation">;</span>\n    <span class="token keyword">public</span> <span class="token keyword">int</span> Vitality\n    <span class="token punctuation">{</span>\n        get <span class="token punctuation">{</span> <span class="token keyword">return</span> vit<span class="token punctuation">;</span> <span class="token punctuation">}</span>\n        set <span class="token punctuation">{</span> vit <span class="token operator">=</span> value<span class="token punctuation">;</span> <span class="token punctuation">}</span>\n    <span class="token punctuation">}</span>\n\n    <span class="token comment">//攻击力</span>\n    <span class="token keyword">private</span> <span class="token keyword">int</span> atk<span class="token punctuation">;</span>\n    <span class="token keyword">public</span> <span class="token keyword">int</span> Attack\n    <span class="token punctuation">{</span>\n        get <span class="token punctuation">{</span> <span class="token keyword">return</span> atk<span class="token punctuation">;</span> <span class="token punctuation">}</span>\n        set <span class="token punctuation">{</span> atk <span class="token operator">=</span> value<span class="token punctuation">;</span> <span class="token punctuation">}</span>\n    <span class="token punctuation">}</span>\n\n    <span class="token comment">//防御力</span>\n    <span class="token keyword">private</span> <span class="token keyword">int</span> def<span class="token punctuation">;</span>\n    <span class="token keyword">public</span> <span class="token keyword">int</span> Defense\n    <span class="token punctuation">{</span>\n        get <span class="token punctuation">{</span> <span class="token keyword">return</span> def<span class="token punctuation">;</span> <span class="token punctuation">}</span>\n        set <span class="token punctuation">{</span> def <span class="token operator">=</span> value<span class="token punctuation">;</span> <span class="token punctuation">}</span>\n    <span class="token punctuation">}</span>\n    <span class="token comment">//状态显示</span>\n    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">StateDisplay</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n    <span class="token punctuation">{</span>\n        Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">"角色当前状态："</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n        Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">"体力：{0}"</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>vit<span class="token punctuation">)</span><span class="token punctuation">;</span>\n        Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">"攻击力：{0}"</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>atk<span class="token punctuation">)</span><span class="token punctuation">;</span>\n        Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">"防御力：{0}"</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>def<span class="token punctuation">)</span><span class="token punctuation">;</span>\n        Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n\n    <span class="token comment">//获得初始状态</span>\n    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">GetInitState</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n    <span class="token punctuation">{</span>\n        <span class="token keyword">this</span><span class="token punctuation">.</span>vit <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">;</span>\n        <span class="token keyword">this</span><span class="token punctuation">.</span>atk <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">;</span>\n        <span class="token keyword">this</span><span class="token punctuation">.</span>def <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n\n    <span class="token comment">//战斗</span>\n    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">Fight</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n    <span class="token punctuation">{</span>\n        <span class="token keyword">this</span><span class="token punctuation">.</span>vit <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>\n        <span class="token keyword">this</span><span class="token punctuation">.</span>atk <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>\n        <span class="token keyword">this</span><span class="token punctuation">.</span>def <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">Main</span><span class="token punctuation">(</span>string<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span>\n<span class="token punctuation">{</span>\n    <span class="token comment">//大战Boss前</span>\n    GameRole lixiaoyao <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">GameRole</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    lixiaoyao<span class="token punctuation">.</span><span class="token function">GetInitState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    lixiaoyao<span class="token punctuation">.</span><span class="token function">StateDisplay</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token comment">//保存进度</span>\n    GameRole backup <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">GameRole</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    backup<span class="token punctuation">.</span>Vitality <span class="token operator">=</span> lixiaoyao<span class="token punctuation">.</span>Vitality<span class="token punctuation">;</span>\n    backup<span class="token punctuation">.</span>Attack <span class="token operator">=</span> lixiaoyao<span class="token punctuation">.</span>Attack<span class="token punctuation">;</span>\n    backup<span class="token punctuation">.</span>Defense <span class="token operator">=</span> lixiaoyao<span class="token punctuation">.</span>Defense<span class="token punctuation">;</span>\n\n    <span class="token comment">//大战Boss时，损耗严重</span>\n    lixiaoyao<span class="token punctuation">.</span><span class="token function">Fight</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    lixiaoyao<span class="token punctuation">.</span><span class="token function">StateDisplay</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token comment">//恢复之前状态</span>\n    lixiaoyao<span class="token punctuation">.</span>Vitality <span class="token operator">=</span> backup<span class="token punctuation">.</span>Vitality<span class="token punctuation">;</span>\n    lixiaoyao<span class="token punctuation">.</span>Attack <span class="token operator">=</span> backup<span class="token punctuation">.</span>Attack<span class="token punctuation">;</span>\n    lixiaoyao<span class="token punctuation">.</span>Defense <span class="token operator">=</span> backup<span class="token punctuation">.</span>Defense<span class="token punctuation">;</span>\n\n    lixiaoyao<span class="token punctuation">.</span><span class="token function">StateDisplay</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    Console<span class="token punctuation">.</span><span class="token function">Read</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="模式动机"><a href="#%E6%A8%A1%E5%BC%8F%E5%8A%A8%E6%9C%BA" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>模式动机</h3>\n<ul>\n<li>在应用软件的开发过程中，有时我们有必要记录一个对象的内部状态。为了允许用户取消不确定的操作或从错误中恢复过来，需要实现备份点和撤销机制，而要实现这些机制，我们必须事先将状态信息保存在某处，这样状态才能将对象恢复到它们原先的状态。</li>\n<li>但是对象通常封装了其部分或所有的状态信息，使得其状态不能被其它对象访问，也就不可能在该对象之外保存其状态，而暴露其内部状态又将违反封装的原则，可能有损系统的可靠性和可扩展性。</li>\n</ul>\n<h3 id="模式定义"><a href="#%E6%A8%A1%E5%BC%8F%E5%AE%9A%E4%B9%89" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>模式定义</h3>\n<p>在不破坏封装的前提下，捕获一个对象的内部状态，并在该对象之外保存这个状态，这样可以在以后将对象恢复到原先保存的状态。</p>\n<p>\n  <a\n    class="gatsby-resp-image-link"\n    href="/static/微信截图_20180417173923-a23b6990c677847f5a81f1082f98600f-63d95.png"\n    style="display: block"\n    target="_blank"\n    rel="noopener"\n  >\n  \n  <span\n    class="gatsby-resp-image-wrapper"\n    style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;"\n  >\n    <span\n      class="gatsby-resp-image-background-image"\n      style="padding-bottom: 33.365477338476374%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAAA7DAAAOwwHHb6hkAAAA10lEQVQoz41R2QrDMAzL/39dn0qhB70oDfS+bxUZOraxrTOYKHYsy47CBzuO43Fe+Pn+y1XbtojjGGmagnhd1xfSd6I7U1EUgZ7nOZqmwTiOkuDdtm1YlgXf9zHPs8T3fceyLPKuqiqUZSmYsW3boEzTRFEUooyEXddhmiY4joMkSTAMA/q+h9ZaChgLwxCu68IwDHHP86Qp6xUTQRBIF6rgyUKuIcsyIeNDqqERM8cGzHMSYk7JlSmOxQ5MkOwameRUSoX0a7e3O6zrWvZAdhJQ3Tf755dP30Ed4fNbSZcAAAAASUVORK5CYII=\'); background-size: cover; display: block;"\n    >\n      <img\n        class="gatsby-resp-image-image"\n        style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;"\n        alt="     20180417173923"\n        title=""\n        src="/static/微信截图_20180417173923-a23b6990c677847f5a81f1082f98600f-fee1c.png"\n        srcset="/static/微信截图_20180417173923-a23b6990c677847f5a81f1082f98600f-a67b7.png 200w,\n/static/微信截图_20180417173923-a23b6990c677847f5a81f1082f98600f-0b187.png 400w,\n/static/微信截图_20180417173923-a23b6990c677847f5a81f1082f98600f-fee1c.png 800w,\n/static/微信截图_20180417173923-a23b6990c677847f5a81f1082f98600f-63d95.png 1037w"\n        sizes="(max-width: 800px) 100vw, 800px"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="45040963570969250000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`class GameRole\n{\n    ……\n\n    //保存角色状态\n    public RoleStateMemento SaveState()\n    {\n        return (new RoleStateMemento(vit, atk, def));\n    }\n\n    //恢复角色状态\n    public void RecoveryState(RoleStateMemento memento)\n    {\n        this.vit = memento.Vitality;\n        this.atk = memento.Attack;\n        this.def = memento.Defense;\n    }\n\n    ……\n}\n\nclass RoleStateMemento    //角色状态存储箱\n{\n    private int vit;\n    private int atk;\n    private int def;\n\n    public RoleStateMemento(int vit, int atk, int def)\n    {\n        this.vit = vit;\n        this.atk = atk;\n        this.def = def;\n    }\n\n    public int Vitality   //生命力\n    {\n        get { return vit; }\n        set { vit = value; }\n    }\n\n    public int Attack   //攻击力\n    {\n        get { return atk; }\n        set { atk = value; }\n    }\n\n    public int Defense    //防御力\n    {\n        get { return def; }\n        set { def = value; }\n    }\n}\n//角色状态管理者\nclass RoleStateCaretaker\n{\n    private RoleStateMemento memento;\n\n    public void ImportState(RoleStateMemento Record)\n    {\n        memento = Record;\n    }\n\n    public RoleStateMemento ExportState()\n    {\n        return memento;\n    }\n}\n\nstatic void Main(string[] args)\n{\n    //大战Boss前\n    GameRole lixiaoyao = new GameRole();\n    lixiaoyao.GetInitState();\n    lixiaoyao.StateDisplay();\n\n    //保存进度\n    RoleStateCaretaker stateAdmin = new RoleStateCaretaker();\n    stateAdmin.ImportState(lixiaoyao.SaveState());\n\n    //大战Boss时，损耗严重\n    lixiaoyao.Fight();\n    lixiaoyao.StateDisplay();\n\n    //恢复之前状态\n    lixiaoyao.RecoveryState(stateAdmin.ExportState());\n    lixiaoyao.StateDisplay();\n\n    Console.Read();\n}`, `45040963570969250000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                cpp 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="cpp"><pre style="counter-reset: linenumber NaN" class="language-cpp line-numbers"><code class="language-cpp"><span class="token keyword">class</span> <span class="token class-name">GameRole</span>\n<span class="token punctuation">{</span>\n    ……\n\n    <span class="token comment">//保存角色状态</span>\n    <span class="token keyword">public</span> RoleStateMemento <span class="token function">SaveState</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n    <span class="token punctuation">{</span>\n        <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token function">RoleStateMemento</span><span class="token punctuation">(</span>vit<span class="token punctuation">,</span> atk<span class="token punctuation">,</span> def<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n\n    <span class="token comment">//恢复角色状态</span>\n    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">RecoveryState</span><span class="token punctuation">(</span>RoleStateMemento memento<span class="token punctuation">)</span>\n    <span class="token punctuation">{</span>\n        <span class="token keyword">this</span><span class="token punctuation">.</span>vit <span class="token operator">=</span> memento<span class="token punctuation">.</span>Vitality<span class="token punctuation">;</span>\n        <span class="token keyword">this</span><span class="token punctuation">.</span>atk <span class="token operator">=</span> memento<span class="token punctuation">.</span>Attack<span class="token punctuation">;</span>\n        <span class="token keyword">this</span><span class="token punctuation">.</span>def <span class="token operator">=</span> memento<span class="token punctuation">.</span>Defense<span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n\n    ……\n<span class="token punctuation">}</span>\n\n<span class="token keyword">class</span> <span class="token class-name">RoleStateMemento</span>    <span class="token comment">//角色状态存储箱</span>\n<span class="token punctuation">{</span>\n    <span class="token keyword">private</span> <span class="token keyword">int</span> vit<span class="token punctuation">;</span>\n    <span class="token keyword">private</span> <span class="token keyword">int</span> atk<span class="token punctuation">;</span>\n    <span class="token keyword">private</span> <span class="token keyword">int</span> def<span class="token punctuation">;</span>\n\n    <span class="token keyword">public</span> <span class="token function">RoleStateMemento</span><span class="token punctuation">(</span><span class="token keyword">int</span> vit<span class="token punctuation">,</span> <span class="token keyword">int</span> atk<span class="token punctuation">,</span> <span class="token keyword">int</span> def<span class="token punctuation">)</span>\n    <span class="token punctuation">{</span>\n        <span class="token keyword">this</span><span class="token punctuation">.</span>vit <span class="token operator">=</span> vit<span class="token punctuation">;</span>\n        <span class="token keyword">this</span><span class="token punctuation">.</span>atk <span class="token operator">=</span> atk<span class="token punctuation">;</span>\n        <span class="token keyword">this</span><span class="token punctuation">.</span>def <span class="token operator">=</span> def<span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n\n    <span class="token keyword">public</span> <span class="token keyword">int</span> Vitality   <span class="token comment">//生命力</span>\n    <span class="token punctuation">{</span>\n        get <span class="token punctuation">{</span> <span class="token keyword">return</span> vit<span class="token punctuation">;</span> <span class="token punctuation">}</span>\n        set <span class="token punctuation">{</span> vit <span class="token operator">=</span> value<span class="token punctuation">;</span> <span class="token punctuation">}</span>\n    <span class="token punctuation">}</span>\n\n    <span class="token keyword">public</span> <span class="token keyword">int</span> Attack   <span class="token comment">//攻击力</span>\n    <span class="token punctuation">{</span>\n        get <span class="token punctuation">{</span> <span class="token keyword">return</span> atk<span class="token punctuation">;</span> <span class="token punctuation">}</span>\n        set <span class="token punctuation">{</span> atk <span class="token operator">=</span> value<span class="token punctuation">;</span> <span class="token punctuation">}</span>\n    <span class="token punctuation">}</span>\n\n    <span class="token keyword">public</span> <span class="token keyword">int</span> Defense    <span class="token comment">//防御力</span>\n    <span class="token punctuation">{</span>\n        get <span class="token punctuation">{</span> <span class="token keyword">return</span> def<span class="token punctuation">;</span> <span class="token punctuation">}</span>\n        set <span class="token punctuation">{</span> def <span class="token operator">=</span> value<span class="token punctuation">;</span> <span class="token punctuation">}</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n<span class="token comment">//角色状态管理者</span>\n<span class="token keyword">class</span> <span class="token class-name">RoleStateCaretaker</span>\n<span class="token punctuation">{</span>\n    <span class="token keyword">private</span> RoleStateMemento memento<span class="token punctuation">;</span>\n\n    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">ImportState</span><span class="token punctuation">(</span>RoleStateMemento Record<span class="token punctuation">)</span>\n    <span class="token punctuation">{</span>\n        memento <span class="token operator">=</span> Record<span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n\n    <span class="token keyword">public</span> RoleStateMemento <span class="token function">ExportState</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n    <span class="token punctuation">{</span>\n        <span class="token keyword">return</span> memento<span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">Main</span><span class="token punctuation">(</span>string<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span>\n<span class="token punctuation">{</span>\n    <span class="token comment">//大战Boss前</span>\n    GameRole lixiaoyao <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">GameRole</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    lixiaoyao<span class="token punctuation">.</span><span class="token function">GetInitState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    lixiaoyao<span class="token punctuation">.</span><span class="token function">StateDisplay</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token comment">//保存进度</span>\n    RoleStateCaretaker stateAdmin <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">RoleStateCaretaker</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    stateAdmin<span class="token punctuation">.</span><span class="token function">ImportState</span><span class="token punctuation">(</span>lixiaoyao<span class="token punctuation">.</span><span class="token function">SaveState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token comment">//大战Boss时，损耗严重</span>\n    lixiaoyao<span class="token punctuation">.</span><span class="token function">Fight</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    lixiaoyao<span class="token punctuation">.</span><span class="token function">StateDisplay</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token comment">//恢复之前状态</span>\n    lixiaoyao<span class="token punctuation">.</span><span class="token function">RecoveryState</span><span class="token punctuation">(</span>stateAdmin<span class="token punctuation">.</span><span class="token function">ExportState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    lixiaoyao<span class="token punctuation">.</span><span class="token function">StateDisplay</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    Console<span class="token punctuation">.</span><span class="token function">Read</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="模式结构"><a href="#%E6%A8%A1%E5%BC%8F%E7%BB%93%E6%9E%84" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>模式结构</h3>\n<p>\n  <a\n    class="gatsby-resp-image-link"\n    href="/static/微信截图_20180417174524-8b6a11cdc04889d18c9b6a04b555675f-9074e.png"\n    style="display: block"\n    target="_blank"\n    rel="noopener"\n  >\n  \n  <span\n    class="gatsby-resp-image-wrapper"\n    style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;"\n  >\n    <span\n      class="gatsby-resp-image-background-image"\n      style="padding-bottom: 15.852442671984049%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAYAAACTWi8uAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAA20lEQVQI12N4+PBh/82bN2cdO3Zs+u3bt+c9efKkpqSkhJkBCK5cuWJ68uTJnEuXLmUD1VgxQAFQj9udO3dyTp06lQIUzwCyo0JDQxnBktevX//39evX/58/f/4PAo8ePbqbkpLCDZK7fPny1J8/f4LFr127tgoklpeXJwpkXwWJvXjx4v/379//P3369NOMGTNYwAYCTX917969v0CX/fj79+//jx8/nikrK2OHurDo+fPnj96+fXv/6tWr9SAxTU1NVqCBc4Hi91++fHkRSN+6e/funq6uLrCvAFj8l4xeD0NtAAAAAElFTkSuQmCC\'); background-size: cover; display: block;"\n    >\n      <img\n        class="gatsby-resp-image-image"\n        style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;"\n        alt="     20180417174524"\n        title=""\n        src="/static/微信截图_20180417174524-8b6a11cdc04889d18c9b6a04b555675f-fee1c.png"\n        srcset="/static/微信截图_20180417174524-8b6a11cdc04889d18c9b6a04b555675f-a67b7.png 200w,\n/static/微信截图_20180417174524-8b6a11cdc04889d18c9b6a04b555675f-0b187.png 400w,\n/static/微信截图_20180417174524-8b6a11cdc04889d18c9b6a04b555675f-fee1c.png 800w,\n/static/微信截图_20180417174524-8b6a11cdc04889d18c9b6a04b555675f-9074e.png 1003w"\n        sizes="(max-width: 800px) 100vw, 800px"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<ul>\n<li>Originator：原发器</li>\n<li>Memento：备忘录</li>\n<li>Caretaker：负责人</li>\n</ul>\n<h3 id="优缺点"><a href="#%E4%BC%98%E7%BC%BA%E7%82%B9" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>优缺点</h3>\n<ul>\n<li>\n<p>优点</p>\n<ul>\n<li>备忘录模式提供了一种状态恢复的实现机制，使得用户可以方便地回到一个特定的历史步骤，当新的状态无效或者存在问题时，可以使用暂时存储起来的备忘录将状态复原。</li>\n<li>备忘录模式保存了封装的边界信息，Memento 对象是原发器对象的表示，不会被其它代码改动，这种模式简化了原发器对象，Memento 只保存原发器的状态，采用堆栈来存储备忘录对象可以实现多次取消操作。</li>\n</ul>\n</li>\n<li>\n<p>缺点</p>\n<ul>\n<li>资源消耗过大，如果类的成员变量太多，就不可避免占用大量的内存了，而且每保存一次对象的状态都需要消耗内存资源，如果知道这一点大家就容易理解为什么一些提供了 Undo 功能的软件在运行时需要的内存和硬盘空间比较大了。</li>\n</ul>\n</li>\n</ul>\n<h3 id="模式使用"><a href="#%E6%A8%A1%E5%BC%8F%E4%BD%BF%E7%94%A8" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>模式使用</h3>\n<ul>\n<li>必须保存一个对象在某一个时刻的状态/部分状态，这样以后需要时它能够恢复到先前的状态。</li>\n<li>如果一个用接口来让其它对象得到这些状态，将会暴露对象的实现细节并破坏对象的封装性。</li>\n</ul>\n<h3 id="模式应用"><a href="#%E6%A8%A1%E5%BC%8F%E5%BA%94%E7%94%A8" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>模式应用</h3>\n<ul>\n<li>Undo 功能</li>\n<li>配置文件</li>\n<li>Cookie Session 对象</li>\n</ul>\n<h2 id="观察者模式observer"><a href="#%E8%A7%82%E5%AF%9F%E8%80%85%E6%A8%A1%E5%BC%8Fobserver" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>观察者模式(Observer)</h2>\n<p>定义对象间的一种一对多的依赖关系，当一个对象的状态发生改变时，所有依赖于它的对象都得到通知并被自动更新。</p>\n<h3 id="模式背景-1"><a href="#%E6%A8%A1%E5%BC%8F%E8%83%8C%E6%99%AF-1" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>模式背景</h3>\n<p>晕，老板回来了，我不知道</p>\n<ul>\n<li>股市特别火，同事在上班期间偷偷看股票行情</li>\n<li>如果老板出门回来，公司前台 MM 电话事先通知</li>\n<li>可是…..</li>\n<li>老板今天刚一回来，让前台 MM 去打印资料了</li>\n<li>同事背对着大门大喊了一声“耶！我的股票涨停啦！”</li>\n<li>程序模拟发生的事情</li>\n</ul>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="19043325818078750000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`class Secretary   //前台秘书类\n{\n    //同事列表\n    private IList<StockObserver> observers = new List<StockObserver>();\n    private string action;\n    //增加\n    public void Attach(StockObserver observer)\n    {\n        observers.Add(observer);\n    }\n    //减少\n    public void Detach(StockObserver observer)\n    {\n        observers.Remove(observer);\n    }\n    //通知\n    public void Notify()\n    {\n        foreach (StockObserver o in observers)\n            o.Update();\n    }\n    //前台状态\n    public string SecretaryAction\n    {\n        get { return action; }\n        set { action = value; }\n    }\n}\n//看股票的同事\nclass StockObserver\n{\n    private string name;\n    private Secretary sub;\n\n    public StockObserver(string name, Secretary sub)\n    {\n        this.name = name;\n        this.sub = sub;\n    }\n\n    public void Update()\n    {\n        Console.WriteLine(&quot;{0} {1} 关闭股票行情，继续工作！&quot;, sub.SecretaryAction, name);\n    }\n}\nstatic void Main(string[] args)\n{\n    //前台秘书MM\n    Secretary MM = new Secretary();\n    //看股票的同事\n    StockObserver tongshi1 = new StockObserver(&quot;魏关姹&quot;, MM);\n    StockObserver tongshi2 = new StockObserver(&quot;易管查&quot;, MM);\n\n    //前台记下了两位同事\n    MM.Attach(tongshi1);\n    MM.Attach(tongshi2);\n    //发现老板回来\n    MM.SecretaryAction = &quot;老板回来了！&quot;;\n    //通知两个同事\n    MM.Notify();\n\n    Console.Read();\n}`, `19043325818078750000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                cpp 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="cpp"><pre style="counter-reset: linenumber NaN" class="language-cpp line-numbers"><code class="language-cpp"><span class="token keyword">class</span> <span class="token class-name">Secretary</span>   <span class="token comment">//前台秘书类</span>\n<span class="token punctuation">{</span>\n    <span class="token comment">//同事列表</span>\n    <span class="token keyword">private</span> IList<span class="token operator">&lt;</span>StockObserver<span class="token operator">></span> observers <span class="token operator">=</span> <span class="token keyword">new</span> List<span class="token operator">&lt;</span>StockObserver<span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">private</span> string action<span class="token punctuation">;</span>\n    <span class="token comment">//增加</span>\n    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">Attach</span><span class="token punctuation">(</span>StockObserver observer<span class="token punctuation">)</span>\n    <span class="token punctuation">{</span>\n        observers<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span>observer<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n    <span class="token comment">//减少</span>\n    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">Detach</span><span class="token punctuation">(</span>StockObserver observer<span class="token punctuation">)</span>\n    <span class="token punctuation">{</span>\n        observers<span class="token punctuation">.</span><span class="token function">Remove</span><span class="token punctuation">(</span>observer<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n    <span class="token comment">//通知</span>\n    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">Notify</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n    <span class="token punctuation">{</span>\n        foreach <span class="token punctuation">(</span>StockObserver o in observers<span class="token punctuation">)</span>\n            o<span class="token punctuation">.</span><span class="token function">Update</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n    <span class="token comment">//前台状态</span>\n    <span class="token keyword">public</span> string SecretaryAction\n    <span class="token punctuation">{</span>\n        get <span class="token punctuation">{</span> <span class="token keyword">return</span> action<span class="token punctuation">;</span> <span class="token punctuation">}</span>\n        set <span class="token punctuation">{</span> action <span class="token operator">=</span> value<span class="token punctuation">;</span> <span class="token punctuation">}</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n<span class="token comment">//看股票的同事</span>\n<span class="token keyword">class</span> <span class="token class-name">StockObserver</span>\n<span class="token punctuation">{</span>\n    <span class="token keyword">private</span> string name<span class="token punctuation">;</span>\n    <span class="token keyword">private</span> Secretary sub<span class="token punctuation">;</span>\n\n    <span class="token keyword">public</span> <span class="token function">StockObserver</span><span class="token punctuation">(</span>string name<span class="token punctuation">,</span> Secretary sub<span class="token punctuation">)</span>\n    <span class="token punctuation">{</span>\n        <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>\n        <span class="token keyword">this</span><span class="token punctuation">.</span>sub <span class="token operator">=</span> sub<span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n\n    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">Update</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n    <span class="token punctuation">{</span>\n        Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">"{0} {1} 关闭股票行情，继续工作！"</span><span class="token punctuation">,</span> sub<span class="token punctuation">.</span>SecretaryAction<span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n<span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">Main</span><span class="token punctuation">(</span>string<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span>\n<span class="token punctuation">{</span>\n    <span class="token comment">//前台秘书MM</span>\n    Secretary MM <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">Secretary</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token comment">//看股票的同事</span>\n    StockObserver tongshi1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">StockObserver</span><span class="token punctuation">(</span><span class="token string">"魏关姹"</span><span class="token punctuation">,</span> MM<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    StockObserver tongshi2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">StockObserver</span><span class="token punctuation">(</span><span class="token string">"易管查"</span><span class="token punctuation">,</span> MM<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token comment">//前台记下了两位同事</span>\n    MM<span class="token punctuation">.</span><span class="token function">Attach</span><span class="token punctuation">(</span>tongshi1<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    MM<span class="token punctuation">.</span><span class="token function">Attach</span><span class="token punctuation">(</span>tongshi2<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token comment">//发现老板回来</span>\n    MM<span class="token punctuation">.</span>SecretaryAction <span class="token operator">=</span> <span class="token string">"老板回来了！"</span><span class="token punctuation">;</span>\n    <span class="token comment">//通知两个同事</span>\n    MM<span class="token punctuation">.</span><span class="token function">Notify</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    Console<span class="token punctuation">.</span><span class="token function">Read</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>如果有人聊 QQ，有人看 NBA 都需要通知，如何修改？思考：违背了那些原则？</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="51282415790247260000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`//抽象观察者\nabstract class Observer\n{\n    protected string name;\n    protected Secretary sub;\n\n    public Observer(string name, Secretary sub)\n    {\n        this.name = name;\n        this.sub = sub;\n    }\n\n    public abstract void Update();\n}\n//看股票的同事\nclass StockObserver : Observer\n{\n    public StockObserver(string name, Secretary sub) : base(name, sub)\n    {\n    }\n    public override void Update()\n    {\n        Console.WriteLine(&quot;{0} {1} 关闭股票行情，继续工作！&quot;, sub.SecretaryAction, name);\n    }\n}\n\n//看NBA的同事\nclass NBAObserver : Observer\n{\n    public NBAObserver(string name, Secretary sub)  : base(name, sub)\n    {\n    }\n    public override void Update()\n    {\n        Console.WriteLine(&quot;{0} {1} 关闭NBA直播，继续工作！&quot;, sub.SecretaryAction, name);\n    }\n}\n\nclass Secretary    //前台秘书类\n{\n    //同事列表\n    private IList<Observer> observers = new List<Observer>();\n    private string action;\n\n    //增加\n    public void Attach(Observer observer)\n    {\n        observers.Add(observer);\n    }\n\n    //减少\n    public void Detach(Observer observer)\n    {\n        observers.Remove(observer);\n    }\n\n    //通知\n    public void Notify()\n    {\n        foreach (Observer o in observers)\n            o.Update();\n        …..\n    }\n}`, `51282415790247260000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                cpp 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="cpp"><pre style="counter-reset: linenumber NaN" class="language-cpp line-numbers"><code class="language-cpp"><span class="token comment">//抽象观察者</span>\nabstract <span class="token keyword">class</span> <span class="token class-name">Observer</span>\n<span class="token punctuation">{</span>\n    <span class="token keyword">protected</span> string name<span class="token punctuation">;</span>\n    <span class="token keyword">protected</span> Secretary sub<span class="token punctuation">;</span>\n\n    <span class="token keyword">public</span> <span class="token function">Observer</span><span class="token punctuation">(</span>string name<span class="token punctuation">,</span> Secretary sub<span class="token punctuation">)</span>\n    <span class="token punctuation">{</span>\n        <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>\n        <span class="token keyword">this</span><span class="token punctuation">.</span>sub <span class="token operator">=</span> sub<span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n\n    <span class="token keyword">public</span> abstract <span class="token keyword">void</span> <span class="token function">Update</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n<span class="token comment">//看股票的同事</span>\n<span class="token keyword">class</span> <span class="token class-name">StockObserver</span> <span class="token operator">:</span> Observer\n<span class="token punctuation">{</span>\n    <span class="token keyword">public</span> <span class="token function">StockObserver</span><span class="token punctuation">(</span>string name<span class="token punctuation">,</span> Secretary sub<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">base</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> sub<span class="token punctuation">)</span>\n    <span class="token punctuation">{</span>\n    <span class="token punctuation">}</span>\n    <span class="token keyword">public</span> override <span class="token keyword">void</span> <span class="token function">Update</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n    <span class="token punctuation">{</span>\n        Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">"{0} {1} 关闭股票行情，继续工作！"</span><span class="token punctuation">,</span> sub<span class="token punctuation">.</span>SecretaryAction<span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n\n<span class="token comment">//看NBA的同事</span>\n<span class="token keyword">class</span> <span class="token class-name">NBAObserver</span> <span class="token operator">:</span> Observer\n<span class="token punctuation">{</span>\n    <span class="token keyword">public</span> <span class="token function">NBAObserver</span><span class="token punctuation">(</span>string name<span class="token punctuation">,</span> Secretary sub<span class="token punctuation">)</span>  <span class="token operator">:</span> <span class="token function">base</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> sub<span class="token punctuation">)</span>\n    <span class="token punctuation">{</span>\n    <span class="token punctuation">}</span>\n    <span class="token keyword">public</span> override <span class="token keyword">void</span> <span class="token function">Update</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n    <span class="token punctuation">{</span>\n        Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">"{0} {1} 关闭NBA直播，继续工作！"</span><span class="token punctuation">,</span> sub<span class="token punctuation">.</span>SecretaryAction<span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">class</span> <span class="token class-name">Secretary</span>    <span class="token comment">//前台秘书类</span>\n<span class="token punctuation">{</span>\n    <span class="token comment">//同事列表</span>\n    <span class="token keyword">private</span> IList<span class="token operator">&lt;</span>Observer<span class="token operator">></span> observers <span class="token operator">=</span> <span class="token keyword">new</span> List<span class="token operator">&lt;</span>Observer<span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">private</span> string action<span class="token punctuation">;</span>\n\n    <span class="token comment">//增加</span>\n    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">Attach</span><span class="token punctuation">(</span>Observer observer<span class="token punctuation">)</span>\n    <span class="token punctuation">{</span>\n        observers<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span>observer<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n\n    <span class="token comment">//减少</span>\n    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">Detach</span><span class="token punctuation">(</span>Observer observer<span class="token punctuation">)</span>\n    <span class="token punctuation">{</span>\n        observers<span class="token punctuation">.</span><span class="token function">Remove</span><span class="token punctuation">(</span>observer<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n\n    <span class="token comment">//通知</span>\n    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">Notify</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n    <span class="token punctuation">{</span>\n        foreach <span class="token punctuation">(</span>Observer o in observers<span class="token punctuation">)</span>\n            o<span class="token punctuation">.</span><span class="token function">Update</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n        …<span class="token punctuation">.</span><span class="token punctuation">.</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>其实作为通知者，老板、秘书、所有人都可以成为通知者，应该抽象出来</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="71663053032426060000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`//通知者接口\ninterface Subject\n{\n    void Attach(Observer observer);\n    void Detach(Observer observer);\n    void Notify();\n    string SubjectState\n    {\n        get;\n        set;\n    }\n}\nclass Secretary : Subject\n{\n    //同事列表\n    private IList<Observer> observers = new List<Observer>();\n    private string action;\n    //增加\n    public void Attach(Observer observer)\n    {\n        observers.Add(observer);\n    }\n    //减少\n    public void Detach(Observer observer)\n    {\n        observers.Remove(observer);\n    }\n    //通知\n    public void Notify()\n    {\n        foreach (Observer o in observers)\n            o.Update();\n    }\n    //前台状态\n    public string SubjectState\n    {\n        get { return action; }\n        set { action = value; }\n    }\n}\nclass Boss : Subject\n{\n    //同事列表\n    private IList<Observer> observers = new List<Observer>();\n    private string action;\n    //增加\n    public void Attach(Observer observer)\n    {\n        observers.Add(observer);\n    }\n    //减少\n    public void Detach(Observer observer)\n    {\n        observers.Remove(observer);\n    }\n    //通知\n    public void Notify()\n    {\n        foreach (Observer o in observers)\n            o.Update();\n    }\n    //老板状态\n    public string SubjectState\n    {\n        get { return action; }\n        set { action = value; }\n    }\n}\nstatic void Main(string[] args)\n{\n    //老板胡汉三\n    Boss huhansan = new Boss();\n\n    //看股票的同事\n    StockObserver tongshi1 = new StockObserver(&quot;魏关姹&quot;, huhansan);\n    //看NBA的同事\n    NBAObserver tongshi2 = new NBAObserver(&quot;易管查&quot;, huhansan);\n\n    huhansan.Attach(tongshi1);\n    huhansan.Attach(tongshi2);\n\n    huhansan.Detach(tongshi1);\n\n    //老板回来\n    huhansan.SubjectState = &quot;我胡汉三回来了！&quot;;\n    //发出通知\n    huhansan.Notify();\n\n    Console.Read();\n}`, `71663053032426060000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                cpp 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="cpp"><pre style="counter-reset: linenumber NaN" class="language-cpp line-numbers"><code class="language-cpp"><span class="token comment">//通知者接口</span>\ninterface Subject\n<span class="token punctuation">{</span>\n    <span class="token keyword">void</span> <span class="token function">Attach</span><span class="token punctuation">(</span>Observer observer<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">void</span> <span class="token function">Detach</span><span class="token punctuation">(</span>Observer observer<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">void</span> <span class="token function">Notify</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    string SubjectState\n    <span class="token punctuation">{</span>\n        get<span class="token punctuation">;</span>\n        set<span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n<span class="token keyword">class</span> <span class="token class-name">Secretary</span> <span class="token operator">:</span> Subject\n<span class="token punctuation">{</span>\n    <span class="token comment">//同事列表</span>\n    <span class="token keyword">private</span> IList<span class="token operator">&lt;</span>Observer<span class="token operator">></span> observers <span class="token operator">=</span> <span class="token keyword">new</span> List<span class="token operator">&lt;</span>Observer<span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">private</span> string action<span class="token punctuation">;</span>\n    <span class="token comment">//增加</span>\n    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">Attach</span><span class="token punctuation">(</span>Observer observer<span class="token punctuation">)</span>\n    <span class="token punctuation">{</span>\n        observers<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span>observer<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n    <span class="token comment">//减少</span>\n    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">Detach</span><span class="token punctuation">(</span>Observer observer<span class="token punctuation">)</span>\n    <span class="token punctuation">{</span>\n        observers<span class="token punctuation">.</span><span class="token function">Remove</span><span class="token punctuation">(</span>observer<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n    <span class="token comment">//通知</span>\n    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">Notify</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n    <span class="token punctuation">{</span>\n        foreach <span class="token punctuation">(</span>Observer o in observers<span class="token punctuation">)</span>\n            o<span class="token punctuation">.</span><span class="token function">Update</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n    <span class="token comment">//前台状态</span>\n    <span class="token keyword">public</span> string SubjectState\n    <span class="token punctuation">{</span>\n        get <span class="token punctuation">{</span> <span class="token keyword">return</span> action<span class="token punctuation">;</span> <span class="token punctuation">}</span>\n        set <span class="token punctuation">{</span> action <span class="token operator">=</span> value<span class="token punctuation">;</span> <span class="token punctuation">}</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n<span class="token keyword">class</span> <span class="token class-name">Boss</span> <span class="token operator">:</span> Subject\n<span class="token punctuation">{</span>\n    <span class="token comment">//同事列表</span>\n    <span class="token keyword">private</span> IList<span class="token operator">&lt;</span>Observer<span class="token operator">></span> observers <span class="token operator">=</span> <span class="token keyword">new</span> List<span class="token operator">&lt;</span>Observer<span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">private</span> string action<span class="token punctuation">;</span>\n    <span class="token comment">//增加</span>\n    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">Attach</span><span class="token punctuation">(</span>Observer observer<span class="token punctuation">)</span>\n    <span class="token punctuation">{</span>\n        observers<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span>observer<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n    <span class="token comment">//减少</span>\n    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">Detach</span><span class="token punctuation">(</span>Observer observer<span class="token punctuation">)</span>\n    <span class="token punctuation">{</span>\n        observers<span class="token punctuation">.</span><span class="token function">Remove</span><span class="token punctuation">(</span>observer<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n    <span class="token comment">//通知</span>\n    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">Notify</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n    <span class="token punctuation">{</span>\n        foreach <span class="token punctuation">(</span>Observer o in observers<span class="token punctuation">)</span>\n            o<span class="token punctuation">.</span><span class="token function">Update</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n    <span class="token comment">//老板状态</span>\n    <span class="token keyword">public</span> string SubjectState\n    <span class="token punctuation">{</span>\n        get <span class="token punctuation">{</span> <span class="token keyword">return</span> action<span class="token punctuation">;</span> <span class="token punctuation">}</span>\n        set <span class="token punctuation">{</span> action <span class="token operator">=</span> value<span class="token punctuation">;</span> <span class="token punctuation">}</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n<span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">Main</span><span class="token punctuation">(</span>string<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span>\n<span class="token punctuation">{</span>\n    <span class="token comment">//老板胡汉三</span>\n    Boss huhansan <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">Boss</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token comment">//看股票的同事</span>\n    StockObserver tongshi1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">StockObserver</span><span class="token punctuation">(</span><span class="token string">"魏关姹"</span><span class="token punctuation">,</span> huhansan<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token comment">//看NBA的同事</span>\n    NBAObserver tongshi2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">NBAObserver</span><span class="token punctuation">(</span><span class="token string">"易管查"</span><span class="token punctuation">,</span> huhansan<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    huhansan<span class="token punctuation">.</span><span class="token function">Attach</span><span class="token punctuation">(</span>tongshi1<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    huhansan<span class="token punctuation">.</span><span class="token function">Attach</span><span class="token punctuation">(</span>tongshi2<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    huhansan<span class="token punctuation">.</span><span class="token function">Detach</span><span class="token punctuation">(</span>tongshi1<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token comment">//老板回来</span>\n    huhansan<span class="token punctuation">.</span>SubjectState <span class="token operator">=</span> <span class="token string">"我胡汉三回来了！"</span><span class="token punctuation">;</span>\n    <span class="token comment">//发出通知</span>\n    huhansan<span class="token punctuation">.</span><span class="token function">Notify</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    Console<span class="token punctuation">.</span><span class="token function">Read</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>\n  <a\n    class="gatsby-resp-image-link"\n    href="/static/微信截图_20180417181530-35ae6c87e5d3ea96792a9f7a1cb46c36-2b001.png"\n    style="display: block"\n    target="_blank"\n    rel="noopener"\n  >\n  \n  <span\n    class="gatsby-resp-image-wrapper"\n    style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;"\n  >\n    <span\n      class="gatsby-resp-image-background-image"\n      style="padding-bottom: 38.95169578622816%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAA7EAAAOxAGVKw4bAAABvklEQVQoz41SPUjCURB/pRaEWxEE4dBiiOXQVoODoUFITo0ugbQ5Nbo1NloUNDm5RIMNagkigojgN36h+K35LWmSabx+7/EfaokOHnfv7t7vfnf3SLVaFRFIpVIxdjqdz2Aw2E2lUsPBYPAKvc1ilNIFQTNF6vX6OmIGn89nyGazR+12m2Pk83lC0uk0vyQSifPRaERnsxllMplMKB7ssZhWq12GEptMpiUh96RcLtNisUhBZFwqlaTMDx8huVxOwi7RaPQ0mUy+dbvdDMDKvV6v5HK5lCym0+lWoCRqtZrnOp3OTa/Xewamx4FAwAhSYjAVhUIh8kv0ev2qYIrlcrn0Z8xsNi+S/wiQFWC2Y7fbVbVaTRGLxTbQggw+pc1mU6GtXbS+xXL9fr8sHo9fud3um0gkctlsNjVgZfV4PNeZTOaCzxjO9/F4TEGfz65QKNzD9jIb8/kS9JMAuI+R8DwUnwPcMp1O+R3zq3OGcA4Z4EzYRqPRuA2Hw8/z+ZzifDBfq9V6ZLlWq3UN7DQoqsXvOHA4HDL8Cg1IHaIAXyAB1SEeUFTigP1+/w5bfGEbnwrlYT+wXIvF8uccWcvfG09de25RYCwAAAAASUVORK5CYII=\'); background-size: cover; display: block;"\n    >\n      <img\n        class="gatsby-resp-image-image"\n        style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;"\n        alt="     20180417181530"\n        title=""\n        src="/static/微信截图_20180417181530-35ae6c87e5d3ea96792a9f7a1cb46c36-fee1c.png"\n        srcset="/static/微信截图_20180417181530-35ae6c87e5d3ea96792a9f7a1cb46c36-a67b7.png 200w,\n/static/微信截图_20180417181530-35ae6c87e5d3ea96792a9f7a1cb46c36-0b187.png 400w,\n/static/微信截图_20180417181530-35ae6c87e5d3ea96792a9f7a1cb46c36-fee1c.png 800w,\n/static/微信截图_20180417181530-35ae6c87e5d3ea96792a9f7a1cb46c36-2b001.png 973w"\n        sizes="(max-width: 800px) 100vw, 800px"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<h3 id="模式动机-1"><a href="#%E6%A8%A1%E5%BC%8F%E5%8A%A8%E6%9C%BA-1" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>模式动机</h3>\n<p>建立一种对象与对象之间的依赖关系，一个对象发生改变时将自动通知其他对象，其他对象将相应做出反应。在此，发生改变的对象称为观察目标，而被通知的对象称为观察者，一个观察目标可以对应多个观察者，而且这些观察者之间没有相互联系，可以根据需要增加和删除观察者，使得系统更易于扩展，这就是观察者模式的模式动机。</p>\n<h3 id="模式定义-1"><a href="#%E6%A8%A1%E5%BC%8F%E5%AE%9A%E4%B9%89-1" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>模式定义</h3>\n<ul>\n<li>观察者模式(Observer Pattern)：定义对象间的一种一对多依赖关系，使得每当一个对象状态发生改变时，其相关依赖对象皆得到通知并被自动更新。</li>\n<li>观察者模式又叫做发布-订阅（Publish/Subscribe）模式、模型-视图（Model/View）模式、源-监听器（Source/Listener）模式或从属者（Dependents）模式。观察者模式是一种对象行为型模式。</li>\n</ul>\n<h3 id="模式结构-1"><a href="#%E6%A8%A1%E5%BC%8F%E7%BB%93%E6%9E%84-1" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>模式结构</h3>\n<p>\n  <a\n    class="gatsby-resp-image-link"\n    href="/static/微信截图_20180417235401-b46b63c5eb92857dd412115bafda9746-6b9f0.png"\n    style="display: block"\n    target="_blank"\n    rel="noopener"\n  >\n  \n  <span\n    class="gatsby-resp-image-wrapper"\n    style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;"\n  >\n    <span\n      class="gatsby-resp-image-background-image"\n      style="padding-bottom: 56.75074183976261%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAABnWAAAZ1gEY0crtAAACIklEQVQoz31TOYhaURT96ozjZEwfBiYEglVAnMAEbCQhoAYEK7t0tpZikdaZImBlilSCaCEB0UIRRKKooIjgLiKC4664Rf24oN95uVfGj2OWC5d3//vnnbu886hyufyl2+3eZbNZYzqdNrbb7dt6vW6Mx+MvKTBCCHVscIYfjUaFyWTyIp/PCxOJhIDFAsEWArJarchiscCQMAxDgPADgnQ63SksXHSDwYAxVSqVbhuNxiSTydyD/arVaj9Ywmq1Ouj1eoSmaWa9Xm+A+GE2mzHhcPg9gqRS6TksZ+gqleoZ7hUKBcc+MVq/38+whJDtHjLQ0+mU3mw2CwBNlsvlpFKpvHsEcfat7tuPxWJyaPMulUrZWq3WV8B+Zv87HI4rv99/abVab+x2+yev1/vC6XS+MpvNWBWl0WiezC8YDHIOPp8fJzu2QzBls9nYWKvVsoewariYE5FIJICYC85jSWH4PNzQ6/V8uVx+gQDYOwkEArvDoVBot0IXVLFY3N8yx+128yQSiXA+n3MjkQjnf1WyZjKZ/tizWCx/xbJkoKM3uVxODLO5hqw38C2GIYtBi+f/SgQdXALurcvlQvw1XNJrlhT0NBsOh6TZbBKISafTIaPRiPh8vo8IUiqVeDmov1O1Wi14JPw+GAwIjICg5EAp0UMd9sfjMWqJAeItaHAL4AePx7MjlMlkWCkfXaFQ7KqGF/UNCeFRLPExQBE/94S/AURMi9jQ8g7/AAAAAElFTkSuQmCC\'); background-size: cover; display: block;"\n    >\n      <img\n        class="gatsby-resp-image-image"\n        style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;"\n        alt="     20180417235401"\n        title=""\n        src="/static/微信截图_20180417235401-b46b63c5eb92857dd412115bafda9746-fee1c.png"\n        srcset="/static/微信截图_20180417235401-b46b63c5eb92857dd412115bafda9746-a67b7.png 200w,\n/static/微信截图_20180417235401-b46b63c5eb92857dd412115bafda9746-0b187.png 400w,\n/static/微信截图_20180417235401-b46b63c5eb92857dd412115bafda9746-fee1c.png 800w,\n/static/微信截图_20180417235401-b46b63c5eb92857dd412115bafda9746-b1a91.png 1200w,\n/static/微信截图_20180417235401-b46b63c5eb92857dd412115bafda9746-6b9f0.png 1348w"\n        sizes="(max-width: 800px) 100vw, 800px"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<ul>\n<li>Subject：目标（被观察对象）</li>\n<li>ConcreteSubject：具体目标</li>\n<li>Observer：观察者</li>\n<li>ConcreteObserver：具体观察者</li>\n</ul>\n<p>注册的投资者在股票市场发生变化时，可以自动得到通知</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="97332117227600690000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`abstract class Stock\n{\n    // Fields\n    protected string symbol;\n    protected double price;\n    private ArrayList investors = new ArrayList();\n\n    // Constructor\n    public Stock( string symbol, double price )\n    {\n        this.symbol = symbol;\n        this.price = price;\n    }\n\n    // Properties\n    public double Price\n    {\n        get{ return price; }\n        set\n        {\n            price = value;\n            Notify();\n        }\n    }\n\n    public string Symbol\n    {\n        get{ return symbol; }\n        set{ symbol = value; }\n    }\n\n    // Methods\n    public void Attach( Investor investor )\n    {\n        investors.Add( investor );\n    }\n\n    public void Detach( Investor investor )\n    {\n        investors.Remove( investor );\n    }\n\n    public void Notify()\n    {\n        foreach( Investor i in investors )\n        i.Update( this );\n    }\n\n}\n\n\n// &quot;ConcreteSubject&quot;\nclass IBM : Stock\n{\n    // Constructor\n    public IBM( string symbol, double price )\n        : base( symbol, price ) {}\n}\n\n// &quot;Observer&quot;\ninterface IInvestor\n{\n    // Methods\n    void Update( Stock stock );\n}\n\n// &quot;ConcreteObserver&quot;\nclass Investor : IInvestor\n{\n    // Fields\n    private string name;\n    private string observerState;\n    private Stock stock;\n\n    // Constructors\n    public Investor( string name )\n    {\n        this.name = name;\n    }\n\n    // Methods\n    public void Update( Stock stock )\n    {\n        Console.WriteLine( &quot;Notified investor {0} of {1}\'s change to {2:C}&quot;,\n        name, stock.Symbol, stock.Price );\n    }\n\n    // Properties\n    public Stock Stock\n    {\n        get{ return stock; }\n        set{ stock = value; }\n    }\n}\n\npublic static void Main( string[] args )\n{\n    // Create investors\n    Investor s = new Investor( &quot;Sorros&quot; );\n    Investor b = new Investor( &quot;Berkshire&quot; );\n\n    // Create IBM stock and attach investors\n    IBM ibm = new IBM( &quot;IBM&quot;, 120.00 );\n    ibm.Attach( s );\n    ibm.Attach( b );\n\n    // Change price, which notifies investors\n    ibm.Price = 120.10;\n    ibm.Price = 121.00;\n    ibm.Price = 120.50;\n    ibm.Price = 120.75;\n}`, `97332117227600690000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                cpp 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="cpp"><pre style="counter-reset: linenumber NaN" class="language-cpp line-numbers"><code class="language-cpp">abstract <span class="token keyword">class</span> <span class="token class-name">Stock</span>\n<span class="token punctuation">{</span>\n    <span class="token comment">// Fields</span>\n    <span class="token keyword">protected</span> string symbol<span class="token punctuation">;</span>\n    <span class="token keyword">protected</span> <span class="token keyword">double</span> price<span class="token punctuation">;</span>\n    <span class="token keyword">private</span> ArrayList investors <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">ArrayList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token comment">// Constructor</span>\n    <span class="token keyword">public</span> <span class="token function">Stock</span><span class="token punctuation">(</span> string symbol<span class="token punctuation">,</span> <span class="token keyword">double</span> price <span class="token punctuation">)</span>\n    <span class="token punctuation">{</span>\n        <span class="token keyword">this</span><span class="token punctuation">.</span>symbol <span class="token operator">=</span> symbol<span class="token punctuation">;</span>\n        <span class="token keyword">this</span><span class="token punctuation">.</span>price <span class="token operator">=</span> price<span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n\n    <span class="token comment">// Properties</span>\n    <span class="token keyword">public</span> <span class="token keyword">double</span> Price\n    <span class="token punctuation">{</span>\n        get<span class="token punctuation">{</span> <span class="token keyword">return</span> price<span class="token punctuation">;</span> <span class="token punctuation">}</span>\n        set\n        <span class="token punctuation">{</span>\n            price <span class="token operator">=</span> value<span class="token punctuation">;</span>\n            <span class="token function">Notify</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token punctuation">}</span>\n    <span class="token punctuation">}</span>\n\n    <span class="token keyword">public</span> string Symbol\n    <span class="token punctuation">{</span>\n        get<span class="token punctuation">{</span> <span class="token keyword">return</span> symbol<span class="token punctuation">;</span> <span class="token punctuation">}</span>\n        set<span class="token punctuation">{</span> symbol <span class="token operator">=</span> value<span class="token punctuation">;</span> <span class="token punctuation">}</span>\n    <span class="token punctuation">}</span>\n\n    <span class="token comment">// Methods</span>\n    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">Attach</span><span class="token punctuation">(</span> Investor investor <span class="token punctuation">)</span>\n    <span class="token punctuation">{</span>\n        investors<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span> investor <span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n\n    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">Detach</span><span class="token punctuation">(</span> Investor investor <span class="token punctuation">)</span>\n    <span class="token punctuation">{</span>\n        investors<span class="token punctuation">.</span><span class="token function">Remove</span><span class="token punctuation">(</span> investor <span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n\n    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">Notify</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n    <span class="token punctuation">{</span>\n        <span class="token function">foreach</span><span class="token punctuation">(</span> Investor i in investors <span class="token punctuation">)</span>\n        i<span class="token punctuation">.</span><span class="token function">Update</span><span class="token punctuation">(</span> <span class="token keyword">this</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n\n<span class="token punctuation">}</span>\n\n\n<span class="token comment">// "ConcreteSubject"</span>\n<span class="token keyword">class</span> <span class="token class-name">IBM</span> <span class="token operator">:</span> Stock\n<span class="token punctuation">{</span>\n    <span class="token comment">// Constructor</span>\n    <span class="token keyword">public</span> <span class="token function">IBM</span><span class="token punctuation">(</span> string symbol<span class="token punctuation">,</span> <span class="token keyword">double</span> price <span class="token punctuation">)</span>\n        <span class="token operator">:</span> <span class="token function">base</span><span class="token punctuation">(</span> symbol<span class="token punctuation">,</span> price <span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n\n<span class="token comment">// "Observer"</span>\ninterface IInvestor\n<span class="token punctuation">{</span>\n    <span class="token comment">// Methods</span>\n    <span class="token keyword">void</span> <span class="token function">Update</span><span class="token punctuation">(</span> Stock stock <span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token comment">// "ConcreteObserver"</span>\n<span class="token keyword">class</span> <span class="token class-name">Investor</span> <span class="token operator">:</span> IInvestor\n<span class="token punctuation">{</span>\n    <span class="token comment">// Fields</span>\n    <span class="token keyword">private</span> string name<span class="token punctuation">;</span>\n    <span class="token keyword">private</span> string observerState<span class="token punctuation">;</span>\n    <span class="token keyword">private</span> Stock stock<span class="token punctuation">;</span>\n\n    <span class="token comment">// Constructors</span>\n    <span class="token keyword">public</span> <span class="token function">Investor</span><span class="token punctuation">(</span> string name <span class="token punctuation">)</span>\n    <span class="token punctuation">{</span>\n        <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n\n    <span class="token comment">// Methods</span>\n    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">Update</span><span class="token punctuation">(</span> Stock stock <span class="token punctuation">)</span>\n    <span class="token punctuation">{</span>\n        Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span> <span class="token string">"Notified investor {0} of {1}\'s change to {2:C}"</span><span class="token punctuation">,</span>\n        name<span class="token punctuation">,</span> stock<span class="token punctuation">.</span>Symbol<span class="token punctuation">,</span> stock<span class="token punctuation">.</span>Price <span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n\n    <span class="token comment">// Properties</span>\n    <span class="token keyword">public</span> Stock Stock\n    <span class="token punctuation">{</span>\n        get<span class="token punctuation">{</span> <span class="token keyword">return</span> stock<span class="token punctuation">;</span> <span class="token punctuation">}</span>\n        set<span class="token punctuation">{</span> stock <span class="token operator">=</span> value<span class="token punctuation">;</span> <span class="token punctuation">}</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">Main</span><span class="token punctuation">(</span> string<span class="token punctuation">[</span><span class="token punctuation">]</span> args <span class="token punctuation">)</span>\n<span class="token punctuation">{</span>\n    <span class="token comment">// Create investors</span>\n    Investor s <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">Investor</span><span class="token punctuation">(</span> <span class="token string">"Sorros"</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>\n    Investor b <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">Investor</span><span class="token punctuation">(</span> <span class="token string">"Berkshire"</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token comment">// Create IBM stock and attach investors</span>\n    IBM ibm <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">IBM</span><span class="token punctuation">(</span> <span class="token string">"IBM"</span><span class="token punctuation">,</span> <span class="token number">120.00</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>\n    ibm<span class="token punctuation">.</span><span class="token function">Attach</span><span class="token punctuation">(</span> s <span class="token punctuation">)</span><span class="token punctuation">;</span>\n    ibm<span class="token punctuation">.</span><span class="token function">Attach</span><span class="token punctuation">(</span> b <span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token comment">// Change price, which notifies investors</span>\n    ibm<span class="token punctuation">.</span>Price <span class="token operator">=</span> <span class="token number">120.10</span><span class="token punctuation">;</span>\n    ibm<span class="token punctuation">.</span>Price <span class="token operator">=</span> <span class="token number">121.00</span><span class="token punctuation">;</span>\n    ibm<span class="token punctuation">.</span>Price <span class="token operator">=</span> <span class="token number">120.50</span><span class="token punctuation">;</span>\n    ibm<span class="token punctuation">.</span>Price <span class="token operator">=</span> <span class="token number">120.75</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="模式分析"><a href="#%E6%A8%A1%E5%BC%8F%E5%88%86%E6%9E%90" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>模式分析</h3>\n<ul>\n<li>观察者模式描述了如何建立对象与对象之间的依赖关系，如何构造满足这种需求的系统。</li>\n<li>这一模式中的关键对象是观察目标和观察者，一个目标可以有任意数目的与之相依赖的观察者，一旦目标的状态发生改变，所有的观察者都将得到通知。</li>\n<li>作为对这个通知的响应，每个观察者都将即时更新自己的状态，以与目标状态同步，这种交互也称为发布-订阅(publish-subscribe)。目标是通知的发布者，它发出通知时并不需要知道谁是它的观察者，可以有任意数目的观察者订阅它并接收通知。</li>\n</ul>\n<h3 id="优缺点-1"><a href="#%E4%BC%98%E7%BC%BA%E7%82%B9-1" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>优缺点</h3>\n<ul>\n<li>优点</li>\n<li>观察者模式可以实现表示层和数据逻辑层的分离，并定义了稳定的消息更新传递机制，抽象了更新接口，使得可以有各种各样不同的表示层作为具体观察者角色。</li>\n<li>观察者模式在观察目标和观察者之间建立一个抽象的耦合。</li>\n<li>观察者模式支持广播通信。</li>\n<li>观察者模式符合“开闭原则”的要求。</li>\n<li>缺点</li>\n<li>如果一个观察目标对象有很多直接和间接的观察者的话，将所有的观察者都通知到会花费很多时间。</li>\n<li>如果在观察者和观察目标之间有循环依赖的话，观察目标会触发它们之间进行循环调用，可能导致系统崩溃。</li>\n<li>观察者模式没有相应的机制让观察者知道所观察的目标对象是怎么发生变化的，而仅仅只是知道观察目标发生了变化。</li>\n</ul>\n<h3 id="模式使用-1"><a href="#%E6%A8%A1%E5%BC%8F%E4%BD%BF%E7%94%A8-1" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>模式使用</h3>\n<ul>\n<li>一个抽象模型有两个方面，其中一个方面依赖于另一个方面。将这些方面封装在独立的对象中使它们可以各自独立地改变和复用。</li>\n<li>一个对象的改变将导致其他一个或多个对象也发生改变，而不知道具体有多少对象将发生改变，可以降低对象之间的耦合度。</li>\n<li>一个对象必须通知其他对象，而并不知道这些对象是谁。</li>\n<li>需要在系统中创建一个触发链，A 对象的行为将影响 B 对象，B 对象的行为将影响 C 对象……，可以使用观察者模式创建一种链式触发机制。</li>\n</ul>\n<h3 id="模式应用-1"><a href="#%E6%A8%A1%E5%BC%8F%E5%BA%94%E7%94%A8-1" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>模式应用</h3>\n<ul>\n<li>JDK1.1 版本及以后的各个版本中，事件处理模型采用基于观察者模式的委派事件模型(Delegation Event Model, DEM)。</li>\n<li>在 DEM 中，事件的发布者称为事件源(Event Source)，而订阅者叫做事件监听器(Event Listener)，在这个过程中还可以通过事件对象(Event Object)来传递与事件相关的信息，事件源对象、事件监听对象（事件处理对象）和事件对象构成了 Java 事件处理模型的三要素。</li>\n<li>观察者模式在软件开发中应用非常广泛，如某电子商务网站可以在执行发送操作后给用户多个发送商品打折信息，某团队战斗游戏中某队友牺牲将给所有成员提示等等，凡是涉及到一对一或者一对多的对象交互场景都可以使用观察者模式。</li>\n</ul>\n<h2 id="状态模式state"><a href="#%E7%8A%B6%E6%80%81%E6%A8%A1%E5%BC%8Fstate" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>状态模式(State)</h2>\n<p>当一个对象的内在状态改变时允许改变其行为，这个对象看起来像是改变了其类。</p>\n<h3 id="模式背景-2"><a href="#%E6%A8%A1%E5%BC%8F%E8%83%8C%E6%99%AF-2" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>模式背景</h3>\n<p>又要加班了?(工作状态函数)</p>\n<ul>\n<li>上午工作状态 ( h&#x3C;12 点 )</li>\n<li>中午工作状态 ( 12&#x3C;h&#x3C;13 点 )</li>\n<li>下午工作状态 ( 13&#x3C;h&#x3C;17 点 )</li>\n<li>晚间工作状态 ( 17&#x3C;h&#x3C;21 点 )</li>\n<li>睡眠状态 ( h>21 点 )</li>\n<li>下班状态</li>\n</ul>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="27739857780183130000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`public static void WriteProgram()\n{\n    if (Hour < 12)\n    {\n        Console.WriteLine(&quot;当前时间：{0}点 上午工作，精神百倍&quot;, Hour);\n    }\n    else if (Hour < 13)\n    {\n        Console.WriteLine(&quot;当前时间：{0}点 饿了，午饭；犯困，午休。&quot;, Hour);\n    }\n    else if (Hour < 17)\n    {\n        Console.WriteLine(&quot;当前时间：{0}点 下午状态还不错，继续努力&quot;, Hour);\n    }\n    else\n    {\n        if (WorkFinished)\n        {\n            Console.WriteLine(&quot;当前时间：{0}点 下班回家了&quot;, Hour);\n        }\n        else\n        {\n            if (Hour < 21)\n            {\n                Console.WriteLine(&quot;当前时间：{0}点 加班哦，疲累之极&quot;, Hour);\n            }\n            else\n            {\n                Console.WriteLine(&quot;当前时间：{0}点 不行了，睡着了。&quot;, Hour);\n            }\n        }\n    }\n}\n\nstatic int Hour = 0;\nstatic bool WorkFinished = false;\n\nstatic void Main(string[] args)\n{\n    Hour = 9;\n    WriteProgram();\n    Hour = 10;\n    WriteProgram();\n    Hour = 12;\n    WriteProgram();\n    Hour = 13;\n    WriteProgram();\n    Hour = 14;\n    WriteProgram();\n    Hour = 17;\n\n    WorkFinished = true; // false;\n\n    WriteProgram();\n    Hour = 19;\n    WriteProgram();\n    Hour = 22;\n    WriteProgram();\n\n    Console.Read();\n}`, `27739857780183130000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                cpp 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="cpp"><pre style="counter-reset: linenumber NaN" class="language-cpp line-numbers"><code class="language-cpp"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">WriteProgram</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n<span class="token punctuation">{</span>\n    <span class="token keyword">if</span> <span class="token punctuation">(</span>Hour <span class="token operator">&lt;</span> <span class="token number">12</span><span class="token punctuation">)</span>\n    <span class="token punctuation">{</span>\n        Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">"当前时间：{0}点 上午工作，精神百倍"</span><span class="token punctuation">,</span> Hour<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n    <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>Hour <span class="token operator">&lt;</span> <span class="token number">13</span><span class="token punctuation">)</span>\n    <span class="token punctuation">{</span>\n        Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">"当前时间：{0}点 饿了，午饭；犯困，午休。"</span><span class="token punctuation">,</span> Hour<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n    <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>Hour <span class="token operator">&lt;</span> <span class="token number">17</span><span class="token punctuation">)</span>\n    <span class="token punctuation">{</span>\n        Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">"当前时间：{0}点 下午状态还不错，继续努力"</span><span class="token punctuation">,</span> Hour<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n    <span class="token keyword">else</span>\n    <span class="token punctuation">{</span>\n        <span class="token keyword">if</span> <span class="token punctuation">(</span>WorkFinished<span class="token punctuation">)</span>\n        <span class="token punctuation">{</span>\n            Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">"当前时间：{0}点 下班回家了"</span><span class="token punctuation">,</span> Hour<span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token punctuation">}</span>\n        <span class="token keyword">else</span>\n        <span class="token punctuation">{</span>\n            <span class="token keyword">if</span> <span class="token punctuation">(</span>Hour <span class="token operator">&lt;</span> <span class="token number">21</span><span class="token punctuation">)</span>\n            <span class="token punctuation">{</span>\n                Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">"当前时间：{0}点 加班哦，疲累之极"</span><span class="token punctuation">,</span> Hour<span class="token punctuation">)</span><span class="token punctuation">;</span>\n            <span class="token punctuation">}</span>\n            <span class="token keyword">else</span>\n            <span class="token punctuation">{</span>\n                Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">"当前时间：{0}点 不行了，睡着了。"</span><span class="token punctuation">,</span> Hour<span class="token punctuation">)</span><span class="token punctuation">;</span>\n            <span class="token punctuation">}</span>\n        <span class="token punctuation">}</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">static</span> <span class="token keyword">int</span> Hour <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>\n<span class="token keyword">static</span> <span class="token keyword">bool</span> WorkFinished <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>\n\n<span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">Main</span><span class="token punctuation">(</span>string<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span>\n<span class="token punctuation">{</span>\n    Hour <span class="token operator">=</span> <span class="token number">9</span><span class="token punctuation">;</span>\n    <span class="token function">WriteProgram</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    Hour <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>\n    <span class="token function">WriteProgram</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    Hour <span class="token operator">=</span> <span class="token number">12</span><span class="token punctuation">;</span>\n    <span class="token function">WriteProgram</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    Hour <span class="token operator">=</span> <span class="token number">13</span><span class="token punctuation">;</span>\n    <span class="token function">WriteProgram</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    Hour <span class="token operator">=</span> <span class="token number">14</span><span class="token punctuation">;</span>\n    <span class="token function">WriteProgram</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    Hour <span class="token operator">=</span> <span class="token number">17</span><span class="token punctuation">;</span>\n\n    WorkFinished <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span> <span class="token comment">// false;</span>\n\n    <span class="token function">WriteProgram</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    Hour <span class="token operator">=</span> <span class="token number">19</span><span class="token punctuation">;</span>\n    <span class="token function">WriteProgram</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    Hour <span class="token operator">=</span> <span class="token number">22</span><span class="token punctuation">;</span>\n    <span class="token function">WriteProgram</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    Console<span class="token punctuation">.</span><span class="token function">Read</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>面向过程的思维，通过面向对象完成代码的责任分解</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="58726651118907605000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`public class Work   //工作\n{\n    //钟点\n    private int hour;\n    public int Hour\n    {\n        get { return hour; }\n        set { hour = value; }\n    }\n\n    //任务完成\n    private bool finish = false;\n    public bool TaskFinished\n    {\n        get { return finish; }\n        set { finish = value; }\n    }\n\n\n    public void WriteProgram()\n    {\n        ……\n    }\n}\n\nstatic void Main(string[] args)\n{\n    Work MisProject = new Work();\n    MisProject.Hour = 10;\n    MisProject.WriteProgram();\n\n    Work MisProject = new Work();\n    MisProject.Hour = 13;\n    MisProject.WriteProgram();\n\n    Work MisProject = new Work();\n    MisProject.Hour = 16;\n    MisProject.WriteProgram();\n\n    Console.Read();\n}`, `58726651118907605000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                cpp 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="cpp"><pre style="counter-reset: linenumber NaN" class="language-cpp line-numbers"><code class="language-cpp"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Work</span>   <span class="token comment">//工作</span>\n<span class="token punctuation">{</span>\n    <span class="token comment">//钟点</span>\n    <span class="token keyword">private</span> <span class="token keyword">int</span> hour<span class="token punctuation">;</span>\n    <span class="token keyword">public</span> <span class="token keyword">int</span> Hour\n    <span class="token punctuation">{</span>\n        get <span class="token punctuation">{</span> <span class="token keyword">return</span> hour<span class="token punctuation">;</span> <span class="token punctuation">}</span>\n        set <span class="token punctuation">{</span> hour <span class="token operator">=</span> value<span class="token punctuation">;</span> <span class="token punctuation">}</span>\n    <span class="token punctuation">}</span>\n\n    <span class="token comment">//任务完成</span>\n    <span class="token keyword">private</span> <span class="token keyword">bool</span> finish <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>\n    <span class="token keyword">public</span> <span class="token keyword">bool</span> TaskFinished\n    <span class="token punctuation">{</span>\n        get <span class="token punctuation">{</span> <span class="token keyword">return</span> finish<span class="token punctuation">;</span> <span class="token punctuation">}</span>\n        set <span class="token punctuation">{</span> finish <span class="token operator">=</span> value<span class="token punctuation">;</span> <span class="token punctuation">}</span>\n    <span class="token punctuation">}</span>\n\n\n    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">WriteProgram</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n    <span class="token punctuation">{</span>\n        ……\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">Main</span><span class="token punctuation">(</span>string<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span>\n<span class="token punctuation">{</span>\n    Work MisProject <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">Work</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    MisProject<span class="token punctuation">.</span>Hour <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>\n    MisProject<span class="token punctuation">.</span><span class="token function">WriteProgram</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    Work MisProject <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">Work</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    MisProject<span class="token punctuation">.</span>Hour <span class="token operator">=</span> <span class="token number">13</span><span class="token punctuation">;</span>\n    MisProject<span class="token punctuation">.</span><span class="token function">WriteProgram</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    Work MisProject <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">Work</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    MisProject<span class="token punctuation">.</span>Hour <span class="token operator">=</span> <span class="token number">16</span><span class="token punctuation">;</span>\n    MisProject<span class="token punctuation">.</span><span class="token function">WriteProgram</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    Console<span class="token punctuation">.</span><span class="token function">Read</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>过多的判断分支，说明类的责任过大，无论何种状态改变，都需要通过它来改变，违背的原则？</p>\n<h3 id="模式动机-2"><a href="#%E6%A8%A1%E5%BC%8F%E5%8A%A8%E6%9C%BA-2" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>模式动机</h3>\n<ul>\n<li>在很多情况下，一个对象的行为取决于一个或多个动态变化的属性，这样的属性叫做状态，这样的对象叫做有状态的(stateful)对象。这样的对象状态是从事先定义好的一系列值中取出的。当一个这样的对象与外部事件产生互动时，其内部状态就会改变，从而使得系统的行为也随之发生变化。</li>\n<li>考虑一个银行系统，一个账户对象的状态处于若干个不同状态之一：开户状态、正常状态、透支状态、冻结状态。当顾客在对账户进行存取款操作时，账户类根据自身的当前状态作出不同的反应，同时进行对象状态的切换。例如：如果账户处于冻结状态就没有办法再进行取款操作，一个取款操作需要先了解账户对象的状态。</li>\n<li>状态(State)模式描述了账户如何在每一种状态下表现出不同的行为。而一旦取款操作完成，对象的状态也将动态发生变化，如取款后账户余额低于某一值其状态可能从正常状态转为透支状态。</li>\n<li>状态模式的关键是引入了一个抽象类来专门表示对象的状态，这个类我们叫做状态类，而对象的具体状态都继承了该类，并在不同具体状态类中实现了不同状态的行为，包括各种状态之间的转换。</li>\n</ul>\n<h3 id="模式定义-2"><a href="#%E6%A8%A1%E5%BC%8F%E5%AE%9A%E4%B9%89-2" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>模式定义</h3>\n<p>允许一个对象在其内部状态改变时改变它的行为，对象看起来似乎修改了它的类。其别名为状态对象(Objects for States)。状态模式是一种对象行为型模式。</p>\n<p>当一个对象的行为取决于它的状态，并且在运行时需要根据状态改变行为的时候，将特定状态的相关行为放到一个对象中，可以通过定义新的子类增加新的状态和转换。</p>\n<p>\n  <a\n    class="gatsby-resp-image-link"\n    href="/static/微信截图_20180418005947-f4c2c5868f9f38a32fbcf5e7f847099e-1b1db.png"\n    style="display: block"\n    target="_blank"\n    rel="noopener"\n  >\n  \n  <span\n    class="gatsby-resp-image-wrapper"\n    style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;"\n  >\n    <span\n      class="gatsby-resp-image-background-image"\n      style="padding-bottom: 48.0911330049261%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAABnWAAAZ1gEY0crtAAACC0lEQVQoz4VSS4uSURj+ymaQr7USZCCF0CJwoIXgokWLIQxaCCIlGUFQMUwSJC6FNtFlk/0AazWElPqFixDcKSjexSveBRVvhUwpeDk979c3w0w1dOBwzvuc8z7neZ/3cP1+/02xWHw5GAzeJpPJaxxGJBI5zf1jMMZOcf8bq9WKHYx8Pv+cML1eLzcYDPJGo3Enl8s9KJVKO9Vq9eoBKc/zJxMiic1mM5GwUCg8JkytVvNGo/Fcp9M5fKzdbr+js8VisWE2mzmbzcYpFIq/CUnBZDK5PxqNHqL0y4TpdDpZOBzmM5nMKzzyFecCyG9JCmWYtB5yaDSakxVrtdqzWDaOQBSTp2cwZX9c31QqlccxNOMDPPqIhnxB+TbCstnsNhR9SqfTe9h/hsobhHe73d1ms+mD+j3kvXe73Sp6hHxVqVS/CafTKVsul6JPIBEIK5fLjyiGXyKOhuxIfvsoXq/XbD6fM0EQLh4VFwqFOC4Wi92Fd9Zer7ebSCTuWSwWldfrNUCFHY243Wq17H6//6bJZDofDAat8Xj8Ce5aa7Wa3eVybTkcjkv4ZhecTufxL5VKpa6gjG8o6ScSGMp7RjgIn2LP6vX6D1TwHfGWZJWPfgiIl9i3AoGAXCSCqk1ao9HodShdI2mfLKhUKq8lP1/QA8PhcB+JDPe3pd8RRgVsPB4vsbY9Ho9I+AunwHHTBYoBpQAAAABJRU5ErkJggg==\'); background-size: cover; display: block;"\n    >\n      <img\n        class="gatsby-resp-image-image"\n        style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;"\n        alt="     20180418005947"\n        title=""\n        src="/static/微信截图_20180418005947-f4c2c5868f9f38a32fbcf5e7f847099e-fee1c.png"\n        srcset="/static/微信截图_20180418005947-f4c2c5868f9f38a32fbcf5e7f847099e-a67b7.png 200w,\n/static/微信截图_20180418005947-f4c2c5868f9f38a32fbcf5e7f847099e-0b187.png 400w,\n/static/微信截图_20180418005947-f4c2c5868f9f38a32fbcf5e7f847099e-fee1c.png 800w,\n/static/微信截图_20180418005947-f4c2c5868f9f38a32fbcf5e7f847099e-b1a91.png 1200w,\n/static/微信截图_20180418005947-f4c2c5868f9f38a32fbcf5e7f847099e-95179.png 1600w,\n/static/微信截图_20180418005947-f4c2c5868f9f38a32fbcf5e7f847099e-1b1db.png 1624w"\n        sizes="(max-width: 800px) 100vw, 800px"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="22719571666989660000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`public class Work    //工作\n{\n    private State current;\n    public Work()\n    {\n        current = new ForenoonState();\n    }\n\n    private double hour;\n    public double Hour\n    {\n        get { return hour; }\n        set { hour = value; }\n    }\n\n    private bool finish = false;\n    public bool TaskFinished\n    {\n        get { return finish; }\n        set { finish = value; }\n    }\n\n    public void SetState(State s)\n    {\n        current = s;\n    }\n\n    public void WordHard()\n    {\n        current.WriteProgram(this);\n    }\n}\n\npublic abstract class State     //抽象状态\n{\n    public abstract void WriteProgram(Work w);\n}\npublic class ForenoonState : State     //上午工作状态\n{\n    public override void WriteProgram(Work w)\n    {\n        if (w.Hour < 12)\n        {\n            Console.WriteLine(&quot;当前时间：{0}点 上午工作，精神百倍&quot;, w.Hour);\n        }\n        else\n        {\n            w.SetState(new NoonState());\n            w.WorkHard();\n        }\n    }\n}\npublic class NoonState : State     //中午工作状态\n{\n    public override void WriteProgram(Work w)\n    {\n        if (w.Hour < 13)\n        {\n            Console.WriteLine(&quot;当前时间：{0}点 饿了，午饭；犯困，午休。&quot;, w.Hour);\n        }\n        else\n        {\n            w.SetState(new AfternoonState());\n            w.WorkHard();\n        }\n    }\n}\n\nstatic void Main(string[] args)\n{\n    //紧急项目\n    Work EmProject = new Work();\n    EmProject.Hour = 9;\n    EmProject.WorkHard();\n    EmProject.Hour = 10;\n    EmProject.WorkHard();\n    EmProject.Hour = 12;\n    EmProject.WorkHard();\n    EmProject.Hour = 13;\n    EmProject.WorkHard();\n    EmProject.Hour = 14;\n    EmProject.WorkHard();\n    EmProject.Hour = 17;\n\n    EmProject.TaskFinished = true;\n    // EmProject.TaskFinished = false;\n\n    EmProject.WriteProgram();\n    EmProject.Hour = 19;\n    EmProject.WriteProgram();\n    EmProject.Hour = 22;\n    EmProject.WriteProgram();\n\n    Console.Read();\n}`, `22719571666989660000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                cpp 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="cpp"><pre style="counter-reset: linenumber NaN" class="language-cpp line-numbers"><code class="language-cpp"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Work</span>    <span class="token comment">//工作</span>\n<span class="token punctuation">{</span>\n    <span class="token keyword">private</span> State current<span class="token punctuation">;</span>\n    <span class="token keyword">public</span> <span class="token function">Work</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n    <span class="token punctuation">{</span>\n        current <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">ForenoonState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n\n    <span class="token keyword">private</span> <span class="token keyword">double</span> hour<span class="token punctuation">;</span>\n    <span class="token keyword">public</span> <span class="token keyword">double</span> Hour\n    <span class="token punctuation">{</span>\n        get <span class="token punctuation">{</span> <span class="token keyword">return</span> hour<span class="token punctuation">;</span> <span class="token punctuation">}</span>\n        set <span class="token punctuation">{</span> hour <span class="token operator">=</span> value<span class="token punctuation">;</span> <span class="token punctuation">}</span>\n    <span class="token punctuation">}</span>\n\n    <span class="token keyword">private</span> <span class="token keyword">bool</span> finish <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>\n    <span class="token keyword">public</span> <span class="token keyword">bool</span> TaskFinished\n    <span class="token punctuation">{</span>\n        get <span class="token punctuation">{</span> <span class="token keyword">return</span> finish<span class="token punctuation">;</span> <span class="token punctuation">}</span>\n        set <span class="token punctuation">{</span> finish <span class="token operator">=</span> value<span class="token punctuation">;</span> <span class="token punctuation">}</span>\n    <span class="token punctuation">}</span>\n\n    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">SetState</span><span class="token punctuation">(</span>State s<span class="token punctuation">)</span>\n    <span class="token punctuation">{</span>\n        current <span class="token operator">=</span> s<span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n\n    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">WordHard</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n    <span class="token punctuation">{</span>\n        current<span class="token punctuation">.</span><span class="token function">WriteProgram</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">public</span> abstract <span class="token keyword">class</span> <span class="token class-name">State</span>     <span class="token comment">//抽象状态</span>\n<span class="token punctuation">{</span>\n    <span class="token keyword">public</span> abstract <span class="token keyword">void</span> <span class="token function">WriteProgram</span><span class="token punctuation">(</span>Work w<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ForenoonState</span> <span class="token operator">:</span> State     <span class="token comment">//上午工作状态</span>\n<span class="token punctuation">{</span>\n    <span class="token keyword">public</span> override <span class="token keyword">void</span> <span class="token function">WriteProgram</span><span class="token punctuation">(</span>Work w<span class="token punctuation">)</span>\n    <span class="token punctuation">{</span>\n        <span class="token keyword">if</span> <span class="token punctuation">(</span>w<span class="token punctuation">.</span>Hour <span class="token operator">&lt;</span> <span class="token number">12</span><span class="token punctuation">)</span>\n        <span class="token punctuation">{</span>\n            Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">"当前时间：{0}点 上午工作，精神百倍"</span><span class="token punctuation">,</span> w<span class="token punctuation">.</span>Hour<span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token punctuation">}</span>\n        <span class="token keyword">else</span>\n        <span class="token punctuation">{</span>\n            w<span class="token punctuation">.</span><span class="token function">SetState</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token function">NoonState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n            w<span class="token punctuation">.</span><span class="token function">WorkHard</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token punctuation">}</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">NoonState</span> <span class="token operator">:</span> State     <span class="token comment">//中午工作状态</span>\n<span class="token punctuation">{</span>\n    <span class="token keyword">public</span> override <span class="token keyword">void</span> <span class="token function">WriteProgram</span><span class="token punctuation">(</span>Work w<span class="token punctuation">)</span>\n    <span class="token punctuation">{</span>\n        <span class="token keyword">if</span> <span class="token punctuation">(</span>w<span class="token punctuation">.</span>Hour <span class="token operator">&lt;</span> <span class="token number">13</span><span class="token punctuation">)</span>\n        <span class="token punctuation">{</span>\n            Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">"当前时间：{0}点 饿了，午饭；犯困，午休。"</span><span class="token punctuation">,</span> w<span class="token punctuation">.</span>Hour<span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token punctuation">}</span>\n        <span class="token keyword">else</span>\n        <span class="token punctuation">{</span>\n            w<span class="token punctuation">.</span><span class="token function">SetState</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token function">AfternoonState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n            w<span class="token punctuation">.</span><span class="token function">WorkHard</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token punctuation">}</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">Main</span><span class="token punctuation">(</span>string<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span>\n<span class="token punctuation">{</span>\n    <span class="token comment">//紧急项目</span>\n    Work EmProject <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">Work</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    EmProject<span class="token punctuation">.</span>Hour <span class="token operator">=</span> <span class="token number">9</span><span class="token punctuation">;</span>\n    EmProject<span class="token punctuation">.</span><span class="token function">WorkHard</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    EmProject<span class="token punctuation">.</span>Hour <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>\n    EmProject<span class="token punctuation">.</span><span class="token function">WorkHard</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    EmProject<span class="token punctuation">.</span>Hour <span class="token operator">=</span> <span class="token number">12</span><span class="token punctuation">;</span>\n    EmProject<span class="token punctuation">.</span><span class="token function">WorkHard</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    EmProject<span class="token punctuation">.</span>Hour <span class="token operator">=</span> <span class="token number">13</span><span class="token punctuation">;</span>\n    EmProject<span class="token punctuation">.</span><span class="token function">WorkHard</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    EmProject<span class="token punctuation">.</span>Hour <span class="token operator">=</span> <span class="token number">14</span><span class="token punctuation">;</span>\n    EmProject<span class="token punctuation">.</span><span class="token function">WorkHard</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    EmProject<span class="token punctuation">.</span>Hour <span class="token operator">=</span> <span class="token number">17</span><span class="token punctuation">;</span>\n\n    EmProject<span class="token punctuation">.</span>TaskFinished <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>\n    <span class="token comment">// EmProject.TaskFinished = false;</span>\n\n    EmProject<span class="token punctuation">.</span><span class="token function">WriteProgram</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    EmProject<span class="token punctuation">.</span>Hour <span class="token operator">=</span> <span class="token number">19</span><span class="token punctuation">;</span>\n    EmProject<span class="token punctuation">.</span><span class="token function">WriteProgram</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    EmProject<span class="token punctuation">.</span>Hour <span class="token operator">=</span> <span class="token number">22</span><span class="token punctuation">;</span>\n    EmProject<span class="token punctuation">.</span><span class="token function">WriteProgram</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    Console<span class="token punctuation">.</span><span class="token function">Read</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="模式结构-2"><a href="#%E6%A8%A1%E5%BC%8F%E7%BB%93%E6%9E%84-2" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>模式结构</h3>\n<p>\n  <a\n    class="gatsby-resp-image-link"\n    href="/static/微信截图_20180418010557-88e4305f385fb56b94aec29229f83098-e38b7.png"\n    style="display: block"\n    target="_blank"\n    rel="noopener"\n  >\n  \n  <span\n    class="gatsby-resp-image-wrapper"\n    style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;"\n  >\n    <span\n      class="gatsby-resp-image-background-image"\n      style="padding-bottom: 37.688734030197445%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAABnWAAAZ1gEY0crtAAABqklEQVQoz41STUsCURQddbKaVYtyEUEt2lVQrQpc5S9x6y4XhrRx0YhluRUMEy2khUgIbkRNXKijOYr4MSoKfqKIhiaChU33TTqLkOrA8A7vDOfcd+/Fms2mPZFI3JfL5YdWq/VIUdQeNoXP51tpNBq3xWLRXigU7MDv/H7/BtLC4bAAmwf2B4LBoGqmqdXq3X6/z2uTyYQFo32kQbBwrmEul/NVq1VPu9321Gq150gkIp1pNpttLR6POzOZDFWpVF7q9fpTIBDYmhaC/QUBQRBChUIhMhqNYqVSictkMhESNBrNJkmS24hLpVJcLpfjer1+0WQyifP5PJ5Op3Gn0/nt0uv1fgsR/vOOA2/q9XoX4GmnNE1fwZMvIPEmmUyeuN1uSTab1YGmjcViWjgv4Z91OI9SqdR1NBolgeuAq8CM4J2tVusy9LGFGj8cDrkBlEolvcvlOkB8PB5zHwIEHcPEzxAfjUbcHWzKm8PhkPCGBoNhCZJpMHkHsTcYDFjozbnZbN5hGOYDVmrQ6XT6sDafUNFhKBRSwCqxUMRrt9sdwzAZi8Wyiry+AMzBM2zXAhZgAAAAAElFTkSuQmCC\'); background-size: cover; display: block;"\n    >\n      <img\n        class="gatsby-resp-image-image"\n        style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;"\n        alt="     20180418010557"\n        title=""\n        src="/static/微信截图_20180418010557-88e4305f385fb56b94aec29229f83098-fee1c.png"\n        srcset="/static/微信截图_20180418010557-88e4305f385fb56b94aec29229f83098-a67b7.png 200w,\n/static/微信截图_20180418010557-88e4305f385fb56b94aec29229f83098-0b187.png 400w,\n/static/微信截图_20180418010557-88e4305f385fb56b94aec29229f83098-fee1c.png 800w,\n/static/微信截图_20180418010557-88e4305f385fb56b94aec29229f83098-b1a91.png 1200w,\n/static/微信截图_20180418010557-88e4305f385fb56b94aec29229f83098-95179.png 1600w,\n/static/微信截图_20180418010557-88e4305f385fb56b94aec29229f83098-e38b7.png 1722w"\n        sizes="(max-width: 800px) 100vw, 800px"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<ul>\n<li>Context：环境类</li>\n<li>State：抽象状态类</li>\n<li>ConcreteState：具体状态类</li>\n</ul>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="90855064198767030000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`public class Context\n{\n    private State state;\n\n    public Context(State state)\n    {\n        this.state = state;\n    }\n\n    public State State\n    {\n        get { return state; }\n        set { state = value; }\n    }\n\n    public void Request()\n    {\n        state.Handle(this);\n    }\n}\npublic abstract class State\n{\n    public abstract void Handle(Context context);\n}\npublic class ConcreteStateA : State\n{\n    public override void Handle(Context context)\n    {\n        Console.WriteLine(&quot;当前状态是 A.&quot;);\n        context.State = new ConcreteStateB();\n    }\n}\n\npublic class ConcreteStateB : State\n{\n    public override void Handle(Context context)\n    {\n        Console.WriteLine(&quot;当前状态是 B.&quot;);\n        context.State = new ConcreteStateA();\n    }\n}\n\nclass Program\n{\n    static void Main(string[] args)\n    {\n        // 设置Context的初始状态为ConcreteStateA\n        Context context = new Context(new ConcreteStateA());\n\n        // 不断地进行请求，同时更改状态\n        context.Request();\n        context.Request();\n        context.Request();\n        context.Request();\n\n        Console.Read();\n    }\n}`, `90855064198767030000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                cpp 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="cpp"><pre style="counter-reset: linenumber NaN" class="language-cpp line-numbers"><code class="language-cpp"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Context</span>\n<span class="token punctuation">{</span>\n    <span class="token keyword">private</span> State state<span class="token punctuation">;</span>\n\n    <span class="token keyword">public</span> <span class="token function">Context</span><span class="token punctuation">(</span>State state<span class="token punctuation">)</span>\n    <span class="token punctuation">{</span>\n        <span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> state<span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n\n    <span class="token keyword">public</span> State State\n    <span class="token punctuation">{</span>\n        get <span class="token punctuation">{</span> <span class="token keyword">return</span> state<span class="token punctuation">;</span> <span class="token punctuation">}</span>\n        set <span class="token punctuation">{</span> state <span class="token operator">=</span> value<span class="token punctuation">;</span> <span class="token punctuation">}</span>\n    <span class="token punctuation">}</span>\n\n    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">Request</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n    <span class="token punctuation">{</span>\n        state<span class="token punctuation">.</span><span class="token function">Handle</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n<span class="token keyword">public</span> abstract <span class="token keyword">class</span> <span class="token class-name">State</span>\n<span class="token punctuation">{</span>\n    <span class="token keyword">public</span> abstract <span class="token keyword">void</span> <span class="token function">Handle</span><span class="token punctuation">(</span>Context context<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ConcreteStateA</span> <span class="token operator">:</span> State\n<span class="token punctuation">{</span>\n    <span class="token keyword">public</span> override <span class="token keyword">void</span> <span class="token function">Handle</span><span class="token punctuation">(</span>Context context<span class="token punctuation">)</span>\n    <span class="token punctuation">{</span>\n        Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">"当前状态是 A."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n        context<span class="token punctuation">.</span>State <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">ConcreteStateB</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ConcreteStateB</span> <span class="token operator">:</span> State\n<span class="token punctuation">{</span>\n    <span class="token keyword">public</span> override <span class="token keyword">void</span> <span class="token function">Handle</span><span class="token punctuation">(</span>Context context<span class="token punctuation">)</span>\n    <span class="token punctuation">{</span>\n        Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">"当前状态是 B."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n        context<span class="token punctuation">.</span>State <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">ConcreteStateA</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">class</span> <span class="token class-name">Program</span>\n<span class="token punctuation">{</span>\n    <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">Main</span><span class="token punctuation">(</span>string<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span>\n    <span class="token punctuation">{</span>\n        <span class="token comment">// 设置Context的初始状态为ConcreteStateA</span>\n        Context context <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">Context</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token function">ConcreteStateA</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n        <span class="token comment">// 不断地进行请求，同时更改状态</span>\n        context<span class="token punctuation">.</span><span class="token function">Request</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n        context<span class="token punctuation">.</span><span class="token function">Request</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n        context<span class="token punctuation">.</span><span class="token function">Request</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n        context<span class="token punctuation">.</span><span class="token function">Request</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n        Console<span class="token punctuation">.</span><span class="token function">Read</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="模式应用-2"><a href="#%E6%A8%A1%E5%BC%8F%E5%BA%94%E7%94%A8-2" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>模式应用</h3>\n<ul>\n<li>灯泡的开与关</li>\n<li>qq 在线状态</li>\n<li>文档编辑器状态切换</li>\n<li>工作流系统</li>\n<li>游戏开发</li>\n</ul>\n<h3 id="优缺点-2"><a href="#%E4%BC%98%E7%BC%BA%E7%82%B9-2" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>优缺点</h3>\n<ul>\n<li>\n<p>优点</p>\n<ul>\n<li>封装转换过程，也就是转换规则。</li>\n<li>枚举可能的状态，因此，需要事先确定状态种类。</li>\n<li>将所有与某个状态有关的行为放到一个对象里。</li>\n<li>允许状态转换逻辑与状态对象合成一体，而不是某一个巨大的条件语句块或 switch 语句。</li>\n<li>避免了状态的不一致性，因为状态的改变只使用一个状态对象而不是几个对象或属性。</li>\n</ul>\n</li>\n<li>\n<p>缺点</p>\n<ul>\n<li>状态模式的使用必然会增加系统类和对象的个数。</li>\n</ul>\n</li>\n</ul>\n<h3 id="模式使用-2"><a href="#%E6%A8%A1%E5%BC%8F%E4%BD%BF%E7%94%A8-2" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>模式使用</h3>\n<ul>\n<li>对象的行为依赖于它的状态（属性）并且它必须可以根据它的状态改变而改变它的相关行为。</li>\n<li>操作的很多部分都带有与对象状态有关的大量条件语句，大量条件语句的出现，会导致代码的可维护性和灵活性变差，不能方便地增加删除状态，使客户类与类库之间的耦合增强。</li>\n</ul>\n<h2 id="策略模式strategy"><a href="#%E7%AD%96%E7%95%A5%E6%A8%A1%E5%BC%8Fstrategy" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>策略模式(Strategy)</h2>\n<p>定义一系列的算法,把它们一个个封装起来,并且使它们可相互替换。</p>\n<h3 id="模式背景-3"><a href="#%E6%A8%A1%E5%BC%8F%E8%83%8C%E6%99%AF-3" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>模式背景</h3>\n<p>周郎妙计安天下，赔了夫人又折兵</p>\n<ul>\n<li>第一个锦囊：找乔国老帮忙，让吴国太给孙权施加压力</li>\n<li>第二个锦囊：刘备乐不思蜀，谎报曹操要报赤壁大败之仇</li>\n<li>第三个锦囊：追兵来了，孙尚香断后</li>\n</ul>\n<p>\n  <a\n    class="gatsby-resp-image-link"\n    href="/static/微信截图_20180418110919-6502f4e152484a15b22f69bc8b62c76a-2a633.png"\n    style="display: block"\n    target="_blank"\n    rel="noopener"\n  >\n  \n  <span\n    class="gatsby-resp-image-wrapper"\n    style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;"\n  >\n    <span\n      class="gatsby-resp-image-background-image"\n      style="padding-bottom: 36.16625310173698%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAABnWAAAZ1gEY0crtAAABkklEQVQoz21RzUoCURQerbSEoCdoUQuDkhY+QWD7Wgo1IfkELYR0VdBScFGrnqAgoVwIBqKgTqPjD5q/5Cg4qAtTB6fRkbHbuXYTqc7mO+fc73z3/FAUsVQqpcGYTqe38vn8OaCjVCo5OI5bx3mEEEVwyqtWqwflcvkhHo/f1ev1y3kORYQWMVYqFTs8IFVVMSCv13uM8xaLxQCmN5vNyzjOZDL3iFiz2eRngpFIZGE8HmshmArmcrnddrt9W6vVnlqt1nU4HDbivM/n03k8niW3263HMcuyp9lslhUE4QW4N386JKad81cJan6T/itMJBLfDsMwh8Fg8AjQFggENqCTtWKxSIdCIRrGsjqdTl0sFtuBjmzQ7Ukymdwjq9kuFAo0TETDDvdnH0FSgRGRoigIRrBHo1GjJEmo0+mgRqOBXC6XAY5zMRqNUL/fR+AzuJjn+avJZDKtA97rTBDE3obD4Xuv1/uEy1n9fv8m+KIsy2K32xVMJtMKdHAmiqIKuQ/Y2SO5sgM+UAaDgQSCzz+CX83mJWzzwqd9AAAAAElFTkSuQmCC\'); background-size: cover; display: block;"\n    >\n      <img\n        class="gatsby-resp-image-image"\n        style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;"\n        alt="     20180418110919"\n        title=""\n        src="/static/微信截图_20180418110919-6502f4e152484a15b22f69bc8b62c76a-fee1c.png"\n        srcset="/static/微信截图_20180418110919-6502f4e152484a15b22f69bc8b62c76a-a67b7.png 200w,\n/static/微信截图_20180418110919-6502f4e152484a15b22f69bc8b62c76a-0b187.png 400w,\n/static/微信截图_20180418110919-6502f4e152484a15b22f69bc8b62c76a-fee1c.png 800w,\n/static/微信截图_20180418110919-6502f4e152484a15b22f69bc8b62c76a-b1a91.png 1200w,\n/static/微信截图_20180418110919-6502f4e152484a15b22f69bc8b62c76a-95179.png 1600w,\n/static/微信截图_20180418110919-6502f4e152484a15b22f69bc8b62c76a-2a633.png 1612w"\n        sizes="(max-width: 800px) 100vw, 800px"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="38498552998563400000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`public interface IStrategy\n{\n    void operate();\n}\n\npublic class OpenBackDoor : IStrategy\n{\n    public void operate()\n    {\n        Console.WriteLine(&quot;找乔国老帮忙，让吴国太给孙权施加压力&quot;);\n    }\n}\n\npublic class HappyForgetShu : IStrategy\n{\n    public void operate()\n    {\n        Console.WriteLine(&quot;刘备乐不思蜀，谎报曹操要报赤壁大败之仇&quot;);\n    }\n}\n\npublic class BlockEnemy : IStrategy\n{\n    public void operate()\n    {\n        Console.WriteLine(&quot;追兵来了，孙夫人断后&quot;);\n    }\n}\npublic class Context\n{\n    private IStrategy strategy;\n    public Context(IStrategy strategy)\n    {\n        this.strategy = strategy;\n    }\n\n    public void operation()\n    {\n        this.strategy.operate();\n    }\n}\nstatic void Main(string[] args)\n{\n    Context context;\n    context = new Context(new OpenBackDoor());\n    context.operation();\n\n    context = new Context(new HappyForgetShu());\n    context.operation();\n\n    context = new Context(new BlockEnemy());\n    context.operation();\n\n    Console.Read();\n}`, `38498552998563400000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                cpp 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="cpp"><pre style="counter-reset: linenumber NaN" class="language-cpp line-numbers"><code class="language-cpp"><span class="token keyword">public</span> interface IStrategy\n<span class="token punctuation">{</span>\n    <span class="token keyword">void</span> <span class="token function">operate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">OpenBackDoor</span> <span class="token operator">:</span> IStrategy\n<span class="token punctuation">{</span>\n    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">operate</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n    <span class="token punctuation">{</span>\n        Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">"找乔国老帮忙，让吴国太给孙权施加压力"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">HappyForgetShu</span> <span class="token operator">:</span> IStrategy\n<span class="token punctuation">{</span>\n    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">operate</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n    <span class="token punctuation">{</span>\n        Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">"刘备乐不思蜀，谎报曹操要报赤壁大败之仇"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">BlockEnemy</span> <span class="token operator">:</span> IStrategy\n<span class="token punctuation">{</span>\n    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">operate</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n    <span class="token punctuation">{</span>\n        Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">"追兵来了，孙夫人断后"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Context</span>\n<span class="token punctuation">{</span>\n    <span class="token keyword">private</span> IStrategy strategy<span class="token punctuation">;</span>\n    <span class="token keyword">public</span> <span class="token function">Context</span><span class="token punctuation">(</span>IStrategy strategy<span class="token punctuation">)</span>\n    <span class="token punctuation">{</span>\n        <span class="token keyword">this</span><span class="token punctuation">.</span>strategy <span class="token operator">=</span> strategy<span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n\n    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">operation</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n    <span class="token punctuation">{</span>\n        <span class="token keyword">this</span><span class="token punctuation">.</span>strategy<span class="token punctuation">.</span><span class="token function">operate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n<span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">Main</span><span class="token punctuation">(</span>string<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span>\n<span class="token punctuation">{</span>\n    Context context<span class="token punctuation">;</span>\n    context <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">Context</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token function">OpenBackDoor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    context<span class="token punctuation">.</span><span class="token function">operation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    context <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">Context</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token function">HappyForgetShu</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    context<span class="token punctuation">.</span><span class="token function">operation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    context <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">Context</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token function">BlockEnemy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    context<span class="token punctuation">.</span><span class="token function">operation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    Console<span class="token punctuation">.</span><span class="token function">Read</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="模式动机-3"><a href="#%E6%A8%A1%E5%BC%8F%E5%8A%A8%E6%9C%BA-3" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>模式动机</h3>\n<ul>\n<li>完成一项任务，往往可以有多种不同的方式，每一种方式称为一个策略，我们可以根据环境或者条件的不同选择不同的策略来完成该项任务。</li>\n<li>在软件开发中也常常遇到类似的情况，实现某一个功能有多个途径，此时可以使用一种设计模式来使得系统可以灵活地选择解决途径，也能够方便地增加新的解决途径。</li>\n<li>在软件系统中，有许多算法可以实现某一功能，如查找、排序等，一种常用的方法是硬编码(Hard Coding)在一个类中，如需要提供多种查找算法，可以将这些算法写到一个类中，在该类中提供多个方法，每一个方法对应一个具体的查找算法；当然也可以将这些查找算法封装在一个统一的方法中，通过 if…else…等条件判断语句来进行选择。</li>\n<li>为了解决这些问题，可以定义一些独立的类来封装不同的算法，每一个类封装一个具体的算法，在这里，每一个封装算法的类我们都可以称之为策略(Strategy)，为了保证这些策略的一致性，一般会用一个抽象的策略类来做算法的定义，而具体每种算法则对应于一个具体策略类。</li>\n</ul>\n<h3 id="模式定义-3"><a href="#%E6%A8%A1%E5%BC%8F%E5%AE%9A%E4%B9%89-3" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>模式定义</h3>\n<p>定义一系列算法，将每一个算法封装起来，并让它们可以相互替换。策略模式让算法独立于使用它的客户而变化。策略模式是一种对象行为型模式。</p>\n<h3 id="模式结构-3"><a href="#%E6%A8%A1%E5%BC%8F%E7%BB%93%E6%9E%84-3" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>模式结构</h3>\n<p>\n  <a\n    class="gatsby-resp-image-link"\n    href="/static/微信截图_20180418111636-589c2c99fdd8927df893520708015a6c-1eb4d.png"\n    style="display: block"\n    target="_blank"\n    rel="noopener"\n  >\n  \n  <span\n    class="gatsby-resp-image-wrapper"\n    style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;"\n  >\n    <span\n      class="gatsby-resp-image-background-image"\n      style="padding-bottom: 33.97014925373134%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAABnWAAAZ1gEY0crtAAABaklEQVQoz5VRPUvDUBRN+lINKor+BumqSxfzXxwdgrgJovgBdQ0u2TKEEEEU13Zou7RDG2jpV9IEmraUhA5CoAUNLrXPe2MqFUTwwONx7z3v3vPOZWzbfhgMBo+dTmefAVBKWWYJuVyOtyxLhPo5cK9brVYa8+Px+AfvGzRGqVQ6xVgQBJ4QspJKpXiMRVHcDYJgQaPD4fAW85AjvzYcjUZPrus+1+v1aLKmaau6ricLhUKyXC4TWZY3PM877vf7977v3zmOk46FcHAIxFy1Wk1gDtQz/8H6X8VKpcIuvswufFNVlQevTmDqZaPRuOh2u5lisbi3pCgBiteazaYInCvkgK838JMD5NRqNTaS2W63o4b5fH4HPHqfzWZ0MplEnkHtKF5CEm9FUbbAppf5fE6n02nEAREZrMFyv3w1DCNqmM1mt03T9Hu93gd49hqGITY8xBoM4vCWJGkTtm7DYwrev+FgUHkWDyWfxvD5lzrUuF8AAAAASUVORK5CYII=\'); background-size: cover; display: block;"\n    >\n      <img\n        class="gatsby-resp-image-image"\n        style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;"\n        alt="     20180418111636"\n        title=""\n        src="/static/微信截图_20180418111636-589c2c99fdd8927df893520708015a6c-fee1c.png"\n        srcset="/static/微信截图_20180418111636-589c2c99fdd8927df893520708015a6c-a67b7.png 200w,\n/static/微信截图_20180418111636-589c2c99fdd8927df893520708015a6c-0b187.png 400w,\n/static/微信截图_20180418111636-589c2c99fdd8927df893520708015a6c-fee1c.png 800w,\n/static/微信截图_20180418111636-589c2c99fdd8927df893520708015a6c-b1a91.png 1200w,\n/static/微信截图_20180418111636-589c2c99fdd8927df893520708015a6c-95179.png 1600w,\n/static/微信截图_20180418111636-589c2c99fdd8927df893520708015a6c-1eb4d.png 1675w"\n        sizes="(max-width: 800px) 100vw, 800px"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<ul>\n<li>Context: 环境类</li>\n<li>Strategy: 抽象策略类</li>\n<li>ConcreteStrategy: 具体策略类</li>\n</ul>\n<h3 id="模式应用-3"><a href="#%E6%A8%A1%E5%BC%8F%E5%BA%94%E7%94%A8-3" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>模式应用</h3>\n<ul>\n<li>直接插入排序、希尔排序、冒泡排序、快速排序、直接选择排序、堆排序、归并排序、基数排序的选择。</li>\n<li>交通工具的选择。</li>\n</ul>\n<h3 id="优缺点-3"><a href="#%E4%BC%98%E7%BC%BA%E7%82%B9-3" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>优缺点</h3>\n<ul>\n<li>\n<p>优点</p>\n<ul>\n<li>提供了对“开闭原则”的完美支持，用户可以在不修改原有系统的基础上选择算法或行为，也可以灵活地增加新的算法或行为。</li>\n<li>提供了管理相关的算法族的办法。</li>\n<li>提供了可以替换继承关系的办法。</li>\n<li>可以避免使用多重条件转移语句。</li>\n</ul>\n</li>\n<li>\n<p>缺点</p>\n<ul>\n<li>客户端必须知道所有的策略类，并自行决定使用哪一个策略类。</li>\n<li>策略模式将造成产生很多策略类，可以通过使用享元模式在一定程度上减少对象的数量。</li>\n</ul>\n</li>\n</ul>\n<h3 id="模式使用-3"><a href="#%E6%A8%A1%E5%BC%8F%E4%BD%BF%E7%94%A8-3" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>模式使用</h3>\n<ul>\n<li>如果在一个系统里面有许多类，它们之间的区别仅在于它们的行为，那么使用策略模式可以动态地让一个对象在许多行为中选择一种行为。</li>\n<li>如果一个对象有很多的行为，如果不用恰当的模式，这些行为就只好使用多重的条件选择语句来实现。</li>\n<li>一个系统需要动态地在几种算法中选择一种。</li>\n<li>不希望客户端知道复杂的、与算法相关的数据结构，在具体策略类中封装算法和相关的数据结构，提高算法的保密性与安全性。</li>\n</ul>\n<h3 id="模式应用-4"><a href="#%E6%A8%A1%E5%BC%8F%E5%BA%94%E7%94%A8-4" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>模式应用</h3>\n<ul>\n<li>在微软公司提供的演示项目 PetShop 4.0 中使用策略模式来处理同步订单和异步订单的问题。</li>\n<li>在 BLL 中的 Order 类里通过反射机制从配置文件中读取策略配置的信息以决定到底是使用哪种订单处理方式。只需要修改配置文件即可更改订单处理方式，提高了系统的灵活性。</li>\n</ul>\n<h3 id="策略模式与状态模式"><a href="#%E7%AD%96%E7%95%A5%E6%A8%A1%E5%BC%8F%E4%B8%8E%E7%8A%B6%E6%80%81%E6%A8%A1%E5%BC%8F" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>策略模式与状态模式</h3>\n<ul>\n<li>可以通过环境类状态的个数来决定是使用策略模式还是状态模式。</li>\n<li>策略模式的环境类自己选择一个具体策略类，具体策略类无须关心环境类；而状态模式的环境类由于外在因素需要放进一个具体状态中，以便通过其方法实现状态的切换，因此环境类和状态类之间存在一种双向的关联关系。</li>\n<li>使用策略模式时，客户端需要知道所选的具体策略是哪一个，而使用状态模式时，客户端无须关心具体状态，环境类的状态会根据用户的操作自动转换。</li>\n<li>如果系统中某个类的对象存在多种状态，不同状态下行为有差异，而且这些状态之间可以发生转换时使用状态模式；如果系统中某个类的某一行为存在多种实现方式，而且这些实现方式可以互换时使用策略模式。</li>\n</ul>',
excerpt:"备忘录模式(Memento…",frontmatter:{date:"2018-04-19 00:04:42",path:"/design-pattern-behavior-2/",tags:"面试, 设计模式",title:"设计模式之行为型模式（二）",draft:null}},prePost:{html:'<p>接上文<a href="/tx-interview-part-1-summary/">腾讯面试总结</a></p>\n<h2 id="剖析-vue-实现原理"><a href="#%E5%89%96%E6%9E%90-vue-%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>剖析 Vue 实现原理</h2>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="20217317422023594000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`<div id=&quot;mvvm-app&quot;>\n  <input type=&quot;text&quot; v-model=&quot;word&quot; />\n  <p>{{word}}</p>\n  <button v-on:click=&quot;sayHi&quot;>change model</button>\n</div>\n\n<script src=&quot;./js/observer.js&quot;></script>\n<script src=&quot;./js/watcher.js&quot;></script>\n<script src=&quot;./js/compile.js&quot;></script>\n<script src=&quot;./js/mvvm.js&quot;></script>\n<script>\n  var vm = new MVVM({\n    el: \'#mvvm-app\',\n    data: {\n      word: \'Hello World!\'\n    },\n    methods: {\n      sayHi: function() {\n        this.word = \'Hi, everybody!\';\n      }\n    }\n  });\n</script>`, `20217317422023594000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                html 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="html"><pre style="counter-reset: linenumber NaN" class="language-html line-numbers"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>mvvm-app<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span> <span class="token attr-name">v-model</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>word<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span>{{word}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name"><span class="token namespace">v-on:</span>click</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>sayHi<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>change model<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>\n\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>./js/observer.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>./js/watcher.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>./js/compile.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>./js/mvvm.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">\n  <span class="token keyword">var</span> vm <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MVVM</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n    el<span class="token punctuation">:</span> <span class="token string">\'#mvvm-app\'</span><span class="token punctuation">,</span>\n    data<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n      word<span class="token punctuation">:</span> <span class="token string">\'Hello World!\'</span>\n    <span class="token punctuation">}</span><span class="token punctuation">,</span>\n    methods<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n      <span class="token function-variable function">sayHi</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        <span class="token keyword">this</span><span class="token punctuation">.</span>word <span class="token operator">=</span> <span class="token string">\'Hi, everybody!\'</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span>\n    <span class="token punctuation">}</span>\n  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>效果：</p>\n<p><img src="/images/wx20180428234011.gif"></p>\n<h3 id="实现-observer"><a href="#%E5%AE%9E%E7%8E%B0-observer" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>实现 Observer</h3>\n<p>ok, 思路已经整理完毕，也已经比较明确相关逻辑和模块功能了，let’s do it 我们知道可以利用<code class="language-text">Obeject.defineProperty()</code>来监听属性变动那么将需要 observe 的数据对象进行递归遍历，包括子属性对象的属性，都加上<code class="language-text">setter</code>和<code class="language-text">getter</code>，这样的话，给这个对象的某个值赋值，就会触发<code class="language-text">setter</code>，那么就能监听到了数据变化。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="65918623540643950000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`var data = { name: \'kindeng\' };\nobserve(data);\ndata.name = \'dmq\'; // 哈哈哈，监听到值变化了 kindeng --> dmq\n\nfunction observe(data) {\n  if (!data || typeof data !== \'object\') {\n    return;\n  }\n  // 取出所有属性遍历\n  Object.keys(data).forEach(function(key) {\n    defineReactive(data, key, data[key]);\n  });\n}\n\nfunction defineReactive(data, key, val) {\n  observe(val); // 监听子属性\n  Object.defineProperty(data, key, {\n    enumerable: true, // 可枚举\n    configurable: false, // 不能再define\n    get: function() {\n      return val;\n    },\n    set: function(newVal) {\n      console.log(\'哈哈哈，监听到值变化了 \', val, \' --> \', newVal);\n      val = newVal;\n    }\n  });\n}`, `65918623540643950000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                js 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">var</span> data <span class="token operator">=</span> <span class="token punctuation">{</span> name<span class="token punctuation">:</span> <span class="token string">\'kindeng\'</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>\n<span class="token function">observe</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>\ndata<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">\'dmq\'</span><span class="token punctuation">;</span> <span class="token comment">// 哈哈哈，监听到值变化了 kindeng --> dmq</span>\n\n<span class="token keyword">function</span> <span class="token function">observe</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>data <span class="token operator">||</span> <span class="token keyword">typeof</span> data <span class="token operator">!==</span> <span class="token string">\'object\'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">return</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n  <span class="token comment">// 取出所有属性遍历</span>\n  Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">key</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token function">defineReactive</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> key<span class="token punctuation">,</span> data<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">function</span> <span class="token function">defineReactive</span><span class="token punctuation">(</span><span class="token parameter">data<span class="token punctuation">,</span> key<span class="token punctuation">,</span> val</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token function">observe</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 监听子属性</span>\n  Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> key<span class="token punctuation">,</span> <span class="token punctuation">{</span>\n    enumerable<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 可枚举</span>\n    configurable<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token comment">// 不能再define</span>\n    <span class="token function-variable function">get</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token keyword">return</span> val<span class="token punctuation">;</span>\n    <span class="token punctuation">}</span><span class="token punctuation">,</span>\n    <span class="token function-variable function">set</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">newVal</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">\'哈哈哈，监听到值变化了 \'</span><span class="token punctuation">,</span> val<span class="token punctuation">,</span> <span class="token string">\' --> \'</span><span class="token punctuation">,</span> newVal<span class="token punctuation">)</span><span class="token punctuation">;</span>\n      val <span class="token operator">=</span> newVal<span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>这样我们已经可以监听每个数据的变化了，那么监听到变化之后就是怎么通知订阅者了，所以接下来我们需要实现一个消息订阅器，很简单，维护一个数组，用来收集订阅者，数据变动触发 notify，再调用订阅者的 update 方法，代码改善之后是这样：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="74419336426852800000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// ... 省略\nfunction defineReactive(data, key, val) {\n  var dep = new Dep();\n  observe(val); // 监听子属性\n\n  Object.defineProperty(data, key, {\n    // ... 省略\n    set: function(newVal) {\n      if (val === newVal) return;\n      console.log(\'哈哈哈，监听到值变化了 \', val, \' --> \', newVal);\n      val = newVal;\n      dep.notify(); // 通知所有订阅者\n    }\n  });\n}\n\nfunction Dep() {\n  this.subs = [];\n}\nDep.prototype = {\n  addSub: function(sub) {\n    this.subs.push(sub);\n  },\n  notify: function() {\n    this.subs.forEach(function(sub) {\n      sub.update();\n    });\n  }\n};`, `74419336426852800000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                js 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// ... 省略</span>\n<span class="token keyword">function</span> <span class="token function">defineReactive</span><span class="token punctuation">(</span><span class="token parameter">data<span class="token punctuation">,</span> key<span class="token punctuation">,</span> val</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">var</span> dep <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Dep</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token function">observe</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 监听子属性</span>\n\n  Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> key<span class="token punctuation">,</span> <span class="token punctuation">{</span>\n    <span class="token comment">// ... 省略</span>\n    <span class="token function-variable function">set</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">newVal</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token keyword">if</span> <span class="token punctuation">(</span>val <span class="token operator">===</span> newVal<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>\n      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">\'哈哈哈，监听到值变化了 \'</span><span class="token punctuation">,</span> val<span class="token punctuation">,</span> <span class="token string">\' --> \'</span><span class="token punctuation">,</span> newVal<span class="token punctuation">)</span><span class="token punctuation">;</span>\n      val <span class="token operator">=</span> newVal<span class="token punctuation">;</span>\n      dep<span class="token punctuation">.</span><span class="token function">notify</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 通知所有订阅者</span>\n    <span class="token punctuation">}</span>\n  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">function</span> <span class="token function">Dep</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">this</span><span class="token punctuation">.</span>subs <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n<span class="token class-name">Dep</span><span class="token punctuation">.</span>prototype <span class="token operator">=</span> <span class="token punctuation">{</span>\n  <span class="token function-variable function">addSub</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">sub</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">this</span><span class="token punctuation">.</span>subs<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>sub<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span><span class="token punctuation">,</span>\n  <span class="token function-variable function">notify</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">this</span><span class="token punctuation">.</span>subs<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">sub</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      sub<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>那么问题来了，谁是订阅者？怎么往订阅器添加订阅者？没错，上面的思路整理中我们已经明确订阅者应该是 Watcher, 而且<code class="language-text">var dep = new Dep();</code>是在 <code class="language-text">defineReactive</code>方法内部定义的，所以想通过<code class="language-text">dep</code>添加订阅者，就必须要在闭包内操作，所以我们可以在 <code class="language-text">getter</code>里面动手脚：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="32818475086175660000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// Observer.js\n// ...省略\nObject.defineProperty(data, key, {\n  get: function() {\n    // 由于需要在闭包内添加watcher，所以通过Dep定义一个全局target属性，暂存watcher, 添加完移除\n    Dep.target && dep.addDep(Dep.target);\n    return val;\n  }\n  // ... 省略\n});\n\n// Watcher.js\nWatcher.prototype = {\n  get: function(key) {\n    Dep.target = this;\n    this.value = data[key]; // 这里会触发属性的getter，从而添加订阅者\n    Dep.target = null;\n  }\n};`, `32818475086175660000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                js 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// Observer.js</span>\n<span class="token comment">// ...省略</span>\nObject<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> key<span class="token punctuation">,</span> <span class="token punctuation">{</span>\n  <span class="token function-variable function">get</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token comment">// 由于需要在闭包内添加watcher，所以通过Dep定义一个全局target属性，暂存watcher, 添加完移除</span>\n    Dep<span class="token punctuation">.</span>target <span class="token operator">&amp;&amp;</span> dep<span class="token punctuation">.</span><span class="token function">addDep</span><span class="token punctuation">(</span>Dep<span class="token punctuation">.</span>target<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">return</span> val<span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n  <span class="token comment">// ... 省略</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token comment">// Watcher.js</span>\n<span class="token class-name">Watcher</span><span class="token punctuation">.</span>prototype <span class="token operator">=</span> <span class="token punctuation">{</span>\n  <span class="token function-variable function">get</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">key</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    Dep<span class="token punctuation">.</span>target <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>\n    <span class="token keyword">this</span><span class="token punctuation">.</span>value <span class="token operator">=</span> data<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// 这里会触发属性的getter，从而添加订阅者</span>\n    Dep<span class="token punctuation">.</span>target <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>这里已经实现了一个 Observer 了，已经具备了监听数据和数据变化通知订阅者的功能，<a href="https://github.com/DMQ/mvvm/blob/master/js/observer.js" target="_blank" rel="nofollow noreferrer noopener">完整代码</a>。那么接下来就是实现 Compile 了</p>\n<h3 id="实现-compile"><a href="#%E5%AE%9E%E7%8E%B0-compile" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>实现 Compile</h3>\n<p>compile 主要做的事情是解析模板指令，将模板中的变量替换成数据，然后初始化渲染页面视图，并将每个指令对应的节点绑定更新函数，添加监听数据的订阅者，一旦数据有变动，收到通知，更新视图，如图所示：</p>\n<p>\n  <a\n    class="gatsby-resp-image-link"\n    href="/static/wx20180428234629-dfc054a36a6d49fc74950d4c6372f649-faa92.png"\n    style="display: block"\n    target="_blank"\n    rel="noopener"\n  >\n  \n  <span\n    class="gatsby-resp-image-wrapper"\n    style="position: relative; display: block; ; max-width: 625px; margin-left: auto; margin-right: auto;"\n  >\n    <span\n      class="gatsby-resp-image-background-image"\n      style="padding-bottom: 41.440000000000005%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAIAAAB2/0i6AAAACXBIWXMAAAsSAAALEgHS3X78AAABHUlEQVQY042R62rEIBSEff8n6hssLUt/lbZsDNnaGKOeeElMSNbL1hgW+qt0GAbBQT2fKIQQY/xPeu9jiJRSQkjwIaWEQvBl98i9dLRztUTOvZd1T/fFr52DbobptqSYUCmnX45H+/5QXi/L4mYHQhLFWDDtOsjN5irSmk9jPxYr1ZfLkzHQNO+EXLIBuFJqGGDbtvW2imnoR9j8LY+ApGysrQEqIT85x4R8Y1xfrx9V9XI6PV0uz8aI4wnruvWMCy5qXHe0c84hpbmxrLhTioUia4dx5EJ8TRPngkkJ8zxbC1IS1l/bFgMQbWQGFosPqvGhlEkVwjs0rRXnMg9C6VuFzxifm+ZV6xb98T2H9pMKv53ORDmvs53rtO5/ANR5x7sEWpEJAAAAAElFTkSuQmCC\'); background-size: cover; display: block;"\n    >\n      <img\n        class="gatsby-resp-image-image"\n        style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;"\n        alt="wx20180428234629"\n        title=""\n        src="/static/wx20180428234629-dfc054a36a6d49fc74950d4c6372f649-faa92.png"\n        srcset="/static/wx20180428234629-dfc054a36a6d49fc74950d4c6372f649-630d2.png 200w,\n/static/wx20180428234629-dfc054a36a6d49fc74950d4c6372f649-34069.png 400w,\n/static/wx20180428234629-dfc054a36a6d49fc74950d4c6372f649-faa92.png 625w"\n        sizes="(max-width: 625px) 100vw, 625px"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<p>因为遍历解析的过程有多次操作 dom 节点，为提高性能和效率，会先将跟节点<code class="language-text">el</code>转换成文档碎片<code class="language-text">fragment</code>进行解析编译操作，解析完成，再将<code class="language-text">fragment</code>添加回原来的真实 dom 节点中</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="75043000573681270000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`function Compile(el) {\n  this.\\$el = this.isElementNode(el) ? el : document.querySelector(el);\n  if (this.\\$el) {\n    this.\\$fragment = this.node2Fragment(this.\\$el);\n    this.init();\n    this.\\$el.appendChild(this.\\$fragment);\n  }\n}\nCompile.prototype = {\n  init: function() {\n    this.compileElement(this.\\$fragment);\n  },\n  node2Fragment: function(el) {\n    var fragment = document.createDocumentFragment(),\n      child;\n    // 将原生节点拷贝到fragment\n    while ((child = el.firstChild)) {\n      fragment.appendChild(child);\n    }\n    return fragment;\n  }\n};`, `75043000573681270000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                js 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">function</span> <span class="token function">Compile</span><span class="token punctuation">(</span><span class="token parameter">el</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">this</span><span class="token punctuation">.</span>$el <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">isElementNode</span><span class="token punctuation">(</span>el<span class="token punctuation">)</span> <span class="token operator">?</span> el <span class="token punctuation">:</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span>el<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>$el<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">this</span><span class="token punctuation">.</span>$fragment <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">node2Fragment</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>$el<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">this</span><span class="token punctuation">.</span>$el<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>$fragment<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n<span class="token class-name">Compile</span><span class="token punctuation">.</span>prototype <span class="token operator">=</span> <span class="token punctuation">{</span>\n  <span class="token function-variable function">init</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">compileElement</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>$fragment<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span><span class="token punctuation">,</span>\n  <span class="token function-variable function">node2Fragment</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">el</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">var</span> fragment <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createDocumentFragment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n      child<span class="token punctuation">;</span>\n    <span class="token comment">// 将原生节点拷贝到fragment</span>\n    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>child <span class="token operator">=</span> el<span class="token punctuation">.</span>firstChild<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      fragment<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>child<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n    <span class="token keyword">return</span> fragment<span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>compileElement 方法将遍历所有节点及其子节点，进行扫描解析编译，调用对应的指令渲染函数进行数据渲染，并调用对应的指令更新函数进行绑定，详看代码及注释说明：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="55959658064519815000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`Compile.prototype = {\n  // ... 省略\n  compileElement: function(el) {\n    var childNodes = el.childNodes,\n      me = this;\n    [].slice.call(childNodes).forEach(function(node) {\n      var text = node.textContent;\n      var reg = /\\{\\{(.*)\\}\\}/; // 表达式文本\n      // 按元素节点方式编译\n      if (me.isElementNode(node)) {\n        me.compile(node);\n      } else if (me.isTextNode(node) && reg.test(text)) {\n        me.compileText(node, RegExp.\\$1);\n      }\n      // 遍历编译子节点\n      if (node.childNodes && node.childNodes.length) {\n        me.compileElement(node);\n      }\n    });\n  },\n\n  compile: function(node) {\n    var nodeAttrs = node.attributes,\n      me = this;\n    [].slice.call(nodeAttrs).forEach(function(attr) {\n      // 规定：指令以 v-xxx 命名\n      // 如 <span v-text=&quot;content&quot;></span> 中指令为 v-text\n      var attrName = attr.name; // v-text\n      if (me.isDirective(attrName)) {\n        var exp = attr.value; // content\n        var dir = attrName.substring(2); // text\n        if (me.isEventDirective(dir)) {\n          // 事件指令, 如 v-on:click\n          compileUtil.eventHandler(node, me.\\$vm, exp, dir);\n        } else {\n          // 普通指令\n          compileUtil[dir] && compileUtil[dir](node, me.\\$vm, exp);\n        }\n      }\n    });\n  }\n};\n\n// 指令处理集合\nvar compileUtil = {\n  text: function(node, vm, exp) {\n    this.bind(node, vm, exp, \'text\');\n  },\n  // ...省略\n  bind: function(node, vm, exp, dir) {\n    var updaterFn = updater[dir + \'Updater\'];\n    // 第一次初始化视图\n    updaterFn && updaterFn(node, vm[exp]);\n    // 实例化订阅者，此操作会在对应的属性消息订阅器中添加了该订阅者watcher\n    new Watcher(vm, exp, function(value, oldValue) {\n      // 一旦属性值有变化，会收到通知执行此更新函数，更新视图\n      updaterFn && updaterFn(node, value, oldValue);\n    });\n  }\n};\n\n// 更新函数\nvar updater = {\n  textUpdater: function(node, value) {\n    node.textContent = typeof value == \'undefined\' ? \'\' : value;\n  }\n  // ...省略\n};`, `55959658064519815000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                javascript 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="javascript"><pre style="counter-reset: linenumber NaN" class="language-javascript line-numbers"><code class="language-javascript"><span class="token class-name">Compile</span><span class="token punctuation">.</span>prototype <span class="token operator">=</span> <span class="token punctuation">{</span>\n  <span class="token comment">// ... 省略</span>\n  <span class="token function-variable function">compileElement</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">el</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">var</span> childNodes <span class="token operator">=</span> el<span class="token punctuation">.</span>childNodes<span class="token punctuation">,</span>\n      me <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>\n    <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>childNodes<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">node</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token keyword">var</span> text <span class="token operator">=</span> node<span class="token punctuation">.</span>textContent<span class="token punctuation">;</span>\n      <span class="token keyword">var</span> reg <span class="token operator">=</span> <span class="token regex">/\\{\\{(.*)\\}\\}/</span><span class="token punctuation">;</span> <span class="token comment">// 表达式文本</span>\n      <span class="token comment">// 按元素节点方式编译</span>\n      <span class="token keyword">if</span> <span class="token punctuation">(</span>me<span class="token punctuation">.</span><span class="token function">isElementNode</span><span class="token punctuation">(</span>node<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        me<span class="token punctuation">.</span><span class="token function">compile</span><span class="token punctuation">(</span>node<span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>me<span class="token punctuation">.</span><span class="token function">isTextNode</span><span class="token punctuation">(</span>node<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> reg<span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        me<span class="token punctuation">.</span><span class="token function">compileText</span><span class="token punctuation">(</span>node<span class="token punctuation">,</span> RegExp<span class="token punctuation">.</span>$<span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span>\n      <span class="token comment">// 遍历编译子节点</span>\n      <span class="token keyword">if</span> <span class="token punctuation">(</span>node<span class="token punctuation">.</span>childNodes <span class="token operator">&amp;&amp;</span> node<span class="token punctuation">.</span>childNodes<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        me<span class="token punctuation">.</span><span class="token function">compileElement</span><span class="token punctuation">(</span>node<span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span>\n    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span><span class="token punctuation">,</span>\n\n  <span class="token function-variable function">compile</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">node</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">var</span> nodeAttrs <span class="token operator">=</span> node<span class="token punctuation">.</span>attributes<span class="token punctuation">,</span>\n      me <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>\n    <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>nodeAttrs<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">attr</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token comment">// 规定：指令以 v-xxx 命名</span>\n      <span class="token comment">// 如 &lt;span v-text="content">&lt;/span> 中指令为 v-text</span>\n      <span class="token keyword">var</span> attrName <span class="token operator">=</span> attr<span class="token punctuation">.</span>name<span class="token punctuation">;</span> <span class="token comment">// v-text</span>\n      <span class="token keyword">if</span> <span class="token punctuation">(</span>me<span class="token punctuation">.</span><span class="token function">isDirective</span><span class="token punctuation">(</span>attrName<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        <span class="token keyword">var</span> exp <span class="token operator">=</span> attr<span class="token punctuation">.</span>value<span class="token punctuation">;</span> <span class="token comment">// content</span>\n        <span class="token keyword">var</span> dir <span class="token operator">=</span> attrName<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// text</span>\n        <span class="token keyword">if</span> <span class="token punctuation">(</span>me<span class="token punctuation">.</span><span class="token function">isEventDirective</span><span class="token punctuation">(</span>dir<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n          <span class="token comment">// 事件指令, 如 v-on:click</span>\n          compileUtil<span class="token punctuation">.</span><span class="token function">eventHandler</span><span class="token punctuation">(</span>node<span class="token punctuation">,</span> me<span class="token punctuation">.</span>$vm<span class="token punctuation">,</span> exp<span class="token punctuation">,</span> dir<span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>\n          <span class="token comment">// 普通指令</span>\n          compileUtil<span class="token punctuation">[</span>dir<span class="token punctuation">]</span> <span class="token operator">&amp;&amp;</span> compileUtil<span class="token punctuation">[</span>dir<span class="token punctuation">]</span><span class="token punctuation">(</span>node<span class="token punctuation">,</span> me<span class="token punctuation">.</span>$vm<span class="token punctuation">,</span> exp<span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token punctuation">}</span>\n      <span class="token punctuation">}</span>\n    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n<span class="token comment">// 指令处理集合</span>\n<span class="token keyword">var</span> compileUtil <span class="token operator">=</span> <span class="token punctuation">{</span>\n  <span class="token function-variable function">text</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">node<span class="token punctuation">,</span> vm<span class="token punctuation">,</span> exp</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span>node<span class="token punctuation">,</span> vm<span class="token punctuation">,</span> exp<span class="token punctuation">,</span> <span class="token string">\'text\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span><span class="token punctuation">,</span>\n  <span class="token comment">// ...省略</span>\n  <span class="token function-variable function">bind</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">node<span class="token punctuation">,</span> vm<span class="token punctuation">,</span> exp<span class="token punctuation">,</span> dir</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">var</span> updaterFn <span class="token operator">=</span> updater<span class="token punctuation">[</span>dir <span class="token operator">+</span> <span class="token string">\'Updater\'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n    <span class="token comment">// 第一次初始化视图</span>\n    updaterFn <span class="token operator">&amp;&amp;</span> <span class="token function">updaterFn</span><span class="token punctuation">(</span>node<span class="token punctuation">,</span> vm<span class="token punctuation">[</span>exp<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token comment">// 实例化订阅者，此操作会在对应的属性消息订阅器中添加了该订阅者watcher</span>\n    <span class="token keyword">new</span> <span class="token class-name">Watcher</span><span class="token punctuation">(</span>vm<span class="token punctuation">,</span> exp<span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">value<span class="token punctuation">,</span> oldValue</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token comment">// 一旦属性值有变化，会收到通知执行此更新函数，更新视图</span>\n      updaterFn <span class="token operator">&amp;&amp;</span> <span class="token function">updaterFn</span><span class="token punctuation">(</span>node<span class="token punctuation">,</span> value<span class="token punctuation">,</span> oldValue<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n<span class="token comment">// 更新函数</span>\n<span class="token keyword">var</span> updater <span class="token operator">=</span> <span class="token punctuation">{</span>\n  <span class="token function-variable function">textUpdater</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">node<span class="token punctuation">,</span> value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    node<span class="token punctuation">.</span>textContent <span class="token operator">=</span> <span class="token keyword">typeof</span> value <span class="token operator">==</span> <span class="token string">\'undefined\'</span> <span class="token operator">?</span> <span class="token string">\'\'</span> <span class="token punctuation">:</span> value<span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n  <span class="token comment">// ...省略</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>这里通过递归遍历保证了每个节点及子节点都会解析编译到，包括了 {{ }} 表达式声明的文本节点。指令的声明规定是通过特定前缀的节点属性来标记，如<code class="language-text">&lt;span v-text=&quot;content&quot; other-attr</code>中<code class="language-text">v-text</code>便是指令，而<code class="language-text">other-attr</code>不是指令，只是普通的属性。监听数据、绑定更新函数的处理是在<code class="language-text">compileUtil.bind()</code>这个方法中，通过<code class="language-text">new Watcher()</code>添加回调来接收数据变化的通知</p>\n<p>至此，一个简单的 Compile 就完成了，<a href="https://github.com/DMQ/mvvm/blob/master/js/compile.js" target="_blank" rel="nofollow noreferrer noopener">完整代码</a>。接下来要看看 Watcher 这个订阅者的具体实现了</p>\n<h3 id="实现-watcher"><a href="#%E5%AE%9E%E7%8E%B0-watcher" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>实现 Watcher</h3>\n<p>Watcher 订阅者作为 Observer 和 Compile 之间通信的桥梁，主要做的事情是: 1、在自身实例化时往属性订阅器(dep)里面添加自己 2、自身必须有一个 update()方法 3、待属性变动 dep.notice()通知时，能调用自身的 update()方法，并触发 Compile 中绑定的回调，则功成身退。如果有点乱，可以回顾下前面的思路整理</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="3880032916756737000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`function Watcher(vm, exp, cb) {\n  this.cb = cb;\n  this.vm = vm;\n  this.exp = exp;\n  // 此处为了触发属性的getter，从而在dep添加自己，结合Observer更易理解\n  this.value = this.get();\n}\nWatcher.prototype = {\n  update: function() {\n    this.run(); // 属性值变化收到通知\n  },\n  run: function() {\n    var value = this.get(); // 取到最新值\n    var oldVal = this.value;\n    if (value !== oldVal) {\n      this.value = value;\n      this.cb.call(this.vm, value, oldVal); // 执行Compile中绑定的回调，更新视图\n    }\n  },\n  get: function() {\n    Dep.target = this; // 将当前订阅者指向自己\n    var value = this.vm[exp]; // 触发getter，添加自己到属性订阅器中\n    Dep.target = null; // 添加完毕，重置\n    return value;\n  }\n};\n// 这里再次列出Observer和Dep，方便理解\nObject.defineProperty(data, key, {\n  get: function() {\n    // 由于需要在闭包内添加watcher，所以可以在Dep定义一个全局target属性，暂存watcher, 添加完移除\n    Dep.target && dep.addDep(Dep.target);\n    return val;\n  }\n  // ... 省略\n});\nDep.prototype = {\n  notify: function() {\n    this.subs.forEach(function(sub) {\n      sub.update(); // 调用订阅者的update方法，通知变化\n    });\n  }\n};`, `3880032916756737000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                javascript 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="javascript"><pre style="counter-reset: linenumber NaN" class="language-javascript line-numbers"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">Watcher</span><span class="token punctuation">(</span><span class="token parameter">vm<span class="token punctuation">,</span> exp<span class="token punctuation">,</span> cb</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">this</span><span class="token punctuation">.</span>cb <span class="token operator">=</span> cb<span class="token punctuation">;</span>\n  <span class="token keyword">this</span><span class="token punctuation">.</span>vm <span class="token operator">=</span> vm<span class="token punctuation">;</span>\n  <span class="token keyword">this</span><span class="token punctuation">.</span>exp <span class="token operator">=</span> exp<span class="token punctuation">;</span>\n  <span class="token comment">// 此处为了触发属性的getter，从而在dep添加自己，结合Observer更易理解</span>\n  <span class="token keyword">this</span><span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n<span class="token class-name">Watcher</span><span class="token punctuation">.</span>prototype <span class="token operator">=</span> <span class="token punctuation">{</span>\n  <span class="token function-variable function">update</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 属性值变化收到通知</span>\n  <span class="token punctuation">}</span><span class="token punctuation">,</span>\n  <span class="token function-variable function">run</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">var</span> value <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 取到最新值</span>\n    <span class="token keyword">var</span> oldVal <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>value<span class="token punctuation">;</span>\n    <span class="token keyword">if</span> <span class="token punctuation">(</span>value <span class="token operator">!==</span> oldVal<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token keyword">this</span><span class="token punctuation">.</span>value <span class="token operator">=</span> value<span class="token punctuation">;</span>\n      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">cb</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>vm<span class="token punctuation">,</span> value<span class="token punctuation">,</span> oldVal<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 执行Compile中绑定的回调，更新视图</span>\n    <span class="token punctuation">}</span>\n  <span class="token punctuation">}</span><span class="token punctuation">,</span>\n  <span class="token function-variable function">get</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    Dep<span class="token punctuation">.</span>target <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span> <span class="token comment">// 将当前订阅者指向自己</span>\n    <span class="token keyword">var</span> value <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>vm<span class="token punctuation">[</span>exp<span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// 触发getter，添加自己到属性订阅器中</span>\n    Dep<span class="token punctuation">.</span>target <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span> <span class="token comment">// 添加完毕，重置</span>\n    <span class="token keyword">return</span> value<span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span>\n<span class="token comment">// 这里再次列出Observer和Dep，方便理解</span>\nObject<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> key<span class="token punctuation">,</span> <span class="token punctuation">{</span>\n  <span class="token function-variable function">get</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token comment">// 由于需要在闭包内添加watcher，所以可以在Dep定义一个全局target属性，暂存watcher, 添加完移除</span>\n    Dep<span class="token punctuation">.</span>target <span class="token operator">&amp;&amp;</span> dep<span class="token punctuation">.</span><span class="token function">addDep</span><span class="token punctuation">(</span>Dep<span class="token punctuation">.</span>target<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">return</span> val<span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n  <span class="token comment">// ... 省略</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token class-name">Dep</span><span class="token punctuation">.</span>prototype <span class="token operator">=</span> <span class="token punctuation">{</span>\n  <span class="token function-variable function">notify</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">this</span><span class="token punctuation">.</span>subs<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">sub</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      sub<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 调用订阅者的update方法，通知变化</span>\n    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>实例化<code class="language-text">Watcher</code>的时候，调用<code class="language-text">get()</code>方法，通过<code class="language-text">Dep.target = watcherInstance</code>标记订阅者是当前 watcher 实例，强行触发属性定义的<code class="language-text">getter</code>方法，<code class="language-text">getter</code>方法执行的时候，就会在属性的订阅器<code class="language-text">dep</code>添加当前 watcher 实例，从而在属性值有变化的时候，watcherInstance 就能收到更新通知。</p>\n<p>ok, Watcher 也已经实现了，<a href="https://github.com/DMQ/mvvm/blob/master/js/watcher.js" target="_blank" rel="nofollow noreferrer noopener">完整代码</a>。基本上 vue 中数据绑定相关比较核心的几个模块也是这几个，猛戳<a href="https://github.com/vuejs/vue" target="_blank" rel="nofollow noreferrer noopener">这里</a> , 在<code class="language-text">src</code> 目录可找到 vue 源码。</p>\n<p>最后来讲讲 MVVM 入口文件的相关逻辑和实现吧，相对就比较简单了~</p>\n<h3 id="实现-mvvm"><a href="#%E5%AE%9E%E7%8E%B0-mvvm" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>实现 MVVM</h3>\n<p>MVVM 作为数据绑定的入口，整合 Observer、Compile 和 Watcher 三者，通过 Observer 来监听自己的 model 数据变化，通过 Compile 来解析编译模板指令，最终利用 Watcher 搭起 Observer 和 Compile 之间的通信桥梁，达到数据变化 -> 视图更新；视图交互变化(input) -> 数据 model 变更的双向绑定效果。</p>\n<p>一个简单的 MVVM 构造器是这样子：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="62299920432532630000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`function MVVM(options) {\n  this.\\$options = options;\n  var data = (this._data = this.\\$options.data);\n  observe(data, this);\n  this.\\$compile = new Compile(options.el || document.body, this);\n}`, `62299920432532630000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                js 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">function</span> <span class="token constant">MVVM</span><span class="token punctuation">(</span><span class="token parameter">options</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">this</span><span class="token punctuation">.</span>$options <span class="token operator">=</span> options<span class="token punctuation">;</span>\n  <span class="token keyword">var</span> data <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>_data <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$options<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token function">observe</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token keyword">this</span><span class="token punctuation">.</span>$compile <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Compile</span><span class="token punctuation">(</span>options<span class="token punctuation">.</span>el <span class="token operator">||</span> document<span class="token punctuation">.</span>body<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>但是这里有个问题，从代码中可看出监听的数据对象是 options.data，每次需要更新视图，则必须通过</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="11305269185217192000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`var vm = new MVVM({ data: { name: \'kindeng\' } });\nvm._data.name = \'dmq\';`, `11305269185217192000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                js 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">var</span> vm <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MVVM</span><span class="token punctuation">(</span><span class="token punctuation">{</span> data<span class="token punctuation">:</span> <span class="token punctuation">{</span> name<span class="token punctuation">:</span> <span class="token string">\'kindeng\'</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\nvm<span class="token punctuation">.</span>_data<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">\'dmq\'</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p>这样的方式来改变数据。</p>\n<p>显然不符合我们一开始的期望，我们所期望的调用方式应该是这样的：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="2794059458812881000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`var vm = new MVVM({ data: { name: \'kindeng\' } });\nvm.name = \'dmq\';`, `2794059458812881000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                js 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">var</span> vm <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MVVM</span><span class="token punctuation">(</span><span class="token punctuation">{</span> data<span class="token punctuation">:</span> <span class="token punctuation">{</span> name<span class="token punctuation">:</span> <span class="token string">\'kindeng\'</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\nvm<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">\'dmq\'</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p>所以这里需要给 MVVM 实例添加一个属性代理的方法，使访问 vm 的属性代理为访问 vm._data 的属性，改造后的代码如下：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="67860236853998980000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`function MVVM(options) {\n  this.\\$options = options;\n  var data = (this._data = this.\\$options.data),\n    me = this;\n  // 属性代理，实现 vm.xxx -> vm._data.xxx\n  Object.keys(data).forEach(function(key) {\n    me._proxy(key);\n  });\n  observe(data, this);\n  this.\\$compile = new Compile(options.el || document.body, this);\n}\n\nMVVM.prototype = {\n  _proxy: function(key) {\n    var me = this;\n    Object.defineProperty(me, key, {\n      configurable: false,\n      enumerable: true,\n      get: function proxyGetter() {\n        return me._data[key];\n      },\n      set: function proxySetter(newVal) {\n        me._data[key] = newVal;\n      }\n    });\n  }\n};`, `67860236853998980000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                js 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">function</span> <span class="token constant">MVVM</span><span class="token punctuation">(</span><span class="token parameter">options</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">this</span><span class="token punctuation">.</span>$options <span class="token operator">=</span> options<span class="token punctuation">;</span>\n  <span class="token keyword">var</span> data <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>_data <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$options<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">,</span>\n    me <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>\n  <span class="token comment">// 属性代理，实现 vm.xxx -> vm._data.xxx</span>\n  Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">key</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    me<span class="token punctuation">.</span><span class="token function">_proxy</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token function">observe</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token keyword">this</span><span class="token punctuation">.</span>$compile <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Compile</span><span class="token punctuation">(</span>options<span class="token punctuation">.</span>el <span class="token operator">||</span> document<span class="token punctuation">.</span>body<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token class-name">MVVM</span><span class="token punctuation">.</span>prototype <span class="token operator">=</span> <span class="token punctuation">{</span>\n  <span class="token function-variable function">_proxy</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">key</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">var</span> me <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>\n    Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>me<span class="token punctuation">,</span> key<span class="token punctuation">,</span> <span class="token punctuation">{</span>\n      configurable<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>\n      enumerable<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>\n      <span class="token function-variable function">get</span><span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token function">proxyGetter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        <span class="token keyword">return</span> me<span class="token punctuation">.</span>_data<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span><span class="token punctuation">,</span>\n      <span class="token function-variable function">set</span><span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token function">proxySetter</span><span class="token punctuation">(</span><span class="token parameter">newVal</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        me<span class="token punctuation">.</span>_data<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> newVal<span class="token punctuation">;</span>\n      <span class="token punctuation">}</span>\n    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>这里主要还是利用了<code class="language-text">Object.defineProperty()</code>这个方法来劫持了 vm 实例对象的属性的读写权，使读写 vm 实例的属性转成读写了<code class="language-text">vm._data</code>的属性值，达到鱼目混珠的效果，哈哈</p>\n<p>至此，全部模块和功能已经完成了，如本文开头所承诺的两点。一个简单的 MVVM 模块已经实现，其思想和原理大部分来自经过简化改造的 vue<a href="https://github.com/vuejs/vue" target="_blank" rel="nofollow noreferrer noopener">源码</a>，猛戳<a href="https://github.com/DMQ/mvvm" target="_blank" rel="nofollow noreferrer noopener">这里</a>可以看到本文的所有相关代码。</p>\n<p>由于本文内容偏实践，所以代码量较多，且不宜列出大篇幅代码，所以建议想深入了解的童鞋可以再次结合本文源代码来进行阅读，这样会更加容易理解和掌握。</p>\n<h3 id="总结"><a href="#%E6%80%BB%E7%BB%93" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>总结</h3>\n<p>本文主要围绕“几种实现双向绑定的做法”、“实现 Observer”、“实现 Compile”、“实现 Watcher”、“实现 MVVM”这几个模块来阐述了双向绑定的原理和实现。并根据思路流程渐进梳理讲解了一些细节思路和比较关键的内容点，以及通过展示部分关键代码讲述了怎样一步步实现一个双向绑定 MVVM。文中肯定会有一些不够严谨的思考和错误，欢迎大家指正，有兴趣欢迎一起探讨和改进~</p>\n<p>最后，感谢您的阅读！</p>',
excerpt:"接上文 腾讯面试总结 剖析 Vue 实现原理 效果： 实现 Observer ok, 思路已经整理完毕，也已经比较明确相关逻辑和模块功能了，let’s do it 我们知道可以利用 来监听属性变动那么将需要 observe…",frontmatter:{date:"2018-04-27 16:14:18",path:"/mvvm-principle/",tags:"前端, 面试, MVVM",title:"MVVM原理探究",draft:null}}},pathContext:{mainPostPath:"/design-pattern-behavior-3/",nextPostPath:"/design-pattern-behavior-2/",prePostPath:"/mvvm-principle/"}}}});