webpackJsonp([87860903228536],{1272:function(a,s){a.exports={data:{site:{siteMetadata:{title:"女王控的博客",description:'前端工程师，黑猫女王控，欢迎勾搭，技术相关<a href="https://github.com/towavephone" target="_blank">@towavephone</a>，QQ闲聊<a href="tencent://AddContact/?fromId=45&fromSubId=1&subcmd=all&uin=634407147&website=www.oicqzone.com">@towave</a>，bili关注<a href="https://space.bilibili.com/11507708#/" target="_blank">@towave</a>',siteUrl:"https://blog.towavephone.com"}}},pathContext:{posts:[{excerpt:"翻译 深入 Docker：容器和镜像 这篇文章，通过一些实例向大家介绍 容器和镜像的具体区别。 是一个非常有趣的项目。它自己宣称可以减轻部署服务器的难度，当然我相信里面有炒作的成分。但是实际使用后，我觉得 Docker 的表现还是可圈可点的。本篇文章将会从头开始进行操作镜像，同时试图通过实例和文档来解答实际操作 Docker 中遇到的问题。 本文仅仅是试图使用深入讲解 镜像和容器的基础知识，而不是像了解  Docker：一种更好的虚拟化方式 一样试图总结出 Docker…",html:'<blockquote>\n<p>翻译<a href="http://opensolitude.com/2015/04/26/discovering-docker-containers-images.html" target="_blank" rel="nofollow noreferrer noopener">深入 Docker：容器和镜像</a>这篇文章，通过一些实例向大家介绍<code class="language-text">Docker</code>容器和镜像的具体区别。</p>\n</blockquote>\n<p><code class="language-text">Docker</code>是一个非常有趣的项目。它自己宣称可以减轻部署服务器的难度，当然我相信里面有炒作的成分。但是实际使用后，我觉得 Docker 的表现还是可圈可点的。本篇文章将会从头开始进行操作镜像，同时试图通过实例和文档来解答实际操作 Docker 中遇到的问题。</p>\n<p>本文仅仅是试图使用深入讲解<code class="language-text">Docker</code>镜像和容器的基础知识，而不是像了解 <a href="https://redstack.wordpress.com/2014/11/14/gettingn-to-know-docker-a-better-way-to-do-virtualization/" target="_blank" rel="nofollow noreferrer noopener">Docker：一种更好的虚拟化方式</a>一样试图总结出 Docker 的所有操作方法。</p>\n<p>如果你打算按照本文操作的话，那么你首先有台安装好 Docker 的 Linux 主机。使用 Docker Machine 安装 Docker 很简单，但是同时我也推荐使用 Digital Ocean 中已经安装好 Docker 的云主机直接操作。本篇文章所使用的 Docker 版本为 1.6.0，同时文中所有的命令都需要 root 权限。</p>\n<h2 id="技巧"><a href="#%E6%8A%80%E5%B7%A7" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>技巧</h2>\n<p>同样，译者在正文开始提供一个操作<code class="language-text">Docker</code>的小知识。下文中也会多次使用到这一点。</p>\n<p><code class="language-text">Docker</code>会为所有已经运行（包括已经停止）的容器随机分配一个唯一的名字和一个唯一的 ID，docker 命令可以识别 ID，也可以识别这个名字。</p>\n<p>\n  <a\n    class="gatsby-resp-image-link"\n    href="/static/2697097349-56fe3e372067b_articlex-ef4098f015138f2ad35fee52d74bea57-fee1c.png"\n    style="display: block"\n    target="_blank"\n    rel="noopener"\n  >\n  \n  <span\n    class="gatsby-resp-image-wrapper"\n    style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;"\n  >\n    <span\n      class="gatsby-resp-image-background-image"\n      style="padding-bottom: 16.249999999999996%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAIAAAAcOLh5AAAACXBIWXMAAA7DAAAOwwHHb6hkAAAAhElEQVQI1x2Oaw4DIQiE9zZNmqYr+ELWqtvEGL3/gTqWH2SA+SYcay0RUdUxRs4XdGstipRSsGTilFKM8fF8GSJrLXTvXWI0xhxzTihYAePGzPf9rbVuOCViRhwAQ2z+FcKGVdOG4fPeee8/OcMXQkA/3ycQZBHRtUthEPyg6pzDjA74B3KoJ6W9mQpfAAAAAElFTkSuQmCC\'); background-size: cover; display: block;"\n    >\n      <img\n        class="gatsby-resp-image-image"\n        style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;"\n        alt="2697097349 56fe3e372067b articlex"\n        title=""\n        src="/static/2697097349-56fe3e372067b_articlex-ef4098f015138f2ad35fee52d74bea57-fee1c.png"\n        srcset="/static/2697097349-56fe3e372067b_articlex-ef4098f015138f2ad35fee52d74bea57-a67b7.png 200w,\n/static/2697097349-56fe3e372067b_articlex-ef4098f015138f2ad35fee52d74bea57-0b187.png 400w,\n/static/2697097349-56fe3e372067b_articlex-ef4098f015138f2ad35fee52d74bea57-fee1c.png 800w"\n        sizes="(max-width: 800px) 100vw, 800px"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<p>如图所示，第一行的容器的 ID 是 43de70a54ec1，名字是 admiring_ardinghelli</p>\n<p>想删除第一行对应的容器，我们只需要 docker rm 43de70a54ec1,或者简写成 docker rm 43de，或者 docker rm admiring_ardinghelli。</p>\n<h2 id="容器去哪儿了？"><a href="#%E5%AE%B9%E5%99%A8%E5%8E%BB%E5%93%AA%E5%84%BF%E4%BA%86%EF%BC%9F" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>容器去哪儿了？</h2>\n<p>刚开始使用 Docker 的用户会发现，运行完一个容器，再次运行这个容器，原来的容器内的内容已经消失了，例如：</p>\n<p>现在我们使用 -i（交互式）和 -t（临时终端）参数运行一个容器，然后输入一些交互命令：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="87722625914836220000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`(HOST) # docker run -it ubuntu /bin/bash\n(CONTAINER) root@1f608dc4e5b4:/# echo hello docker > /message.txt\n(CONTAINER) root@1f608dc4e5b4:/# cat /message.txt\nhello docker\n(CONTAINER) root@1f608dc4e5b4:/# exit`, `87722625914836220000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                data-tooltip="复制"\n              >\n                <svg class="gatsby-code-button-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0V0z"/><path d="M16 1H2v16h2V3h12V1zm-1 4l6 6v12H6V5h9zm-1 7h5.5L14 6.5V12z"/></svg>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash"><span class="token punctuation">(</span>HOST<span class="token punctuation">)</span> <span class="token comment"># docker run -it ubuntu /bin/bash</span>\n<span class="token punctuation">(</span>CONTAINER<span class="token punctuation">)</span> root@1f608dc4e5b4:/<span class="token comment"># echo hello docker > /message.txt</span>\n<span class="token punctuation">(</span>CONTAINER<span class="token punctuation">)</span> root@1f608dc4e5b4:/<span class="token comment"># cat /message.txt</span>\nhello docker\n<span class="token punctuation">(</span>CONTAINER<span class="token punctuation">)</span> root@1f608dc4e5b4:/<span class="token comment"># exit</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>在上面那个容器内，我们创建了 /message.txt 文件，现在我们尝试重新读取这个文件：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="61662935993146830000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`(HOST) # docker run -it ubuntu cat /message.txt\ncat: /message.txt: No such file or directory`, `61662935993146830000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                data-tooltip="复制"\n              >\n                <svg class="gatsby-code-button-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0V0z"/><path d="M16 1H2v16h2V3h12V1zm-1 4l6 6v12H6V5h9zm-1 7h5.5L14 6.5V12z"/></svg>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash"><span class="token punctuation">(</span>HOST<span class="token punctuation">)</span> <span class="token comment"># docker run -it ubuntu cat /message.txt</span>\ncat: /message.txt: No such <span class="token function">file</span> or directory</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p>刚刚我们明明新建了这个文件，现在怎么没了？</p>\n<p>同时，运行 docker ps 列出容器，刚刚那个 1f608dc4e5b4 容器到哪里去了？</p>\n<p>好吧，那么我们用 docker ps -a 命令列出所有容器，然后仔细观察一下：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="41674823133298350000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`(HOST) # docker ps -a\nCONTAINER ID        IMAGE                 COMMAND              CREATED             STATUS                      PORTS               NAMES\nb3d8c3ef31a0        ubuntu:latest         &quot;cat /message.txt&quot;   33 minutes ago      Exited (1) 33 minutes ago                       admiring_lalande\n1f608dc4e5b4        ubuntu:latest         &quot;/bin/bash&quot;          34 minutes ago      Exited (0) 15 minutes ago                       insane_wright`, `41674823133298350000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                data-tooltip="复制"\n              >\n                <svg class="gatsby-code-button-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0V0z"/><path d="M16 1H2v16h2V3h12V1zm-1 4l6 6v12H6V5h9zm-1 7h5.5L14 6.5V12z"/></svg>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash"><span class="token punctuation">(</span>HOST<span class="token punctuation">)</span> <span class="token comment"># docker ps -a</span>\nCONTAINER ID        IMAGE                 COMMAND              CREATED             STATUS                      PORTS               NAMES\nb3d8c3ef31a0        ubuntu:latest         <span class="token string">"cat /message.txt"</span>   <span class="token number">33</span> minutes ago      Exited <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token number">33</span> minutes ago                       admiring_lalande\n1f608dc4e5b4        ubuntu:latest         <span class="token string">"/bin/bash"</span>          <span class="token number">34</span> minutes ago      Exited <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token number">15</span> minutes ago                       insane_wright</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>现在大家应该可以发现问题了：居然有两个不同的容器，一个执行了 /bin/bash，一个执行了 cat /message.txt。</p>\n<p>在本专栏以往的文章中，多次提到：Docker 使用一个叫做 UnionFS 的层级文件系统进行镜像操作。容器对镜像文件的所有操作均是在虚拟出的“改动层”上进行的。当然对容器而言，UnionFS 和普通的文件系统并无差别，也无法看到任何“改动层”。</p>\n<p>每次运行 docker run 命令的时候，Docker 都会指定新建容器，并且为容器自己的改动层。所以我们两次都运行了 ubuntu 镜像，那么我们也将会有两个新的、不同的容器，每个容器也都会有自己独立的的“改动层”。因此，在第一个容器内创建的 /message.txt 文件在第二个容器内是无法访问的。当然，要是能互相访问，那我们就得为 Docker 的安全性担心了。</p>\n<h2 id="容器到底去哪儿了？"><a href="#%E5%AE%B9%E5%99%A8%E5%88%B0%E5%BA%95%E5%8E%BB%E5%93%AA%E5%84%BF%E4%BA%86%EF%BC%9F" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>容器到底去哪儿了？</h2>\n<blockquote>\n<p>刚刚的问题是：“容器去哪儿了？” 现在的问题是：“容器到底去哪儿了？我需要里面的 message.txt 文件，怎么才能取出来？”</p>\n</blockquote>\n<p>已经停止的容器中的数据并不会消失，而是被存储在相应的“改动层”中。我们可以通过 docker ps -a 进行查找容器。在这个例子中，我们要找的容器便是执行了 /bin/bash 命令的容器，ID 是 1f608dc4e5b4，名称是 insane_wright。</p>\n<p>对比起 ID，容器的名称更加易读。因此在本篇文章后面的例子中，我都将用名称来进行操作和识别容器。当然，你也可以在 docker run 的时候用 —name 参数指定容器的名称。</p>\n<p>那么现在我们现在运行上面例子中已经停止的 insane_wright 容器：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="46935232382207250000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`(HOST) # docker start -ai insane_wright\n(CONTAINER) root@1f608dc4e5b4:/# cat /message.txt\nhello docker\n(CONTAINER) root@1f608dc4e5b4:/# exit`, `46935232382207250000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                data-tooltip="复制"\n              >\n                <svg class="gatsby-code-button-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0V0z"/><path d="M16 1H2v16h2V3h12V1zm-1 4l6 6v12H6V5h9zm-1 7h5.5L14 6.5V12z"/></svg>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash"><span class="token punctuation">(</span>HOST<span class="token punctuation">)</span> <span class="token comment"># docker start -ai insane_wright</span>\n<span class="token punctuation">(</span>CONTAINER<span class="token punctuation">)</span> root@1f608dc4e5b4:/<span class="token comment"># cat /message.txt</span>\nhello docker\n<span class="token punctuation">(</span>CONTAINER<span class="token punctuation">)</span> root@1f608dc4e5b4:/<span class="token comment"># exit</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>使用 -a 参数将容器的输出导出到终端，同时使用 -i 参数进行交互式的操作。这条命令可以让我们继续运行容器 insane_wright，现在你应该能看得到我们刚刚创建的 /message.txt 文件了。</p>\n<h2 id="容器能不能提取出来？"><a href="#%E5%AE%B9%E5%99%A8%E8%83%BD%E4%B8%8D%E8%83%BD%E6%8F%90%E5%8F%96%E5%87%BA%E6%9D%A5%EF%BC%9F" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>容器能不能提取出来？</h2>\n<blockquote>\n<p>现在我们已经运行了自己的容器，容器内也有独立的数据，我们也知道如何获取容器内的数据，那么问题来了：我们能不能把这个状态下的容器给保存起来？</p>\n</blockquote>\n<p>本专栏前面的文章提到过得益于 UnionFS，对于 Docker 来说，其实容器和镜像的差别并不大。容器可以认为是已经运行过的或正在运行的镜像，只不过是镜像上面添加了几个改动层。当然，大部分镜像也是如此。例如某些 mysql 镜像，便仅仅是在官方 ubuntu 镜像的基础上增加了一个 mysql 改动层。</p>\n<p>对于上面例子中的容器，我们可以用下面这条命令将其打包成镜像：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="40875144207202820000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`(HOST) \\$ docker commit -a &quot;Jordan Bach&quot; -m &quot;saved my message&quot; insane_wright jbgo/message:v0.0.1\n1c9195e4c24c894a274f857a60b46fb828ee70ff0e78d18017dfb79c5bf68409`, `40875144207202820000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                data-tooltip="复制"\n              >\n                <svg class="gatsby-code-button-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0V0z"/><path d="M16 1H2v16h2V3h12V1zm-1 4l6 6v12H6V5h9zm-1 7h5.5L14 6.5V12z"/></svg>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash"><span class="token punctuation">(</span>HOST<span class="token punctuation">)</span> $ docker commit -a <span class="token string">"Jordan Bach"</span> -m <span class="token string">"saved my message"</span> insane_wright jbgo/message:v0.0.1\n1c9195e4c24c894a274f857a60b46fb828ee70ff0e78d18017dfb79c5bf68409</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p>本条命令将容器 insange_wright 的改动层的属性变为“只读”，并且指定存储为 jbgo/message 镜像。镜像基于原 ubuntu 镜像，增加了一个改动层，标签为 v0.0.1。标签可以为任意，当然一般用来记录版本信息。</p>\n<p>当然，如果你打算自己尝试的话，记得将我的名字 jbgo 替换为你自己在 Docker Hub 上的用户名。即便你没有 Docker Hub 账户，也要养成给镜像做签名的习惯。</p>\n<p>可以用如下命令检查当前的镜像：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="72326282231346225000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`(HOST) # docker images\nREPOSITORY          TAG                 IMAGE ID            CREATED             VIRTUAL SIZE\njbgo/message        v0.0.1              1c9195e4c24c        18 seconds ago      188.3 MB\nubuntu              latest              b7cf8f0d9e82        4 days ago          188.3 MB`, `72326282231346225000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                data-tooltip="复制"\n              >\n                <svg class="gatsby-code-button-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0V0z"/><path d="M16 1H2v16h2V3h12V1zm-1 4l6 6v12H6V5h9zm-1 7h5.5L14 6.5V12z"/></svg>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash"><span class="token punctuation">(</span>HOST<span class="token punctuation">)</span> <span class="token comment"># docker images</span>\nREPOSITORY          TAG                 IMAGE ID            CREATED             VIRTUAL SIZE\njbgo/message        v0.0.1              1c9195e4c24c        <span class="token number">18</span> seconds ago      <span class="token number">188.3</span> MB\nubuntu              latest              b7cf8f0d9e82        <span class="token number">4</span> days ago          <span class="token number">188.3</span> MB</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>现在我们有两个镜像了：一个是原有的 ubuntu 镜像，镜像是我们在刚开始进行 docker run 的时候自动从 Docker Hub 上面下载下来的；另一个便是我们刚刚保存的，有一个 /message.txt 文件的镜像。</p>\n<p>不信？那我运行给你看。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="76411539945680370000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`(HOST) # docker run -it jbgo/message:v0.0.1 cat /message.txt\nhello docker\n这里我们并没有运行刚刚的 insane_wright 容器，而是运行了我们刚刚保存的镜像。\n我们确实把刚刚的容器保存为一个新的镜像了。`, `76411539945680370000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                data-tooltip="复制"\n              >\n                <svg class="gatsby-code-button-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0V0z"/><path d="M16 1H2v16h2V3h12V1zm-1 4l6 6v12H6V5h9zm-1 7h5.5L14 6.5V12z"/></svg>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash"><span class="token punctuation">(</span>HOST<span class="token punctuation">)</span> <span class="token comment"># docker run -it jbgo/message:v0.0.1 cat /message.txt</span>\nhello docker\n这里我们并没有运行刚刚的 insane_wright 容器，而是运行了我们刚刚保存的镜像。\n我们确实把刚刚的容器保存为一个新的镜像了。</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>还不信？那我检查给你看。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="94802785722902200000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`(HOST) # docker ps -a\nCONTAINER ID        IMAGE                 COMMAND              CREATED             STATUS                      PORTS               NAMES\n01bd4c098203        jbgo/message:v0.0.1   &quot;cat /message.txt&quot;   10 seconds ago      Exited (0) 9 seconds ago                        hopeful_lovelace\nb3d8c3ef31a0        ubuntu:latest         &quot;cat /message.txt&quot;   33 minutes ago      Exited (1) 33 minutes ago                       admiring_lalande\n1f608dc4e5b4        ubuntu:latest         &quot;/bin/bash&quot;          34 minutes ago      Exited (0) 15 minutes ago                       insane_wright`, `94802785722902200000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                data-tooltip="复制"\n              >\n                <svg class="gatsby-code-button-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0V0z"/><path d="M16 1H2v16h2V3h12V1zm-1 4l6 6v12H6V5h9zm-1 7h5.5L14 6.5V12z"/></svg>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash"><span class="token punctuation">(</span>HOST<span class="token punctuation">)</span> <span class="token comment"># docker ps -a</span>\nCONTAINER ID        IMAGE                 COMMAND              CREATED             STATUS                      PORTS               NAMES\n01bd4c098203        jbgo/message:v0.0.1   <span class="token string">"cat /message.txt"</span>   <span class="token number">10</span> seconds ago      Exited <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token number">9</span> seconds ago                        hopeful_lovelace\nb3d8c3ef31a0        ubuntu:latest         <span class="token string">"cat /message.txt"</span>   <span class="token number">33</span> minutes ago      Exited <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token number">33</span> minutes ago                       admiring_lalande\n1f608dc4e5b4        ubuntu:latest         <span class="token string">"/bin/bash"</span>          <span class="token number">34</span> minutes ago      Exited <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token number">15</span> minutes ago                       insane_wright</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>容器运行记录里面多了一个叫做 hopeful_lovelace 的容器，是运行 jdgo/message:v0.0.1 镜像而创建的这个容器。</p>\n<h2 id="如何备份镜像？"><a href="#%E5%A6%82%E4%BD%95%E5%A4%87%E4%BB%BD%E9%95%9C%E5%83%8F%EF%BC%9F" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>如何备份镜像？</h2>\n<blockquote>\n<p>上面我们创建了带有一个 /message.txt 文件的镜像，也用它运行了容器，那么如果 Docker 宿主机崩溃了或者文件消失了怎么办？如何保证我们创建的镜像在系统崩溃后仍然不丢失？</p>\n</blockquote>\n<p>我们需要 Docker Registry，可以存储和下载镜像的地方。Docker Hub 官方提供了 Docker Hub Registry 让我们来存储镜像，当然我们也可以自己搭建 Docker Registry。本篇文章将会使用 Docker Hub Registry，如果你想按照本文中继续操作的话，记得将我的名字 jbgo 换成你自己在 Docker Hub 上的用户名。</p>\n<p>使用如下操作将镜像上传到 Docker Registry 上：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="32954084224434754000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`(HOST) # docker push jbgo/message\nThe push refers to a repository [jbgo/message] (len: 1)\n1c9195e4c24c: Image push failed\n\nPlease login prior to push:\nUsername: jbgo\nPassword:\nEmail: jordanbach@gmail.com\nWARNING: login credentials saved in /root/.dockercfg.\nLogin Succeeded\nThe push refers to a repository [jbgo/message] (len: 1)\n1c9195e4c24c: Image already exists\nb7cf8f0d9e82: Image successfully pushed\n2c014f14d3d9: Image successfully pushed\na62a42e77c9c: Image successfully pushed\n706766fe1019: Image successfully pushed\nDigest: sha256:b2a98b19e06a4df91150f8a2cd47a6e440cbc13b39f1fc235d46f97f631ad117`, `32954084224434754000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                data-tooltip="复制"\n              >\n                <svg class="gatsby-code-button-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0V0z"/><path d="M16 1H2v16h2V3h12V1zm-1 4l6 6v12H6V5h9zm-1 7h5.5L14 6.5V12z"/></svg>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash"><span class="token punctuation">(</span>HOST<span class="token punctuation">)</span> <span class="token comment"># docker push jbgo/message</span>\nThe push refers to a repository <span class="token punctuation">[</span>jbgo/message<span class="token punctuation">]</span> <span class="token punctuation">(</span>len: <span class="token number">1</span><span class="token punctuation">)</span>\n1c9195e4c24c: Image push failed\n\nPlease login prior to push:\nUsername: jbgo\nPassword:\nEmail: jordanbach@gmail.com\nWARNING: login credentials saved <span class="token keyword">in</span> /root/.dockercfg.\nLogin Succeeded\nThe push refers to a repository <span class="token punctuation">[</span>jbgo/message<span class="token punctuation">]</span> <span class="token punctuation">(</span>len: <span class="token number">1</span><span class="token punctuation">)</span>\n1c9195e4c24c: Image already exists\nb7cf8f0d9e82: Image successfully pushed\n2c014f14d3d9: Image successfully pushed\na62a42e77c9c: Image successfully pushed\n706766fe1019: Image successfully pushed\nDigest: sha256:b2a98b19e06a4df91150f8a2cd47a6e440cbc13b39f1fc235d46f97f631ad117</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>因为我是第一次在本机执行 docker push 操作，所以 Docker Registry 需要验证我的身份。</p>\n<p>本次上传的镜像被保存在这里。你可以使用 docker pull jbgo/message 来下载我的镜像。</p>\n<p>当然，如果你按照上面的来操作的话，可能会出现一点小问题：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="98986741502625550000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`(HOST) # docker pull jbgo/message\nPulling repository jbgo/message\nFATA[0007] Tag latest not found in repository jbgo/message`, `98986741502625550000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                data-tooltip="复制"\n              >\n                <svg class="gatsby-code-button-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0V0z"/><path d="M16 1H2v16h2V3h12V1zm-1 4l6 6v12H6V5h9zm-1 7h5.5L14 6.5V12z"/></svg>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash"><span class="token punctuation">(</span>HOST<span class="token punctuation">)</span> <span class="token comment"># docker pull jbgo/message</span>\nPulling repository jbgo/message\nFATA<span class="token punctuation">[</span>0007<span class="token punctuation">]</span> Tag latest not found <span class="token keyword">in</span> repository jbgo/message</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>下面我来解释一下到底出了什么问题：当你使用 docker push jbgo/message 命令的时候，默认上传标签为 latest 的镜像。如果没有便会报错。你可以采用如下命令解决： docker tag jbgo/message:v0.0.1 jbgo/message:latest。这次再尝试推送：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="83510003439430520000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`(HOST) # docker push jbgo/message:latest\nThe push refers to a repository [jbgo/message] (len: 1)\n1c9195e4c24c: Image already exists\nb7cf8f0d9e82: Image already exists\n2c014f14d3d9: Image already exists\na62a42e77c9c: Image already exists\n706766fe1019: Image already exists\nDigest: sha256:cc2fbbb2029c6402cea639b2454da08ef05672da81176ae97f57d4f51be19fc3`, `83510003439430520000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                data-tooltip="复制"\n              >\n                <svg class="gatsby-code-button-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0V0z"/><path d="M16 1H2v16h2V3h12V1zm-1 4l6 6v12H6V5h9zm-1 7h5.5L14 6.5V12z"/></svg>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash"><span class="token punctuation">(</span>HOST<span class="token punctuation">)</span> <span class="token comment"># docker push jbgo/message:latest</span>\nThe push refers to a repository <span class="token punctuation">[</span>jbgo/message<span class="token punctuation">]</span> <span class="token punctuation">(</span>len: <span class="token number">1</span><span class="token punctuation">)</span>\n1c9195e4c24c: Image already exists\nb7cf8f0d9e82: Image already exists\n2c014f14d3d9: Image already exists\na62a42e77c9c: Image already exists\n706766fe1019: Image already exists\nDigest: sha256:cc2fbbb2029c6402cea639b2454da08ef05672da81176ae97f57d4f51be19fc3</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>这次上传会快得多，因为服务器上已经有了这个镜像，我们上传的仅仅是相同镜像的不同标签而已。</p>\n<p>你不信？那我验证给你看：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="42827077000066560000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`(HOST) # docker pull jbgo/message\nlatest: Pulling from jbgo/message\n1c9195e4c24c: Already exists\n706766fe1019: Already exists\na62a42e77c9c: Already exists\n2c014f14d3d9: Already exists\nb7cf8f0d9e82: Already exists\nDigest: sha256:cc2fbbb2029c6402cea639b2454da08ef05672da81176ae97f57d4f51be19fc3\nStatus: Downloaded newer image for jbgo/message:latest`, `42827077000066560000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                data-tooltip="复制"\n              >\n                <svg class="gatsby-code-button-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0V0z"/><path d="M16 1H2v16h2V3h12V1zm-1 4l6 6v12H6V5h9zm-1 7h5.5L14 6.5V12z"/></svg>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash"><span class="token punctuation">(</span>HOST<span class="token punctuation">)</span> <span class="token comment"># docker pull jbgo/message</span>\nlatest: Pulling from jbgo/message\n1c9195e4c24c: Already exists\n706766fe1019: Already exists\na62a42e77c9c: Already exists\n2c014f14d3d9: Already exists\nb7cf8f0d9e82: Already exists\nDigest: sha256:cc2fbbb2029c6402cea639b2454da08ef05672da81176ae97f57d4f51be19fc3\nStatus: Downloaded newer image <span class="token keyword">for</span> jbgo/message:latest</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>当然，别台服务器一样可以使用这个命令下载我的镜像。</p>\n<p>当然，也可以使用如下命令上传特定标签的镜像：docker push jbgo/message:v0.0.1。建议使用版本标签标记镜像，并推送特定版本标签的镜像和 latest 标签的镜像。</p>\n<h2 id="使用完毕的容器如何处理？"><a href="#%E4%BD%BF%E7%94%A8%E5%AE%8C%E6%AF%95%E7%9A%84%E5%AE%B9%E5%99%A8%E5%A6%82%E4%BD%95%E5%A4%84%E7%90%86%EF%BC%9F" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>使用完毕的容器如何处理？</h2>\n<blockquote>\n<p>上面只是介绍了容器如何理解容器和镜像，如果有很多历史容器被保存在硬盘上，想要释放掉这些空间，我们应该怎么做？</p>\n</blockquote>\n<p>使用如下命令删除多个容器：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="79316671847378960000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`(HOST) # docker rm hopeful_lovelace insane_wright admiring_lalande\nhopeful_lovelace\ninsane_wright\nadmiring_lalande`, `79316671847378960000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                data-tooltip="复制"\n              >\n                <svg class="gatsby-code-button-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0V0z"/><path d="M16 1H2v16h2V3h12V1zm-1 4l6 6v12H6V5h9zm-1 7h5.5L14 6.5V12z"/></svg>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash"><span class="token punctuation">(</span>HOST<span class="token punctuation">)</span> <span class="token comment"># docker rm hopeful_lovelace insane_wright admiring_lalande</span>\nhopeful_lovelace\ninsane_wright\nadmiring_lalande</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>现在再检查一下还有没有这些容器：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="53915210746314605000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`(HOST) # docker ps -a\nCONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS               NAMES`, `53915210746314605000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                data-tooltip="复制"\n              >\n                <svg class="gatsby-code-button-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0V0z"/><path d="M16 1H2v16h2V3h12V1zm-1 4l6 6v12H6V5h9zm-1 7h5.5L14 6.5V12z"/></svg>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash"><span class="token punctuation">(</span>HOST<span class="token punctuation">)</span> <span class="token comment"># docker ps -a</span>\nCONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS               NAMES</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p>我们运行的所有容器和所有的历史容器都会被保存在硬盘上，除非你手动 docker rm 它们。手动删除的容器不能恢复。</p>\n<h2 id="为什么上传了不止一个镜像？"><a href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E4%B8%8A%E4%BC%A0%E4%BA%86%E4%B8%8D%E6%AD%A2%E4%B8%80%E4%B8%AA%E9%95%9C%E5%83%8F%EF%BC%9F" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>为什么上传了不止一个镜像？</h2>\n<p>有心人注意到，刚刚我们第一次上传 jbgo/message 镜像的时候，Docker 上传了不止一个镜像。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="71250426317352760000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`(HOST) # docker push jbgo/message:v0.0.1\n...\n1c9195e4c24c: Image already exists\nb7cf8f0d9e82: Image successfully pushed\n2c014f14d3d9: Image successfully pushed\na62a42e77c9c: Image successfully pushed\n706766fe1019: Image successfully pushed`, `71250426317352760000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                data-tooltip="复制"\n              >\n                <svg class="gatsby-code-button-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0V0z"/><path d="M16 1H2v16h2V3h12V1zm-1 4l6 6v12H6V5h9zm-1 7h5.5L14 6.5V12z"/></svg>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash"><span class="token punctuation">(</span>HOST<span class="token punctuation">)</span> <span class="token comment"># docker push jbgo/message:v0.0.1</span>\n<span class="token punctuation">..</span>.\n1c9195e4c24c: Image already exists\nb7cf8f0d9e82: Image successfully pushed\n2c014f14d3d9: Image successfully pushed\na62a42e77c9c: Image successfully pushed\n706766fe1019: Image successfully pushed</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id="到底发生了什么？"><a href="#%E5%88%B0%E5%BA%95%E5%8F%91%E7%94%9F%E4%BA%86%E4%BB%80%E4%B9%88%EF%BC%9F" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>到底发生了什么？</h2>\n<p>首先使用 docker history 检查一下镜像改动历史：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="12432194518984274000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`(HOST) # docker history jbgo/message:v0.0.1\nIMAGE               CREATED             CREATED BY                                      SIZE\n1c9195e4c24c        33 minutes ago      /bin/bash                                       108 B\nb7cf8f0d9e82        4 days ago          /bin/sh -c #(nop) CMD [&quot;/bin/bash&quot;]             0 B\n2c014f14d3d9        4 days ago          /bin/sh -c sed -i \'s/^#\\s*\\(deb.*universe\\)\\$/   1.895 kB\na62a42e77c9c        4 days ago          /bin/sh -c echo \'#!/bin/sh\' > /usr/sbin/polic   194.5 kB\n706766fe1019        4 days ago          /bin/sh -c #(nop) ADD file:777fad733fc954c0c1   188.1 MB`, `12432194518984274000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                data-tooltip="复制"\n              >\n                <svg class="gatsby-code-button-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0V0z"/><path d="M16 1H2v16h2V3h12V1zm-1 4l6 6v12H6V5h9zm-1 7h5.5L14 6.5V12z"/></svg>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash"><span class="token punctuation">(</span>HOST<span class="token punctuation">)</span> <span class="token comment"># docker history jbgo/message:v0.0.1</span>\nIMAGE               CREATED             CREATED BY                                      SIZE\n1c9195e4c24c        <span class="token number">33</span> minutes ago      /bin/bash                                       <span class="token number">108</span> B\nb7cf8f0d9e82        <span class="token number">4</span> days ago          /bin/sh -c <span class="token comment">#(nop) CMD ["/bin/bash"]             0 B</span>\n2c014f14d3d9        <span class="token number">4</span> days ago          /bin/sh -c <span class="token function">sed</span> -i <span class="token string">\'s/^#\\s*\\(deb.*universe\\)$/   1.895 kB\na62a42e77c9c        4 days ago          /bin/sh -c echo \'</span><span class="token comment">#!/bin/sh\' > /usr/sbin/polic   194.5 kB</span>\n706766fe1019        <span class="token number">4</span> days ago          /bin/sh -c <span class="token comment">#(nop) ADD file:777fad733fc954c0c1   188.1 MB</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>会发现，其实我们创建了不止一个镜像，也就是有不止一个改动层。使用 docker inspect 命令仔细观察第一个镜像（第一层）进行过的改动：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="17962324293314680000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`(HOST) # docker inspect 1c9195e4c24c\n[{\n    &quot;Architecture&quot;: &quot;amd64&quot;,\n    &quot;Author&quot;: &quot;Jordan Bach&quot;,\n    &quot;Comment&quot;: &quot;saved my message&quot;,\n    &quot;Config&quot;: {`, `17962324293314680000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                data-tooltip="复制"\n              >\n                <svg class="gatsby-code-button-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0V0z"/><path d="M16 1H2v16h2V3h12V1zm-1 4l6 6v12H6V5h9zm-1 7h5.5L14 6.5V12z"/></svg>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash"><span class="token punctuation">(</span>HOST<span class="token punctuation">)</span> <span class="token comment"># docker inspect 1c9195e4c24c</span>\n<span class="token punctuation">[</span><span class="token punctuation">{</span>\n    <span class="token string">"Architecture"</span><span class="token builtin class-name">:</span> <span class="token string">"amd64"</span>,\n    <span class="token string">"Author"</span><span class="token builtin class-name">:</span> <span class="token string">"Jordan Bach"</span>,\n    <span class="token string">"Comment"</span><span class="token builtin class-name">:</span> <span class="token string">"saved my message"</span>,\n    <span class="token string">"Config"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>这个肯定就是我们的 /message.txt 改动层了，那么其他的那么多是什么？</p>\n<p>jbgo/message 是基于 ubuntu 镜像的，我们来检查一下 ubuntu 镜像的改动历史：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="83181224180233880000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`(HOST) # docker history ubuntu\nIMAGE               CREATED             CREATED BY                                      SIZE\nb7cf8f0d9e82        4 days ago          /bin/sh -c #(nop) CMD [&quot;/bin/bash&quot;]             0 B\n2c014f14d3d9        4 days ago          /bin/sh -c sed -i \'s/^#\\s*\\(deb.*universe\\)\\$/   1.895 kB\na62a42e77c9c        4 days ago          /bin/sh -c echo \'#!/bin/sh\' > /usr/sbin/polic   194.5 kB\n706766fe1019        4 days ago          /bin/sh -c #(nop) ADD file:777fad733fc954c0c1   188.1 MB`, `83181224180233880000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                data-tooltip="复制"\n              >\n                <svg class="gatsby-code-button-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0V0z"/><path d="M16 1H2v16h2V3h12V1zm-1 4l6 6v12H6V5h9zm-1 7h5.5L14 6.5V12z"/></svg>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash"><span class="token punctuation">(</span>HOST<span class="token punctuation">)</span> <span class="token comment"># docker history ubuntu</span>\nIMAGE               CREATED             CREATED BY                                      SIZE\nb7cf8f0d9e82        <span class="token number">4</span> days ago          /bin/sh -c <span class="token comment">#(nop) CMD ["/bin/bash"]             0 B</span>\n2c014f14d3d9        <span class="token number">4</span> days ago          /bin/sh -c <span class="token function">sed</span> -i <span class="token string">\'s/^#\\s*\\(deb.*universe\\)$/   1.895 kB\na62a42e77c9c        4 days ago          /bin/sh -c echo \'</span><span class="token comment">#!/bin/sh\' > /usr/sbin/polic   194.5 kB</span>\n706766fe1019        <span class="token number">4</span> days ago          /bin/sh -c <span class="token comment">#(nop) ADD file:777fad733fc954c0c1   188.1 MB</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>那么这样一切就很明确了：那些是 ubuntu 镜像的改动历史。为了确保本地和上传到 Docker Hub 的镜像一致，我们上传到 Docker Hub 中的镜像便是包含着五层改动层的新镜像。</p>\n<h2 id="如何删除镜像？"><a href="#%E5%A6%82%E4%BD%95%E5%88%A0%E9%99%A4%E9%95%9C%E5%83%8F%EF%BC%9F" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>如何删除镜像？</h2>\n<blockquote>\n<p>前面提到过，我们删除容器，那么我们本机上仍然保存着镜像，如何删掉它们？</p>\n</blockquote>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="90347251044920460000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`（HOST） # docker rmi jbgo/message\nError response from daemon: Conflict, cannot delete 1c9195e4c24c because the container 2ea39e64a130 is using it, use -f to force\nFATA[0000] Error: failed to remove one or more images`, `90347251044920460000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                data-tooltip="复制"\n              >\n                <svg class="gatsby-code-button-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0V0z"/><path d="M16 1H2v16h2V3h12V1zm-1 4l6 6v12H6V5h9zm-1 7h5.5L14 6.5V12z"/></svg>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">（HOST） <span class="token comment"># docker rmi jbgo/message</span>\nError response from daemon: Conflict, cannot delete 1c9195e4c24c because the container 2ea39e64a130 is using it, use -f to force\nFATA<span class="token punctuation">[</span>0000<span class="token punctuation">]</span> Error: failed to remove one or <span class="token function">more</span> images</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>提示出错了，根据错误信息可以看出，还有容器在用这一个镜像。</p>\n<p>但是我们没有正在运行着的容器啊，到底哪儿出错了？</p>\n<p>检查所有容器，发现容器 2ea39e64a130。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="78609063525287740000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`(HOST) # docker ps -a\nCONTAINER ID        IMAGE                 COMMAND              CREATED             STATUS                     PORTS               NAMES\n2ea39e64a130        jbgo/message:latest   &quot;cat /message.txt&quot;   2 minutes ago       Exited (0) 2 minutes ago                       lonely_jones`, `78609063525287740000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                data-tooltip="复制"\n              >\n                <svg class="gatsby-code-button-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0V0z"/><path d="M16 1H2v16h2V3h12V1zm-1 4l6 6v12H6V5h9zm-1 7h5.5L14 6.5V12z"/></svg>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash"><span class="token punctuation">(</span>HOST<span class="token punctuation">)</span> <span class="token comment"># docker ps -a</span>\nCONTAINER ID        IMAGE                 COMMAND              CREATED             STATUS                     PORTS               NAMES\n2ea39e64a130        jbgo/message:latest   <span class="token string">"cat /message.txt"</span>   <span class="token number">2</span> minutes ago       Exited <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token number">2</span> minutes ago                       lonely_jones</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>当然，这是 Docker 的机制：如果你仍然有容器的历史记录，那么为了确保你能再次启动这个容器，这些镜像是不能删除的。</p>\n<p>首先删除掉这个容器：docker rm lonely_jones。</p>\n<p>然后删除镜像：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="11841240411800058000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`(HOST) # docker rmi jbgo/message\nUntagged: jbgo/message:latest\nDeleted: 1c9195e4c24c894a274f857a60b46fb828ee70ff0e78d18017dfb79c5bf68409\nDeleted: b7cf8f0d9e82c9d96bd7afd22c600bfdb86b8d66c50d29164e5ad2fb02f7187b\nDeleted: 2c014f14d3d95811df672ddae2af376f9557f6b8f5623e3e3f8c5ca3f6ff42e6\nDeleted: a62a42e77c9c3626118dc411092d23cf658220261acdafe21a7589a8eeba627e\nDeleted: 706766fe101906a1a6628173c2677173a5f8c6c469075083f3cf3a8f5e5eb367`, `11841240411800058000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                data-tooltip="复制"\n              >\n                <svg class="gatsby-code-button-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0V0z"/><path d="M16 1H2v16h2V3h12V1zm-1 4l6 6v12H6V5h9zm-1 7h5.5L14 6.5V12z"/></svg>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash"><span class="token punctuation">(</span>HOST<span class="token punctuation">)</span> <span class="token comment"># docker rmi jbgo/message</span>\nUntagged: jbgo/message:latest\nDeleted: 1c9195e4c24c894a274f857a60b46fb828ee70ff0e78d18017dfb79c5bf68409\nDeleted: b7cf8f0d9e82c9d96bd7afd22c600bfdb86b8d66c50d29164e5ad2fb02f7187b\nDeleted: 2c014f14d3d95811df672ddae2af376f9557f6b8f5623e3e3f8c5ca3f6ff42e6\nDeleted: a62a42e77c9c3626118dc411092d23cf658220261acdafe21a7589a8eeba627e\nDeleted: 706766fe101906a1a6628173c2677173a5f8c6c469075083f3cf3a8f5e5eb367</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>这次我们可以很轻松地删除掉 jbgo/message 镜像了。确认一下：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="1991892825084296000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`(HOST) # docker images\nREPOSITORY          TAG                 IMAGE ID            CREATED             VIRTUAL SIZE`, `1991892825084296000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                data-tooltip="复制"\n              >\n                <svg class="gatsby-code-button-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0V0z"/><path d="M16 1H2v16h2V3h12V1zm-1 4l6 6v12H6V5h9zm-1 7h5.5L14 6.5V12z"/></svg>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash"><span class="token punctuation">(</span>HOST<span class="token punctuation">)</span> <span class="token comment"># docker images</span>\nREPOSITORY          TAG                 IMAGE ID            CREATED             VIRTUAL SIZE</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p>确实没了。</p>',
id:"/github/workspace/blog/Docker初步了解/index.md absPath of file >>> MarkdownRemark",timeToRead:10,frontmatter:{date:"2017-12-11 23:32:56",path:"/docker-know/",tags:"后端, Docker, Docker初级入门",title:"Docker初步了解",draft:null}}],length:1,tag:"Docker初级入门",pagesSum:1,page:1}}}});