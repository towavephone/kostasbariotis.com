webpackJsonp([70747314155962],{1179:function(n,s){n.exports={data:{file:{childImageSharp:{sizes:{base64:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAeCAYAAAAsEj5rAAAACXBIWXMAAAsSAAALEgHS3X78AAAHlUlEQVRIx11WaWxU1xWewbQlrdofkSIhGiBpMPZ4Vs/2lpm3zupZPOOZ8Sz2YGzANkaAKaYQUrMkLYgiIlxCQjCYQAwYEoMQNJAIFBxaQgUhoCopYceBJo1pKFVDCbOc0/fesOZKV+fM1Tvf/c56R0VYOZW8lvAxtSybvbExAu1+mndGuaDQ2F4rNHVFhCZJZlMeZ1Qrf9Mt+H+qur/ihFORAFA64J0pVTcXVcDmcKFfruIzZ7rY1H89fAZivjbM1MzFxkAnZqWd9M7KJcTmv7zCN44sY+tflm12C79WLxLCqidWN9cwWpYvsfXL13vasZudgm4mgX4hW6h1teRjnrZCwjOzWO/twIR/FjZ7WnEZ35JvcUSeU4gwSXV7W1sJzEH6R8nSRArlXjr6r7S1DqNUvMAzCXCzSfDxDRAUmyDkaoawtEPi1LxHyGLMkby5gEqUy7atjnq1roosAXqE6Yq7DBXa7RLS6HRG8y4hhbwzDiJbj4IkXUwS5e1h07IOorMePUL6ruiKGmRblg2PesJlq9nxrJMMfydIbhIWP9jMPrBLkrIHgXfG0CdmgKMjwFARFKVvHEQo5xUyKDDRN2T7aE17mV5rfZQYm1lM0EQYWUe0aNTxoKl0Qnk5jVqNA/VaFu3SBS7SB7Ju0ougr2KKWg2DBi17mbCaxyghMzgeMTTp2W7CGkTKHshZqn0Q5Osg6opBhAmAzcADY/NheyQJBi2D8mXVehYMOgEsJg9aTIxSN2YTO+ohQ62G6rGZa5AmAjmj0YvzG5vhVP8f4fTO12FtVxfMjTfC6zPbwOsIQNybhK6GlmLCm5DA6cu2aoeSaaOeVheLxRKgpoJcZ5UAly94MeeiQ+jnQtBCcTBTZ8Ght9fDfy58DDdOHIRj2zdA/4uzYWBpZ6Fr6jR8/lfWP8n2usqA2mQgH7msr3Ks0WgEfGvN6lz/q6tgXqgZjgpZOGSLwsldA4CFG4j3rmP/osU47xkdrm5pLfjdETm+p64cf0fJME34HiVFV+VYajF50UGGc/Nnz4XDfW/ArQ09+M++XsCblwD+fQEL356HswuWwdedS+Dg2p5ilZQwa7VrpCHZ9nOl7Ojg44B0hxxg0hbMjx2rh2iwDk4feReKI58hfn8V8c5lwNyXiF+dRbz4Z1jY1g4TJ1rQbnHfc/ORihJDr5q0kw8AyVqDjpeSEpJLAyaMN6HRwMDuTa/B1fcPwcfbBuHc8SPw+cnDsGvzeim7HOg0DpAYoouPBWUMJxUo65y18X4MtbYJOo3zjgQoxwWen1iNDdPmwPu9+2BvfCXsXbQRehf9Hly0B8aN04OuioGqCipvt/hQ5GLzS4Dh0Tdv3+/nvm0qVVUlfUouboOWK8jxmaznMBXIwpbfroWN63th384tcHTfDpj0gg21lQxoK+m8TQGMb5UxAt6OUYSVkUuGK5MPKiuIHicZwWqDmNNqpE6pIFBjpGDxsqXwuxUroWtBN5w4NgSbNvcDIRW61CUFu9UrtV/si7Fjf/ajUmICSvxKgJMtdQxVK2XOU9RpGNBL3VBeQWIqPR3SjR3QOW8xrFmxCnrWbYJMaobEkr1HE/4zIpv4nrK7NIrbpF+tspoYZdpMLte+wNPRu6S1Bs1GqV/1DOqMPFjIMFbq3dg6cyFkGmagqZqHaoOAHF2XZ6ngWg+XBM4RVoLHOWrLVG4uWpo4FvsvfHz6NktFkbT6QafnQGsUoFLHYm1dFj44cgwYPgQVkymkbP6RWl+LNIRjL/uFhltuNjEoYySCXaNUojOsMPSw4aqwa+o9ga5DggiC1RFDmyMG1bYQVlTSIIhRMJq9RaPZJ4VF+DQZ6MCAmOkLurJ/DYiNt/R67VMKs4hrqjL+o+6mjrj0hjBEOG+1h8FOxcFO1oHVFgazPYQGqdfNthBYpUqwEME78nsT4tP7o96WwWSwA1nKb35iyCZ8M85EXE3oYBO3ab4RKWcSKCaFJJMCQprSpPQcUFwKzWQUKo1+lC9x0r7Fcc+0OVOj8zEkNrY8BAuLDV11ruZvDXrhuJ3NIu+bAYK/FXjfdOA8zegUp6DdmQKNMQD+8HTseW1LYeijE/jB4Q+/Wry8a5L01B6MeaetUcDSjfVjjOVM7da+bTMPvHfkbmrKb5DksjkLncmZqXTe6siAnWmAmkhbYUPvQP7cufO5L69fxyvD/8Ctb+/aI2PU8AmvRGqZAoiIityzb8/T165d3X3t2vD/Pjr+KW7b+R6u2/AOrli9CQfePYQXLg3jpSvDeOLkWTxw6Oh3uwYPrJTMlNHlFcLPeNk6/UOXZ7cuGP1A397fP/7v584vvzJ8o+dvn33+Zm/v9q9X/2EDbN+19+ybm3ds33/ww5f63uovf/D9woVL1A90P5dQqYaGhpQfg4N71BJbteoHqyk7Z+e8zlfuSupPHj+/eO2bso5ZcxQ9Fsiqgny6ZOv3+VTfjIwo+iefnFYN7BxQf3FxuEwGH1c+fgxBuIZnTFuIIh9U2qt3844fb9y0Vf0gXPKm7bzKzYZ+wGTKFFWNz1/6v8OLUiuaFKMJz00yEvaa/RQZnK086s6MutpEqRLx+kcT+rH1f+YikeeNfqnwAAAAAElFTkSuQmCC",aspectRatio:.6666666666666666,src:"/static/avatar-a4ccbab8e7381acb89452773ce94d5a0-25c91.png",srcSet:"/static/avatar-a4ccbab8e7381acb89452773ce94d5a0-8a97b.png 200w,\n/static/avatar-a4ccbab8e7381acb89452773ce94d5a0-0fdf3.png 400w,\n/static/avatar-a4ccbab8e7381acb89452773ce94d5a0-25c91.png 600w",srcWebp:"/static/avatar-a4ccbab8e7381acb89452773ce94d5a0-216f6.webp",srcSetWebp:"/static/avatar-a4ccbab8e7381acb89452773ce94d5a0-5d70e.webp 200w,\n/static/avatar-a4ccbab8e7381acb89452773ce94d5a0-d1677.webp 400w,\n/static/avatar-a4ccbab8e7381acb89452773ce94d5a0-216f6.webp 600w",sizes:"(max-width: 600px) 100vw, 600px"}}},site:{siteMetadata:{title:"女王控的博客",description:'前端工程师，黑猫女王控，欢迎勾搭，技术相关<a href="https://github.com/towavephone" target="_blank">@towavephone</a>，QQ闲聊<a href="tencent://AddContact/?fromId=45&fromSubId=1&subcmd=all&uin=634407147&website=www.oicqzone.com">@towave</a>，bili关注<a href="https://space.bilibili.com/11507708#/" target="_blank">@towave</a>',siteUrl:"https://blog.towavephone.com"}},mainPost:{html:'<p>翻译转载：<a href="https://levelup.gitconnected.com/optimize-react-performance-c1a491ed9c36?ref=reddit&#x26;utm_source=reddit&#x26;utm_medium=react-12-12-2017" target="_blank" rel="nofollow noreferrer noopener">Optimize React Performance</a></p>\n<h1 id="如何提高生产中的-react-性能，避免常见的错误"><a href="#%E5%A6%82%E4%BD%95%E6%8F%90%E9%AB%98%E7%94%9F%E4%BA%A7%E4%B8%AD%E7%9A%84-react-%E6%80%A7%E8%83%BD%EF%BC%8C%E9%81%BF%E5%85%8D%E5%B8%B8%E8%A7%81%E7%9A%84%E9%94%99%E8%AF%AF" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>如何提高生产中的 React 性能，避免常见的错误</h1>\n<blockquote>\n<p>您是否知道 key 在列表中使用不正确可以将 DOM 操作增加 10 倍以上？据了解，React 的 Virtual DOM 实现速度非常快。但是，即使使用 React 的内置性能，也有一些 UI 可能开始感觉迟缓的情况。造成业绩不佳的罪魁祸首是产生了太多渲染和状态同步。我们将介绍 4 种技术，以帮助确保您的应用程序得到优化，并提供快速的用户体验。</p>\n</blockquote>\n<ol>\n<li>key 正确使用</li>\n<li>管理 shouldComponentUpdate</li>\n<li>扩展 PureComponent 而不是 Component</li>\n<li>建立生产</li>\n</ol>\n<h1 id="衡量效率"><a href="#%E8%A1%A1%E9%87%8F%E6%95%88%E7%8E%87" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>衡量效率</h1>\n<p>在深入研究代码之前，了解您正在优化的内容以及它所带来的影响是非常重要的。我建议使用的两个工具是 Lighthouse 和 react-addons-perf。这两个工具都可以通过 NPM（安装<a href="https://www.npmjs.com/package/lighthouse" target="_blank" rel="nofollow noreferrer noopener">1</a>，<a href="https://www.npmjs.com/package/react-addons-perf" target="_blank" rel="nofollow noreferrer noopener">2</a>），并都提供一个浏览器扩展（<a href="https://chrome.google.com/webstore/detail/lighthouse/blipmdconlkpinefehnmjammfjpmpbjk" target="_blank" rel="nofollow noreferrer noopener">1</a>，<a href="https://chrome.google.com/webstore/detail/react-perf/hacmcodfllhbnekmghgdlplbdnahmhmm?hl=en-US" target="_blank" rel="nofollow noreferrer noopener">2</a>）。我个人建议使用 npm for Lighthouse，因为结果似乎更可靠，并使用 React Perf 的 Chrome 扩展。以下是来自 Lighthouse 的输出示例，我们将在以下部分查看 React Perf 的结果。</p>\n<p>\n  <a\n    class="gatsby-resp-image-link"\n    href="/static/1_P0wwSgmIoA48qFnsMbSamg-442b12d0de64d7283e8e0bb549975618-fee1c.png"\n    style="display: block"\n    target="_blank"\n    rel="noopener"\n  >\n  \n  <span\n    class="gatsby-resp-image-wrapper"\n    style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;"\n  >\n    <span\n      class="gatsby-resp-image-background-image"\n      style="padding-bottom: 69%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAIAAACgpqunAAAACXBIWXMAAAsSAAALEgHS3X78AAABrElEQVQoz4VTy27UMBTND7HjBwpC6r5iYMEHQLvqD/BbqKuyREgIdYMqIdRJMjOOEzuOE9t5+BFO0oemmVKOrqIb2eeec33t6MWrLy+PL1Yfv7/99Pvd6fWPqw3nWZxutjuAcMbbth1mOOtuEwsM1hgTvV59PTq5fPP+24fz+Ozzdp3qcbS2YeOMUgnVKSTOO2GEDx65GUzdNUiiX9fk51X854aLOjBmrPVa1RXLoIDloixkI5Hgd1cQSE4VqzLn+USWkiMmlTC60AtRJgBsb7dd18/R9f2U9G1n2kF3zjnv4UTLqKqqshS3JtEWOslzKoTQWoNmZqDt+Wtq1UtlfQjY7FsZhRnjPVCWMYaKUANnf+kB4Q5jtFjw3lNK4zher2PYz0gG/QeCD3sYhkNyqCjNk4RvNjxNabxWjAWtXdN4radQCnlwDlsfkcOk4CXNWJJMQUgl5ZPOZx23VEbPJSGC7Doh2rrGhMK/sSSjQ0JIXhQ47fF/WJIhpZSarmQ/oI1nZN2hbUw4TXG9OUaF2eLwn9S03tKaLsnQxIMArWkaWID59h77teAJ9/wvdxUf23cOg3YAAAAASUVORK5CYII=\'); background-size: cover; display: block;"\n    >\n      <img\n        class="gatsby-resp-image-image"\n        style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;"\n        alt="1 P0wwSgmIoA48qFnsMbSamg"\n        title=""\n        src="/static/1_P0wwSgmIoA48qFnsMbSamg-442b12d0de64d7283e8e0bb549975618-fee1c.png"\n        srcset="/static/1_P0wwSgmIoA48qFnsMbSamg-442b12d0de64d7283e8e0bb549975618-a67b7.png 200w,\n/static/1_P0wwSgmIoA48qFnsMbSamg-442b12d0de64d7283e8e0bb549975618-0b187.png 400w,\n/static/1_P0wwSgmIoA48qFnsMbSamg-442b12d0de64d7283e8e0bb549975618-fee1c.png 800w"\n        sizes="(max-width: 800px) 100vw, 800px"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<p>注意：Lighthouse 从版本 60 开始可以通过 Chrome 本地浏览，而 react-addons-perf 将不再与 React 16.0 +兼容，但以下结果对任何版本的 React 仍然有效。</p>\n<h1 id="正确的使用-key"><a href="#%E6%AD%A3%E7%A1%AE%E7%9A%84%E4%BD%BF%E7%94%A8-key" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>正确的使用 key</h1>\n<p><code class="language-text">key</code>:React 中在应用程序生命周期的任何时刻唯一标识列表中的元素。如果 DOM 被更新，React 能够识别哪些项目已经改变。因此，key 组件上的值必须是唯一的，并且与列表中的同级组件相关。这是 React 开发人员倾向于使用的一个属性，但是不论经验多少的 React 开发人员在生成列表时可能不会真正理解使用该属性。两个常见的错误是使用 index 期间 map(element, index) 或使用 Math.random() 生成一个 key。最好的解决方案是与列表项关联 UUID，但任何唯一标识符都可以。在列表中您将使用 key 的典型场景如下。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="67075161435465610000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`function ListItem(props) {\n  // Correct! There is no need to specify the key here:\n  return <li>{props.value}</li>;\n}\n\nfunction UserList(props) {\n  const users = props.users;\n  const listItems = users.map((user) => (\n    // Correct! Key should be specified inside the array.\n    <ListItem key={user.id.toString()} value={user.name} />\n  ));\n  return <ul>{listItems}</ul>;\n}\n\nconst users = [{ id: 1, name: \'Khaleesi\' }, { id: 2, name: \'Jon\' }, { id: 3, name: \'Arya\' }];\n\n<UserList users={users} />;`, `67075161435465610000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                js 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">function</span> <span class="token function">ListItem</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token comment">// Correct! There is no need to specify the key here:</span>\n  <span class="token keyword">return</span> <span class="token operator">&lt;</span>li<span class="token operator">></span><span class="token punctuation">{</span>props<span class="token punctuation">.</span>value<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>li<span class="token operator">></span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">function</span> <span class="token function">UserList</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">const</span> users <span class="token operator">=</span> props<span class="token punctuation">.</span>users<span class="token punctuation">;</span>\n  <span class="token keyword">const</span> listItems <span class="token operator">=</span> users<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">user</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span>\n    <span class="token comment">// Correct! Key should be specified inside the array.</span>\n    <span class="token operator">&lt;</span>ListItem key<span class="token operator">=</span><span class="token punctuation">{</span>user<span class="token punctuation">.</span>id<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span> value<span class="token operator">=</span><span class="token punctuation">{</span>user<span class="token punctuation">.</span>name<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span>\n  <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token keyword">return</span> <span class="token operator">&lt;</span>ul<span class="token operator">></span><span class="token punctuation">{</span>listItems<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>ul<span class="token operator">></span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">const</span> users <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">{</span> id<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> name<span class="token punctuation">:</span> <span class="token string">\'Khaleesi\'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> id<span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span> name<span class="token punctuation">:</span> <span class="token string">\'Jon\'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> id<span class="token punctuation">:</span> <span class="token number">3</span><span class="token punctuation">,</span> name<span class="token punctuation">:</span> <span class="token string">\'Arya\'</span> <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n\n<span class="token operator">&lt;</span>UserList users<span class="token operator">=</span><span class="token punctuation">{</span>users<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>由于用户 ID 是唯一的，我们可以确信地使用它作为列表项的关键字。对于更实际的应用程序，我创建了一个 Postmate 的 feed 的模拟版本，当点击时从 DOM 中删除了一个商店。</p>\n<p>\n  <a\n    class="gatsby-resp-image-link"\n    href="/static/1_hJJK3sBRN2g3NbXDPHTF9A-ba096e1bd019688a9708fae93100dba7-fee1c.png"\n    style="display: block"\n    target="_blank"\n    rel="noopener"\n  >\n  \n  <span\n    class="gatsby-resp-image-wrapper"\n    style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;"\n  >\n    <span\n      class="gatsby-resp-image-background-image"\n      style="padding-bottom: 81.75%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAIAAACZeshMAAAACXBIWXMAAAsSAAALEgHS3X78AAAD0ElEQVQozw3L/VOSdwAA8O/sct2WOK211m1zK6fpJdPNTMUwsWQKKOILiDyIKO8P8AgIPDzA4/MCjw+QQKCApniSpG5qUzfX1nlbdV3e+Uu3u/bvbJ/fPwA5PAEOopRgSkiiJBQEjA+wDhC1goStJA2fWzJ9kNOdX9O7F2OLlH/vMb3C6AppD4ubj349BOjvr4A3coVJljPRygh77VGEk6IqM3NXc0FO1l254ipfRT7dQNA0Ewr4o5hpwWdOYDqDpH5tKQIchy+Bk60g4udwppQKXVtgv808rFlmK1IYSM58uIhwcnbOms2TwBdCRIQmsvH45lo+GQn98fw5QPZOgIUsQ+eBmyzx4R/jgYsUxgl7L4SdgLWWRC1lcQtnCUbI6VlFT8xvzKfon5+ub+/svnv3D0D3/wLG0AVX9Lw7/AlGVwTJsoDvIj5bTro+ou0gbCydN1xKWGCPElMII6gxTfkSNJbN5t6+OQWF/d0HKvGQSd2jEI/oVUJtv4nEdOTcqFbDGxzg9nbehWRy1ApBsoF7bVZIvJwhU+GAsbPxaGsZHB89Ewq40wq+feSOUd6tGuKF/TbCj9EzOp9xIkVYnHqFYUrLBJ1R3FbI0NvrkVzEPtxW+9NmBhwe7Cg0IrtNZZq8Z54YlPC/d8wYHQ6E9MCYTZ9LEjOIdkw1HsbMAYc6m8QiuNOm7Brrqz/+ZRsUt3eUIyLcOeW3qFDEjLph2g3jdg2tFFpaap1qGa6SupUPXI4JjbTTNyk1D3XDEv6cR7f/rAj2iqvGwQ7cNLa6QOdCvnnDaAiBcPOoS3Ar2tvkaa+CGj/j8a72d1VLGr6Y+JGv7eNBbXVysXCnWADbGUp6p0qrnSaJAKGRa25zB0X3UaUgaFGnI5SvuRrt4Jq6m3BxY8qhgvk3XQYVHqObv7mcp4IgxoQUkNLvhfHJLgbVB4mAQiH3jvBnIXEsFIA10n5ZC+rRJ13ahalRV9OXmOx+sFdg4lUf5DNgZSmpG2jCZgaipHIl5n1IOl1ev1kpcoyL56Yhw+RwS0fVuOi2V9KKtH9tba3R/HDTxG+H+zp2kyxIP4qL7tZZtbLHhRxqUQy01SrkUHcrV9peJ2+umeBeV924Mln/uUPWY5PyUbuOZikqRltN6t21FMjFGdVwF8sE5ukgS9miMcYwLtH0fGcVXIf7G0a6bnU2fKUU1C6l4ltbW/nV5SebhWLxSTYZe/P67/8z5bcM/Xa8u5yYe3GQ399bD9iEs4LqDXnjcc5fIOxOdY/b1PR0Y+XPFyevX708PX17dnZ2cHj0/v2//wHWRJckVRr6QAAAAABJRU5ErkJggg==\'); background-size: cover; display: block;"\n    >\n      <img\n        class="gatsby-resp-image-image"\n        style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;"\n        alt="1 hJJK3sBRN2g3NbXDPHTF9A"\n        title=""\n        src="/static/1_hJJK3sBRN2g3NbXDPHTF9A-ba096e1bd019688a9708fae93100dba7-fee1c.png"\n        srcset="/static/1_hJJK3sBRN2g3NbXDPHTF9A-ba096e1bd019688a9708fae93100dba7-a67b7.png 200w,\n/static/1_hJJK3sBRN2g3NbXDPHTF9A-ba096e1bd019688a9708fae93100dba7-0b187.png 400w,\n/static/1_hJJK3sBRN2g3NbXDPHTF9A-ba096e1bd019688a9708fae93100dba7-fee1c.png 800w"\n        sizes="(max-width: 800px) 100vw, 800px"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<p>\n  <a\n    class="gatsby-resp-image-link"\n    href="/static/1_K9z91UAqGDb8pbcU1GRcPg-3553749dac75dafa3c5d5dda7960fa36-fee1c.png"\n    style="display: block"\n    target="_blank"\n    rel="noopener"\n  >\n  \n  <span\n    class="gatsby-resp-image-wrapper"\n    style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;"\n  >\n    <span\n      class="gatsby-resp-image-background-image"\n      style="padding-bottom: 66.5%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAIAAAAmMtkJAAAACXBIWXMAAAsSAAALEgHS3X78AAACO0lEQVQoz1VSiY7aMBDN/39UW2m7y3KFBAiBwJKQ2449PsZJWMpRh1VbdWRZlmee35vncdr+s23PndANAcokz0uDXSfwTJipG63x2veGUgSpjWkp7UB0QtwB7lo7DWgBWsUZlkzJ1ixW6nDSi3U7WdCXdzfYAREqLkQFAi/S36jwQwR78e4qf+PUXDVMi6QSFecc5dTnx1y4axy51Wi+CveaKcwqpEJ3F+0HuI91eDCjeesHTs2E5AqPJ8xrCRpXoUpyHUbtckPm/swPWcEgOvGUMNWzdcTDDxZ+wGwpg8ihgByMPJWy4gCopj4cUmmZ3936dbraHhTXOq21ZW4vyjJvP9QyND8nZh06hCtgWiaFKqiwdV4g49z2Y9wlGbtesJMEbM+yZMJ8itVW7WJh8WNPh3vLbA1Dm1ZlYw96YcHFAJ76ZLJYWDC1huWy5gKf4CgWm70au7iJHAJ68CmtZQ2D7IkHx3yQ/TYjL+P19jAYlhN8yra6cHccDHudDoZRLhVok+SmpErgl2EYRJ23pnPP2+x5CXDIIG+YOvN1BNsj3x7F2FOWuea64cjjgheMNhreZmyX2F3/GFXf3wZm+xenEiko8ylnPm72ehWaby92Ipy26y59/0vIR9s+rtdHTe4grnlxy7LulB6zGmxT1jMw2N+waExG5KmSuxjTynk843a7ZXkeJ0mcphUhj//jfD4TQpI4TrK0ovR+v3/dO38r+q4zdnqN6fv+YdPPdf/ztMUjYtu2ffcv+xutxcTyeb4sWwAAAABJRU5ErkJggg==\'); background-size: cover; display: block;"\n    >\n      <img\n        class="gatsby-resp-image-image"\n        style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;"\n        alt="1 K9z91UAqGDb8pbcU1GRcPg"\n        title=""\n        src="/static/1_K9z91UAqGDb8pbcU1GRcPg-3553749dac75dafa3c5d5dda7960fa36-fee1c.png"\n        srcset="/static/1_K9z91UAqGDb8pbcU1GRcPg-3553749dac75dafa3c5d5dda7960fa36-a67b7.png 200w,\n/static/1_K9z91UAqGDb8pbcU1GRcPg-3553749dac75dafa3c5d5dda7960fa36-0b187.png 400w,\n/static/1_K9z91UAqGDb8pbcU1GRcPg-3553749dac75dafa3c5d5dda7960fa36-fee1c.png 800w"\n        sizes="(max-width: 800px) 100vw, 800px"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<p>使用 react-addons-perf Chrome 扩展，我计算了使用 UUID 作为关键字以及使用 Math.random() 一个关键字来移除一个元素的操作次数。结果表明，使用唯一一致的密钥只需要 28 个操作来移除项目，而随机生成的密钥需要超过<code class="language-text">25 倍的数目操作才能执行完全相同的任务</code>。谨慎用你的<code class="language-text">key</code>。</p>\n<h1 id="管理-shouldcomponentupdate"><a href="#%E7%AE%A1%E7%90%86-shouldcomponentupdate" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>管理 shouldComponentUpdate</h1>\n<p>管理组件生命周期允许您准确指定组件应该呈现的时间。既然您作为开发人员了解您的应用程序并不知道您的应用程序，您就可以确定组件是否需要重新渲染。渲染和重绘是 React 中最昂贵的操作，因此根据您的领域知识消除任何不必要的调用可以为您的性能和用户体验带来巨大的改进。</p>\n<h1 id="使用-reactpurecomponent-而不是-reactcomponent"><a href="#%E4%BD%BF%E7%94%A8-reactpurecomponent-%E8%80%8C%E4%B8%8D%E6%98%AF-reactcomponent" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>使用 React.PureComponent 而不是 React.Component</h1>\n<p>React 提供 PureComponent 了管理 shouldComponentUpdate 开发人员的生命周期钩子。PureComponent 将做所有道具/状态的浅层比较，并且只会在任何道具/状态发生变化时进行渲染。大多数情况下，您可以放弃使用 PureComponent 而不是自己处理。它确实带有一些仔细的考虑，可能导致讨厌的错误。在将对象分配给变量时，JavaScript 使用指针。这意味着变量指向内存中的特定位置，而不是指向对象本身的任何特定位置。如果更新对象的属性，指针将保持不变，因此浅比较将无法识别更新。为了避免这种情况，您可以</p>\n<ol>\n<li>直接将变量传递给组件，而不是传递给对象</li>\n<li>包含不可变的数据结构。</li>\n</ol>\n<p>以下示例使用 PureComponent 将获得与我们的示例相同的结果 shouldComponentUpdate。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="87230155546724750000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`class CounterButton extends React.PureComponent {\n  constructor(props) {\n    super(props);\n    this.state = { count: 1 };\n    this.handleClick = this.handleClick.bind(this);\n  }\n\n  handleClick() {\n    this.setState((state) => ({ count: state.count + 1 }));\n  }\n\n  render() {\n    return (\n      <button color={this.props.color} onClick={this.handleClick}>\n        Count: {this.state.count}\n      </button>\n    );\n  }\n}`, `87230155546724750000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                js 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">class</span> <span class="token class-name">CounterButton</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>PureComponent</span> <span class="token punctuation">{</span>\n  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">super</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token punctuation">{</span> count<span class="token punctuation">:</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>\n    <span class="token keyword">this</span><span class="token punctuation">.</span>handleClick <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">handleClick</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n\n  <span class="token function">handleClick</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">state</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">{</span> count<span class="token punctuation">:</span> state<span class="token punctuation">.</span>count <span class="token operator">+</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n\n  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">return</span> <span class="token punctuation">(</span>\n      <span class="token operator">&lt;</span>button color<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>color<span class="token punctuation">}</span> onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>handleClick<span class="token punctuation">}</span><span class="token operator">></span>\n        Count<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>count<span class="token punctuation">}</span>\n      <span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">></span>\n    <span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>最后一个考虑因素是功能组件还没有针对 React 进行优化，但是团队已经答应在将来这样做。如果您在应用程序中确定了需要优化的区域，则最好使用类组件来确保获得所需的性能。</p>\n<h1 id="建立生产"><a href="#%E5%BB%BA%E7%AB%8B%E7%94%9F%E4%BA%A7" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>建立生产</h1>\n<p>建设生产看起来很明显，但重要的是你检查你的过程，以确保它编译使用 NODE_ENV = ‘production’。React 包含许多警告，可帮助您调试在生产中被剥离的内容。这些警告使开发更友好，但也使得 React 的构建变得越来越慢。生产 React 构建比开发构建渲染速度快 2-8 倍。</p>\n<p>以下 Webpack 插件将提供所需的生产版本：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="85025681078219700000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`plugins: [\n  new webpack.DefinePlugin({\n    \'process.env\': {\n      NODE_ENV: JSON.stringify(\'production\')\n    }\n  }),\n  new webpack.optimize.UglifyJsPlugin()\n  \'transform-react-constant-elements\',\n  \'transform-react-inline-elements\',\n  ...otherPlugins\n]`, `85025681078219700000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                js 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js">plugins<span class="token punctuation">:</span> <span class="token punctuation">[</span>\n  <span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>DefinePlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n    <span class="token string">\'process.env\'</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>\n      <span class="token constant">NODE_ENV</span><span class="token punctuation">:</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span><span class="token string">\'production\'</span><span class="token punctuation">)</span>\n    <span class="token punctuation">}</span>\n  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n  <span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>optimize<span class="token punctuation">.</span>UglifyJsPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n  <span class="token string">\'transform-react-constant-elements\'</span><span class="token punctuation">,</span>\n  <span class="token string">\'transform-react-inline-elements\'</span><span class="token punctuation">,</span>\n  <span class="token operator">...</span>otherPlugins\n<span class="token punctuation">]</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>在 DefinePlugin 确保 NODE_ENV 设置是否正确，以及 UglifyJsPlugin 压缩的 JavaScript。所述 transform-react-constant-elements 移动常数元件以更高的范围，和 transform-react-inline-elements 替换天然 React.createElement() 具有更优化的版本。请注意，这些只能在生产中使用，因为它们会产生模糊的错误，使开发调试变得困难。您可以使用 React Developer for Chrome 来评估您是否使用 React 的生产版本。</p>',
excerpt:"翻译转载： Optimize React Performance 如何提高生产中的 React 性能，避免常见的错误 您是否知道 key 在列表中使用不正确可以将 DOM 操作增加 10 倍以上？据了解，React 的 Virtual DOM…",timeToRead:3,tableOfContents:'<ul>\n<li><a href="/optimize-react/#%E5%A6%82%E4%BD%95%E6%8F%90%E9%AB%98%E7%94%9F%E4%BA%A7%E4%B8%AD%E7%9A%84-react-%E6%80%A7%E8%83%BD%EF%BC%8C%E9%81%BF%E5%85%8D%E5%B8%B8%E8%A7%81%E7%9A%84%E9%94%99%E8%AF%AF">如何提高生产中的 React 性能，避免常见的错误</a></li>\n<li><a href="/optimize-react/#%E8%A1%A1%E9%87%8F%E6%95%88%E7%8E%87">衡量效率</a></li>\n<li><a href="/optimize-react/#%E6%AD%A3%E7%A1%AE%E7%9A%84%E4%BD%BF%E7%94%A8-key">正确的使用 key</a></li>\n<li><a href="/optimize-react/#%E7%AE%A1%E7%90%86-shouldcomponentupdate">管理 shouldComponentUpdate</a></li>\n<li><a href="/optimize-react/#%E4%BD%BF%E7%94%A8-reactpurecomponent-%E8%80%8C%E4%B8%8D%E6%98%AF-reactcomponent">使用 React.PureComponent 而不是 React.Component</a></li>\n<li><a href="/optimize-react/#%E5%BB%BA%E7%AB%8B%E7%94%9F%E4%BA%A7">建立生产</a></li>\n</ul>',wordCount:{words:272},frontmatter:{date:"2017-12-13 10:13:24",path:"/optimize-react/",tags:"前端, React 性能",title:"优化 React 性能",draft:null,catalog_number:null}},nextPost:{html:'<p>学习地址：<a href="https://blog.kentcdodds.com/learn-react-fundamentals-and-advanced-patterns-eac90341c9db" target="_blank" rel="nofollow noreferrer noopener">新手指南 ReactJS 视频</a>，<code class="language-text">以下标题均采用链接+视频时长的方式展示</code></p>\n<h2 id="react-事件处理（342）"><a href="#react-%E4%BA%8B%E4%BB%B6%E5%A4%84%E7%90%86%EF%BC%88342%EF%BC%89" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><a href="https://egghead.io/lessons/egghead-use-event-handlers-with-react" target="_blank" rel="nofollow noreferrer noopener">React 事件处理（3:42）</a></h2>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="70725814250375900000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`<!DOCTYPE html>\n<html lang=&quot;en&quot;>\n  <body>\n    <div id=&quot;root&quot;></div>\n    <script src=&quot;https://cdn.bootcss.com/react/16.2.0/umd/react.development.js&quot;></script>\n    <script src=&quot;https://cdn.bootcss.com/react-dom/16.2.0/umd/react-dom.development.js&quot;></script>\n    <script src=&quot;https://cdn.bootcss.com/babel-standalone/7.0.0-beta.3/babel.js&quot;></script>\n    <script type=&quot;text/babel&quot;>\n      // 函数式编程\n      const state = { eventCount: 0, username: \'\' };\n      function App() {\n        return (\n          <div>\n            <p>There have been {state.eventCount} events</p>\n            <p>\n              <button onClick={increment}>Press</button>\n            </p>\n            <p>You typed: {state.username}</p>\n            <p>\n              <input onChange={updateUsername} />\n            </p>\n          </div>\n        );\n      }\n\n      function updateUsername(event) {\n        console.log(event);\n        setState({\n          username: event.target.value\n        });\n      }\n\n      function increment() {\n        setState({\n          eventCount: state.eventCount + 1\n        });\n      }\n\n      function setState(newState) {\n        Object.assign(state, newState);\n        renderApp();\n      }\n\n      function renderApp() {\n        ReactDOM.render(<App />, document.getElementById(\'root\'));\n      }\n\n      renderApp();\n    </script>\n  </body>\n</html>`, `70725814250375900000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                html 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="html"><pre style="counter-reset: linenumber NaN" class="language-html line-numbers"><code class="language-html"><span class="token doctype">&lt;!DOCTYPE html></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>en<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>root<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>https://cdn.bootcss.com/react/16.2.0/umd/react.development.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>https://cdn.bootcss.com/react-dom/16.2.0/umd/react-dom.development.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>https://cdn.bootcss.com/babel-standalone/7.0.0-beta.3/babel.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>text/babel<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">\n      <span class="token comment">// 函数式编程</span>\n      <span class="token keyword">const</span> state <span class="token operator">=</span> <span class="token punctuation">{</span> eventCount<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span> username<span class="token punctuation">:</span> <span class="token string">\'\'</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>\n      <span class="token keyword">function</span> <span class="token function">App</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        <span class="token keyword">return</span> <span class="token punctuation">(</span>\n          <span class="token operator">&lt;</span>div<span class="token operator">></span>\n            <span class="token operator">&lt;</span>p<span class="token operator">></span>There have been <span class="token punctuation">{</span>state<span class="token punctuation">.</span>eventCount<span class="token punctuation">}</span> events<span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">></span>\n            <span class="token operator">&lt;</span>p<span class="token operator">></span>\n              <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span>increment<span class="token punctuation">}</span><span class="token operator">></span>Press<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">></span>\n            <span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">></span>\n            <span class="token operator">&lt;</span>p<span class="token operator">></span>You typed<span class="token punctuation">:</span> <span class="token punctuation">{</span>state<span class="token punctuation">.</span>username<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">></span>\n            <span class="token operator">&lt;</span>p<span class="token operator">></span>\n              <span class="token operator">&lt;</span>input onChange<span class="token operator">=</span><span class="token punctuation">{</span>updateUsername<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span>\n            <span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">></span>\n          <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>\n        <span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span>\n\n      <span class="token keyword">function</span> <span class="token function">updateUsername</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n          username<span class="token punctuation">:</span> event<span class="token punctuation">.</span>target<span class="token punctuation">.</span>value\n        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span>\n\n      <span class="token keyword">function</span> <span class="token function">increment</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        <span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n          eventCount<span class="token punctuation">:</span> state<span class="token punctuation">.</span>eventCount <span class="token operator">+</span> <span class="token number">1</span>\n        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span>\n\n      <span class="token keyword">function</span> <span class="token function">setState</span><span class="token punctuation">(</span><span class="token parameter">newState</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        Object<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span>state<span class="token punctuation">,</span> newState<span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token function">renderApp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span>\n\n      <span class="token keyword">function</span> <span class="token function">renderApp</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        ReactDOM<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token operator">&lt;</span>App <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">,</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">\'root\'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span>\n\n      <span class="token function">renderApp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id="react-组件状态（709）"><a href="#react-%E7%BB%84%E4%BB%B6%E7%8A%B6%E6%80%81%EF%BC%88709%EF%BC%89" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><a href="https://egghead.io/lessons/react-use-component-state-with-react" target="_blank" rel="nofollow noreferrer noopener">React 组件状态（7:09）</a></h2>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="20614099772211780000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`<!DOCTYPE html>\n<html lang=&quot;en&quot;>\n  <body>\n    <div id=&quot;root&quot;></div>\n    <script src=&quot;https://cdn.bootcss.com/react/16.2.0/umd/react.development.js&quot;></script>\n    <script src=&quot;https://cdn.bootcss.com/react-dom/16.2.0/umd/react-dom.development.js&quot;></script>\n    <script src=&quot;https://cdn.bootcss.com/babel-standalone/7.0.0-beta.3/babel.js&quot;></script>\n    <script type=&quot;text/babel&quot;>\n      class StopWatch extends React.Component {\n        state = { lapse: 0, running: false };\n        handleRunClick = () => {\n          this.setState((state) => {\n            if (state.running) {\n              clearInterval(this.timer);\n            } else {\n              const startTime = Date.now() - this.state.lapse;\n              this.timer = setInterval((state) => {\n                this.setState({ lapse: Date.now() - startTime });\n              });\n            }\n            return { running: !state.running };\n          });\n        };\n        handleClearClick = () => {\n          clearInterval(this.timer);\n          this.setState({ lapse: 0, running: false });\n        };\n        render() {\n          const { lapse, running } = this.state;\n          const buttonStyle = {\n            border: \'1px solid #ccc\',\n            background: \'#fff\',\n            fontSize: \'2em\',\n            padding: 15,\n            margin: 5,\n            width: 200\n          };\n          return (\n            <div style={{ textAlign: \'center\' }}>\n              <label style={{ fontSize: \'5em\', display: \'block\' }}>{lapse}ms</label>\n              <button style={buttonStyle} onClick={this.handleRunClick}>\n                {running ? \'Stop\' : \'Start\'}\n              </button>\n              <button style={buttonStyle} onClick={this.handleClearClick}>\n                Clear\n              </button>\n            </div>\n          );\n        }\n      }\n      ReactDOM.render(<StopWatch />, document.getElementById(\'root\'));\n    </script>\n  </body>\n</html>`, `20614099772211780000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                html 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="html"><pre style="counter-reset: linenumber NaN" class="language-html line-numbers"><code class="language-html"><span class="token doctype">&lt;!DOCTYPE html></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>en<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>root<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>https://cdn.bootcss.com/react/16.2.0/umd/react.development.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>https://cdn.bootcss.com/react-dom/16.2.0/umd/react-dom.development.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>https://cdn.bootcss.com/babel-standalone/7.0.0-beta.3/babel.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>text/babel<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">\n      <span class="token keyword">class</span> <span class="token class-name">StopWatch</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>\n        state <span class="token operator">=</span> <span class="token punctuation">{</span> lapse<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span> running<span class="token punctuation">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>\n        <span class="token function-variable function">handleRunClick</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n          <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">state</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n            <span class="token keyword">if</span> <span class="token punctuation">(</span>state<span class="token punctuation">.</span>running<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n              <span class="token function">clearInterval</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>timer<span class="token punctuation">)</span><span class="token punctuation">;</span>\n            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>\n              <span class="token keyword">const</span> startTime <span class="token operator">=</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>lapse<span class="token punctuation">;</span>\n              <span class="token keyword">this</span><span class="token punctuation">.</span>timer <span class="token operator">=</span> <span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">state</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n                <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span> lapse<span class="token punctuation">:</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> startTime <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n              <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n            <span class="token punctuation">}</span>\n            <span class="token keyword">return</span> <span class="token punctuation">{</span> running<span class="token punctuation">:</span> <span class="token operator">!</span>state<span class="token punctuation">.</span>running <span class="token punctuation">}</span><span class="token punctuation">;</span>\n          <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token punctuation">}</span><span class="token punctuation">;</span>\n        <span class="token function-variable function">handleClearClick</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n          <span class="token function">clearInterval</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>timer<span class="token punctuation">)</span><span class="token punctuation">;</span>\n          <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span> lapse<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span> running<span class="token punctuation">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token punctuation">}</span><span class="token punctuation">;</span>\n        <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n          <span class="token keyword">const</span> <span class="token punctuation">{</span> lapse<span class="token punctuation">,</span> running <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">;</span>\n          <span class="token keyword">const</span> buttonStyle <span class="token operator">=</span> <span class="token punctuation">{</span>\n            border<span class="token punctuation">:</span> <span class="token string">\'1px solid #ccc\'</span><span class="token punctuation">,</span>\n            background<span class="token punctuation">:</span> <span class="token string">\'#fff\'</span><span class="token punctuation">,</span>\n            fontSize<span class="token punctuation">:</span> <span class="token string">\'2em\'</span><span class="token punctuation">,</span>\n            padding<span class="token punctuation">:</span> <span class="token number">15</span><span class="token punctuation">,</span>\n            margin<span class="token punctuation">:</span> <span class="token number">5</span><span class="token punctuation">,</span>\n            width<span class="token punctuation">:</span> <span class="token number">200</span>\n          <span class="token punctuation">}</span><span class="token punctuation">;</span>\n          <span class="token keyword">return</span> <span class="token punctuation">(</span>\n            <span class="token operator">&lt;</span>div style<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span> textAlign<span class="token punctuation">:</span> <span class="token string">\'center\'</span> <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">></span>\n              <span class="token operator">&lt;</span>label style<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span> fontSize<span class="token punctuation">:</span> <span class="token string">\'5em\'</span><span class="token punctuation">,</span> display<span class="token punctuation">:</span> <span class="token string">\'block\'</span> <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">></span><span class="token punctuation">{</span>lapse<span class="token punctuation">}</span>ms<span class="token operator">&lt;</span><span class="token operator">/</span>label<span class="token operator">></span>\n              <span class="token operator">&lt;</span>button style<span class="token operator">=</span><span class="token punctuation">{</span>buttonStyle<span class="token punctuation">}</span> onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>handleRunClick<span class="token punctuation">}</span><span class="token operator">></span>\n                <span class="token punctuation">{</span>running <span class="token operator">?</span> <span class="token string">\'Stop\'</span> <span class="token punctuation">:</span> <span class="token string">\'Start\'</span><span class="token punctuation">}</span>\n              <span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">></span>\n              <span class="token operator">&lt;</span>button style<span class="token operator">=</span><span class="token punctuation">{</span>buttonStyle<span class="token punctuation">}</span> onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>handleClearClick<span class="token punctuation">}</span><span class="token operator">></span>\n                Clear\n              <span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">></span>\n            <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>\n          <span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token punctuation">}</span>\n      <span class="token punctuation">}</span>\n      ReactDOM<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token operator">&lt;</span>StopWatch <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">,</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">\'root\'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id="react-用-componentwillunmount-方法停止内存泄漏（114）"><a href="#react-%E7%94%A8-componentwillunmount-%E6%96%B9%E6%B3%95%E5%81%9C%E6%AD%A2%E5%86%85%E5%AD%98%E6%B3%84%E6%BC%8F%EF%BC%88114%EF%BC%89" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><a href="https://egghead.io/lessons/react-stop-memory-leaks-with-componentwillunmount-lifecycle-method-in-react" target="_blank" rel="nofollow noreferrer noopener">React 用 componentWillUnmount 方法停止内存泄漏（1:14）</a></h2>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="63014401266011324000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`<!DOCTYPE html>\n<html lang=&quot;en&quot;>\n  <body>\n    <div id=&quot;root&quot;></div>\n    <script src=&quot;https://cdn.bootcss.com/react/16.2.0/umd/react.development.js&quot;></script>\n    <script src=&quot;https://cdn.bootcss.com/react-dom/16.2.0/umd/react-dom.development.js&quot;></script>\n    <script src=&quot;https://cdn.bootcss.com/babel-standalone/7.0.0-beta.3/babel.js&quot;></script>\n    <script type=&quot;text/babel&quot;>\n      class StopWatch extends React.Component {\n        state = { lapse: 0, running: false, isShow: true };\n        handleRunClick = () => {\n          this.setState((state) => {\n            if (state.running) {\n              clearInterval(this.timer);\n            } else {\n              const startTime = Date.now() - this.state.lapse;\n              this.timer = setInterval((state) => {\n                this.setState({ lapse: Date.now() - startTime }, () => {\n                  console.log(this.state.lapse);\n                });\n              });\n            }\n            return { running: !state.running };\n          });\n        };\n        handleClearClick = () => {\n          clearInterval(this.timer);\n          this.setState({ lapse: 0, running: false });\n        };\n        handleShow = (event) => {\n          this.setState({ isShow: event.target.checked });\n        };\n        componentWillUnmount() {\n          // 注意释放，否则报错\n          clearInterval(this.timer);\n        }\n        render() {\n          const { lapse, running, isShow } = this.state;\n          const buttonStyle = {\n            border: \'1px solid #ccc\',\n            background: \'#fff\',\n            fontSize: \'2em\',\n            padding: 15,\n            margin: 5,\n            width: 200\n          };\n          return (\n            <div style={{ textAlign: \'center\' }}>\n              Show or hide ? <input type=\'checkbox\' checked={isShow} onChange={this.handleShow} />\n              {isShow ? (\n                <div>\n                  <label style={{ fontSize: \'5em\', display: \'block\' }}>{lapse}ms</label>\n                  <button style={buttonStyle} onClick={this.handleRunClick}>\n                    {running ? \'Stop\' : \'Start\'}\n                  </button>\n                  <button style={buttonStyle} onClick={this.handleClearClick}>\n                    Clear\n                  </button>\n                </div>\n              ) : null}\n            </div>\n          );\n        }\n      }\n      ReactDOM.render(<StopWatch />, document.getElementById(\'root\'));\n    </script>\n  </body>\n</html>`, `63014401266011324000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                html 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="html"><pre style="counter-reset: linenumber NaN" class="language-html line-numbers"><code class="language-html"><span class="token doctype">&lt;!DOCTYPE html></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>en<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>root<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>https://cdn.bootcss.com/react/16.2.0/umd/react.development.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>https://cdn.bootcss.com/react-dom/16.2.0/umd/react-dom.development.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>https://cdn.bootcss.com/babel-standalone/7.0.0-beta.3/babel.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>text/babel<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">\n      <span class="token keyword">class</span> <span class="token class-name">StopWatch</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>\n        state <span class="token operator">=</span> <span class="token punctuation">{</span> lapse<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span> running<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> isShow<span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>\n        <span class="token function-variable function">handleRunClick</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n          <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">state</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n            <span class="token keyword">if</span> <span class="token punctuation">(</span>state<span class="token punctuation">.</span>running<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n              <span class="token function">clearInterval</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>timer<span class="token punctuation">)</span><span class="token punctuation">;</span>\n            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>\n              <span class="token keyword">const</span> startTime <span class="token operator">=</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>lapse<span class="token punctuation">;</span>\n              <span class="token keyword">this</span><span class="token punctuation">.</span>timer <span class="token operator">=</span> <span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">state</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n                <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span> lapse<span class="token punctuation">:</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> startTime <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n                  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>lapse<span class="token punctuation">)</span><span class="token punctuation">;</span>\n                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n              <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n            <span class="token punctuation">}</span>\n            <span class="token keyword">return</span> <span class="token punctuation">{</span> running<span class="token punctuation">:</span> <span class="token operator">!</span>state<span class="token punctuation">.</span>running <span class="token punctuation">}</span><span class="token punctuation">;</span>\n          <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token punctuation">}</span><span class="token punctuation">;</span>\n        <span class="token function-variable function">handleClearClick</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n          <span class="token function">clearInterval</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>timer<span class="token punctuation">)</span><span class="token punctuation">;</span>\n          <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span> lapse<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span> running<span class="token punctuation">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token punctuation">}</span><span class="token punctuation">;</span>\n        <span class="token function-variable function">handleShow</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n          <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span> isShow<span class="token punctuation">:</span> event<span class="token punctuation">.</span>target<span class="token punctuation">.</span>checked <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token punctuation">}</span><span class="token punctuation">;</span>\n        <span class="token function">componentWillUnmount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n          <span class="token comment">// 注意释放，否则报错</span>\n          <span class="token function">clearInterval</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>timer<span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token punctuation">}</span>\n        <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n          <span class="token keyword">const</span> <span class="token punctuation">{</span> lapse<span class="token punctuation">,</span> running<span class="token punctuation">,</span> isShow <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">;</span>\n          <span class="token keyword">const</span> buttonStyle <span class="token operator">=</span> <span class="token punctuation">{</span>\n            border<span class="token punctuation">:</span> <span class="token string">\'1px solid #ccc\'</span><span class="token punctuation">,</span>\n            background<span class="token punctuation">:</span> <span class="token string">\'#fff\'</span><span class="token punctuation">,</span>\n            fontSize<span class="token punctuation">:</span> <span class="token string">\'2em\'</span><span class="token punctuation">,</span>\n            padding<span class="token punctuation">:</span> <span class="token number">15</span><span class="token punctuation">,</span>\n            margin<span class="token punctuation">:</span> <span class="token number">5</span><span class="token punctuation">,</span>\n            width<span class="token punctuation">:</span> <span class="token number">200</span>\n          <span class="token punctuation">}</span><span class="token punctuation">;</span>\n          <span class="token keyword">return</span> <span class="token punctuation">(</span>\n            <span class="token operator">&lt;</span>div style<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span> textAlign<span class="token punctuation">:</span> <span class="token string">\'center\'</span> <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">></span>\n              Show or hide <span class="token operator">?</span> <span class="token operator">&lt;</span>input type<span class="token operator">=</span><span class="token string">\'checkbox\'</span> checked<span class="token operator">=</span><span class="token punctuation">{</span>isShow<span class="token punctuation">}</span> onChange<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>handleShow<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span>\n              <span class="token punctuation">{</span>isShow <span class="token operator">?</span> <span class="token punctuation">(</span>\n                <span class="token operator">&lt;</span>div<span class="token operator">></span>\n                  <span class="token operator">&lt;</span>label style<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span> fontSize<span class="token punctuation">:</span> <span class="token string">\'5em\'</span><span class="token punctuation">,</span> display<span class="token punctuation">:</span> <span class="token string">\'block\'</span> <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">></span><span class="token punctuation">{</span>lapse<span class="token punctuation">}</span>ms<span class="token operator">&lt;</span><span class="token operator">/</span>label<span class="token operator">></span>\n                  <span class="token operator">&lt;</span>button style<span class="token operator">=</span><span class="token punctuation">{</span>buttonStyle<span class="token punctuation">}</span> onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>handleRunClick<span class="token punctuation">}</span><span class="token operator">></span>\n                    <span class="token punctuation">{</span>running <span class="token operator">?</span> <span class="token string">\'Stop\'</span> <span class="token punctuation">:</span> <span class="token string">\'Start\'</span><span class="token punctuation">}</span>\n                  <span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">></span>\n                  <span class="token operator">&lt;</span>button style<span class="token operator">=</span><span class="token punctuation">{</span>buttonStyle<span class="token punctuation">}</span> onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>handleClearClick<span class="token punctuation">}</span><span class="token operator">></span>\n                    Clear\n                  <span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">></span>\n                <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>\n              <span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token keyword">null</span><span class="token punctuation">}</span>\n            <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>\n          <span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token punctuation">}</span>\n      <span class="token punctuation">}</span>\n      ReactDOM<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token operator">&lt;</span>StopWatch <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">,</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">\'root\'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id="react-class（416）"><a href="#react-class%EF%BC%88416%EF%BC%89" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><a href="https://egghead.io/lessons/egghead-use-class-components-with-react" target="_blank" rel="nofollow noreferrer noopener">React Class（4:16）</a></h2>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="1414315504733187800"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`<!DOCTYPE html>\n<html lang=&quot;en&quot;>\n  <body>\n    <div id=&quot;root&quot;></div>\n    <script src=&quot;https://cdn.bootcss.com/react/16.2.0/umd/react.development.js&quot;></script>\n    <script src=&quot;https://cdn.bootcss.com/react-dom/16.2.0/umd/react-dom.development.js&quot;></script>\n    <script src=&quot;https://cdn.bootcss.com/babel-standalone/7.0.0-beta.3/babel.js&quot;></script>\n    <script type=&quot;text/babel&quot;>\n      class Counter extends React.Component {\n        state = { count: 0 };\n        handleClick = () => {\n          // 注意箭头函数写法，参数、返回值都带括号\n          this.setState(({ count }) => ({\n            count: count + 1\n          }));\n        };\n        render() {\n          return <button onClick={this.handleClick}>{this.state.count}</button>;\n        }\n      }\n      ReactDOM.render(<Counter />, document.getElementById(\'root\'));\n    </script>\n  </body>\n</html>`, `1414315504733187800`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                html 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="html"><pre style="counter-reset: linenumber NaN" class="language-html line-numbers"><code class="language-html"><span class="token doctype">&lt;!DOCTYPE html></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>en<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>root<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>https://cdn.bootcss.com/react/16.2.0/umd/react.development.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>https://cdn.bootcss.com/react-dom/16.2.0/umd/react-dom.development.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>https://cdn.bootcss.com/babel-standalone/7.0.0-beta.3/babel.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>text/babel<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">\n      <span class="token keyword">class</span> <span class="token class-name">Counter</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>\n        state <span class="token operator">=</span> <span class="token punctuation">{</span> count<span class="token punctuation">:</span> <span class="token number">0</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>\n        <span class="token function-variable function">handleClick</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n          <span class="token comment">// 注意箭头函数写法，参数、返回值都带括号</span>\n          <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> count <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">{</span>\n            count<span class="token punctuation">:</span> count <span class="token operator">+</span> <span class="token number">1</span>\n          <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token punctuation">}</span><span class="token punctuation">;</span>\n        <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n          <span class="token keyword">return</span> <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>handleClick<span class="token punctuation">}</span><span class="token operator">></span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>count<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">></span><span class="token punctuation">;</span>\n        <span class="token punctuation">}</span>\n      <span class="token punctuation">}</span>\n      ReactDOM<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token operator">&lt;</span>Counter <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">,</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">\'root\'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>',
excerpt:"学习地址： 新手指南 ReactJS 视频 ， React 事件处理（3:42） React 组件状态（7:09） React 用 componentWillUnmount 方法停止内存泄漏（1:14） React Class（4:16）",frontmatter:{date:"2017-12-11 23:45:34",path:"/react-usage-part-3/",tags:"前端, React",title:"React基础知识第三部分",draft:null}},prePost:{html:'<p>翻译转载：<a href="https://blog.cloudboost.io/webpack-3-dynamic-imports-code-splitting-and-long-term-caching-made-easy-1892981e0ae7" target="_blank" rel="nofollow noreferrer noopener">Webpack 3, Dynamic Imports, Code Splitting, and Long Term Caching… Made Easy.</a> 在与 Webpack 1.x 升级到 3.x（比我想承认的更长的时间）后，突然点击了一下。看到揭开的奥秘：</p>\n<div>\n          <div\n            class="gatsby-resp-iframe-wrapper"\n            style="padding-bottom: 46.25%; position: relative; height: 0; overflow: hidden;margin-bottom: 2em"\n          >\n            <div align="center"><iframe src="https://giphy.com/embed/xUOxeX2W00FmKjNsUo" frameborder="0" class="giphy-embed" allowfullscreen style="\n            position: absolute;\n            top: 0;\n            left: 0;\n            width: 100%;\n            height: 100%;\n          "></iframe><p><a href="https://giphy.com/gifs/code-splitting-dynamic-imports-webpack-3-xUOxeX2W00FmKjNsUo">via GIPHY</a></p></div>\n&#x6F14;&#x793A;&#x4E00;&#x4E2A;&#x7B80;&#x5355;&#x7684;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x52A8;&#x6001;&#x52A0;&#x8F7D;&#x591A;&#x4E2A;&#x8DEF;&#x7EBF;&#x3002;&#x8BF7;&#x6CE8;&#x610F;&#x7F16;&#x8F91;&#x201C;&#x9875;&#x9762;2&#x201D;&#x540E;&#x7684;200&#x54CD;&#x5E94;&#xFF0C;&#x800C;&#x672A;&#x66F4;&#x6539;&#x7684;&#x6587;&#x4EF6;&#x5219;&#x4E3A;304&#x3002;\n          </div>\n          </div>\n<p>TL：DR 示例应用程序回购</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="38978877983991670000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// webpack.config.js\nconst webpack = require(\'webpack\');\nconst path = require(\'path\');\nconst HtmlWebpackPlugin = require(\'html-webpack-plugin\');\n\nconst APP_DIR = path.resolve(__dirname, \'./src\');\nconst MODULES_DIR = path.resolve(__dirname, \'./node_modules\');\n\nconst package = require(\'./package.json\');\n\nmodule.exports = {\n  devServer: {\n    historyApiFallback: true\n  },\n  entry: {\n    app: APP_DIR + \'/index.js\',\n    vendor: Object.keys(package.dependencies)\n  },\n  output: {\n    publicPath: \'/\',\n    chunkFilename: \'[name].[chunkhash].js\',\n    filename: \'[name].[chunkhash].js\'\n  },\n  resolve: {\n    extensions: [\'.js\', \'.jsx\'],\n    modules: [APP_DIR, MODULES_DIR]\n  },\n  module: {\n    rules: [\n      {\n        test: /\\.jsx?\\$/,\n        exclude: /node_modules/,\n        include: APP_DIR,\n        use: {\n          loader: \'babel-loader\'\n        }\n      }\n    ]\n  },\n  plugins: [\n    new HtmlWebpackPlugin({\n      title: \'Caching and Code Splitting\',\n      template: APP_DIR + \'/index.html\'\n    }),\n    new webpack.HashedModuleIdsPlugin(),\n    new webpack.optimize.CommonsChunkPlugin({\n      name: \'vendor\',\n      filename: \'vendor.[chunkhash].js\'\n    }),\n    new webpack.optimize.CommonsChunkPlugin({\n      name: \'manifest\'\n    })\n  ]\n};`, `38978877983991670000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                js 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// webpack.config.js</span>\n<span class="token keyword">const</span> webpack <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'webpack\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'path\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">const</span> HtmlWebpackPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'html-webpack-plugin\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token keyword">const</span> <span class="token constant">APP_DIR</span> <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">\'./src\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">const</span> <span class="token constant">MODULES_DIR</span> <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">\'./node_modules\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token keyword">const</span> <span class="token keyword">package</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'./package.json\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\nmodule<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>\n  devServer<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n    historyApiFallback<span class="token punctuation">:</span> <span class="token boolean">true</span>\n  <span class="token punctuation">}</span><span class="token punctuation">,</span>\n  entry<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n    app<span class="token punctuation">:</span> <span class="token constant">APP_DIR</span> <span class="token operator">+</span> <span class="token string">\'/index.js\'</span><span class="token punctuation">,</span>\n    vendor<span class="token punctuation">:</span> Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span><span class="token keyword">package</span><span class="token punctuation">.</span>dependencies<span class="token punctuation">)</span>\n  <span class="token punctuation">}</span><span class="token punctuation">,</span>\n  output<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n    publicPath<span class="token punctuation">:</span> <span class="token string">\'/\'</span><span class="token punctuation">,</span>\n    chunkFilename<span class="token punctuation">:</span> <span class="token string">\'[name].[chunkhash].js\'</span><span class="token punctuation">,</span>\n    filename<span class="token punctuation">:</span> <span class="token string">\'[name].[chunkhash].js\'</span>\n  <span class="token punctuation">}</span><span class="token punctuation">,</span>\n  resolve<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n    extensions<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">\'.js\'</span><span class="token punctuation">,</span> <span class="token string">\'.jsx\'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>\n    modules<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token constant">APP_DIR</span><span class="token punctuation">,</span> <span class="token constant">MODULES_DIR</span><span class="token punctuation">]</span>\n  <span class="token punctuation">}</span><span class="token punctuation">,</span>\n  module<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n    rules<span class="token punctuation">:</span> <span class="token punctuation">[</span>\n      <span class="token punctuation">{</span>\n        test<span class="token punctuation">:</span> <span class="token regex">/\\.jsx?$/</span><span class="token punctuation">,</span>\n        exclude<span class="token punctuation">:</span> <span class="token regex">/node_modules/</span><span class="token punctuation">,</span>\n        include<span class="token punctuation">:</span> <span class="token constant">APP_DIR</span><span class="token punctuation">,</span>\n        use<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n          loader<span class="token punctuation">:</span> <span class="token string">\'babel-loader\'</span>\n        <span class="token punctuation">}</span>\n      <span class="token punctuation">}</span>\n    <span class="token punctuation">]</span>\n  <span class="token punctuation">}</span><span class="token punctuation">,</span>\n  plugins<span class="token punctuation">:</span> <span class="token punctuation">[</span>\n    <span class="token keyword">new</span> <span class="token class-name">HtmlWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n      title<span class="token punctuation">:</span> <span class="token string">\'Caching and Code Splitting\'</span><span class="token punctuation">,</span>\n      template<span class="token punctuation">:</span> <span class="token constant">APP_DIR</span> <span class="token operator">+</span> <span class="token string">\'/index.html\'</span>\n    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n    <span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>HashedModuleIdsPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n    <span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>optimize<span class="token punctuation">.</span>CommonsChunkPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n      name<span class="token punctuation">:</span> <span class="token string">\'vendor\'</span><span class="token punctuation">,</span>\n      filename<span class="token punctuation">:</span> <span class="token string">\'vendor.[chunkhash].js\'</span>\n    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n    <span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>optimize<span class="token punctuation">.</span>CommonsChunkPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n      name<span class="token punctuation">:</span> <span class="token string">\'manifest\'</span>\n    <span class="token punctuation">}</span><span class="token punctuation">)</span>\n  <span class="token punctuation">]</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="95937441567637260000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// .babelrc\n{\n  &quot;presets&quot;: [\n    &quot;react&quot;,\n    [&quot;env&quot;, {\n      &quot;targets&quot;: {\n        &quot;browsers&quot;: [&quot;last 2 versions&quot;]\n      }\n    }],\n    &quot;stage-0&quot;\n  ],\n  &quot;comments&quot;: true\n}`, `95937441567637260000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                javaScript 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="javascript"><pre style="counter-reset: linenumber NaN" class="language-javascript line-numbers"><code class="language-javascript"><span class="token comment">// .babelrc</span>\n<span class="token punctuation">{</span>\n  <span class="token string">"presets"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>\n    <span class="token string">"react"</span><span class="token punctuation">,</span>\n    <span class="token punctuation">[</span><span class="token string">"env"</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>\n      <span class="token string">"targets"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>\n        <span class="token string">"browsers"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">"last 2 versions"</span><span class="token punctuation">]</span>\n      <span class="token punctuation">}</span>\n    <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span>\n    <span class="token string">"stage-0"</span>\n  <span class="token punctuation">]</span><span class="token punctuation">,</span>\n  <span class="token string">"comments"</span><span class="token punctuation">:</span> <span class="token boolean">true</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="58021056736290030000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`{\n  &quot;name&quot;: &quot;webpack-cs-ltc&quot;,\n  &quot;version&quot;: &quot;1.0.0&quot;,\n  &quot;description&quot;: &quot;A simple boilerplate for Webpack 3, dynamic imports, code splitting, and long term caching.&quot;,\n  &quot;main&quot;: &quot;index.js&quot;,\n  &quot;scripts&quot;: {\n    &quot;start&quot;: &quot;webpack --config webpack.config.js&quot;,\n    &quot;dev-server&quot;: &quot;webpack-dev-server&quot;,\n    &quot;test&quot;: &quot;echo \\&quot;Error: no test specified\\&quot; && exit 1&quot;\n  },\n  &quot;author&quot;: &quot;Geoff Miller&quot;,\n  &quot;license&quot;: &quot;MIT&quot;,\n  &quot;dependencies&quot;: {\n    &quot;react&quot;: &quot;^16.2.0&quot;,\n    &quot;react-dom&quot;: &quot;^16.2.0&quot;,\n    &quot;react-loadable&quot;: &quot;^5.3.1&quot;,\n    &quot;react-router-dom&quot;: &quot;^4.2.2&quot;\n  },\n  &quot;devDependencies&quot;: {\n    &quot;babel-core&quot;: &quot;^6.26.0&quot;,\n    &quot;babel-loader&quot;: &quot;^7.1.2&quot;,\n    &quot;babel-preset-env&quot;: &quot;^1.6.1&quot;,\n    &quot;babel-preset-react&quot;: &quot;^6.24.1&quot;,\n    &quot;babel-preset-stage-0&quot;: &quot;^6.24.1&quot;,\n    &quot;html-webpack-plugin&quot;: &quot;^2.30.1&quot;,\n    &quot;webpack&quot;: &quot;^3.10.0&quot;,\n    &quot;webpack-dev-server&quot;: &quot;^2.9.7&quot;\n  }\n}`, `58021056736290030000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                js 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token punctuation">{</span>\n  <span class="token string">"name"</span><span class="token punctuation">:</span> <span class="token string">"webpack-cs-ltc"</span><span class="token punctuation">,</span>\n  <span class="token string">"version"</span><span class="token punctuation">:</span> <span class="token string">"1.0.0"</span><span class="token punctuation">,</span>\n  <span class="token string">"description"</span><span class="token punctuation">:</span> <span class="token string">"A simple boilerplate for Webpack 3, dynamic imports, code splitting, and long term caching."</span><span class="token punctuation">,</span>\n  <span class="token string">"main"</span><span class="token punctuation">:</span> <span class="token string">"index.js"</span><span class="token punctuation">,</span>\n  <span class="token string">"scripts"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>\n    <span class="token string">"start"</span><span class="token punctuation">:</span> <span class="token string">"webpack --config webpack.config.js"</span><span class="token punctuation">,</span>\n    <span class="token string">"dev-server"</span><span class="token punctuation">:</span> <span class="token string">"webpack-dev-server"</span><span class="token punctuation">,</span>\n    <span class="token string">"test"</span><span class="token punctuation">:</span> <span class="token string">"echo \\"Error: no test specified\\" &amp;&amp; exit 1"</span>\n  <span class="token punctuation">}</span><span class="token punctuation">,</span>\n  <span class="token string">"author"</span><span class="token punctuation">:</span> <span class="token string">"Geoff Miller"</span><span class="token punctuation">,</span>\n  <span class="token string">"license"</span><span class="token punctuation">:</span> <span class="token string">"MIT"</span><span class="token punctuation">,</span>\n  <span class="token string">"dependencies"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>\n    <span class="token string">"react"</span><span class="token punctuation">:</span> <span class="token string">"^16.2.0"</span><span class="token punctuation">,</span>\n    <span class="token string">"react-dom"</span><span class="token punctuation">:</span> <span class="token string">"^16.2.0"</span><span class="token punctuation">,</span>\n    <span class="token string">"react-loadable"</span><span class="token punctuation">:</span> <span class="token string">"^5.3.1"</span><span class="token punctuation">,</span>\n    <span class="token string">"react-router-dom"</span><span class="token punctuation">:</span> <span class="token string">"^4.2.2"</span>\n  <span class="token punctuation">}</span><span class="token punctuation">,</span>\n  <span class="token string">"devDependencies"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>\n    <span class="token string">"babel-core"</span><span class="token punctuation">:</span> <span class="token string">"^6.26.0"</span><span class="token punctuation">,</span>\n    <span class="token string">"babel-loader"</span><span class="token punctuation">:</span> <span class="token string">"^7.1.2"</span><span class="token punctuation">,</span>\n    <span class="token string">"babel-preset-env"</span><span class="token punctuation">:</span> <span class="token string">"^1.6.1"</span><span class="token punctuation">,</span>\n    <span class="token string">"babel-preset-react"</span><span class="token punctuation">:</span> <span class="token string">"^6.24.1"</span><span class="token punctuation">,</span>\n    <span class="token string">"babel-preset-stage-0"</span><span class="token punctuation">:</span> <span class="token string">"^6.24.1"</span><span class="token punctuation">,</span>\n    <span class="token string">"html-webpack-plugin"</span><span class="token punctuation">:</span> <span class="token string">"^2.30.1"</span><span class="token punctuation">,</span>\n    <span class="token string">"webpack"</span><span class="token punctuation">:</span> <span class="token string">"^3.10.0"</span><span class="token punctuation">,</span>\n    <span class="token string">"webpack-dev-server"</span><span class="token punctuation">:</span> <span class="token string">"^2.9.7"</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>让我们通过这些配置文件，并揭秘发生了什么事情。</p>\n<p>我总是从文件开始查看新的代码库的 package.json。这使我能够在代码中看到它们之前了解依赖关系。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="94251605231395930000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// package.json\n&quot;dependencies&quot;: {\n    &quot;react&quot;: &quot;^16.2.0&quot;,\n    &quot;react-dom&quot;: &quot;^16.2.0&quot;,\n    &quot;react-loadable&quot;: &quot;^5.3.1&quot;, <-- dynamic imports for react\n    &quot;react-router-dom&quot;: &quot;^4.2.2&quot;\n  },`, `94251605231395930000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                js 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// package.json</span>\n<span class="token string">"dependencies"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>\n    <span class="token string">"react"</span><span class="token punctuation">:</span> <span class="token string">"^16.2.0"</span><span class="token punctuation">,</span>\n    <span class="token string">"react-dom"</span><span class="token punctuation">:</span> <span class="token string">"^16.2.0"</span><span class="token punctuation">,</span>\n    <span class="token string">"react-loadable"</span><span class="token punctuation">:</span> <span class="token string">"^5.3.1"</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token operator">--</span> dynamic imports <span class="token keyword">for</span> react\n    <span class="token string">"react-router-dom"</span><span class="token punctuation">:</span> <span class="token string">"^4.2.2"</span>\n  <span class="token punctuation">}</span><span class="token punctuation">,</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>在我们的应用程序中，react-loadable 将完成所有繁重的动态导入工作。这是一个小包装，减少样板和增加一些方便的功能。所以，而不是必须为每个动态导入执行此操作：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="18975256998642420000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`class MyComponent extends React.Component {\n  state = {\n    Bar: null\n  };\n\n  componentWillMount() {\n    import(\'./components/Bar\').then((Bar) => {\n      this.setState({ Bar });\n    });\n  }\n\n  render() {\n    let { Bar } = this.state;\n    if (!Bar) {\n      return <div>Loading...</div>;\n    } else {\n      return <Bar />;\n    }\n  }\n}`, `18975256998642420000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                js 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">class</span> <span class="token class-name">MyComponent</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>\n  state <span class="token operator">=</span> <span class="token punctuation">{</span>\n    Bar<span class="token punctuation">:</span> <span class="token keyword">null</span>\n  <span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n  <span class="token function">componentWillMount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">\'./components/Bar\'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">Bar</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span> Bar <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n\n  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> <span class="token punctuation">{</span> Bar <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">;</span>\n    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>Bar<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token keyword">return</span> <span class="token operator">&lt;</span>div<span class="token operator">></span>Loading<span class="token operator">...</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>\n      <span class="token keyword">return</span> <span class="token operator">&lt;</span>Bar <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>我们现在可以做到：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="85394366707267030000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`import Loadable from \'react-loadable\';\n\nconst LoadableBar = Loadable({\n  loader: () => import(\'./components/Bar\'),\n  loading() {\n    return <div>Loading...</div>;\n  }\n});\n\nclass MyComponent extends React.Component {\n  render() {\n    return <LoadableBar />;\n  }\n}`, `85394366707267030000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                js 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">import</span> Loadable <span class="token keyword">from</span> <span class="token string">\'react-loadable\'</span><span class="token punctuation">;</span>\n\n<span class="token keyword">const</span> LoadableBar <span class="token operator">=</span> <span class="token function">Loadable</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n  <span class="token function-variable function">loader</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">\'./components/Bar\'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n  <span class="token function">loading</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">return</span> <span class="token operator">&lt;</span>div<span class="token operator">></span>Loading<span class="token operator">...</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token keyword">class</span> <span class="token class-name">MyComponent</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>\n  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">return</span> <span class="token operator">&lt;</span>LoadableBar <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>好的，到 devDependencies：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="68628156582975140000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// package.json\n&quot;devDependencies&quot;: {\n    &quot;babel-core&quot;: &quot;^6.26.0&quot;,\n    &quot;babel-loader&quot;: &quot;^7.1.2&quot;,\n    &quot;babel-preset-env&quot;: &quot;^1.6.1&quot;,\n    &quot;babel-preset-react&quot;: &quot;^6.24.1&quot;,\n    &quot;babel-preset-stage-0&quot;: &quot;^6.24.1&quot;, <-- needed for dynamic import\n    &quot;html-webpack-plugin&quot;: &quot;^2.30.1&quot;,\n    &quot;webpack&quot;: &quot;^3.10.0&quot;,\n    &quot;webpack-dev-server&quot;: &quot;^2.9.7&quot;\n  }`, `68628156582975140000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                js 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// package.json</span>\n<span class="token string">"devDependencies"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>\n    <span class="token string">"babel-core"</span><span class="token punctuation">:</span> <span class="token string">"^6.26.0"</span><span class="token punctuation">,</span>\n    <span class="token string">"babel-loader"</span><span class="token punctuation">:</span> <span class="token string">"^7.1.2"</span><span class="token punctuation">,</span>\n    <span class="token string">"babel-preset-env"</span><span class="token punctuation">:</span> <span class="token string">"^1.6.1"</span><span class="token punctuation">,</span>\n    <span class="token string">"babel-preset-react"</span><span class="token punctuation">:</span> <span class="token string">"^6.24.1"</span><span class="token punctuation">,</span>\n    <span class="token string">"babel-preset-stage-0"</span><span class="token punctuation">:</span> <span class="token string">"^6.24.1"</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token operator">--</span> needed <span class="token keyword">for</span> dynamic <span class="token keyword">import</span>\n    <span class="token string">"html-webpack-plugin"</span><span class="token punctuation">:</span> <span class="token string">"^2.30.1"</span><span class="token punctuation">,</span>\n    <span class="token string">"webpack"</span><span class="token punctuation">:</span> <span class="token string">"^3.10.0"</span><span class="token punctuation">,</span>\n    <span class="token string">"webpack-dev-server"</span><span class="token punctuation">:</span> <span class="token string">"^2.9.7"</span>\n  <span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>这里唯一不同寻常的软件包是 babel-preset-stage-0。动态导入是第三阶段的建议。如果你想你可以使用 babel-preset-stage-3，但 babel-preset-stage-0 将包括所有的阶段 1，阶段 2 和阶段 3。根据需要将其配置为您的代码库/喜好，你需要的是动态导入功能的阶段 3。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="72762915179383980000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// .babelrc\n{\n  &quot;presets&quot;: [\n    &quot;react&quot;,\n    [&quot;env&quot;, {\n      &quot;targets&quot;: {\n        &quot;browsers&quot;: [&quot;last 2 versions&quot;]\n      }\n    }],\n    &quot;stage-0&quot; <-- no big surprise here\n  ],\n  &quot;comments&quot;: true\n}`, `72762915179383980000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                js 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// .babelrc</span>\n<span class="token punctuation">{</span>\n  <span class="token string">"presets"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>\n    <span class="token string">"react"</span><span class="token punctuation">,</span>\n    <span class="token punctuation">[</span><span class="token string">"env"</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>\n      <span class="token string">"targets"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>\n        <span class="token string">"browsers"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">"last 2 versions"</span><span class="token punctuation">]</span>\n      <span class="token punctuation">}</span>\n    <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span>\n    <span class="token string">"stage-0"</span> <span class="token operator">&lt;</span><span class="token operator">--</span> no big surprise here\n  <span class="token punctuation">]</span><span class="token punctuation">,</span>\n  <span class="token string">"comments"</span><span class="token punctuation">:</span> <span class="token boolean">true</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>确保包含 stage-0 在你的 babel 预设中。有些事情要注意，有几个动态的输入插件 webpack/babel 在那。在这个用例中你不需要使用 Webpack 3（前端只有 react）。如果我错了希望有人能纠正我。请注意”comments”: true 设置。这将帮助我们使用 Webpack 的神奇评论来命名我们的动态导入文件。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="57218485919943630000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// webpack.config.js\n...\nentry: {\n    app: APP_DIR +\'/index.js\',\n    vendor: Object.keys(package.dependencies)\n},\noutput: {\n    publicPath: \'/\',\n    chunkFilename: \'[name].[chunkhash].js\',\n    filename: \'[name].[chunkhash].js\'\n  },\n...\nplugins: [\n    ...\n    new webpack.HashedModuleIdsPlugin(),\n    new webpack.optimize.CommonsChunkPlugin({\n      name:\'vendor\',\n      filename: \'vendor.[chunkhash].js\'\n    }),\n    new webpack.optimize.CommonsChunkPlugin({\n      name:\'manifest\'\n    })\n  ]\n...`, `57218485919943630000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                js 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// webpack.config.js</span>\n<span class="token operator">...</span>\nentry<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n    app<span class="token punctuation">:</span> <span class="token constant">APP_DIR</span> <span class="token operator">+</span><span class="token string">\'/index.js\'</span><span class="token punctuation">,</span>\n    vendor<span class="token punctuation">:</span> Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span><span class="token keyword">package</span><span class="token punctuation">.</span>dependencies<span class="token punctuation">)</span>\n<span class="token punctuation">}</span><span class="token punctuation">,</span>\noutput<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n    publicPath<span class="token punctuation">:</span> <span class="token string">\'/\'</span><span class="token punctuation">,</span>\n    chunkFilename<span class="token punctuation">:</span> <span class="token string">\'[name].[chunkhash].js\'</span><span class="token punctuation">,</span>\n    filename<span class="token punctuation">:</span> <span class="token string">\'[name].[chunkhash].js\'</span>\n  <span class="token punctuation">}</span><span class="token punctuation">,</span>\n<span class="token operator">...</span>\nplugins<span class="token punctuation">:</span> <span class="token punctuation">[</span>\n    <span class="token operator">...</span>\n    <span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>HashedModuleIdsPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n    <span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>optimize<span class="token punctuation">.</span>CommonsChunkPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n      name<span class="token punctuation">:</span><span class="token string">\'vendor\'</span><span class="token punctuation">,</span>\n      filename<span class="token punctuation">:</span> <span class="token string">\'vendor.[chunkhash].js\'</span>\n    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n    <span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>optimize<span class="token punctuation">.</span>CommonsChunkPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n      name<span class="token punctuation">:</span><span class="token string">\'manifest\'</span>\n    <span class="token punctuation">}</span><span class="token punctuation">)</span>\n  <span class="token punctuation">]</span>\n<span class="token operator">...</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>这就是“普通”React webpack 安装程序之外所需要的。这里有一些关于这个配置的更多细节。定义您的输入分割点。在我们的例子中，我们需要一个 app.x.js 和一个 vendor.x.js 文件：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="52690390687515040000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`entry: {\n  app: APP_DIR +\'/index.js\',\n  vendor: Object.keys(package.dependencies)\n},`, `52690390687515040000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                js 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js">entry<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n  app<span class="token punctuation">:</span> <span class="token constant">APP_DIR</span> <span class="token operator">+</span><span class="token string">\'/index.js\'</span><span class="token punctuation">,</span>\n  vendor<span class="token punctuation">:</span> Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span><span class="token keyword">package</span><span class="token punctuation">.</span>dependencies<span class="token punctuation">)</span>\n<span class="token punctuation">}</span><span class="token punctuation">,</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>[chunkhash]在输出中使用您的文件名 hash：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="45668941730263564000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`output: {\n  publicPath: \'/\',\n  chunkFilename: \'[name].[chunkhash].js\',\n  filename: \'[name].[chunkhash].js\'\n},`, `45668941730263564000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                js 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js">output<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n  publicPath<span class="token punctuation">:</span> <span class="token string">\'/\'</span><span class="token punctuation">,</span>\n  chunkFilename<span class="token punctuation">:</span> <span class="token string">\'[name].[chunkhash].js\'</span><span class="token punctuation">,</span>\n  filename<span class="token punctuation">:</span> <span class="token string">\'[name].[chunkhash].js\'</span>\n<span class="token punctuation">}</span><span class="token punctuation">,</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>在插件中，使用：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="32447784576084570000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`new webpack.HashedModuleIdsPlugin();`, `32447784576084570000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                js 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>HashedModuleIdsPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>那么你的 CommonsChunkPlugin 需要再次 chunkhash：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="77542733762332160000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`new webpack.optimize.CommonsChunkPlugin({\n  name:\'vendor\',\n  filename: \'vendor.[chunkhash].js\'\n}),`, `77542733762332160000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                js 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>optimize<span class="token punctuation">.</span>CommonsChunkPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n  name<span class="token punctuation">:</span><span class="token string">\'vendor\'</span><span class="token punctuation">,</span>\n  filename<span class="token punctuation">:</span> <span class="token string">\'vendor.[chunkhash].js\'</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>最后，但一个容易忽略的细节：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="35623013048450170000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`new webpack.optimize.CommonsChunkPlugin({\n  name: \'manifest\'\n});`, `35623013048450170000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                js 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>optimize<span class="token punctuation">.</span>CommonsChunkPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n  name<span class="token punctuation">:</span> <span class="token string">\'manifest\'</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>深入了解为什么清单文件在这里很重要。随意跳到 React 代码的下一节。没有 manifest chunk 块，Webpack 将产生这些文件：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="26629880833576470000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`pageOne.58e60ef81ba97426a00d.js 679 bytes\n   home.b65cb7fd922ea7126e95.js 671 bytes\n    app.3c3fcb4d6bcba55f3bb7.js 3.44 kB\nvendor.da901bd61614a0e9f2fe.js 1.25 MB\n                     index.html 397 bytes`, `26629880833576470000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                js 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js">pageOne<span class="token punctuation">.</span><span class="token number">58e60</span>ef81ba97426a00d<span class="token punctuation">.</span>js <span class="token number">679</span> bytes\n   home<span class="token punctuation">.</span>b65cb7fd922ea7126e95<span class="token punctuation">.</span>js <span class="token number">671</span> bytes\n    app<span class="token punctuation">.</span><span class="token number">3</span>c3fcb4d6bcba55f3bb7<span class="token punctuation">.</span>js <span class="token number">3.44</span> kB\nvendor<span class="token punctuation">.</span>da901bd61614a0e9f2fe<span class="token punctuation">.</span>js <span class="token number">1.25</span> <span class="token constant">MB</span>\n                     index<span class="token punctuation">.</span>html <span class="token number">397</span> bytes</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>你可能会想：“太棒了，它正在工作！” 你去做你的事情，改变 home 组件，Webpack 建立你的文件，然后你会伤心的。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="526551486897619500"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`  home.5a5f308381fc5670d102.js  674 bytes <--new hash expected\nvendor.c509e728faa4374eee45.js  1.25 MB <--new hash not expected\n                    index.html  397 bytes`, `526551486897619500`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                js 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js">  home<span class="token punctuation">.</span><span class="token number">5</span>a5f308381fc5670d102<span class="token punctuation">.</span>js  <span class="token number">674</span> bytes <span class="token operator">&lt;</span><span class="token operator">--</span><span class="token keyword">new</span> <span class="token class-name">hash</span> expected\nvendor<span class="token punctuation">.</span>c509e728faa4374eee45<span class="token punctuation">.</span>js  <span class="token number">1.25</span> <span class="token constant">MB</span> <span class="token operator">&lt;</span><span class="token operator">--</span><span class="token keyword">new</span> <span class="token class-name">hash</span> not expected\n                    index<span class="token punctuation">.</span>html  <span class="token number">397</span> bytes</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>是什么导致了？你没有给你的 package.json 改变/添加任何东西 。Webpack 文档简要地解释了这里发生了什么。这是非常高的水平，但我想知道什么是实际上改变的代码，以保证生成一个新的哈希 vendors.x.js 文件。</p>\n<p>如果你看看里面的生成，vendor.x.js 你会看到：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="90983198097197740000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`/******/ script.src =\n  __webpack_require__.p +\n  \'\' +\n  ({ \'0\': \'pageOne\', \'1\': \'home\', \'2\': \'app\' }[chunkId] || chunkId) +\n  \'.\' +\n  { \'0\': \'58e60ef81ba97426a00d\', \'1\': \'5a5f308381fc5670d102\', \'2\': \'3c3fcb4d6bcba55f3bb7\' }[chunkId] +\n  \'.js\';`, `90983198097197740000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                js 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">/******/</span> script<span class="token punctuation">.</span>src <span class="token operator">=</span>\n  __webpack_require__<span class="token punctuation">.</span>p <span class="token operator">+</span>\n  <span class="token string">\'\'</span> <span class="token operator">+</span>\n  <span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token string">\'0\'</span><span class="token punctuation">:</span> <span class="token string">\'pageOne\'</span><span class="token punctuation">,</span> <span class="token string">\'1\'</span><span class="token punctuation">:</span> <span class="token string">\'home\'</span><span class="token punctuation">,</span> <span class="token string">\'2\'</span><span class="token punctuation">:</span> <span class="token string">\'app\'</span> <span class="token punctuation">}</span><span class="token punctuation">[</span>chunkId<span class="token punctuation">]</span> <span class="token operator">||</span> chunkId<span class="token punctuation">)</span> <span class="token operator">+</span>\n  <span class="token string">\'.\'</span> <span class="token operator">+</span>\n  <span class="token punctuation">{</span> <span class="token string">\'0\'</span><span class="token punctuation">:</span> <span class="token string">\'58e60ef81ba97426a00d\'</span><span class="token punctuation">,</span> <span class="token string">\'1\'</span><span class="token punctuation">:</span> <span class="token string">\'5a5f308381fc5670d102\'</span><span class="token punctuation">,</span> <span class="token string">\'2\'</span><span class="token punctuation">:</span> <span class="token string">\'3c3fcb4d6bcba55f3bb7\'</span> <span class="token punctuation">}</span><span class="token punctuation">[</span>chunkId<span class="token punctuation">]</span> <span class="token operator">+</span>\n  <span class="token string">\'.js\'</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>啊哈！这是所有我们的[chunkhash]价值观。因为我们改变了 home 组件，所以生成了一个新的散列，并将其添加到“webpack 样板文件”中，然后将其反转到我们的 vendor.x.js 文件中。不完全是我们想要发生的，看到我们的 vendor 文件不会经常更改，通常是我们构建的最大的文件。让我们用一个 webpack manifest 文件运行相同的练习。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="20276103334455198000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`pageOne.58e60ef81ba97426a00d.js 679 bytes\n    home.5a5f308381fc5670d102.js 674 bytes\n  vendor.db2436c7653388db768a.js 1.24 MB\n     app.8e527bb7a890edfc1ef3.js 3.44 kB\nmanifest.2b89533b2a3dea66348d.js 5.96 kB`, `20276103334455198000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                js 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js">pageOne<span class="token punctuation">.</span><span class="token number">58e60</span>ef81ba97426a00d<span class="token punctuation">.</span>js <span class="token number">679</span> bytes\n    home<span class="token punctuation">.</span><span class="token number">5</span>a5f308381fc5670d102<span class="token punctuation">.</span>js <span class="token number">674</span> bytes\n  vendor<span class="token punctuation">.</span>db2436c7653388db768a<span class="token punctuation">.</span>js <span class="token number">1.24</span> <span class="token constant">MB</span>\n     app<span class="token punctuation">.</span><span class="token number">8e527</span>bb7a890edfc1ef3<span class="token punctuation">.</span>js <span class="token number">3.44</span> kB\nmanifest<span class="token punctuation">.</span><span class="token number">2</span>b89533b2a3dea66348d<span class="token punctuation">.</span>js <span class="token number">5.96</span> kB</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>改变 home</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="31071853792310813000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`    home.b65cb7fd922ea7126e95.js  671 bytes\nmanifest.c4a2e5b1ff1dcfbe35ae.js    5.96 kB`, `31071853792310813000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                js 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js">    home<span class="token punctuation">.</span>b65cb7fd922ea7126e95<span class="token punctuation">.</span>js  <span class="token number">671</span> bytes\nmanifest<span class="token punctuation">.</span>c4a2e5b1ff1dcfbe35ae<span class="token punctuation">.</span>js    <span class="token number">5.96</span> kB</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p>🎉 只有一个 home 组件和 manifest 产生新的散列 。让我们看看 manifest 文件里面：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="2087282995121242400"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`/******/ script.src =\n  __webpack_require__.p +\n  \'\' +\n  ({ \'0\': \'pageOne\', \'1\': \'home\', \'2\': \'vendor\', \'3\': \'app\' }[chunkId] || chunkId) +\n  \'.\' +\n  {\n    \'0\': \'58e60ef81ba97426a00d\',\n    \'1\': \'b65cb7fd922ea7126e95\',\n    \'2\': \'db2436c7653388db768a\',\n    \'3\': \'8e527bb7a890edfc1ef3\'\n  }[chunkId] +\n  \'.js\';`, `2087282995121242400`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                js 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">/******/</span> script<span class="token punctuation">.</span>src <span class="token operator">=</span>\n  __webpack_require__<span class="token punctuation">.</span>p <span class="token operator">+</span>\n  <span class="token string">\'\'</span> <span class="token operator">+</span>\n  <span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token string">\'0\'</span><span class="token punctuation">:</span> <span class="token string">\'pageOne\'</span><span class="token punctuation">,</span> <span class="token string">\'1\'</span><span class="token punctuation">:</span> <span class="token string">\'home\'</span><span class="token punctuation">,</span> <span class="token string">\'2\'</span><span class="token punctuation">:</span> <span class="token string">\'vendor\'</span><span class="token punctuation">,</span> <span class="token string">\'3\'</span><span class="token punctuation">:</span> <span class="token string">\'app\'</span> <span class="token punctuation">}</span><span class="token punctuation">[</span>chunkId<span class="token punctuation">]</span> <span class="token operator">||</span> chunkId<span class="token punctuation">)</span> <span class="token operator">+</span>\n  <span class="token string">\'.\'</span> <span class="token operator">+</span>\n  <span class="token punctuation">{</span>\n    <span class="token string">\'0\'</span><span class="token punctuation">:</span> <span class="token string">\'58e60ef81ba97426a00d\'</span><span class="token punctuation">,</span>\n    <span class="token string">\'1\'</span><span class="token punctuation">:</span> <span class="token string">\'b65cb7fd922ea7126e95\'</span><span class="token punctuation">,</span>\n    <span class="token string">\'2\'</span><span class="token punctuation">:</span> <span class="token string">\'db2436c7653388db768a\'</span><span class="token punctuation">,</span>\n    <span class="token string">\'3\'</span><span class="token punctuation">:</span> <span class="token string">\'8e527bb7a890edfc1ef3\'</span>\n  <span class="token punctuation">}</span><span class="token punctuation">[</span>chunkId<span class="token punctuation">]</span> <span class="token operator">+</span>\n  <span class="token string">\'.js\'</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>现在我们在 manifest 中的[chunkhash]值正与我们的 vendor 文件混淆起来。在你的 vendor 文件中搜索这个代码，你会发现它已经消失了。感觉不错。最后是 React 代码。这可能是最酷的部分。我可以看到如此多的反应可加载的潜力。正常导入看起来像：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="47631135191028220000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`import Home from \'./home\';`, `47631135191028220000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                js 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">import</span> Home <span class="token keyword">from</span> <span class="token string">\'./home\'</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>所有我们必须做的，以获得正确的动态导入：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="47693872397278200000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`import Loadable from \'react-loadable\'\nimport Loading from \'./loading\'\nconst Home = Loadable({\n  loader: () => import(\'./home\' /* webpackChunkName: \'home\' */),\n  loading: Loading, <-- a &quot;loading&quot; comp required by react-loadable\n})`, `47693872397278200000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                js 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">import</span> Loadable <span class="token keyword">from</span> <span class="token string">\'react-loadable\'</span>\n<span class="token keyword">import</span> Loading <span class="token keyword">from</span> <span class="token string">\'./loading\'</span>\n<span class="token keyword">const</span> Home <span class="token operator">=</span> <span class="token function">Loadable</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n  <span class="token function-variable function">loader</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">\'./home\'</span> <span class="token comment">/* webpackChunkName: \'home\' */</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n  loading<span class="token punctuation">:</span> Loading<span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token operator">--</span> a <span class="token string">"loading"</span> comp required by react<span class="token operator">-</span>loadable\n<span class="token punctuation">}</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>这里的所有都是它的。用 react-loadable 方式包装导入，并使用新的 import()语法。注意到 Webpack 中的评论/_ webpackChunkName: ‘your<em>component</em>name’ _/ 。无需指定 0.db2436c7653388db768a.js 的文件名。</p>',
excerpt:"翻译转载： Webpack 3, Dynamic Imports, Code Splitting, and Long Term Caching… Made Easy.  在与 Webpack 1.x 升级到 3.x…",frontmatter:{date:"2017-12-13 14:50:16",path:"/webpack-code-split/",tags:"前端, 前端构建工具, webpack",title:"Webpack3代码拆分",draft:null}}},pathContext:{mainPostPath:"/optimize-react/",nextPostPath:"/react-usage-part-3/",prePostPath:"/webpack-code-split/"}}}});