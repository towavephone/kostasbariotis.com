webpackJsonp([51590185498547],{1355:function(n,s){n.exports={data:{site:{siteMetadata:{title:"女王控的博客",description:'前端工程师，黑猫女王控，欢迎勾搭，技术相关<a href="https://github.com/towavephone" target="_blank">@towavephone</a>，QQ闲聊<a href="tencent://AddContact/?fromId=45&fromSubId=1&subcmd=all&uin=634407147&website=www.oicqzone.com">@towave</a>，bili关注<a href="https://space.bilibili.com/11507708#/" target="_blank">@towave</a>',siteUrl:"https://blog.towavephone.com"}}},pathContext:{posts:[{excerpt:"编码只是开发过程中的一小部分，为了使我们工作更加高效，我们必须学会调试，并擅长调试。 内容概要 文中列举了常用调试技巧，如下： Debugger 在代码中插入   可以在其位置触发断点调试。 Console.dir 使用   命令，可以打印出对象的结构，而   仅能打印返回值，在打印   属性时尤为有用。 ps: 大部分时候，对象返回值就是其结构 使用辅助工具，语法高亮、linting 它可以帮助我们快速定位问题，其实 flow 与 typescript…",html:'<p>编码只是开发过程中的一小部分，为了使我们工作更加高效，我们必须学会调试，并擅长调试。</p>\n<h1 id="内容概要"><a href="#%E5%86%85%E5%AE%B9%E6%A6%82%E8%A6%81" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>内容概要</h1>\n<p>文中列举了常用调试技巧，如下：</p>\n<h3 id="debugger"><a href="#debugger" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Debugger</h3>\n<p>在代码中插入 <code class="language-text">debugger</code> 可以在其位置触发断点调试。</p>\n<h3 id="consoledir"><a href="#consoledir" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Console.dir</h3>\n<p>使用 <code class="language-text">console.dir</code> 命令，可以打印出对象的结构，而 <code class="language-text">console.log</code> 仅能打印返回值，在打印 <code class="language-text">document</code> 属性时尤为有用。</p>\n<blockquote>\n<p>ps: 大部分时候，对象返回值就是其结构</p>\n</blockquote>\n<h3 id="使用辅助工具，语法高亮、linting"><a href="#%E4%BD%BF%E7%94%A8%E8%BE%85%E5%8A%A9%E5%B7%A5%E5%85%B7%EF%BC%8C%E8%AF%AD%E6%B3%95%E9%AB%98%E4%BA%AE%E3%80%81linting" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>使用辅助工具，语法高亮、linting</h3>\n<p>它可以帮助我们快速定位问题，其实 flow 与 typescript 也起到了很好的调试作用。</p>\n<h3 id="浏览器拓展"><a href="#%E6%B5%8F%E8%A7%88%E5%99%A8%E6%8B%93%E5%B1%95" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>浏览器拓展</h3>\n<p>使用类似 <a href="https://chrome.google.com/webstore/detail/react-developer-tools/fmkadmapgofadopljbjfkapdkoienihi" target="_blank" rel="nofollow noreferrer noopener">ReactDTools</a> <a href="https://chrome.google.com/webstore/detail/vuejs-devtools/nhdogjmejiglipccpnnnanhbledajbpd" target="_blank" rel="nofollow noreferrer noopener">VueDTools</a> 调试对应框架。</p>\n<h3 id="借助-devtools"><a href="#%E5%80%9F%E5%8A%A9-devtools" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>借助 DevTools</h3>\n<p>Chrome Dev Tools 非常强大，<a href="https://umaar.com/dev-tips/" target="_blank" rel="nofollow noreferrer noopener">dev-tips</a> 列出了 100 多条它可以做的事。</p>\n<h3 id="移动端调试工具"><a href="#%E7%A7%BB%E5%8A%A8%E7%AB%AF%E8%B0%83%E8%AF%95%E5%B7%A5%E5%85%B7" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>移动端调试工具</h3>\n<p>最靠谱的应该是 <a href="http://eruda.liriliri.io/" target="_blank" rel="nofollow noreferrer noopener">eruda</a>，可以内嵌在任何 h5 页面，充当 DevTools 控制台的作用。</p>\n<h3 id="实时调试"><a href="#%E5%AE%9E%E6%97%B6%E8%B0%83%E8%AF%95" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>实时调试</h3>\n<p>不需要预先埋点，比如 <code class="language-text">document.activeElement</code> 可以打印最近 focus 过的元素，因为打开控制台导致失去焦点，但我们可以通过此 api 获取它。</p>\n<h3 id="结构化打印对象瞬时状态"><a href="#%E7%BB%93%E6%9E%84%E5%8C%96%E6%89%93%E5%8D%B0%E5%AF%B9%E8%B1%A1%E7%9E%AC%E6%97%B6%E7%8A%B6%E6%80%81" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>结构化打印对象瞬时状态</h3>\n<p><code class="language-text">JSON.stringify(obj, null, 2)</code> 可以结构化打印出对象，因为是字符串，不用担心引用问题。</p>\n<h3 id="数组调试"><a href="#%E6%95%B0%E7%BB%84%E8%B0%83%E8%AF%95" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>数组调试</h3>\n<p>通过 <code class="language-text">Array.prototype.find</code> 快速寻找某个元素。</p>\n<h1 id="精读"><a href="#%E7%B2%BE%E8%AF%BB" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>精读</h1>\n<p>本精读由 <a href="https://github.com/rccoder" target="_blank" rel="nofollow noreferrer noopener">rccoder</a> <a href="https://github.com/ascoders" target="_blank" rel="nofollow noreferrer noopener">ascoders</a> <a href="https://github.com/NE-SmallTown" target="_blank" rel="nofollow noreferrer noopener">NE-SmallTown</a> <a href="https://github.com/BlackGanglion" target="_blank" rel="nofollow noreferrer noopener">BlackGanglion</a> <a href="https://github.com/jasonslyvia" target="_blank" rel="nofollow noreferrer noopener">jasonslyvia</a> <a href="https://github.com/alcat2008" target="_blank" rel="nofollow noreferrer noopener">alcat2008</a> <a href="https://github.com/DanielWLam" target="_blank" rel="nofollow noreferrer noopener">DanielWLam</a> <a href="https://github.com/HsuanXyz" target="_blank" rel="nofollow noreferrer noopener">HsuanXyz</a> <a href="https://github.com/huxiaoyun" target="_blank" rel="nofollow noreferrer noopener">huxiaoyun</a> <a href="https://github.com/vagusX" target="_blank" rel="nofollow noreferrer noopener">vagusX</a> 讨论而出。</p>\n<h3 id="移动端真机测试"><a href="#%E7%A7%BB%E5%8A%A8%E7%AB%AF%E7%9C%9F%E6%9C%BA%E6%B5%8B%E8%AF%95" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>移动端真机测试</h3>\n<p>由于 webview 不一定支持连接 chrome 控制台调试，只有真机测试才能复现真实场景。</p>\n<p><a href="https://www.browserstack.com/" target="_blank" rel="nofollow noreferrer noopener">browserstack</a> <a href="https://www.dynatrace.com/platform/offerings/customer-experience-monitoring/" target="_blank" rel="nofollow noreferrer noopener">dynatrace</a> 都是真机测试平台，公司内部应该也会搭建这种平台。</p>\n<h3 id="移动端控制台"><a href="#%E7%A7%BB%E5%8A%A8%E7%AB%AF%E6%8E%A7%E5%88%B6%E5%8F%B0" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>移动端控制台</h3>\n<ul>\n<li><a href="https://developers.google.com/web/tools/chrome-devtools/remote-debugging/webviews" target="_blank" rel="nofollow noreferrer noopener">Chrome 远程调试</a> app 支持后，连接 usb 或者局域网，即可通过 Dev Tools 调试 webview 页面。</li>\n<li><a href="http://people.apache.org/~pmuellr/weinre/docs/latest/Home.html" target="_blank" rel="nofollow noreferrer noopener">Weinre</a> 通过页面加载脚本，与 pc 端调试器通信。</li>\n<li>通过内嵌控制台解决，比如 <a href="http://eruda.liriliri.io/" target="_blank" rel="nofollow noreferrer noopener">eruda</a> <a href="https://github.com/WechatFE/vConsole" target="_blank" rel="nofollow noreferrer noopener">VConsole</a></li>\n<li><a href="http://alloyteam.github.io/Rosin/" target="_blank" rel="nofollow noreferrer noopener">Rosin</a> fiddler 的一个插件，协助移动页面调试。</li>\n<li><a href="https://jsconsole.com/" target="_blank" rel="nofollow noreferrer noopener">jsconsole</a> 在本地部署后，手机访问对应 ip，可以测试对应浏览器的控制台。</li>\n</ul>\n<h3 id="请求代理"><a href="#%E8%AF%B7%E6%B1%82%E4%BB%A3%E7%90%86" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>请求代理</h3>\n<p><a href="http://www.charlesproxy.com/" target="_blank" rel="nofollow noreferrer noopener">charles</a> <a href="http://www.telerik.com/fiddler" target="_blank" rel="nofollow noreferrer noopener">Fiddler</a> 可以抓包，更重要是可以代理请求。假数据、边界值测试、开发环境代码加载，每一项都非常有用。</p>\n<h3 id="定制-chrome-拓展"><a href="#%E5%AE%9A%E5%88%B6-chrome-%E6%8B%93%E5%B1%95" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>定制 Chrome 拓展</h3>\n<p>对于特定业务场景也可以通过开发 chrome 插件来做，比如分析自己网站的结构、版本、代码开发责任人、一键切换开发环境。</p>\n<h3 id="在用户设备调试"><a href="#%E5%9C%A8%E7%94%A8%E6%88%B7%E8%AE%BE%E5%A4%87%E8%B0%83%E8%AF%95" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>在用户设备调试</h3>\n<p>把控制台输出信息打到服务器，本地通过与服务器建立 socket 链接实时查看控制台信息。要知道实时根据用户 id 开启调试信息，并看用户真是环境的控制台打印信息是非常有用的，能解决很多难以复现问题。</p>\n<p>代码中可以使用封装过的 <code class="language-text">console.log</code>，当服务端开启调试状态后，对应用户网页会源源不断打出 log。</p>\n<h3 id="dom-断点、事件断点"><a href="#dom-%E6%96%AD%E7%82%B9%E3%80%81%E4%BA%8B%E4%BB%B6%E6%96%AD%E7%82%B9" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>DOM 断点、事件断点</h3>\n<ul>\n<li>DOM 断点，在 dom 元素右键，选择 （Break on subtree modifications），可以在此 dom 被修改时触发断点，在不确定 dom 被哪段 js 脚本修改时可能有用。</li>\n<li>Event Listener Breakpoints，神器之一，对于任何事件都能进入断点，比如 click，touch，script 事件统统能监听。</li>\n</ul>\n<h3 id="使用错误追踪平台"><a href="#%E4%BD%BF%E7%94%A8%E9%94%99%E8%AF%AF%E8%BF%BD%E8%B8%AA%E5%B9%B3%E5%8F%B0" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>使用错误追踪平台</h3>\n<p>对错误信息采集、分析、报警是很必要的，这里有一些对外服务：<a href="https://sentry.io/welcome/" target="_blank" rel="nofollow noreferrer noopener">sentry</a> <a href="https://trackjs.com/" target="_blank" rel="nofollow noreferrer noopener">trackjs</a></p>\n<h3 id="黑盒调试"><a href="#%E9%BB%91%E7%9B%92%E8%B0%83%E8%AF%95" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>黑盒调试</h3>\n<p>SourceMap 可以精准定位到代码，但有时候报错是由某处代码统一抛出的，比如 <a href="https://github.com/zertosh/invariant" target="_blank" rel="nofollow noreferrer noopener">invariant</a> 让人又爱又恨的库，所有定位全部跑到这个库里了（要你有何用），这时候，可以在 DevTools 源码中右键，选中 <code class="language-text">BlackBox Script</code>，它就变成黑盒了，下次 log 的定位将会是准确的。</p>\n<p><a href="https://hacks.mozilla.org/2013/08/new-features-of-firefox-developer-tools-episode-25/" target="_blank" rel="nofollow noreferrer noopener">FireFox</a>、<a href="https://umaar.com/dev-tips/128-blackboxing/" target="_blank" rel="nofollow noreferrer noopener">Chrome</a>。</p>\n<h3 id="删除无用的-css"><a href="#%E5%88%A0%E9%99%A4%E6%97%A0%E7%94%A8%E7%9A%84-css" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>删除无用的 css</h3>\n<p>css 不像 js 一样方便分析规则是否存在冗余，Chrome 帮我们做了这件事：<a href="https://umaar.com/dev-tips/126-css-tracker/" target="_blank" rel="nofollow noreferrer noopener">CSS Tracker</a>。</p>\n<h3 id="在-chrome-快速查找元素"><a href="#%E5%9C%A8-chrome-%E5%BF%AB%E9%80%9F%E6%9F%A5%E6%89%BE%E5%85%83%E7%B4%A0" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>在 Chrome 快速查找元素</h3>\n<p>Chrome 会记录最后插入的 5 个元素，分别以 <code class="language-text">$0</code> ~ <code class="language-text">$4</code> 的方式在控制台直接输出。</p>\n<p>\n  <a\n    class="gatsby-resp-image-link"\n    href="/static/2019-06-05-15-38-56-b58af1d9eea7c56d7d8303cd7d3d32ee-27a9d.png"\n    style="display: block"\n    target="_blank"\n    rel="noopener"\n  >\n  \n  <span\n    class="gatsby-resp-image-wrapper"\n    style="position: relative; display: block; ; max-width: 417px; margin-left: auto; margin-right: auto;"\n  >\n    <span\n      class="gatsby-resp-image-background-image"\n      style="padding-bottom: 123.74100719424462%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAZCAIAAAC+dZmEAAAACXBIWXMAAA7DAAAOwwHHb6hkAAACcUlEQVQ4y5VT23KbMBDl79v3fkWnj/2BJtOXpHZs1zSxsRObq20QSALdJXAXu9NmmgvJYUfsIC1n9+zKY5yB1U2NT6jrmlIKK2MM1uaE8xdwCCGwnn1YvcnNxJ/5ox+ji8sLsJvJDWA6nQZBMJlMfN9fr9fj8Ric5XI5Go0Wi8VsNoMD8/ncy3d5vjrgFItGkD3mhBljtNYGHqXNI9gTzn5/wBiPCVYsD4WfW24NtU6445vhlWWZRml8G5d5jlFWFijLqixF5R6hHcIVfgUebBNKsvUuDVbb6eV2vrq6TqfjKPbD6GdYFiUmLwcfuz4BiZUoShL59a4K1jyJuMx5k9Rd272Wdtf12yznLEc4nNdZsb5vogdaJ4RExFnXHbuX4LVta5SBcwJzo2SJ1aGQuData51x3avw4iTNiyIM46pA24x+/BJ/+Bx9+ppJpaEt+lFjnsJL02wTRmEcL4PgbhlczVbfrvzv1/5mG/q/bm/vFg8Pm6qCVgDF//CSJIFuFQXa7/fbzSZLohIdKK7gMPw0SpIwShrGnHP2CTyYYUyIdQ50ta6FEWrbXqS2a6VWUvYGu8+rDb8UTOpGSQpCIVLpAilOpKyEUwPT5oEYhNRWW6uFBRphhbBGWStNa9u/wj4fbKyRXKlaCZKLCuFSFUiemLlV9i3MFFrqgFlwJR0XQNsbMA8Eg2iSSWA+14yr9zBDr5uagTZWcjApHNRstbPCDDPDHWcN141WdaVIRbHGWEtIBEtQcZgZY/JHbSmUsLzPwPRquyFmBdnBFHMtaQk1UwJ9loIqReRwzXDn3BDDi8H/3O58c/v38WzvCH4/fgNjmZwh3GWNEAAAAABJRU5ErkJggg==\'); background-size: cover; display: block;"\n    >\n      <img\n        class="gatsby-resp-image-image"\n        style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;"\n        alt="2019 06 05 15 38 56"\n        title=""\n        src="/static/2019-06-05-15-38-56-b58af1d9eea7c56d7d8303cd7d3d32ee-27a9d.png"\n        srcset="/static/2019-06-05-15-38-56-b58af1d9eea7c56d7d8303cd7d3d32ee-6fc91.png 200w,\n/static/2019-06-05-15-38-56-b58af1d9eea7c56d7d8303cd7d3d32ee-7d566.png 400w,\n/static/2019-06-05-15-38-56-b58af1d9eea7c56d7d8303cd7d3d32ee-27a9d.png 417w"\n        sizes="(max-width: 417px) 100vw, 417px"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<h3 id="consoletable"><a href="#consoletable" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Console.table</h3>\n<p>以表格形式打印，对于对象数组尤为合适。</p>\n<h3 id="监听特定函数调用"><a href="#%E7%9B%91%E5%90%AC%E7%89%B9%E5%AE%9A%E5%87%BD%E6%95%B0%E8%B0%83%E7%94%A8" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>监听特定函数调用</h3>\n<p><code class="language-text">monitor</code> 有点像 <code class="language-text">proxy</code>，用 <code class="language-text">monitor</code> 包裹住的 function，在其调用后，会在控制台输出其调用信息。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="6259205328483541000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`> function func(num){}\n> monitor(func)\n> func(3)\n// < function func called with arguments: 3`, `6259205328483541000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                javascript 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="javascript"><pre style="counter-reset: linenumber NaN" class="language-javascript line-numbers"><code class="language-javascript"><span class="token operator">></span> <span class="token keyword">function</span> <span class="token function">func</span><span class="token punctuation">(</span><span class="token parameter">num</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span>\n<span class="token operator">></span> <span class="token function">monitor</span><span class="token punctuation">(</span>func<span class="token punctuation">)</span>\n<span class="token operator">></span> <span class="token function">func</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>\n<span class="token comment">// &lt; function func called with arguments: 3</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="模拟发送请求利器-postman"><a href="#%E6%A8%A1%E6%8B%9F%E5%8F%91%E9%80%81%E8%AF%B7%E6%B1%82%E5%88%A9%E5%99%A8-postman" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>模拟发送请求利器 PostMan</h3>\n<p><a href="https://www.getpostman.com/products" target="_blank" rel="nofollow noreferrer noopener">PostMan</a>, FireFox 控制台 Network 也支持此功能。</p>\n<h3 id="找到控制台最后一个对象"><a href="#%E6%89%BE%E5%88%B0%E6%8E%A7%E5%88%B6%E5%8F%B0%E6%9C%80%E5%90%8E%E4%B8%80%E4%B8%AA%E5%AF%B9%E8%B1%A1" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>找到控制台最后一个对象</h3>\n<p>有了 <code class="language-text">$_</code>，我们就不需要定义新的对象来打印值了，比如：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="39663257847245670000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`> [1, 2, 3, 4]\n< [1, 2, 3, 4]\n> \\$_.length\n// < 4`, `39663257847245670000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                javascript 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="javascript"><pre style="counter-reset: linenumber NaN" class="language-javascript line-numbers"><code class="language-javascript"><span class="token operator">></span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span>\n<span class="token operator">&lt;</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span>\n<span class="token operator">></span> $_<span class="token punctuation">.</span>length\n<span class="token comment">// &lt; 4</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>更多控制台相关技巧可以查看：<a href="https://developers.google.com/web/tools/chrome-devtools/console/command-line-reference?utm_source=dcc&#x26;utm_medium=redirect&#x26;utm_campaign=2016q3" target="_blank" rel="nofollow noreferrer noopener">command-line-reference</a>。</p>\n<h1 id="总结"><a href="#%E6%80%BB%E7%BB%93" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>总结</h1>\n<p>虽然在抛砖引玉，但整理完之后发现仍然是块砖头，调试技巧繁多，里面包含了通用的、不通用的，精读不可能一一列举。希望大家能根据自己的业务场景，掌握相关的调试技巧，让工作更加高效。</p>',id:"/github/workspace/blog/前端调试技巧/index.md absPath of file >>> MarkdownRemark",timeToRead:6,frontmatter:{date:"2019-06-05 15:37:02",path:"/frontend-debug-skill/",tags:"前端, 调试",title:"前端调试技巧",draft:null}},{excerpt:"React16 新特性 引言 于 2017.09.26 Facebook 发布 React v16.0 版本，时至今日已更新到 React v16.6，且引入了大量的令人振奋的新特性，本文章将带领大家根据 React 更新的时间脉络了解 React16 的新特性。 概述 按照 React16 的更新时间，从 React v16.0 ~ React v16.6 进行概述。 React v16.0 render 支持返回数组和字符串、Error Boundaries、createPortal…",html:'<h1 id="react16-新特性"><a href="#react16-%E6%96%B0%E7%89%B9%E6%80%A7" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>React16 新特性</h1>\n<h2 id="引言"><a href="#%E5%BC%95%E8%A8%80" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>引言</h2>\n<p>于 2017.09.26 Facebook 发布 React v16.0 版本，时至今日已更新到 React v16.6，且引入了大量的令人振奋的新特性，本文章将带领大家根据 React 更新的时间脉络了解 React16 的新特性。</p>\n<h2 id="概述"><a href="#%E6%A6%82%E8%BF%B0" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>概述</h2>\n<p>按照 React16 的更新时间，从 React v16.0 ~ React v16.6 进行概述。</p>\n<p><strong>React v16.0</strong></p>\n<ul>\n<li>render 支持返回数组和字符串、Error Boundaries、createPortal、支持自定义 DOM 属性、减少文件体积、fiber；</li>\n</ul>\n<p><strong>React v16.1</strong></p>\n<ul>\n<li>react-call-return；</li>\n</ul>\n<p><strong>React v16.2</strong></p>\n<ul>\n<li>Fragment；</li>\n</ul>\n<p><strong>React v16.3</strong></p>\n<ul>\n<li>createContext、createRef、forwardRef、生命周期函数的更新、Strict Mode；</li>\n</ul>\n<p><strong>React v16.4</strong></p>\n<ul>\n<li>Pointer Events、update getDerivedStateFromProps；</li>\n</ul>\n<p><strong>React v16.5</strong></p>\n<ul>\n<li>Profiler；</li>\n</ul>\n<p><strong>React v16.6</strong></p>\n<ul>\n<li>memo、lazy、Suspense、static contextType、static getDerivedStateFromError()；</li>\n</ul>\n<p><strong>React v16.7（~Q1 2019）</strong></p>\n<ul>\n<li>Hooks；</li>\n</ul>\n<p><strong>React v16.8（~Q2 2019）</strong></p>\n<ul>\n<li>Concurrent Rendering；</li>\n</ul>\n<p><strong>React v16.9（~mid 2019）</strong></p>\n<ul>\n<li>Suspense for Data Fetching；</li>\n</ul>\n<p>下面将按照上述的 React16 更新路径对每个新特性进行详细或简短的解析。</p>\n<h2 id="精读"><a href="#%E7%B2%BE%E8%AF%BB" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>精读</h2>\n<h3 id="react-v160"><a href="#react-v160" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>React v16.0</h3>\n<h4 id="render-支持返回数组和字符串"><a href="#render-%E6%94%AF%E6%8C%81%E8%BF%94%E5%9B%9E%E6%95%B0%E7%BB%84%E5%92%8C%E5%AD%97%E7%AC%A6%E4%B8%B2" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>render 支持返回数组和字符串</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="53153318908669060000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 不需要再将元素作为子元素装载到根元素下面\nrender() {\n  return [\n    <li/>1</li>,\n    <li/>2</li>,\n    <li/>3</li>,\n  ];\n}`, `53153318908669060000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                js 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// 不需要再将元素作为子元素装载到根元素下面</span>\n<span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">return</span> <span class="token punctuation">[</span>\n    <span class="token operator">&lt;</span>li<span class="token operator">/</span><span class="token operator">></span><span class="token number">1</span><span class="token operator">&lt;</span><span class="token operator">/</span>li<span class="token operator">></span><span class="token punctuation">,</span>\n    <span class="token operator">&lt;</span>li<span class="token operator">/</span><span class="token operator">></span><span class="token number">2</span><span class="token operator">&lt;</span><span class="token operator">/</span>li<span class="token operator">></span><span class="token punctuation">,</span>\n    <span class="token operator">&lt;</span>li<span class="token operator">/</span><span class="token operator">></span><span class="token number">3</span><span class="token operator">&lt;</span><span class="token operator">/</span>li<span class="token operator">></span><span class="token punctuation">,</span>\n  <span class="token punctuation">]</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="error-boundaries"><a href="#error-boundaries" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Error Boundaries</h4>\n<p>React15 在渲染过程中遇到运行时的错误，会导致整个 React 组件的崩溃，而且错误信息不明确可读性差。React16 支持了更优雅的错误处理策略，如果一个错误是在组件的渲染或者生命周期方法中被抛出，整个组件结构就会从根节点中卸载，而不影响其他组件的渲染，可以利用 error boundaries 进行错误的优化处理。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="97313898993022700000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`class ErrorBoundary extends React.Component {\n  state = { hasError: false };\n\n  componentDidCatch(error, info) {\n    this.setState({ hasError: true });\n\n    logErrorToMyService(error, info);\n  }\n\n  render() {\n    if (this.state.hasError) {\n      return <h1>数据错误</h1>;\n    }\n\n    return this.props.children;\n  }\n}`, `97313898993022700000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                js 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">class</span> <span class="token class-name">ErrorBoundary</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>\n  state <span class="token operator">=</span> <span class="token punctuation">{</span> hasError<span class="token punctuation">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n  <span class="token function">componentDidCatch</span><span class="token punctuation">(</span><span class="token parameter">error<span class="token punctuation">,</span> info</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span> hasError<span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token function">logErrorToMyService</span><span class="token punctuation">(</span>error<span class="token punctuation">,</span> info<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n\n  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>hasError<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token keyword">return</span> <span class="token operator">&lt;</span>h1<span class="token operator">></span>数据错误<span class="token operator">&lt;</span><span class="token operator">/</span>h1<span class="token operator">></span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n\n    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>children<span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="createportal"><a href="#createportal" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>createPortal</h4>\n<p>createPortal 的出现为弹窗、对话框等脱离文档流的组件开发提供了便利，替换了之前不稳定的 API unstable_renderSubtreeIntoContainer，在代码使用上可以做兼容，如：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="13976230509648490000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`const isReact16 = ReactDOM.createPortal !== undefined;\n\nconst getCreatePortal = () => (isReact16 ? ReactDOM.createPortal : ReactDOM.unstable_renderSubtreeIntoContainer);`, `13976230509648490000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                js 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">const</span> isReact16 <span class="token operator">=</span> ReactDOM<span class="token punctuation">.</span>createPortal <span class="token operator">!==</span> <span class="token keyword">undefined</span><span class="token punctuation">;</span>\n\n<span class="token keyword">const</span> <span class="token function-variable function">getCreatePortal</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span>isReact16 <span class="token operator">?</span> ReactDOM<span class="token punctuation">.</span>createPortal <span class="token punctuation">:</span> ReactDOM<span class="token punctuation">.</span>unstable_renderSubtreeIntoContainer<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>使用 createPortal 可以快速创建 Dialog 组件，且不需要牵扯到 componentDidMount、componentDidUpdate 等生命周期函数。</p>\n<p>并且通过 createPortal 渲染的 DOM，事件可以从 portal 的入口端冒泡上来，如果入口端存在 onDialogClick 等事件，createPortal 中的 DOM 也能够被调用到。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="93700703643680260000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`import React from \'react\';\nimport { createPortal } from \'react-dom\';\n\nclass Dialog extends React.Component {\n  constructor() {\n    super(props);\n\n    this.node = document.createElement(\'div\');\n    document.body.appendChild(this.node);\n  }\n\n  render() {\n    return createPortal(<div>{this.props.children}</div>, this.node);\n  }\n}`, `93700703643680260000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                js 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">\'react\'</span><span class="token punctuation">;</span>\n<span class="token keyword">import</span> <span class="token punctuation">{</span> createPortal <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">\'react-dom\'</span><span class="token punctuation">;</span>\n\n<span class="token keyword">class</span> <span class="token class-name">Dialog</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>\n  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">super</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">this</span><span class="token punctuation">.</span>node <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">\'div\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>node<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n\n  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">return</span> <span class="token function">createPortal</span><span class="token punctuation">(</span><span class="token operator">&lt;</span>div<span class="token operator">></span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>children<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>node<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="支持自定义-dom-属性"><a href="#%E6%94%AF%E6%8C%81%E8%87%AA%E5%AE%9A%E4%B9%89-dom-%E5%B1%9E%E6%80%A7" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>支持自定义 DOM 属性</h3>\n<p>以前的 React 版本 DOM 不识别除了 HTML 和 SVG 支持的以外属性，在 React16 版本中将会把全部的属性传递给 DOM 元素。这个新特性可以让我们摆脱可用的 React DOM 属性白名单。笔者之前写过一个方法，用于过滤非 DOM 属性 <a href="https://github.com/twobin/filter-react-dom-props" target="_blank" rel="nofollow noreferrer noopener">filter-react-dom-props</a>，16 之后即可不再需要这样的方法。</p>\n<h3 id="减少文件体积"><a href="#%E5%87%8F%E5%B0%91%E6%96%87%E4%BB%B6%E4%BD%93%E7%A7%AF" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>减少文件体积</h3>\n<p>React16 使用 Rollup 针对不同的目标格式进行代码打包，由于打包工具的改变使得库文件大小得到缩减。</p>\n<ul>\n<li>React 库大小从 20.7kb（压缩后 6.9kb）降低到 5.3kb（压缩后 2.2kb）</li>\n<li>ReactDOM 库大小从 141kb（压缩后 42.9kb）降低到 103.7kb（压缩后 32.6kb）</li>\n<li>React + ReactDOM 库大小从 161.7kb（压缩后 49.8kb）降低到 109kb（压缩后 43.8kb）</li>\n</ul>\n<h3 id="fiber"><a href="#fiber" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Fiber</h3>\n<p>Fiber 是对 React 核心算法的一次重新实现，将原本的同步更新过程碎片化，避免主线程的长时间阻塞，使应用的渲染更加流畅。</p>\n<p>在 React16 之前，更新组件时会调用各个组件的生命周期函数，计算和比对 Virtual DOM，更新 DOM 树等，整个过程是同步进行的，中途无法中断。当组件比较庞大，更新操作耗时较长时，就会导致浏览器唯一的主线程都是执行组件更新操作，而无法响应用户的输入或动画的渲染，很影响用户体验。</p>\n<p>Fiber 利用分片的思想，把一个耗时长的任务分成很多小片，每一个小片的运行时间很短，在每个小片执行完之后，就把控制权交还给 React 负责任务协调的模块，如果有紧急任务就去优先处理，如果没有就继续更新，这样就给其他任务一个执行的机会，唯一的线程就不会一直被独占。</p>\n<p>因此，在组件更新时有可能一个更新任务还没有完成，就被另一个更高优先级的更新过程打断，优先级高的更新任务会优先处理完，而低优先级更新任务所做的工作则会完全作废，然后等待机会重头再来。所以 React Fiber 把一个更新过程分为两个阶段：</p>\n<ul>\n<li>第一个阶段 Reconciliation Phase，Fiber 会找出需要更新的 DOM，这个阶段是可以被打断的；</li>\n<li>第二个阶段 Commit Phase，无法被打断，完成 DOM 的更新并展示；</li>\n</ul>\n<p>在使用 Fiber 后，需要要检查与第一阶段相关的生命周期函数，避免逻辑的多次或重复调用：</p>\n<ul>\n<li>componentWillMount</li>\n<li>componentWillReceiveProps</li>\n<li>shouldComponentUpdate</li>\n<li>componentWillUpdate</li>\n</ul>\n<p>与第二阶段相关的生命周期函数：</p>\n<ul>\n<li>componentDidMount</li>\n<li>componentDidUpdate</li>\n<li>componentWillUnmount</li>\n</ul>\n<h2 id="react-v161"><a href="#react-v161" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>React v16.1</h2>\n<h3 id="call-return（react-call-return-npm）"><a href="#call-return%EF%BC%88react-call-return-npm%EF%BC%89" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Call Return（react-call-return npm）</h3>\n<p>react-call-return 目前还是一个独立的 npm 包，主要是针对父组件需要根据子组件的回调信息去渲染子组件场景 提供的解决方案。</p>\n<p>在 React16 之前，针对上述场景一般有两个解决方案：</p>\n<ul>\n<li>\n<p>首先让子组件初始化渲染，通过回调函数把信息传给父组件，父组件完成处理后更新子组件 props，触发子组件的第二次渲染才可以解决，子组件需要经过两次渲染周期，可能会造成渲染的抖动或闪烁等问题；</p>\n</li>\n<li>\n<p>首先在父组件通过 children 获得子组件并读取其信息，利用 React.cloneElement 克隆产生新元素，并将新的属性传递进去，父组件 render 返回的是克隆产生的子元素。虽然这种方法只需要使用一个生命周期，但是父组件的代码编写会比较麻烦；</p>\n</li>\n</ul>\n<p>React16 支持的 react-call-return，提供了两个函数 unstable<em>createCall 和 unstable</em>createReturn，其中 unstable<em>createCall 是 父组件使用，unstable</em>createReturn 是 子组件使用，父组件发出 Call，子组件响应这个 Call，即 Return。</p>\n<ul>\n<li>\n<p>在父组件 render 函数中返回对 unstable_createCall 的调用，第一个参数是 props.children，第二个参数是一个回调函数，用于接受子组件响应 Call 所返回的信息，第三个参数是 props；</p>\n</li>\n<li>\n<p>在子组件 render 函数返回对 unstable<em>createReturn 的调用，参数是一个对象，这个对象会在 unstable</em>createCall 第二个回调函数参数中访问到；</p>\n</li>\n<li>\n<p>当父组件下的所有子组件都完成渲染周期后，由于子组件返回的是对 unstable<em>createReturn 的调用所以并没有渲染元素，unstable</em>createCall 的第二个回调函数参数会被调用，这个回调函数返回的是真正渲染子组件的元素；</p>\n</li>\n</ul>\n<p>针对普通场景来说，react-call-return 有点过度设计的感觉，但是如果针对一些特定场景的话，它的作用还是非常明显，比如，在渲染瀑布流布局时，利用 react-call-return 可以先缓存子组件的 ReactElement，等必要的信息足够之后父组件再触发 render，完成渲染。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="81642758411539870000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`import React from \'react\';\nimport { unstable_createReturn, unstable_createCall } from \'react-call-return\';\n\nconst Child = (props) => {\n  return unstable_createReturn({\n    size: props.children.length,\n    renderItem: (partSize, totalSize) => {\n      return (\n        <div>\n          {props.children} {partSize} / {totalSize}\n        </div>\n      );\n    }\n  });\n};\n\nconst Parent = (props) => {\n  return (\n    <div>\n      {unstable_createCall(\n        props.children,\n        (props, returnValues) => {\n          const totalSize = returnValues.map((v) => v.size).reduce((a, b) => a + b, 0);\n          return returnValues.map(({ size, renderItem }) => {\n            return renderItem(size, totalSize);\n          });\n        },\n        props\n      )}\n    </div>\n  );\n};`, `81642758411539870000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                js 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">\'react\'</span><span class="token punctuation">;</span>\n<span class="token keyword">import</span> <span class="token punctuation">{</span> unstable_createReturn<span class="token punctuation">,</span> unstable_createCall <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">\'react-call-return\'</span><span class="token punctuation">;</span>\n\n<span class="token keyword">const</span> <span class="token function-variable function">Child</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n  <span class="token keyword">return</span> <span class="token function">unstable_createReturn</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n    size<span class="token punctuation">:</span> props<span class="token punctuation">.</span>children<span class="token punctuation">.</span>length<span class="token punctuation">,</span>\n    <span class="token function-variable function">renderItem</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token parameter">partSize<span class="token punctuation">,</span> totalSize</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n      <span class="token keyword">return</span> <span class="token punctuation">(</span>\n        <span class="token operator">&lt;</span>div<span class="token operator">></span>\n          <span class="token punctuation">{</span>props<span class="token punctuation">.</span>children<span class="token punctuation">}</span> <span class="token punctuation">{</span>partSize<span class="token punctuation">}</span> <span class="token operator">/</span> <span class="token punctuation">{</span>totalSize<span class="token punctuation">}</span>\n        <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>\n      <span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n<span class="token keyword">const</span> <span class="token function-variable function">Parent</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n  <span class="token keyword">return</span> <span class="token punctuation">(</span>\n    <span class="token operator">&lt;</span>div<span class="token operator">></span>\n      <span class="token punctuation">{</span><span class="token function">unstable_createCall</span><span class="token punctuation">(</span>\n        props<span class="token punctuation">.</span>children<span class="token punctuation">,</span>\n        <span class="token punctuation">(</span><span class="token parameter">props<span class="token punctuation">,</span> returnValues</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n          <span class="token keyword">const</span> totalSize <span class="token operator">=</span> returnValues<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">v</span><span class="token punctuation">)</span> <span class="token operator">=></span> v<span class="token punctuation">.</span>size<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token operator">=></span> a <span class="token operator">+</span> b<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n          <span class="token keyword">return</span> returnValues<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> size<span class="token punctuation">,</span> renderItem <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n            <span class="token keyword">return</span> <span class="token function">renderItem</span><span class="token punctuation">(</span>size<span class="token punctuation">,</span> totalSize<span class="token punctuation">)</span><span class="token punctuation">;</span>\n          <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token punctuation">}</span><span class="token punctuation">,</span>\n        props\n      <span class="token punctuation">)</span><span class="token punctuation">}</span>\n    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>\n  <span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id="react-v162"><a href="#react-v162" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>React v16.2</h2>\n<h3 id="fragment"><a href="#fragment" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Fragment</h3>\n<p>Fragment 组件其作用是可以将一些子元素添加到 DOM tree 上且不需要为这些元素提供额外的父节点，相当于 render 返回数组元素。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="24160961099472810000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`render() {\n  return (\n    <Fragment>\n      Some text.\n      <h2>A heading</h2>\n      More text.\n      <h2>Another heading</h2>\n      Even more text.\n    </Fragment>\n  );\n}`, `24160961099472810000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                js 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">return</span> <span class="token punctuation">(</span>\n    <span class="token operator">&lt;</span>Fragment<span class="token operator">></span>\n      Some text<span class="token punctuation">.</span>\n      <span class="token operator">&lt;</span>h2<span class="token operator">></span><span class="token constant">A</span> heading<span class="token operator">&lt;</span><span class="token operator">/</span>h2<span class="token operator">></span>\n      More text<span class="token punctuation">.</span>\n      <span class="token operator">&lt;</span>h2<span class="token operator">></span>Another heading<span class="token operator">&lt;</span><span class="token operator">/</span>h2<span class="token operator">></span>\n      Even more text<span class="token punctuation">.</span>\n    <span class="token operator">&lt;</span><span class="token operator">/</span>Fragment<span class="token operator">></span>\n  <span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id="react-v163"><a href="#react-v163" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>React v16.3</h2>\n<h3 id="createcontext"><a href="#createcontext" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>createContext</h3>\n<p>全新的 Context API 可以很容易穿透组件而无副作用，其包含三部分：React.createContext，Provider，Consumer。</p>\n<ul>\n<li>React.createContext 是一个函数，它接收初始值并返回带有 Provider 和 Consumer 组件的对象；</li>\n<li>Provider 组件是数据的发布方，一般在组件树的上层并接收一个数据的初始值；</li>\n<li>Consumer 组件是数据的订阅方，它的 props.children 是一个函数，接收被发布的数据，并且返回 React Element；</li>\n</ul>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="6450752407573624000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`const ThemeContext = React.createContext(\'light\');\n\nclass ThemeProvider extends React.Component {\n  state = { theme: \'light\' };\n\n  render() {\n    return <ThemeContext.Provider value={this.state.theme}>{this.props.children}</ThemeContext.Provider>;\n  }\n}\n\nclass ThemedButton extends React.Component {\n  render() {\n    return <ThemeContext.Consumer>{(theme) => <Button theme={theme} />}</ThemeContext.Consumer>;\n  }\n}`, `6450752407573624000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                js 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">const</span> ThemeContext <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">createContext</span><span class="token punctuation">(</span><span class="token string">\'light\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token keyword">class</span> <span class="token class-name">ThemeProvider</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>\n  state <span class="token operator">=</span> <span class="token punctuation">{</span> theme<span class="token punctuation">:</span> <span class="token string">\'light\'</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">return</span> <span class="token operator">&lt;</span>ThemeContext<span class="token punctuation">.</span>Provider value<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>theme<span class="token punctuation">}</span><span class="token operator">></span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>children<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>ThemeContext<span class="token punctuation">.</span>Provider<span class="token operator">></span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">class</span> <span class="token class-name">ThemedButton</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>\n  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">return</span> <span class="token operator">&lt;</span>ThemeContext<span class="token punctuation">.</span>Consumer<span class="token operator">></span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token parameter">theme</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token operator">&lt;</span>Button theme<span class="token operator">=</span><span class="token punctuation">{</span>theme<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>ThemeContext<span class="token punctuation">.</span>Consumer<span class="token operator">></span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="createref--forwardref"><a href="#createref--forwardref" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>createRef / forwardRef</h3>\n<p>React16 规范了 Ref 的获取方式，通过 React.createRef 取得 Ref 对象。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="11804873556499284000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// before React 16\n···\n\n  componentDidMount() {\n    const el = this.refs.myRef\n  }\n\n  render() {\n    return <div ref=&quot;myRef&quot; />\n  }\n\n···\n\n// React 16+\n  constructor(props) {\n    super(props)\n\n    this.myRef = React.createRef()\n  }\n\n  render() {\n    return <div ref={this.myRef} />\n  }\n···`, `11804873556499284000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                js 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// before React 16</span>\n···\n\n  <span class="token function">componentDidMount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">const</span> el <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>refs<span class="token punctuation">.</span>myRef\n  <span class="token punctuation">}</span>\n\n  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">return</span> <span class="token operator">&lt;</span>div ref<span class="token operator">=</span><span class="token string">"myRef"</span> <span class="token operator">/</span><span class="token operator">></span>\n  <span class="token punctuation">}</span>\n\n···\n\n<span class="token comment">// React 16+</span>\n  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">super</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span>\n\n    <span class="token keyword">this</span><span class="token punctuation">.</span>myRef <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">createRef</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n  <span class="token punctuation">}</span>\n\n  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">return</span> <span class="token operator">&lt;</span>div ref<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>myRef<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span>\n  <span class="token punctuation">}</span>\n···</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>React.forwardRef 是 Ref 的转发, 它能够让父组件访问到子组件的 Ref，从而操作子组件的 DOM。 React.forwardRef 接收一个函数，函数参数有 props 和 ref。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="6292867638043376000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`const TextInput = React.forwardRef((props, ref) => <input type=\'text\' placeholder=\'Hello forwardRef\' ref={ref} />);\n\nconst inputRef = React.createRef();\n\nclass App extends Component {\n  constructor(props) {\n    super(props);\n\n    this.myRef = React.createRef();\n  }\n\n  handleSubmit = (event) => {\n    event.preventDefault();\n\n    alert(\'input value is:\' + inputRef.current.value);\n  };\n\n  render() {\n    return (\n      <form onSubmit={this.handleSubmit}>\n        <TextInput ref={inputRef} />\n        <button type=\'submit\'>Submit</button>\n      </form>\n    );\n  }\n}`, `6292867638043376000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                js 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">const</span> TextInput <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">forwardRef</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">props<span class="token punctuation">,</span> ref</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token operator">&lt;</span>input type<span class="token operator">=</span><span class="token string">\'text\'</span> placeholder<span class="token operator">=</span><span class="token string">\'Hello forwardRef\'</span> ref<span class="token operator">=</span><span class="token punctuation">{</span>ref<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token keyword">const</span> inputRef <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">createRef</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token keyword">class</span> <span class="token class-name">App</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span>\n  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">super</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">this</span><span class="token punctuation">.</span>myRef <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">createRef</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n\n  <span class="token function-variable function">handleSubmit</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n    event<span class="token punctuation">.</span><span class="token function">preventDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">\'input value is:\'</span> <span class="token operator">+</span> inputRef<span class="token punctuation">.</span>current<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">return</span> <span class="token punctuation">(</span>\n      <span class="token operator">&lt;</span>form onSubmit<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>handleSubmit<span class="token punctuation">}</span><span class="token operator">></span>\n        <span class="token operator">&lt;</span>TextInput ref<span class="token operator">=</span><span class="token punctuation">{</span>inputRef<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span>\n        <span class="token operator">&lt;</span>button type<span class="token operator">=</span><span class="token string">\'submit\'</span><span class="token operator">></span>Submit<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">></span>\n      <span class="token operator">&lt;</span><span class="token operator">/</span>form<span class="token operator">></span>\n    <span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="生命周期函数的更新"><a href="#%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F%E5%87%BD%E6%95%B0%E7%9A%84%E6%9B%B4%E6%96%B0" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>生命周期函数的更新</h3>\n<p>React16 采用了新的内核架构 Fiber，Fiber 将组件更新分为两个阶段：Render Parse 和 Commit Parse，因此 React 也引入了 getDerivedStateFromProps 、 getSnapshotBeforeUpdate 及 componentDidCatch 等三个全新的生命周期函数。同时也将 componentWillMount、componentWillReceiveProps 和 componentWillUpdate 标记为不安全的方法。</p>\n<h4 id="static-getderivedstatefrompropsnextprops-prevstate"><a href="#static-getderivedstatefrompropsnextprops-prevstate" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>static getDerivedStateFromProps(nextProps, prevState)</h4>\n<p>getDerivedStateFromProps(nextProps, prevState) 其作用是根据传递的 props 来更新 state。它的一大特点是无副作用，由于处在 Render Phase 阶段，所以在每次的更新都会触发该函数， 在 API 设计上采用了静态方法，使其无法访问实例、无法通过 ref 访问到 DOM 对象等，保证了该函数的纯粹高效。</p>\n<p>为了配合未来的 React 异步渲染机制，React v16.4 对 getDerivedStateFromProps 做了一些改变， 使其不仅在 props 更新时会被调用，setState 时也会被触发。</p>\n<ul>\n<li>如果改变 props 的同时，有副作用的产生，这时应该使用 componentDidUpdate；</li>\n<li>如果想要根据 props 计算属性，应该考虑将结果 memoization 化；</li>\n<li>如果想要根据 props 变化来重置某些状态，应该考虑使用受控组件；</li>\n</ul>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="27970418733919076000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`static getDerivedStateFromProps(props, state) {\n  if (props.value !== state.controlledValue) {\n    return {\n      controlledValue: props.value,\n    };\n  }\n\n  return null;\n}`, `27970418733919076000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                js 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">static</span> <span class="token function">getDerivedStateFromProps</span><span class="token punctuation">(</span><span class="token parameter">props<span class="token punctuation">,</span> state</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">if</span> <span class="token punctuation">(</span>props<span class="token punctuation">.</span>value <span class="token operator">!==</span> state<span class="token punctuation">.</span>controlledValue<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">return</span> <span class="token punctuation">{</span>\n      controlledValue<span class="token punctuation">:</span> props<span class="token punctuation">.</span>value<span class="token punctuation">,</span>\n    <span class="token punctuation">}</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n\n  <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="getsnapshotbeforeupdateprevprops-prevstate"><a href="#getsnapshotbeforeupdateprevprops-prevstate" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>getSnapshotBeforeUpdate(prevProps, prevState)</h4>\n<p>getSnapshotBeforeUpdate(prevProps, prevState) 会在组件更新之前获取一个 snapshot，并可以将计算得的值或从 DOM 得到的信息传递到 componentDidUpdate(prevProps, prevState, snapshot) 函数的第三个参数，常常用于 scroll 位置定位等场景。</p>\n<h4 id="componentdidcatcherror-info"><a href="#componentdidcatcherror-info" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>componentDidCatch(error, info)</h4>\n<p>componentDidCatch 函数让开发者可以自主处理错误信息，诸如错误展示，上报错误等，用户可以创建自己的 Error Boundary 来捕获错误。</p>\n<h4 id="componentwillmountnextprops-nextstate"><a href="#componentwillmountnextprops-nextstate" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>componentWillMount(nextProps, nextState)</h4>\n<p>componentWillMount 被标记为不安全，因为在 componentWillMount 中获取异步数据或进行事件订阅等操作会产生一些问题，比如无法保证在 componentWillUnmount 中取消掉相应的事件订阅，或者导致多次重复获取异步数据等问题。</p>\n<h4 id="componentwillreceivepropsnextprops--componentwillupdatenextprops-nextstate"><a href="#componentwillreceivepropsnextprops--componentwillupdatenextprops-nextstate" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>componentWillReceiveProps(nextProps) / componentWillUpdate(nextProps, nextState)</h4>\n<p>componentWillReceiveProps / componentWillUpdate 被标记为不安全，主要是因为操作 props 引起的 re-render 问题，并且对 DOM 的更新操作也可能导致重新渲染。</p>\n<h3 id="strict-mode"><a href="#strict-mode" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Strict Mode</h3>\n<p>StrictMode 可以在开发阶段开启严格模式，发现应用存在的潜在问题，提升应用的健壮性，主要能检测下列问题：</p>\n<ul>\n<li>识别被标志位不安全的生命周期函数</li>\n<li>对弃用的 API 进行警告</li>\n<li>探测某些产生副作用的方法</li>\n<li>检测是否使用 findDOMNode</li>\n<li>检测是否采用了老的 Context API</li>\n</ul>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="51946141646076160000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`class App extends React.Component {\n  render() {\n    return (\n      <div>\n        <React.StrictMode>\n          <ComponentA />\n        </React.StrictMode>\n      </div>\n    );\n  }\n}`, `51946141646076160000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                js 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">class</span> <span class="token class-name">App</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>\n  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">return</span> <span class="token punctuation">(</span>\n      <span class="token operator">&lt;</span>div<span class="token operator">></span>\n        <span class="token operator">&lt;</span>React<span class="token punctuation">.</span>StrictMode<span class="token operator">></span>\n          <span class="token operator">&lt;</span>ComponentA <span class="token operator">/</span><span class="token operator">></span>\n        <span class="token operator">&lt;</span><span class="token operator">/</span>React<span class="token punctuation">.</span>StrictMode<span class="token operator">></span>\n      <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>\n    <span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id="react-v164"><a href="#react-v164" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>React v16.4</h2>\n<h3 id="pointer-events"><a href="#pointer-events" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Pointer Events</h3>\n<p>指针事件是为指针设备触发的 DOM 事件。它们旨在创建单个 DOM 事件模型来处理指向输入设备，例如鼠标，笔 / 触控笔或触摸（例如一个或多个手指）。指针是一个与硬件无关的设备，可以定位一组特定的屏幕坐标。拥有指针的单个事件模型可以简化创建 Web 站点和应用程序，并提供良好的用户体验，无论用户的硬件如何。但是，对于需要特定于设备的处理的场景，指针事件定义了一个 pointerType 属性，用于检查产生事件的设备类型。</p>\n<p>React 新增 onPointerDown / onPointerMove / onPointerUp / onPointerCancel / onGotPointerCapture / onLostPointerCapture / onPointerEnter / onPointerLeave / onPointerOver / onPointerOut 等指针事件。</p>\n<p>这些事件只能在支持 指针事件 规范的浏览器中工作。如果应用程序依赖于指针事件，建议使用第三方指针事件 polyfill。</p>\n<h2 id="react-v165"><a href="#react-v165" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>React v16.5</h2>\n<h3 id="profiler"><a href="#profiler" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Profiler</h3>\n<p>React 16.5 添加了对新的 profiler DevTools 插件的支持。这个插件使用 React 的 Profiler 实验性 API 去收集所有 component 的渲染时间，目的是为了找出 React App 的性能瓶颈，它将会和 React 即将发布的 时间片 特性完全兼容。</p>\n<h2 id="react-v166"><a href="#react-v166" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>React v16.6</h2>\n<h3 id="memo"><a href="#memo" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>memo</h3>\n<p>React.memo() 只能作用在简单的函数组件上，本质是一个高阶函数，可以自动帮助组件执行 shouldComponentUpdate()，但只是执行浅比较，其意义和价值有限。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="33057164806248428000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`const MemoizedComponent = React.memo((props) => {\n  /* 只在 props 更改的时候才会重新渲染 */\n});`, `33057164806248428000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                js 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">const</span> MemoizedComponent <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">memo</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n  <span class="token comment">/* 只在 props 更改的时候才会重新渲染 */</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<h3 id="lazy--suspense"><a href="#lazy--suspense" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>lazy / Suspense</h3>\n<p>React.lazy() 提供了动态 import 组件的能力，实现代码分割。</p>\n<p>Suspense 作用是在等待组件时 suspend（暂停）渲染，并显示加载标识。</p>\n<p>目前 React v16.6 中 Suspense 只支持一个场景，即使用 React.lazy() 和 &#x3C;React.Suspense> 实现的动态加载组件。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="47817750946115670000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`import React, { lazy, Suspense } from \'react\';\nconst OtherComponent = lazy(() => import(\'./OtherComponent\'));\n\nfunction MyComponent() {\n  return (\n    <Suspense fallback={<div>Loading...</div>}>\n      <OtherComponent />\n    </Suspense>\n  );\n}`, `47817750946115670000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                js 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> lazy<span class="token punctuation">,</span> Suspense <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">\'react\'</span><span class="token punctuation">;</span>\n<span class="token keyword">const</span> OtherComponent <span class="token operator">=</span> <span class="token function">lazy</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">\'./OtherComponent\'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token keyword">function</span> <span class="token function">MyComponent</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">return</span> <span class="token punctuation">(</span>\n    <span class="token operator">&lt;</span>Suspense fallback<span class="token operator">=</span><span class="token punctuation">{</span><span class="token operator">&lt;</span>div<span class="token operator">></span>Loading<span class="token operator">...</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span><span class="token punctuation">}</span><span class="token operator">></span>\n      <span class="token operator">&lt;</span>OtherComponent <span class="token operator">/</span><span class="token operator">></span>\n    <span class="token operator">&lt;</span><span class="token operator">/</span>Suspense<span class="token operator">></span>\n  <span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="static-contexttype"><a href="#static-contexttype" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>static contextType</h3>\n<p>static contextType 为 Context API 提供了更加便捷的使用体验，可以通过 this.context 来访问 Context。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="58519870562119930000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`const MyContext = React.createContext();\n\nclass MyClass extends React.Component {\n  static contextType = MyContext;\n\n  componentDidMount() {\n    const value = this.context;\n  }\n\n  componentDidUpdate() {\n    const value = this.context;\n  }\n\n  componentWillUnmount() {\n    const value = this.context;\n  }\n\n  render() {\n    const value = this.context;\n  }\n}`, `58519870562119930000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                js 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">const</span> MyContext <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">createContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token keyword">class</span> <span class="token class-name">MyClass</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>\n  <span class="token keyword">static</span> contextType <span class="token operator">=</span> MyContext<span class="token punctuation">;</span>\n\n  <span class="token function">componentDidMount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">const</span> value <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>context<span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n\n  <span class="token function">componentDidUpdate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">const</span> value <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>context<span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n\n  <span class="token function">componentWillUnmount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">const</span> value <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>context<span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n\n  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">const</span> value <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>context<span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="getderivedstatefromerror"><a href="#getderivedstatefromerror" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>getDerivedStateFromError</h3>\n<p>static getDerivedStateFromError(error) 允许开发者在 render 完成之前渲染 Fallback UI，该生命周期函数触发的条件是子组件抛出错误，getDerivedStateFromError 接收到这个错误参数后更新 state。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="3850877957194720000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`class ErrorBoundary extends React.Component {\n  state = { hasError: false };\n\n  static getDerivedStateFromError(error) {\n    // Update state so the next render will show the fallback UI.\n    return { hasError: true };\n  }\n\n  componentDidCatch(error, info) {\n    // You can also log the error to an error reporting service\n    logErrorToMyService(error, info);\n  }\n\n  render() {\n    if (this.state.hasError) {\n      // You can render any custom fallback UI\n      return <h1>Something went wrong.</h1>;\n    }\n\n    return this.props.children;\n  }\n}`, `3850877957194720000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                js 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">class</span> <span class="token class-name">ErrorBoundary</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>\n  state <span class="token operator">=</span> <span class="token punctuation">{</span> hasError<span class="token punctuation">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n  <span class="token keyword">static</span> <span class="token function">getDerivedStateFromError</span><span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token comment">// Update state so the next render will show the fallback UI.</span>\n    <span class="token keyword">return</span> <span class="token punctuation">{</span> hasError<span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n\n  <span class="token function">componentDidCatch</span><span class="token punctuation">(</span><span class="token parameter">error<span class="token punctuation">,</span> info</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token comment">// You can also log the error to an error reporting service</span>\n    <span class="token function">logErrorToMyService</span><span class="token punctuation">(</span>error<span class="token punctuation">,</span> info<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n\n  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>hasError<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token comment">// You can render any custom fallback UI</span>\n      <span class="token keyword">return</span> <span class="token operator">&lt;</span>h1<span class="token operator">></span>Something went wrong<span class="token punctuation">.</span><span class="token operator">&lt;</span><span class="token operator">/</span>h1<span class="token operator">></span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n\n    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>children<span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id="react-v167（q1-2019）"><a href="#react-v167%EF%BC%88q1-2019%EF%BC%89" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>React v16.7（~Q1 2019）</h2>\n<h3 id="hooks"><a href="#hooks" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Hooks</h3>\n<p>Hooks 要解决的是状态逻辑复用问题，且不会产生 JSX 嵌套地狱，其特性如下：</p>\n<ul>\n<li>多个状态不会产生嵌套，依然是平铺写法；</li>\n<li>Hooks 可以引用其他 Hooks；</li>\n<li>更容易将组件的 UI 与状态分离；</li>\n</ul>\n<p>Hooks 并不是通过 Proxy 或者 getters 实现，而是通过数组实现，每次 useState 都会改变下标，如果 useState 被包裹在 condition 中，那每次执行的下标就可能对不上，导致 useState 导出的 setter 更新错数据。</p>\n<p>更多 Hooks 使用场景可以阅读下列文章：</p>\n<ul>\n<li><a href="https://zhuanlan.zhihu.com/p/50274018" target="_blank" rel="nofollow noreferrer noopener">精读《怎么用 React Hooks 造轮子》</a></li>\n</ul>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="66679754616581490000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`function App() {\n  const [open, setOpen] = useState(false);\n\n  return (\n    <>\n      <Button type=\'primary\' onClick={() => setOpen(true)}>\n        Open Modal\n      </Button>\n      <Modal visible={open} onOk={() => setOpen(false)} onCancel={() => setOpen(false)} />\n    </>\n  );\n}`, `66679754616581490000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                js 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">function</span> <span class="token function">App</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">const</span> <span class="token punctuation">[</span>open<span class="token punctuation">,</span> setOpen<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n  <span class="token keyword">return</span> <span class="token punctuation">(</span>\n    <span class="token operator">&lt;</span><span class="token operator">></span>\n      <span class="token operator">&lt;</span>Button type<span class="token operator">=</span><span class="token string">\'primary\'</span> onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">setOpen</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token operator">></span>\n        Open Modal\n      <span class="token operator">&lt;</span><span class="token operator">/</span>Button<span class="token operator">></span>\n      <span class="token operator">&lt;</span>Modal visible<span class="token operator">=</span><span class="token punctuation">{</span>open<span class="token punctuation">}</span> onOk<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">setOpen</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">}</span> onCancel<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">setOpen</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span>\n    <span class="token operator">&lt;</span><span class="token operator">/</span><span class="token operator">></span>\n  <span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id="react-v168（q2-2019）"><a href="#react-v168%EF%BC%88q2-2019%EF%BC%89" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>React v16.8（~Q2 2019）</h2>\n<h3 id="concurrent-rendering"><a href="#concurrent-rendering" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Concurrent Rendering</h3>\n<p>Concurrent Rendering 并发渲染模式是在不阻塞主线程的情况下渲染组件树，使 React 应用响应性更流畅，它允许 React 中断耗时的渲染，去处理高优先级的事件，如用户输入等，还能在高速连接时跳过不必要的加载状态，用以改善 Suspense 的用户体验。</p>\n<p>目前 Concurrent Rendering 尚未正式发布，也没有详细相关文档，需要等待 React 团队的正式发布。</p>\n<h2 id="react-v169（mid-2019）"><a href="#react-v169%EF%BC%88mid-2019%EF%BC%89" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>React v16.9（~mid 2019）</h2>\n<h3 id="suspense-for-data-fetching"><a href="#suspense-for-data-fetching" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Suspense for Data Fetching</h3>\n<p>Suspense 通过 ComponentDidCatch 实现用同步的方式编写异步数据的请求，并且没有使用 yield / async / await，其流程：调用 render 函数 -> 发现有异步请求 -> 暂停渲染，等待异步请求结果 -> 渲染展示数据。</p>\n<p>无论是什么异常，JavaScript 都能捕获，React 就是利用了这个语言特性，通过 ComponentDidCatch 捕获了所有生命周期函数、render 函数等，以及事件回调中的错误。如果有缓存则读取缓存数据，如果没有缓存，则会抛出一个异常 promise，利用异常做逻辑流控制是一种拥有较深的调用堆栈时的手段，它是在虚拟 DOM 渲染层做的暂停拦截，代码可在服务端复用。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="85454740757805480000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`import { fetchMovieDetails } from \'../api\';\nimport { createFetch } from \'../future\';\n\nconst movieDetailsFetch = createFetch(fetchMovieDetails);\n\nfunction MovieDetails(props) {\n  const movie = movieDetailsFetch.read(props.id);\n\n  return (\n    <div>\n      <MoviePoster src={movie.poster} />\n      <MovieMetrics {...movie} />\n    </div>\n  );\n}`, `85454740757805480000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                js 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">import</span> <span class="token punctuation">{</span> fetchMovieDetails <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">\'../api\'</span><span class="token punctuation">;</span>\n<span class="token keyword">import</span> <span class="token punctuation">{</span> createFetch <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">\'../future\'</span><span class="token punctuation">;</span>\n\n<span class="token keyword">const</span> movieDetailsFetch <span class="token operator">=</span> <span class="token function">createFetch</span><span class="token punctuation">(</span>fetchMovieDetails<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token keyword">function</span> <span class="token function">MovieDetails</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">const</span> movie <span class="token operator">=</span> movieDetailsFetch<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span>props<span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n  <span class="token keyword">return</span> <span class="token punctuation">(</span>\n    <span class="token operator">&lt;</span>div<span class="token operator">></span>\n      <span class="token operator">&lt;</span>MoviePoster src<span class="token operator">=</span><span class="token punctuation">{</span>movie<span class="token punctuation">.</span>poster<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span>\n      <span class="token operator">&lt;</span>MovieMetrics <span class="token punctuation">{</span><span class="token operator">...</span>movie<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span>\n    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>\n  <span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id="总结"><a href="#%E6%80%BB%E7%BB%93" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>总结</h2>\n<p>从 React16 的一系列更新和新特性中我们可以窥见，React 已经不仅仅只在做一个 View 的展示库，而是想要发展成为一个包含 View / 数据管理 / 数据获取 等场景的前端框架，以 React 团队的技术实力以及想法，笔者还是很期待和看好 React 的未来，不过它渐渐地已经对开发新手们不太友好了。</p>',
id:"/github/workspace/blog/React16新特性/index.md absPath of file >>> MarkdownRemark",timeToRead:11,frontmatter:{date:"2019-06-04 20:43:46",path:"/react-16-new-feature/",tags:"前端, React",title:"React16新特性",draft:null}},{excerpt:"引言 如今，Javascript 模块化规范非常方便、自然，但这个新规范仅执行了 2 年，就在 4 年前，js 的模块化还停留在运行时支持，10 年前，通过后端模版定义、注释定义模块依赖。对经历过来的人来说，历史的模块化方式还停留在脑海中，反而新上手的同学会更快接受现代的模块化规范。 但为什么要了解 Javascript 模块化发展的历史呢？因为凡事都有两面性，了解 Javascript 模块化规范，有利于我们思考出更好的模块化方案，纵观历史，从 199…",html:'<h1 id="引言"><a href="#%E5%BC%95%E8%A8%80" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>引言</h1>\n<blockquote>\n<p>如今，Javascript 模块化规范非常方便、自然，但这个新规范仅执行了 2 年，就在 4 年前，js 的模块化还停留在运行时支持，10 年前，通过后端模版定义、注释定义模块依赖。对经历过来的人来说，历史的模块化方式还停留在脑海中，反而新上手的同学会更快接受现代的模块化规范。</p>\n</blockquote>\n<p>但为什么要了解 Javascript 模块化发展的历史呢？因为凡事都有两面性，了解 Javascript 模块化规范，有利于我们思考出更好的模块化方案，纵观历史，从 1999 年开始，模块化方案最多维持两年，就出现了新的替代方案，比原有的模块化更清晰、强壮，我们不能被现代模块化方式限制住思维，因为现在的 ES2015 模块化方案距离发布也仅仅过了两年。</p>\n<h1 id="内容概要"><a href="#%E5%86%85%E5%AE%B9%E6%A6%82%E8%A6%81" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>内容概要</h1>\n<p><strong>直接定义依赖 (1999)</strong>: 由于当时 js 文件非常简单，模块化方式非常简单粗暴 —— 通过全局方法定义、引用模块。这种定义方式与现在的 commonjs 非常神似，区别是 commonjs 以文件作为模块，而这种方法可以在任何文件中定义模块，模块不与文件关联。</p>\n<p><strong>闭包模块化模式 (2003)</strong>: 用闭包方式解决了变量污染问题，闭包内返回模块对象，只需对外暴露一个全局变量。</p>\n<p><strong>模版依赖定义 (2006)</strong>: 这时候开始流行后端模版语法，通过后端语法聚合 js 文件，从而实现依赖加载，说实话，现在 go 语言等模版语法也很流行这种方式，写后端代码的时候不觉得，回头看看，还是挂在可维护性上。</p>\n<p><strong>注释依赖定义 (2006)</strong>: 几乎和模版依赖定义同时出现，与 1999 年方案不同的，不仅仅是模块定义方式，而是终于以文件为单位定义模块了，通过 <a href="https://github.com/bevacqua/lazyjs" target="_blank" rel="nofollow noreferrer noopener">lazyjs</a> 加载文件，同时读取文件注释，继续递归加载剩下的文件。</p>\n<p><strong>外部依赖定义 (2007)</strong>: 这种定义方式在 cocos2d-js 开发中普遍使用，其核心思想是将依赖抽出单独文件定义，这种方式不利于项目管理，毕竟依赖抽到代码之外，我是不是得两头找呢？所以才有通过 webpack 打包为一个文件的方式暴力替换为 commonjs 的方式出现。</p>\n<p><strong>Sandbox 模式 (2009)</strong>: 这种模块化方式很简单，暴力，将所有模块塞到一个 <code class="language-text">sanbox</code> 变量中，硬伤是无法解决冲突问题，毕竟都塞到一个 <code class="language-text">sandbox</code> 对象里，而 <code class="language-text">Sandbox</code> 对象也需要定义在全局，存在被覆盖的风险。模块化需要保证全局变量尽量干净，目前为止的模块化方案都没有很好的做到这一点。</p>\n<p><strong>依赖注入 (2009)</strong>: 就是大家熟知的 angular1.0，依赖注入的思想现在已广泛运用在 react、vue 等流行框架中。但依赖注入和解决模块化问题还差得远。</p>\n<p><strong>CommonJS (2009)</strong>: 真正解决模块化问题，从 node 端逐渐发力到前端，前端需要使用构建工具模拟。</p>\n<p><strong>Amd (2009)</strong>: 都是同一时期的产物，这个方案主要解决前端动态加载依赖，相比 commonJs，体积更小，按需加载。</p>\n<p><strong>Umd (2011)</strong>: 兼容了 CommonJS 与 Amd，其核心思想是，如果在 commonjs 环境（存在 <code class="language-text">module.exports</code>，不存在 <code class="language-text">define</code>），将函数执行结果交给 <code class="language-text">module.exports</code> 实现 Commonjs，否则用 Amd 环境的 <code class="language-text">define</code>，实现 Amd。</p>\n<p><strong>Labeled Modules (2012)</strong>: 和 CommonJS 很像了，没什么硬伤，但生不逢时，碰上 CommonJS 与 Amd，那只有被人遗忘的份了。</p>\n<p><strong>YModules (2013)</strong>: 既然都出了 CommonJS Amd，文章还列出了此方案，一定有其独到之处。其核心思想在于使用 <code class="language-text">provide</code> 取代 <code class="language-text">return</code>，可以控制模块结束时机，处理异步结果；拿到第二个参数 <code class="language-text">module</code>，修改其他模块的定义（虽然很有拓展性，但用在项目里是个搅屎棍）。</p>\n<p><strong>ES2015 Modules (2015)</strong>: 就是我们现在的模块化方案，还没有被浏览器实现，大部分项目已通过 <code class="language-text">babel</code> 或 <code class="language-text">typescript</code> 提前体验。</p>\n<h1 id="精读"><a href="#%E7%B2%BE%E8%AF%BB" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>精读</h1>\n<p>本次提出独到观点的同学有：<a href="https://github.com/arcthur" target="_blank" rel="nofollow noreferrer noopener">流形</a>，<a href="https://github.com/ascoders" target="_blank" rel="nofollow noreferrer noopener">黄子毅</a>，<a href="https://github.com/javie007" target="_blank" rel="nofollow noreferrer noopener">苏里约</a>，<a href="https://github.com/camsong" target="_blank" rel="nofollow noreferrer noopener">camsong</a>，<a href="https://github.com/jasonslyvia" target="_blank" rel="nofollow noreferrer noopener">杨森</a>，<a href="https://github.com/BlackGanglion" target="_blank" rel="nofollow noreferrer noopener">淡苍</a>，<a href="https://github.com/fanhc019" target="_blank" rel="nofollow noreferrer noopener">留影</a>，精读由此归纳。</p>\n<h3 id="从语言层面到文件层面的模块化"><a href="#%E4%BB%8E%E8%AF%AD%E8%A8%80%E5%B1%82%E9%9D%A2%E5%88%B0%E6%96%87%E4%BB%B6%E5%B1%82%E9%9D%A2%E7%9A%84%E6%A8%A1%E5%9D%97%E5%8C%96" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>从语言层面到文件层面的模块化</h3>\n<blockquote>\n<p>从 1999 年开始，模块化探索都是基于语言层面的优化，真正的革命从 2009 年 CommonJS 的引入开始，前端开始大量使用预编译。</p>\n</blockquote>\n<p>这篇文章所提供的模块化历史的方案都是逻辑模块化，<strong>从 CommonJS 方案开始前端把服务端的解决方案搬过来之后，算是看到标准物理与逻辑统一的模块化</strong>。但之后前端工程不得不引入模块化构建这一步。正是这一步给前端开发无疑带来了诸多的不便，尤其是现在我们开发过程中经常为了优化这个工具带了很多额外的成本。</p>\n<p>从 CommonJS 之前其实都只是封装，并没有一套模块化规范，这个就有些像类与包的概念。我在 10 年左右用的最多的还是 YUI2，YUI2 是用 namespace 来做模块化的，但有很多问题没有解决，比如多版本共存，因此后来 YUI3 出来了。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="67435522713687690000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`YUI().use(\'node\', \'event\', function(Y) {\n  // The Node and Event modules are loaded and ready to use.\n  // Your code goes here!\n});`, `67435522713687690000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                javascript 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="javascript"><pre style="counter-reset: linenumber NaN" class="language-javascript line-numbers"><code class="language-javascript"><span class="token constant">YUI</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token string">\'node\'</span><span class="token punctuation">,</span> <span class="token string">\'event\'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter"><span class="token constant">Y</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token comment">// The Node and Event modules are loaded and ready to use.</span>\n  <span class="token comment">// Your code goes here!</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>YUI3 的 sandbox 像极了差不多同时出现的 AMD 规范，但早期 yahoo 在前端圈的影响力还是很大的，而 requirejs 到 2011 年才诞生，因此圈子不是用着 YUI 要不就自己封装一套 sandbox，内部使用 jQuery。</p>\n<p>为什么模块化方案这么晚才成型，可能早期应用的复杂度都在后端，前端都是非常简单逻辑。后来 Ajax 火了之后，web app 概念的开始流行，前端的复杂度也呈指数级上涨，到今天几乎和后端接近一个量级。<strong>工程发展到一定阶段，要出现的必然会出现。</strong></p>\n<h3 id="前端三剑客的模块化展望"><a href="#%E5%89%8D%E7%AB%AF%E4%B8%89%E5%89%91%E5%AE%A2%E7%9A%84%E6%A8%A1%E5%9D%97%E5%8C%96%E5%B1%95%E6%9C%9B" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>前端三剑客的模块化展望</h3>\n<blockquote>\n<p>从 js 模块化发展史，我们还看到了 css html 模块化方面的严重落后，如今依赖编译工具的模块化增强在未来会被标准所替代。</p>\n</blockquote>\n<p>原生支持的模块化，<strong>解决 html 与 css 模块化问题正是以后的方向。</strong></p>\n<p>再回到 JS 模块化这个主题，开头也说到是为了构建 scope，实则提供了业务规范标准的输入输出的方式。但文章中的 JS 的模块化还不等于前端工程的模块化，Web 界面是由 HTML、CSS 和 JS 三种语言实现，不论是 CommonJS 还是 AMD 包括之后的方案都无法解决 CSS 与 HTML 模块化的问题。</p>\n<p>对于 CSS 本身它就是 global scope，因此开发样式可以说是喜忧参半。近几年也涌现把 HTML、CSS 和 JS 合并作模块化的方案，其中 react/css-modules 和 vue 都为人熟知。当然，这一点还是非常依赖于 webpack/rollup 等构建工具，让我们意识到在 browser 端还有很多本质的问题需要推进。</p>\n<p>对于 css 模块化，目前不依赖预编译的方式是 <code class="language-text">styled-component</code>，通过 js 动态创建 class。而目前 css 也引入了<a href="https://developer.mozilla.org/zh-CN/docs/Web/CSS/Using_CSS_variables" target="_blank" rel="nofollow noreferrer noopener">与 js 通信的机制 与 原生变量支持</a>。未来 css 模块化也很可能是运行时的，所以目前比较看好 <code class="language-text">styled-component</code> 的方向。</p>\n<p>对于 html 模块化，小尤最近爆出与 chrome 小组调研 html Modules，如果 html 得到了浏览器，编辑器的模块化支持，未来可能会取代 jsx 成为最强大的模块化、模板语言。</p>\n<p>对于 js 模块化，最近出现的 <code class="language-text">&lt;script type=&quot;module&quot;&gt;</code> 方式，虽然还没有得到浏览器原生支持，但也是我比较看好的未来趋势，这样就连 webpack 的拆包都不需要了，直接把源代码传到服务器，配合 http2.0 完美抛开预编译的枷锁。</p>\n<p>上述三种方案都不依赖预编译，分别实现了 html、css、js 模块化，相信这就是未来。</p>\n<h3 id="模块化标准推进速度仍然缓慢"><a href="#%E6%A8%A1%E5%9D%97%E5%8C%96%E6%A0%87%E5%87%86%E6%8E%A8%E8%BF%9B%E9%80%9F%E5%BA%A6%E4%BB%8D%E7%84%B6%E7%BC%93%E6%85%A2" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>模块化标准推进速度仍然缓慢</h3>\n<blockquote>\n<p>2015 年提出的标准，在 17 年依然没有得到实现，即便在 nodejs 端。</p>\n</blockquote>\n<p>这几年 TC39 对语言终于重视起来了，慢慢有动作了，但针对模块标准制定的速度，与落实都非常缓慢，与 javascript 越来越流行的趋势逐渐脱节。nodejs 至今也没有实现 ES2015 模块化规范，所有 jser 都处在构建工具的阴影下。</p>\n<h3 id="http-20-对-js-模块化的推动"><a href="#http-20-%E5%AF%B9-js-%E6%A8%A1%E5%9D%97%E5%8C%96%E7%9A%84%E6%8E%A8%E5%8A%A8" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Http 2.0 对 js 模块化的推动</h3>\n<blockquote>\n<p>js 模块化定义的再美好，浏览器端的支持粒度永远是瓶颈，http 2.0 正是考虑到了这个因素，大力支持了 ES 2015 模块化规范。</p>\n</blockquote>\n<p>幸运的是，模块化构建将来可能不再需要。随着 HTTP/2 流行起来，请求和响应可以并行，一次连接允许多个请求，对于前端来说宣告不再需要在开发和上线时再做编译这个动作。</p>\n<p>几年前，模块化几乎是每个流行库必造的轮子（YUI、Dojo、Angular），大牛们自己爽的同时其实造成了社区的分裂，很难积累。有了 ES2015 Modules 之后，JS 开发者终于可以像 Java 开发者十年前一样使用一致的方式愉快的互相引用模块。</p>\n<p>不过 ES2015 Modules 也只是解决了开发的问题，由于浏览器的特殊性，还是要经过繁琐打包的过程，等 Import，Export 和 HTTP 2.0 被主流浏览器支持，那时候才是彻底的模块化。</p>\n<h3 id="http-20-后就不需要构建工具了吗？"><a href="#http-20-%E5%90%8E%E5%B0%B1%E4%B8%8D%E9%9C%80%E8%A6%81%E6%9E%84%E5%BB%BA%E5%B7%A5%E5%85%B7%E4%BA%86%E5%90%97%EF%BC%9F" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Http 2.0 后就不需要构建工具了吗？</h3>\n<blockquote>\n<p>看到大家基本都提到了 HTTP/2，对这项技术解决前端模块化及资源打包等工程问题抱有非常大的期待。很多人也认为 HTTP/2 普及后，基本就没有 Webpack 什么事情了。</p>\n</blockquote>\n<p>不过 Webpack 作者 @sokra 在他的文章 <a href="https://medium.com/webpack/webpack-http-2-7083ec3f3ce6#.zdo4juvgo" target="_blank" rel="nofollow noreferrer noopener">webpack &#x26; HTTP/2</a> 里提到了一个新的 Webpack 插件 <code class="language-text">AggressiveSplittingPlugin</code>。简单的说，这款插件就是为了充分利用 HTTP/2 的文件缓存能力，将你的业务代码自动拆分成若干个数十 KB 的小文件。后续若其中任意一个文件发生变化，可以保证其他的小 chunck 不需要重新下载。</p>\n<p>可见，<strong>即使不断的有新技术出现，也依然需要配套的工具来将前端工程问题解决方案推向极致。</strong></p>\n<h3 id="模块化是大型项目的银弹吗？"><a href="#%E6%A8%A1%E5%9D%97%E5%8C%96%E6%98%AF%E5%A4%A7%E5%9E%8B%E9%A1%B9%E7%9B%AE%E7%9A%84%E9%93%B6%E5%BC%B9%E5%90%97%EF%BC%9F" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>模块化是大型项目的银弹吗？</h3>\n<blockquote>\n<p>只要遵循了最新模块化规范，就可以使项目具有最好的可维护性吗？ Js 模块化的目的是支持前端日益上升的复杂度，但绝不是唯一的解决方案。</p>\n</blockquote>\n<p>分析下 JavaScript 为什么没有模块化，为什么又需要模块化：这个 95 年被设计出来的时候，语言的开发者根本没有想到它会如此的大放异彩，也没有将它设计成一种模块化语言。按照文中的说法，99 年也就是 4 年后开始出现了模块化的需求。如果只有几行代码用模块化是扯，初始的 web 开发业务逻辑都写在 server 端，js 的作用小之又小。而现在 spa 都出现了，几乎所有的渲染逻辑都在前端，如果还是没有模块化的组织，开发过程会越来越难，维护也是更痛苦。</p>\n<p>文中已经详细说明了模块化的发展和优劣，这里不准备做过多的讨论。我想说的是，<strong>在模块化之后还有一个模块间耦合的问题，如果模块间耦合度大也会降低代码的可重用性或者说复用性</strong>。所以也出现了降低耦合的观察者模式或者发布/订阅模式。这对于提升代码重用，复用性和避免单点故障等都很重要。说到这里，还想顺便提一下最近流行起来的响应式编程（RxJS），响应式编程中有一个很核心的概念就是 observable，也就是 Rx 中的流（stream）。它可以被 subscribe，其实也就是观察者设计模式。</p>\n<h3 id="补充阅读"><a href="#%E8%A1%A5%E5%85%85%E9%98%85%E8%AF%BB" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>补充阅读</h3>\n<ul>\n<li><a href="https://huangxuan.me/2015/07/09/js-module-7day/" target="_blank" rel="nofollow noreferrer noopener">JavaScript 模块化七日谈</a></li>\n<li><a href="https://yuguo.us/weblog/javascript-module-development-history/" target="_blank" rel="nofollow noreferrer noopener">JavaScript 模块化编程简史（2009-2016）</a></li>\n</ul>\n<h1 id="总结"><a href="#%E6%80%BB%E7%BB%93" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>总结</h1>\n<p>未来前端复杂度不断增加已成定论，随着后端成熟，自然会将焦点转移到前端领域，而且服务化、用户体验越来越重要，前端体验早不是当初能看就行，任何网页的异常、视觉的差异，或文案的模糊，都会导致用户流失，支付中断。前端对公司营收的影响，渐渐与后端服务宕机同等严重，所以前端会越来越重，异常监控，性能检测，工具链，可视化等等都是这几年大家逐渐重视起来的。</p>\n<p>我们早已不能将 javascript 早期玩具性质的模块化方案用于现代越来越重要的系统中，前端界必然出现同等重量级的模块化管理方案，感谢 TC39 制定的 ES2015 模块化规范，我们已经离不开它，哪怕所有人必须使用 babel。</p>\n<p>话说回来，标准推进的太慢，我们还是把编译工具当作常态，抱着哪怕支持了 ES2015 所有特性，babel 依然还有用的心态，将预编译进行到底。一句话，模块化仍在路上。js 模块化的矛头已经对准了 css 与 html，这两位元老也该向前卫的 js 学习学习了。</p>\n<p>未来 css、html 的模块化会自立门户，还是赋予 js 更强的能力，让两者的模块化依附于 js 的能力呢？目前 html 有自立门户的苗头（htmlModules），而 css 迟迟没有改变，社区出现的 <code class="language-text">styled-component</code> 已经用 js 将 css 模块化得很好了，最新 css 规范也支持了与 js 的变量通信，难道希望依附于 js 吗？这里希望得到大家更广泛的讨论。</p>\n<p>我也认同，毕竟压缩、混淆、md5、或者利用 <a href="https://www.thepolyglotdeveloper.com/2015/03/create-a-random-nonce-string-using-javascript/" target="_blank" rel="nofollow noreferrer noopener">nonce</a> 属性对 script 标签加密，都离不开本地构建工具。</p>\n<p>据说 http2 的优化中，有个最佳文件大小与数量的比例，那么还是脱离不了构建工具，前端未来会越来越复杂，同时也越来越美好。</p>\n<p>至此，对于 javascript 模块化讨论已接近尾声，对其优缺点也基本达成了一致。前端复杂度不断提高，促使着模块化的改进，代理（浏览器、node） 的支持程度，与前端特殊性（流量、缓存）可能前端永远也离不开构建工具，新的标准会让这些工作做的更好，同时取代、增强部分特征，前端的未来是更加美好的，复杂度也更高。</p>',id:"/github/workspace/blog/前端js模块化发展/index.md absPath of file >>> MarkdownRemark",timeToRead:5,frontmatter:{date:"2019-06-04 12:03:01",path:"/frontend-module-development/",tags:"前端, 前端模块化",title:"前端js模块化发展",draft:null}},{excerpt:"需求背景 最近要做一个将第三方聊天库打包为链接，以便于顾客端使用，类似于这个样子  , 以实现将代码嵌入到顾客端网站的 标签之前即可完成部署，开发过程中遇到诸多难点 需求难点 打包工具选型 最容易想到的办法就是沿用公司之前的 webpack 框架，这里升级到了 webpack4（见之前的文章  Webpack 配置笔记 ），考虑到打包后可能会包含一些 webpack 的多余代码，因此不是最优方案。但迫于技术的不成熟以及开发时间的压力，还是把 webpack…",html:'<h1 id="需求背景"><a href="#%E9%9C%80%E6%B1%82%E8%83%8C%E6%99%AF" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>需求背景</h1>\n<p>最近要做一个将第三方聊天库打包为链接，以便于顾客端使用，类似于这个样子 <code class="language-text">&lt;script src=&quot;打包后库的地址?deployId=部署ID&quot; name=&quot;唯一标识符&quot;&gt;&lt;/script&gt;</code>, 以实现将代码嵌入到顾客端网站的<code class="language-text">&lt;/body&gt;</code>标签之前即可完成部署，开发过程中遇到诸多难点</p>\n<h1 id="需求难点"><a href="#%E9%9C%80%E6%B1%82%E9%9A%BE%E7%82%B9" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>需求难点</h1>\n<h2 id="打包工具选型"><a href="#%E6%89%93%E5%8C%85%E5%B7%A5%E5%85%B7%E9%80%89%E5%9E%8B" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>打包工具选型</h2>\n<p>最容易想到的办法就是沿用公司之前的 webpack 框架，这里升级到了 webpack4（见之前的文章 <a href="/webpack-config-note/">Webpack 配置笔记</a>），考虑到打包后可能会包含一些 webpack 的多余代码，因此不是最优方案。但迫于技术的不成熟以及开发时间的压力，还是把 webpack 作为此次选型。这里需要后期优化，考虑到的方案有 rollup.js、jQuery、VanillaJS（原生 js）</p>\n<h2 id="打包工具重构"><a href="#%E6%89%93%E5%8C%85%E5%B7%A5%E5%85%B7%E9%87%8D%E6%9E%84" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>打包工具重构</h2>\n<p>这里需要将所有代码打包成一个类似于一个 js 文件，所以这里需要对框架做出调整，以下只列出改动的地方，其中标红的部分是最核心的改动</p>\n<h3 id="webpackbasebabeljs"><a href="#webpackbasebabeljs" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>webpack.base.babel.js</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="8820870777032530000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// const CopyWebpackPlugin = require(\'copy-webpack-plugin\'); 去掉copy-webpack-plugin\n\n{\n  test: /\\.(jpe?g|png|gif|svg)\\$/,\n  use: [\n    {\n      loader: \'url-loader\',\n      options: {\n        // Inline files smaller than 10 kB，尽可能将所有的图片内联到js\n        limit: 100 * 1024,\n      },\n    },\n  ],\n},\n\nnew webpack.optimize.MinChunkSizePlugin({\n  minChunkSize: Infinity, // Minimum number of characters，尽可能的打包js为一个文件\n}),\n\n// 屏蔽CopyWebpackPlugin，没用\n// new CopyWebpackPlugin([\n//   \'app/favicon.ico\',\n//   \'app/manifest.json\',\n// ].map((src) => ({ from: src, to: path.resolve(process.cwd(), \'build\') }))),`, `8820870777032530000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                js{16-18} 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight has-highlighted-lines" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// const CopyWebpackPlugin = require(\'copy-webpack-plugin\'); 去掉copy-webpack-plugin</span>\n\n<span class="token punctuation">{</span>\n  test<span class="token punctuation">:</span> <span class="token regex">/\\.(jpe?g|png|gif|svg)$/</span><span class="token punctuation">,</span>\n  use<span class="token punctuation">:</span> <span class="token punctuation">[</span>\n    <span class="token punctuation">{</span>\n      loader<span class="token punctuation">:</span> <span class="token string">\'url-loader\'</span><span class="token punctuation">,</span>\n      options<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n        <span class="token comment">// Inline files smaller than 10 kB，尽可能将所有的图片内联到js</span>\n        limit<span class="token punctuation">:</span> <span class="token number">100</span> <span class="token operator">*</span> <span class="token number">1024</span><span class="token punctuation">,</span>\n      <span class="token punctuation">}</span><span class="token punctuation">,</span>\n    <span class="token punctuation">}</span><span class="token punctuation">,</span>\n  <span class="token punctuation">]</span><span class="token punctuation">,</span>\n<span class="token punctuation">}</span><span class="token punctuation">,</span>\n\n<span class="gatsby-highlight-code-line"><span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>optimize<span class="token punctuation">.</span>MinChunkSizePlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span><span class="gatsby-highlight-code-line">  minChunkSize<span class="token punctuation">:</span> <span class="token number">Infinity</span><span class="token punctuation">,</span> <span class="token comment">// Minimum number of characters，尽可能的打包js为一个文件</span></span><span class="gatsby-highlight-code-line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>\n<span class="token comment">// 屏蔽CopyWebpackPlugin，没用</span>\n<span class="token comment">// new CopyWebpackPlugin([</span>\n<span class="token comment">//   \'app/favicon.ico\',</span>\n<span class="token comment">//   \'app/manifest.json\',</span>\n<span class="token comment">// ].map((src) => ({ from: src, to: path.resolve(process.cwd(), \'build\') }))),</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="webpackprodbabeljs"><a href="#webpackprodbabeljs" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>webpack.prod.babel.js</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="81531180892513480000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// const LodashModuleReplacementPlugin = require(\'lodash-webpack-plugin\'); 实测对打包成一个js时有影响，暂未找到原因\n\ncssDebug: true, // 打开cssDebug，以避免使用MiniCssExtractPlugin，会产生多余的css\nentry: \'./app/app.js\', // 改变入口，不分包\noutput: {\n  filename: \'bundle.js\', // 只输出一个 bundle.js 文件\n},\n\nsplitChunks: false,  // 关闭分包优化，下面同理\nruntimeChunk: false,\n\n// new LodashModuleReplacementPlugin(), // lodash优化，暂时屏蔽，理由同上\n// new webpack.HashedModuleIdsPlugin(), // 不需要固定chunkhash，因为只有一个文件`, `81531180892513480000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                js 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// const LodashModuleReplacementPlugin = require(\'lodash-webpack-plugin\'); 实测对打包成一个js时有影响，暂未找到原因</span>\n\ncssDebug<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 打开cssDebug，以避免使用MiniCssExtractPlugin，会产生多余的css</span>\nentry<span class="token punctuation">:</span> <span class="token string">\'./app/app.js\'</span><span class="token punctuation">,</span> <span class="token comment">// 改变入口，不分包</span>\noutput<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n  filename<span class="token punctuation">:</span> <span class="token string">\'bundle.js\'</span><span class="token punctuation">,</span> <span class="token comment">// 只输出一个 bundle.js 文件</span>\n<span class="token punctuation">}</span><span class="token punctuation">,</span>\n\nsplitChunks<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>  <span class="token comment">// 关闭分包优化，下面同理</span>\nruntimeChunk<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>\n\n<span class="token comment">// new LodashModuleReplacementPlugin(), // lodash优化，暂时屏蔽，理由同上</span>\n<span class="token comment">// new webpack.HashedModuleIdsPlugin(), // 不需要固定chunkhash，因为只有一个文件</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>以上就实现了将所有代码都打包到一个 bundle.js 文件</p>\n<h2 id="bundlejs-插入渲染结点"><a href="#bundlejs-%E6%8F%92%E5%85%A5%E6%B8%B2%E6%9F%93%E7%BB%93%E7%82%B9" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>bundle.js 插入渲染结点</h2>\n<p>原来的方式是在 index.html 中写要渲染的 div 标签，由于引入到顾客端时是不可能在别人的 html 中写入 div 标签，所以解决方案如下</p>\n<p>主要是对 app.js 入口文件做出改动，在渲染 app.js 时通过主动创建一个 div 结点加入到 body 标签的最后</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="91259632642457490000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`const render = () => {\n  const root = document.createElement(\'div\');\n  document.querySelector(\'body\').appendChild(root);\n  ReactDOM.render(<App />, root);\n};\n\nrender();`, `91259632642457490000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                js 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">const</span> <span class="token function-variable function">render</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n  <span class="token keyword">const</span> root <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">\'div\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">\'body\'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  ReactDOM<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token operator">&lt;</span>App <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">,</span> root<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n<span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id="bundlejs-二次引入-babel-polyfill"><a href="#bundlejs-%E4%BA%8C%E6%AC%A1%E5%BC%95%E5%85%A5-babel-polyfill" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>bundle.js 二次引入 babel-polyfill</h2>\n<p>在顾客端同样引用 babel-polyfill 的情况下，会造成 bundle.js 的报错，此时需要判断</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="35196033103087920000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`if (!global._babelPolyfill) {\n  // 防止二次引入\n  require(\'babel-polyfill\');\n}`, `35196033103087920000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                js 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>global<span class="token punctuation">.</span>_babelPolyfill<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token comment">// 防止二次引入</span>\n  <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'babel-polyfill\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id="bundlejs-报错会引起顾客端整个崩溃"><a href="#bundlejs-%E6%8A%A5%E9%94%99%E4%BC%9A%E5%BC%95%E8%B5%B7%E9%A1%BE%E5%AE%A2%E7%AB%AF%E6%95%B4%E4%B8%AA%E5%B4%A9%E6%BA%83" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>bundle.js 报错会引起顾客端整个崩溃</h2>\n<p>需要引入 ErrorBoundary 组件，即使报错也只有引入的 bundle.js 聊天窗口崩溃</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="90503519603358070000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`import React from \'react\';\nimport PropTypes from \'prop-types\';\n\nclass ErrorBoundary extends React.Component {\n  static propTypes = {\n    children: PropTypes.node\n  };\n\n  constructor(props) {\n    super(props);\n    this.state = { error: null, errorInfo: null };\n  }\n\n  componentDidCatch(error, errorInfo) {\n    console.log(error, errorInfo);\n    // Display fallback UI\n    this.setState({ error, errorInfo });\n    // You can also log the error to an error reporting service\n  }\n\n  render() {\n    // if (this.state.hasError) {\n    //   // You can render any custom fallback UI\n    //   return <h1>Something went wrong.</h1>;\n    // }\n    return this.props.children;\n  }\n}\n\nexport default ErrorBoundary;`, `90503519603358070000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                js 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">\'react\'</span><span class="token punctuation">;</span>\n<span class="token keyword">import</span> PropTypes <span class="token keyword">from</span> <span class="token string">\'prop-types\'</span><span class="token punctuation">;</span>\n\n<span class="token keyword">class</span> <span class="token class-name">ErrorBoundary</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>\n  <span class="token keyword">static</span> propTypes <span class="token operator">=</span> <span class="token punctuation">{</span>\n    children<span class="token punctuation">:</span> PropTypes<span class="token punctuation">.</span>node\n  <span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">super</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token punctuation">{</span> error<span class="token punctuation">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span> errorInfo<span class="token punctuation">:</span> <span class="token keyword">null</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n\n  <span class="token function">componentDidCatch</span><span class="token punctuation">(</span><span class="token parameter">error<span class="token punctuation">,</span> errorInfo</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>error<span class="token punctuation">,</span> errorInfo<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token comment">// Display fallback UI</span>\n    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span> error<span class="token punctuation">,</span> errorInfo <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token comment">// You can also log the error to an error reporting service</span>\n  <span class="token punctuation">}</span>\n\n  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token comment">// if (this.state.hasError) {</span>\n    <span class="token comment">//   // You can render any custom fallback UI</span>\n    <span class="token comment">//   return &lt;h1>Something went wrong.&lt;/h1>;</span>\n    <span class="token comment">// }</span>\n    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>children<span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">export</span> <span class="token keyword">default</span> ErrorBoundary<span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>然后在预测可能要报错的结点前包裹 ErrorBoundary</p>\n<h2 id="修改主题色"><a href="#%E4%BF%AE%E6%94%B9%E4%B8%BB%E9%A2%98%E8%89%B2" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>修改主题色</h2>\n<p>由于需要实现读取后端给出的样式变量，所以需要实现在 css 样式中读取到 js 变量，找了很多资料，发现最理想的还是 styled-components 可以在内联的 css 中读取到变量</p>\n<p>但是由于 bundle.js 的大小已经达到了 1.6M 左右，再引入 styled-components 只怕会更大，所以暂时只能通过 style 样式在代码里写，当然，这个是不能实现比如说在 hover 状态下改变 css 样式，对于这个问题，暂未想到比较好的解决方案</p>\n<h2 id="nginx-相关设置"><a href="#nginx-%E7%9B%B8%E5%85%B3%E8%AE%BE%E7%BD%AE" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>nginx 相关设置</h2>\n<h3 id="跨域设置-cookie"><a href="#%E8%B7%A8%E5%9F%9F%E8%AE%BE%E7%BD%AE-cookie" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>跨域设置 cookie</h3>\n<p>由于顾客端是未知域名，所以涉及到跨域设置 cookie 的问题，需要前后端同时设置才能做到跨域设置 cookie</p>\n<h3 id="背景知识"><a href="#%E8%83%8C%E6%99%AF%E7%9F%A5%E8%AF%86" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>背景知识</h3>\n<p>CORS 把 HTTP 请求分成两类，不同类别按不同的策略进行跨域资源共享协商。</p>\n<ol>\n<li>简单跨域请求</li>\n</ol>\n<p>当 HTTP 请求出现以下两种情况时，浏览器认为是简单跨域请求：</p>\n<ol>\n<li>请求方法是 GET、HEAD 或者 POST，并且当请求方法是 POST 时，Content-Type 必须是 application/x-www-form-urlencoded, multipart/form-data 或着 text/plain 中的一个值。</li>\n<li>请求中没有自定义 HTTP 头部。</li>\n</ol>\n<p>对于简单跨域请求，浏览器要做的就是在 HTTP 请求中添加 Origin Header，将 JavaScript 脚本所在域填充进去，向其他域的服务器请求资源。服务器端收到一个简单跨域请求后，根据资源权限配置，在响应头中添加 Access-Control-Allow-Origin Header。浏览器收到响应后，查看 Access-Control-Allow-Origin Header，如果当前域已经得到授权，则将结果返回给 JavaScript，否则浏览器忽略此次响应。</p>\n<ol start="2">\n<li>带预检 (Preflighted) 的跨域请求</li>\n</ol>\n<p>当 HTTP 请求出现以下两种情况时，浏览器认为是带预检 (Preflighted) 的跨域请求：</p>\n<ol>\n<li>除 GET、HEAD 和 POST(only with application/x-www-form-urlencoded, multipart/form-data, text/plain Content-Type) 以外的其他 HTTP 方法。</li>\n<li>请求中出现自定义 HTTP 头部。</li>\n</ol>\n<p>带预检 (Preflighted) 的跨域请求需要浏览器在发送真实 HTTP 请求之前先发送一个 OPTIONS 的预检请求，检测服务器端是否支持真实请求进行跨域资源访问，真实请求的信息在 OPTIONS 请求中通过 Access-Control-Request-Method Header 和 Access-Control-Request-Headers Header 描述，此外与简单跨域请求一样，浏览器也会添加 Origin Header。服务器端接到预检请求后，根据资源权限配置，在响应头中放入 Access-Control-Allow-Origin Header、Access-Control-Allow-Methods 和 Access-Control-Allow-Headers Header，分别表示允许跨域资源请求的域、请求方法和请求头。此外，服务器端还可以加入 Access-Control-Max-Age Header，允许浏览器在指定时间内，无需再发送预检请求进行协商，直接用本次协商结果即可。浏览器根据 OPTIONS 请求返回的结果来决定是否继续发送真实的请求进行跨域资源访问，这个过程对真实请求的调用者来说是透明的。</p>\n<p>XMLHttpRequest 支持通过 withCredentials 属性实现在跨域请求携带身份信息 (Credential，例如 Cookie 或者 HTTP 认证信息)。浏览器将携带 Cookie Header 的请求发送到服务器端后，如果服务器没有响应 Access-Control-Allow-Credentials Header，那么浏览器会忽略掉这次响应。</p>\n<p>这里讨论的 HTTP 请求是指由 Ajax XMLHttpRequest 对象发起的，所有的 CORS HTTP 请求头都可由浏览器填充，无需在 XMLHttpRequest 对象中设置。以下是 CORS 协议规定的 HTTP 头，用来进行浏览器发起跨域资源请求时进行协商：</p>\n<ol>\n<li>Origin。HTTP 请求头，任何涉及 CORS 的请求都必需携带。</li>\n<li>Access-Control-Request-Method。HTTP 请求头，在带预检 (Preflighted) 的跨域请求中用来表示真实请求的方法。</li>\n<li>Access-Control-Request-Headers。HTTP 请求头，在带预检 (Preflighted) 的跨域请求中用来表示真实请求的自定义 Header 列表。</li>\n<li>Access-Control-Allow-Origin。HTTP 响应头，指定服务器端允许进行跨域资源访问的来源域。可以用通配符 * 表示允许任何域的 JavaScript 访问资源，但是在响应一个携带身份信息 (Credential) 的 HTTP 请求时，Access-Control-Allow-Origin 必需指定具体的域，不能用通配符。</li>\n<li>Access-Control-Allow-Methods。HTTP 响应头，指定服务器允许进行跨域资源访问的请求方法列表，一般用在响应预检请求上。</li>\n<li>Access-Control-Allow-Headers。HTTP 响应头，指定服务器允许进行跨域资源访问的请求头列表，一般用在响应预检请求上。</li>\n<li>Access-Control-Max-Age。HTTP 响应头，用在响应预检请求上，表示本次预检响应的有效时间。在此时间内，浏览器都可以根据此次协商结果决定是否有必要直接发送真实请求，而无需再次发送预检请求。</li>\n<li>Access-Control-Allow-Credentials。HTTP 响应头，凡是浏览器请求中携带了身份信息，而响应头中没有返回 Access-Control-Allow-Credentials:true 的，浏览器都会忽略此次响应。</li>\n</ol>\n<h4 id="后端"><a href="#%E5%90%8E%E7%AB%AF" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>后端</h4>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="47696971094489270000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`# 设置到某个文件下的别名，可以通过 /im 访问到调试端\nlocation ^~ /im {\n  alias /home/frontend/pony/;\n}\n# 设置到某个文件下的别名，可以通过 /bundle.js 直接访问到 bundle.js\nlocation = /bundle.js {\n  alias /home/frontend/pony/bundle.js;\n}\n# 反代设置跨域并允许设置 cookie\nlocation /service-tp-api/ {\n  add_header Access-Control-Allow-Credentials true;  # 是否允许发送Cookie\n  add_header Access-Control-Allow-Origin \\$http_origin; # 这里 \\$http_origin 代表引用 bundle.js 的网站域名（真实域名），不能设置为 * ，否则不能成功设置 cookie\n  add_header Access-Control-Allow-Methods \'GET, POST, OPTIONS\'; # 用到哪些 HTTP 方法\n  add_header Access-Control-Allow-Headers \'DNT,X-Mx-ReqToken,Keep-Alive,User-Agent,X-Requested-With,If-Modified-Since,Cache-Control,Content-Type,Authorization,Cookie,Set-Cookie,x-requested-with,content-type,pragma\'; # 允许使用的 header 字段，可以查看自己的 request 来进行添加\n\n  if (\\$request_method = \'OPTIONS\') {\n    # 跨域预检\n    return 204;\n  }\n\n  # 以下是反代到哪里\n  proxy_pass http://localhost:10602/api/im-service/;\n  proxy_redirect off;\n  proxy_set_header Host \\$host;\n  proxy_set_header X-Real-IP \\$remote_addr;\n  proxy_set_header X-Forward-For \\$proxy_add_x_forwarded_for;\n}`, `47696971094489270000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                bash 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash"><span class="token comment"># 设置到某个文件下的别名，可以通过 /im 访问到调试端</span>\nlocation ^~ /im <span class="token punctuation">{</span>\n  <span class="token builtin class-name">alias</span> /home/frontend/pony/<span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n<span class="token comment"># 设置到某个文件下的别名，可以通过 /bundle.js 直接访问到 bundle.js</span>\nlocation <span class="token operator">=</span> /bundle.js <span class="token punctuation">{</span>\n  <span class="token builtin class-name">alias</span> /home/frontend/pony/bundle.js<span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n<span class="token comment"># 反代设置跨域并允许设置 cookie</span>\nlocation /service-tp-api/ <span class="token punctuation">{</span>\n  add_header Access-Control-Allow-Credentials <span class="token boolean">true</span><span class="token punctuation">;</span>  <span class="token comment"># 是否允许发送Cookie</span>\n  add_header Access-Control-Allow-Origin <span class="token variable">$http_origin</span><span class="token punctuation">;</span> <span class="token comment"># 这里 $http_origin 代表引用 bundle.js 的网站域名（真实域名），不能设置为 * ，否则不能成功设置 cookie</span>\n  add_header Access-Control-Allow-Methods <span class="token string">\'GET, POST, OPTIONS\'</span><span class="token punctuation">;</span> <span class="token comment"># 用到哪些 HTTP 方法</span>\n  add_header Access-Control-Allow-Headers <span class="token string">\'DNT,X-Mx-ReqToken,Keep-Alive,User-Agent,X-Requested-With,If-Modified-Since,Cache-Control,Content-Type,Authorization,Cookie,Set-Cookie,x-requested-with,content-type,pragma\'</span><span class="token punctuation">;</span> <span class="token comment"># 允许使用的 header 字段，可以查看自己的 request 来进行添加</span>\n\n  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$request_method</span> <span class="token operator">=</span> <span class="token string">\'OPTIONS\'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token comment"># 跨域预检</span>\n    <span class="token builtin class-name">return</span> <span class="token number">204</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n\n  <span class="token comment"># 以下是反代到哪里</span>\n  proxy_pass http://localhost:10602/api/im-service/<span class="token punctuation">;</span>\n  proxy_redirect off<span class="token punctuation">;</span>\n  proxy_set_header Host <span class="token variable">$host</span><span class="token punctuation">;</span>\n  proxy_set_header X-Real-IP <span class="token variable">$remote_addr</span><span class="token punctuation">;</span>\n  proxy_set_header X-Forward-For <span class="token variable">$proxy_add_x_forwarded_for</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h4 id="前端"><a href="#%E5%89%8D%E7%AB%AF" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>前端</h4>\n<p>主要就是 fetch 方法里面添加 mode 和 credentials 字段，或者如果是 xhr 的话设置 withCredentials</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="45902763876949540000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`export function createDebugUserInfo(data) {\n  return httpFetch(\'/service-tp-api/create-debug-user\', {\n    method: \'POST\',\n    data,\n    mode: \'cors\',\n    credentials: \'include\'\n  });\n}`, `45902763876949540000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                js 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">createDebugUserInfo</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">return</span> <span class="token function">httpFetch</span><span class="token punctuation">(</span><span class="token string">\'/service-tp-api/create-debug-user\'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>\n    method<span class="token punctuation">:</span> <span class="token string">\'POST\'</span><span class="token punctuation">,</span>\n    data<span class="token punctuation">,</span>\n    mode<span class="token punctuation">:</span> <span class="token string">\'cors\'</span><span class="token punctuation">,</span>\n    credentials<span class="token punctuation">:</span> <span class="token string">\'include\'</span>\n  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>以上更新于<code class="language-text">2019-5-11 17:52:48</code></p>\n<hr>\n<h2 id="光标位置的读取写入"><a href="#%E5%85%89%E6%A0%87%E4%BD%8D%E7%BD%AE%E7%9A%84%E8%AF%BB%E5%8F%96%E5%86%99%E5%85%A5" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>光标位置的读取写入</h2>\n<p>由于要实现中间插入标签或者换行符的效果，光标位置的读取与写入还是非常重要的，否则光标会“乱飘”</p>\n<h3 id="读取光标位置"><a href="#%E8%AF%BB%E5%8F%96%E5%85%89%E6%A0%87%E4%BD%8D%E7%BD%AE" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>读取光标位置</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="24732914580978373000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`function getCursorPosition(textDom) {\n  let cursorPos = 0;\n  if (document.selection) {\n    // IE Support\n    textDom.focus();\n    const selectRange = document.selection.createRange();\n    selectRange.moveStart(\'character\', -textDom.value.length);\n    cursorPos = selectRange.text.length;\n  } else if (textDom.selectionStart || textDom.selectionStart === 0) {\n    // Firefox support\n    cursorPos = textDom.selectionStart;\n  }\n  return cursorPos;\n}`, `24732914580978373000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                js 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">function</span> <span class="token function">getCursorPosition</span><span class="token punctuation">(</span><span class="token parameter">textDom</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">let</span> cursorPos <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>\n  <span class="token keyword">if</span> <span class="token punctuation">(</span>document<span class="token punctuation">.</span>selection<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token comment">// IE Support</span>\n    textDom<span class="token punctuation">.</span><span class="token function">focus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">const</span> selectRange <span class="token operator">=</span> document<span class="token punctuation">.</span>selection<span class="token punctuation">.</span><span class="token function">createRange</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    selectRange<span class="token punctuation">.</span><span class="token function">moveStart</span><span class="token punctuation">(</span><span class="token string">\'character\'</span><span class="token punctuation">,</span> <span class="token operator">-</span>textDom<span class="token punctuation">.</span>value<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    cursorPos <span class="token operator">=</span> selectRange<span class="token punctuation">.</span>text<span class="token punctuation">.</span>length<span class="token punctuation">;</span>\n  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>textDom<span class="token punctuation">.</span>selectionStart <span class="token operator">||</span> textDom<span class="token punctuation">.</span>selectionStart <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token comment">// Firefox support</span>\n    cursorPos <span class="token operator">=</span> textDom<span class="token punctuation">.</span>selectionStart<span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n  <span class="token keyword">return</span> cursorPos<span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="写入光标位置"><a href="#%E5%86%99%E5%85%A5%E5%85%89%E6%A0%87%E4%BD%8D%E7%BD%AE" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>写入光标位置</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="39816229267359550000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`function setCursorPosition(elem, index) {\n  const val = elem.value;\n  const len = val.length;\n\n  // 超过文本长度直接返回\n  if (len < index) return;\n  // 注意这里的 setTimeout 延迟写入，否则不生效\n  setTimeout(() => {\n    elem.focus();\n    if (elem.setSelectionRange) {\n      // 标准浏览器\n      elem.setSelectionRange(index, index);\n    } else {\n      // IE9-\n      const range = elem.createTextRange();\n      range.moveStart(\'character\', -len);\n      range.moveEnd(\'character\', -len);\n      range.moveStart(\'character\', index);\n      range.moveEnd(\'character\', 0);\n      range.select();\n    }\n  }, 0);\n}`, `39816229267359550000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                js 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">function</span> <span class="token function">setCursorPosition</span><span class="token punctuation">(</span><span class="token parameter">elem<span class="token punctuation">,</span> index</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">const</span> val <span class="token operator">=</span> elem<span class="token punctuation">.</span>value<span class="token punctuation">;</span>\n  <span class="token keyword">const</span> len <span class="token operator">=</span> val<span class="token punctuation">.</span>length<span class="token punctuation">;</span>\n\n  <span class="token comment">// 超过文本长度直接返回</span>\n  <span class="token keyword">if</span> <span class="token punctuation">(</span>len <span class="token operator">&lt;</span> index<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>\n  <span class="token comment">// 注意这里的 setTimeout 延迟写入，否则不生效</span>\n  <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n    elem<span class="token punctuation">.</span><span class="token function">focus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">if</span> <span class="token punctuation">(</span>elem<span class="token punctuation">.</span>setSelectionRange<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token comment">// 标准浏览器</span>\n      elem<span class="token punctuation">.</span><span class="token function">setSelectionRange</span><span class="token punctuation">(</span>index<span class="token punctuation">,</span> index<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>\n      <span class="token comment">// IE9-</span>\n      <span class="token keyword">const</span> range <span class="token operator">=</span> elem<span class="token punctuation">.</span><span class="token function">createTextRange</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n      range<span class="token punctuation">.</span><span class="token function">moveStart</span><span class="token punctuation">(</span><span class="token string">\'character\'</span><span class="token punctuation">,</span> <span class="token operator">-</span>len<span class="token punctuation">)</span><span class="token punctuation">;</span>\n      range<span class="token punctuation">.</span><span class="token function">moveEnd</span><span class="token punctuation">(</span><span class="token string">\'character\'</span><span class="token punctuation">,</span> <span class="token operator">-</span>len<span class="token punctuation">)</span><span class="token punctuation">;</span>\n      range<span class="token punctuation">.</span><span class="token function">moveStart</span><span class="token punctuation">(</span><span class="token string">\'character\'</span><span class="token punctuation">,</span> index<span class="token punctuation">)</span><span class="token punctuation">;</span>\n      range<span class="token punctuation">.</span><span class="token function">moveEnd</span><span class="token punctuation">(</span><span class="token string">\'character\'</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n      range<span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>以上更新于<code class="language-text">2019-5-22 10:01:50</code></p>\n<hr>\n<h1 id="最终实现效果"><a href="#%E6%9C%80%E7%BB%88%E5%AE%9E%E7%8E%B0%E6%95%88%E6%9E%9C" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>最终实现效果</h1>\n<p>\n  <a\n    class="gatsby-resp-image-link"\n    href="/static/2019-05-11-17-58-09-50fe1a30f1b8322576e6298fb1ec0544-db987.png"\n    style="display: block"\n    target="_blank"\n    rel="noopener"\n  >\n  \n  <span\n    class="gatsby-resp-image-wrapper"\n    style="position: relative; display: block; ; max-width: 782px; margin-left: auto; margin-right: auto;"\n  >\n    <span\n      class="gatsby-resp-image-background-image"\n      style="padding-bottom: 26.08695652173913%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAIAAADKYVtkAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAAqUlEQVQY023N2w6DIAwGYN//JZeZTFQOgtJapNQh2eFi+/PlT7lo6Wa1TMrYBXc+I5UKWn/mS/qv63t/v9lexdmQA/ZJPEnt0Iblze1ftsJLR3iACavzegZjU4wpbDS4Y7DJQ4Y1IXJmEc45C3ORSuRs6WLAbbTB+nnJo6HJkDI0aHpoGm0aNSlN67rnHQE5ETPlwuW1DA4OpFKkkuasd2tV1x9X2uP8zRN1ASF8y5HnagAAAABJRU5ErkJggg==\'); background-size: cover; display: block;"\n    >\n      <img\n        class="gatsby-resp-image-image"\n        style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;"\n        alt="2019 05 11 17 58 09"\n        title=""\n        src="/static/2019-05-11-17-58-09-50fe1a30f1b8322576e6298fb1ec0544-db987.png"\n        srcset="/static/2019-05-11-17-58-09-50fe1a30f1b8322576e6298fb1ec0544-18266.png 200w,\n/static/2019-05-11-17-58-09-50fe1a30f1b8322576e6298fb1ec0544-975aa.png 400w,\n/static/2019-05-11-17-58-09-50fe1a30f1b8322576e6298fb1ec0544-db987.png 782w"\n        sizes="(max-width: 782px) 100vw, 782px"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<p>\n  <a\n    class="gatsby-resp-image-link"\n    href="/static/2019-05-11-17-55-32-eaf72aa81e898deba5783d0723a54319-a484c.png"\n    style="display: block"\n    target="_blank"\n    rel="noopener"\n  >\n  \n  <span\n    class="gatsby-resp-image-wrapper"\n    style="position: relative; display: block; ; max-width: 577px; margin-left: auto; margin-right: auto;"\n  >\n    <span\n      class="gatsby-resp-image-background-image"\n      style="padding-bottom: 139.3414211438475%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAcCAIAAADuuAg3AAAACXBIWXMAAA7DAAAOwwHHb6hkAAAC0klEQVQ4y72TS0/UQBzA93tggvHghYOJBw+ePPMhjCePfg58xFfAiBpBMIBAEFgCshpFAZfHLshjee2Tbru7fW2n7XQ603Zap0gWhAUhUf/5HWY685vOzP8/keuxjjvx5JWJp03jTy6PPWwcvX/xZC5FH1wYuftsfZ6YjqQZkRufultTuasf2q7F2prGHzcMt7Dhk2gcvdcw0tK6Ft+XEyKXkPKLFW6hwiVFflkWlqU95N9YkvglMWRR5NKSXAWWCmCEEo9i6hOGh3QDyCrUdAsYlqabqsbaIUD3bCecSTw2TQWWrJmhDJFdQ9N1RVU1AERVFWSpJEtKVWPdqgZMiGrTJM1UfskWwjWQTRgYO7uamlGlvKYYCNt7Hw9Pqy8frBJCUL2hP8un85fkvXPaCJ2AjdEpsm3jbDbPFSt+EPh+HQhxoGXXl4njUqJSq0gt3oOCZ5U8XfBgibVdJHmea2NyXJY1QwFmxPECxE2Cjdco3YUzr3Cu3d5uR1vP8c4La6eH2ObxM7MKMXQbGjhC3ICUpqvbA0p+AhbelTMxLfceFAZh9g0q9DgYHpdFzVivlBkR1w1kfim3ESvP9ILNbjXbp271s1XMTLSS6mO7ZueqbZs1XOwuCsVb3wdvxgcjjhuYwpS41mGuvlyLTi70fwapt3ah19kdMrPdPqtplx6RkwLfPNXV/LUzlKvFL/pOJ+b7Ut+GEx/HN+cGVlbj6eQYmB0KHOJ43uELY5UnqPo0l58t5tltBz5MO9yKWC6JiTkorCPAI1M0+RlL5sNUOUdTJWvQ0JFp2BFWCRCaAOisWnzqU+r5LKjL8FhnP+hhVN0KU83y7DgEQsuE0GVXd7aoGmj/PVNKga5jTIIzx4Ec7pHS4DxxIAfnj/8uszfGckB9/9//mV0kJphlmdVJ4NIf1dKdRLQtPafolnIW2SGE5Z8tEbh+UuVvzw892pqpyT8B/ZABox2pPncAAAAASUVORK5CYII=\'); background-size: cover; display: block;"\n    >\n      <img\n        class="gatsby-resp-image-image"\n        style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;"\n        alt="2019 05 11 17 55 32"\n        title=""\n        src="/static/2019-05-11-17-55-32-eaf72aa81e898deba5783d0723a54319-a484c.png"\n        srcset="/static/2019-05-11-17-55-32-eaf72aa81e898deba5783d0723a54319-64be4.png 200w,\n/static/2019-05-11-17-55-32-eaf72aa81e898deba5783d0723a54319-6870d.png 400w,\n/static/2019-05-11-17-55-32-eaf72aa81e898deba5783d0723a54319-a484c.png 577w"\n        sizes="(max-width: 577px) 100vw, 577px"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>',
id:"/github/workspace/blog/记一次组件打包为链接的实践/index.md absPath of file >>> MarkdownRemark",timeToRead:7,frontmatter:{date:"2019-05-11 14:47:57",path:"/components-pack-as-library/",tags:"前端, 前端构建工具, webpack, 预研",title:"记一次组件打包为链接的实践",draft:null}},{excerpt:"webpack4 配置一览 基于 react-boilerplate 技术栈 antd + react + less 不断更新 前端的发展 模块化 模块化是指把一个复杂的系统分解到多个模块以方便编码。 挂载到变量 jQuery 库把它的 API 都放在了   下，在加载完 jQuery 后其他模块再通过   去使用 jQuery 命名空间冲突，两个库可能会使用同一个名称，例如 Zepto 也被放在   下； 无法合理地管理项目的依赖和版本； 无法方便地控制依赖的加载顺序。 CommonJS…",html:'<h1 id="webpack4-配置一览"><a href="#webpack4-%E9%85%8D%E7%BD%AE%E4%B8%80%E8%A7%88" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>webpack4 配置一览</h1>\n<ul>\n<li>基于<a href="https://github.com/react-boilerplate/react-boilerplate" target="_blank" rel="nofollow noreferrer noopener">react-boilerplate</a></li>\n<li>技术栈 antd + react + less</li>\n<li>不断更新</li>\n</ul>\n<h2 id="前端的发展"><a href="#%E5%89%8D%E7%AB%AF%E7%9A%84%E5%8F%91%E5%B1%95" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>前端的发展</h2>\n<h3 id="模块化"><a href="#%E6%A8%A1%E5%9D%97%E5%8C%96" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>模块化</h3>\n<p>模块化是指把一个复杂的系统分解到多个模块以方便编码。</p>\n<h3 id="挂载到变量"><a href="#%E6%8C%82%E8%BD%BD%E5%88%B0%E5%8F%98%E9%87%8F" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>挂载到变量</h3>\n<p>jQuery 库把它的 API 都放在了 <code class="language-text">window.$</code> 下，在加载完 jQuery 后其他模块再通过 <code class="language-text">window.$</code> 去使用 jQuery</p>\n<ul>\n<li>命名空间冲突，两个库可能会使用同一个名称，例如 Zepto 也被放在 <code class="language-text">window.$</code> 下；</li>\n<li>无法合理地管理项目的依赖和版本；</li>\n<li>无法方便地控制依赖的加载顺序。</li>\n</ul>\n<h3 id="commonjs"><a href="#commonjs" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>CommonJS</h3>\n<p>通过 require 方法来同步地加载依赖的其他模块</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="19310222631611950000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 导入\nconst moduleA = require(\'./moduleA\');\n\n// 导出\nmodule.exports = moduleA.someFunc;`, `19310222631611950000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                js 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// 导入</span>\n<span class="token keyword">const</span> moduleA <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'./moduleA\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token comment">// 导出</span>\nmodule<span class="token punctuation">.</span>exports <span class="token operator">=</span> moduleA<span class="token punctuation">.</span>someFunc<span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>CommonJS 的优点在于：</p>\n<ul>\n<li>代码可复用于 Node.js 环境下并运行，例如做同构应用；</li>\n<li>通过 NPM 发布的很多第三方模块都采用了 CommonJS 规范。</li>\n</ul>\n<p>缺点在于这样的代码无法直接运行在浏览器环境下，必须通过工具转换成标准的 ES5。</p>\n<h3 id="amd"><a href="#amd" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>AMD</h3>\n<p>采用异步的方式去加载依赖的模块</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="29314017592222410000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`define(\'module\', [\'dep\'], function(dep) {\n  return exports;\n});\n\n// 导入和使用\nrequire([\'module\'], function(module) {});`, `29314017592222410000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                js 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token function">define</span><span class="token punctuation">(</span><span class="token string">\'module\'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">\'dep\'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">dep</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">return</span> exports<span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token comment">// 导入和使用</span>\n<span class="token function">require</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">\'module\'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">module</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>AMD 的优点在于：</p>\n<ul>\n<li>可在不转换代码的情况下直接在浏览器中运行；</li>\n<li>可异步加载依赖；</li>\n<li>可并行加载多个依赖；</li>\n<li>代码可运行在浏览器环境和 Node.js 环境下。</li>\n</ul>\n<p>AMD 的缺点在于 JavaScript 运行环境没有原生支持 AMD，需要先导入实现了 AMD 的库后才能正常使用。</p>\n<h3 id="es6-模块化"><a href="#es6-%E6%A8%A1%E5%9D%97%E5%8C%96" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>ES6 模块化</h3>\n<p>逐渐取代 CommonJS 和 AMD 规范</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="45446358594343625000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 导入\nimport { readFile } from \'fs\';\nimport React from \'react\';\n// 导出\nexport function hello() {}\nexport default {\n  // ...\n};`, `45446358594343625000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                js 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// 导入</span>\n<span class="token keyword">import</span> <span class="token punctuation">{</span> readFile <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">\'fs\'</span><span class="token punctuation">;</span>\n<span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">\'react\'</span><span class="token punctuation">;</span>\n<span class="token comment">// 导出</span>\n<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">hello</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>\n<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>\n  <span class="token comment">// ...</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>它的缺点在于目前无法直接运行在大部分 JavaScript 运行环境下，必须通过工具转换成标准的 ES5 后才能正常运行。</p>\n<h2 id="webpack-核心概念"><a href="#webpack-%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>webpack 核心概念</h2>\n<p>源代码无法直接运行，必须通过转换后才可以正常运行。</p>\n<ul>\n<li>Entry：入口，Webpack 执行构建的第一步将从 Entry 开始，可抽象成输入。</li>\n<li>Module：模块，在 Webpack 里一切皆模块，一个模块对应着一个文件。Webpack 会从配置的 Entry 开始递归找出所有依赖的模块。</li>\n<li>Chunk：代码块，一个 Chunk 由多个模块组合而成，用于代码合并与分割。</li>\n<li>Loader：模块转换器，用于把模块原内容按照需求转换成新内容。</li>\n<li>Plugin：扩展插件，在 Webpack 构建流程中的特定时机注入扩展逻辑来改变构建结果或做你想要的事情。</li>\n<li>Output：输出结果，在 Webpack 经过一系列处理并得出最终想要的代码后输出结果。</li>\n</ul>\n<p>Webpack 启动后会从 Entry 里配置的 Module 开始递归解析 Entry 依赖的所有 Module。 每找到一个 Module， 就会根据配置的 Loader 去找出对应的转换规则，对 Module 进行转换后，再解析出当前 Module 依赖的 Module。 这些模块会以 Entry 为单位进行分组，一个 Entry 和其所有依赖的 Module 被分到一个组也就是一个 Chunk。最后 Webpack 会把所有 Chunk 转换成文件输出。 在整个流程中 Webpack 会在恰当的时机执行 Plugin 里定义的逻辑。</p>\n<h2 id="webpackbasebabeljs"><a href="#webpackbasebabeljs" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>webpack.base.babel.js</h2>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="70568578566082626000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`/**\n * COMMON WEBPACK CONFIGURATION\n */\n\nconst path = require(\'path\');\nconst webpack = require(\'webpack\');\n\nconst fs = require(\'fs\');\nconst lessToJs = require(\'less-vars-to-js\');\nconst themer = lessToJs(fs.readFileSync(path.join(__dirname, \'../../app/antd-theme/theme.less\'), \'utf8\'));\n\nconst postcssGlobalImport = require(\'postcss-global-import\');\nconst postcssImport = require(\'postcss-import\');\nconst postcssCustomProperties = require(\'postcss-custom-properties\');\nconst postcssCustomMedia = require(\'postcss-custom-media\');\nconst postcssMediaMinmax = require(\'postcss-media-minmax\');\nconst postcssCustomSelectors = require(\'postcss-custom-selectors\');\nconst postcssCalc = require(\'postcss-calc\');\nconst postcssNesting = require(\'postcss-nesting\');\nconst postcssNested = require(\'postcss-nested\');\nconst postcssColorFunction = require(\'postcss-color-function\');\nconst pleeeaseFilters = require(\'pleeease-filters\');\nconst pixrem = require(\'pixrem\');\nconst postcssSelectorMatches = require(\'postcss-selector-matches\');\nconst postcssSelectorNot = require(\'postcss-selector-not\');\nconst postcssFlexbugsFixes = require(\'postcss-flexbugs-fixes\');\nconst autoprefixer = require(\'autoprefixer\');\nconst globalJSON = require(path.resolve(process.cwd(), \'global.json\'));\n\n// 将 CSS 提取到单独的文件中，它为每个包含 CSS 的 JS 文件创建一个 CSS 文件，它支持 CSS 和 SourceMaps 的按需加载。\nconst MiniCssExtractPlugin = require(\'mini-css-extract-plugin\');\nconst SimpleProgressWebpackPlugin = require(\'simple-progress-webpack-plugin\');\nconst CopyWebpackPlugin = require(\'copy-webpack-plugin\');\n\nmodule.exports = (options) => ({\n  // context: path.resolve(__dirname, \'app\') // 默认 context 为根目录，影响相对路径所指向的真实文件\n  entry: options.entry, // 必填，配置模块的入口\n  mode: options.mode,\n  optimization: options.optimization,\n  output: Object.assign(\n    {\n      // Compile into js/build.js\n      // 配置输出文件存放在本地的目录\n      path: path.resolve(process.cwd(), \'build\'),\n      // 发布到线上的所有资源的 URL 前缀，string 类型\n      publicPath: \'/\'\n    },\n    options.output\n  ), // Merge with env dependent settings\n  module: {\n    // 配置如何处理模块。\n    rules: [\n      {\n        test: /\\.js\\$/, // Transform all .js files required somewhere with Babel\n        // 尽可能的缩小命中范围，加快 Webpack 搜索速度\n        include: [/app/, /unicorn/],\n        // 排除 node_modules 目录下的文件\n        // exclude: path.resolve(__dirname, \'node_modules\'),\n        use: [\n          // 一组 Loader 的执行顺序默认是从右到左执行，通过 enforce 选项可以让其中一个 Loader 的执行顺序放到最前或者最后。\n          // 多线程加载耗时 loader\n          \'thread-loader\',\n          {\n            loader: \'babel-loader\',\n            options: options.babelQuery\n            // enforce:\'post\' 的含义是把该 Loader 的执行顺序放到最后\n            // enforce 的值还可以是 pre，代表把 Loader 的执行顺序放到最前面\n          }\n        ]\n      },\n      {\n        test: /\\.css/,\n        include: [/app/, /unicorn/],\n        use: [\n          {\n            // 大概是把 CSS 内容用 JavaScript 里的字符串存储起来\n            // 在网页执行 JavaScript 时通过 DOM 操作动态地往 HTML head 标签里插入 HTML style 标签。\n            // 也许你认为这样做会导致JavaScript 文件变大并导致加载网页时间变长，如果想让 Webpack 单独输出 CSS 文件\n            // webpack4 用 mini-css-extract-plugin, 之前的版本用 extract-text-webpack-plugin\n            loader: options.cssDebug ? \'style-loader\' : MiniCssExtractPlugin.loader,\n            options: {\n              // Stylesheet Limits in Internet Explorer\n              // Internet Explorer 6 到 9 支持的最大样式表和规则数\n              // https://blogs.msdn.microsoft.com/ieinternals/2011/05/14/stylesheet-limits-in-internet-explorer/\n              singleton: false\n            }\n          },\n          {\n            loader: \'css-loader\',\n            options: {\n              // CSS Loader https://github.com/webpack/css-loader\n              // 指定 css-loader 处理前最多可以经过的 loader 个数\n              // 0 => no loaders (default); 1 => postcss-loader; 2 => postcss-loader, sass-loader\n              importLoaders: 1,\n              sourceMap: options.cssDebug,\n              // CSS Modules https://github.com/css-modules/css-modules\n              modules: true,\n              localIdentName: options.cssDebug ? \'[name]-[local]-[hash:base64:5]\' : \'[hash:base64:5]\'\n              // CSS Nano http://cssnano.co/options/\n              // minimize: !options.cssDebug, // v2 中会报错\n              // discardComments: { removeAll: true }, // v2 中会报错\n            }\n          },\n          {\n            loader: \'postcss-loader\',\n            options: {\n              plugins: [\n                // Transfer @global-import rule by inlining content with :global CSS Modules scope\n                // e.g. @global-import \'draft-js/dist/Draft.css\'\n                // https://github.com/scherebedov/postcss-global-import\n                postcssGlobalImport(),\n                // Transfer @import rule by inlining content, e.g. @import \'normalize.css\'\n                // https://github.com/postcss/postcss-import\n                postcssImport({ path: \'app\' }),\n                // W3C variables, e.g. :root { --color: red; } div { background: var(--color); }\n                // https://github.com/postcss/postcss-custom-properties\n                postcssCustomProperties(),\n                // W3C CSS Custom Media Queries, e.g. @custom-media --small-viewport (max-width: 30em);\n                // https://github.com/postcss/postcss-custom-media\n                postcssCustomMedia(),\n                // CSS4 Media Queries, e.g. @media screen and (width >= 500px) and (width <= 1200px) { }\n                // https://github.com/postcss/postcss-media-minmax\n                postcssMediaMinmax(),\n                // W3C CSS Custom Selectors, e.g. @custom-selector :--heading h1, h2, h3, h4, h5, h6;\n                // https://github.com/postcss/postcss-custom-selectors\n                postcssCustomSelectors(),\n                // W3C calc() function, e.g. div { height: calc(100px - 2em); }\n                // https://github.com/postcss/postcss-calc\n                postcssCalc(),\n                // Allows you to nest one style rule inside another\n                // https://github.com/jonathantneal/postcss-nesting\n                postcssNesting(),\n                // Unwraps nested rules like how Sass does it\n                // https://github.com/postcss/postcss-nested\n                postcssNested(),\n                // W3C color() function, e.g. div { background: color(red alpha(90%)); }\n                // https://github.com/postcss/postcss-color-function\n                postcssColorFunction(),\n                // Convert CSS shorthand filters to SVG equivalent, e.g. .blur { filter: blur(4px); }\n                // https://github.com/iamvdo/pleeease-filters\n                pleeeaseFilters(),\n                // Generate pixel fallback for &quot;rem&quot; units, e.g. div { margin: 2.5rem 2px 3em 100%; }\n                // https://github.com/robwierzbowski/node-pixrem\n                pixrem(),\n                // W3C CSS Level4 :matches() pseudo class, e.g. p:matches(:first-child, .special) { }\n                // https://github.com/postcss/postcss-selector-matches\n                postcssSelectorMatches(),\n                // Transforms :not() W3C CSS Level 4 pseudo class to :not() CSS Level 3 selectors\n                // https://github.com/postcss/postcss-selector-not\n                postcssSelectorNot(),\n                // Postcss flexbox bug fixer\n                // https://github.com/luisrudge/postcss-flexbugs-fixes\n                postcssFlexbugsFixes(),\n                // Add vendor prefixes to CSS rules using values from caniuse.com\n                // https://github.com/postcss/autoprefixer\n                autoprefixer(/* package.json/browserslist */)\n              ]\n            }\n          }\n        ]\n      },\n      {\n        // custom Ant Design theme\n        test: /\\.less\\$/,\n        include: /node_modules/,\n        use: [\n          {\n            loader: options.cssDebug ? \'style-loader\' : MiniCssExtractPlugin.loader\n          },\n          {\n            loader: \'css-loader\'\n            // options: {\n            //   minimize: true,\n            // },\n          },\n          {\n            loader: \'postcss-loader\',\n            options: {\n              plugins: [autoprefixer()]\n            }\n          },\n          {\n            // 每一个 Loader 都可以通过 URL querystring 的方式传入参数，也可以通过 options 传入\n            // 还可以在源码中指定用什么 Loader 去处理文件\n            // require(\'style-loader!css-loader?minimize!./main.css\');\n            // import \'!file-loader?name=[name].[ext]!./manifest.json\';\n            loader: \\`less-loader?{&quot;sourceMap&quot;:true,&quot;modifyVars&quot;:\\${JSON.stringify(themer)}}\\`\n          }\n        ]\n      },\n      {\n        test: /\\.css/,\n        include: /node_modules/,\n        use: [\n          {\n            loader: options.cssDebug ? \'style-loader\' : MiniCssExtractPlugin.loader\n          },\n          {\n            loader: \'css-loader\',\n            options: {\n              importLoaders: 1,\n              sourceMap: options.cssDebug,\n              // do not use css modules for original css in node_modules\n              // 引入第三方库时不对其 hash 处理，防止样式不生效\n              // 启用 CSS 模块规范，自动为每一个类生成一个哈希值，可以惟一标志这个类\n              // :global 不对其类名进行转化，默认为 :local\n              modules: false,\n              // 生成 hash 时的格式\n              localIdentName: options.cssDebug ? \'[name]-[local]-[hash:base64:5]\' : \'[hash:base64:5]\'\n            }\n          }\n        ]\n      },\n      // 暂时屏蔽，对 IE 有影响\n      // {\n      //   test: /\\.svg\\$/,\n      //   use: [\n      //     {\n      //       loader: \'svg-url-loader\',\n      //       options: {\n      //         // Inline files smaller than 10 kB\n      //         limit: 10 * 1024,\n      //         noquotes: true,\n      //       },\n      //     },\n      //   ],\n      // },\n      {\n        test: /\\.(eot|ttf|woff|woff2|mp3|xls|xlsx|csv|mp4|webm|json|svg)\\$/,\n        use: [\n          {\n            loader: \'file-loader\',\n            options: {\n              name() {\n                return \'[name]-[hash].[ext]\';\n              }\n            }\n          }\n        ]\n      },\n      {\n        test: /\\.(jpe?g|png|gif)\\$/,\n        use: [\n          {\n            loader: \'url-loader\',\n            options: {\n              // Inline files smaller than 10 kB\n              limit: 10 * 1024\n            }\n          }\n          // {\n          //   loader: \'image-webpack-loader\',\n          //   options: {\n          //     mozjpeg: {\n          //       enabled: false,\n          //       // NOTE: mozjpeg is disabled as it causes errors in some Linux environments\n          //       // Try enabling it in your environment by switching the config to:\n          //       // enabled: true,\n          //       // progressive: true,\n          //     },\n          //     gifsicle: {\n          //       interlaced: false,\n          //     },\n          //     optipng: {\n          //       optimizationLevel: 7,\n          //     },\n          //     pngquant: {\n          //       quality: \'65-90\',\n          //       speed: 4,\n          //     },\n          //   },\n          // },\n        ]\n      },\n      {\n        test: /\\.html\\$/,\n        use: \'html-loader\'\n      },\n      {\n        test: /\\.md\\$/,\n        use: [\n          {\n            loader: \'html-loader\'\n          },\n          {\n            loader: \'markdown-loader\',\n            options: {\n              gfm: true,\n              tables: true\n              // highlight: (code) => highlight.highlightAuto(code).value,\n            }\n          }\n        ]\n      }\n    ]\n    // noParse: [ // 不用解析和处理的模块\n    //   /special-library\\.js\\$/  // 用正则匹配\n    // ],\n  },\n  // externals: {\n  //   // 把导入语句里的 jquery 替换成运行环境里的全局变量 jQuery\n  //   jquery: \'jQuery\'\n  // }\n  plugins: options.plugins.concat([\n    // 扩展 Webpack 功能，几乎让 Webpack 可以做任何构建相关的事情\n    // new SimpleProgressWebpackPlugin(),\n\n    new webpack.ProvidePlugin({\n      // make fetch available, 和 externals 一样的效果\n      fetch: \'exports-loader?self.fetch!whatwg-fetch\',\n      \\$: \'jquery\',\n      jQuery: \'jquery\'\n    }),\n\n    // Always expose NODE_ENV to webpack, in order to use \\`process.env.NODE_ENV\\`\n    // inside your code for any environment checks; UglifyJS will automatically\n    // drop any unreachable code.\n    new webpack.DefinePlugin({\n      \'process.env\': {\n        NODE_ENV: JSON.stringify(process.env.NODE_ENV),\n        GLOBAL: JSON.stringify(globalJSON || {}),\n        SERVER: JSON.stringify(process.env.SERVER)\n      }\n    }),\n\n    new CopyWebpackPlugin(\n      [\'app/favicon.ico\', \'app/manifest.json\'].map((src) => ({ from: src, to: path.resolve(process.cwd(), \'build\') }))\n    ),\n\n    new MiniCssExtractPlugin({\n      filename: \'[name].[contenthash:8].css\',\n      chunkFilename: \'[name].[contenthash:8].css\'\n    }),\n\n    // only load locale we need\n    // https://github.com/moment/moment/issues/2517#issuecomment-185836313\n    new webpack.ContextReplacementPlugin(/moment[\\/\\\\]locale\\$/, /zh/) // eslint-disable-line\n  ]),\n  resolve: {\n    // 配置 Webpack 如何寻找模块所对应的文件\n    // 配置 Webpack 去哪些目录下寻找第三方模块，配置后可以简单的引入 import \'components\'，等价于 import \'app/components\'\n    modules: [\'app\', \'node_modules\'],\n    // 通过别名来把原导入路径映射成一个新的导入路径，\\$ 符号来缩小范围到只命中以关键字结尾\n    alias: {\n      // zh-cn.js will import \'../moment\', since we are using jsnext:main, it will pack two copys of moment.\n      moment\\$: path.resolve(process.cwd(), \'node_modules/moment/moment\'),\n      unicorn: path.resolve(process.cwd(), \'unicorn\'),\n      // 使用 alias 把导入 react 的语句换成直接使用单独完整的 react.production.min.js 文件，减少耗时的递归解析操作\n      // 因为会影响 Tree-Shaking 去除无效代码，一般对整体性比较强的库采用本方法优化\n      // 不适用一些工具类的库，如 lodash，导致输出代码中包含很多永远不会执行的代码\n      react: path.resolve(process.cwd(), \'node_modules/react/cjs/react.production.min.js\'),\n      \'react-dom\\$\': path.resolve(process.cwd(), \'node_modules/react-dom/cjs/react-dom.production.min.js\'),\n      \'react-dom/server\\$\': path.resolve(\n        process.cwd(),\n        \'node_modules/react-dom/cjs/react-dom-server.browser.production.min.js\'\n      )\n    },\n    // 在导入语句没带文件后缀时，Webpack 会自动带上后缀后去尝试访问文件是否存在\n    extensions: [\n      // 尽可能的减少后缀尝试的可能性\n      \'.js\'\n      // \'.jsx\',\n      // \'.react.js\',\n    ],\n    // 会按照数组里的顺序去 package.json 文件里寻找，只会使用找到的第一个\n    mainFields: [\n      // 针对 Npm 中的第三方模块优先采用 jsnext:main 中指向的 ES6 模块化语法的文件，\n      // 利于 Tree Shaking/Scope Hoisting\n      // 剔除 JavaScript 中用不上的死代码 / 让 Webpack 打包出来的代码文件更小、运行的更快，合并声明性的代码\n      \'jsnext:main\',\n      // \'browser\',\n      \'main\' // 采用 ES5 语法的代码入口文件，尽量采用 main 字段作为入口文件描述字段，以减少搜索步骤\n    ]\n  },\n  devtool: options.devtool,\n  // 让 Webpack 构建出针对不同运行环境的代码\n  target: \'web\', // Make web variables accessible to webpack, e.g. window\n  performance: options.performance || {}\n  // 输出文件性能检查配置\n  // performance: {\n  //   hints: \'warning\', // 有性能问题时输出警告\n  //   hints: \'error\', // 有性能问题时输出错误\n  //   hints: false, // 关闭性能检查\n  //   maxAssetSize: 200000, // 最大文件大小 (单位 bytes)\n  //   maxEntrypointSize: 400000, // 最大入口文件大小 (单位 bytes)\n  //   assetFilter: function(assetFilename) { // 过滤要检查的文件\n  //     return assetFilename.endsWith(\'.css\') || assetFilename.endsWith(\'.js\');\n  //   }\n  // },\n});`, `70568578566082626000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                js 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">/**\n * COMMON WEBPACK CONFIGURATION\n */</span>\n\n<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'path\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">const</span> webpack <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'webpack\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'fs\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">const</span> lessToJs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'less-vars-to-js\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">const</span> themer <span class="token operator">=</span> <span class="token function">lessToJs</span><span class="token punctuation">(</span>fs<span class="token punctuation">.</span><span class="token function">readFileSync</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">\'../../app/antd-theme/theme.less\'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">\'utf8\'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token keyword">const</span> postcssGlobalImport <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'postcss-global-import\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">const</span> postcssImport <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'postcss-import\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">const</span> postcssCustomProperties <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'postcss-custom-properties\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">const</span> postcssCustomMedia <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'postcss-custom-media\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">const</span> postcssMediaMinmax <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'postcss-media-minmax\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">const</span> postcssCustomSelectors <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'postcss-custom-selectors\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">const</span> postcssCalc <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'postcss-calc\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">const</span> postcssNesting <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'postcss-nesting\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">const</span> postcssNested <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'postcss-nested\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">const</span> postcssColorFunction <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'postcss-color-function\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">const</span> pleeeaseFilters <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'pleeease-filters\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">const</span> pixrem <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'pixrem\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">const</span> postcssSelectorMatches <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'postcss-selector-matches\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">const</span> postcssSelectorNot <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'postcss-selector-not\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">const</span> postcssFlexbugsFixes <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'postcss-flexbugs-fixes\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">const</span> autoprefixer <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'autoprefixer\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">const</span> globalJSON <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span><span class="token function">cwd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">\'global.json\'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token comment">// 将 CSS 提取到单独的文件中，它为每个包含 CSS 的 JS 文件创建一个 CSS 文件，它支持 CSS 和 SourceMaps 的按需加载。</span>\n<span class="token keyword">const</span> MiniCssExtractPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'mini-css-extract-plugin\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">const</span> SimpleProgressWebpackPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'simple-progress-webpack-plugin\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">const</span> CopyWebpackPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'copy-webpack-plugin\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\nmodule<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">options</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">{</span>\n  <span class="token comment">// context: path.resolve(__dirname, \'app\') // 默认 context 为根目录，影响相对路径所指向的真实文件</span>\n  entry<span class="token punctuation">:</span> options<span class="token punctuation">.</span>entry<span class="token punctuation">,</span> <span class="token comment">// 必填，配置模块的入口</span>\n  mode<span class="token punctuation">:</span> options<span class="token punctuation">.</span>mode<span class="token punctuation">,</span>\n  optimization<span class="token punctuation">:</span> options<span class="token punctuation">.</span>optimization<span class="token punctuation">,</span>\n  output<span class="token punctuation">:</span> Object<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span>\n    <span class="token punctuation">{</span>\n      <span class="token comment">// Compile into js/build.js</span>\n      <span class="token comment">// 配置输出文件存放在本地的目录</span>\n      path<span class="token punctuation">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span><span class="token function">cwd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">\'build\'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n      <span class="token comment">// 发布到线上的所有资源的 URL 前缀，string 类型</span>\n      publicPath<span class="token punctuation">:</span> <span class="token string">\'/\'</span>\n    <span class="token punctuation">}</span><span class="token punctuation">,</span>\n    options<span class="token punctuation">.</span>output\n  <span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// Merge with env dependent settings</span>\n  module<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n    <span class="token comment">// 配置如何处理模块。</span>\n    rules<span class="token punctuation">:</span> <span class="token punctuation">[</span>\n      <span class="token punctuation">{</span>\n        test<span class="token punctuation">:</span> <span class="token regex">/\\.js$/</span><span class="token punctuation">,</span> <span class="token comment">// Transform all .js files required somewhere with Babel</span>\n        <span class="token comment">// 尽可能的缩小命中范围，加快 Webpack 搜索速度</span>\n        include<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token regex">/app/</span><span class="token punctuation">,</span> <span class="token regex">/unicorn/</span><span class="token punctuation">]</span><span class="token punctuation">,</span>\n        <span class="token comment">// 排除 node_modules 目录下的文件</span>\n        <span class="token comment">// exclude: path.resolve(__dirname, \'node_modules\'),</span>\n        use<span class="token punctuation">:</span> <span class="token punctuation">[</span>\n          <span class="token comment">// 一组 Loader 的执行顺序默认是从右到左执行，通过 enforce 选项可以让其中一个 Loader 的执行顺序放到最前或者最后。</span>\n          <span class="token comment">// 多线程加载耗时 loader</span>\n          <span class="token string">\'thread-loader\'</span><span class="token punctuation">,</span>\n          <span class="token punctuation">{</span>\n            loader<span class="token punctuation">:</span> <span class="token string">\'babel-loader\'</span><span class="token punctuation">,</span>\n            options<span class="token punctuation">:</span> options<span class="token punctuation">.</span>babelQuery\n            <span class="token comment">// enforce:\'post\' 的含义是把该 Loader 的执行顺序放到最后</span>\n            <span class="token comment">// enforce 的值还可以是 pre，代表把 Loader 的执行顺序放到最前面</span>\n          <span class="token punctuation">}</span>\n        <span class="token punctuation">]</span>\n      <span class="token punctuation">}</span><span class="token punctuation">,</span>\n      <span class="token punctuation">{</span>\n        test<span class="token punctuation">:</span> <span class="token regex">/\\.css/</span><span class="token punctuation">,</span>\n        include<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token regex">/app/</span><span class="token punctuation">,</span> <span class="token regex">/unicorn/</span><span class="token punctuation">]</span><span class="token punctuation">,</span>\n        use<span class="token punctuation">:</span> <span class="token punctuation">[</span>\n          <span class="token punctuation">{</span>\n            <span class="token comment">// 大概是把 CSS 内容用 JavaScript 里的字符串存储起来</span>\n            <span class="token comment">// 在网页执行 JavaScript 时通过 DOM 操作动态地往 HTML head 标签里插入 HTML style 标签。</span>\n            <span class="token comment">// 也许你认为这样做会导致JavaScript 文件变大并导致加载网页时间变长，如果想让 Webpack 单独输出 CSS 文件</span>\n            <span class="token comment">// webpack4 用 mini-css-extract-plugin, 之前的版本用 extract-text-webpack-plugin</span>\n            loader<span class="token punctuation">:</span> options<span class="token punctuation">.</span>cssDebug <span class="token operator">?</span> <span class="token string">\'style-loader\'</span> <span class="token punctuation">:</span> MiniCssExtractPlugin<span class="token punctuation">.</span>loader<span class="token punctuation">,</span>\n            options<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n              <span class="token comment">// Stylesheet Limits in Internet Explorer</span>\n              <span class="token comment">// Internet Explorer 6 到 9 支持的最大样式表和规则数</span>\n              <span class="token comment">// https://blogs.msdn.microsoft.com/ieinternals/2011/05/14/stylesheet-limits-in-internet-explorer/</span>\n              singleton<span class="token punctuation">:</span> <span class="token boolean">false</span>\n            <span class="token punctuation">}</span>\n          <span class="token punctuation">}</span><span class="token punctuation">,</span>\n          <span class="token punctuation">{</span>\n            loader<span class="token punctuation">:</span> <span class="token string">\'css-loader\'</span><span class="token punctuation">,</span>\n            options<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n              <span class="token comment">// CSS Loader https://github.com/webpack/css-loader</span>\n              <span class="token comment">// 指定 css-loader 处理前最多可以经过的 loader 个数</span>\n              <span class="token comment">// 0 => no loaders (default); 1 => postcss-loader; 2 => postcss-loader, sass-loader</span>\n              importLoaders<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>\n              sourceMap<span class="token punctuation">:</span> options<span class="token punctuation">.</span>cssDebug<span class="token punctuation">,</span>\n              <span class="token comment">// CSS Modules https://github.com/css-modules/css-modules</span>\n              modules<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>\n              localIdentName<span class="token punctuation">:</span> options<span class="token punctuation">.</span>cssDebug <span class="token operator">?</span> <span class="token string">\'[name]-[local]-[hash:base64:5]\'</span> <span class="token punctuation">:</span> <span class="token string">\'[hash:base64:5]\'</span>\n              <span class="token comment">// CSS Nano http://cssnano.co/options/</span>\n              <span class="token comment">// minimize: !options.cssDebug, // v2 中会报错</span>\n              <span class="token comment">// discardComments: { removeAll: true }, // v2 中会报错</span>\n            <span class="token punctuation">}</span>\n          <span class="token punctuation">}</span><span class="token punctuation">,</span>\n          <span class="token punctuation">{</span>\n            loader<span class="token punctuation">:</span> <span class="token string">\'postcss-loader\'</span><span class="token punctuation">,</span>\n            options<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n              plugins<span class="token punctuation">:</span> <span class="token punctuation">[</span>\n                <span class="token comment">// Transfer @global-import rule by inlining content with :global CSS Modules scope</span>\n                <span class="token comment">// e.g. @global-import \'draft-js/dist/Draft.css\'</span>\n                <span class="token comment">// https://github.com/scherebedov/postcss-global-import</span>\n                <span class="token function">postcssGlobalImport</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n                <span class="token comment">// Transfer @import rule by inlining content, e.g. @import \'normalize.css\'</span>\n                <span class="token comment">// https://github.com/postcss/postcss-import</span>\n                <span class="token function">postcssImport</span><span class="token punctuation">(</span><span class="token punctuation">{</span> path<span class="token punctuation">:</span> <span class="token string">\'app\'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n                <span class="token comment">// W3C variables, e.g. :root { --color: red; } div { background: var(--color); }</span>\n                <span class="token comment">// https://github.com/postcss/postcss-custom-properties</span>\n                <span class="token function">postcssCustomProperties</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n                <span class="token comment">// W3C CSS Custom Media Queries, e.g. @custom-media --small-viewport (max-width: 30em);</span>\n                <span class="token comment">// https://github.com/postcss/postcss-custom-media</span>\n                <span class="token function">postcssCustomMedia</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n                <span class="token comment">// CSS4 Media Queries, e.g. @media screen and (width >= 500px) and (width &lt;= 1200px) { }</span>\n                <span class="token comment">// https://github.com/postcss/postcss-media-minmax</span>\n                <span class="token function">postcssMediaMinmax</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n                <span class="token comment">// W3C CSS Custom Selectors, e.g. @custom-selector :--heading h1, h2, h3, h4, h5, h6;</span>\n                <span class="token comment">// https://github.com/postcss/postcss-custom-selectors</span>\n                <span class="token function">postcssCustomSelectors</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n                <span class="token comment">// W3C calc() function, e.g. div { height: calc(100px - 2em); }</span>\n                <span class="token comment">// https://github.com/postcss/postcss-calc</span>\n                <span class="token function">postcssCalc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n                <span class="token comment">// Allows you to nest one style rule inside another</span>\n                <span class="token comment">// https://github.com/jonathantneal/postcss-nesting</span>\n                <span class="token function">postcssNesting</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n                <span class="token comment">// Unwraps nested rules like how Sass does it</span>\n                <span class="token comment">// https://github.com/postcss/postcss-nested</span>\n                <span class="token function">postcssNested</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n                <span class="token comment">// W3C color() function, e.g. div { background: color(red alpha(90%)); }</span>\n                <span class="token comment">// https://github.com/postcss/postcss-color-function</span>\n                <span class="token function">postcssColorFunction</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n                <span class="token comment">// Convert CSS shorthand filters to SVG equivalent, e.g. .blur { filter: blur(4px); }</span>\n                <span class="token comment">// https://github.com/iamvdo/pleeease-filters</span>\n                <span class="token function">pleeeaseFilters</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n                <span class="token comment">// Generate pixel fallback for "rem" units, e.g. div { margin: 2.5rem 2px 3em 100%; }</span>\n                <span class="token comment">// https://github.com/robwierzbowski/node-pixrem</span>\n                <span class="token function">pixrem</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n                <span class="token comment">// W3C CSS Level4 :matches() pseudo class, e.g. p:matches(:first-child, .special) { }</span>\n                <span class="token comment">// https://github.com/postcss/postcss-selector-matches</span>\n                <span class="token function">postcssSelectorMatches</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n                <span class="token comment">// Transforms :not() W3C CSS Level 4 pseudo class to :not() CSS Level 3 selectors</span>\n                <span class="token comment">// https://github.com/postcss/postcss-selector-not</span>\n                <span class="token function">postcssSelectorNot</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n                <span class="token comment">// Postcss flexbox bug fixer</span>\n                <span class="token comment">// https://github.com/luisrudge/postcss-flexbugs-fixes</span>\n                <span class="token function">postcssFlexbugsFixes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n                <span class="token comment">// Add vendor prefixes to CSS rules using values from caniuse.com</span>\n                <span class="token comment">// https://github.com/postcss/autoprefixer</span>\n                <span class="token function">autoprefixer</span><span class="token punctuation">(</span><span class="token comment">/* package.json/browserslist */</span><span class="token punctuation">)</span>\n              <span class="token punctuation">]</span>\n            <span class="token punctuation">}</span>\n          <span class="token punctuation">}</span>\n        <span class="token punctuation">]</span>\n      <span class="token punctuation">}</span><span class="token punctuation">,</span>\n      <span class="token punctuation">{</span>\n        <span class="token comment">// custom Ant Design theme</span>\n        test<span class="token punctuation">:</span> <span class="token regex">/\\.less$/</span><span class="token punctuation">,</span>\n        include<span class="token punctuation">:</span> <span class="token regex">/node_modules/</span><span class="token punctuation">,</span>\n        use<span class="token punctuation">:</span> <span class="token punctuation">[</span>\n          <span class="token punctuation">{</span>\n            loader<span class="token punctuation">:</span> options<span class="token punctuation">.</span>cssDebug <span class="token operator">?</span> <span class="token string">\'style-loader\'</span> <span class="token punctuation">:</span> MiniCssExtractPlugin<span class="token punctuation">.</span>loader\n          <span class="token punctuation">}</span><span class="token punctuation">,</span>\n          <span class="token punctuation">{</span>\n            loader<span class="token punctuation">:</span> <span class="token string">\'css-loader\'</span>\n            <span class="token comment">// options: {</span>\n            <span class="token comment">//   minimize: true,</span>\n            <span class="token comment">// },</span>\n          <span class="token punctuation">}</span><span class="token punctuation">,</span>\n          <span class="token punctuation">{</span>\n            loader<span class="token punctuation">:</span> <span class="token string">\'postcss-loader\'</span><span class="token punctuation">,</span>\n            options<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n              plugins<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token function">autoprefixer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span>\n            <span class="token punctuation">}</span>\n          <span class="token punctuation">}</span><span class="token punctuation">,</span>\n          <span class="token punctuation">{</span>\n            <span class="token comment">// 每一个 Loader 都可以通过 URL querystring 的方式传入参数，也可以通过 options 传入</span>\n            <span class="token comment">// 还可以在源码中指定用什么 Loader 去处理文件</span>\n            <span class="token comment">// require(\'style-loader!css-loader?minimize!./main.css\');</span>\n            <span class="token comment">// import \'!file-loader?name=[name].[ext]!./manifest.json\';</span>\n            loader<span class="token punctuation">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">less-loader?{"sourceMap":true,"modifyVars":</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>themer<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">}</span><span class="token template-punctuation string">`</span></span>\n          <span class="token punctuation">}</span>\n        <span class="token punctuation">]</span>\n      <span class="token punctuation">}</span><span class="token punctuation">,</span>\n      <span class="token punctuation">{</span>\n        test<span class="token punctuation">:</span> <span class="token regex">/\\.css/</span><span class="token punctuation">,</span>\n        include<span class="token punctuation">:</span> <span class="token regex">/node_modules/</span><span class="token punctuation">,</span>\n        use<span class="token punctuation">:</span> <span class="token punctuation">[</span>\n          <span class="token punctuation">{</span>\n            loader<span class="token punctuation">:</span> options<span class="token punctuation">.</span>cssDebug <span class="token operator">?</span> <span class="token string">\'style-loader\'</span> <span class="token punctuation">:</span> MiniCssExtractPlugin<span class="token punctuation">.</span>loader\n          <span class="token punctuation">}</span><span class="token punctuation">,</span>\n          <span class="token punctuation">{</span>\n            loader<span class="token punctuation">:</span> <span class="token string">\'css-loader\'</span><span class="token punctuation">,</span>\n            options<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n              importLoaders<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>\n              sourceMap<span class="token punctuation">:</span> options<span class="token punctuation">.</span>cssDebug<span class="token punctuation">,</span>\n              <span class="token comment">// do not use css modules for original css in node_modules</span>\n              <span class="token comment">// 引入第三方库时不对其 hash 处理，防止样式不生效</span>\n              <span class="token comment">// 启用 CSS 模块规范，自动为每一个类生成一个哈希值，可以惟一标志这个类</span>\n              <span class="token comment">// :global 不对其类名进行转化，默认为 :local</span>\n              modules<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>\n              <span class="token comment">// 生成 hash 时的格式</span>\n              localIdentName<span class="token punctuation">:</span> options<span class="token punctuation">.</span>cssDebug <span class="token operator">?</span> <span class="token string">\'[name]-[local]-[hash:base64:5]\'</span> <span class="token punctuation">:</span> <span class="token string">\'[hash:base64:5]\'</span>\n            <span class="token punctuation">}</span>\n          <span class="token punctuation">}</span>\n        <span class="token punctuation">]</span>\n      <span class="token punctuation">}</span><span class="token punctuation">,</span>\n      <span class="token comment">// 暂时屏蔽，对 IE 有影响</span>\n      <span class="token comment">// {</span>\n      <span class="token comment">//   test: /\\.svg$/,</span>\n      <span class="token comment">//   use: [</span>\n      <span class="token comment">//     {</span>\n      <span class="token comment">//       loader: \'svg-url-loader\',</span>\n      <span class="token comment">//       options: {</span>\n      <span class="token comment">//         // Inline files smaller than 10 kB</span>\n      <span class="token comment">//         limit: 10 * 1024,</span>\n      <span class="token comment">//         noquotes: true,</span>\n      <span class="token comment">//       },</span>\n      <span class="token comment">//     },</span>\n      <span class="token comment">//   ],</span>\n      <span class="token comment">// },</span>\n      <span class="token punctuation">{</span>\n        test<span class="token punctuation">:</span> <span class="token regex">/\\.(eot|ttf|woff|woff2|mp3|xls|xlsx|csv|mp4|webm|json|svg)$/</span><span class="token punctuation">,</span>\n        use<span class="token punctuation">:</span> <span class="token punctuation">[</span>\n          <span class="token punctuation">{</span>\n            loader<span class="token punctuation">:</span> <span class="token string">\'file-loader\'</span><span class="token punctuation">,</span>\n            options<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n              <span class="token function">name</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n                <span class="token keyword">return</span> <span class="token string">\'[name]-[hash].[ext]\'</span><span class="token punctuation">;</span>\n              <span class="token punctuation">}</span>\n            <span class="token punctuation">}</span>\n          <span class="token punctuation">}</span>\n        <span class="token punctuation">]</span>\n      <span class="token punctuation">}</span><span class="token punctuation">,</span>\n      <span class="token punctuation">{</span>\n        test<span class="token punctuation">:</span> <span class="token regex">/\\.(jpe?g|png|gif)$/</span><span class="token punctuation">,</span>\n        use<span class="token punctuation">:</span> <span class="token punctuation">[</span>\n          <span class="token punctuation">{</span>\n            loader<span class="token punctuation">:</span> <span class="token string">\'url-loader\'</span><span class="token punctuation">,</span>\n            options<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n              <span class="token comment">// Inline files smaller than 10 kB</span>\n              limit<span class="token punctuation">:</span> <span class="token number">10</span> <span class="token operator">*</span> <span class="token number">1024</span>\n            <span class="token punctuation">}</span>\n          <span class="token punctuation">}</span>\n          <span class="token comment">// {</span>\n          <span class="token comment">//   loader: \'image-webpack-loader\',</span>\n          <span class="token comment">//   options: {</span>\n          <span class="token comment">//     mozjpeg: {</span>\n          <span class="token comment">//       enabled: false,</span>\n          <span class="token comment">//       // NOTE: mozjpeg is disabled as it causes errors in some Linux environments</span>\n          <span class="token comment">//       // Try enabling it in your environment by switching the config to:</span>\n          <span class="token comment">//       // enabled: true,</span>\n          <span class="token comment">//       // progressive: true,</span>\n          <span class="token comment">//     },</span>\n          <span class="token comment">//     gifsicle: {</span>\n          <span class="token comment">//       interlaced: false,</span>\n          <span class="token comment">//     },</span>\n          <span class="token comment">//     optipng: {</span>\n          <span class="token comment">//       optimizationLevel: 7,</span>\n          <span class="token comment">//     },</span>\n          <span class="token comment">//     pngquant: {</span>\n          <span class="token comment">//       quality: \'65-90\',</span>\n          <span class="token comment">//       speed: 4,</span>\n          <span class="token comment">//     },</span>\n          <span class="token comment">//   },</span>\n          <span class="token comment">// },</span>\n        <span class="token punctuation">]</span>\n      <span class="token punctuation">}</span><span class="token punctuation">,</span>\n      <span class="token punctuation">{</span>\n        test<span class="token punctuation">:</span> <span class="token regex">/\\.html$/</span><span class="token punctuation">,</span>\n        use<span class="token punctuation">:</span> <span class="token string">\'html-loader\'</span>\n      <span class="token punctuation">}</span><span class="token punctuation">,</span>\n      <span class="token punctuation">{</span>\n        test<span class="token punctuation">:</span> <span class="token regex">/\\.md$/</span><span class="token punctuation">,</span>\n        use<span class="token punctuation">:</span> <span class="token punctuation">[</span>\n          <span class="token punctuation">{</span>\n            loader<span class="token punctuation">:</span> <span class="token string">\'html-loader\'</span>\n          <span class="token punctuation">}</span><span class="token punctuation">,</span>\n          <span class="token punctuation">{</span>\n            loader<span class="token punctuation">:</span> <span class="token string">\'markdown-loader\'</span><span class="token punctuation">,</span>\n            options<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n              gfm<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>\n              tables<span class="token punctuation">:</span> <span class="token boolean">true</span>\n              <span class="token comment">// highlight: (code) => highlight.highlightAuto(code).value,</span>\n            <span class="token punctuation">}</span>\n          <span class="token punctuation">}</span>\n        <span class="token punctuation">]</span>\n      <span class="token punctuation">}</span>\n    <span class="token punctuation">]</span>\n    <span class="token comment">// noParse: [ // 不用解析和处理的模块</span>\n    <span class="token comment">//   /special-library\\.js$/  // 用正则匹配</span>\n    <span class="token comment">// ],</span>\n  <span class="token punctuation">}</span><span class="token punctuation">,</span>\n  <span class="token comment">// externals: {</span>\n  <span class="token comment">//   // 把导入语句里的 jquery 替换成运行环境里的全局变量 jQuery</span>\n  <span class="token comment">//   jquery: \'jQuery\'</span>\n  <span class="token comment">// }</span>\n  plugins<span class="token punctuation">:</span> options<span class="token punctuation">.</span>plugins<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span><span class="token punctuation">[</span>\n    <span class="token comment">// 扩展 Webpack 功能，几乎让 Webpack 可以做任何构建相关的事情</span>\n    <span class="token comment">// new SimpleProgressWebpackPlugin(),</span>\n\n    <span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>ProvidePlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n      <span class="token comment">// make fetch available, 和 externals 一样的效果</span>\n      fetch<span class="token punctuation">:</span> <span class="token string">\'exports-loader?self.fetch!whatwg-fetch\'</span><span class="token punctuation">,</span>\n      $<span class="token punctuation">:</span> <span class="token string">\'jquery\'</span><span class="token punctuation">,</span>\n      jQuery<span class="token punctuation">:</span> <span class="token string">\'jquery\'</span>\n    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n\n    <span class="token comment">// Always expose NODE_ENV to webpack, in order to use `process.env.NODE_ENV`</span>\n    <span class="token comment">// inside your code for any environment checks; UglifyJS will automatically</span>\n    <span class="token comment">// drop any unreachable code.</span>\n    <span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>DefinePlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n      <span class="token string">\'process.env\'</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>\n        <span class="token constant">NODE_ENV</span><span class="token punctuation">:</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n        <span class="token constant">GLOBAL</span><span class="token punctuation">:</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>globalJSON <span class="token operator">||</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n        <span class="token constant">SERVER</span><span class="token punctuation">:</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">SERVER</span><span class="token punctuation">)</span>\n      <span class="token punctuation">}</span>\n    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n\n    <span class="token keyword">new</span> <span class="token class-name">CopyWebpackPlugin</span><span class="token punctuation">(</span>\n      <span class="token punctuation">[</span><span class="token string">\'app/favicon.ico\'</span><span class="token punctuation">,</span> <span class="token string">\'app/manifest.json\'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">src</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token keyword">from</span><span class="token punctuation">:</span> src<span class="token punctuation">,</span> to<span class="token punctuation">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span><span class="token function">cwd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">\'build\'</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n    <span class="token punctuation">)</span><span class="token punctuation">,</span>\n\n    <span class="token keyword">new</span> <span class="token class-name">MiniCssExtractPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n      filename<span class="token punctuation">:</span> <span class="token string">\'[name].[contenthash:8].css\'</span><span class="token punctuation">,</span>\n      chunkFilename<span class="token punctuation">:</span> <span class="token string">\'[name].[contenthash:8].css\'</span>\n    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n\n    <span class="token comment">// only load locale we need</span>\n    <span class="token comment">// https://github.com/moment/moment/issues/2517#issuecomment-185836313</span>\n    <span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>ContextReplacementPlugin</span><span class="token punctuation">(</span><span class="token regex">/moment[\\/\\\\]locale$/</span><span class="token punctuation">,</span> <span class="token regex">/zh/</span><span class="token punctuation">)</span> <span class="token comment">// eslint-disable-line</span>\n  <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n  resolve<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n    <span class="token comment">// 配置 Webpack 如何寻找模块所对应的文件</span>\n    <span class="token comment">// 配置 Webpack 去哪些目录下寻找第三方模块，配置后可以简单的引入 import \'components\'，等价于 import \'app/components\'</span>\n    modules<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">\'app\'</span><span class="token punctuation">,</span> <span class="token string">\'node_modules\'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>\n    <span class="token comment">// 通过别名来把原导入路径映射成一个新的导入路径，$ 符号来缩小范围到只命中以关键字结尾</span>\n    alias<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n      <span class="token comment">// zh-cn.js will import \'../moment\', since we are using jsnext:main, it will pack two copys of moment.</span>\n      moment$<span class="token punctuation">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span><span class="token function">cwd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">\'node_modules/moment/moment\'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n      unicorn<span class="token punctuation">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span><span class="token function">cwd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">\'unicorn\'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n      <span class="token comment">// 使用 alias 把导入 react 的语句换成直接使用单独完整的 react.production.min.js 文件，减少耗时的递归解析操作</span>\n      <span class="token comment">// 因为会影响 Tree-Shaking 去除无效代码，一般对整体性比较强的库采用本方法优化</span>\n      <span class="token comment">// 不适用一些工具类的库，如 lodash，导致输出代码中包含很多永远不会执行的代码</span>\n      react<span class="token punctuation">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span><span class="token function">cwd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">\'node_modules/react/cjs/react.production.min.js\'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n      <span class="token string">\'react-dom$\'</span><span class="token punctuation">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span><span class="token function">cwd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">\'node_modules/react-dom/cjs/react-dom.production.min.js\'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n      <span class="token string">\'react-dom/server$\'</span><span class="token punctuation">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>\n        process<span class="token punctuation">.</span><span class="token function">cwd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n        <span class="token string">\'node_modules/react-dom/cjs/react-dom-server.browser.production.min.js\'</span>\n      <span class="token punctuation">)</span>\n    <span class="token punctuation">}</span><span class="token punctuation">,</span>\n    <span class="token comment">// 在导入语句没带文件后缀时，Webpack 会自动带上后缀后去尝试访问文件是否存在</span>\n    extensions<span class="token punctuation">:</span> <span class="token punctuation">[</span>\n      <span class="token comment">// 尽可能的减少后缀尝试的可能性</span>\n      <span class="token string">\'.js\'</span>\n      <span class="token comment">// \'.jsx\',</span>\n      <span class="token comment">// \'.react.js\',</span>\n    <span class="token punctuation">]</span><span class="token punctuation">,</span>\n    <span class="token comment">// 会按照数组里的顺序去 package.json 文件里寻找，只会使用找到的第一个</span>\n    mainFields<span class="token punctuation">:</span> <span class="token punctuation">[</span>\n      <span class="token comment">// 针对 Npm 中的第三方模块优先采用 jsnext:main 中指向的 ES6 模块化语法的文件，</span>\n      <span class="token comment">// 利于 Tree Shaking/Scope Hoisting</span>\n      <span class="token comment">// 剔除 JavaScript 中用不上的死代码 / 让 Webpack 打包出来的代码文件更小、运行的更快，合并声明性的代码</span>\n      <span class="token string">\'jsnext:main\'</span><span class="token punctuation">,</span>\n      <span class="token comment">// \'browser\',</span>\n      <span class="token string">\'main\'</span> <span class="token comment">// 采用 ES5 语法的代码入口文件，尽量采用 main 字段作为入口文件描述字段，以减少搜索步骤</span>\n    <span class="token punctuation">]</span>\n  <span class="token punctuation">}</span><span class="token punctuation">,</span>\n  devtool<span class="token punctuation">:</span> options<span class="token punctuation">.</span>devtool<span class="token punctuation">,</span>\n  <span class="token comment">// 让 Webpack 构建出针对不同运行环境的代码</span>\n  target<span class="token punctuation">:</span> <span class="token string">\'web\'</span><span class="token punctuation">,</span> <span class="token comment">// Make web variables accessible to webpack, e.g. window</span>\n  performance<span class="token punctuation">:</span> options<span class="token punctuation">.</span>performance <span class="token operator">||</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>\n  <span class="token comment">// 输出文件性能检查配置</span>\n  <span class="token comment">// performance: {</span>\n  <span class="token comment">//   hints: \'warning\', // 有性能问题时输出警告</span>\n  <span class="token comment">//   hints: \'error\', // 有性能问题时输出错误</span>\n  <span class="token comment">//   hints: false, // 关闭性能检查</span>\n  <span class="token comment">//   maxAssetSize: 200000, // 最大文件大小 (单位 bytes)</span>\n  <span class="token comment">//   maxEntrypointSize: 400000, // 最大入口文件大小 (单位 bytes)</span>\n  <span class="token comment">//   assetFilter: function(assetFilename) { // 过滤要检查的文件</span>\n  <span class="token comment">//     return assetFilename.endsWith(\'.css\') || assetFilename.endsWith(\'.js\');</span>\n  <span class="token comment">//   }</span>\n  <span class="token comment">// },</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id="webpackdevbabeljs"><a href="#webpackdevbabeljs" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>webpack.dev.babel.js</h2>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="97367533669739120000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`/**\n * DEVELOPMENT WEBPACK CONFIGURATION\n */\n\nconst path = require(\'path\');\nconst fs = require(\'fs\');\nconst webpack = require(\'webpack\');\nconst HtmlWebpackPlugin = require(\'html-webpack-plugin\');\nconst CircularDependencyPlugin = require(\'circular-dependency-plugin\');\nconst logger = require(\'../../server/logger\');\nconst cheerio = require(\'cheerio\');\nconst pkg = require(path.resolve(process.cwd(), \'package.json\'));\nconst dllPlugin = pkg.dllPlugin;\n\nconst plugins = [\n  new webpack.HotModuleReplacementPlugin(), // Tell webpack we want hot reloading\n  new HtmlWebpackPlugin({\n    inject: true, // Inject all files that are generated by webpack, e.g. bundle.js\n    templateContent: templateContent() // eslint-disable-line no-use-before-define\n  }),\n  new webpack.DefinePlugin({\n    __APP__: JSON.stringify({})\n  }),\n  new CircularDependencyPlugin({\n    exclude: /a\\.js|node_modules/, // exclude node_modules\n    failOnError: false // show a warning when there is a circular dependency\n  })\n];\n\nmodule.exports = require(\'./webpack.base.babel\')({\n  mode: \'development\',\n  // Add hot reloading in development\n  // 如果 entry 是一个 string 或 array，就只会生成一个 Chunk，这时 Chunk 的名称是 main；\n  entry: [\n    \'babel-polyfill\',\n    \'eventsource-polyfill\', // Necessary for hot reloading with IE\n    \'webpack-hot-middleware/client?reload=true\',\n    path.join(process.cwd(), \'app/app.js\') // Start with js/app.js\n  ],\n\n  // Don\'t use hashes in dev mode for better performance\n  output: {\n    filename: \'[name].js\', // 配置输出文件的名称，有多个 Chunk 要输出时采用 [name].js 的写法\n    // 内置变量包括 id、name、hash、chunkhash\n    // 其中 hash 和 chunkhash 的长度是可指定的，[hash:8] 代表取 8 位 Hash 值，默认是 20 位。\n\n    // 注意 ExtractTextWebpackPlugin 插件是使用 contenthash 来代表哈希值而不是 chunkhash\n    // 原因在于 ExtractTextWebpackPlugin 提取出来的内容是代码内容本身而不是由一组模块组成的 Chunk。\n\n    // 配置无入口的 Chunk 在输出时的文件名称, 用于指定在运行过程中生成的 Chunk 在输出时的文件名称\n    // 生成 Chunk 场景有在使用 CommonChunkPlugin、使用 import(\'path/to/module\') 动态加载等时。\n    // chunkFilename 支持和 filename 一致的内置变量\n    chunkFilename: \'[name].chunk.js\'\n  },\n\n  optimization: {\n    noEmitOnErrors: true, // 跳过报错阶段\n    splitChunks: {\n      chunks: \'all\'\n    }\n  },\n\n  // Add development plugins\n  plugins: dependencyHandlers().concat(plugins), // eslint-disable-line no-use-before-define\n\n  // Tell babel that we want to hot-reload\n  babelQuery: {\n    // require.resolve solves the issue of relative presets when dealing with\n    // locally linked packages. This is an issue with babel and webpack.\n    // See https://github.com/babel/babel-loader/issues/149 and\n    // https://github.com/webpack/webpack/issues/1866\n    presets: [\'babel-preset-react-hmre\'].map(require.resolve)\n  },\n\n  // Emit a source map for easier debugging\n  // 配置 Webpack 如何生成 Source Map\n  // eval：用 eval 语句包裹需要安装的模块；\n  // source：生成独立的 Source Map 文件；\n  // hidden: JavaScript 文件中指出 Source Map 文件所在，这样浏览器就不会自动加载 Source Map；\n  // inline：把生成的 Source Map 转换成 base64 格式内嵌在 JavaScript 文件中；\n  // cheap：生成的 Source Map 中不会包含列信息，这样计算量更小，输出的 Source Map 文件更小；同时 Loader 输出的 Source Map 不会被采用；\n  // module：来自 Loader 的 Source Map 被简单处理成每行一个模块；\n\n  //在开发环境下把 devtool 设置成 cheap-module-eval-source-map，因为生成这种 Source Map 的速度最快，能加速构建。由于在开发环境下不会做代码压缩，Source Map 中即使没有列信息也不会影响断点调试；\n  // 在生产环境下把 devtool 设置成 hidden-source-map，意思是生成最详细的 Source Map，但不会把 Source Map 暴露出去。由于在生产环境下会做代码压缩，一个 JavaScript 文件只有一行，所以需要列信息。\n  devtool: \'cheap-module-eval-source-map\',\n\n  performance: {\n    hints: false\n  },\n\n  cssDebug: true\n});\n\n/**\n * Select which plugins to use to optimize the bundle\'s handling of\n * third party dependencies.\n *\n * If there is a dllPlugin key on the project\'s package.json, the\n * Webpack DLL Plugin will be used.  Otherwise the CommonsChunkPlugin\n * will be used.\n *\n */\nfunction dependencyHandlers() {\n  // Don\'t do anything during the DLL Build step\n  if (process.env.BUILDING_DLL) {\n    return [];\n  }\n\n  // If the package.json does not have a dllPlugin property, use the CommonsChunkPlugin\n  if (!dllPlugin) {\n    return [\n      new webpack.optimize.CommonsChunkPlugin({\n        name: \'vendor\',\n        children: true,\n        minChunks: 2,\n        async: true\n      })\n    ];\n  }\n\n  const dllPath = path.resolve(process.cwd(), dllPlugin.path || \'node_modules/react-boilerplate-dlls\');\n\n  /**\n   * If DLLs aren\'t explicitly defined, we assume all production dependencies listed in package.json\n   * Reminder: You need to exclude any server side dependencies by listing them in dllConfig.exclude\n   */\n  if (!dllPlugin.dlls) {\n    const manifestPath = path.resolve(dllPath, \'reactBoilerplateDeps.json\');\n\n    if (!fs.existsSync(manifestPath)) {\n      logger.error(\'The DLL manifest is missing. Please run \\`npm run build:dll\\`\');\n      process.exit(0);\n    }\n\n    return [\n      new webpack.DllReferencePlugin({\n        context: process.cwd(),\n        // 描述动态链接库的文件内容\n        manifest: require(manifestPath) // eslint-disable-line global-require\n      })\n    ];\n  }\n\n  // If DLLs are explicitly defined, we automatically create a DLLReferencePlugin for each of them.\n  const dllManifests = Object.keys(dllPlugin.dlls).map((name) => path.join(dllPath, \\`/\\${name}.json\\`));\n\n  return dllManifests.map((manifestPath) => {\n    if (!fs.existsSync(path)) {\n      if (!fs.existsSync(manifestPath)) {\n        logger.error(\\`The following Webpack DLL manifest is missing: \\${path.basename(manifestPath)}\\`);\n        logger.error(\\`Expected to find it in \\${dllPath}\\`);\n        logger.error(\'Please run: npm run build:dll\');\n\n        process.exit(0);\n      }\n    }\n\n    return new webpack.DllReferencePlugin({\n      context: process.cwd(),\n      manifest: require(manifestPath) // eslint-disable-line global-require\n    });\n  });\n}\n\n/**\n * We dynamically generate the HTML content in development so that the different\n * DLL Javascript files are loaded in script tags and available to our application.\n */\nfunction templateContent() {\n  const html = fs.readFileSync(path.resolve(process.cwd(), \'app/index.html\')).toString();\n\n  if (!dllPlugin) {\n    return html;\n  }\n\n  const doc = cheerio(html);\n  const body = doc.find(\'body\');\n  const dllNames = !dllPlugin.dlls ? [\'reactBoilerplateDeps\'] : Object.keys(dllPlugin.dlls);\n\n  dllNames.forEach((dllName) => body.append(\\`<script data-dll=\'true\' src=\'/\\${dllName}.dll.js\'></script>\\`));\n\n  return doc.toString();\n}`, `97367533669739120000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                js 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">/**\n * DEVELOPMENT WEBPACK CONFIGURATION\n */</span>\n\n<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'path\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'fs\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">const</span> webpack <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'webpack\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">const</span> HtmlWebpackPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'html-webpack-plugin\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">const</span> CircularDependencyPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'circular-dependency-plugin\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">const</span> logger <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'../../server/logger\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">const</span> cheerio <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'cheerio\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">const</span> pkg <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span><span class="token function">cwd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">\'package.json\'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">const</span> dllPlugin <span class="token operator">=</span> pkg<span class="token punctuation">.</span>dllPlugin<span class="token punctuation">;</span>\n\n<span class="token keyword">const</span> plugins <span class="token operator">=</span> <span class="token punctuation">[</span>\n  <span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>HotModuleReplacementPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// Tell webpack we want hot reloading</span>\n  <span class="token keyword">new</span> <span class="token class-name">HtmlWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n    inject<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// Inject all files that are generated by webpack, e.g. bundle.js</span>\n    templateContent<span class="token punctuation">:</span> <span class="token function">templateContent</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// eslint-disable-line no-use-before-define</span>\n  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n  <span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>DefinePlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n    __APP__<span class="token punctuation">:</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>\n  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n  <span class="token keyword">new</span> <span class="token class-name">CircularDependencyPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n    exclude<span class="token punctuation">:</span> <span class="token regex">/a\\.js|node_modules/</span><span class="token punctuation">,</span> <span class="token comment">// exclude node_modules</span>\n    failOnError<span class="token punctuation">:</span> <span class="token boolean">false</span> <span class="token comment">// show a warning when there is a circular dependency</span>\n  <span class="token punctuation">}</span><span class="token punctuation">)</span>\n<span class="token punctuation">]</span><span class="token punctuation">;</span>\n\nmodule<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'./webpack.base.babel\'</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n  mode<span class="token punctuation">:</span> <span class="token string">\'development\'</span><span class="token punctuation">,</span>\n  <span class="token comment">// Add hot reloading in development</span>\n  <span class="token comment">// 如果 entry 是一个 string 或 array，就只会生成一个 Chunk，这时 Chunk 的名称是 main；</span>\n  entry<span class="token punctuation">:</span> <span class="token punctuation">[</span>\n    <span class="token string">\'babel-polyfill\'</span><span class="token punctuation">,</span>\n    <span class="token string">\'eventsource-polyfill\'</span><span class="token punctuation">,</span> <span class="token comment">// Necessary for hot reloading with IE</span>\n    <span class="token string">\'webpack-hot-middleware/client?reload=true\'</span><span class="token punctuation">,</span>\n    path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span><span class="token function">cwd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">\'app/app.js\'</span><span class="token punctuation">)</span> <span class="token comment">// Start with js/app.js</span>\n  <span class="token punctuation">]</span><span class="token punctuation">,</span>\n\n  <span class="token comment">// Don\'t use hashes in dev mode for better performance</span>\n  output<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n    filename<span class="token punctuation">:</span> <span class="token string">\'[name].js\'</span><span class="token punctuation">,</span> <span class="token comment">// 配置输出文件的名称，有多个 Chunk 要输出时采用 [name].js 的写法</span>\n    <span class="token comment">// 内置变量包括 id、name、hash、chunkhash</span>\n    <span class="token comment">// 其中 hash 和 chunkhash 的长度是可指定的，[hash:8] 代表取 8 位 Hash 值，默认是 20 位。</span>\n\n    <span class="token comment">// 注意 ExtractTextWebpackPlugin 插件是使用 contenthash 来代表哈希值而不是 chunkhash</span>\n    <span class="token comment">// 原因在于 ExtractTextWebpackPlugin 提取出来的内容是代码内容本身而不是由一组模块组成的 Chunk。</span>\n\n    <span class="token comment">// 配置无入口的 Chunk 在输出时的文件名称, 用于指定在运行过程中生成的 Chunk 在输出时的文件名称</span>\n    <span class="token comment">// 生成 Chunk 场景有在使用 CommonChunkPlugin、使用 import(\'path/to/module\') 动态加载等时。</span>\n    <span class="token comment">// chunkFilename 支持和 filename 一致的内置变量</span>\n    chunkFilename<span class="token punctuation">:</span> <span class="token string">\'[name].chunk.js\'</span>\n  <span class="token punctuation">}</span><span class="token punctuation">,</span>\n\n  optimization<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n    noEmitOnErrors<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 跳过报错阶段</span>\n    splitChunks<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n      chunks<span class="token punctuation">:</span> <span class="token string">\'all\'</span>\n    <span class="token punctuation">}</span>\n  <span class="token punctuation">}</span><span class="token punctuation">,</span>\n\n  <span class="token comment">// Add development plugins</span>\n  plugins<span class="token punctuation">:</span> <span class="token function">dependencyHandlers</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>plugins<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// eslint-disable-line no-use-before-define</span>\n\n  <span class="token comment">// Tell babel that we want to hot-reload</span>\n  babelQuery<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n    <span class="token comment">// require.resolve solves the issue of relative presets when dealing with</span>\n    <span class="token comment">// locally linked packages. This is an issue with babel and webpack.</span>\n    <span class="token comment">// See https://github.com/babel/babel-loader/issues/149 and</span>\n    <span class="token comment">// https://github.com/webpack/webpack/issues/1866</span>\n    presets<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">\'babel-preset-react-hmre\'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>require<span class="token punctuation">.</span>resolve<span class="token punctuation">)</span>\n  <span class="token punctuation">}</span><span class="token punctuation">,</span>\n\n  <span class="token comment">// Emit a source map for easier debugging</span>\n  <span class="token comment">// 配置 Webpack 如何生成 Source Map</span>\n  <span class="token comment">// eval：用 eval 语句包裹需要安装的模块；</span>\n  <span class="token comment">// source：生成独立的 Source Map 文件；</span>\n  <span class="token comment">// hidden: JavaScript 文件中指出 Source Map 文件所在，这样浏览器就不会自动加载 Source Map；</span>\n  <span class="token comment">// inline：把生成的 Source Map 转换成 base64 格式内嵌在 JavaScript 文件中；</span>\n  <span class="token comment">// cheap：生成的 Source Map 中不会包含列信息，这样计算量更小，输出的 Source Map 文件更小；同时 Loader 输出的 Source Map 不会被采用；</span>\n  <span class="token comment">// module：来自 Loader 的 Source Map 被简单处理成每行一个模块；</span>\n\n  <span class="token comment">//在开发环境下把 devtool 设置成 cheap-module-eval-source-map，因为生成这种 Source Map 的速度最快，能加速构建。由于在开发环境下不会做代码压缩，Source Map 中即使没有列信息也不会影响断点调试；</span>\n  <span class="token comment">// 在生产环境下把 devtool 设置成 hidden-source-map，意思是生成最详细的 Source Map，但不会把 Source Map 暴露出去。由于在生产环境下会做代码压缩，一个 JavaScript 文件只有一行，所以需要列信息。</span>\n  devtool<span class="token punctuation">:</span> <span class="token string">\'cheap-module-eval-source-map\'</span><span class="token punctuation">,</span>\n\n  performance<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n    hints<span class="token punctuation">:</span> <span class="token boolean">false</span>\n  <span class="token punctuation">}</span><span class="token punctuation">,</span>\n\n  cssDebug<span class="token punctuation">:</span> <span class="token boolean">true</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token comment">/**\n * Select which plugins to use to optimize the bundle\'s handling of\n * third party dependencies.\n *\n * If there is a dllPlugin key on the project\'s package.json, the\n * Webpack DLL Plugin will be used.  Otherwise the CommonsChunkPlugin\n * will be used.\n *\n */</span>\n<span class="token keyword">function</span> <span class="token function">dependencyHandlers</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token comment">// Don\'t do anything during the DLL Build step</span>\n  <span class="token keyword">if</span> <span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">BUILDING_DLL</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n\n  <span class="token comment">// If the package.json does not have a dllPlugin property, use the CommonsChunkPlugin</span>\n  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>dllPlugin<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">return</span> <span class="token punctuation">[</span>\n      <span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>optimize<span class="token punctuation">.</span>CommonsChunkPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n        name<span class="token punctuation">:</span> <span class="token string">\'vendor\'</span><span class="token punctuation">,</span>\n        children<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>\n        minChunks<span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span>\n        async<span class="token punctuation">:</span> <span class="token boolean">true</span>\n      <span class="token punctuation">}</span><span class="token punctuation">)</span>\n    <span class="token punctuation">]</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n\n  <span class="token keyword">const</span> dllPath <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span><span class="token function">cwd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> dllPlugin<span class="token punctuation">.</span>path <span class="token operator">||</span> <span class="token string">\'node_modules/react-boilerplate-dlls\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n  <span class="token comment">/**\n   * If DLLs aren\'t explicitly defined, we assume all production dependencies listed in package.json\n   * Reminder: You need to exclude any server side dependencies by listing them in dllConfig.exclude\n   */</span>\n  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>dllPlugin<span class="token punctuation">.</span>dlls<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">const</span> manifestPath <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>dllPath<span class="token punctuation">,</span> <span class="token string">\'reactBoilerplateDeps.json\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>fs<span class="token punctuation">.</span><span class="token function">existsSync</span><span class="token punctuation">(</span>manifestPath<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      logger<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">\'The DLL manifest is missing. Please run `npm run build:dll`\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n      process<span class="token punctuation">.</span><span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n\n    <span class="token keyword">return</span> <span class="token punctuation">[</span>\n      <span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>DllReferencePlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n        context<span class="token punctuation">:</span> process<span class="token punctuation">.</span><span class="token function">cwd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n        <span class="token comment">// 描述动态链接库的文件内容</span>\n        manifest<span class="token punctuation">:</span> <span class="token function">require</span><span class="token punctuation">(</span>manifestPath<span class="token punctuation">)</span> <span class="token comment">// eslint-disable-line global-require</span>\n      <span class="token punctuation">}</span><span class="token punctuation">)</span>\n    <span class="token punctuation">]</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n\n  <span class="token comment">// If DLLs are explicitly defined, we automatically create a DLLReferencePlugin for each of them.</span>\n  <span class="token keyword">const</span> dllManifests <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>dllPlugin<span class="token punctuation">.</span>dlls<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token operator">=></span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>dllPath<span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">.json</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n  <span class="token keyword">return</span> dllManifests<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">manifestPath</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>fs<span class="token punctuation">.</span><span class="token function">existsSync</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>fs<span class="token punctuation">.</span><span class="token function">existsSync</span><span class="token punctuation">(</span>manifestPath<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        logger<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">The following Webpack DLL manifest is missing: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>path<span class="token punctuation">.</span><span class="token function">basename</span><span class="token punctuation">(</span>manifestPath<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n        logger<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Expected to find it in </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>dllPath<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n        logger<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">\'Please run: npm run build:dll\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n        process<span class="token punctuation">.</span><span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span>\n    <span class="token punctuation">}</span>\n\n    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>DllReferencePlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n      context<span class="token punctuation">:</span> process<span class="token punctuation">.</span><span class="token function">cwd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n      manifest<span class="token punctuation">:</span> <span class="token function">require</span><span class="token punctuation">(</span>manifestPath<span class="token punctuation">)</span> <span class="token comment">// eslint-disable-line global-require</span>\n    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token comment">/**\n * We dynamically generate the HTML content in development so that the different\n * DLL Javascript files are loaded in script tags and available to our application.\n */</span>\n<span class="token keyword">function</span> <span class="token function">templateContent</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">const</span> html <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">readFileSync</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span><span class="token function">cwd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">\'app/index.html\'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>dllPlugin<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">return</span> html<span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n\n  <span class="token keyword">const</span> doc <span class="token operator">=</span> <span class="token function">cheerio</span><span class="token punctuation">(</span>html<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token keyword">const</span> body <span class="token operator">=</span> doc<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token string">\'body\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token keyword">const</span> dllNames <span class="token operator">=</span> <span class="token operator">!</span>dllPlugin<span class="token punctuation">.</span>dlls <span class="token operator">?</span> <span class="token punctuation">[</span><span class="token string">\'reactBoilerplateDeps\'</span><span class="token punctuation">]</span> <span class="token punctuation">:</span> Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>dllPlugin<span class="token punctuation">.</span>dlls<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n  dllNames<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">dllName</span><span class="token punctuation">)</span> <span class="token operator">=></span> body<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">&lt;script data-dll=\'true\' src=\'/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>dllName<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">.dll.js\'>&lt;/script></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n  <span class="token keyword">return</span> doc<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id="webpackdllbabeljs"><a href="#webpackdllbabeljs" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>webpack.dll.babel.js</h2>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="69927556193145455000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`/**\n * WEBPACK DLL GENERATOR\n *\n * This profile is used to cache webpack\'s module\n * contexts for external library and framework type\n * dependencies which will usually not change often enough\n * to warrant building them from scratch every time we use\n * the webpack process.\n */\n\nconst { join } = require(\'path\');\nconst defaults = require(\'lodash/defaultsDeep\');\nconst webpack = require(\'webpack\');\nconst pkg = require(join(process.cwd(), \'package.json\'));\nconst dllPlugin = require(\'../config\').dllPlugin;\n\nif (!pkg.dllPlugin) {\n  process.exit(0);\n}\n\nconst dllConfig = defaults(pkg.dllPlugin, dllPlugin.defaults);\nconst outputPath = join(process.cwd(), dllConfig.path);\n\nmodule.exports = require(\'./webpack.base.babel\')({\n  mode: \'development\',\n  context: process.cwd(),\n  entry: dllConfig.dlls ? dllConfig.dlls : dllPlugin.entry(pkg),\n  devtool: \'eval\',\n  output: {\n    filename: \'[name].dll.js\', // 输出的动态链接库的文件名称，[name] 代表当前动态链接库的名称\n    path: outputPath,\n    library: \'[name]\' // 存放动态链接库的全局变量名称，例如对应 react 来说就是 _dll_react\n  },\n  plugins: [\n    new webpack.DllPlugin({\n      // 动态链接库的全局变量名称，需要和 output.library 中保持一致\n      // 该字段的值也就是输出的 [name].json 文件 中 name 字段的值\n      // 在 webpack.dev.babel.js 文件中 DllReferencePlugin 会去 [name].json 文件读取 name 字段的值\n      // 把值的内容作为在从全局变量中获取动态链接库中内容时的全局变量名\n      name: \'[name]\',\n      // 描述动态链接库的 manifest.json 文件输出时的文件名称\n      path: join(outputPath, \'[name].json\')\n    }) // eslint-disable-line no-new\n  ],\n  performance: {\n    hints: false\n  }\n});`, `69927556193145455000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                js 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">/**\n * WEBPACK DLL GENERATOR\n *\n * This profile is used to cache webpack\'s module\n * contexts for external library and framework type\n * dependencies which will usually not change often enough\n * to warrant building them from scratch every time we use\n * the webpack process.\n */</span>\n\n<span class="token keyword">const</span> <span class="token punctuation">{</span> join <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'path\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">const</span> defaults <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'lodash/defaultsDeep\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">const</span> webpack <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'webpack\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">const</span> pkg <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token function">join</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span><span class="token function">cwd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">\'package.json\'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">const</span> dllPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'../config\'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>dllPlugin<span class="token punctuation">;</span>\n\n<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>pkg<span class="token punctuation">.</span>dllPlugin<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  process<span class="token punctuation">.</span><span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">const</span> dllConfig <span class="token operator">=</span> <span class="token function">defaults</span><span class="token punctuation">(</span>pkg<span class="token punctuation">.</span>dllPlugin<span class="token punctuation">,</span> dllPlugin<span class="token punctuation">.</span>defaults<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">const</span> outputPath <span class="token operator">=</span> <span class="token function">join</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span><span class="token function">cwd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> dllConfig<span class="token punctuation">.</span>path<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\nmodule<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'./webpack.base.babel\'</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n  mode<span class="token punctuation">:</span> <span class="token string">\'development\'</span><span class="token punctuation">,</span>\n  context<span class="token punctuation">:</span> process<span class="token punctuation">.</span><span class="token function">cwd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n  entry<span class="token punctuation">:</span> dllConfig<span class="token punctuation">.</span>dlls <span class="token operator">?</span> dllConfig<span class="token punctuation">.</span>dlls <span class="token punctuation">:</span> dllPlugin<span class="token punctuation">.</span><span class="token function">entry</span><span class="token punctuation">(</span>pkg<span class="token punctuation">)</span><span class="token punctuation">,</span>\n  devtool<span class="token punctuation">:</span> <span class="token string">\'eval\'</span><span class="token punctuation">,</span>\n  output<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n    filename<span class="token punctuation">:</span> <span class="token string">\'[name].dll.js\'</span><span class="token punctuation">,</span> <span class="token comment">// 输出的动态链接库的文件名称，[name] 代表当前动态链接库的名称</span>\n    path<span class="token punctuation">:</span> outputPath<span class="token punctuation">,</span>\n    library<span class="token punctuation">:</span> <span class="token string">\'[name]\'</span> <span class="token comment">// 存放动态链接库的全局变量名称，例如对应 react 来说就是 _dll_react</span>\n  <span class="token punctuation">}</span><span class="token punctuation">,</span>\n  plugins<span class="token punctuation">:</span> <span class="token punctuation">[</span>\n    <span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>DllPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n      <span class="token comment">// 动态链接库的全局变量名称，需要和 output.library 中保持一致</span>\n      <span class="token comment">// 该字段的值也就是输出的 [name].json 文件 中 name 字段的值</span>\n      <span class="token comment">// 在 webpack.dev.babel.js 文件中 DllReferencePlugin 会去 [name].json 文件读取 name 字段的值</span>\n      <span class="token comment">// 把值的内容作为在从全局变量中获取动态链接库中内容时的全局变量名</span>\n      name<span class="token punctuation">:</span> <span class="token string">\'[name]\'</span><span class="token punctuation">,</span>\n      <span class="token comment">// 描述动态链接库的 manifest.json 文件输出时的文件名称</span>\n      path<span class="token punctuation">:</span> <span class="token function">join</span><span class="token punctuation">(</span>outputPath<span class="token punctuation">,</span> <span class="token string">\'[name].json\'</span><span class="token punctuation">)</span>\n    <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment">// eslint-disable-line no-new</span>\n  <span class="token punctuation">]</span><span class="token punctuation">,</span>\n  performance<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n    hints<span class="token punctuation">:</span> <span class="token boolean">false</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id="webpackprodbabeljs"><a href="#webpackprodbabeljs" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>webpack.prod.babel.js</h2>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="54203543909866370000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// Important modules this config uses\nconst path = require(\'path\');\nconst webpack = require(\'webpack\');\nconst HtmlWebpackPlugin = require(\'html-webpack-plugin\');\nconst UglifyJsPlugin = require(\'uglifyjs-webpack-plugin\');\nconst OptimizeCSSAssetsPlugin = require(\'optimize-css-assets-webpack-plugin\');\nconst LodashModuleReplacementPlugin = require(\'lodash-webpack-plugin\');\n\nmodule.exports = require(\'./webpack.base.babel\')({\n  mode: \'production\',\n  // In production, we skip all hot-reloading stuff\n  // 如果 entry 是一个 object，就可能会出现多个 Chunk，这时 Chunk 的名称是 object 键值对里键的名称。\n  entry: {\n    main: [\'babel-polyfill\', \'raf/polyfill\', path.join(process.cwd(), \'app/app.js\')],\n    draft: [\'draft-js\', \'draft-js-plugins-editor\', \'draft-js-mention-plugin\', \'draft-convert\'],\n    \'react-player\': [\'react-player\']\n  },\n  babelOptions: {\n    // babel-loader 的参数，用于缓存 babel 编译结果加快重新编译速度\n    cacheDirectory: true\n  },\n  // Utilize long-term caching by adding content hashes (not compilation hashes) to compiled assets\n  output: {\n    // 根据文件内容 hash 值生成文件名称，用于浏览器长时间缓存文件\n    filename: \'[name].[chunkhash].js\',\n    chunkFilename: \'[name].[chunkhash].chunk.js\'\n  },\n\n  optimization: {\n    minimize: true,\n    minimizer: [\n      new UglifyJsPlugin({\n        cache: true,\n        parallel: true,\n        sourceMap: false,\n        // 多嵌套了一层\n        uglifyOptions: {\n          mangle: true,\n          compress: {\n            // 在 UglifyJs 删除没有用到的代码时不输出警告\n            warnings: false,\n            // 删除所有的 \\`console\\` 语句，可以兼容 ie 浏览器\n            drop_console: true,\n            // 内嵌定义了但是只用到一次的变量\n            collapse_vars: true,\n            // 提取出出现多次但是没有定义成变量去引用的静态值\n            reduce_vars: true\n          },\n          output: {\n            // 最紧凑的输出\n            beautify: false,\n            // 删除所有的注释\n            comments: false\n          }\n        }\n      }),\n      new OptimizeCSSAssetsPlugin()\n    ],\n    // Scope Hoisting\n    // 分析出模块之间的依赖关系，尽可能的把打散的模块合并到一个函数中去，但前提是不能造成代码冗余。\n    // 因此只有那些被引用了一次的模块才能被合并。\n    concatenateModules: true,\n    splitChunks: {\n      // splitChunks、runtimeChunk 代替 webpack1~3 原有的 commonsChunkPlugin 的方法\n      // 这里设置 initial 时首页为 777k，跳转到任务中心 204k\n      // 未升级前首页为 739k，跳转到任务中心 201k\n      // 设置为 all 时，首页为 1.1M，跳转到任务中心 18.7k\n      // chunks: \'initial\', // 可填 async, initial, all. 顾名思义，async 针对异步加载的 chunk 做切割，initial 针对初始 chunk，all 针对所有 chunk\n      // minSize: 30000, // 切割完要生成的新 chunk 要>30kb，否则不生成新 chunk\n      // minChunks: 2, // 共享该 module 的最小 chunk 数\n      // maxAsyncRequests: 2, // 最多有 5 个异步加载请求该 module\n      // maxInitialRequests: 5, // 初始化的时候最多有 4 个请求该 module\n      // automaticNameDelimiter: \'-\', // 名字中间的间隔符\n      // name: true, // chunk 的名字，如果设成 true，会根据被提取的 chunk 自动生成\n      // 优化原则：保持最大重用性，首页提取 node_modules 所有的公共库导致加载时间较长\n      // 后续加载很快\n      cacheGroups: {\n        default: false,\n        // vendors: false,\n        draft: {\n          test: \'draft\',\n          name: \'draft\',\n          chunks: \'async\',\n          priority: 3 // 该配置项是设置处理的优先级，数值越大越优先处理\n        },\n        \'react-player\': {\n          test: \'react-player\',\n          name: \'react-player\',\n          chunks: \'async\',\n          priority: 2 // 该配置项是设置处理的优先级，数值越大越优先处理\n        },\n        vendors: {\n          test: /[\\\\/]node_modules[\\\\/]/,\n          name: \'vendors\',\n          chunks: \'all\',\n          priority: 1 // 该配置项是设置处理的优先级，数值越大越优先处理\n        },\n        common: {\n          name: \'common\',\n          minChunks: 2,\n          priority: -1,\n          chunks: \'all\',\n          reuseExistingChunk: true // 这个配置允许我们使用已经存在的代码块\n        }\n        // polyfill: {\n        //   test: \'polyfill\', // 用来决定提取哪些 module，可以接受字符串，正则表达式，或者函数，函数的一个参数为 module，第二个参数为引用这个 module 的 chunk(数组)\n        //   name: \'polyfill\',\n        //   // reuseExistingChunk // 当 module 未变时，是否可以使用之前的 chunk\n        // },\n        // vendor: {\n        //   test: \'vendor\',\n        //   name: \'vendor\',\n        // },\n        // styles: {\n        //   name: \'styles\',\n        //   test: /\\.css\\$/,\n        //   chunks: \'all\',\n        // },\n        // styles: {\n        //   name: \'styles\',\n        //   test: /\\.css\\$/,\n        //   chunks: \'all\',\n        //   enforce: true,\n        //   priority: 20,\n        // },\n      }\n    },\n    runtimeChunk: {\n      name: \'manifest\'\n    }\n  },\n\n  plugins: [\n    new LodashModuleReplacementPlugin(), // lodash 优化由 592.53k 到 240k\n    // 实现 chunkhash 的稳定化\n    new webpack.HashedModuleIdsPlugin(),\n    // Minify and optimize the index.html\n    new HtmlWebpackPlugin({\n      template: \'app/index.html\',\n      minify: {\n        removeComments: true,\n        collapseWhitespace: true,\n        removeRedundantAttributes: true,\n        useShortDoctype: true,\n        removeEmptyAttributes: true,\n        removeStyleLinkTypeAttributes: true,\n        keepClosingSlash: true,\n        minifyJS: true,\n        minifyCSS: true,\n        minifyURLs: true\n      },\n      inject: true\n    })\n  ],\n\n  performance: {\n    assetFilter: (assetFilename) => !/(\\.map\\$)|(^(main\\.|favicon\\.))/.test(assetFilename)\n  }\n});`, `54203543909866370000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                js 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// Important modules this config uses</span>\n<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'path\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">const</span> webpack <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'webpack\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">const</span> HtmlWebpackPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'html-webpack-plugin\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">const</span> UglifyJsPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'uglifyjs-webpack-plugin\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">const</span> OptimizeCSSAssetsPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'optimize-css-assets-webpack-plugin\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">const</span> LodashModuleReplacementPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'lodash-webpack-plugin\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\nmodule<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'./webpack.base.babel\'</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n  mode<span class="token punctuation">:</span> <span class="token string">\'production\'</span><span class="token punctuation">,</span>\n  <span class="token comment">// In production, we skip all hot-reloading stuff</span>\n  <span class="token comment">// 如果 entry 是一个 object，就可能会出现多个 Chunk，这时 Chunk 的名称是 object 键值对里键的名称。</span>\n  entry<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n    main<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">\'babel-polyfill\'</span><span class="token punctuation">,</span> <span class="token string">\'raf/polyfill\'</span><span class="token punctuation">,</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span><span class="token function">cwd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">\'app/app.js\'</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>\n    draft<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">\'draft-js\'</span><span class="token punctuation">,</span> <span class="token string">\'draft-js-plugins-editor\'</span><span class="token punctuation">,</span> <span class="token string">\'draft-js-mention-plugin\'</span><span class="token punctuation">,</span> <span class="token string">\'draft-convert\'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>\n    <span class="token string">\'react-player\'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">\'react-player\'</span><span class="token punctuation">]</span>\n  <span class="token punctuation">}</span><span class="token punctuation">,</span>\n  babelOptions<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n    <span class="token comment">// babel-loader 的参数，用于缓存 babel 编译结果加快重新编译速度</span>\n    cacheDirectory<span class="token punctuation">:</span> <span class="token boolean">true</span>\n  <span class="token punctuation">}</span><span class="token punctuation">,</span>\n  <span class="token comment">// Utilize long-term caching by adding content hashes (not compilation hashes) to compiled assets</span>\n  output<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n    <span class="token comment">// 根据文件内容 hash 值生成文件名称，用于浏览器长时间缓存文件</span>\n    filename<span class="token punctuation">:</span> <span class="token string">\'[name].[chunkhash].js\'</span><span class="token punctuation">,</span>\n    chunkFilename<span class="token punctuation">:</span> <span class="token string">\'[name].[chunkhash].chunk.js\'</span>\n  <span class="token punctuation">}</span><span class="token punctuation">,</span>\n\n  optimization<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n    minimize<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>\n    minimizer<span class="token punctuation">:</span> <span class="token punctuation">[</span>\n      <span class="token keyword">new</span> <span class="token class-name">UglifyJsPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n        cache<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>\n        parallel<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>\n        sourceMap<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>\n        <span class="token comment">// 多嵌套了一层</span>\n        uglifyOptions<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n          mangle<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>\n          compress<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n            <span class="token comment">// 在 UglifyJs 删除没有用到的代码时不输出警告</span>\n            warnings<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>\n            <span class="token comment">// 删除所有的 `console` 语句，可以兼容 ie 浏览器</span>\n            drop_console<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>\n            <span class="token comment">// 内嵌定义了但是只用到一次的变量</span>\n            collapse_vars<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>\n            <span class="token comment">// 提取出出现多次但是没有定义成变量去引用的静态值</span>\n            reduce_vars<span class="token punctuation">:</span> <span class="token boolean">true</span>\n          <span class="token punctuation">}</span><span class="token punctuation">,</span>\n          output<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n            <span class="token comment">// 最紧凑的输出</span>\n            beautify<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>\n            <span class="token comment">// 删除所有的注释</span>\n            comments<span class="token punctuation">:</span> <span class="token boolean">false</span>\n          <span class="token punctuation">}</span>\n        <span class="token punctuation">}</span>\n      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n      <span class="token keyword">new</span> <span class="token class-name">OptimizeCSSAssetsPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n    <span class="token punctuation">]</span><span class="token punctuation">,</span>\n    <span class="token comment">// Scope Hoisting</span>\n    <span class="token comment">// 分析出模块之间的依赖关系，尽可能的把打散的模块合并到一个函数中去，但前提是不能造成代码冗余。</span>\n    <span class="token comment">// 因此只有那些被引用了一次的模块才能被合并。</span>\n    concatenateModules<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>\n    splitChunks<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n      <span class="token comment">// splitChunks、runtimeChunk 代替 webpack1~3 原有的 commonsChunkPlugin 的方法</span>\n      <span class="token comment">// 这里设置 initial 时首页为 777k，跳转到任务中心 204k</span>\n      <span class="token comment">// 未升级前首页为 739k，跳转到任务中心 201k</span>\n      <span class="token comment">// 设置为 all 时，首页为 1.1M，跳转到任务中心 18.7k</span>\n      <span class="token comment">// chunks: \'initial\', // 可填 async, initial, all. 顾名思义，async 针对异步加载的 chunk 做切割，initial 针对初始 chunk，all 针对所有 chunk</span>\n      <span class="token comment">// minSize: 30000, // 切割完要生成的新 chunk 要>30kb，否则不生成新 chunk</span>\n      <span class="token comment">// minChunks: 2, // 共享该 module 的最小 chunk 数</span>\n      <span class="token comment">// maxAsyncRequests: 2, // 最多有 5 个异步加载请求该 module</span>\n      <span class="token comment">// maxInitialRequests: 5, // 初始化的时候最多有 4 个请求该 module</span>\n      <span class="token comment">// automaticNameDelimiter: \'-\', // 名字中间的间隔符</span>\n      <span class="token comment">// name: true, // chunk 的名字，如果设成 true，会根据被提取的 chunk 自动生成</span>\n      <span class="token comment">// 优化原则：保持最大重用性，首页提取 node_modules 所有的公共库导致加载时间较长</span>\n      <span class="token comment">// 后续加载很快</span>\n      cacheGroups<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n        <span class="token keyword">default</span><span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>\n        <span class="token comment">// vendors: false,</span>\n        draft<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n          test<span class="token punctuation">:</span> <span class="token string">\'draft\'</span><span class="token punctuation">,</span>\n          name<span class="token punctuation">:</span> <span class="token string">\'draft\'</span><span class="token punctuation">,</span>\n          chunks<span class="token punctuation">:</span> <span class="token string">\'async\'</span><span class="token punctuation">,</span>\n          priority<span class="token punctuation">:</span> <span class="token number">3</span> <span class="token comment">// 该配置项是设置处理的优先级，数值越大越优先处理</span>\n        <span class="token punctuation">}</span><span class="token punctuation">,</span>\n        <span class="token string">\'react-player\'</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>\n          test<span class="token punctuation">:</span> <span class="token string">\'react-player\'</span><span class="token punctuation">,</span>\n          name<span class="token punctuation">:</span> <span class="token string">\'react-player\'</span><span class="token punctuation">,</span>\n          chunks<span class="token punctuation">:</span> <span class="token string">\'async\'</span><span class="token punctuation">,</span>\n          priority<span class="token punctuation">:</span> <span class="token number">2</span> <span class="token comment">// 该配置项是设置处理的优先级，数值越大越优先处理</span>\n        <span class="token punctuation">}</span><span class="token punctuation">,</span>\n        vendors<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n          test<span class="token punctuation">:</span> <span class="token regex">/[\\\\/]node_modules[\\\\/]/</span><span class="token punctuation">,</span>\n          name<span class="token punctuation">:</span> <span class="token string">\'vendors\'</span><span class="token punctuation">,</span>\n          chunks<span class="token punctuation">:</span> <span class="token string">\'all\'</span><span class="token punctuation">,</span>\n          priority<span class="token punctuation">:</span> <span class="token number">1</span> <span class="token comment">// 该配置项是设置处理的优先级，数值越大越优先处理</span>\n        <span class="token punctuation">}</span><span class="token punctuation">,</span>\n        common<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n          name<span class="token punctuation">:</span> <span class="token string">\'common\'</span><span class="token punctuation">,</span>\n          minChunks<span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span>\n          priority<span class="token punctuation">:</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>\n          chunks<span class="token punctuation">:</span> <span class="token string">\'all\'</span><span class="token punctuation">,</span>\n          reuseExistingChunk<span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token comment">// 这个配置允许我们使用已经存在的代码块</span>\n        <span class="token punctuation">}</span>\n        <span class="token comment">// polyfill: {</span>\n        <span class="token comment">//   test: \'polyfill\', // 用来决定提取哪些 module，可以接受字符串，正则表达式，或者函数，函数的一个参数为 module，第二个参数为引用这个 module 的 chunk(数组)</span>\n        <span class="token comment">//   name: \'polyfill\',</span>\n        <span class="token comment">//   // reuseExistingChunk // 当 module 未变时，是否可以使用之前的 chunk</span>\n        <span class="token comment">// },</span>\n        <span class="token comment">// vendor: {</span>\n        <span class="token comment">//   test: \'vendor\',</span>\n        <span class="token comment">//   name: \'vendor\',</span>\n        <span class="token comment">// },</span>\n        <span class="token comment">// styles: {</span>\n        <span class="token comment">//   name: \'styles\',</span>\n        <span class="token comment">//   test: /\\.css$/,</span>\n        <span class="token comment">//   chunks: \'all\',</span>\n        <span class="token comment">// },</span>\n        <span class="token comment">// styles: {</span>\n        <span class="token comment">//   name: \'styles\',</span>\n        <span class="token comment">//   test: /\\.css$/,</span>\n        <span class="token comment">//   chunks: \'all\',</span>\n        <span class="token comment">//   enforce: true,</span>\n        <span class="token comment">//   priority: 20,</span>\n        <span class="token comment">// },</span>\n      <span class="token punctuation">}</span>\n    <span class="token punctuation">}</span><span class="token punctuation">,</span>\n    runtimeChunk<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n      name<span class="token punctuation">:</span> <span class="token string">\'manifest\'</span>\n    <span class="token punctuation">}</span>\n  <span class="token punctuation">}</span><span class="token punctuation">,</span>\n\n  plugins<span class="token punctuation">:</span> <span class="token punctuation">[</span>\n    <span class="token keyword">new</span> <span class="token class-name">LodashModuleReplacementPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// lodash 优化由 592.53k 到 240k</span>\n    <span class="token comment">// 实现 chunkhash 的稳定化</span>\n    <span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>HashedModuleIdsPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n    <span class="token comment">// Minify and optimize the index.html</span>\n    <span class="token keyword">new</span> <span class="token class-name">HtmlWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n      template<span class="token punctuation">:</span> <span class="token string">\'app/index.html\'</span><span class="token punctuation">,</span>\n      minify<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n        removeComments<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>\n        collapseWhitespace<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>\n        removeRedundantAttributes<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>\n        useShortDoctype<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>\n        removeEmptyAttributes<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>\n        removeStyleLinkTypeAttributes<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>\n        keepClosingSlash<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>\n        minifyJS<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>\n        minifyCSS<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>\n        minifyURLs<span class="token punctuation">:</span> <span class="token boolean">true</span>\n      <span class="token punctuation">}</span><span class="token punctuation">,</span>\n      inject<span class="token punctuation">:</span> <span class="token boolean">true</span>\n    <span class="token punctuation">}</span><span class="token punctuation">)</span>\n  <span class="token punctuation">]</span><span class="token punctuation">,</span>\n\n  performance<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n    <span class="token function-variable function">assetFilter</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token parameter">assetFilename</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token operator">!</span><span class="token regex">/(\\.map$)|(^(main\\.|favicon\\.))/</span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>assetFilename<span class="token punctuation">)</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<hr>\n<p>以上更新于 2019-2-13 19:47:27</p>\n<h1 id="webpack-配置全局变量"><a href="#webpack-%E9%85%8D%E7%BD%AE%E5%85%A8%E5%B1%80%E5%8F%98%E9%87%8F" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>webpack 配置全局变量</h1>\n<h2 id="项目背景"><a href="#%E9%A1%B9%E7%9B%AE%E8%83%8C%E6%99%AF" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>项目背景</h2>\n<p>个性化项目标题、图标，可以对编译后的文件改动，以达到无需编译即可改变标题或图标的效果</p>\n<h2 id="解决思路"><a href="#%E8%A7%A3%E5%86%B3%E6%80%9D%E8%B7%AF" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>解决思路</h2>\n<p>主要是在 <code class="language-text">index.html</code> 文件中注入全局变量</p>\n<h2 id="解决步骤"><a href="#%E8%A7%A3%E5%86%B3%E6%AD%A5%E9%AA%A4" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>解决步骤</h2>\n<ol>\n<li>在 <code class="language-text">index.html</code> 中注入全局变量</li>\n</ol>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="73343278501382360000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`<script>\n  document.write(\n    \'<s\' +\n      &quot;cript type=\'text/javascript\' src=\'/config.js?&quot; +\n      Math.random()\n        .toString(36)\n        .substr(2) +\n      &quot;\'></scr&quot; +\n      \'ipt>\'\n  );\n</script>`, `73343278501382360000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                html 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="html"><pre style="counter-reset: linenumber NaN" class="language-html line-numbers"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">\n  document<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>\n    <span class="token string">\'&lt;s\'</span> <span class="token operator">+</span>\n      <span class="token string">"cript type=\'text/javascript\' src=\'/config.js?"</span> <span class="token operator">+</span>\n      Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n        <span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token number">36</span><span class="token punctuation">)</span>\n        <span class="token punctuation">.</span><span class="token function">substr</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">+</span>\n      <span class="token string">"\'>&lt;/scr"</span> <span class="token operator">+</span>\n      <span class="token string">\'ipt>\'</span>\n  <span class="token punctuation">)</span><span class="token punctuation">;</span>\n</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<ol start="2">\n<li>在 <code class="language-text">app.js</code> 中注入此文件，编译时 <code class="language-text">webpack</code> 会拷贝文件到 <code class="language-text">build</code> 目录下</li>\n</ol>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="30571805114428654000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`import \'!file-loader?name=[name].[ext]!./config.js\';`, `30571805114428654000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                js 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">import</span> <span class="token string">\'!file-loader?name=[name].[ext]!./config.js\'</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>或在 <code class="language-text">webpack.base.config.js</code> 中添加如下代码达到相同效果</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="92923418068176130000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`new CopyWebpackPlugin([\n  \'app/config.js\',\n].map((src) => ({ from: src, to: path.resolve(process.cwd(), \'build\') }))),`, `92923418068176130000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                js 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">new</span> <span class="token class-name">CopyWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">[</span>\n  <span class="token string">\'app/config.js\'</span><span class="token punctuation">,</span>\n<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">src</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token keyword">from</span><span class="token punctuation">:</span> src<span class="token punctuation">,</span> to<span class="token punctuation">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span><span class="token function">cwd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">\'build\'</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<ol start="3">\n<li>在 <code class="language-text">config.js</code> 中添加全局变量</li>\n</ol>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="123543957543392750"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`window.RUNTIME_CONSTANTS = {\n  title: \'百度\'\n};`, `123543957543392750`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                js 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js">window<span class="token punctuation">.</span><span class="token constant">RUNTIME_CONSTANTS</span> <span class="token operator">=</span> <span class="token punctuation">{</span>\n  title<span class="token punctuation">:</span> <span class="token string">\'百度\'</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<ol start="4">\n<li>愉快使用全局变量</li>\n</ol>',
id:"/github/workspace/blog/Webpack配置笔记/index.md absPath of file >>> MarkdownRemark",timeToRead:15,frontmatter:{date:"2019-04-18 13:35:17",path:"/webpack-config-note/",tags:"前端, 前端构建工具, webpack, 预研",title:"webpack 配置笔记",draft:null}}],length:133,tag:"前端",pagesSum:27,page:19}}}});