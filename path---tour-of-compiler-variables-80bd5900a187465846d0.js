webpackJsonp([0xf08c350d12ee],{1455:function(n,a){n.exports={data:{file:{childImageSharp:{sizes:{base64:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAeCAYAAAAsEj5rAAAACXBIWXMAAAsSAAALEgHS3X78AAAHlUlEQVRIx11WaWxU1xWewbQlrdofkSIhGiBpMPZ4Vs/2lpm3zupZPOOZ8Sz2YGzANkaAKaYQUrMkLYgiIlxCQjCYQAwYEoMQNJAIFBxaQgUhoCopYceBJo1pKFVDCbOc0/fesOZKV+fM1Tvf/c56R0VYOZW8lvAxtSybvbExAu1+mndGuaDQ2F4rNHVFhCZJZlMeZ1Qrf9Mt+H+qur/ihFORAFA64J0pVTcXVcDmcKFfruIzZ7rY1H89fAZivjbM1MzFxkAnZqWd9M7KJcTmv7zCN44sY+tflm12C79WLxLCqidWN9cwWpYvsfXL13vasZudgm4mgX4hW6h1teRjnrZCwjOzWO/twIR/FjZ7WnEZ35JvcUSeU4gwSXV7W1sJzEH6R8nSRArlXjr6r7S1DqNUvMAzCXCzSfDxDRAUmyDkaoawtEPi1LxHyGLMkby5gEqUy7atjnq1roosAXqE6Yq7DBXa7RLS6HRG8y4hhbwzDiJbj4IkXUwS5e1h07IOorMePUL6ruiKGmRblg2PesJlq9nxrJMMfydIbhIWP9jMPrBLkrIHgXfG0CdmgKMjwFARFKVvHEQo5xUyKDDRN2T7aE17mV5rfZQYm1lM0EQYWUe0aNTxoKl0Qnk5jVqNA/VaFu3SBS7SB7Ju0ougr2KKWg2DBi17mbCaxyghMzgeMTTp2W7CGkTKHshZqn0Q5Osg6opBhAmAzcADY/NheyQJBi2D8mXVehYMOgEsJg9aTIxSN2YTO+ohQ62G6rGZa5AmAjmj0YvzG5vhVP8f4fTO12FtVxfMjTfC6zPbwOsIQNybhK6GlmLCm5DA6cu2aoeSaaOeVheLxRKgpoJcZ5UAly94MeeiQ+jnQtBCcTBTZ8Ght9fDfy58DDdOHIRj2zdA/4uzYWBpZ6Fr6jR8/lfWP8n2usqA2mQgH7msr3Ks0WgEfGvN6lz/q6tgXqgZjgpZOGSLwsldA4CFG4j3rmP/osU47xkdrm5pLfjdETm+p64cf0fJME34HiVFV+VYajF50UGGc/Nnz4XDfW/ArQ09+M++XsCblwD+fQEL356HswuWwdedS+Dg2p5ilZQwa7VrpCHZ9nOl7Ojg44B0hxxg0hbMjx2rh2iwDk4feReKI58hfn8V8c5lwNyXiF+dRbz4Z1jY1g4TJ1rQbnHfc/ORihJDr5q0kw8AyVqDjpeSEpJLAyaMN6HRwMDuTa/B1fcPwcfbBuHc8SPw+cnDsGvzeim7HOg0DpAYoouPBWUMJxUo65y18X4MtbYJOo3zjgQoxwWen1iNDdPmwPu9+2BvfCXsXbQRehf9Hly0B8aN04OuioGqCipvt/hQ5GLzS4Dh0Tdv3+/nvm0qVVUlfUouboOWK8jxmaznMBXIwpbfroWN63th384tcHTfDpj0gg21lQxoK+m8TQGMb5UxAt6OUYSVkUuGK5MPKiuIHicZwWqDmNNqpE6pIFBjpGDxsqXwuxUroWtBN5w4NgSbNvcDIRW61CUFu9UrtV/si7Fjf/ajUmICSvxKgJMtdQxVK2XOU9RpGNBL3VBeQWIqPR3SjR3QOW8xrFmxCnrWbYJMaobEkr1HE/4zIpv4nrK7NIrbpF+tspoYZdpMLte+wNPRu6S1Bs1GqV/1DOqMPFjIMFbq3dg6cyFkGmagqZqHaoOAHF2XZ6ngWg+XBM4RVoLHOWrLVG4uWpo4FvsvfHz6NktFkbT6QafnQGsUoFLHYm1dFj44cgwYPgQVkymkbP6RWl+LNIRjL/uFhltuNjEoYySCXaNUojOsMPSw4aqwa+o9ga5DggiC1RFDmyMG1bYQVlTSIIhRMJq9RaPZJ4VF+DQZ6MCAmOkLurJ/DYiNt/R67VMKs4hrqjL+o+6mjrj0hjBEOG+1h8FOxcFO1oHVFgazPYQGqdfNthBYpUqwEME78nsT4tP7o96WwWSwA1nKb35iyCZ8M85EXE3oYBO3ab4RKWcSKCaFJJMCQprSpPQcUFwKzWQUKo1+lC9x0r7Fcc+0OVOj8zEkNrY8BAuLDV11ruZvDXrhuJ3NIu+bAYK/FXjfdOA8zegUp6DdmQKNMQD+8HTseW1LYeijE/jB4Q+/Wry8a5L01B6MeaetUcDSjfVjjOVM7da+bTMPvHfkbmrKb5DksjkLncmZqXTe6siAnWmAmkhbYUPvQP7cufO5L69fxyvD/8Ctb+/aI2PU8AmvRGqZAoiIityzb8/T165d3X3t2vD/Pjr+KW7b+R6u2/AOrli9CQfePYQXLg3jpSvDeOLkWTxw6Oh3uwYPrJTMlNHlFcLPeNk6/UOXZ7cuGP1A397fP/7v584vvzJ8o+dvn33+Zm/v9q9X/2EDbN+19+ybm3ds33/ww5f63uovf/D9woVL1A90P5dQqYaGhpQfg4N71BJbteoHqyk7Z+e8zlfuSupPHj+/eO2bso5ZcxQ9Fsiqgny6ZOv3+VTfjIwo+iefnFYN7BxQf3FxuEwGH1c+fgxBuIZnTFuIIh9U2qt3844fb9y0Vf0gXPKm7bzKzYZ+wGTKFFWNz1/6v8OLUiuaFKMJz00yEvaa/RQZnK086s6MutpEqRLx+kcT+rH1f+YikeeNfqnwAAAAAElFTkSuQmCC",aspectRatio:.6666666666666666,src:"/static/avatar-a4ccbab8e7381acb89452773ce94d5a0-25c91.png",srcSet:"/static/avatar-a4ccbab8e7381acb89452773ce94d5a0-8a97b.png 200w,\n/static/avatar-a4ccbab8e7381acb89452773ce94d5a0-0fdf3.png 400w,\n/static/avatar-a4ccbab8e7381acb89452773ce94d5a0-25c91.png 600w",srcWebp:"/static/avatar-a4ccbab8e7381acb89452773ce94d5a0-216f6.webp",srcSetWebp:"/static/avatar-a4ccbab8e7381acb89452773ce94d5a0-5d70e.webp 200w,\n/static/avatar-a4ccbab8e7381acb89452773ce94d5a0-d1677.webp 400w,\n/static/avatar-a4ccbab8e7381acb89452773ce94d5a0-216f6.webp 600w",sizes:"(max-width: 600px) 100vw, 600px"}}},site:{siteMetadata:{title:"女王控的博客",description:'前端工程师，黑猫女王控，欢迎勾搭，技术相关<a href="https://github.com/towavephone" target="_blank">@towavephone</a>，QQ闲聊<a href="tencent://AddContact/?fromId=45&fromSubId=1&subcmd=all&uin=634407147&website=www.oicqzone.com">@towave</a>，bili关注<a href="https://space.bilibili.com/11507708#/" target="_blank">@towave</a>',siteUrl:"https://blog.towavephone.com"}},mainPost:{html:'<h1 id="需求"><a href="#%E9%9C%80%E6%B1%82" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>需求</h1>\n<p>在语言中添加变量，希望能够做到</p>\n<ul>\n<li>声明变量</li>\n<li>使用变量获取存储的值</li>\n<li>分配给变量</li>\n</ul>\n<p>这是 input02 输入文件的内容：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="60803060149854060000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`int fred;\nint jim;\nfred = 5;\njim = 12;\nprint fred + jim;`, `60803060149854060000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="text"><pre style="counter-reset: linenumber NaN" class="language-text line-numbers"><code class="language-text">int fred;\nint jim;\nfred = 5;\njim = 12;\nprint fred + jim;</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>最明显的变化是在表达式中具有变量声明，赋值语句和变量名称。但是在开始之前，让我们先看看如何实现变量。</p>\n<h1 id="准备"><a href="#%E5%87%86%E5%A4%87" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>准备</h1>\n<h2 id="bnf-语法"><a href="#bnf-%E8%AF%AD%E6%B3%95" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>BNF 语法</h2>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="69829719303774060000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`statements: statement\n    |      statement statements\n    ;\n\nstatement: \'print\' expression \';\'\n    |     \'int\'   identifier \';\'\n    |     identifier \'=\' expression \';\'\n    ;\n\nidentifier: T_IDENT\n    ;`, `69829719303774060000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="text"><pre style="counter-reset: linenumber NaN" class="language-text line-numbers"><code class="language-text">statements: statement\n    |      statement statements\n    ;\n\nstatement: &#39;print&#39; expression &#39;;&#39;\n    |     &#39;int&#39;   identifier &#39;;&#39;\n    |     identifier &#39;=&#39; expression &#39;;&#39;\n    ;\n\nidentifier: T_IDENT\n    ;</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h1 id="核心逻辑"><a href="#%E6%A0%B8%E5%BF%83%E9%80%BB%E8%BE%91" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>核心逻辑</h1>\n<h2 id="符号表"><a href="#%E7%AC%A6%E5%8F%B7%E8%A1%A8" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>符号表</h2>\n<p>每个编译器都需要一个符号表，稍后我们将不仅仅持有全局变量，但现在这是表中的一项的结构（来自 defs.h）：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="6792782797713581000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// Symbol table structure\nstruct symtable {\n  char *name;                   // Name of a symbol\n};`, `6792782797713581000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                c 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="c"><pre style="counter-reset: linenumber NaN" class="language-c line-numbers"><code class="language-c"><span class="token comment">// Symbol table structure</span>\n<span class="token keyword">struct</span> <span class="token class-name">symtable</span> <span class="token punctuation">{</span>\n  <span class="token keyword">char</span> <span class="token operator">*</span>name<span class="token punctuation">;</span>                   <span class="token comment">// Name of a symbol</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>我们在 data.h 中有一个符号数组：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="26482416661013830000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`#define NSYMBOLS        1024            // Number of symbol table entries\nextern_ struct symtable Gsym[NSYMBOLS]; // Global symbol table\nstatic int Globs = 0;                   // Position of next free global symbol slot`, `26482416661013830000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                c 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="c"><pre style="counter-reset: linenumber NaN" class="language-c line-numbers"><code class="language-c"><span class="token macro property">#<span class="token directive keyword">define</span> NSYMBOLS        1024            </span><span class="token comment">// Number of symbol table entries</span>\nextern_ <span class="token keyword">struct</span> <span class="token class-name">symtable</span> Gsym<span class="token punctuation">[</span>NSYMBOLS<span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// Global symbol table</span>\n<span class="token keyword">static</span> <span class="token keyword">int</span> Globs <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>                   <span class="token comment">// Position of next free global symbol slot</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>Globs 实际上是位于 sym.c 中用于管理符号表的文件，具有以下功能：</p>\n<ul>\n<li>int findglob(char *s)：确定符号 s 是否在全局符号表中，返回其插槽位置；如果找不到，则返回 -1。</li>\n<li>static int newglob(void)：获取新的全局符号槽的位置，否则如果我们用完所有位置则结束。</li>\n<li>int addglob(char *name)：将全局符号添加到符号表，返回符号表中的插槽号。</li>\n</ul>\n<p>该代码相当简单，因此我不会在这里给出代码。使用这些功能，我们可以找到符号并将新符号添加到符号表中。</p>\n<h2 id="扫描和新令牌"><a href="#%E6%89%AB%E6%8F%8F%E5%92%8C%E6%96%B0%E4%BB%A4%E7%89%8C" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>扫描和新令牌</h2>\n<p>如果查看示例输入文件，我们需要一些新标记：</p>\n<ul>\n<li>‘int’，称为 T_INT</li>\n<li>’=‘，称为 T_EQUALS</li>\n<li>标识符名称，称为 T_IDENT</li>\n</ul>\n<p>’=’ 很容易添加到 scan()：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="4581548503125732000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`case \'=\':\n  t->token = T_EQUALS;\n  break;`, `4581548503125732000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                c 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="c"><pre style="counter-reset: linenumber NaN" class="language-c line-numbers"><code class="language-c"><span class="token keyword">case</span> <span class="token string">\'=\'</span><span class="token operator">:</span>\n  t<span class="token operator">-></span>token <span class="token operator">=</span> T_EQUALS<span class="token punctuation">;</span>\n  <span class="token keyword">break</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>我们可以将 ‘int’ 关键字添加到 keyword()：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="22561197615169680000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`case \'i\':\n  if (!strcmp(s, &quot;int&quot;))\n    return (T_INT);\n  break;`, `22561197615169680000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                c 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="c"><pre style="counter-reset: linenumber NaN" class="language-c line-numbers"><code class="language-c"><span class="token keyword">case</span> <span class="token string">\'i\'</span><span class="token operator">:</span>\n  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">strcmp</span><span class="token punctuation">(</span>s<span class="token punctuation">,</span> <span class="token string">"int"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n    <span class="token keyword">return</span> <span class="token punctuation">(</span>T_INT<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token keyword">break</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>对于标识符，我们已经在 scanident() 将单词存储到 Text 变量中了，我们可以返回一个 T_IDENT 令牌：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="94746598561081790000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`if (isalpha(c) || \'_\' == c) {\n  // Read in a keyword or identifier\n  scanident(c, Text, TEXTLEN);\n\n  // If it\'s a recognised keyword, return that token\n  if (tokentype = keyword(Text)) {\n    t->token = tokentype;\n    break;\n  }\n  // Not a recognised keyword, so it must be an identifier\n  t->token = T_IDENT;\n  break;\n}`, `94746598561081790000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                c 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="c"><pre style="counter-reset: linenumber NaN" class="language-c line-numbers"><code class="language-c"><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isalpha</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token string">\'_\'</span> <span class="token operator">==</span> c<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token comment">// Read in a keyword or identifier</span>\n  <span class="token function">scanident</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span> Text<span class="token punctuation">,</span> TEXTLEN<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n  <span class="token comment">// If it\'s a recognised keyword, return that token</span>\n  <span class="token keyword">if</span> <span class="token punctuation">(</span>tokentype <span class="token operator">=</span> <span class="token function">keyword</span><span class="token punctuation">(</span>Text<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    t<span class="token operator">-></span>token <span class="token operator">=</span> tokentype<span class="token punctuation">;</span>\n    <span class="token keyword">break</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n  <span class="token comment">// Not a recognised keyword, so it must be an identifier</span>\n  t<span class="token operator">-></span>token <span class="token operator">=</span> T_IDENT<span class="token punctuation">;</span>\n  <span class="token keyword">break</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id="新语法"><a href="#%E6%96%B0%E8%AF%AD%E6%B3%95" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>新语法</h2>\n<p>标识符作为 T_IDENT 令牌返回，并且我们已经有了解析打印语句的代码，但是由于我们现在拥有三种类型的语句，因此编写一个处理每种类型的函数是有意义的，现在我们的顶级 statements() 函数 stmt.c 如下所示：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="7475822009395760000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// Parse one or more statements\nvoid statements(void) {\n\n  while (1) {\n    switch (Token.token) {\n    case T_PRINT:\n      print_statement();\n      break;\n    case T_INT:\n      var_declaration();\n      break;\n    case T_IDENT:\n      assignment_statement();\n      break;\n    case T_EOF:\n      return;\n    default:\n      fatald(&quot;Syntax error, token&quot;, Token.token);\n    }\n  }\n}`, `7475822009395760000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                c 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="c"><pre style="counter-reset: linenumber NaN" class="language-c line-numbers"><code class="language-c"><span class="token comment">// Parse one or more statements</span>\n<span class="token keyword">void</span> <span class="token function">statements</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n\n  <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">switch</span> <span class="token punctuation">(</span>Token<span class="token punctuation">.</span>token<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">case</span> T_PRINT<span class="token operator">:</span>\n      <span class="token function">print_statement</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token keyword">break</span><span class="token punctuation">;</span>\n    <span class="token keyword">case</span> T_INT<span class="token operator">:</span>\n      <span class="token function">var_declaration</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token keyword">break</span><span class="token punctuation">;</span>\n    <span class="token keyword">case</span> T_IDENT<span class="token operator">:</span>\n      <span class="token function">assignment_statement</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token keyword">break</span><span class="token punctuation">;</span>\n    <span class="token keyword">case</span> T_EOF<span class="token operator">:</span>\n      <span class="token keyword">return</span><span class="token punctuation">;</span>\n    <span class="token keyword">default</span><span class="token operator">:</span>\n      <span class="token function">fatald</span><span class="token punctuation">(</span><span class="token string">"Syntax error, token"</span><span class="token punctuation">,</span> Token<span class="token punctuation">.</span>token<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id="变量声明"><a href="#%E5%8F%98%E9%87%8F%E5%A3%B0%E6%98%8E" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>变量声明</h2>\n<p>让我们看一下变量声明，这是在一个新文件 decl.c 中，因为将来我们将有许多其他类型的声明。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="57327564764920540000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// Parse the declaration of a variable\nvoid var_declaration(void) {\n\n  // Ensure we have an \'int\' token followed by an identifier\n  // and a semicolon. Text now has the identifier\'s name.\n  // Add it as a known identifier\n  match(T_INT, &quot;int&quot;);\n  ident();\n  addglob(Text);\n  genglobsym(Text);\n  semi();\n}`, `57327564764920540000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                c 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="c"><pre style="counter-reset: linenumber NaN" class="language-c line-numbers"><code class="language-c"><span class="token comment">// Parse the declaration of a variable</span>\n<span class="token keyword">void</span> <span class="token function">var_declaration</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n\n  <span class="token comment">// Ensure we have an \'int\' token followed by an identifier</span>\n  <span class="token comment">// and a semicolon. Text now has the identifier\'s name.</span>\n  <span class="token comment">// Add it as a known identifier</span>\n  <span class="token function">match</span><span class="token punctuation">(</span>T_INT<span class="token punctuation">,</span> <span class="token string">"int"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token function">ident</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token function">addglob</span><span class="token punctuation">(</span>Text<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token function">genglobsym</span><span class="token punctuation">(</span>Text<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token function">semi</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>在 ident() 和 semi() 函数中包装 match()：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="45037915376912105000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`void semi(void)  { match(T_SEMI, &quot;;&quot;); }\nvoid ident(void) { match(T_IDENT, &quot;identifier&quot;); }`, `45037915376912105000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                c 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="c"><pre style="counter-reset: linenumber NaN" class="language-c line-numbers"><code class="language-c"><span class="token keyword">void</span> <span class="token function">semi</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>  <span class="token punctuation">{</span> <span class="token function">match</span><span class="token punctuation">(</span>T_SEMI<span class="token punctuation">,</span> <span class="token string">";"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>\n<span class="token keyword">void</span> <span class="token function">ident</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token function">match</span><span class="token punctuation">(</span>T_IDENT<span class="token punctuation">,</span> <span class="token string">"identifier"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p>返回 var_declaration()，一旦我们将标识符扫描到 Text 缓冲区中，就可以使用将其添加到全局符号表中 addglob(Text)，那里的代码允许多次声明一个变量。</p>\n<h2 id="赋值声明"><a href="#%E8%B5%8B%E5%80%BC%E5%A3%B0%E6%98%8E" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>赋值声明</h2>\n<p>这是 stmt.c 中的 assignment_statement()：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="45300657084534570000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`void assignment_statement(void) {\n  struct ASTnode *left, *right, *tree;\n  int id;\n\n  // Ensure we have an identifier\n  ident();\n\n  // Check it\'s been defined then make a leaf node for it\n  if ((id = findglob(Text)) == -1) {\n    fatals(&quot;Undeclared variable&quot;, Text);\n  }\n  right = mkastleaf(A_LVIDENT, id);\n\n  // Ensure we have an equals sign\n  match(T_EQUALS, &quot;=&quot;);\n\n  // Parse the following expression\n  left = binexpr(0);\n\n  // Make an assignment AST tree\n  tree = mkastnode(A_ASSIGN, left, right, 0);\n\n  // Generate the assembly code for the assignment\n  genAST(tree, -1);\n  genfreeregs();\n\n  // Match the following semicolon\n  semi();\n}`, `45300657084534570000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                c 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="c"><pre style="counter-reset: linenumber NaN" class="language-c line-numbers"><code class="language-c"><span class="token keyword">void</span> <span class="token function">assignment_statement</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">struct</span> <span class="token class-name">ASTnode</span> <span class="token operator">*</span>left<span class="token punctuation">,</span> <span class="token operator">*</span>right<span class="token punctuation">,</span> <span class="token operator">*</span>tree<span class="token punctuation">;</span>\n  <span class="token keyword">int</span> id<span class="token punctuation">;</span>\n\n  <span class="token comment">// Ensure we have an identifier</span>\n  <span class="token function">ident</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n  <span class="token comment">// Check it\'s been defined then make a leaf node for it</span>\n  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>id <span class="token operator">=</span> <span class="token function">findglob</span><span class="token punctuation">(</span>Text<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token function">fatals</span><span class="token punctuation">(</span><span class="token string">"Undeclared variable"</span><span class="token punctuation">,</span> Text<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n  right <span class="token operator">=</span> <span class="token function">mkastleaf</span><span class="token punctuation">(</span>A_LVIDENT<span class="token punctuation">,</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n  <span class="token comment">// Ensure we have an equals sign</span>\n  <span class="token function">match</span><span class="token punctuation">(</span>T_EQUALS<span class="token punctuation">,</span> <span class="token string">"="</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n  <span class="token comment">// Parse the following expression</span>\n  left <span class="token operator">=</span> <span class="token function">binexpr</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n  <span class="token comment">// Make an assignment AST tree</span>\n  tree <span class="token operator">=</span> <span class="token function">mkastnode</span><span class="token punctuation">(</span>A_ASSIGN<span class="token punctuation">,</span> left<span class="token punctuation">,</span> right<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n  <span class="token comment">// Generate the assembly code for the assignment</span>\n  <span class="token function">genAST</span><span class="token punctuation">(</span>tree<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token function">genfreeregs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n  <span class="token comment">// Match the following semicolon</span>\n  <span class="token function">semi</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>我们有几个新的 AST 节点类型，<code class="language-text">A_ASSIGN</code> 在左侧的子级中获取表达式，并将其分配给右侧的子级，右边的孩子将是一个 <code class="language-text">A_LVIDENT</code> 节点。</p>\n<p>为什么将这个节点称为 A_LVIDENT？因为它代表左值标识符，那么什么是左值？</p>\n<p>左值是绑定到特定位置的值，在这里它是内存中保存变量值的地址。当我们这样做时：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="66285104680093900000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`area = width * height;`, `66285104680093900000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="text"><pre style="counter-reset: linenumber NaN" class="language-text line-numbers"><code class="language-text">area = width * height;</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>我们将右侧的结果（即 rvalue）分配给左侧的变量（即 lvalue），在右值不依赖于特定的位置，表达式结果可能在任意寄存器中。</p>\n<p>还要注意，尽管赋值语句具有以下语法</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="18894848300560520000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`identifier \'=\' expression \';\'`, `18894848300560520000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="text"><pre style="counter-reset: linenumber NaN" class="language-text line-numbers"><code class="language-text">identifier &#39;=&#39; expression &#39;;&#39;</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>我们将使表达式成为 <code class="language-text">A_ASSIGN</code> 节点的左侧子树，并将 <code class="language-text">A_LVIDENT</code> 详细信息保存在右侧子树中。为什么？因为我们需要先计算表达式，然后再将其保存到变量中。</p>\n<h2 id="ast-结构的变化"><a href="#ast-%E7%BB%93%E6%9E%84%E7%9A%84%E5%8F%98%E5%8C%96" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>AST 结构的变化</h2>\n<p>现在我们需要在 <code class="language-text">A_INTLIT AST</code> 节点中存储整数文字值，或者在 <code class="language-text">A_IDENT AST</code> 节点中存储符号的详细信息，我在 AST 结构中添加了一个并集以执行此操作（在 defs.h 中）：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="70283857826303530000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// Abstract Syntax Tree structure\nstruct ASTnode {\n  int op;                       // &quot;Operation&quot; to be performed on this tree\n  struct ASTnode *left;         // Left and right child trees\n  struct ASTnode *right;\n  union {\n    int intvalue;               // For A_INTLIT, the integer value\n    int id;                     // For A_IDENT, the symbol slot number\n  } v;\n};`, `70283857826303530000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                c 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="c"><pre style="counter-reset: linenumber NaN" class="language-c line-numbers"><code class="language-c"><span class="token comment">// Abstract Syntax Tree structure</span>\n<span class="token keyword">struct</span> <span class="token class-name">ASTnode</span> <span class="token punctuation">{</span>\n  <span class="token keyword">int</span> op<span class="token punctuation">;</span>                       <span class="token comment">// "Operation" to be performed on this tree</span>\n  <span class="token keyword">struct</span> <span class="token class-name">ASTnode</span> <span class="token operator">*</span>left<span class="token punctuation">;</span>         <span class="token comment">// Left and right child trees</span>\n  <span class="token keyword">struct</span> <span class="token class-name">ASTnode</span> <span class="token operator">*</span>right<span class="token punctuation">;</span>\n  <span class="token keyword">union</span> <span class="token punctuation">{</span>\n    <span class="token keyword">int</span> intvalue<span class="token punctuation">;</span>               <span class="token comment">// For A_INTLIT, the integer value</span>\n    <span class="token keyword">int</span> id<span class="token punctuation">;</span>                     <span class="token comment">// For A_IDENT, the symbol slot number</span>\n  <span class="token punctuation">}</span> v<span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id="生成分配代码"><a href="#%E7%94%9F%E6%88%90%E5%88%86%E9%85%8D%E4%BB%A3%E7%A0%81" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>生成分配代码</h2>\n<p>现在让我们来看看 gen.c 中变化的 genAST()</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="9677071656950886000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`int genAST(struct ASTnode *n, int reg) {\n  int leftreg, rightreg;\n\n  // Get the left and right sub-tree values\n  if (n->left)\n    leftreg = genAST(n->left, -1);\n  if (n->right)\n    rightreg = genAST(n->right, leftreg);\n\n  switch (n->op) {\n    ...\n    case A_INTLIT:\n      return (cgloadint(n->v.intvalue));\n    case A_IDENT:\n      return (cgloadglob(Gsym[n->v.id].name));\n    case A_LVIDENT:\n      return (cgstorglob(reg, Gsym[n->v.id].name));\n    case A_ASSIGN:\n      // The work has already been done, return the result\n      return (rightreg);\n    default:\n      fatald(&quot;Unknown AST operator&quot;, n->op);\n  }`, `9677071656950886000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                c 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="c"><pre style="counter-reset: linenumber NaN" class="language-c line-numbers"><code class="language-c"><span class="token keyword">int</span> <span class="token function">genAST</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">ASTnode</span> <span class="token operator">*</span>n<span class="token punctuation">,</span> <span class="token keyword">int</span> reg<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">int</span> leftreg<span class="token punctuation">,</span> rightreg<span class="token punctuation">;</span>\n\n  <span class="token comment">// Get the left and right sub-tree values</span>\n  <span class="token keyword">if</span> <span class="token punctuation">(</span>n<span class="token operator">-></span>left<span class="token punctuation">)</span>\n    leftreg <span class="token operator">=</span> <span class="token function">genAST</span><span class="token punctuation">(</span>n<span class="token operator">-></span>left<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token keyword">if</span> <span class="token punctuation">(</span>n<span class="token operator">-></span>right<span class="token punctuation">)</span>\n    rightreg <span class="token operator">=</span> <span class="token function">genAST</span><span class="token punctuation">(</span>n<span class="token operator">-></span>right<span class="token punctuation">,</span> leftreg<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n  <span class="token keyword">switch</span> <span class="token punctuation">(</span>n<span class="token operator">-></span>op<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>\n    <span class="token keyword">case</span> A_INTLIT<span class="token operator">:</span>\n      <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token function">cgloadint</span><span class="token punctuation">(</span>n<span class="token operator">-></span>v<span class="token punctuation">.</span>intvalue<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">case</span> A_IDENT<span class="token operator">:</span>\n      <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token function">cgloadglob</span><span class="token punctuation">(</span>Gsym<span class="token punctuation">[</span>n<span class="token operator">-></span>v<span class="token punctuation">.</span>id<span class="token punctuation">]</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">case</span> A_LVIDENT<span class="token operator">:</span>\n      <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token function">cgstorglob</span><span class="token punctuation">(</span>reg<span class="token punctuation">,</span> Gsym<span class="token punctuation">[</span>n<span class="token operator">-></span>v<span class="token punctuation">.</span>id<span class="token punctuation">]</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">case</span> A_ASSIGN<span class="token operator">:</span>\n      <span class="token comment">// The work has already been done, return the result</span>\n      <span class="token keyword">return</span> <span class="token punctuation">(</span>rightreg<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">default</span><span class="token operator">:</span>\n      <span class="token function">fatald</span><span class="token punctuation">(</span><span class="token string">"Unknown AST operator"</span><span class="token punctuation">,</span> n<span class="token operator">-></span>op<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>请注意我们首先执行左侧的 AST 子级，然后获取一个保存左侧子树值的寄存器号，现在我们将此寄存器号传递给右侧子树，我们需要对 A_LVIDENT 节点执行此操作，以便于让 cg.c 中的 cgstorglob() 函数知道哪个寄存器保存赋值表达式的右值结果。</p>\n<p>因此，请考虑以下 AST 树：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="90207451510122550000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`      A_ASSIGN\n     /        \\\nA_INTLIT   A_LVIDENT\n   (3)        (5)`, `90207451510122550000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="text"><pre style="counter-reset: linenumber NaN" class="language-text line-numbers"><code class="language-text">      A_ASSIGN\n     /        \\\nA_INTLIT   A_LVIDENT\n   (3)        (5)</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>我们调用 leftreg = genAST(n->left, -1); 以执行 <code class="language-text">A_INTLIT</code> 操作，这将执行 return (cgloadint(n->v.intvalue)); 即加载值为 3 的寄存器并返回寄存器 ID。</p>\n<p>然后我们调用 rightreg = genAST(n->right, leftreg); 以执行 <code class="language-text">A_LVIDENT</code> 操作，这将把 return (cgstorglob(reg, Gsym[n->v.id].name)); 返回的寄存器存储到名称为 Gsym[5] 的变量中。</p>\n<p>然后我们切换到 <code class="language-text">A_ASSIGN</code> 情况，我们所有的工作都已经完成，右值仍在寄存器中。因此让它保留在那里并返回它，稍后我们将能够执行以下表达式：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="47582452650786330000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`a = b = c = 0;`, `47582452650786330000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="text"><pre style="counter-reset: linenumber NaN" class="language-text line-numbers"><code class="language-text">a = b = c = 0;</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>赋值不仅是语句，而且是表达式。</p>\n<h2 id="生成-x86-64-代码"><a href="#%E7%94%9F%E6%88%90-x86-64-%E4%BB%A3%E7%A0%81" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>生成 x86-64 代码</h2>\n<p>您可能已经注意到，我将旧 cgload() 函数的名称更改为 cgloadint()，现在我们有一个函数可以从全局变量（在 cg.c 中）加载值：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="2891212359126549500"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`int cgloadglob(char *identifier) {\n  // Get a new register\n  int r = alloc_register();\n\n  // Print out the code to initialise it\n  fprintf(Outfile, &quot;\\tmovq\\t%s(\\%%rip), %s\\n&quot;, identifier, reglist[r]);\n  return (r);\n}`, `2891212359126549500`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                c 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="c"><pre style="counter-reset: linenumber NaN" class="language-c line-numbers"><code class="language-c"><span class="token keyword">int</span> <span class="token function">cgloadglob</span><span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span>identifier<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token comment">// Get a new register</span>\n  <span class="token keyword">int</span> r <span class="token operator">=</span> <span class="token function">alloc_register</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n  <span class="token comment">// Print out the code to initialise it</span>\n  <span class="token function">fprintf</span><span class="token punctuation">(</span>Outfile<span class="token punctuation">,</span> <span class="token string">"\\tmovq\\t%s(\\%%rip), %s\\n"</span><span class="token punctuation">,</span> identifier<span class="token punctuation">,</span> reglist<span class="token punctuation">[</span>r<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token keyword">return</span> <span class="token punctuation">(</span>r<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>同样我们需要一个函数来将寄存器保存到变量中：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="52604174300733340000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// Store a register\'s value into a variable\nint cgstorglob(int r, char *identifier) {\n  fprintf(Outfile, &quot;\\tmovq\\t%s, %s(\\%%rip)\\n&quot;, reglist[r], identifier);\n  return (r);\n}`, `52604174300733340000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                c 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="c"><pre style="counter-reset: linenumber NaN" class="language-c line-numbers"><code class="language-c"><span class="token comment">// Store a register\'s value into a variable</span>\n<span class="token keyword">int</span> <span class="token function">cgstorglob</span><span class="token punctuation">(</span><span class="token keyword">int</span> r<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span>identifier<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token function">fprintf</span><span class="token punctuation">(</span>Outfile<span class="token punctuation">,</span> <span class="token string">"\\tmovq\\t%s, %s(\\%%rip)\\n"</span><span class="token punctuation">,</span> reglist<span class="token punctuation">[</span>r<span class="token punctuation">]</span><span class="token punctuation">,</span> identifier<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token keyword">return</span> <span class="token punctuation">(</span>r<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>我们还需要一个函数来创建新的全局整数变量：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="257581634140158200"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// Generate a global symbol\nvoid cgglobsym(char *sym) {\n  fprintf(Outfile, &quot;\\t.comm\\t%s,8,8\\n&quot;, sym);\n}`, `257581634140158200`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                c 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="c"><pre style="counter-reset: linenumber NaN" class="language-c line-numbers"><code class="language-c"><span class="token comment">// Generate a global symbol</span>\n<span class="token keyword">void</span> <span class="token function">cgglobsym</span><span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span>sym<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token function">fprintf</span><span class="token punctuation">(</span>Outfile<span class="token punctuation">,</span> <span class="token string">"\\t.comm\\t%s,8,8\\n"</span><span class="token punctuation">,</span> sym<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>当然我们不能让解析器直接访问此代码，相反通用代码生成器中有一个函数 gen.c 充当接口：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="9041266134036863000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`void genglobsym(char *s) { cgglobsym(s); }`, `9041266134036863000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                c 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="c"><pre style="counter-reset: linenumber NaN" class="language-c line-numbers"><code class="language-c"><span class="token keyword">void</span> <span class="token function">genglobsym</span><span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span>s<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token function">cgglobsym</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<h2 id="表达式中的变量"><a href="#%E8%A1%A8%E8%BE%BE%E5%BC%8F%E4%B8%AD%E7%9A%84%E5%8F%98%E9%87%8F" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>表达式中的变量</h2>\n<p>现在我们可以分配变量了，但是我们如何将变量的值放入表达式中。我们已经有了一个 primary() 获取整数文字的函数，让我们对其进行修改以同时加载变量的值：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="78946771652087190000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// Parse a primary factor and return an\n// AST node representing it.\nstatic struct ASTnode *primary(void) {\n  struct ASTnode *n;\n  int id;\n\n  switch (Token.token) {\n    case T_INTLIT:\n      // For an INTLIT token, make a leaf AST node for it.\n      n = mkastleaf(A_INTLIT, Token.intvalue);\n      break;\n\n    case T_IDENT:\n      // Check that this identifier exists\n      id = findglob(Text);\n      if (id == -1)\n        fatals(&quot;Unknown variable&quot;, Text);\n\n      // Make a leaf AST node for it\n      n = mkastleaf(A_IDENT, id);\n      break;\n\n    default:\n      fatald(&quot;Syntax error, token&quot;, Token.token);\n  }\n\n  // Scan in the next token and return the leaf node\n  scan(&Token);\n  return (n);\n}`, `78946771652087190000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                c 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="c"><pre style="counter-reset: linenumber NaN" class="language-c line-numbers"><code class="language-c"><span class="token comment">// Parse a primary factor and return an</span>\n<span class="token comment">// AST node representing it.</span>\n<span class="token keyword">static</span> <span class="token keyword">struct</span> <span class="token class-name">ASTnode</span> <span class="token operator">*</span><span class="token function">primary</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">struct</span> <span class="token class-name">ASTnode</span> <span class="token operator">*</span>n<span class="token punctuation">;</span>\n  <span class="token keyword">int</span> id<span class="token punctuation">;</span>\n\n  <span class="token keyword">switch</span> <span class="token punctuation">(</span>Token<span class="token punctuation">.</span>token<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">case</span> T_INTLIT<span class="token operator">:</span>\n      <span class="token comment">// For an INTLIT token, make a leaf AST node for it.</span>\n      n <span class="token operator">=</span> <span class="token function">mkastleaf</span><span class="token punctuation">(</span>A_INTLIT<span class="token punctuation">,</span> Token<span class="token punctuation">.</span>intvalue<span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token keyword">break</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">case</span> T_IDENT<span class="token operator">:</span>\n      <span class="token comment">// Check that this identifier exists</span>\n      id <span class="token operator">=</span> <span class="token function">findglob</span><span class="token punctuation">(</span>Text<span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token keyword">if</span> <span class="token punctuation">(</span>id <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>\n        <span class="token function">fatals</span><span class="token punctuation">(</span><span class="token string">"Unknown variable"</span><span class="token punctuation">,</span> Text<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n      <span class="token comment">// Make a leaf AST node for it</span>\n      n <span class="token operator">=</span> <span class="token function">mkastleaf</span><span class="token punctuation">(</span>A_IDENT<span class="token punctuation">,</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token keyword">break</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">default</span><span class="token operator">:</span>\n      <span class="token function">fatald</span><span class="token punctuation">(</span><span class="token string">"Syntax error, token"</span><span class="token punctuation">,</span> Token<span class="token punctuation">.</span>token<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n\n  <span class="token comment">// Scan in the next token and return the leaf node</span>\n  <span class="token function">scan</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>Token<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token keyword">return</span> <span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>注意在 T_IDENT 情况下的语法检查，以确保在尝试使用变量之前已声明该变量。</p>\n<p>还要注意检索变量值的 AST 叶节点是 <code class="language-text">A_IDENT</code> 节点，保存到变量中的是 <code class="language-text">A_LVIDENT</code> 节点，这是 rvalues 和 lvalues 之间的区别。</p>\n<h2 id="其他变化"><a href="#%E5%85%B6%E4%BB%96%E5%8F%98%E5%8C%96" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>其他变化</h2>\n<p>我可能还做了其他一些更改，在 misc.c 中创建一些帮助器函数以便更轻松地报告致命错误：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="91513432971036930000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// Print out fatal messages\nvoid fatal(char *s) {\n  fprintf(stderr, &quot;%s on line %d\\n&quot;, s, Line); exit(1);\n}\n\nvoid fatals(char *s1, char *s2) {\n  fprintf(stderr, &quot;%s:%s on line %d\\n&quot;, s1, s2, Line); exit(1);\n}\n\nvoid fatald(char *s, int d) {\n  fprintf(stderr, &quot;%s:%d on line %d\\n&quot;, s, d, Line); exit(1);\n}\n\nvoid fatalc(char *s, int c) {\n  fprintf(stderr, &quot;%s:%c on line %d\\n&quot;, s, c, Line); exit(1);\n}`, `91513432971036930000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                c 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="c"><pre style="counter-reset: linenumber NaN" class="language-c line-numbers"><code class="language-c"><span class="token comment">// Print out fatal messages</span>\n<span class="token keyword">void</span> <span class="token function">fatal</span><span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span>s<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token function">fprintf</span><span class="token punctuation">(</span><span class="token constant">stderr</span><span class="token punctuation">,</span> <span class="token string">"%s on line %d\\n"</span><span class="token punctuation">,</span> s<span class="token punctuation">,</span> Line<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">void</span> <span class="token function">fatals</span><span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span>s1<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span>s2<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token function">fprintf</span><span class="token punctuation">(</span><span class="token constant">stderr</span><span class="token punctuation">,</span> <span class="token string">"%s:%s on line %d\\n"</span><span class="token punctuation">,</span> s1<span class="token punctuation">,</span> s2<span class="token punctuation">,</span> Line<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">void</span> <span class="token function">fatald</span><span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span>s<span class="token punctuation">,</span> <span class="token keyword">int</span> d<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token function">fprintf</span><span class="token punctuation">(</span><span class="token constant">stderr</span><span class="token punctuation">,</span> <span class="token string">"%s:%d on line %d\\n"</span><span class="token punctuation">,</span> s<span class="token punctuation">,</span> d<span class="token punctuation">,</span> Line<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">void</span> <span class="token function">fatalc</span><span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span>s<span class="token punctuation">,</span> <span class="token keyword">int</span> c<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token function">fprintf</span><span class="token punctuation">(</span><span class="token constant">stderr</span><span class="token punctuation">,</span> <span class="token string">"%s:%c on line %d\\n"</span><span class="token punctuation">,</span> s<span class="token punctuation">,</span> c<span class="token punctuation">,</span> Line<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h1 id="运行结果"><a href="#%E8%BF%90%E8%A1%8C%E7%BB%93%E6%9E%9C" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>运行结果</h1>\n<h2 id="输入"><a href="#%E8%BE%93%E5%85%A5" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>输入</h2>\n<p>input01</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="65643971783465950000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`print 12 * 3;\nprint\n   18 - 2\n      * 4; print\n1 + 2 +\n  9 - 5/2 + 3*5;`, `65643971783465950000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="text"><pre style="counter-reset: linenumber NaN" class="language-text line-numbers"><code class="language-text">print 12 * 3;\nprint\n   18 - 2\n      * 4; print\n1 + 2 +\n  9 - 5/2 + 3*5;</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>input02</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="33474929095884210000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`int fred;\nint jim;\nfred= 5;\njim= 12;\nprint fred + jim;`, `33474929095884210000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="text"><pre style="counter-reset: linenumber NaN" class="language-text line-numbers"><code class="language-text">int fred;\nint jim;\nfred= 5;\njim= 12;\nprint fred + jim;</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id="输出"><a href="#%E8%BE%93%E5%87%BA" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>输出</h2>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="90102340779918020000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`\\$ make test\ncc -o comp1 -g cg.c decl.c expr.c gen.c main.c misc.c scan.c stmt.c sym.c tree.c\n./comp1 input01\ncc -o out out.s\n./out\n36\n10\n25\n./comp1 input02\ncc -o out out.s\n./out\n17`, `90102340779918020000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                bash 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">$ <span class="token function">make</span> <span class="token builtin class-name">test</span>\ncc -o comp1 -g cg.c decl.c expr.c gen.c main.c misc.c scan.c stmt.c sym.c tree.c\n./comp1 input01\ncc -o out out.s\n./out\n<span class="token number">36</span>\n<span class="token number">10</span>\n<span class="token number">25</span>\n./comp1 input02\ncc -o out out.s\n./out\n<span class="token number">17</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>input01 生成的 out.s</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="40345057154556010000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`\t.text\n.LC0:\n\t.string\t&quot;%d\\n&quot;\nprintint:\n\tpushq\t%rbp\n\tmovq\t%rsp, %rbp\n\tsubq\t\\$16, %rsp\n\tmovl\t%edi, -4(%rbp)\n\tmovl\t-4(%rbp), %eax\n\tmovl\t%eax, %esi\n\tleaq\t.LC0(%rip), %rdi\n\tmovl\t\\$0, %eax\n\tcall\tprintf@PLT\n\tnop\n\tleave\n\tret\n\n\t.globl\tmain\n\t.type\tmain, @function\nmain:\n\tpushq\t%rbp\n\tmovq\t%rsp, %rbp\n\tmovq\t\\$12, %r8\n\tmovq\t\\$3, %r9\n\timulq\t%r8, %r9\n\tmovq\t%r9, %rdi\n\tcall\tprintint\n\tmovq\t\\$18, %r8\n\tmovq\t\\$2, %r9\n\tmovq\t\\$4, %r10\n\timulq\t%r9, %r10\n\tsubq\t%r10, %r8\n\tmovq\t%r8, %rdi\n\tcall\tprintint\n\tmovq\t\\$1, %r8\n\tmovq\t\\$2, %r9\n\taddq\t%r8, %r9\n\tmovq\t\\$9, %r8\n\taddq\t%r9, %r8\n\tmovq\t\\$5, %r9\n\tmovq\t\\$2, %r10\n\tmovq\t%r9,%rax\n\tcqo\n\tidivq\t%r10\n\tmovq\t%rax,%r9\n\tsubq\t%r9, %r8\n\tmovq\t\\$3, %r9\n\tmovq\t\\$5, %r10\n\timulq\t%r9, %r10\n\taddq\t%r8, %r10\n\tmovq\t%r10, %rdi\n\tcall\tprintint\n\tmovl\t\\$0, %eax\n\tpopq\t%rbp\n\tret`, `40345057154556010000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="text"><pre style="counter-reset: linenumber NaN" class="language-text line-numbers"><code class="language-text">\t.text\n.LC0:\n\t.string\t&quot;%d\\n&quot;\nprintint:\n\tpushq\t%rbp\n\tmovq\t%rsp, %rbp\n\tsubq\t$16, %rsp\n\tmovl\t%edi, -4(%rbp)\n\tmovl\t-4(%rbp), %eax\n\tmovl\t%eax, %esi\n\tleaq\t.LC0(%rip), %rdi\n\tmovl\t$0, %eax\n\tcall\tprintf@PLT\n\tnop\n\tleave\n\tret\n\n\t.globl\tmain\n\t.type\tmain, @function\nmain:\n\tpushq\t%rbp\n\tmovq\t%rsp, %rbp\n\tmovq\t$12, %r8\n\tmovq\t$3, %r9\n\timulq\t%r8, %r9\n\tmovq\t%r9, %rdi\n\tcall\tprintint\n\tmovq\t$18, %r8\n\tmovq\t$2, %r9\n\tmovq\t$4, %r10\n\timulq\t%r9, %r10\n\tsubq\t%r10, %r8\n\tmovq\t%r8, %rdi\n\tcall\tprintint\n\tmovq\t$1, %r8\n\tmovq\t$2, %r9\n\taddq\t%r8, %r9\n\tmovq\t$9, %r8\n\taddq\t%r9, %r8\n\tmovq\t$5, %r9\n\tmovq\t$2, %r10\n\tmovq\t%r9,%rax\n\tcqo\n\tidivq\t%r10\n\tmovq\t%rax,%r9\n\tsubq\t%r9, %r8\n\tmovq\t$3, %r9\n\tmovq\t$5, %r10\n\timulq\t%r9, %r10\n\taddq\t%r8, %r10\n\tmovq\t%r10, %rdi\n\tcall\tprintint\n\tmovl\t$0, %eax\n\tpopq\t%rbp\n\tret</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>input02 生成的 out.s</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="36921786006305554000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`\t.text\n.LC0:\n\t.string\t&quot;%d\\n&quot;\nprintint:\n\tpushq\t%rbp\n\tmovq\t%rsp, %rbp\n\tsubq\t\\$16, %rsp\n\tmovl\t%edi, -4(%rbp)\n\tmovl\t-4(%rbp), %eax\n\tmovl\t%eax, %esi\n\tleaq\t.LC0(%rip), %rdi\n\tmovl\t\\$0, %eax\n\tcall\tprintf@PLT\n\tnop\n\tleave\n\tret\n\n\t.globl\tmain\n\t.type\tmain, @function\nmain:\n\tpushq\t%rbp\n\tmovq\t%rsp, %rbp\n\t.comm\tfred,8,8\n\t.comm\tjim,8,8\n\tmovq\t\\$5, %r8\n\tmovq\t%r8, fred(%rip)\n\tmovq\t\\$12, %r8\n\tmovq\t%r8, jim(%rip)\n\tmovq\tfred(%rip), %r8\n\tmovq\tjim(%rip), %r9\n\taddq\t%r8, %r9\n\tmovq\t%r9, %rdi\n\tcall\tprintint\n\tmovl\t\\$0, %eax\n\tpopq\t%rbp\n\tret`, `36921786006305554000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="text"><pre style="counter-reset: linenumber NaN" class="language-text line-numbers"><code class="language-text">\t.text\n.LC0:\n\t.string\t&quot;%d\\n&quot;\nprintint:\n\tpushq\t%rbp\n\tmovq\t%rsp, %rbp\n\tsubq\t$16, %rsp\n\tmovl\t%edi, -4(%rbp)\n\tmovl\t-4(%rbp), %eax\n\tmovl\t%eax, %esi\n\tleaq\t.LC0(%rip), %rdi\n\tmovl\t$0, %eax\n\tcall\tprintf@PLT\n\tnop\n\tleave\n\tret\n\n\t.globl\tmain\n\t.type\tmain, @function\nmain:\n\tpushq\t%rbp\n\tmovq\t%rsp, %rbp\n\t.comm\tfred,8,8\n\t.comm\tjim,8,8\n\tmovq\t$5, %r8\n\tmovq\t%r8, fred(%rip)\n\tmovq\t$12, %r8\n\tmovq\t%r8, jim(%rip)\n\tmovq\tfred(%rip), %r8\n\tmovq\tjim(%rip), %r9\n\taddq\t%r8, %r9\n\tmovq\t%r9, %rdi\n\tcall\tprintint\n\tmovl\t$0, %eax\n\tpopq\t%rbp\n\tret</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h1 id="结论"><a href="#%E7%BB%93%E8%AE%BA" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>结论</h1>\n<p>我们必须写出符号表管理，我们不得不处理两种新的语句类型，我们必须添加一些新的令牌和一些新的 AST 节点类型，最后我们必须添加一些代码以生成正确的 x86-64 程序集输出。</p>\n<p>尝试编写一些示例输入文件，并查看编译器是否可以正常工作，特别是如果它检测到语法错误和语义错误（可使用而无需声明）。</p>\n<p>在我们的编译器编写旅程的下一部分，我们将在我们的语言中添加六个比较运算符，在此之后的部分开始控制结构的编写。</p>',
excerpt:"需求 在语言中添加变量，希望能够做到 声明变量 使用变量获取存储的值 分配给变量 这是 input02 输入文件的内容： 最明显的变化是在表达式中具有变量声明，赋值语句和变量名称。但是在开始之前，让我们先看看如何实现变量。 准备 BNF…",timeToRead:8,tableOfContents:'<ul>\n<li><a href="/tour-of-compiler-variables/#%E9%9C%80%E6%B1%82">需求</a></li>\n<li>\n<p><a href="/tour-of-compiler-variables/#%E5%87%86%E5%A4%87">准备</a></p>\n<ul>\n<li><a href="/tour-of-compiler-variables/#bnf-%E8%AF%AD%E6%B3%95">BNF 语法</a></li>\n</ul>\n</li>\n<li>\n<p><a href="/tour-of-compiler-variables/#%E6%A0%B8%E5%BF%83%E9%80%BB%E8%BE%91">核心逻辑</a></p>\n<ul>\n<li><a href="/tour-of-compiler-variables/#%E7%AC%A6%E5%8F%B7%E8%A1%A8">符号表</a></li>\n<li><a href="/tour-of-compiler-variables/#%E6%89%AB%E6%8F%8F%E5%92%8C%E6%96%B0%E4%BB%A4%E7%89%8C">扫描和新令牌</a></li>\n<li><a href="/tour-of-compiler-variables/#%E6%96%B0%E8%AF%AD%E6%B3%95">新语法</a></li>\n<li><a href="/tour-of-compiler-variables/#%E5%8F%98%E9%87%8F%E5%A3%B0%E6%98%8E">变量声明</a></li>\n<li><a href="/tour-of-compiler-variables/#%E8%B5%8B%E5%80%BC%E5%A3%B0%E6%98%8E">赋值声明</a></li>\n<li><a href="/tour-of-compiler-variables/#ast-%E7%BB%93%E6%9E%84%E7%9A%84%E5%8F%98%E5%8C%96">AST 结构的变化</a></li>\n<li><a href="/tour-of-compiler-variables/#%E7%94%9F%E6%88%90%E5%88%86%E9%85%8D%E4%BB%A3%E7%A0%81">生成分配代码</a></li>\n<li><a href="/tour-of-compiler-variables/#%E7%94%9F%E6%88%90-x86-64-%E4%BB%A3%E7%A0%81">生成 x86-64 代码</a></li>\n<li><a href="/tour-of-compiler-variables/#%E8%A1%A8%E8%BE%BE%E5%BC%8F%E4%B8%AD%E7%9A%84%E5%8F%98%E9%87%8F">表达式中的变量</a></li>\n<li><a href="/tour-of-compiler-variables/#%E5%85%B6%E4%BB%96%E5%8F%98%E5%8C%96">其他变化</a></li>\n</ul>\n</li>\n<li>\n<p><a href="/tour-of-compiler-variables/#%E8%BF%90%E8%A1%8C%E7%BB%93%E6%9E%9C">运行结果</a></p>\n<ul>\n<li><a href="/tour-of-compiler-variables/#%E8%BE%93%E5%85%A5">输入</a></li>\n<li><a href="/tour-of-compiler-variables/#%E8%BE%93%E5%87%BA">输出</a></li>\n</ul>\n</li>\n<li><a href="/tour-of-compiler-variables/#%E7%BB%93%E8%AE%BA">结论</a></li>\n</ul>',wordCount:{words:316},frontmatter:{date:"2020-03-05 10:24:51",path:"/tour-of-compiler-variables/",tags:"编译原理, 变量",title:"编译器之旅（六）——变量",draft:null,catalog_number:null}},nextPost:{html:'<h1 id="需求"><a href="#%E9%9C%80%E6%B1%82" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>需求</h1>\n<p>在语言中添加一些声明语句：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="55548080144819780000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`print 2 + 3 * 5;\nprint 18 - 6/3 + 4*2;`, `55548080144819780000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="text"><pre style="counter-reset: linenumber NaN" class="language-text line-numbers"><code class="language-text">print 2 + 3 * 5;\nprint 18 - 6/3 + 4*2;</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<h1 id="准备"><a href="#%E5%87%86%E5%A4%87" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>准备</h1>\n<h2 id="bnf-语法说明"><a href="#bnf-%E8%AF%AD%E6%B3%95%E8%AF%B4%E6%98%8E" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>BNF 语法说明</h2>\n<p>我们已经看到了表达式的 BNF 表示法，现在让我们为以上语句定义 BNF 语法：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="98342481815383210000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`statements: statement\n     | statement statements\n     ;\n\nstatement: \'print\' expression \';\'\n     ;`, `98342481815383210000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="text"><pre style="counter-reset: linenumber NaN" class="language-text line-numbers"><code class="language-text">statements: statement\n     | statement statements\n     ;\n\nstatement: &#39;print&#39; expression &#39;;&#39;\n     ;</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>输入文件由几个语句组成，它们可以是一个语句，也可以是后面跟有更多语句的语句，每个语句均以关键字开头 print，然后是一个表达式，然后是分号。</p>\n<h1 id="核心逻辑"><a href="#%E6%A0%B8%E5%BF%83%E9%80%BB%E8%BE%91" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>核心逻辑</h1>\n<h2 id="词法扫描器的更改"><a href="#%E8%AF%8D%E6%B3%95%E6%89%AB%E6%8F%8F%E5%99%A8%E7%9A%84%E6%9B%B4%E6%94%B9" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>词法扫描器的更改</h2>\n<p>在编写解析以上语法的代码之前，我们需要在现有代码中添加更多细节，让我们从词法扫描器开始。</p>\n<p>为分号添加 print 元素很容易，稍后我们将在该语言中有很多关键字，以及变量的标识符，因此我们需要添加一些代码来帮助我们处理它们。</p>\n<p>在 scan.c 中我添加了从 SubC 编译器搬来的这段代码，它将字母数字字符读入缓冲区，直到命中非字母数字字符为止。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="64058540063002490000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// Scan an identifier from the input file and\n// store it in buf[]. Return the identifier\'s length\nstatic int scanident(int c, char *buf, int lim) {\n  int i = 0;\n\n  // Allow digits, alpha and underscores\n  while (isalpha(c) || isdigit(c) || \'_\' == c) {\n    // Error if we hit the identifier length limit,\n    // else append to buf[] and get next character\n    if (lim - 1 == i) {\n      printf(&quot;identifier too long on line %d\\n&quot;, Line);\n      exit(1);\n    } else if (i < lim - 1) {\n      buf[i++] = c;\n    }\n    c = next();\n  }\n  // We hit a non-valid character, put it back.\n  // NUL-terminate the buf[] and return the length\n  putback(c);\n  buf[i] = \'\\0\';\n  return (i);\n}`, `64058540063002490000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                c 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="c"><pre style="counter-reset: linenumber NaN" class="language-c line-numbers"><code class="language-c"><span class="token comment">// Scan an identifier from the input file and</span>\n<span class="token comment">// store it in buf[]. Return the identifier\'s length</span>\n<span class="token keyword">static</span> <span class="token keyword">int</span> <span class="token function">scanident</span><span class="token punctuation">(</span><span class="token keyword">int</span> c<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span>buf<span class="token punctuation">,</span> <span class="token keyword">int</span> lim<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>\n\n  <span class="token comment">// Allow digits, alpha and underscores</span>\n  <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token function">isalpha</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token function">isdigit</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token string">\'_\'</span> <span class="token operator">==</span> c<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token comment">// Error if we hit the identifier length limit,</span>\n    <span class="token comment">// else append to buf[] and get next character</span>\n    <span class="token keyword">if</span> <span class="token punctuation">(</span>lim <span class="token operator">-</span> <span class="token number">1</span> <span class="token operator">==</span> i<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"identifier too long on line %d\\n"</span><span class="token punctuation">,</span> Line<span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">&lt;</span> lim <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      buf<span class="token punctuation">[</span>i<span class="token operator">++</span><span class="token punctuation">]</span> <span class="token operator">=</span> c<span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n    c <span class="token operator">=</span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n  <span class="token comment">// We hit a non-valid character, put it back.</span>\n  <span class="token comment">// NUL-terminate the buf[] and return the length</span>\n  <span class="token function">putback</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  buf<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">\'\\0\'</span><span class="token punctuation">;</span>\n  <span class="token keyword">return</span> <span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>我们还需要一个功能来识别语言中的关键字，一种方法是拥有一个关键字列表，并将该列表和每个关键字逐个对比之后放在缓冲区中，SubC 的代码经过优化：在执行之前，与第一个字母匹配可以加快对数十个关键字的比较。现在，我们不需要此优化，但稍后将其放入其中：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="38389286965777120000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// Given a word from the input, return the matching\n// keyword token number or 0 if it\'s not a keyword.\n// Switch on the first letter so that we don\'t have\n// to waste time strcmp()ing against all the keywords.\nstatic int keyword(char *s) {\n  switch (*s) {\n    case \'p\':\n      if (!strcmp(s, &quot;print&quot;))\n        return (T_PRINT);\n      break;\n  }\n  return (0);\n}`, `38389286965777120000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                c 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="c"><pre style="counter-reset: linenumber NaN" class="language-c line-numbers"><code class="language-c"><span class="token comment">// Given a word from the input, return the matching</span>\n<span class="token comment">// keyword token number or 0 if it\'s not a keyword.</span>\n<span class="token comment">// Switch on the first letter so that we don\'t have</span>\n<span class="token comment">// to waste time strcmp()ing against all the keywords.</span>\n<span class="token keyword">static</span> <span class="token keyword">int</span> <span class="token function">keyword</span><span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span>s<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">switch</span> <span class="token punctuation">(</span><span class="token operator">*</span>s<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">case</span> <span class="token string">\'p\'</span><span class="token operator">:</span>\n      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">strcmp</span><span class="token punctuation">(</span>s<span class="token punctuation">,</span> <span class="token string">"print"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n        <span class="token keyword">return</span> <span class="token punctuation">(</span>T_PRINT<span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token keyword">break</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n  <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>在 scan() 的 switch 语句的底部，我们添加以下代码以识别分号和关键字：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="12659816587866302000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`case \';\':\n  t->token = T_SEMI;\n  break;\ndefault:\n\n  // If it\'s a digit, scan the\n  // literal integer value in\n  if (isdigit(c)) {\n    t->intvalue = scanint(c);\n    t->token = T_INTLIT;\n    break;\n  } else if (isalpha(c) || \'_\' == c) {\n    // Read in a keyword or identifier\n    scanident(c, Text, TEXTLEN);\n\n    // If it\'s a recognised keyword, return that token\n    if (tokentype = keyword(Text)) {\n      t->token = tokentype;\n      break;\n    }\n    // Not a recognised keyword, so an error for now\n    printf(&quot;Unrecognised symbol %s on line %d\\n&quot;, Text, Line);\n    exit(1);\n  }\n  // The character isn\'t part of any recognised token, error\n  printf(&quot;Unrecognised character %c on line %d\\n&quot;, c, Line);\n  exit(1);`, `12659816587866302000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                c 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="c"><pre style="counter-reset: linenumber NaN" class="language-c line-numbers"><code class="language-c"><span class="token keyword">case</span> <span class="token string">\';\'</span><span class="token operator">:</span>\n  t<span class="token operator">-></span>token <span class="token operator">=</span> T_SEMI<span class="token punctuation">;</span>\n  <span class="token keyword">break</span><span class="token punctuation">;</span>\n<span class="token keyword">default</span><span class="token operator">:</span>\n\n  <span class="token comment">// If it\'s a digit, scan the</span>\n  <span class="token comment">// literal integer value in</span>\n  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isdigit</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    t<span class="token operator">-></span>intvalue <span class="token operator">=</span> <span class="token function">scanint</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    t<span class="token operator">-></span>token <span class="token operator">=</span> T_INTLIT<span class="token punctuation">;</span>\n    <span class="token keyword">break</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isalpha</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token string">\'_\'</span> <span class="token operator">==</span> c<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token comment">// Read in a keyword or identifier</span>\n    <span class="token function">scanident</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span> Text<span class="token punctuation">,</span> TEXTLEN<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token comment">// If it\'s a recognised keyword, return that token</span>\n    <span class="token keyword">if</span> <span class="token punctuation">(</span>tokentype <span class="token operator">=</span> <span class="token function">keyword</span><span class="token punctuation">(</span>Text<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      t<span class="token operator">-></span>token <span class="token operator">=</span> tokentype<span class="token punctuation">;</span>\n      <span class="token keyword">break</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n    <span class="token comment">// Not a recognised keyword, so an error for now</span>\n    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Unrecognised symbol %s on line %d\\n"</span><span class="token punctuation">,</span> Text<span class="token punctuation">,</span> Line<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n  <span class="token comment">// The character isn\'t part of any recognised token, error</span>\n  <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Unrecognised character %c on line %d\\n"</span><span class="token punctuation">,</span> c<span class="token punctuation">,</span> Line<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>我还添加了一个全局 Text 缓冲区来存储关键字和标识符：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="65453277225736500000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`#define TEXTLEN         512             // Length of symbols in input\nextern_ char Text[TEXTLEN + 1];         // Last identifier scanned`, `65453277225736500000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                c 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="c"><pre style="counter-reset: linenumber NaN" class="language-c line-numbers"><code class="language-c"><span class="token macro property">#<span class="token directive keyword">define</span> TEXTLEN         512             </span><span class="token comment">// Length of symbols in input</span>\nextern_ <span class="token keyword">char</span> Text<span class="token punctuation">[</span>TEXTLEN <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>         <span class="token comment">// Last identifier scanned</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<h2 id="对表达式解析器的更改"><a href="#%E5%AF%B9%E8%A1%A8%E8%BE%BE%E5%BC%8F%E8%A7%A3%E6%9E%90%E5%99%A8%E7%9A%84%E6%9B%B4%E6%94%B9" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>对表达式解析器的更改</h2>\n<p>到目前为止我们的输入文件只包含一个表达式，因此在 binexpr()（expr.c）中的 Pratt 解析器代码中，我们有以下代码退出解析器：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="78879489505755480000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// If no tokens left, return just the left node\ntokentype = Token.token;\nif (tokentype == T_EOF)\n  return (left);`, `78879489505755480000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                c 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="c"><pre style="counter-reset: linenumber NaN" class="language-c line-numbers"><code class="language-c"><span class="token comment">// If no tokens left, return just the left node</span>\ntokentype <span class="token operator">=</span> Token<span class="token punctuation">.</span>token<span class="token punctuation">;</span>\n<span class="token keyword">if</span> <span class="token punctuation">(</span>tokentype <span class="token operator">==</span> T_EOF<span class="token punctuation">)</span>\n  <span class="token keyword">return</span> <span class="token punctuation">(</span>left<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>使用我们的新语法每个表达式都以分号结尾（不是以文件结尾即 T<em>EOF），因此我们需要在表达式解析器中更改代码以发现 T</em>SEMI 标记并退出表达式解析：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="51262803219650000000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// Return an AST tree whose root is a binary operator.\n// Parameter ptp is the previous token\'s precedence.\nstruct ASTnode *binexpr(int ptp) {\n  struct ASTnode *left, *right;\n  int tokentype;\n\n  // Get the integer literal on the left.\n  // Fetch the next token at the same time.\n  left = primary();\n\n  // If we hit a semicolon, return just the left node\n  tokentype = Token.token;\n  if (tokentype == T_SEMI)\n    return (left);\n\n    while (op_precedence(tokentype) > ptp) {\n      ...\n\n    // Update the details of the current token.\n    // If we hit a semicolon, return just the left node\n    tokentype = Token.token;\n    if (tokentype == T_SEMI)\n      return (left);\n    }\n}`, `51262803219650000000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                c 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="c"><pre style="counter-reset: linenumber NaN" class="language-c line-numbers"><code class="language-c"><span class="token comment">// Return an AST tree whose root is a binary operator.</span>\n<span class="token comment">// Parameter ptp is the previous token\'s precedence.</span>\n<span class="token keyword">struct</span> <span class="token class-name">ASTnode</span> <span class="token operator">*</span><span class="token function">binexpr</span><span class="token punctuation">(</span><span class="token keyword">int</span> ptp<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">struct</span> <span class="token class-name">ASTnode</span> <span class="token operator">*</span>left<span class="token punctuation">,</span> <span class="token operator">*</span>right<span class="token punctuation">;</span>\n  <span class="token keyword">int</span> tokentype<span class="token punctuation">;</span>\n\n  <span class="token comment">// Get the integer literal on the left.</span>\n  <span class="token comment">// Fetch the next token at the same time.</span>\n  left <span class="token operator">=</span> <span class="token function">primary</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n  <span class="token comment">// If we hit a semicolon, return just the left node</span>\n  tokentype <span class="token operator">=</span> Token<span class="token punctuation">.</span>token<span class="token punctuation">;</span>\n  <span class="token keyword">if</span> <span class="token punctuation">(</span>tokentype <span class="token operator">==</span> T_SEMI<span class="token punctuation">)</span>\n    <span class="token keyword">return</span> <span class="token punctuation">(</span>left<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token function">op_precedence</span><span class="token punctuation">(</span>tokentype<span class="token punctuation">)</span> <span class="token operator">></span> ptp<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>\n\n    <span class="token comment">// Update the details of the current token.</span>\n    <span class="token comment">// If we hit a semicolon, return just the left node</span>\n    tokentype <span class="token operator">=</span> Token<span class="token punctuation">.</span>token<span class="token punctuation">;</span>\n    <span class="token keyword">if</span> <span class="token punctuation">(</span>tokentype <span class="token operator">==</span> T_SEMI<span class="token punctuation">)</span>\n      <span class="token keyword">return</span> <span class="token punctuation">(</span>left<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id="对代码生成器的更改"><a href="#%E5%AF%B9%E4%BB%A3%E7%A0%81%E7%94%9F%E6%88%90%E5%99%A8%E7%9A%84%E6%9B%B4%E6%94%B9" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>对代码生成器的更改</h2>\n<p>我想将通用代码生成器 gen.c 与 CPU 中的特定代码分开 cg.c，这也意味着其余的编译器只能调用 gen.c 的代码，并且 gen.c 只可以调用 cg.c 中的代码。</p>\n<p>为此我在 gen.c 中定义了一些新的函数：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="19701584716759620000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`void genpreamble()        { cgpreamble(); }\nvoid genpostamble()       { cgpostamble(); }\nvoid genfreeregs()        { freeall_registers(); }\nvoid genprintint(int reg) { cgprintint(reg); }`, `19701584716759620000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                c 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="c"><pre style="counter-reset: linenumber NaN" class="language-c line-numbers"><code class="language-c"><span class="token keyword">void</span> <span class="token function">genpreamble</span><span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token punctuation">{</span> <span class="token function">cgpreamble</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>\n<span class="token keyword">void</span> <span class="token function">genpostamble</span><span class="token punctuation">(</span><span class="token punctuation">)</span>       <span class="token punctuation">{</span> <span class="token function">cgpostamble</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>\n<span class="token keyword">void</span> <span class="token function">genfreeregs</span><span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token punctuation">{</span> <span class="token function">freeall_registers</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>\n<span class="token keyword">void</span> <span class="token function">genprintint</span><span class="token punctuation">(</span><span class="token keyword">int</span> reg<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token function">cgprintint</span><span class="token punctuation">(</span>reg<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id="为语句添加解析器"><a href="#%E4%B8%BA%E8%AF%AD%E5%8F%A5%E6%B7%BB%E5%8A%A0%E8%A7%A3%E6%9E%90%E5%99%A8" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>为语句添加解析器</h2>\n<p>stmt.c 将保存我们语言中所有主要语句的解析代码，现在我们需要解析 BNF 语法通过此单个功能即可完成，我已经将递归定义转换为循环：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="52451144462138250000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// Parse one or more statements\nvoid statements(void) {\n  struct ASTnode *tree;\n  int reg;\n\n  while (1) {\n    // Match a \'print\' as the first token\n    match(T_PRINT, &quot;print&quot;);\n\n    // Parse the following expression and\n    // generate the assembly code\n    tree = binexpr(0);\n    reg = genAST(tree);\n    genprintint(reg);\n    genfreeregs();\n\n    // Match the following semicolon\n    // and stop if we are at EOF\n    semi();\n    if (Token.token == T_EOF)\n      return;\n  }\n}`, `52451144462138250000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                c 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="c"><pre style="counter-reset: linenumber NaN" class="language-c line-numbers"><code class="language-c"><span class="token comment">// Parse one or more statements</span>\n<span class="token keyword">void</span> <span class="token function">statements</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">struct</span> <span class="token class-name">ASTnode</span> <span class="token operator">*</span>tree<span class="token punctuation">;</span>\n  <span class="token keyword">int</span> reg<span class="token punctuation">;</span>\n\n  <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token comment">// Match a \'print\' as the first token</span>\n    <span class="token function">match</span><span class="token punctuation">(</span>T_PRINT<span class="token punctuation">,</span> <span class="token string">"print"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token comment">// Parse the following expression and</span>\n    <span class="token comment">// generate the assembly code</span>\n    tree <span class="token operator">=</span> <span class="token function">binexpr</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    reg <span class="token operator">=</span> <span class="token function">genAST</span><span class="token punctuation">(</span>tree<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">genprintint</span><span class="token punctuation">(</span>reg<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">genfreeregs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token comment">// Match the following semicolon</span>\n    <span class="token comment">// and stop if we are at EOF</span>\n    <span class="token function">semi</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">if</span> <span class="token punctuation">(</span>Token<span class="token punctuation">.</span>token <span class="token operator">==</span> T_EOF<span class="token punctuation">)</span>\n      <span class="token keyword">return</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>在每个循环中代码都会找到一个 <code class="language-text">T_PRINT</code> 元素，然后它调用 <code class="language-text">binexpr()</code> 解析表达式，最后它找到 <code class="language-text">T_SEMI</code> 元素，如果紧跟着 <code class="language-text">T_EOF</code> 元素，我们就会跳出循环。</p>\n<p>在每个表达式树之后，将 gen.c 调用的代码以将树转换为汇编代码，并调用 printint() 函数以打印出最终值。</p>\n<h2 id="一些辅助功能"><a href="#%E4%B8%80%E4%BA%9B%E8%BE%85%E5%8A%A9%E5%8A%9F%E8%83%BD" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>一些辅助功能</h2>\n<p>上面的代码中有几个新的辅助函数，我将它们放入一个新文件中 misc.c：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="35723518793958654000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// Ensure that the current token is t,\n// and fetch the next token. Otherwise\n// throw an error\nvoid match(int t, char *what) {\n  if (Token.token == t) {\n    scan(&Token);\n  } else {\n    printf(&quot;%s expected on line %d\\n&quot;, what, Line);\n    exit(1);\n  }\n}\n\n// Match a semicon and fetch the next token\nvoid semi(void) {\n  match(T_SEMI, &quot;;&quot;);\n}`, `35723518793958654000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                c 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="c"><pre style="counter-reset: linenumber NaN" class="language-c line-numbers"><code class="language-c"><span class="token comment">// Ensure that the current token is t,</span>\n<span class="token comment">// and fetch the next token. Otherwise</span>\n<span class="token comment">// throw an error</span>\n<span class="token keyword">void</span> <span class="token function">match</span><span class="token punctuation">(</span><span class="token keyword">int</span> t<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span>what<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">if</span> <span class="token punctuation">(</span>Token<span class="token punctuation">.</span>token <span class="token operator">==</span> t<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token function">scan</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>Token<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>\n    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%s expected on line %d\\n"</span><span class="token punctuation">,</span> what<span class="token punctuation">,</span> Line<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n\n<span class="token comment">// Match a semicon and fetch the next token</span>\n<span class="token keyword">void</span> <span class="token function">semi</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token function">match</span><span class="token punctuation">(</span>T_SEMI<span class="token punctuation">,</span> <span class="token string">";"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>这些构成了解析器中语法检查的一部分，稍后我将添加更多简短函数 match() 以使我们的语法检查更加容易。</p>\n<h2 id="更改为-main"><a href="#%E6%9B%B4%E6%94%B9%E4%B8%BA-main" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>更改为 main()</h2>\n<p>main() 用于 binexpr() 直接调用以解析旧输入文件中的单个表达式，现在执行此操作：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="97123040391320760000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`scan(&Token);                 // Get the first token from the input\ngenpreamble();                // Output the preamble\nstatements();                 // Parse the statements in the input\ngenpostamble();               // Output the postamble\nfclose(Outfile);              // Close the output file and exit\nexit(0);`, `97123040391320760000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                c 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="c"><pre style="counter-reset: linenumber NaN" class="language-c line-numbers"><code class="language-c"><span class="token function">scan</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>Token<span class="token punctuation">)</span><span class="token punctuation">;</span>                 <span class="token comment">// Get the first token from the input</span>\n<span class="token function">genpreamble</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token comment">// Output the preamble</span>\n<span class="token function">statements</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                 <span class="token comment">// Parse the statements in the input</span>\n<span class="token function">genpostamble</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>               <span class="token comment">// Output the postamble</span>\n<span class="token function">fclose</span><span class="token punctuation">(</span>Outfile<span class="token punctuation">)</span><span class="token punctuation">;</span>              <span class="token comment">// Close the output file and exit</span>\n<span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h1 id="运行结果"><a href="#%E8%BF%90%E8%A1%8C%E7%BB%93%E6%9E%9C" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>运行结果</h1>\n<h2 id="输入"><a href="#%E8%BE%93%E5%85%A5" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>输入</h2>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="83729049327687580000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`print 12 * 3;\nprint\n   18 - 2\n      * 4; print\n1 + 2 +\n  9 - 5/2 + 3*5;`, `83729049327687580000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="text"><pre style="counter-reset: linenumber NaN" class="language-text line-numbers"><code class="language-text">print 12 * 3;\nprint\n   18 - 2\n      * 4; print\n1 + 2 +\n  9 - 5/2 + 3*5;</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id="输出"><a href="#%E8%BE%93%E5%87%BA" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>输出</h2>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="41962652706702540000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`\\$ make test\n# -o：编译可执行文件的地址 -g：便于调试\ncc -o comp1 -g cg.c expr.c gen.c main.c misc.c scan.c stmt.c tree.c\n# 执行并生成汇编文件\n./comp1 input01\n# 编译汇编文件 out.s 到可执行文件 out\ncc -o out out.s\n./out\n36\n10\n25`, `41962652706702540000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                bash 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">$ <span class="token function">make</span> <span class="token builtin class-name">test</span>\n<span class="token comment"># -o：编译可执行文件的地址 -g：便于调试</span>\ncc -o comp1 -g cg.c expr.c gen.c main.c misc.c scan.c stmt.c tree.c\n<span class="token comment"># 执行并生成汇编文件</span>\n./comp1 input01\n<span class="token comment"># 编译汇编文件 out.s 到可执行文件 out</span>\ncc -o out out.s\n./out\n<span class="token number">36</span>\n<span class="token number">10</span>\n<span class="token number">25</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>out.s</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="693171611101961500"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`\t.text\n.LC0:\n\t.string\t&quot;%d\\n&quot;\nprintint:\n\tpushq\t%rbp\n\tmovq\t%rsp, %rbp\n\tsubq\t\\$16, %rsp\n\tmovl\t%edi, -4(%rbp)\n\tmovl\t-4(%rbp), %eax\n\tmovl\t%eax, %esi\n\tleaq\t.LC0(%rip), %rdi\n\tmovl\t\\$0, %eax\n\tcall\tprintf@PLT\n\tnop\n\tleave\n\tret\n\n\t.globl\tmain\n\t.type\tmain, @function\nmain:\n\tpushq\t%rbp\n\tmovq\t%rsp, %rbp\n\tmovq\t\\$12, %r8\n\tmovq\t\\$3, %r9\n\timulq\t%r8, %r9\n\tmovq\t%r9, %rdi\n\tcall\tprintint\n\tmovq\t\\$18, %r8\n\tmovq\t\\$2, %r9\n\tmovq\t\\$4, %r10\n\timulq\t%r9, %r10\n\tsubq\t%r10, %r8\n\tmovq\t%r8, %rdi\n\tcall\tprintint\n\tmovq\t\\$1, %r8\n\tmovq\t\\$2, %r9\n\taddq\t%r8, %r9\n\tmovq\t\\$9, %r8\n\taddq\t%r9, %r8\n\tmovq\t\\$5, %r9\n\tmovq\t\\$2, %r10\n\tmovq\t%r9,%rax\n\tcqo\n\tidivq\t%r10\n\tmovq\t%rax,%r9\n\tsubq\t%r9, %r8\n\tmovq\t\\$3, %r9\n\tmovq\t\\$5, %r10\n\timulq\t%r9, %r10\n\taddq\t%r8, %r10\n\tmovq\t%r10, %rdi\n\tcall\tprintint\n\tmovl\t\\$0, %eax\n\tpopq\t%rbp\n\tret`, `693171611101961500`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="text"><pre style="counter-reset: linenumber NaN" class="language-text line-numbers"><code class="language-text">\t.text\n.LC0:\n\t.string\t&quot;%d\\n&quot;\nprintint:\n\tpushq\t%rbp\n\tmovq\t%rsp, %rbp\n\tsubq\t$16, %rsp\n\tmovl\t%edi, -4(%rbp)\n\tmovl\t-4(%rbp), %eax\n\tmovl\t%eax, %esi\n\tleaq\t.LC0(%rip), %rdi\n\tmovl\t$0, %eax\n\tcall\tprintf@PLT\n\tnop\n\tleave\n\tret\n\n\t.globl\tmain\n\t.type\tmain, @function\nmain:\n\tpushq\t%rbp\n\tmovq\t%rsp, %rbp\n\tmovq\t$12, %r8\n\tmovq\t$3, %r9\n\timulq\t%r8, %r9\n\tmovq\t%r9, %rdi\n\tcall\tprintint\n\tmovq\t$18, %r8\n\tmovq\t$2, %r9\n\tmovq\t$4, %r10\n\timulq\t%r9, %r10\n\tsubq\t%r10, %r8\n\tmovq\t%r8, %rdi\n\tcall\tprintint\n\tmovq\t$1, %r8\n\tmovq\t$2, %r9\n\taddq\t%r8, %r9\n\tmovq\t$9, %r8\n\taddq\t%r9, %r8\n\tmovq\t$5, %r9\n\tmovq\t$2, %r10\n\tmovq\t%r9,%rax\n\tcqo\n\tidivq\t%r10\n\tmovq\t%rax,%r9\n\tsubq\t%r9, %r8\n\tmovq\t$3, %r9\n\tmovq\t$5, %r10\n\timulq\t%r9, %r10\n\taddq\t%r8, %r10\n\tmovq\t%r10, %rdi\n\tcall\tprintint\n\tmovl\t$0, %eax\n\tpopq\t%rbp\n\tret</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h1 id="结论"><a href="#%E7%BB%93%E8%AE%BA" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>结论</h1>\n<p>我们已经在语言中添加了第一个 “真实” 语句语法，我已经用 BNF 表示法定义了它，但是通过循环而不是递归地实现它更容易。不用担心，我们将尽快返回递归解析。</p>\n<p>在此过程中，我们必须修改扫描程序，添加对关键字和标识符的支持，并更清晰地将通用代码生成器和特定于 CPU 的生成器分开。</p>\n<p>在编译器编写过程的下一部分中，我们将向语言添加变量。这将需要大量的工作。</p>',
excerpt:"需求 在语言中添加一些声明语句： 准备 BNF 语法说明 我们已经看到了表达式的 BNF 表示法，现在让我们为以上语句定义 BNF 语法： 输入文件由几个语句组成，它们可以是一个语句，也可以是后面跟有更多语句的语句，每个语句均以关键字开头 print…",frontmatter:{date:"2020-03-04 14:42:21",path:"/tour-of-compiler-declarative-statement/",tags:"编译原理, 声明语句",title:"编译器之旅（五）——声明语句",draft:null}},prePost:{html:'<h1 id="需求"><a href="#%E9%9C%80%E6%B1%82" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>需求</h1>\n<p>接下来我要添加 IF 语句，但是后来我意识到最好先添加一些比较运算符。事实证明这很容易，因为它们像现有的一样是二进制运算符。</p>\n<p>因此让我们赶紧看看增加六个比较符有什么变化：==，!=，&#x3C;，>，&#x3C;= 和 >=。</p>\n<h1 id="核心逻辑"><a href="#%E6%A0%B8%E5%BF%83%E9%80%BB%E8%BE%91" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>核心逻辑</h1>\n<h2 id="添加新令牌"><a href="#%E6%B7%BB%E5%8A%A0%E6%96%B0%E4%BB%A4%E7%89%8C" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>添加新令牌</h2>\n<p>我们有六个新令牌，所以我们将它们添加到 defs.h：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="69477456021012275000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// Token types\nenum {\n  T_EOF,\n  T_PLUS, T_MINUS,\n  T_STAR, T_SLASH,\n  T_EQ, T_NE,\n  T_LT, T_GT, T_LE, T_GE,\n  T_INTLIT, T_SEMI, T_ASSIGN, T_IDENT,\n  // Keywords\n  T_PRINT, T_INT\n};`, `69477456021012275000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                c 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="c"><pre style="counter-reset: linenumber NaN" class="language-c line-numbers"><code class="language-c"><span class="token comment">// Token types</span>\n<span class="token keyword">enum</span> <span class="token punctuation">{</span>\n  T_EOF<span class="token punctuation">,</span>\n  T_PLUS<span class="token punctuation">,</span> T_MINUS<span class="token punctuation">,</span>\n  T_STAR<span class="token punctuation">,</span> T_SLASH<span class="token punctuation">,</span>\n  T_EQ<span class="token punctuation">,</span> T_NE<span class="token punctuation">,</span>\n  T_LT<span class="token punctuation">,</span> T_GT<span class="token punctuation">,</span> T_LE<span class="token punctuation">,</span> T_GE<span class="token punctuation">,</span>\n  T_INTLIT<span class="token punctuation">,</span> T_SEMI<span class="token punctuation">,</span> T_ASSIGN<span class="token punctuation">,</span> T_IDENT<span class="token punctuation">,</span>\n  <span class="token comment">// Keywords</span>\n  T_PRINT<span class="token punctuation">,</span> T_INT\n<span class="token punctuation">}</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>我已经重新排列了令牌，以便让令牌从低到高的优先级顺序出现。</p>\n<h2 id="扫描令牌"><a href="#%E6%89%AB%E6%8F%8F%E4%BB%A4%E7%89%8C" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>扫描令牌</h2>\n<p>现在我们必须扫描它们，请注意我们必须区分 = 和 ==，&#x3C; 和 &#x3C;=，> 和 >=。因此我们将需要从输入中读取一个额外的字符，然后在不需要时将其放回原处，下面是来自 scan.c 新的代码 scan()：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="40521208461764215000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`case \'=\':\n  if ((c = next()) == \'=\') {\n    t->token = T_EQ;\n  } else {\n    putback(c);\n    t->token = T_ASSIGN;\n  }\n  break;\ncase \'!\':\n  if ((c = next()) == \'=\') {\n    t->token = T_NE;\n  } else {\n    fatalc(&quot;Unrecognised character&quot;, c);\n  }\n  break;\ncase \'<\':\n  if ((c = next()) == \'=\') {\n    t->token = T_LE;\n  } else {\n    putback(c);\n    t->token = T_LT;\n  }\n  break;\ncase \'>\':\n  if ((c = next()) == \'=\') {\n    t->token = T_GE;\n  } else {\n    putback(c);\n    t->token = T_GT;\n  }\n  break;`, `40521208461764215000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                c 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="c"><pre style="counter-reset: linenumber NaN" class="language-c line-numbers"><code class="language-c"><span class="token keyword">case</span> <span class="token string">\'=\'</span><span class="token operator">:</span>\n  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>c <span class="token operator">=</span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">\'=\'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    t<span class="token operator">-></span>token <span class="token operator">=</span> T_EQ<span class="token punctuation">;</span>\n  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>\n    <span class="token function">putback</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    t<span class="token operator">-></span>token <span class="token operator">=</span> T_ASSIGN<span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n  <span class="token keyword">break</span><span class="token punctuation">;</span>\n<span class="token keyword">case</span> <span class="token string">\'!\'</span><span class="token operator">:</span>\n  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>c <span class="token operator">=</span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">\'=\'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    t<span class="token operator">-></span>token <span class="token operator">=</span> T_NE<span class="token punctuation">;</span>\n  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>\n    <span class="token function">fatalc</span><span class="token punctuation">(</span><span class="token string">"Unrecognised character"</span><span class="token punctuation">,</span> c<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n  <span class="token keyword">break</span><span class="token punctuation">;</span>\n<span class="token keyword">case</span> <span class="token string">\'&lt;\'</span><span class="token operator">:</span>\n  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>c <span class="token operator">=</span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">\'=\'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    t<span class="token operator">-></span>token <span class="token operator">=</span> T_LE<span class="token punctuation">;</span>\n  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>\n    <span class="token function">putback</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    t<span class="token operator">-></span>token <span class="token operator">=</span> T_LT<span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n  <span class="token keyword">break</span><span class="token punctuation">;</span>\n<span class="token keyword">case</span> <span class="token string">\'>\'</span><span class="token operator">:</span>\n  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>c <span class="token operator">=</span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">\'=\'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    t<span class="token operator">-></span>token <span class="token operator">=</span> T_GE<span class="token punctuation">;</span>\n  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>\n    <span class="token function">putback</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    t<span class="token operator">-></span>token <span class="token operator">=</span> T_GT<span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n  <span class="token keyword">break</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>我还将 = 令牌的名称更改为 T<em>ASSIGN，以确保不会与新的 T</em>EQ 令牌混淆。</p>\n<h2 id="新的表达代码"><a href="#%E6%96%B0%E7%9A%84%E8%A1%A8%E8%BE%BE%E4%BB%A3%E7%A0%81" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>新的表达代码</h2>\n<p>现在我们可以扫描六个新令牌，因此我们必须解析它们何时出现在表达式中，并强制其运算符优先级。</p>\n<p>到现在为止，您已经知道：</p>\n<ul>\n<li>我正在构建将成为自编译器的东西</li>\n<li>用 C 语言</li>\n<li>使用 SubC 编译器作为参考</li>\n</ul>\n<p>这意味着我正在为足够一部分 C 的子集（就像 SubC）编写一个编译器，以便它可以自己编译。因此我应该使用普通的 C 运算符优先顺序，这意味着比较运算符的优先级高于乘法和除法。</p>\n<p>我还意识到我用来将令牌映射到 AST 节点类型的 switch 语句只会变得更大，因此我决定重新排列 AST 节点类型，以便所有二进制运算符（在 defs.h 中）之间都具有 1:1 的映射：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="37596552642841010000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// AST node types. The first few line up\n// with the related tokens\nenum {\n  A_ADD=1, A_SUBTRACT, A_MULTIPLY, A_DIVIDE,\n  A_EQ, A_NE, A_LT, A_GT, A_LE, A_GE,\n  A_INTLIT,\n  A_IDENT, A_LVIDENT, A_ASSIGN\n};`, `37596552642841010000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                c 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="c"><pre style="counter-reset: linenumber NaN" class="language-c line-numbers"><code class="language-c"><span class="token comment">// AST node types. The first few line up</span>\n<span class="token comment">// with the related tokens</span>\n<span class="token keyword">enum</span> <span class="token punctuation">{</span>\n  A_ADD<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> A_SUBTRACT<span class="token punctuation">,</span> A_MULTIPLY<span class="token punctuation">,</span> A_DIVIDE<span class="token punctuation">,</span>\n  A_EQ<span class="token punctuation">,</span> A_NE<span class="token punctuation">,</span> A_LT<span class="token punctuation">,</span> A_GT<span class="token punctuation">,</span> A_LE<span class="token punctuation">,</span> A_GE<span class="token punctuation">,</span>\n  A_INTLIT<span class="token punctuation">,</span>\n  A_IDENT<span class="token punctuation">,</span> A_LVIDENT<span class="token punctuation">,</span> A_ASSIGN\n<span class="token punctuation">}</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>在 expr.c 中我可以简化令牌到 AST 节点的转换，还可以添加新令牌的优先级：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="22443279799936190000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// Convert a binary operator token into an AST operation.\n// We rely on a 1:1 mapping from token to AST operation\nstatic int arithop(int tokentype) {\n  if (tokentype > T_EOF && tokentype < T_INTLIT)\n    return(tokentype);\n  fatald(&quot;Syntax error, token&quot;, tokentype);\n}\n\n// Operator precedence for each token. Must\n// match up with the order of tokens in defs.h\nstatic int OpPrec[] = {\n  0, 10, 10,                    // T_EOF, T_PLUS, T_MINUS\n  20, 20,                       // T_STAR, T_SLASH\n  30, 30,                       // T_EQ, T_NE\n  40, 40, 40, 40                // T_LT, T_GT, T_LE, T_GE\n};`, `22443279799936190000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                c 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="c"><pre style="counter-reset: linenumber NaN" class="language-c line-numbers"><code class="language-c"><span class="token comment">// Convert a binary operator token into an AST operation.</span>\n<span class="token comment">// We rely on a 1:1 mapping from token to AST operation</span>\n<span class="token keyword">static</span> <span class="token keyword">int</span> <span class="token function">arithop</span><span class="token punctuation">(</span><span class="token keyword">int</span> tokentype<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">if</span> <span class="token punctuation">(</span>tokentype <span class="token operator">></span> T_EOF <span class="token operator">&amp;&amp;</span> tokentype <span class="token operator">&lt;</span> T_INTLIT<span class="token punctuation">)</span>\n    <span class="token keyword">return</span><span class="token punctuation">(</span>tokentype<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token function">fatald</span><span class="token punctuation">(</span><span class="token string">"Syntax error, token"</span><span class="token punctuation">,</span> tokentype<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token comment">// Operator precedence for each token. Must</span>\n<span class="token comment">// match up with the order of tokens in defs.h</span>\n<span class="token keyword">static</span> <span class="token keyword">int</span> OpPrec<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span>\n  <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span>                    <span class="token comment">// T_EOF, T_PLUS, T_MINUS</span>\n  <span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span>                       <span class="token comment">// T_STAR, T_SLASH</span>\n  <span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">,</span>                       <span class="token comment">// T_EQ, T_NE</span>\n  <span class="token number">40</span><span class="token punctuation">,</span> <span class="token number">40</span><span class="token punctuation">,</span> <span class="token number">40</span><span class="token punctuation">,</span> <span class="token number">40</span>                <span class="token comment">// T_LT, T_GT, T_LE, T_GE</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>解析和运算符优先级就到此了！</p>\n<h2 id="代码生成"><a href="#%E4%BB%A3%E7%A0%81%E7%94%9F%E6%88%90" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>代码生成</h2>\n<p>由于这六个新运算符是二进制运算符，因此很容易修改通用代码生成器 gen.c 来处理它们：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="74714778624362020000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`case A_EQ:\n  return (cgequal(leftreg, rightreg));\ncase A_NE:\n  return (cgnotequal(leftreg, rightreg));\ncase A_LT:\n  return (cglessthan(leftreg, rightreg));\ncase A_GT:\n  return (cggreaterthan(leftreg, rightreg));\ncase A_LE:\n  return (cglessequal(leftreg, rightreg));\ncase A_GE:\n  return (cggreaterequal(leftreg, rightreg));`, `74714778624362020000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                c 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="c"><pre style="counter-reset: linenumber NaN" class="language-c line-numbers"><code class="language-c"><span class="token keyword">case</span> A_EQ<span class="token operator">:</span>\n  <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token function">cgequal</span><span class="token punctuation">(</span>leftreg<span class="token punctuation">,</span> rightreg<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">case</span> A_NE<span class="token operator">:</span>\n  <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token function">cgnotequal</span><span class="token punctuation">(</span>leftreg<span class="token punctuation">,</span> rightreg<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">case</span> A_LT<span class="token operator">:</span>\n  <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token function">cglessthan</span><span class="token punctuation">(</span>leftreg<span class="token punctuation">,</span> rightreg<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">case</span> A_GT<span class="token operator">:</span>\n  <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token function">cggreaterthan</span><span class="token punctuation">(</span>leftreg<span class="token punctuation">,</span> rightreg<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">case</span> A_LE<span class="token operator">:</span>\n  <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token function">cglessequal</span><span class="token punctuation">(</span>leftreg<span class="token punctuation">,</span> rightreg<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">case</span> A_GE<span class="token operator">:</span>\n  <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token function">cggreaterequal</span><span class="token punctuation">(</span>leftreg<span class="token punctuation">,</span> rightreg<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id="x86-64-代码生成"><a href="#x86-64-%E4%BB%A3%E7%A0%81%E7%94%9F%E6%88%90" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>x86-64 代码生成</h2>\n<p>在 C 中比较麻烦的是，比较运算符返回一个值，如果它们的执行结果为 true，则结果为 1。如果它们的执行结果为 false，则结果为 0。我们需要编写 x86-64 汇编代码来反映这一点。</p>\n<p>幸运的是有一些 x86-64 指令可以做到这一点，不幸的是在此过程中需要处理一些问题，考虑以下 x86-64 指令：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="68253270929350180000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`cmpq %r8,%r9`, `68253270929350180000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                c 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="c"><pre style="counter-reset: linenumber NaN" class="language-c line-numbers"><code class="language-c">cmpq <span class="token operator">%</span>r8<span class="token punctuation">,</span><span class="token operator">%</span>r9</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>上面的 cmpq 指令执行 <code class="language-text">%r9-%r8</code> 并设置几个状态标志，包括负标志和零标志，因此我们可以查看标志组合以查看比较结果：</p>\n<table>\n<thead>\n<tr>\n<th>比较</th>\n<th>操作</th>\n<th>执行结果</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>%r8 == %r9</td>\n<td>%r9 - %r8</td>\n<td>零</td>\n</tr>\n<tr>\n<td>%r8 != %r9</td>\n<td>%r9 - %r8</td>\n<td>不为零</td>\n</tr>\n<tr>\n<td>%r8 > %r9</td>\n<td>%r9 - %r8</td>\n<td>不为零，负数</td>\n</tr>\n<tr>\n<td>%r8 &#x3C; %r9</td>\n<td>%r9 - %r8</td>\n<td>不为零，不为负</td>\n</tr>\n<tr>\n<td>%r8 >= %r9</td>\n<td>%r9 - %r8</td>\n<td>零或负</td>\n</tr>\n<tr>\n<td>%r8 &#x3C;= %r9</td>\n<td>%r9 - %r8</td>\n<td>零或非负</td>\n</tr>\n</tbody>\n</table>\n<p>问题是这些指令仅设置寄存器的最低字节，如果寄存器的最低位之外的其他位已置 1，则它们将保持置位状态。因此我们可以将变量设置为 1，但是如果它已经具有值 1000（十进制），那么现在它将是 1001，这不是我们想要的。</p>\n<p>解决方案是 andq 在 setX 指令后清除寄存器中不需要的，在 cg.c 中有一个比较功能可以做到这一点：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="10355667585376094000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// Compare two registers.\nstatic int cgcompare(int r1, int r2, char *how) {\n  fprintf(Outfile, &quot;\\tcmpq\\t%s, %s\\n&quot;, reglist[r2], reglist[r1]);\n  fprintf(Outfile, &quot;\\t%s\\t%s\\n&quot;, how, breglist[r2]);\n  fprintf(Outfile, &quot;\\tandq\\t\\$255,%s\\n&quot;, reglist[r2]);\n  free_register(r1);\n  return (r2);\n}`, `10355667585376094000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                c 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="c"><pre style="counter-reset: linenumber NaN" class="language-c line-numbers"><code class="language-c"><span class="token comment">// Compare two registers.</span>\n<span class="token keyword">static</span> <span class="token keyword">int</span> <span class="token function">cgcompare</span><span class="token punctuation">(</span><span class="token keyword">int</span> r1<span class="token punctuation">,</span> <span class="token keyword">int</span> r2<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span>how<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token function">fprintf</span><span class="token punctuation">(</span>Outfile<span class="token punctuation">,</span> <span class="token string">"\\tcmpq\\t%s, %s\\n"</span><span class="token punctuation">,</span> reglist<span class="token punctuation">[</span>r2<span class="token punctuation">]</span><span class="token punctuation">,</span> reglist<span class="token punctuation">[</span>r1<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token function">fprintf</span><span class="token punctuation">(</span>Outfile<span class="token punctuation">,</span> <span class="token string">"\\t%s\\t%s\\n"</span><span class="token punctuation">,</span> how<span class="token punctuation">,</span> breglist<span class="token punctuation">[</span>r2<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token function">fprintf</span><span class="token punctuation">(</span>Outfile<span class="token punctuation">,</span> <span class="token string">"\\tandq\\t$255,%s\\n"</span><span class="token punctuation">,</span> reglist<span class="token punctuation">[</span>r2<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token function">free_register</span><span class="token punctuation">(</span>r1<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token keyword">return</span> <span class="token punctuation">(</span>r2<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>指令 how 之一在哪里 setX，请注意我们执行</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="61241795899331580000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`cmpq reglist[r2], reglist[r1]`, `61241795899331580000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                c 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="c"><pre style="counter-reset: linenumber NaN" class="language-c line-numbers"><code class="language-c">cmpq reglist<span class="token punctuation">[</span>r2<span class="token punctuation">]</span><span class="token punctuation">,</span> reglist<span class="token punctuation">[</span>r1<span class="token punctuation">]</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>因为实际上 <code class="language-text">reglist[r1] - reglist[r2]</code> 是我们真正想要的。</p>\n<h2 id="x86-64-寄存器"><a href="#x86-64-%E5%AF%84%E5%AD%98%E5%99%A8" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>x86-64 寄存器</h2>\n<p>我们需要在这里讨论 x86-64 体系结构中的寄存器，x86-64 有几个 64 位通用寄存器，但是我们也可以使用不同的寄存器名称来访问和处理这些寄存器的子部分。</p>\n<p>\n  <a\n    class="gatsby-resp-image-link"\n    href="/static/2020-03-11-10-20-36-ec8e82992658996a9b56814a2e33b7ac-dab2c.png"\n    style="display: block"\n    target="_blank"\n    rel="noopener"\n  >\n  \n  <span\n    class="gatsby-resp-image-wrapper"\n    style="position: relative; display: block; ; max-width: 397px; margin-left: auto; margin-right: auto;"\n  >\n    <span\n      class="gatsby-resp-image-background-image"\n      style="padding-bottom: 105.54156171284635%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAVCAIAAADJt1n/AAAACXBIWXMAAA7DAAAOwwHHb6hkAAACq0lEQVQ4y1VU21LbMBTM//8InSEhhTDDlIYfKA9MwcS3ECe2Ykvy/cI0TmK7K8nYQQ8aS+ccrXbPypOHh4fp9fXtz9vpdDqbzR5/PS4Wi1sx7sTy93I+ny/u7+czMZ6enm5uZneLxY+rq+VyOdG0t5eXl83G0XXdtm3LNJ//PK/X64+1GPpq9ff1dbvdIoI9Q9e1N81xHMMwsDnhnIVR3HVd27aYq7JwXbeTa0xxFOVFMURDHn5Wn50cTdNMPNf1/QCR0+nUtG2SJLZlnU5nDGzSwA+jqJNR1Ae+n+c5PhA9Ho8TRmkcJwiL7LbNs8wjpGlxboPNNE0VsoqmaVKWQBZhHDchnrdzPXU2thAG+foooLHp7wll4YBMyP4bMjinaTYi55kfBI2EbgWLuKoqFcXMOc9k8hcyIWEY9cVdl8Sx42zV2TKb5UU5FHueF/JoLPZ9n/PwkrOz2QrGjcgOGcuyfCjek30ok/tid7cjHhk4A9lYXXAmhFLWc+46IdB2N3JGM1RYIRd5Bg+cBWeJHPJBEcyMBkFAR+Q9IejtEAYy1G5Gzhw+u7i2B0XGYkppWVXA7FuVJB/rj0YuhdpxjGUrU5VndjtPnaVMEih7DoKZpnU41G0rWoWzLMs6Hk/KM5xR215LORvZZxbs/WAoLsvCNM30q5lFkRuGnkrBVdvxVA6HA75Fcci+2RPFEKyUvZXFWG5K4RNxE9wLb6uu676YBnvi+wNnOAyCwUaqH/A2oLK8wBJRPDJN0/4dDv214xAeidov5KoqN0Aue2R1kQrPsBUjyzK887o+9siM+pecizwXyJIk3I3s1eodyD3nOHrXtAvOnDHOLzmjsYXMVoIBqizF2wDnLE0h/sgZ6geUDZyh0Nq2C0nyfBYS4N+AtyEpw7yRJRupOP8HOLWbdBJtut4AAAAASUVORK5CYII=\'); background-size: cover; display: block;"\n    >\n      <img\n        class="gatsby-resp-image-image"\n        style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;"\n        alt="2020 03 11 10 20 36"\n        title=""\n        src="/static/2020-03-11-10-20-36-ec8e82992658996a9b56814a2e33b7ac-dab2c.png"\n        srcset="/static/2020-03-11-10-20-36-ec8e82992658996a9b56814a2e33b7ac-06022.png 200w,\n/static/2020-03-11-10-20-36-ec8e82992658996a9b56814a2e33b7ac-dab2c.png 397w"\n        sizes="(max-width: 397px) 100vw, 397px"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<p>上面来自 stack.imgur.com 的图片显示，对于 64 位 <code class="language-text">r8</code> 寄存器，我们可以使用 <code class="language-text">r8d</code> 寄存器访问该寄存器的低 32 位。同样 <code class="language-text">r8w</code> 寄存器是 <code class="language-text">r8</code> 寄存器的低 16 位，<code class="language-text">r8b</code> 寄存器是 <code class="language-text">r8</code> 寄存器的低 8 位。</p>\n<p>在该 cgcompare() 函数中，代码使用 <code class="language-text">reglist[]</code> 数组比较两个 64 位寄存器，然后通过使用 <code class="language-text">breglist[]</code> 数组中的名称在第二个寄存器的 8 位版本中设置标志，x86-64 体系结构仅允许 setX 指令对 8 位寄存器名称进行操作，因此需要 <code class="language-text">breglist[]</code> 阵列。</p>\n<h2 id="创建多个比较指令"><a href="#%E5%88%9B%E5%BB%BA%E5%A4%9A%E4%B8%AA%E6%AF%94%E8%BE%83%E6%8C%87%E4%BB%A4" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>创建多个比较指令</h2>\n<p>现在我们有了这个通用功能，我们可以编写六个实际的比较功能：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="11117632208400896000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`int cgequal(int r1, int r2) { return(cgcompare(r1, r2, &quot;sete&quot;)); }\nint cgnotequal(int r1, int r2) { return(cgcompare(r1, r2, &quot;setne&quot;)); }\nint cglessthan(int r1, int r2) { return(cgcompare(r1, r2, &quot;setl&quot;)); }\nint cggreaterthan(int r1, int r2) { return(cgcompare(r1, r2, &quot;setg&quot;)); }\nint cglessequal(int r1, int r2) { return(cgcompare(r1, r2, &quot;setle&quot;)); }\nint cggreaterequal(int r1, int r2) { return(cgcompare(r1, r2, &quot;setge&quot;)); }`, `11117632208400896000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                c 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="c"><pre style="counter-reset: linenumber NaN" class="language-c line-numbers"><code class="language-c"><span class="token keyword">int</span> <span class="token function">cgequal</span><span class="token punctuation">(</span><span class="token keyword">int</span> r1<span class="token punctuation">,</span> <span class="token keyword">int</span> r2<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span><span class="token punctuation">(</span><span class="token function">cgcompare</span><span class="token punctuation">(</span>r1<span class="token punctuation">,</span> r2<span class="token punctuation">,</span> <span class="token string">"sete"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>\n<span class="token keyword">int</span> <span class="token function">cgnotequal</span><span class="token punctuation">(</span><span class="token keyword">int</span> r1<span class="token punctuation">,</span> <span class="token keyword">int</span> r2<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span><span class="token punctuation">(</span><span class="token function">cgcompare</span><span class="token punctuation">(</span>r1<span class="token punctuation">,</span> r2<span class="token punctuation">,</span> <span class="token string">"setne"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>\n<span class="token keyword">int</span> <span class="token function">cglessthan</span><span class="token punctuation">(</span><span class="token keyword">int</span> r1<span class="token punctuation">,</span> <span class="token keyword">int</span> r2<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span><span class="token punctuation">(</span><span class="token function">cgcompare</span><span class="token punctuation">(</span>r1<span class="token punctuation">,</span> r2<span class="token punctuation">,</span> <span class="token string">"setl"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>\n<span class="token keyword">int</span> <span class="token function">cggreaterthan</span><span class="token punctuation">(</span><span class="token keyword">int</span> r1<span class="token punctuation">,</span> <span class="token keyword">int</span> r2<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span><span class="token punctuation">(</span><span class="token function">cgcompare</span><span class="token punctuation">(</span>r1<span class="token punctuation">,</span> r2<span class="token punctuation">,</span> <span class="token string">"setg"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>\n<span class="token keyword">int</span> <span class="token function">cglessequal</span><span class="token punctuation">(</span><span class="token keyword">int</span> r1<span class="token punctuation">,</span> <span class="token keyword">int</span> r2<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span><span class="token punctuation">(</span><span class="token function">cgcompare</span><span class="token punctuation">(</span>r1<span class="token punctuation">,</span> r2<span class="token punctuation">,</span> <span class="token string">"setle"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>\n<span class="token keyword">int</span> <span class="token function">cggreaterequal</span><span class="token punctuation">(</span><span class="token keyword">int</span> r1<span class="token punctuation">,</span> <span class="token keyword">int</span> r2<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span><span class="token punctuation">(</span><span class="token function">cgcompare</span><span class="token punctuation">(</span>r1<span class="token punctuation">,</span> r2<span class="token punctuation">,</span> <span class="token string">"setge"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>与其他二进制运算符函数一样，一个寄存器被释放，另一个寄存器返回结果。</p>\n<h1 id="运行结果"><a href="#%E8%BF%90%E8%A1%8C%E7%BB%93%E6%9E%9C" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>运行结果</h1>\n<h2 id="输入"><a href="#%E8%BE%93%E5%85%A5" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>输入</h2>\n<p>input04</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="156265301357705340"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`int x;\nx= 7 < 9;  print x;\nx= 7 <= 9; print x;\nx= 7 != 9; print x;\nx= 7 == 7; print x;\nx= 7 >= 7; print x;\nx= 7 <= 7; print x;\nx= 9 > 7;  print x;\nx= 9 >= 7; print x;\nx= 9 != 7; print x;`, `156265301357705340`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="text"><pre style="counter-reset: linenumber NaN" class="language-text line-numbers"><code class="language-text">int x;\nx= 7 &lt; 9;  print x;\nx= 7 &lt;= 9; print x;\nx= 7 != 9; print x;\nx= 7 == 7; print x;\nx= 7 &gt;= 7; print x;\nx= 7 &lt;= 7; print x;\nx= 9 &gt; 7;  print x;\nx= 9 &gt;= 7; print x;\nx= 9 != 7; print x;</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id="输出"><a href="#%E8%BE%93%E5%87%BA" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>输出</h2>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="23985190944306180000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`\\$ make test\ncc -o comp1 -g cg.c decl.c expr.c gen.c main.c misc.c scan.c stmt.c sym.c tree.c\n./comp1 input04\ncc -o out out.s\n./out\n1\n1\n1\n1\n1\n1\n1\n1\n1`, `23985190944306180000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                bash 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">$ <span class="token function">make</span> <span class="token builtin class-name">test</span>\ncc -o comp1 -g cg.c decl.c expr.c gen.c main.c misc.c scan.c stmt.c sym.c tree.c\n./comp1 input04\ncc -o out out.s\n./out\n<span class="token number">1</span>\n<span class="token number">1</span>\n<span class="token number">1</span>\n<span class="token number">1</span>\n<span class="token number">1</span>\n<span class="token number">1</span>\n<span class="token number">1</span>\n<span class="token number">1</span>\n<span class="token number">1</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>out.s</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="65375120440961475000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`.text\n.LC0:\n        .string &quot;%d\\n&quot;\nprintint:\n        pushq   %rbp\n        movq    %rsp, %rbp\n        subq    \\$16, %rsp\n        movl    %edi, -4(%rbp)\n        movl    -4(%rbp), %eax\n        movl    %eax, %esi\n        leaq    .LC0(%rip), %rdi\n        movl    \\$0, %eax\n        call    printf@PLT\n        nop\n        leave\n        ret\n\n        .globl  main\n        .type   main, @function\nmain:\n        pushq   %rbp\n        movq    %rsp, %rbp\n        .comm   x,8,8\n        movq    \\$7, %r8\n        movq    \\$9, %r9\n        cmpq    %r9, %r8\n        setl    %r9b\n        andq    \\$255,%r9\n        movq    %r9, x(%rip)\n        movq    x(%rip), %r8\n        movq    %r8, %rdi\n        call    printint\n        movq    \\$7, %r8\n        movq    \\$9, %r9\n        cmpq    %r9, %r8\n        setle   %r9b\n        andq    \\$255,%r9\n        movq    %r9, x(%rip)\n        movq    x(%rip), %r8\n        movq    %r8, %rdi\n        call    printint\n        movq    \\$7, %r8\n        movq    \\$9, %r9\n        cmpq    %r9, %r8\n        setne   %r9b\n        andq    \\$255,%r9\n        movq    %r9, x(%rip)\n        movq    x(%rip), %r8\n        movq    %r8, %rdi\n        call    printint\n        movq    \\$7, %r8\n        movq    \\$7, %r9\n        cmpq    %r9, %r8\n        sete    %r9b\n        andq    \\$255,%r9\n        movq    %r9, x(%rip)\n        movq    x(%rip), %r8\n        movq    %r8, %rdi\n        call    printint\n        movq    \\$7, %r8\n        movq    \\$7, %r9\n        cmpq    %r9, %r8\n        setge   %r9b\n        andq    \\$255,%r9\n        movq    %r9, x(%rip)\n        movq    x(%rip), %r8\n        movq    %r8, %rdi\n        call    printint\n        movq    \\$7, %r8\n        movq    \\$7, %r9\n        cmpq    %r9, %r8\n        setle   %r9b\n        andq    \\$255,%r9\n        movq    %r9, x(%rip)\n        movq    x(%rip), %r8\n        movq    %r8, %rdi\n        call    printint\n        movq    \\$9, %r8\n        movq    \\$7, %r9\n        cmpq    %r9, %r8\n        setg    %r9b\n        andq    \\$255,%r9\n        movq    %r9, x(%rip)\n        movq    x(%rip), %r8\n        movq    %r8, %rdi\n        call    printint\n        movq    \\$9, %r8\n        movq    \\$7, %r9\n        cmpq    %r9, %r8\n        setge   %r9b\n        andq    \\$255,%r9\n        movq    %r9, x(%rip)\n        movq    x(%rip), %r8\n        movq    %r8, %rdi\n        call    printint\n        movq    \\$9, %r8\n        movq    \\$7, %r9\n        cmpq    %r9, %r8\n        setne   %r9b\n        andq    \\$255,%r9\n        movq    %r9, x(%rip)\n        movq    x(%rip), %r8\n        movq    %r8, %rdi\n        call    printint\n        movl    \\$0, %eax\n        popq    %rbp\n        ret`, `65375120440961475000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="text"><pre style="counter-reset: linenumber NaN" class="language-text line-numbers"><code class="language-text">.text\n.LC0:\n        .string &quot;%d\\n&quot;\nprintint:\n        pushq   %rbp\n        movq    %rsp, %rbp\n        subq    $16, %rsp\n        movl    %edi, -4(%rbp)\n        movl    -4(%rbp), %eax\n        movl    %eax, %esi\n        leaq    .LC0(%rip), %rdi\n        movl    $0, %eax\n        call    printf@PLT\n        nop\n        leave\n        ret\n\n        .globl  main\n        .type   main, @function\nmain:\n        pushq   %rbp\n        movq    %rsp, %rbp\n        .comm   x,8,8\n        movq    $7, %r8\n        movq    $9, %r9\n        cmpq    %r9, %r8\n        setl    %r9b\n        andq    $255,%r9\n        movq    %r9, x(%rip)\n        movq    x(%rip), %r8\n        movq    %r8, %rdi\n        call    printint\n        movq    $7, %r8\n        movq    $9, %r9\n        cmpq    %r9, %r8\n        setle   %r9b\n        andq    $255,%r9\n        movq    %r9, x(%rip)\n        movq    x(%rip), %r8\n        movq    %r8, %rdi\n        call    printint\n        movq    $7, %r8\n        movq    $9, %r9\n        cmpq    %r9, %r8\n        setne   %r9b\n        andq    $255,%r9\n        movq    %r9, x(%rip)\n        movq    x(%rip), %r8\n        movq    %r8, %rdi\n        call    printint\n        movq    $7, %r8\n        movq    $7, %r9\n        cmpq    %r9, %r8\n        sete    %r9b\n        andq    $255,%r9\n        movq    %r9, x(%rip)\n        movq    x(%rip), %r8\n        movq    %r8, %rdi\n        call    printint\n        movq    $7, %r8\n        movq    $7, %r9\n        cmpq    %r9, %r8\n        setge   %r9b\n        andq    $255,%r9\n        movq    %r9, x(%rip)\n        movq    x(%rip), %r8\n        movq    %r8, %rdi\n        call    printint\n        movq    $7, %r8\n        movq    $7, %r9\n        cmpq    %r9, %r8\n        setle   %r9b\n        andq    $255,%r9\n        movq    %r9, x(%rip)\n        movq    x(%rip), %r8\n        movq    %r8, %rdi\n        call    printint\n        movq    $9, %r8\n        movq    $7, %r9\n        cmpq    %r9, %r8\n        setg    %r9b\n        andq    $255,%r9\n        movq    %r9, x(%rip)\n        movq    x(%rip), %r8\n        movq    %r8, %rdi\n        call    printint\n        movq    $9, %r8\n        movq    $7, %r9\n        cmpq    %r9, %r8\n        setge   %r9b\n        andq    $255,%r9\n        movq    %r9, x(%rip)\n        movq    x(%rip), %r8\n        movq    %r8, %rdi\n        call    printint\n        movq    $9, %r8\n        movq    $7, %r9\n        cmpq    %r9, %r8\n        setne   %r9b\n        andq    $255,%r9\n        movq    %r9, x(%rip)\n        movq    x(%rip), %r8\n        movq    %r8, %rdi\n        call    printint\n        movl    $0, %eax\n        popq    %rbp\n        ret</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h1 id="结论"><a href="#%E7%BB%93%E8%AE%BA" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>结论</h1>\n<p>这是对编译器的一种很好而又轻松的添加，接下来的旅程将更加复杂。</p>\n<p>在编译器编写过程的下一部分中，我们将 IF 语句添加到编译器中，并使用刚刚添加的比较运算符。</p>',
excerpt:"需求 接下来我要添加 IF…",frontmatter:{date:"2020-03-11 10:03:11",path:"/tour-of-compiler-comparison-operators/",tags:"编译原理, 比较运算符",title:"编译器之旅（七）——比较运算符",draft:null}}},pathContext:{mainPostPath:"/tour-of-compiler-variables/",nextPostPath:"/tour-of-compiler-declarative-statement/",prePostPath:"/tour-of-compiler-comparison-operators/"}}}});