webpackJsonp([0xa5fb6015b06a],{1152:function(n,a){n.exports={data:{file:{childImageSharp:{sizes:{base64:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAeCAYAAAAsEj5rAAAACXBIWXMAAAsSAAALEgHS3X78AAAHlUlEQVRIx11WaWxU1xWewbQlrdofkSIhGiBpMPZ4Vs/2lpm3zupZPOOZ8Sz2YGzANkaAKaYQUrMkLYgiIlxCQjCYQAwYEoMQNJAIFBxaQgUhoCopYceBJo1pKFVDCbOc0/fesOZKV+fM1Tvf/c56R0VYOZW8lvAxtSybvbExAu1+mndGuaDQ2F4rNHVFhCZJZlMeZ1Qrf9Mt+H+qur/ihFORAFA64J0pVTcXVcDmcKFfruIzZ7rY1H89fAZivjbM1MzFxkAnZqWd9M7KJcTmv7zCN44sY+tflm12C79WLxLCqidWN9cwWpYvsfXL13vasZudgm4mgX4hW6h1teRjnrZCwjOzWO/twIR/FjZ7WnEZ35JvcUSeU4gwSXV7W1sJzEH6R8nSRArlXjr6r7S1DqNUvMAzCXCzSfDxDRAUmyDkaoawtEPi1LxHyGLMkby5gEqUy7atjnq1roosAXqE6Yq7DBXa7RLS6HRG8y4hhbwzDiJbj4IkXUwS5e1h07IOorMePUL6ruiKGmRblg2PesJlq9nxrJMMfydIbhIWP9jMPrBLkrIHgXfG0CdmgKMjwFARFKVvHEQo5xUyKDDRN2T7aE17mV5rfZQYm1lM0EQYWUe0aNTxoKl0Qnk5jVqNA/VaFu3SBS7SB7Ju0ougr2KKWg2DBi17mbCaxyghMzgeMTTp2W7CGkTKHshZqn0Q5Osg6opBhAmAzcADY/NheyQJBi2D8mXVehYMOgEsJg9aTIxSN2YTO+ohQ62G6rGZa5AmAjmj0YvzG5vhVP8f4fTO12FtVxfMjTfC6zPbwOsIQNybhK6GlmLCm5DA6cu2aoeSaaOeVheLxRKgpoJcZ5UAly94MeeiQ+jnQtBCcTBTZ8Ght9fDfy58DDdOHIRj2zdA/4uzYWBpZ6Fr6jR8/lfWP8n2usqA2mQgH7msr3Ks0WgEfGvN6lz/q6tgXqgZjgpZOGSLwsldA4CFG4j3rmP/osU47xkdrm5pLfjdETm+p64cf0fJME34HiVFV+VYajF50UGGc/Nnz4XDfW/ArQ09+M++XsCblwD+fQEL356HswuWwdedS+Dg2p5ilZQwa7VrpCHZ9nOl7Ojg44B0hxxg0hbMjx2rh2iwDk4feReKI58hfn8V8c5lwNyXiF+dRbz4Z1jY1g4TJ1rQbnHfc/ORihJDr5q0kw8AyVqDjpeSEpJLAyaMN6HRwMDuTa/B1fcPwcfbBuHc8SPw+cnDsGvzeim7HOg0DpAYoouPBWUMJxUo65y18X4MtbYJOo3zjgQoxwWen1iNDdPmwPu9+2BvfCXsXbQRehf9Hly0B8aN04OuioGqCipvt/hQ5GLzS4Dh0Tdv3+/nvm0qVVUlfUouboOWK8jxmaznMBXIwpbfroWN63th384tcHTfDpj0gg21lQxoK+m8TQGMb5UxAt6OUYSVkUuGK5MPKiuIHicZwWqDmNNqpE6pIFBjpGDxsqXwuxUroWtBN5w4NgSbNvcDIRW61CUFu9UrtV/si7Fjf/ajUmICSvxKgJMtdQxVK2XOU9RpGNBL3VBeQWIqPR3SjR3QOW8xrFmxCnrWbYJMaobEkr1HE/4zIpv4nrK7NIrbpF+tspoYZdpMLte+wNPRu6S1Bs1GqV/1DOqMPFjIMFbq3dg6cyFkGmagqZqHaoOAHF2XZ6ngWg+XBM4RVoLHOWrLVG4uWpo4FvsvfHz6NktFkbT6QafnQGsUoFLHYm1dFj44cgwYPgQVkymkbP6RWl+LNIRjL/uFhltuNjEoYySCXaNUojOsMPSw4aqwa+o9ga5DggiC1RFDmyMG1bYQVlTSIIhRMJq9RaPZJ4VF+DQZ6MCAmOkLurJ/DYiNt/R67VMKs4hrqjL+o+6mjrj0hjBEOG+1h8FOxcFO1oHVFgazPYQGqdfNthBYpUqwEME78nsT4tP7o96WwWSwA1nKb35iyCZ8M85EXE3oYBO3ab4RKWcSKCaFJJMCQprSpPQcUFwKzWQUKo1+lC9x0r7Fcc+0OVOj8zEkNrY8BAuLDV11ruZvDXrhuJ3NIu+bAYK/FXjfdOA8zegUp6DdmQKNMQD+8HTseW1LYeijE/jB4Q+/Wry8a5L01B6MeaetUcDSjfVjjOVM7da+bTMPvHfkbmrKb5DksjkLncmZqXTe6siAnWmAmkhbYUPvQP7cufO5L69fxyvD/8Ctb+/aI2PU8AmvRGqZAoiIityzb8/T165d3X3t2vD/Pjr+KW7b+R6u2/AOrli9CQfePYQXLg3jpSvDeOLkWTxw6Oh3uwYPrJTMlNHlFcLPeNk6/UOXZ7cuGP1A397fP/7v584vvzJ8o+dvn33+Zm/v9q9X/2EDbN+19+ybm3ds33/ww5f63uovf/D9woVL1A90P5dQqYaGhpQfg4N71BJbteoHqyk7Z+e8zlfuSupPHj+/eO2bso5ZcxQ9Fsiqgny6ZOv3+VTfjIwo+iefnFYN7BxQf3FxuEwGH1c+fgxBuIZnTFuIIh9U2qt3844fb9y0Vf0gXPKm7bzKzYZ+wGTKFFWNz1/6v8OLUiuaFKMJz00yEvaa/RQZnK086s6MutpEqRLx+kcT+rH1f+YikeeNfqnwAAAAAElFTkSuQmCC",aspectRatio:.6666666666666666,src:"/static/avatar-a4ccbab8e7381acb89452773ce94d5a0-25c91.png",srcSet:"/static/avatar-a4ccbab8e7381acb89452773ce94d5a0-8a97b.png 200w,\n/static/avatar-a4ccbab8e7381acb89452773ce94d5a0-0fdf3.png 400w,\n/static/avatar-a4ccbab8e7381acb89452773ce94d5a0-25c91.png 600w",srcWebp:"/static/avatar-a4ccbab8e7381acb89452773ce94d5a0-216f6.webp",srcSetWebp:"/static/avatar-a4ccbab8e7381acb89452773ce94d5a0-5d70e.webp 200w,\n/static/avatar-a4ccbab8e7381acb89452773ce94d5a0-d1677.webp 400w,\n/static/avatar-a4ccbab8e7381acb89452773ce94d5a0-216f6.webp 600w",sizes:"(max-width: 600px) 100vw, 600px"}}},site:{siteMetadata:{title:"女王控的博客",description:'前端工程师，黑猫女王控，欢迎勾搭，技术相关<a href="https://github.com/towavephone" target="_blank">@towavephone</a>，QQ闲聊<a href="tencent://AddContact/?fromId=45&fromSubId=1&subcmd=all&uin=634407147&website=www.oicqzone.com">@towave</a>，bili关注<a href="https://space.bilibili.com/11507708#/" target="_blank">@towave</a>',siteUrl:"https://blog.towavephone.com"}},mainPost:{html:'<p>移动端 web 页面的开发，由于手机屏幕尺寸、分辨率不同，或者需要考虑横竖屏问题，为了使得 web 页面在不同移动设备上具有相适应的展示效果，需要在开发过程中使用合理的适配方案来解决这个问题。</p>\n<h1 id="方案概述"><a href="#%E6%96%B9%E6%A1%88%E6%A6%82%E8%BF%B0" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>方案概述</h1>\n<h2 id="静态布局--initial-scale--各个元素-px"><a href="#%E9%9D%99%E6%80%81%E5%B8%83%E5%B1%80--initial-scale--%E5%90%84%E4%B8%AA%E5%85%83%E7%B4%A0-px" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>静态布局 + initial-scale + 各个元素 px</h2>\n<p>早期网页设计采用静态布局，通过 <code class="language-text">&lt;meta&gt;</code> 标签中的 <code class="language-text">applicable-device</code> 应用设备标识识别移动设备，即 <code class="language-text">&lt;meta name=&#39;applicable-device&#39; content=&#39;mobile&#39;&gt;</code>。</p>\n<p>在 <code class="language-text">&lt;meta&gt;</code> 标签中的 viewport 标签中设置 width，通过 js 动态修改标签的 initial-scale 使得页面等比缩放，刚好占满整个屏幕。一些文章中有提到静态布局中页面各个元素采用 px 为单位，这种方案实现简单，不存在兼容性问题，但用户体验很不友好。</p>\n<h2 id="流式布局--宽度百分比--高度-px"><a href="#%E6%B5%81%E5%BC%8F%E5%B8%83%E5%B1%80--%E5%AE%BD%E5%BA%A6%E7%99%BE%E5%88%86%E6%AF%94--%E9%AB%98%E5%BA%A6-px" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>流式布局 + 宽度百分比 + 高度 px</h2>\n<p>后面出现流式布局，使用百分比定义宽度，高度使用 px 固定，根据可视区域大小实时进行尺寸调整，通常使用 max-width/min-width 控制尺寸范围过大或者过小。</p>\n<p>这种方案实现比较简单，但在大屏手机或横竖屏切换场景下可能会导致页面元素被拉伸变形，字体大小无法随屏幕大小发生变化。</p>\n<h2 id="弹性布局--emrem--px百分比emrem"><a href="#%E5%BC%B9%E6%80%A7%E5%B8%83%E5%B1%80--emrem--px%E7%99%BE%E5%88%86%E6%AF%94emrem" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>弹性布局 + em/rem + px/百分比/em/rem</h2>\n<p>顺应不同页面字体大小展现问题，出现了弹性布局。这种布局方案下，包裹文字的元素的尺寸采用 em/rem 为单位，页面主要划分区域的尺寸依据情况使用 px、百分比或者 em/rem。如一些高校的网站 jlu，页面的主要划分区域使用 px 和百分比，包裹文字的元素和文字采用 em。</p>\n<h2 id="响应式布局--媒体查询--以上方案"><a href="#%E5%93%8D%E5%BA%94%E5%BC%8F%E5%B8%83%E5%B1%80--%E5%AA%92%E4%BD%93%E6%9F%A5%E8%AF%A2--%E4%BB%A5%E4%B8%8A%E6%96%B9%E6%A1%88" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>响应式布局 + 媒体查询 + 以上方案</h2>\n<p>上面的这几种方案下，页面元素的大小按照屏幕分辨率进行适配调整，但是整体布局不变，对于响应式 web 设计，网页布局会随着访问它的视口及设备的不同呈现不同的样式，在实现上可能会以上多种方案的结合，同时搭配媒体查询技术使用，使得一个页面在多个终端 (PC, mobile, pad) 呈现满意效果，如 mashable 。</p>\n<h1 id="基本概念"><a href="#%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>基本概念</h1>\n<h2 id="像素"><a href="#%E5%83%8F%E7%B4%A0" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>像素</h2>\n<h3 id="px-pixel"><a href="#px-pixel" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>px (pixel)</h3>\n<p>像素，是屏幕上显示数据的最基本的点，表示相对大小。不同分辨率下相同长度的 px 元素显示会不一样，是因为像素点的个数相同情况下，不同分辨率下每个像素点对应的像素宽度不同。比如同样是 14px 大小的字，在 1366×768 显示屏下会显示的小，在 1024×768 显示屏下会相对大。也称为物理像素（设备像素），是分辨率的尺寸单位。</p>\n<h3 id="pt-point"><a href="#pt-point" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>pt (point)</h3>\n<p>印刷行业常用单位，能够使用测量设备测得的长度，等于 1/72 英寸。</p>\n<h3 id="css-像素"><a href="#css-%E5%83%8F%E7%B4%A0" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>css 像素</h3>\n<p>在不同屏幕上，css 像素呈现的物理尺寸一致，但 css 像素对应的物理像素不同。标准的显示密度下，1 个 css 像素对应一个物理像素，缩放时 1 个 css 像素对应的物理像素会减增。是一种设备独立像素(device independent pixels: DIPs)</p>\n<h3 id="ppi-pixel-per-inch"><a href="#ppi-pixel-per-inch" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>PPI (pixel per inch)</h3>\n<p>像素密度，每英寸所拥有的像素数。值越高，显示画面细节越丰富。计算公式为：<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mfrac><mrow><msqrt><mrow><mo>(</mo><msup><mi>W</mi><mn>2</mn></msup><mo>+</mo><msup><mi>H</mi><mn>2</mn></msup><mo>)</mo></mrow></msqrt></mrow><mrow><mi>S</mi></mrow></mfrac></mrow><annotation encoding="application/x-tex">\\frac{\\sqrt{(W^2+H^2)}}{S}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:1.35em;"></span><span class="strut bottom" style="height:1.695em;vertical-align:-0.345em;"></span><span class="base"><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.35em;"><span style="top:-2.6550000000000002em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathit mtight" style="margin-right:0.05764em;">S</span></span></span></span><span style="top:-3.15em;"><span class="pstrut" style="height:3em;"></span><span class="stretchy" style="height:0.2em;"><svg width=\'400em\' height=\'0.2em\' viewBox=\'0 0 400000 200\' preserveAspectRatio=\'xMinYMin slice\'><path d=\'M0 80H400000 v40H0z M0 80H400000 v40H0z\'/></svg></span></span><span style="top:-3.5935625em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord sqrt mtight"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.080625em;"><span class="svg-align" style="top:-3.428571428571429em;"><span class="pstrut" style="height:3.428571428571429em;"></span><span class="mord mtight" style="padding-left:1.19em;"><span class="mopen mtight">(</span><span class="mord mtight"><span class="mord mathit mtight" style="margin-right:0.13889em;">W</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7463142857142857em;"><span style="top:-2.786em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mbin mtight">+</span><span class="mord mtight"><span class="mord mathit mtight" style="margin-right:0.08125em;">H</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7463142857142857em;"><span style="top:-2.786em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mclose mtight">)</span></span></span><span style="top:-3.023482142857143em;"><span class="pstrut" style="height:3.428571428571429em;"></span><span class="hide-tail mtight" style="min-width:0.853em;height:1.542857142857143em;"><svg width=\'400em\' height=\'1.542857142857143em\' viewBox=\'0 0 400000 1080\' preserveAspectRatio=\'xMinYMin slice\'><path d=\'M95,702c-2.7,0,-7.17,-2.7,-13.5,-8c-5.8,-5.3,-9.5,\n-10,-9.5,-14c0,-2,0.3,-3.3,1,-4c1.3,-2.7,23.83,-20.7,67.5,-54c44.2,-33.3,65.8,\n-50.3,66.5,-51c1.3,-1.3,3,-2,5,-2c4.7,0,8.7,3.3,12,10s173,378,173,378c0.7,0,\n35.3,-71,104,-213c68.7,-142,137.5,-285,206.5,-429c69,-144,104.5,-217.7,106.5,\n-221c5.3,-9.3,12,-14,20,-14H400000v40H845.2724s-225.272,467,-225.272,467\ns-235,486,-235,486c-2.7,4.7,-9,7,-19,7c-6,0,-10,-1,-12,-3s-194,-422,-194,-422\ns-65,47,-65,47z M834 80H400000v40H845z\'/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.4050892857142858em;"></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span>，其中 W 和 H 是分辨率的宽高，S 是屏幕尺寸。</p>\n<h3 id="dpi-dot-per-inch"><a href="#dpi-dot-per-inch" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>DPI (dot per inch)</h3>\n<p>打印设备每英寸印刷出来的点有多少个，值越高，图片越细腻。</p>\n<h3 id="dpr-devicepixelratio"><a href="#dpr-devicepixelratio" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>DPR (devicePixelRatio)</h3>\n<p>设备物理像素和设备独立像素比，即</p>\n<p><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>D</mi><mi>P</mi><mi>R</mi><mo>=</mo><mfrac><mrow><mtext>物理像素</mtext></mrow><mrow><mtext>css像素</mtext></mrow></mfrac></mrow><annotation encoding="application/x-tex">DPR= \\frac{\\text{物理像素}}{\\text{css像素}}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.872331em;"></span><span class="strut bottom" style="height:1.217331em;vertical-align:-0.345em;"></span><span class="base"><span class="mord mathit" style="margin-right:0.02778em;">D</span><span class="mord mathit" style="margin-right:0.13889em;">P</span><span class="mord mathit" style="margin-right:0.00773em;">R</span><span class="mord rule" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mord rule" style="margin-right:0.2777777777777778em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.872331em;"><span style="top:-2.6550000000000002em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">css</span><span class="mord cjk_fallback mtight">像素</span></span></span></span></span><span style="top:-3.15em;"><span class="pstrut" style="height:3em;"></span><span class="stretchy" style="height:0.2em;"><svg width=\'400em\' height=\'0.2em\' viewBox=\'0 0 400000 200\' preserveAspectRatio=\'xMinYMin slice\'><path d=\'M0 80H400000 v40H0z M0 80H400000 v40H0z\'/></svg></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord cjk_fallback mtight">物理像素</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></p>\n<p>是指在理想布局宽度，使用多少个物理像素来渲染一个 css 像素。</p>\n<p>js 中通过 window.devicePixelRatio 获取，css 中通过 -webkit-device-pixel-ratio, -webkit-min-device-pixel-ratio, -webkit-max-device-pixel-ratio 进行媒体查询。</p>\n<h2 id="视口"><a href="#%E8%A7%86%E5%8F%A3" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>视口</h2>\n<p><code class="language-text">&lt;meta&gt;</code> 标签中定义了一些元数据信息，通过设置 <code class="language-text">&lt;meta name=&quot;viewport&quot;&gt;</code>，提供有关视口初始大小的信息，供移动设备 使用，属性值为</p>\n<table>\n<thead>\n<tr>\n<th align="center">属性</th>\n<th align="center">属性值</th>\n<th align="center">描述</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td align="center">width</td>\n<td align="center">数值 / device-width</td>\n<td align="center">视口宽度</td>\n</tr>\n<tr>\n<td align="center">height</td>\n<td align="center">数值 / device-height</td>\n<td align="center">视口高度</td>\n</tr>\n<tr>\n<td align="center">initial-scale</td>\n<td align="center">0.0 ~ 10.0</td>\n<td align="center">设备宽度与视口大小之间的缩放比率</td>\n</tr>\n<tr>\n<td align="center">maximum-scale</td>\n<td align="center">0.0 ~ 10.0</td>\n<td align="center">缩放最大值</td>\n</tr>\n<tr>\n<td align="center">minimum-scale</td>\n<td align="center">0.0 ~ 10.0</td>\n<td align="center">缩放最小值</td>\n</tr>\n<tr>\n<td align="center">user-scalable</td>\n<td align="center">布尔值</td>\n<td align="center">默认 yes，为 no 时用户不能缩放网页</td>\n</tr>\n</tbody>\n</table>\n<p>移动端涉及布局视口（Layout Viewport）、视觉视口（Visual ViewPort）和理想视口（Ideal ViewPort）。</p>\n<ul>\n<li>布局视口是指用视口元标签（viewport meta）来进行布局视口设置，css 布局是相对于布局视口计算</li>\n<li>视觉视口是指用户当前看到的区域</li>\n<li>理想视口是屏幕分辨率的值，通过设置 <code class="language-text">&lt;meta name=&quot;viewport&quot; content=&quot;width=device-width，initial-scale=1.0&quot;&gt;</code> 实现</li>\n</ul>\n<h2 id="手机屏幕特性"><a href="#%E6%89%8B%E6%9C%BA%E5%B1%8F%E5%B9%95%E7%89%B9%E6%80%A7" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>手机屏幕特性</h2>\n<p>与移动端 web 页面适配有关的手机屏幕特性包括</p>\n<h3 id="像素分辨率"><a href="#%E5%83%8F%E7%B4%A0%E5%88%86%E8%BE%A8%E7%8E%87" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>像素分辨率</h3>\n<p>硬件所支持的，屏幕每行的像素<code class="language-text">*</code>每列的像素点数，单位是<code class="language-text">px</code>。</p>\n<h3 id="逻辑分辨率"><a href="#%E9%80%BB%E8%BE%91%E5%88%86%E8%BE%A8%E7%8E%87" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>逻辑分辨率</h3>\n<p>设备独立的，软件可以达到的，个人理解是使得软件/页面在不同屏幕上显示出来的效果一致。</p>\n<h3 id="倍率"><a href="#%E5%80%8D%E7%8E%87" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>倍率</h3>\n<p>像素分辨率除以逻辑分辨率等于倍率，如 @3x 表示分辨率的 3 倍。一个已知物理像素大小的元素，如果在普通屏中其设备像素等于 css 像素，但在一些高清屏中，如 Retina 显示屏，一个 css 像素对应 2 或 3 个设备像素，这时显示出来的元素会变小。为了让元素如期待显示，需要传入原始设计稿尺寸 × 倍率的设计稿，根据 DPR 的定义，这样加载后能够达到同样的效果。</p>\n<h3 id="尺寸"><a href="#%E5%B0%BA%E5%AF%B8" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>尺寸</h3>\n<p>手机屏幕对角线长度换算成英寸的大小</p>\n<h1 id="适配方案"><a href="#%E9%80%82%E9%85%8D%E6%96%B9%E6%A1%88" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>适配方案</h1>\n<h2 id="百分比方案"><a href="#%E7%99%BE%E5%88%86%E6%AF%94%E6%96%B9%E6%A1%88" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>百分比方案</h2>\n<h3 id="原理"><a href="#%E5%8E%9F%E7%90%86" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>原理</h3>\n<table>\n<thead>\n<tr>\n<th align="center">属性</th>\n<th align="center">设置参考</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td align="center">height/width</td>\n<td align="center">基于子元素的直接父元素，width 相对于父元素的 width，height 相对于父元素的 height</td>\n</tr>\n<tr>\n<td align="center">top/bottom 和 left/right</td>\n<td align="center">相对于直接非 static 定位的父元素的 height/width</td>\n</tr>\n<tr>\n<td align="center">padding/margin</td>\n<td align="center">不论是垂直方向或者是水平方向，都相对于直接父亲元素的 width，与父元素的 height 无关。</td>\n</tr>\n<tr>\n<td align="center">border-radius</td>\n<td align="center">相对于自身的宽度</td>\n</tr>\n</tbody>\n</table>\n<h3 id="实现过程"><a href="#%E5%AE%9E%E7%8E%B0%E8%BF%87%E7%A8%8B" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>实现过程</h3>\n<p>使用百分比定义宽度，高度用 px 固定，根据可视区域实时尺寸进行调整，尽可能适应各种分辨率，通常使用 max-width/min-width 控制尺寸范围过大或者过小。下表是子元素不同属性设置百分比的依据</p>\n<h3 id="优点"><a href="#%E4%BC%98%E7%82%B9" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>优点</h3>\n<p>原理简单，不存在兼容性问题</p>\n<h3 id="缺点"><a href="#%E7%BC%BA%E7%82%B9" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>缺点</h3>\n<ul>\n<li>如果屏幕尺度跨度太大，相对设计稿过大或者过小的屏幕不能正常显示，在大屏手机或横竖屏切换场景下可能会导致页面元素被拉伸变形，字体大小无法随屏幕大小发生变化。</li>\n<li>设置盒模型的不同属性时，其百分比设置的参考元素不唯一，容易使布局问题变得复杂。</li>\n</ul>\n<h2 id="rem-方案"><a href="#rem-%E6%96%B9%E6%A1%88" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>rem 方案</h2>\n<h3 id="原理-1"><a href="#%E5%8E%9F%E7%90%86-1" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>原理</h3>\n<p>rem 是相对长度单位，rem 方案中的样式设计为相对于根元素 font-size 计算值的倍数。根据屏幕宽度设置 html 标签的 font-size，在布局时使用 rem 单位布局，达到自适应的目的，是弹性布局的一种实现方式。</p>\n<h3 id="实现过程-1"><a href="#%E5%AE%9E%E7%8E%B0%E8%BF%87%E7%A8%8B-1" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>实现过程</h3>\n<p>首先获取文档根元素和设备 dpr，设置 rem，在 html 文档加载和解析完成后调整 body 字体大小； 在页面缩放/回退/前进的时候，获取元素的内部宽度 (不包括垂直滚动条，边框和外边距)，重新调整 rem 大小。</p>\n<p>用 css 处理器或 npm 包将页面 css 样式中的 px 自动转换成 rem。在整个 flexible 适配方案中，文本使用 px 作为单位，使用 <code class="language-text">[data-dpr]</code> 属性来区分不同 dpr 下的文本字号。由于手机浏览器对字体显示最小是 8px，因此对于小尺寸文字需要采用 px 为单位，防止通过 rem 转化后出现显示问题。手机淘宝中的字体使用 px 为单位，腾讯新闻中的字体使用 rem 为单位。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="61516245863881425000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`(function(win, lib) {\n  var doc = win.document; // 当前文档对象\n  var docEl = doc.documentElement; // 文档对象根元素的只读属性\n  var metaEl = doc.querySelector(\'meta[name=&quot;viewport&quot;]\');\n  var flexibleEl = doc.querySelector(\'meta[name=&quot;flexible&quot;]\');\n  var dpr = 0;\n  var scale = 0;\n  var tid;\n  var flexible = lib.flexible || (lib.flexible = {});\n\n  if (metaEl) {\n    // 当 meta 中 viewport 的标签设置了 scale 时，将根据 scale 手动设置 dpr\n    console.warn(\'将根据已有的 meta 标签来设置缩放比例\');\n    var match = metaEl.getAttribute(\'content\').match(/initial\\-scale=([\\d\\.]+)/);\n    if (match) {\n      scale = parseFloat(match[1]);\n      dpr = parseInt(1 / scale);\n    }\n  } else if (flexibleEl) {\n    // 当 meta 中 flexible 的标签存在时，据此设置 dpr\n    var content = flexibleEl.getAttribute(\'content\');\n    if (content) {\n      var initialDpr = content.match(/initial\\-dpr=([\\d\\.]+)/);\n      var maximumDpr = content.match(/maximum\\-dpr=([\\d\\.]+)/);\n      if (initialDpr) {\n        dpr = parseFloat(initialDpr[1]);\n        scale = parseFloat((1 / dpr).toFixed(2));\n      }\n      if (maximumDpr) {\n        dpr = parseFloat(maximumDpr[1]);\n        scale = parseFloat((1 / dpr).toFixed(2));\n      }\n    }\n  }\n\n  if (!dpr && !scale) {\n    // 根据 js 获取到的 devicePixelRatio 设置 dpr 及 scale，scale 是 dpr 的倒数\n    var isAndroid = win.navigator.appVersion.match(/android/gi);\n    var isIPhone = win.navigator.appVersion.match(/iphone/gi);\n    var devicePixelRatio = win.devicePixelRatio;\n    if (isIPhone) {\n      // iOS 下，对于 2 和 3 的屏，分别用 2 和 3 倍方案\n      if (devicePixelRatio >= 3 && (!dpr || dpr >= 3)) {\n        dpr = 3;\n      } else if (devicePixelRatio >= 2 && (!dpr || dpr >= 2)) {\n        dpr = 2;\n      } else {\n        dpr = 1;\n      }\n    } else {\n      // 其他设备下，仍旧使用 1 倍的方案\n      dpr = 1;\n    }\n    scale = 1 / dpr;\n  }\n\n  // 文本字号不建议使用 rem，flexible 适配方案中，文本使用 px 作为单位，使用 [data-dpr] 属性来区分不同 dpr 下的文本字号\n  docEl.setAttribute(\'data-dpr\', dpr);\n\n  if (!metaEl) {\n    // 添加 meta 标签，设置 name 为 viewport，content 根据 scale 设置缩放比(默认、最大、最小缩放比)\n    metaEl = doc.createElement(\'meta\');\n    metaEl.setAttribute(\'name\', \'viewport\');\n    metaEl.setAttribute(\n      \'content\',\n      \'initial-scale=\' + scale + \', maximum-scale=\' + scale + \', minimum-scale=\' + scale + \', user-scalable=no\'\n    );\n    if (docEl.firstElementChild) {\n      docEl.firstElementChild.appendChild(metaEl);\n    } else {\n      var wrap = doc.createElement(\'div\');\n      wrap.appendChild(metaEl);\n      doc.write(wrap.innerHTML);\n    }\n  }\n\n  function refreshRem() {\n    // 更新 rem 值\n    var width = docEl.getBoundingClientRect().width;\n    if (width / dpr > 540) {\n      width = 540 * dpr;\n    }\n    // 将当前视口宽度 width 10 等分\n    var rem = width / 10; // 1rem = viewWidth / 10\n    docEl.style.fontSize = rem + \'px\';\n    flexible.rem = win.rem = rem;\n  }\n\n  // resize 与 pageshow 延时 300ms 触发 refreshRem(), 使用防抖函数，防止事件被高频触发可能引起性能问题\n  win.addEventListener(\n    \'resize\',\n    function() {\n      clearTimeout(tid);\n      tid = setTimeout(refreshRem, 300);\n    },\n    false\n  );\n  win.addEventListener(\n    \'pageshow\',\n    function(e) {\n      // 当一条会话历史记录被执行的时候触发事件，包括后退/前进按钮，同时会在 onload 页面触发后初始化页面时触发\n      if (e.persisted) {\n        // 表示网页是否来自缓存\n        clearTimeout(tid);\n        tid = setTimeout(refreshRem, 300);\n      }\n    },\n    false\n  );\n\n  // 在 html 文档加载和解析完成后设置 body 元素字体大小\n  if (doc.readyState === \'complete\') {\n    doc.body.style.fontSize = 12 * dpr + \'px\';\n  } else {\n    doc.addEventListener(\n      \'DOMContentLoaded\',\n      function(e) {\n        doc.body.style.fontSize = 12 * dpr + \'px\';\n      },\n      false\n    );\n  }\n  // 浏览器有最小字体限制，css 在 pc 上 font-size 是 12px (移动端最小是 8px), 也就是 css 像素是 12，其 DPR 为 1，在移动端 dpr 有可能为 2 和 3，为了保证字体不变小，需要用 12 * dpr 进行换算。\n\n  refreshRem();\n\n  //实现 rem 与 px 相互转换\n  flexible.dpr = win.dpr = dpr;\n  flexible.refreshRem = refreshRem;\n  flexible.rem2px = function(d) {\n    var val = parseFloat(d) * this.rem;\n    if (typeof d === \'string\' && d.match(/rem\\$/)) {\n      val += \'px\';\n    }\n    return val;\n  };\n  flexible.px2rem = function(d) {\n    var val = parseFloat(d) / this.rem;\n    if (typeof d === \'string\' && d.match(/px\\$/)) {\n      val += \'rem\';\n    }\n    return val;\n  };\n})(window, window[\'lib\'] || (window[\'lib\'] = {}));`, `61516245863881425000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                data-tooltip="复制"\n              >\n                <svg class="gatsby-code-button-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0V0z"/><path d="M16 1H2v16h2V3h12V1zm-1 4l6 6v12H6V5h9zm-1 7h5.5L14 6.5V12z"/></svg>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">win<span class="token punctuation">,</span> lib</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">var</span> doc <span class="token operator">=</span> win<span class="token punctuation">.</span>document<span class="token punctuation">;</span> <span class="token comment">// 当前文档对象</span>\n  <span class="token keyword">var</span> docEl <span class="token operator">=</span> doc<span class="token punctuation">.</span>documentElement<span class="token punctuation">;</span> <span class="token comment">// 文档对象根元素的只读属性</span>\n  <span class="token keyword">var</span> metaEl <span class="token operator">=</span> doc<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">\'meta[name="viewport"]\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token keyword">var</span> flexibleEl <span class="token operator">=</span> doc<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">\'meta[name="flexible"]\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token keyword">var</span> dpr <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>\n  <span class="token keyword">var</span> scale <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>\n  <span class="token keyword">var</span> tid<span class="token punctuation">;</span>\n  <span class="token keyword">var</span> flexible <span class="token operator">=</span> lib<span class="token punctuation">.</span>flexible <span class="token operator">||</span> <span class="token punctuation">(</span>lib<span class="token punctuation">.</span>flexible <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n  <span class="token keyword">if</span> <span class="token punctuation">(</span>metaEl<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token comment">// 当 meta 中 viewport 的标签设置了 scale 时，将根据 scale 手动设置 dpr</span>\n    console<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span><span class="token string">\'将根据已有的 meta 标签来设置缩放比例\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">var</span> match <span class="token operator">=</span> metaEl<span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token string">\'content\'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span><span class="token regex">/initial\\-scale=([\\d\\.]+)/</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">if</span> <span class="token punctuation">(</span>match<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      scale <span class="token operator">=</span> <span class="token function">parseFloat</span><span class="token punctuation">(</span>match<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n      dpr <span class="token operator">=</span> <span class="token function">parseInt</span><span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">/</span> scale<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>flexibleEl<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token comment">// 当 meta 中 flexible 的标签存在时，据此设置 dpr</span>\n    <span class="token keyword">var</span> content <span class="token operator">=</span> flexibleEl<span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token string">\'content\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">if</span> <span class="token punctuation">(</span>content<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token keyword">var</span> initialDpr <span class="token operator">=</span> content<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span><span class="token regex">/initial\\-dpr=([\\d\\.]+)/</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token keyword">var</span> maximumDpr <span class="token operator">=</span> content<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span><span class="token regex">/maximum\\-dpr=([\\d\\.]+)/</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token keyword">if</span> <span class="token punctuation">(</span>initialDpr<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        dpr <span class="token operator">=</span> <span class="token function">parseFloat</span><span class="token punctuation">(</span>initialDpr<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n        scale <span class="token operator">=</span> <span class="token function">parseFloat</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">/</span> dpr<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toFixed</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span>\n      <span class="token keyword">if</span> <span class="token punctuation">(</span>maximumDpr<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        dpr <span class="token operator">=</span> <span class="token function">parseFloat</span><span class="token punctuation">(</span>maximumDpr<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n        scale <span class="token operator">=</span> <span class="token function">parseFloat</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">/</span> dpr<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toFixed</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span>\n    <span class="token punctuation">}</span>\n  <span class="token punctuation">}</span>\n\n  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>dpr <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>scale<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token comment">// 根据 js 获取到的 devicePixelRatio 设置 dpr 及 scale，scale 是 dpr 的倒数</span>\n    <span class="token keyword">var</span> isAndroid <span class="token operator">=</span> win<span class="token punctuation">.</span>navigator<span class="token punctuation">.</span>appVersion<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span><span class="token regex">/android/gi</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">var</span> isIPhone <span class="token operator">=</span> win<span class="token punctuation">.</span>navigator<span class="token punctuation">.</span>appVersion<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span><span class="token regex">/iphone/gi</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">var</span> devicePixelRatio <span class="token operator">=</span> win<span class="token punctuation">.</span>devicePixelRatio<span class="token punctuation">;</span>\n    <span class="token keyword">if</span> <span class="token punctuation">(</span>isIPhone<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token comment">// iOS 下，对于 2 和 3 的屏，分别用 2 和 3 倍方案</span>\n      <span class="token keyword">if</span> <span class="token punctuation">(</span>devicePixelRatio <span class="token operator">>=</span> <span class="token number">3</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span><span class="token operator">!</span>dpr <span class="token operator">||</span> dpr <span class="token operator">>=</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        dpr <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>devicePixelRatio <span class="token operator">>=</span> <span class="token number">2</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span><span class="token operator">!</span>dpr <span class="token operator">||</span> dpr <span class="token operator">>=</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        dpr <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>\n        dpr <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span>\n    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>\n      <span class="token comment">// 其他设备下，仍旧使用 1 倍的方案</span>\n      dpr <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n    scale <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">/</span> dpr<span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n\n  <span class="token comment">// 文本字号不建议使用 rem，flexible 适配方案中，文本使用 px 作为单位，使用 [data-dpr] 属性来区分不同 dpr 下的文本字号</span>\n  docEl<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">\'data-dpr\'</span><span class="token punctuation">,</span> dpr<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>metaEl<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token comment">// 添加 meta 标签，设置 name 为 viewport，content 根据 scale 设置缩放比(默认、最大、最小缩放比)</span>\n    metaEl <span class="token operator">=</span> doc<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">\'meta\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    metaEl<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">\'name\'</span><span class="token punctuation">,</span> <span class="token string">\'viewport\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    metaEl<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span>\n      <span class="token string">\'content\'</span><span class="token punctuation">,</span>\n      <span class="token string">\'initial-scale=\'</span> <span class="token operator">+</span> scale <span class="token operator">+</span> <span class="token string">\', maximum-scale=\'</span> <span class="token operator">+</span> scale <span class="token operator">+</span> <span class="token string">\', minimum-scale=\'</span> <span class="token operator">+</span> scale <span class="token operator">+</span> <span class="token string">\', user-scalable=no\'</span>\n    <span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">if</span> <span class="token punctuation">(</span>docEl<span class="token punctuation">.</span>firstElementChild<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      docEl<span class="token punctuation">.</span>firstElementChild<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>metaEl<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>\n      <span class="token keyword">var</span> wrap <span class="token operator">=</span> doc<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">\'div\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n      wrap<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>metaEl<span class="token punctuation">)</span><span class="token punctuation">;</span>\n      doc<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>wrap<span class="token punctuation">.</span>innerHTML<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n  <span class="token punctuation">}</span>\n\n  <span class="token keyword">function</span> <span class="token function">refreshRem</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token comment">// 更新 rem 值</span>\n    <span class="token keyword">var</span> width <span class="token operator">=</span> docEl<span class="token punctuation">.</span><span class="token function">getBoundingClientRect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>width<span class="token punctuation">;</span>\n    <span class="token keyword">if</span> <span class="token punctuation">(</span>width <span class="token operator">/</span> dpr <span class="token operator">></span> <span class="token number">540</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      width <span class="token operator">=</span> <span class="token number">540</span> <span class="token operator">*</span> dpr<span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n    <span class="token comment">// 将当前视口宽度 width 10 等分</span>\n    <span class="token keyword">var</span> rem <span class="token operator">=</span> width <span class="token operator">/</span> <span class="token number">10</span><span class="token punctuation">;</span> <span class="token comment">// 1rem = viewWidth / 10</span>\n    docEl<span class="token punctuation">.</span>style<span class="token punctuation">.</span>fontSize <span class="token operator">=</span> rem <span class="token operator">+</span> <span class="token string">\'px\'</span><span class="token punctuation">;</span>\n    flexible<span class="token punctuation">.</span>rem <span class="token operator">=</span> win<span class="token punctuation">.</span>rem <span class="token operator">=</span> rem<span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n\n  <span class="token comment">// resize 与 pageshow 延时 300ms 触发 refreshRem(), 使用防抖函数，防止事件被高频触发可能引起性能问题</span>\n  win<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span>\n    <span class="token string">\'resize\'</span><span class="token punctuation">,</span>\n    <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token function">clearTimeout</span><span class="token punctuation">(</span>tid<span class="token punctuation">)</span><span class="token punctuation">;</span>\n      tid <span class="token operator">=</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span>refreshRem<span class="token punctuation">,</span> <span class="token number">300</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span><span class="token punctuation">,</span>\n    <span class="token boolean">false</span>\n  <span class="token punctuation">)</span><span class="token punctuation">;</span>\n  win<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span>\n    <span class="token string">\'pageshow\'</span><span class="token punctuation">,</span>\n    <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token comment">// 当一条会话历史记录被执行的时候触发事件，包括后退/前进按钮，同时会在 onload 页面触发后初始化页面时触发</span>\n      <span class="token keyword">if</span> <span class="token punctuation">(</span>e<span class="token punctuation">.</span>persisted<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        <span class="token comment">// 表示网页是否来自缓存</span>\n        <span class="token function">clearTimeout</span><span class="token punctuation">(</span>tid<span class="token punctuation">)</span><span class="token punctuation">;</span>\n        tid <span class="token operator">=</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span>refreshRem<span class="token punctuation">,</span> <span class="token number">300</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span>\n    <span class="token punctuation">}</span><span class="token punctuation">,</span>\n    <span class="token boolean">false</span>\n  <span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n  <span class="token comment">// 在 html 文档加载和解析完成后设置 body 元素字体大小</span>\n  <span class="token keyword">if</span> <span class="token punctuation">(</span>doc<span class="token punctuation">.</span>readyState <span class="token operator">===</span> <span class="token string">\'complete\'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    doc<span class="token punctuation">.</span>body<span class="token punctuation">.</span>style<span class="token punctuation">.</span>fontSize <span class="token operator">=</span> <span class="token number">12</span> <span class="token operator">*</span> dpr <span class="token operator">+</span> <span class="token string">\'px\'</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>\n    doc<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span>\n      <span class="token string">\'DOMContentLoaded\'</span><span class="token punctuation">,</span>\n      <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        doc<span class="token punctuation">.</span>body<span class="token punctuation">.</span>style<span class="token punctuation">.</span>fontSize <span class="token operator">=</span> <span class="token number">12</span> <span class="token operator">*</span> dpr <span class="token operator">+</span> <span class="token string">\'px\'</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span><span class="token punctuation">,</span>\n      <span class="token boolean">false</span>\n    <span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n  <span class="token comment">// 浏览器有最小字体限制，css 在 pc 上 font-size 是 12px (移动端最小是 8px), 也就是 css 像素是 12，其 DPR 为 1，在移动端 dpr 有可能为 2 和 3，为了保证字体不变小，需要用 12 * dpr 进行换算。</span>\n\n  <span class="token function">refreshRem</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n  <span class="token comment">//实现 rem 与 px 相互转换</span>\n  flexible<span class="token punctuation">.</span>dpr <span class="token operator">=</span> win<span class="token punctuation">.</span>dpr <span class="token operator">=</span> dpr<span class="token punctuation">;</span>\n  flexible<span class="token punctuation">.</span>refreshRem <span class="token operator">=</span> refreshRem<span class="token punctuation">;</span>\n  flexible<span class="token punctuation">.</span><span class="token function-variable function">rem2px</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">d</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">var</span> val <span class="token operator">=</span> <span class="token function">parseFloat</span><span class="token punctuation">(</span>d<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token keyword">this</span><span class="token punctuation">.</span>rem<span class="token punctuation">;</span>\n    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> d <span class="token operator">===</span> <span class="token string">\'string\'</span> <span class="token operator">&amp;&amp;</span> d<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span><span class="token regex">/rem$/</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      val <span class="token operator">+=</span> <span class="token string">\'px\'</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n    <span class="token keyword">return</span> val<span class="token punctuation">;</span>\n  <span class="token punctuation">}</span><span class="token punctuation">;</span>\n  flexible<span class="token punctuation">.</span><span class="token function-variable function">px2rem</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">d</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">var</span> val <span class="token operator">=</span> <span class="token function">parseFloat</span><span class="token punctuation">(</span>d<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token keyword">this</span><span class="token punctuation">.</span>rem<span class="token punctuation">;</span>\n    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> d <span class="token operator">===</span> <span class="token string">\'string\'</span> <span class="token operator">&amp;&amp;</span> d<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span><span class="token regex">/px$/</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      val <span class="token operator">+=</span> <span class="token string">\'rem\'</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n    <span class="token keyword">return</span> val<span class="token punctuation">;</span>\n  <span class="token punctuation">}</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span>window<span class="token punctuation">,</span> window<span class="token punctuation">[</span><span class="token string">\'lib\'</span><span class="token punctuation">]</span> <span class="token operator">||</span> <span class="token punctuation">(</span>window<span class="token punctuation">[</span><span class="token string">\'lib\'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="优点-1"><a href="#%E4%BC%98%E7%82%B9-1" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>优点</h3>\n<p>兼容性好</p>\n<ul>\n<li>ios: 6.1 系统以上都支持</li>\n<li>android: 2.1 系统以上都支持</li>\n<li>大部分主流浏览器都支持</li>\n<li>相较于之前的静态布局和百分比方案，页面不会因为伸缩发生变形，自适应效果更佳。</li>\n</ul>\n<h3 id="缺点-1"><a href="#%E7%BC%BA%E7%82%B9-1" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>缺点</h3>\n<ul>\n<li>不是纯 css 移动适配方案，需要引入 js 脚本，在头部内嵌一段 js 脚本，监听分辨率的变化来动态改变根元素的字体大小，css 样式和 js 代码有一定耦合性，并且必须将改变 font-size 的代码放在 css 样式之前。</li>\n<li>小数像素问题，浏览器渲染最小的单位是像素，元素根据屏幕宽度自适应，通过 rem 计算后可能会出现小数像素，浏览器会对这部分小数四舍五入，按照整数渲染。浏览器在渲染时所做的摄入处理只是应用在元素的尺寸渲染上，其真实占据的空间依旧是原始大小。也就是说如果一个元素尺寸是 0.625px，那么其渲染尺寸应该是 1px，空出的 0.375px 空间由其临近的元素填充；同样道理，如果一个元素尺寸是 0.375px，其渲染尺寸就应该是 0，但是其会占据临近元素 0.375px 的空间。会导致：缩放到低于 1px 的元素时隐时现（解决办法：指定最小转换像素，对于比较小的像素，不转换为 rem 或 vw）；两个同样宽度的元素因为各自周围的元素宽度不同，导致两元素相差 1px；宽高相同的正方形，长宽不等了；border-radius: 50% 画的圆不圆。</li>\n<li>Android 浏览器下 line-height 垂直居中偏离的问题。常用的垂直居中方式就是使用 line-height，这种方法在 Android 设备下并不能完全居中。</li>\n<li>cursor: pointer 元素点击背景变色的问题，对添加了 cursor:pointer 属性的元素，在移动端点击时，背景会高亮。为元素添加 tag-highlight-color: transparent 属性可以隐藏背景高亮。</li>\n</ul>\n<h2 id="vhvw-方案"><a href="#vhvw-%E6%96%B9%E6%A1%88" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>vh/vw 方案</h2>\n<h3 id="原理-2"><a href="#%E5%8E%9F%E7%90%86-2" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>原理</h3>\n<p>视口是浏览器中用于呈现网页的区域，移动端的视口通常指的是布局视口</p>\n<ul>\n<li>vw: 1vw 等于视口宽度的 1%</li>\n<li>vh: 1vh 等于视口高度的 1%</li>\n<li>vmin: 选取 vw 和 vh 中最小的那个</li>\n<li>vmax: 选取 vw 和 vh 中最大的那个</li>\n</ul>\n<h3 id="实现过程-2"><a href="#%E5%AE%9E%E7%8E%B0%E8%BF%87%E7%A8%8B-2" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>实现过程</h3>\n<p>使用 css 预处理器把设计稿尺寸转换为 vw 单位，包括文本，布局高宽，间距等，使得这些元素能够随视口大小自适应调整。以 1080px 设计稿为基准，转化的计算表示为</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="87362550537906850000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 以1080px作为设计稿基准\n\\$vw_base: 1080 @function vw(\\$px) {\n  @return (\\$px / 1080) * 100vw;\n}`, `87362550537906850000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                data-tooltip="复制"\n              >\n                <svg class="gatsby-code-button-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0V0z"/><path d="M16 1H2v16h2V3h12V1zm-1 4l6 6v12H6V5h9zm-1 7h5.5L14 6.5V12z"/></svg>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="scss"><pre style="counter-reset: linenumber NaN" class="language-scss line-numbers"><code class="language-scss"><span class="token comment">// 以1080px作为设计稿基准</span>\n<span class="token property"><span class="token variable">$vw_base</span></span><span class="token punctuation">:</span> 1080 <span class="token keyword">@function</span> <span class="token function">vw</span><span class="token punctuation">(</span><span class="token variable">$px</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">@return</span> <span class="token punctuation">(</span><span class="token variable">$px</span> <span class="token operator">/</span> 1080<span class="token punctuation">)</span> <span class="token operator">*</span> 100vw<span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="优点-2"><a href="#%E4%BC%98%E7%82%B9-2" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>优点</h3>\n<ul>\n<li>纯 css 移动端适配方案，不存在脚本依赖问题</li>\n<li>相对于 rem 以根元素字体大小的倍数定义元素大小，逻辑清晰简单，视口单位依赖于视口的尺寸 <code class="language-text">1vw ＝ 1/100 viewport width</code>，根据视口尺寸的百分比来定义元素宽度</li>\n</ul>\n<h3 id="缺点-2"><a href="#%E7%BC%BA%E7%82%B9-2" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>缺点</h3>\n<p>存在一些兼容性问题，Android 4.4 以下不支持</p>\n<h2 id="rem--vwvh-方案"><a href="#rem--vwvh-%E6%96%B9%E6%A1%88" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>rem + vw/vh 方案</h2>\n<h3 id="原理-3"><a href="#%E5%8E%9F%E7%90%86-3" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>原理</h3>\n<p>vw/vh 方案能够实现宽度和高度的自适应，并且逻辑清晰，由于其被支持得较晚，所以存在一定的兼容性问题。将 vw/vh 方案与 rem 方案相结合，给根元素设置随视口变化的 vw 单位，可以通过 postcss-plugin-vwtorem 将其转换</p>\n<h3 id="实现过程-3"><a href="#%E5%AE%9E%E7%8E%B0%E8%BF%87%E7%A8%8B-3" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>实现过程</h3>\n<p>对于 1080px 宽的设计稿，设置默认根字号的大小为 100px，那么设计稿中 1px 对应的是 100vw/1080 = 0.0925926vw，并且 1rem = 100px，也就可以得到 1rem = 9.256926vw</p>\n<p>同时可以使用媒体查询限制根元素的最大最小值，实现对页面的最大最小宽度限制，对用户的视觉体验更好。</p>\n<h3 id="适用场景"><a href="#%E9%80%82%E7%94%A8%E5%9C%BA%E6%99%AF" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>适用场景</h3>\n<p>rem 弹性布局方式作为移动端 web 页面适配方法，后期从 rem 过渡到 vw ，只需要通过改变根元素大小的计算方式，不需要其他处理。vw 将会成为一种更好的适配方式，目前由于兼容性的原因得不到广泛应用。rem+vw/vh 不存在 vw/vh 的兼容性问题，可以成为由 rem 向 vw/vh 转变的一种过渡方案。</p>\n<h2 id="基于媒体查询的响应式设计"><a href="#%E5%9F%BA%E4%BA%8E%E5%AA%92%E4%BD%93%E6%9F%A5%E8%AF%A2%E7%9A%84%E5%93%8D%E5%BA%94%E5%BC%8F%E8%AE%BE%E8%AE%A1" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>基于媒体查询的响应式设计</h2>\n<p>响应式设计使得一个网站同时适配多种设备和多个屏幕，让网站的布局和功能随用户的使用环境（屏幕大小、输出方式、设备/浏览器能力而变化），使其视觉合理，交互方式符合习惯。如使得内容区块可伸缩与自由排布，边距适应页面尺寸，图片适应比例变化，能够自动隐藏/部分显示内容，能自动折叠导航和菜单。</p>\n<h3 id="原理-4"><a href="#%E5%8E%9F%E7%90%86-4" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>原理</h3>\n<p>主要实现是通过媒体查询，通过给不同分辨率的设备编写不同的样式实现响应式布局，用于解决不同设备不同分辨率之间兼容问题，一般是指 PC、平板、手机设备之间较大的分辨率差异。</p>\n<h3 id="实现过程-4"><a href="#%E5%AE%9E%E7%8E%B0%E8%BF%87%E7%A8%8B-4" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>实现过程</h3>\n<p>实现上不局限于具体的方案，通常结合了流式布局 + 弹性布局方案。比如给小屏幕手机设置@2x 图，为大屏手机设置@3x 图</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="16646875010511030000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`@media only screen and (min-width: 375px) {\n  /* 样式1 */\n}\n@media only screen and (min-width: 750px) {\n  /* 样式2 */\n}`, `16646875010511030000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                data-tooltip="复制"\n              >\n                <svg class="gatsby-code-button-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0V0z"/><path d="M16 1H2v16h2V3h12V1zm-1 4l6 6v12H6V5h9zm-1 7h5.5L14 6.5V12z"/></svg>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token atrule"><span class="token rule">@media</span> only screen and <span class="token punctuation">(</span><span class="token property">min-width</span><span class="token punctuation">:</span> 375px<span class="token punctuation">)</span></span> <span class="token punctuation">{</span>\n  <span class="token comment">/* 样式1 */</span>\n<span class="token punctuation">}</span>\n<span class="token atrule"><span class="token rule">@media</span> only screen and <span class="token punctuation">(</span><span class="token property">min-width</span><span class="token punctuation">:</span> 750px<span class="token punctuation">)</span></span> <span class="token punctuation">{</span>\n  <span class="token comment">/* 样式2 */</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="优点-3"><a href="#%E4%BC%98%E7%82%B9-3" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>优点</h3>\n<p>能够使网页在不同设备、不同分辨率屏幕上呈现合理布局，不仅仅是样式伸缩变换</p>\n<h3 id="缺点-3"><a href="#%E7%BC%BA%E7%82%B9-3" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>缺点</h3>\n<ul>\n<li>要匹配足够多的设备与屏幕，一个 web 页面需要多个设计方案，工作量比较大</li>\n<li>通过媒体查询技术需要设置一定量的断点，到达某个断点前后的页面发生显著变化，用户体验不太友好</li>\n</ul>\n<h1 id="其他通用问题"><a href="#%E5%85%B6%E4%BB%96%E9%80%9A%E7%94%A8%E9%97%AE%E9%A2%98" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>其他通用问题</h1>\n<h2 id="1-像素问题"><a href="#1-%E5%83%8F%E7%B4%A0%E9%97%AE%E9%A2%98" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>1 像素问题</h2>\n<p>是指设置边框为 1px css 像素，在普通屏幕下 1px，高清屏幕 (dpr 为 2)下 2px 的情况。是由于不同移动设备的 dpr 不同，导致 1px css 像素，转换成物理像素后显示不一样。</p>\n<h3 id="设置-scale-为-1dpr"><a href="#%E8%AE%BE%E7%BD%AE-scale-%E4%B8%BA-1dpr" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>设置 scale 为 1/dpr</h3>\n<p>css 中涉及 1 像素的地方仍然使用 px 作为单位，设置 <code class="language-text">&lt;meta&gt;</code> 标签中 <code class="language-text">initial-scale=1/dpr</code> ，将整个页面缩小 dpr 倍，对于页面采用 rem 方案的情况，将页面的根字体再放大 dpr 倍，这个时候就能够在不改变页面其他布局的情况下，保持边框的 css 像素为 1px。</p>\n<h3 id="transform-的-scale-属性"><a href="#transform-%E7%9A%84-scale-%E5%B1%9E%E6%80%A7" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>transform 的 scale 属性</h3>\n<p>transform 的 scale 属性允许对元素进行缩放，其中 scaleY(y) 通过设置 Y 轴的值来定义缩放转换，并结合伪元素使用，通过 transform-origin: 50% 0% 修改元素变换的中心点实现。针对横着的边框线用 scaleY(y)，针对竖着的边框线要用 scaleX(x)，针对一圈的边框线用 scale()，并且需要注意转移元素变换中心点。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="26277419423257030000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`/* 针对竖着的边框线 */\n.className::before {\n  /* 其他样式 */\n  transform-origin: 50% 0%;\n}\n\n/* dpr 为 2 时 */\n@media only screen and (-webkit-min-device-pixel-ratio: 2) {\n  .className::before {\n    transform: scaleY(0.5);\n  }\n}\n\n/* dpr 为 3 时 */\n@media only screen and (-webkit-min-device-pixel-ratio: 3) {\n  .className::before {\n    transform: scaleY(0.33);\n  }\n}`, `26277419423257030000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                data-tooltip="复制"\n              >\n                <svg class="gatsby-code-button-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0V0z"/><path d="M16 1H2v16h2V3h12V1zm-1 4l6 6v12H6V5h9zm-1 7h5.5L14 6.5V12z"/></svg>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token comment">/* 针对竖着的边框线 */</span>\n<span class="token selector">.className::before</span> <span class="token punctuation">{</span>\n  <span class="token comment">/* 其他样式 */</span>\n  <span class="token property">transform-origin</span><span class="token punctuation">:</span> 50% 0%<span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token comment">/* dpr 为 2 时 */</span>\n<span class="token atrule"><span class="token rule">@media</span> only screen and <span class="token punctuation">(</span><span class="token property">-webkit-min-device-pixel-ratio</span><span class="token punctuation">:</span> 2<span class="token punctuation">)</span></span> <span class="token punctuation">{</span>\n  <span class="token selector">.className::before</span> <span class="token punctuation">{</span>\n    <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">scaleY</span><span class="token punctuation">(</span>0.5<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n\n<span class="token comment">/* dpr 为 3 时 */</span>\n<span class="token atrule"><span class="token rule">@media</span> only screen and <span class="token punctuation">(</span><span class="token property">-webkit-min-device-pixel-ratio</span><span class="token punctuation">:</span> 3<span class="token punctuation">)</span></span> <span class="token punctuation">{</span>\n  <span class="token selector">.className::before</span> <span class="token punctuation">{</span>\n    <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">scaleY</span><span class="token punctuation">(</span>0.33<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="border-image-属性"><a href="#border-image-%E5%B1%9E%E6%80%A7" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>border-image 属性</h3>\n<p>使用 border-image，在元素的边框上设置一个一半透明一半显示的图片，也可以使用 CSS3 渐变填充</p>\n<h2 id="对图片的处理"><a href="#%E5%AF%B9%E5%9B%BE%E7%89%87%E7%9A%84%E5%A4%84%E7%90%86" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>对图片的处理</h2>\n<ul>\n<li>加载网页时，平均 60% 以上的流量来自加载图片。</li>\n<li>指定图像宽度时使用相对单位，防止意外溢出视口，如 width: 50%，将图片宽度设置为包含元素宽度的 50%。因为 css 允许内容溢出容器，需要使用 max-width: 100% 来保证图像及其他内容不会溢出。</li>\n<li>使用 img 元素的 alt 属性提供描述，描述有助于提高网站的可访问性，能提供语境给屏幕阅读器及其他辅助性技术。</li>\n<li>维护自适应页面中图片宽高比固定比较常用的方法是使用 padding 设置。</li>\n<li>对于不同 dpr 以及不同分辨率/尺寸的屏幕，为了避免资源浪费和等待时间延长，需要针对不同的屏幕使用合适的图片，加载的图片分为通过标签引入的图片和背景图片。</li>\n</ul>\n<h3 id="srcset-和-sizes"><a href="#srcset-%E5%92%8C-sizes" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>srcset 和 sizes</h3>\n<p>对于 <code class="language-text">&lt;img&gt;</code> 引入的图片，如果想要图片适应不同像素密度的屏幕，并且屏幕上显示图片的实际尺寸相同，使用 srcset 属性用来指定多张图像。它的值是一个逗号分隔的字符串，每个部分都是一张图像的 URL，后面接一个空格，后接是像素密度描述符。浏览器根据当前设备的像素密度，选择需要加载的图像。如果 srcset 属性都不满足条件，那么就加载 src 属性指定的默认图像。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="72519342644437130000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`<img srcset=&quot;foo-320w.jpg, foo-480w.jpg 1.5x, foo-640w.jpg 2x&quot; src=&quot;foo-640w.jpg&quot; />\n<!--srcset属性给出了三个图像URL，适应三种不同的像素密度， 后面的像素密度描述符，格式是像素密度倍数 + 字母x。1x表示单倍像素密度，可以省略。-->`, `72519342644437130000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                data-tooltip="复制"\n              >\n                <svg class="gatsby-code-button-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0V0z"/><path d="M16 1H2v16h2V3h12V1zm-1 4l6 6v12H6V5h9zm-1 7h5.5L14 6.5V12z"/></svg>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="html"><pre style="counter-reset: linenumber NaN" class="language-html line-numbers"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">srcset</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>foo-320w.jpg, foo-480w.jpg 1.5x, foo-640w.jpg 2x<span class="token punctuation">"</span></span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>foo-640w.jpg<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>\n<span class="token comment">&lt;!--srcset属性给出了三个图像URL，适应三种不同的像素密度， 后面的像素密度描述符，格式是像素密度倍数 + 字母x。1x表示单倍像素密度，可以省略。--></span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p>如果想要针对不同屏幕，使用不同分辨率版本和尺寸的图片，使用属性 srcset 和 sizes 。srcset 定义了允许浏览器选择的图像集，以及每个图像的大小（使用 w 单位）。sizes 定义了一组媒体条件（例如屏幕宽度），指明当某些媒体条件为真时，什么样的图片尺寸是最佳选择。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="41102599492789940000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`<img\n  srcset=&quot;elva-fairy-320w.jpg 320w, elva-fairy-480w.jpg 480w, elva-fairy-800w.jpg 800w&quot;\n  sizes=&quot;(max-width: 320px) 280px,\n         (max-width: 480px) 440px,\n         800px&quot;\n  src=&quot;elva-fairy-800w.jpg&quot;\n  alt=&quot;Elva dressed as a fairy&quot;\n/>`, `41102599492789940000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                data-tooltip="复制"\n              >\n                <svg class="gatsby-code-button-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0V0z"/><path d="M16 1H2v16h2V3h12V1zm-1 4l6 6v12H6V5h9zm-1 7h5.5L14 6.5V12z"/></svg>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="html"><pre style="counter-reset: linenumber NaN" class="language-html line-numbers"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span>\n  <span class="token attr-name">srcset</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>elva-fairy-320w.jpg 320w, elva-fairy-480w.jpg 480w, elva-fairy-800w.jpg 800w<span class="token punctuation">"</span></span>\n  <span class="token attr-name">sizes</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>(max-width: 320px) 280px,\n         (max-width: 480px) 440px,\n         800px<span class="token punctuation">"</span></span>\n  <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>elva-fairy-800w.jpg<span class="token punctuation">"</span></span>\n  <span class="token attr-name">alt</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>Elva dressed as a fairy<span class="token punctuation">"</span></span>\n<span class="token punctuation">/></span></span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>浏览器的查询过程：</p>\n<ul>\n<li>查看设备宽度；</li>\n<li>检查 sizes 列表中哪个媒体条件是第一个为真；</li>\n<li>查看给予该媒体查询的槽大小；</li>\n<li>加载 srcset 列表中引用的最接近所选的槽大小的图像</li>\n</ul>\n<h3 id="异步加载"><a href="#%E5%BC%82%E6%AD%A5%E5%8A%A0%E8%BD%BD" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>异步加载</h3>\n<p><code class="language-text">&lt;img&gt;</code> 引入的图片，使用 js 自带的异步加载图片。根据不同的 dpr，加载不同分辨率的图片。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="48539147263519110000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`<img id=&quot;img&quot; data-src1x=&quot;xxx@1x.jpg&quot; data-src2x=&quot;xxx@2x.jpg&quot; data-src3x=&quot;xxx@3x.jpg&quot; />`, `48539147263519110000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                data-tooltip="复制"\n              >\n                <svg class="gatsby-code-button-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0V0z"/><path d="M16 1H2v16h2V3h12V1zm-1 4l6 6v12H6V5h9zm-1 7h5.5L14 6.5V12z"/></svg>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="html"><pre style="counter-reset: linenumber NaN" class="language-html line-numbers"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>img<span class="token punctuation">"</span></span> <span class="token attr-name">data-src1x</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>xxx@1x.jpg<span class="token punctuation">"</span></span> <span class="token attr-name">data-src2x</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>xxx@2x.jpg<span class="token punctuation">"</span></span> <span class="token attr-name">data-src3x</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>xxx@3x.jpg<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="86720029213231560000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`var dpr = window.devicePixelRatio;\nif (dpr > 3) {\n  dpr = 3;\n}\n\nvar imgSrc = \\$(\'#img\').data(\'src\' + dpr + \'x\');\nvar img = new Image();\nimg.src = imgSrc;\nimg.onload = function(imgObj) {\n  \\$(\'#img\')\n    .remove()\n    .prepend(imgObj); //替换img对象\n};`, `86720029213231560000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                data-tooltip="复制"\n              >\n                <svg class="gatsby-code-button-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0V0z"/><path d="M16 1H2v16h2V3h12V1zm-1 4l6 6v12H6V5h9zm-1 7h5.5L14 6.5V12z"/></svg>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">var</span> dpr <span class="token operator">=</span> window<span class="token punctuation">.</span>devicePixelRatio<span class="token punctuation">;</span>\n<span class="token keyword">if</span> <span class="token punctuation">(</span>dpr <span class="token operator">></span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  dpr <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">var</span> imgSrc <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">\'#img\'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">data</span><span class="token punctuation">(</span><span class="token string">\'src\'</span> <span class="token operator">+</span> dpr <span class="token operator">+</span> <span class="token string">\'x\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">var</span> img <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Image</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\nimg<span class="token punctuation">.</span>src <span class="token operator">=</span> imgSrc<span class="token punctuation">;</span>\nimg<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">imgObj</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">\'#img\'</span><span class="token punctuation">)</span>\n    <span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n    <span class="token punctuation">.</span><span class="token function">prepend</span><span class="token punctuation">(</span>imgObj<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//替换img对象</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="picture"><a href="#picture" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>picture</h3>\n<p>为不同的视口提供不同的图片，使用 <code class="language-text">&lt;picture&gt;</code> 标签。<code class="language-text">&lt;picture&gt;</code> 是 html5 中定义的一个容器标签，内部使用 <code class="language-text">&lt;source&gt;</code> 和 <code class="language-text">&lt;image&gt;</code>，浏览器会匹配 <code class="language-text">&lt;source&gt;</code> 的 type,media,srcset 等属性，找到最适合当前布局/视口宽度/设备像素密度的图像进行加载。这里的 <code class="language-text">&lt;img&gt;</code> 标签是浏览器不支持 picture 元素，或者支持 picture 但没有合适的媒体定义时的后备，不能省略。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="99395449880853710000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`<picture>\n  <source media=&quot;(min-width: 30px)&quot; srcset=&quot;cat-vertical.jpg&quot; />\n  <source media=&quot;(min-width: 60px)&quot; srcset=&quot;cat-horizontal.jpg&quot; />\n  <img src=&quot;cat.jpg&quot; alt=&quot;cat&quot; />\n</picture>`, `99395449880853710000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                data-tooltip="复制"\n              >\n                <svg class="gatsby-code-button-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0V0z"/><path d="M16 1H2v16h2V3h12V1zm-1 4l6 6v12H6V5h9zm-1 7h5.5L14 6.5V12z"/></svg>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="html"><pre style="counter-reset: linenumber NaN" class="language-html line-numbers"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>picture</span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>source</span> <span class="token attr-name">media</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>(min-width: 30px)<span class="token punctuation">"</span></span> <span class="token attr-name">srcset</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>cat-vertical.jpg<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>source</span> <span class="token attr-name">media</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>(min-width: 60px)<span class="token punctuation">"</span></span> <span class="token attr-name">srcset</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>cat-horizontal.jpg<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>cat.jpg<span class="token punctuation">"</span></span> <span class="token attr-name">alt</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>cat<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>picture</span><span class="token punctuation">></span></span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="image-set"><a href="#image-set" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Image-set</h3>\n<p>对于背景图片，使用 image-set 根据用户设备的分辨率匹配合适的图像，同时要考虑兼容性问题。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="43357154055399000000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`.css {\n  background-image: url(1x.png); /*不支持image-set的情况下显示*/\n  background: -image-set(\n    url(1x.png) 1x,\n    /* 支持image-set的浏览器的[普通屏幕]下 */ url(2x.png) 2x,\n    /* 支持image-set的浏览器的[2倍Retina屏幕] */ url(3x.png) 3x /* 支持image-set的浏览器的[3倍Retina屏幕] */\n  );\n}`, `43357154055399000000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                data-tooltip="复制"\n              >\n                <svg class="gatsby-code-button-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0V0z"/><path d="M16 1H2v16h2V3h12V1zm-1 4l6 6v12H6V5h9zm-1 7h5.5L14 6.5V12z"/></svg>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">.css</span> <span class="token punctuation">{</span>\n  <span class="token property">background-image</span><span class="token punctuation">:</span> <span class="token url"><span class="token function">url</span><span class="token punctuation">(</span>1x.png<span class="token punctuation">)</span></span><span class="token punctuation">;</span> <span class="token comment">/*不支持image-set的情况下显示*/</span>\n  <span class="token property">background</span><span class="token punctuation">:</span> <span class="token function">-image-set</span><span class="token punctuation">(</span>\n    <span class="token url"><span class="token function">url</span><span class="token punctuation">(</span>1x.png<span class="token punctuation">)</span></span> 1x<span class="token punctuation">,</span>\n    <span class="token comment">/* 支持image-set的浏览器的[普通屏幕]下 */</span> <span class="token url"><span class="token function">url</span><span class="token punctuation">(</span>2x.png<span class="token punctuation">)</span></span> 2x<span class="token punctuation">,</span>\n    <span class="token comment">/* 支持image-set的浏览器的[2倍Retina屏幕] */</span> <span class="token url"><span class="token function">url</span><span class="token punctuation">(</span>3x.png<span class="token punctuation">)</span></span> 3x <span class="token comment">/* 支持image-set的浏览器的[3倍Retina屏幕] */</span>\n  <span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="media-query"><a href="#media-query" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>media query</h3>\n<p>对于背景图片，使用媒体查询自动切换不同分辨率的版本</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="68053087606789456000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`/* 普通显示屏(设备像素比例小于等于1)使用1倍的图 */\n.css {\n  background-image: url(img_1x.png);\n}\n\n/* 高清显示屏(设备像素比例大于等于2)使用2倍图  */\n@media only screen and (min-device-pixel-ratio: 2) {\n  .css {\n    background-image: url(img_2x.png);\n  }\n}\n\n/* 高清显示屏(设备像素比例大于等于3)使用3倍图  */\n@media only screen and (min-device-pixel-ratio: 3) {\n  .css {\n    background-image: url(img_3x.png);\n  }\n}`, `68053087606789456000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                data-tooltip="复制"\n              >\n                <svg class="gatsby-code-button-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0V0z"/><path d="M16 1H2v16h2V3h12V1zm-1 4l6 6v12H6V5h9zm-1 7h5.5L14 6.5V12z"/></svg>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token comment">/* 普通显示屏(设备像素比例小于等于1)使用1倍的图 */</span>\n<span class="token selector">.css</span> <span class="token punctuation">{</span>\n  <span class="token property">background-image</span><span class="token punctuation">:</span> <span class="token url"><span class="token function">url</span><span class="token punctuation">(</span>img_1x.png<span class="token punctuation">)</span></span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token comment">/* 高清显示屏(设备像素比例大于等于2)使用2倍图  */</span>\n<span class="token atrule"><span class="token rule">@media</span> only screen and <span class="token punctuation">(</span><span class="token property">min-device-pixel-ratio</span><span class="token punctuation">:</span> 2<span class="token punctuation">)</span></span> <span class="token punctuation">{</span>\n  <span class="token selector">.css</span> <span class="token punctuation">{</span>\n    <span class="token property">background-image</span><span class="token punctuation">:</span> <span class="token url"><span class="token function">url</span><span class="token punctuation">(</span>img_2x.png<span class="token punctuation">)</span></span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n\n<span class="token comment">/* 高清显示屏(设备像素比例大于等于3)使用3倍图  */</span>\n<span class="token atrule"><span class="token rule">@media</span> only screen and <span class="token punctuation">(</span><span class="token property">min-device-pixel-ratio</span><span class="token punctuation">:</span> 3<span class="token punctuation">)</span></span> <span class="token punctuation">{</span>\n  <span class="token selector">.css</span> <span class="token punctuation">{</span>\n    <span class="token property">background-image</span><span class="token punctuation">:</span> <span class="token url"><span class="token function">url</span><span class="token punctuation">(</span>img_3x.png<span class="token punctuation">)</span></span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h1 id="总结"><a href="#%E6%80%BB%E7%BB%93" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>总结</h1>\n<p>对于上述的各种移动端 web 页面自适应方案来说，都存在着一些优势和不足。对于国内的一些互联网站，通过查看网页源代码发现，它可能不是某一种方案的单独使用，而是几种方案的结合。</p>\n<p>一个页面上，元素的宽度设置上有百分比，也有 rem，字体的样式中有 rem，有 em，也有固定大小的 px；在屏幕宽度过大时不再缩放，也会用到媒体查询，并且响应式设计更多地可能是针对不同设备间的自适应。</p>\n<p>对于移动端 web 页面的自适应方案来说，现在用的比较多的是 rem，逐渐向 vw/vh 发展，而 rem+vw/vh 则是作为 vw/vh 向后兼容的一种过渡。</p>',
excerpt:"移动端 web 页面的开发，由于手机屏幕尺寸、分辨率不同，或者需要考虑横竖屏问题，为了使得 web 页面在不同移动设备上具有相适应的展示效果，需要在开发过程中使用合理的适配方案来解决这个问题。 方案概述 静态布局 + initial-scale + 各个元素 px…",timeToRead:13,tableOfContents:'<ul>\n<li>\n<p><a href="/mobile-page-adaptation/#%E6%96%B9%E6%A1%88%E6%A6%82%E8%BF%B0">方案概述</a></p>\n<ul>\n<li><a href="/mobile-page-adaptation/#%E9%9D%99%E6%80%81%E5%B8%83%E5%B1%80--initial-scale--%E5%90%84%E4%B8%AA%E5%85%83%E7%B4%A0-px">静态布局 + initial-scale + 各个元素 px</a></li>\n<li><a href="/mobile-page-adaptation/#%E6%B5%81%E5%BC%8F%E5%B8%83%E5%B1%80--%E5%AE%BD%E5%BA%A6%E7%99%BE%E5%88%86%E6%AF%94--%E9%AB%98%E5%BA%A6-px">流式布局 + 宽度百分比 + 高度 px</a></li>\n<li><a href="/mobile-page-adaptation/#%E5%BC%B9%E6%80%A7%E5%B8%83%E5%B1%80--emrem--px%E7%99%BE%E5%88%86%E6%AF%94emrem">弹性布局 + em/rem + px/百分比/em/rem</a></li>\n<li><a href="/mobile-page-adaptation/#%E5%93%8D%E5%BA%94%E5%BC%8F%E5%B8%83%E5%B1%80--%E5%AA%92%E4%BD%93%E6%9F%A5%E8%AF%A2--%E4%BB%A5%E4%B8%8A%E6%96%B9%E6%A1%88">响应式布局 + 媒体查询 + 以上方案</a></li>\n</ul>\n</li>\n<li>\n<p><a href="/mobile-page-adaptation/#%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5">基本概念</a></p>\n<ul>\n<li>\n<p><a href="/mobile-page-adaptation/#%E5%83%8F%E7%B4%A0">像素</a></p>\n<ul>\n<li><a href="/mobile-page-adaptation/#px-pixel">px (pixel)</a></li>\n<li><a href="/mobile-page-adaptation/#pt-point">pt (point)</a></li>\n<li><a href="/mobile-page-adaptation/#css-%E5%83%8F%E7%B4%A0">css 像素</a></li>\n<li><a href="/mobile-page-adaptation/#ppi-pixel-per-inch">PPI (pixel per inch)</a></li>\n<li><a href="/mobile-page-adaptation/#dpi-dot-per-inch">DPI (dot per inch)</a></li>\n<li><a href="/mobile-page-adaptation/#dpr-devicepixelratio">DPR (devicePixelRatio)</a></li>\n</ul>\n</li>\n<li><a href="/mobile-page-adaptation/#%E8%A7%86%E5%8F%A3">视口</a></li>\n<li>\n<p><a href="/mobile-page-adaptation/#%E6%89%8B%E6%9C%BA%E5%B1%8F%E5%B9%95%E7%89%B9%E6%80%A7">手机屏幕特性</a></p>\n<ul>\n<li><a href="/mobile-page-adaptation/#%E5%83%8F%E7%B4%A0%E5%88%86%E8%BE%A8%E7%8E%87">像素分辨率</a></li>\n<li><a href="/mobile-page-adaptation/#%E9%80%BB%E8%BE%91%E5%88%86%E8%BE%A8%E7%8E%87">逻辑分辨率</a></li>\n<li><a href="/mobile-page-adaptation/#%E5%80%8D%E7%8E%87">倍率</a></li>\n<li><a href="/mobile-page-adaptation/#%E5%B0%BA%E5%AF%B8">尺寸</a></li>\n</ul>\n</li>\n</ul>\n</li>\n<li>\n<p><a href="/mobile-page-adaptation/#%E9%80%82%E9%85%8D%E6%96%B9%E6%A1%88">适配方案</a></p>\n<ul>\n<li>\n<p><a href="/mobile-page-adaptation/#%E7%99%BE%E5%88%86%E6%AF%94%E6%96%B9%E6%A1%88">百分比方案</a></p>\n<ul>\n<li><a href="/mobile-page-adaptation/#%E5%8E%9F%E7%90%86">原理</a></li>\n<li><a href="/mobile-page-adaptation/#%E5%AE%9E%E7%8E%B0%E8%BF%87%E7%A8%8B">实现过程</a></li>\n<li><a href="/mobile-page-adaptation/#%E4%BC%98%E7%82%B9">优点</a></li>\n<li><a href="/mobile-page-adaptation/#%E7%BC%BA%E7%82%B9">缺点</a></li>\n</ul>\n</li>\n<li>\n<p><a href="/mobile-page-adaptation/#rem-%E6%96%B9%E6%A1%88">rem 方案</a></p>\n<ul>\n<li><a href="/mobile-page-adaptation/#%E5%8E%9F%E7%90%86-1">原理</a></li>\n<li><a href="/mobile-page-adaptation/#%E5%AE%9E%E7%8E%B0%E8%BF%87%E7%A8%8B-1">实现过程</a></li>\n<li><a href="/mobile-page-adaptation/#%E4%BC%98%E7%82%B9-1">优点</a></li>\n<li><a href="/mobile-page-adaptation/#%E7%BC%BA%E7%82%B9-1">缺点</a></li>\n</ul>\n</li>\n<li>\n<p><a href="/mobile-page-adaptation/#vhvw-%E6%96%B9%E6%A1%88">vh/vw 方案</a></p>\n<ul>\n<li><a href="/mobile-page-adaptation/#%E5%8E%9F%E7%90%86-2">原理</a></li>\n<li><a href="/mobile-page-adaptation/#%E5%AE%9E%E7%8E%B0%E8%BF%87%E7%A8%8B-2">实现过程</a></li>\n<li><a href="/mobile-page-adaptation/#%E4%BC%98%E7%82%B9-2">优点</a></li>\n<li><a href="/mobile-page-adaptation/#%E7%BC%BA%E7%82%B9-2">缺点</a></li>\n</ul>\n</li>\n<li>\n<p><a href="/mobile-page-adaptation/#rem--vwvh-%E6%96%B9%E6%A1%88">rem + vw/vh 方案</a></p>\n<ul>\n<li><a href="/mobile-page-adaptation/#%E5%8E%9F%E7%90%86-3">原理</a></li>\n<li><a href="/mobile-page-adaptation/#%E5%AE%9E%E7%8E%B0%E8%BF%87%E7%A8%8B-3">实现过程</a></li>\n<li><a href="/mobile-page-adaptation/#%E9%80%82%E7%94%A8%E5%9C%BA%E6%99%AF">适用场景</a></li>\n</ul>\n</li>\n<li>\n<p><a href="/mobile-page-adaptation/#%E5%9F%BA%E4%BA%8E%E5%AA%92%E4%BD%93%E6%9F%A5%E8%AF%A2%E7%9A%84%E5%93%8D%E5%BA%94%E5%BC%8F%E8%AE%BE%E8%AE%A1">基于媒体查询的响应式设计</a></p>\n<ul>\n<li><a href="/mobile-page-adaptation/#%E5%8E%9F%E7%90%86-4">原理</a></li>\n<li><a href="/mobile-page-adaptation/#%E5%AE%9E%E7%8E%B0%E8%BF%87%E7%A8%8B-4">实现过程</a></li>\n<li><a href="/mobile-page-adaptation/#%E4%BC%98%E7%82%B9-3">优点</a></li>\n<li><a href="/mobile-page-adaptation/#%E7%BC%BA%E7%82%B9-3">缺点</a></li>\n</ul>\n</li>\n</ul>\n</li>\n<li>\n<p><a href="/mobile-page-adaptation/#%E5%85%B6%E4%BB%96%E9%80%9A%E7%94%A8%E9%97%AE%E9%A2%98">其他通用问题</a></p>\n<ul>\n<li>\n<p><a href="/mobile-page-adaptation/#1-%E5%83%8F%E7%B4%A0%E9%97%AE%E9%A2%98">1 像素问题</a></p>\n<ul>\n<li><a href="/mobile-page-adaptation/#%E8%AE%BE%E7%BD%AE-scale-%E4%B8%BA-1dpr">设置 scale 为 1/dpr</a></li>\n<li><a href="/mobile-page-adaptation/#transform-%E7%9A%84-scale-%E5%B1%9E%E6%80%A7">transform 的 scale 属性</a></li>\n<li><a href="/mobile-page-adaptation/#border-image-%E5%B1%9E%E6%80%A7">border-image 属性</a></li>\n</ul>\n</li>\n<li>\n<p><a href="/mobile-page-adaptation/#%E5%AF%B9%E5%9B%BE%E7%89%87%E7%9A%84%E5%A4%84%E7%90%86">对图片的处理</a></p>\n<ul>\n<li><a href="/mobile-page-adaptation/#srcset-%E5%92%8C-sizes">srcset 和 sizes</a></li>\n<li><a href="/mobile-page-adaptation/#%E5%BC%82%E6%AD%A5%E5%8A%A0%E8%BD%BD">异步加载</a></li>\n<li><a href="/mobile-page-adaptation/#picture">picture</a></li>\n<li><a href="/mobile-page-adaptation/#image-set">Image-set</a></li>\n<li><a href="/mobile-page-adaptation/#media-query">media query</a></li>\n</ul>\n</li>\n</ul>\n</li>\n<li><a href="/mobile-page-adaptation/#%E6%80%BB%E7%BB%93">总结</a></li>\n</ul>',wordCount:{words:903},frontmatter:{date:"2020-06-24 22:50:32",path:"/mobile-page-adaptation/",tags:"前端, 移动端, 页面适配",title:"移动端Web页面适配",draft:null,catalog_number:null}},nextPost:{html:'<p>从 2017 年发出关于 v5 的投票开始，到 2019 年 10 月发布第一个 beta 版本，目前是 5.0.0-beta.16。现在在收集使用反馈、生态升级的过程中，相信不久后就可以正式发布了。这次升级重点：性能改进、Tree Shacking、Code Generation、Module Federation。</p>\n<p>下面我们跟着 Changelog 来动手，测测重点内容~</p>\n<h1 id="优化持久缓存"><a href="#%E4%BC%98%E5%8C%96%E6%8C%81%E4%B9%85%E7%BC%93%E5%AD%98" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>优化持久缓存</h1>\n<p>首先简单说 Webpack 中 graph 的概念：</p>\n<p>Webpack 在执行的时候，以配置的 entry 为入口，递归解析文件依赖，构建一个 graph，记录代码中各个 module 之间的关系。每当有文件更新的时候，递归过程会重来，graph 发生改变。</p>\n<p>如果简单粗暴地重建 graph 再编译，会有很大的性能开销，Webpack 利用缓存实现增量编译，从而提升构建性能。</p>\n<p>缓存（内存 / 磁盘两种形式）中的主要内容是 module objects，在编译的时候会将 graph 以二进制或者 json 文件存储在硬盘上。每当代码变化、模块之间依赖关系改变导致 graph 改变时，Webpack 会读取记录做增量编译。</p>\n<h2 id="之前持久缓存的方式"><a href="#%E4%B9%8B%E5%89%8D%E6%8C%81%E4%B9%85%E7%BC%93%E5%AD%98%E7%9A%84%E6%96%B9%E5%BC%8F" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>之前持久缓存的方式</h2>\n<p>之前可以使用 loader 设置缓存：</p>\n<ol>\n<li>使用 cache-loader 可以将编译结果写入硬盘缓存，Webpack 再次构建时如果文件没有发生变化则会直接拉取缓存</li>\n<li>还有一部分 loader 自带缓存配置，比如 babel-loader，可以配置参数 cacheDirectory 使用缓存，将每次的编译结果写进磁盘（默认在 node_modules/.cache/babel-loader 目录），UglifyJsPlugin 插件中的 cache 选项</li>\n<li>terser-webpack-plugin 开启缓存</li>\n<li>hard-source-webpack-plugin 插件</li>\n<li>webpack.DllPlugin 插件</li>\n</ol>\n<h2 id="现在的方案"><a href="#%E7%8E%B0%E5%9C%A8%E7%9A%84%E6%96%B9%E6%A1%88" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>现在的方案</h2>\n<p>v5 中缓存默认是 memory，你可以修改设置写入硬盘：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="84048463975074040000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`module.exports = {\n  cache: {\n    type: \'filesystem\',\n    // cacheDirectory 默认路径是 node_modules/.cache/webpack\n    cacheDirectory: path.resolve(__dirname, \'.temp_cache\')\n  }\n};`, `84048463975074040000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                data-tooltip="复制"\n              >\n                <svg class="gatsby-code-button-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0V0z"/><path d="M16 1H2v16h2V3h12V1zm-1 4l6 6v12H6V5h9zm-1 7h5.5L14 6.5V12z"/></svg>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>\n  cache<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n    type<span class="token punctuation">:</span> <span class="token string">\'filesystem\'</span><span class="token punctuation">,</span>\n    <span class="token comment">// cacheDirectory 默认路径是 node_modules/.cache/webpack</span>\n    cacheDirectory<span class="token punctuation">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">\'.temp_cache\'</span><span class="token punctuation">)</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>注：对大部分 <code class="language-text">node_modules</code> 哈希处理以构建依赖项，代价昂贵，还降低 Webpack 执行速度。为避免这种情况出现，Webpack 加入了一些优化，默认会跳过 <code class="language-text">node_modules</code>，并使用 package.json 中的 version 和 name 作为数据源，有点类似于 webpack.DllPlugin</p>\n<h1 id="优化长期缓存"><a href="#%E4%BC%98%E5%8C%96%E9%95%BF%E6%9C%9F%E7%BC%93%E5%AD%98" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>优化长期缓存</h1>\n<p>Webpack 5 针对 moduleId 和 chunkId 的计算方式进行了优化，增加确定性的 moduleId 和 chunkId 的生成策略。moduleId 根据上下文模块路径，chunkId 根据 chunk 内容计算，最后为 moduleId 和 chunkId 生成 3 - 4 位的数字 id，实现长期缓存，生产环境下默认开启。</p>\n<h2 id="对比原来的-moduleid"><a href="#%E5%AF%B9%E6%AF%94%E5%8E%9F%E6%9D%A5%E7%9A%84-moduleid" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>对比原来的 moduleId</h2>\n<p>原来的 moduleId 默认值是自增 id，容易导致文件缓存失效。在 v4 之前，可以安装 HashedModuleIdsPlugin 插件覆盖默认的 moduleId 规则， 它会使用模块路径生成的 hash 作为 moduleId。在 v4 中，可以配置 optimization.moduleIds = ‘hashed’</p>\n<h2 id="对比原来的-chunkid"><a href="#%E5%AF%B9%E6%AF%94%E5%8E%9F%E6%9D%A5%E7%9A%84-chunkid" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>对比原来的 chunkId</h2>\n<p>原来的 chunkId 默认值自增 id。比如这样的配置下，如果有新的 entry 增加，chunk 数量也会跟着增加，chunkId 也会递增。之前可以安装 NamedChunksPlugin 插件来稳定 chunkId；或者配置 optimization.chunkIds = ‘named’</p>\n<h1 id="nodejs-的-polyfill-脚本被移除"><a href="#nodejs-%E7%9A%84-polyfill-%E8%84%9A%E6%9C%AC%E8%A2%AB%E7%A7%BB%E9%99%A4" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>NodeJS 的 polyfill 脚本被移除</h1>\n<p>最开始，Webpack 目标是允许在浏览器中运行 Node 模块。但是现在在 Webpack 看来，大多模块就是专门为前端开发的。在 v4 及以前的版本中，对于大多数的 Node 模块会自动添加 polyfill 脚本，polyfill 会加到最终的 bundle 中，其实通常情况下是没有必要的。在 v5 中将停止这一行为。</p>\n<p>比如以下一段代码：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="76329099676570530000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// index.js\nimport sha256 from \'crypto-js/sha256\';\n\nconst hashDigest = sha256(\'hello world\');\nconsole.log(hashDigest);`, `76329099676570530000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                data-tooltip="复制"\n              >\n                <svg class="gatsby-code-button-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0V0z"/><path d="M16 1H2v16h2V3h12V1zm-1 4l6 6v12H6V5h9zm-1 7h5.5L14 6.5V12z"/></svg>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// index.js</span>\n<span class="token keyword">import</span> sha256 <span class="token keyword">from</span> <span class="token string">\'crypto-js/sha256\'</span><span class="token punctuation">;</span>\n\n<span class="token keyword">const</span> hashDigest <span class="token operator">=</span> <span class="token function">sha256</span><span class="token punctuation">(</span><span class="token string">\'hello world\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\nconsole<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>hashDigest<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>在 v4 中，会主动添加 crypto 的 polyfill，也就是 crypto-browserify。我们运行的代码是不需要的，反而最后的包变大，编译结果 <code class="language-text">417 kb</code>：</p>\n<p>\n  <a\n    class="gatsby-resp-image-link"\n    href="/static/2020-06-23-12-15-19-bf4623ed1c02f090d14c72b3bd4b854b-6e10a.png"\n    style="display: block"\n    target="_blank"\n    rel="noopener"\n  >\n  \n  <span\n    class="gatsby-resp-image-wrapper"\n    style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;"\n  >\n    <span\n      class="gatsby-resp-image-background-image"\n      style="padding-bottom: 40.8%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAIAAAB2/0i6AAAACXBIWXMAAA7DAAAOwwHHb6hkAAABAElEQVQY04VQXW+DMBCDgpZQEsIllHxBESqMUbb///fmFq0S2kP9EOXu7JydJGe5neZmGMx1MDFWUgoh6rouiiJ5i7IsG601kSGylwdQQWyMwd17b+3evoQQ2raNMTrnUDZNkzDOKkApaHYBujjBa56AHiNQ2ifwBGj7KMFAKTX/YV3XZVmICKbSNH1jOz4QIBsQW+txHOEzz/Nd/MKLf+jAYwjR+wCnRFpK2XUdUjnrsizbBafTiTGGL+ScHzZrEvf7TIRI9dcykjbbtiFVpaWoz2fBlOJEyPUJa33fH8TTLc5Th49c12nb+vmmOf8YvuP1x5GvSsGclaLk2Pw/8i9lKhuJtE/JVAAAAABJRU5ErkJggg==\'); background-size: cover; display: block;"\n    >\n      <img\n        class="gatsby-resp-image-image"\n        style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;"\n        alt="2020 06 23 12 15 19"\n        title=""\n        src="/static/2020-06-23-12-15-19-bf4623ed1c02f090d14c72b3bd4b854b-fee1c.png"\n        srcset="/static/2020-06-23-12-15-19-bf4623ed1c02f090d14c72b3bd4b854b-a67b7.png 200w,\n/static/2020-06-23-12-15-19-bf4623ed1c02f090d14c72b3bd4b854b-0b187.png 400w,\n/static/2020-06-23-12-15-19-bf4623ed1c02f090d14c72b3bd4b854b-fee1c.png 800w,\n/static/2020-06-23-12-15-19-bf4623ed1c02f090d14c72b3bd4b854b-6e10a.png 1000w"\n        sizes="(max-width: 800px) 100vw, 800px"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<p>在 v5 中，如果遇到了这样的情况，会提示你进行确认。如果确认不需要 node polyfill，按照提示 alias 设置为 false 即可。最后的编译结果仅有 <code class="language-text">5.69 kb</code>：</p>\n<p>\n  <a\n    class="gatsby-resp-image-link"\n    href="/static/2020-06-23-12-15-57-da36cc606b3598c2f2a469651b741aff-34bc5.png"\n    style="display: block"\n    target="_blank"\n    rel="noopener"\n  >\n  \n  <span\n    class="gatsby-resp-image-wrapper"\n    style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;"\n  >\n    <span\n      class="gatsby-resp-image-background-image"\n      style="padding-bottom: 61.01851851851852%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAIAAADtbgqsAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABn0lEQVQoz41S2Y6bQBAEGzAYmPtgDjCXwUB8RPFD/v/L0qwSJU+bbZVarZKaquohcM4ZY6BjjL33MMRxHHyxjDPWWUopfCIvclUpWI6O0fF4DMJgxyfle2dqDZva6GrgxBZplmZZliTJ/5X7rn+/38/H83q9TvO0PG9157P0jEnJHY7T6LNlSlnXdcMwXC4X0GeMIYRAG7ECqzw8fOp7miznRYmwr+uqqqRSUkohJSEUC1TgPElOpzQF/Fs7czoFP173b+ttW5Z5HJXginOjlRKiUopRRFCpuDBqZ4zWQAK0lAAhRPBzXZdheC23W9dem8YyNnjfaDU4N7c70zvbOzd4d23qW9tOTQOkys8HsA0sk9LC+3oPvTKmshZsX9oWZgo3EAI6/+iEUkzIuSjoOYsOh0CVZYnQOI7TNMHBt21b1xX+FnCntD7nufwozvke8s/DF3EUhWFQcwYZX/c7xJ7G8bFt35/PZZ6t1oIzWIJ4zlQajgguCAHBQxjiJNmXLSVj7R/zBAmXvgfA4AT3QqBTAgq/EUV/5zjK4wgs/AKCSi9HvpO8xgAAAABJRU5ErkJggg==\'); background-size: cover; display: block;"\n    >\n      <img\n        class="gatsby-resp-image-image"\n        style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;"\n        alt="2020 06 23 12 15 57"\n        title=""\n        src="/static/2020-06-23-12-15-57-da36cc606b3598c2f2a469651b741aff-fee1c.png"\n        srcset="/static/2020-06-23-12-15-57-da36cc606b3598c2f2a469651b741aff-a67b7.png 200w,\n/static/2020-06-23-12-15-57-da36cc606b3598c2f2a469651b741aff-0b187.png 400w,\n/static/2020-06-23-12-15-57-da36cc606b3598c2f2a469651b741aff-fee1c.png 800w,\n/static/2020-06-23-12-15-57-da36cc606b3598c2f2a469651b741aff-34bc5.png 1080w"\n        sizes="(max-width: 800px) 100vw, 800px"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<p>配置 <code class="language-text">resolve.alias: { crypto: false }：</code></p>\n<p>\n  <a\n    class="gatsby-resp-image-link"\n    href="/static/2020-06-23-12-16-18-c382949eb2312558db65901965f8b2f8-34bc5.png"\n    style="display: block"\n    target="_blank"\n    rel="noopener"\n  >\n  \n  <span\n    class="gatsby-resp-image-wrapper"\n    style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;"\n  >\n    <span\n      class="gatsby-resp-image-background-image"\n      style="padding-bottom: 51.2962962962963%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAIAAAA7N+mxAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABMElEQVQoz42R227CMAyGgR5IybFN0jRt0nbiUIREmSYYmxAS7/9U8wq7mAYa34XlJHb82x4RjGWWcsa0lCbPlVJSSrBaa2utMQZ8sEVRwLEYgIDxeDwCEEIY4yzL4CofSNMUDxBChBDT6TRJEvA55/iHIAi+k6uqcs71fb/dbruuO51Om81mNpuNngEKQlkQA3/HccwoU1JRyv5G3qT+Ss7lar3knDVNA11RRipfEkpAWBiGN3mPsK1puzqTadu0ulDlWsuaJwQxxqC3f/SDSEhbLBfQeWFNURlTa9PkEYrgdTKZhFEQofCOZgCGdD6fL5fL4XB4Px53u9f9/u3jcz+ft85XL6u67UvdZA9kW+u9Xw9472ChSgnvRGmFLoV0ApH4ftkrMBVK6XWrzy5p4As9lx7T8oYcawAAAABJRU5ErkJggg==\'); background-size: cover; display: block;"\n    >\n      <img\n        class="gatsby-resp-image-image"\n        style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;"\n        alt="2020 06 23 12 16 18"\n        title=""\n        src="/static/2020-06-23-12-16-18-c382949eb2312558db65901965f8b2f8-fee1c.png"\n        srcset="/static/2020-06-23-12-16-18-c382949eb2312558db65901965f8b2f8-a67b7.png 200w,\n/static/2020-06-23-12-16-18-c382949eb2312558db65901965f8b2f8-0b187.png 400w,\n/static/2020-06-23-12-16-18-c382949eb2312558db65901965f8b2f8-fee1c.png 800w,\n/static/2020-06-23-12-16-18-c382949eb2312558db65901965f8b2f8-34bc5.png 1080w"\n        sizes="(max-width: 800px) 100vw, 800px"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<p>浏览器执行结果：</p>\n<p>\n  <a\n    class="gatsby-resp-image-link"\n    href="/static/2020-06-23-12-16-40-8423eecff963f4e61c67541cedeaee08-34bc5.png"\n    style="display: block"\n    target="_blank"\n    rel="noopener"\n  >\n  \n  <span\n    class="gatsby-resp-image-wrapper"\n    style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;"\n  >\n    <span\n      class="gatsby-resp-image-background-image"\n      style="padding-bottom: 37.77777777777778%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAIAAAB2/0i6AAAACXBIWXMAAA7DAAAOwwHHb6hkAAAAzElEQVQY06VQ2W7DMAzz/39kgQ2209SXJB9JIy+dnG7FtqehJQiBkCkZomLm2poP8eK81sYYq4Xa6EMYO92bCXBZ17YsP6luL2AM7/+AuA7//nf4+Z8RMcYIgHJ2SokIpEozhECEAAkARKeBYZBjBfeqpsnGEJyL2jpJaL7EXFqpg7UutQ6n91FrKxsACTETZYAsUPZ0nq1/e3fzTD5ke25UOCHX2pGYMlPpuTDg9i241B7i1vuH4mvfVpb1jzCOfH5Ftd/2R6xf70f9BPIEz3oSGxRyAAAAAElFTkSuQmCC\'); background-size: cover; display: block;"\n    >\n      <img\n        class="gatsby-resp-image-image"\n        style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;"\n        alt="2020 06 23 12 16 40"\n        title=""\n        src="/static/2020-06-23-12-16-40-8423eecff963f4e61c67541cedeaee08-fee1c.png"\n        srcset="/static/2020-06-23-12-16-40-8423eecff963f4e61c67541cedeaee08-a67b7.png 200w,\n/static/2020-06-23-12-16-40-8423eecff963f4e61c67541cedeaee08-0b187.png 400w,\n/static/2020-06-23-12-16-40-8423eecff963f4e61c67541cedeaee08-fee1c.png 800w,\n/static/2020-06-23-12-16-40-8423eecff963f4e61c67541cedeaee08-34bc5.png 1080w"\n        sizes="(max-width: 800px) 100vw, 800px"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<h1 id="更好的-treeshaking"><a href="#%E6%9B%B4%E5%A5%BD%E7%9A%84-treeshaking" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>更好的 TreeShaking</h1>\n<p>现在有这样一段代码：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="46623980407838080000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// inner.js\nexport const a = \'aaaaaaaaaa\';\nexport const b = \'bbbbbbbbbb\';\n\n// module.js\nimport * as inner from \'./inner\';\nexport { inner };\n\n// index.js\nimport * as module from \'./module\';\nconsole.log(module.inner.a);`, `46623980407838080000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                data-tooltip="复制"\n              >\n                <svg class="gatsby-code-button-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0V0z"/><path d="M16 1H2v16h2V3h12V1zm-1 4l6 6v12H6V5h9zm-1 7h5.5L14 6.5V12z"/></svg>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// inner.js</span>\n<span class="token keyword">export</span> <span class="token keyword">const</span> a <span class="token operator">=</span> <span class="token string">\'aaaaaaaaaa\'</span><span class="token punctuation">;</span>\n<span class="token keyword">export</span> <span class="token keyword">const</span> b <span class="token operator">=</span> <span class="token string">\'bbbbbbbbbb\'</span><span class="token punctuation">;</span>\n\n<span class="token comment">// module.js</span>\n<span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> inner <span class="token keyword">from</span> <span class="token string">\'./inner\'</span><span class="token punctuation">;</span>\n<span class="token keyword">export</span> <span class="token punctuation">{</span> inner <span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n<span class="token comment">// index.js</span>\n<span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> module <span class="token keyword">from</span> <span class="token string">\'./module\'</span><span class="token punctuation">;</span>\nconsole<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>module<span class="token punctuation">.</span>inner<span class="token punctuation">.</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>在 v4 中毫无疑问，以上代码 a、b 变量是被全部打包的：</p>\n<p>\n  <a\n    class="gatsby-resp-image-link"\n    href="/static/2020-06-23-12-17-10-c49f37ae21ac76624aab439f20605f5c-34bc5.png"\n    style="display: block"\n    target="_blank"\n    rel="noopener"\n  >\n  \n  <span\n    class="gatsby-resp-image-wrapper"\n    style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;"\n  >\n    <span\n      class="gatsby-resp-image-background-image"\n      style="padding-bottom: 35.37037037037037%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAIAAACHqfpvAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAAb0lEQVQY05WQixHCMAzFskga+9mOnaY/Ctyx/2QcG2AtoJNK9zBfVdXMWmtLhgLI435t62CiJUlh5rnt4Q4x0c5M7W8KEc2xHnNHD7GgjP9nDh9uLgAzUtUFInFc7+f5uU8F11RzhENFVRioNTfsCy4HNJ2FRo3+AAAAAElFTkSuQmCC\'); background-size: cover; display: block;"\n    >\n      <img\n        class="gatsby-resp-image-image"\n        style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;"\n        alt="2020 06 23 12 17 10"\n        title=""\n        src="/static/2020-06-23-12-17-10-c49f37ae21ac76624aab439f20605f5c-fee1c.png"\n        srcset="/static/2020-06-23-12-17-10-c49f37ae21ac76624aab439f20605f5c-a67b7.png 200w,\n/static/2020-06-23-12-17-10-c49f37ae21ac76624aab439f20605f5c-0b187.png 400w,\n/static/2020-06-23-12-17-10-c49f37ae21ac76624aab439f20605f5c-fee1c.png 800w,\n/static/2020-06-23-12-17-10-c49f37ae21ac76624aab439f20605f5c-34bc5.png 1080w"\n        sizes="(max-width: 800px) 100vw, 800px"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<p>但我们只调用了 a 变量，理想情况应该是 b 被识别为 unused，不被打包。这一优化在 v5 中实现了。在 v5 中会分析模块 export 与 import 之间的依赖关系，最终的代码生成非常简洁：</p>\n<p>\n  <a\n    class="gatsby-resp-image-link"\n    href="/static/2020-06-23-12-17-33-e3f5619861dd1660853633f5f2b1806b-34bc5.png"\n    style="display: block"\n    target="_blank"\n    rel="noopener"\n  >\n  \n  <span\n    class="gatsby-resp-image-wrapper"\n    style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;"\n  >\n    <span\n      class="gatsby-resp-image-background-image"\n      style="padding-bottom: 8.148148148148147%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAACCAIAAADXZGvcAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAAUUlEQVQI12XMyQ2AMAxE0TQSjOMlMZGyQf+1YSFxQLzz/Al9nnP00exai0smlVrNshTlehgRAcD+A4+AJOwTREroJSl7aipF/CpjSjHG7QteNzSbEKrSTad2AAAAAElFTkSuQmCC\'); background-size: cover; display: block;"\n    >\n      <img\n        class="gatsby-resp-image-image"\n        style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;"\n        alt="2020 06 23 12 17 33"\n        title=""\n        src="/static/2020-06-23-12-17-33-e3f5619861dd1660853633f5f2b1806b-fee1c.png"\n        srcset="/static/2020-06-23-12-17-33-e3f5619861dd1660853633f5f2b1806b-a67b7.png 200w,\n/static/2020-06-23-12-17-33-e3f5619861dd1660853633f5f2b1806b-0b187.png 400w,\n/static/2020-06-23-12-17-33-e3f5619861dd1660853633f5f2b1806b-fee1c.png 800w,\n/static/2020-06-23-12-17-33-e3f5619861dd1660853633f5f2b1806b-34bc5.png 1080w"\n        sizes="(max-width: 800px) 100vw, 800px"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<h1 id="module-federation"><a href="#module-federation" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Module Federation</h1>\n<p>让 Webpack 达到了线上 runtime 的效果，让代码直接在独立应用间利用 CDN 直接共享，不再需要本地安装 NPM 包、构建再发布了！</p>\n<h2 id="之前共享代码的处理方式"><a href="#%E4%B9%8B%E5%89%8D%E5%85%B1%E4%BA%AB%E4%BB%A3%E7%A0%81%E7%9A%84%E5%A4%84%E7%90%86%E6%96%B9%E5%BC%8F" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>之前共享代码的处理方式</h2>\n<h3 id="npm"><a href="#npm" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>NPM</h3>\n<p>维护一个 CommonComponents 的 NPM 包，在不同项目中安装、使用。如果 NPM 包升级，对应项目都需要安装新版本，本地编译，打包到 bundle 中。</p>\n<h3 id="umd"><a href="#umd" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>UMD</h3>\n<p>UMD 优点在 runtime。缺点也明显，体积优化不方便，容易有版本冲突。</p>\n<h3 id="微前端"><a href="#%E5%BE%AE%E5%89%8D%E7%AB%AF" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>微前端</h3>\n<p>独立应用间的共享也是问题。一般有两种打包方式：</p>\n<ol>\n<li>子应用独立打包，模块解耦了，但公共的依赖不易维护处理</li>\n<li>整体应用一起打包，能解决公共依赖；但庞大的多个项目又使打包变慢，后续也不好扩展</li>\n</ol>\n<h2 id="全新的解决方案"><a href="#%E5%85%A8%E6%96%B0%E7%9A%84%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>全新的解决方案</h2>\n<p>\n  <a\n    class="gatsby-resp-image-link"\n    href="/static/2020-06-23-12-20-30-bb5fdddb76e6d89b8169a91960ad8cc7-34bc5.png"\n    style="display: block"\n    target="_blank"\n    rel="noopener"\n  >\n  \n  <span\n    class="gatsby-resp-image-wrapper"\n    style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;"\n  >\n    <span\n      class="gatsby-resp-image-background-image"\n      style="padding-bottom: 38.51851851851852%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAIAAAB2/0i6AAAACXBIWXMAAA7DAAAOwwHHb6hkAAABDElEQVQY012R3XKCMBBGef8HqVf2os7ghZ3iSxStN3XUmRZBpkTyQwjSk4TaTsMBwrffJrsh6awrq0txLq+tsv3Q2V4bq00HSnems0F0l/qrOFdlVRNFsb2DxA3Mesvl3HC7ebjD4D2OYxSDx4MfCECijWETNmBiOoP7bbebP86z9fppsXjNc5Tg0XiU9l7w64dk/620kUpdpcR6PJ0eZrN0uUzTtK5rbIQwKG/1sMqUzBRY4OOzKKvqfb/PN/nqeQUvWbbZbg/HA8mNaGJ1PH+TY+s0LKUUQjRCsAFdoQB1trKlHaqLCtD51PPdF08iHtLfMQTDj20IuCn5fozg/4tzYwhEGFH/Z4tlfwMkoMsh9gJaWwAAAABJRU5ErkJggg==\'); background-size: cover; display: block;"\n    >\n      <img\n        class="gatsby-resp-image-image"\n        style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;"\n        alt="2020 06 23 12 20 30"\n        title=""\n        src="/static/2020-06-23-12-20-30-bb5fdddb76e6d89b8169a91960ad8cc7-fee1c.png"\n        srcset="/static/2020-06-23-12-20-30-bb5fdddb76e6d89b8169a91960ad8cc7-a67b7.png 200w,\n/static/2020-06-23-12-20-30-bb5fdddb76e6d89b8169a91960ad8cc7-0b187.png 400w,\n/static/2020-06-23-12-20-30-bb5fdddb76e6d89b8169a91960ad8cc7-fee1c.png 800w,\n/static/2020-06-23-12-20-30-bb5fdddb76e6d89b8169a91960ad8cc7-34bc5.png 1080w"\n        sizes="(max-width: 800px) 100vw, 800px"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<p>从图中可以看到，这个方案是直接将一个应用的 bundle，应用于另一个应用。</p>\n<p>应用可以模块化输出，就是说它本身可以自我消费，也可以动态分发 runtime 子模块给其他应用。</p>\n<p>理论比较抽象，我们动手试一下。</p>\n<h2 id="实践测试"><a href="#%E5%AE%9E%E8%B7%B5%E6%B5%8B%E8%AF%95" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>实践测试</h2>\n<p>现在有两个应用 app1 (localhost:3001)、app2 (localhost:3002)：</p>\n<p>\n  <a\n    class="gatsby-resp-image-link"\n    href="/static/2020-06-23-12-20-56-3e6c5578ff81f97889e7056b431a58b9-0e897.png"\n    style="display: block"\n    target="_blank"\n    rel="noopener"\n  >\n  \n  <span\n    class="gatsby-resp-image-wrapper"\n    style="position: relative; display: block; ; max-width: 578px; margin-left: auto; margin-right: auto;"\n  >\n    <span\n      class="gatsby-resp-image-background-image"\n      style="padding-bottom: 152.59515570934258%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAfCAIAAABoLHqZAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAClUlEQVQ4y5VUzW6bQBj0Y7SxUxtsfnexDSzsglkwGBuDmziHVDm1t54rtanUU++99ZAH7sROlbZSgEqfEFppmNn5ZhhcHr7Ojt/Sjz9uvjw0n34e7x+cu++vq8+Xh/tR0zEDNaz1+MotbtPrD8nVe17dWatrJajVsMGzfQa6qlDTIKbR7CsZi9HFq8nlUHkzwnOmjHV10jID3TBN0zYtOwh4Ve1XiczWxXa3r/b1fLGczjRNN16aga4blmVjPM9fr/MgCDkXq1USxytC6AxgTX9pHsG2TQzD4iIOQz4cjsbjiaKok4nSjnwCQzalJudzSE7TjLEAMJy3I5/BDrUYo1mWF8UGyjthz2DDsKljCUGlzLbbXZatYUGn5uc7U0v3PQ+0URSfyIO+YGKThW34ng9agMEchuF0Ouu89kDTDEopY1oUReDEqvEJvGBtMHx6WnQrM6FuLLmI8ryA20ByzrFqLHw+X3TemS7ljgV8t6tAm6ZpksiiKI7HG7y0XP4JTFkM8JkZeNO0kBNVnXbJ1nTIpm5wtmq5dF3Xw6oMw+w27GlVhDbNoSxLRVHgEzjB3DOeFqiQSlgtZQrD9vsaA7e63T4Vw0SrgMTT99m5Wzjv1SqQCxEDc3ExRKv+S7btOKbgDrKd5zniBRi09G0VKvm7VQUu36ePfzJbUbRI0xw5wbaRjXar/gITYoXho2ysus8P6J+fAWQ7SZLizsAD3Fc2KunoGmNhc3gbRSsoBzmi0g1GJQkhnmtivQg2RkopRHT+k/Xqs89sZHuz2ZTlFtlCmVFJgDtDoqNVfnkTiriua1QKSLiNqN7evoOQzkoS6gvXY6lM5WkcZ47DxWLZ7hxk68A6XIoo3pZbINEtpPVc5vZt/wJsQkhAWdZnAwAAAABJRU5ErkJggg==\'); background-size: cover; display: block;"\n    >\n      <img\n        class="gatsby-resp-image-image"\n        style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;"\n        alt="2020 06 23 12 20 56"\n        title=""\n        src="/static/2020-06-23-12-20-56-3e6c5578ff81f97889e7056b431a58b9-0e897.png"\n        srcset="/static/2020-06-23-12-20-56-3e6c5578ff81f97889e7056b431a58b9-d60f6.png 200w,\n/static/2020-06-23-12-20-56-3e6c5578ff81f97889e7056b431a58b9-6689e.png 400w,\n/static/2020-06-23-12-20-56-3e6c5578ff81f97889e7056b431a58b9-0e897.png 578w"\n        sizes="(max-width: 578px) 100vw, 578px"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<p>入口文件：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="97769830170840960000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// app1 & app2: index.js\nimport App from \'./App\';\nimport React from \'react\';\nimport ReactDOM from \'react-dom\';\n\nReactDOM.render(<App />, document.getElementById(\'root\'));`, `97769830170840960000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                data-tooltip="复制"\n              >\n                <svg class="gatsby-code-button-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0V0z"/><path d="M16 1H2v16h2V3h12V1zm-1 4l6 6v12H6V5h9zm-1 7h5.5L14 6.5V12z"/></svg>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// app1 &amp; app2: index.js</span>\n<span class="token keyword">import</span> App <span class="token keyword">from</span> <span class="token string">\'./App\'</span><span class="token punctuation">;</span>\n<span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">\'react\'</span><span class="token punctuation">;</span>\n<span class="token keyword">import</span> ReactDOM <span class="token keyword">from</span> <span class="token string">\'react-dom\'</span><span class="token punctuation">;</span>\n\nReactDOM<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token operator">&lt;</span>App <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">,</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">\'root\'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>app2 生产了 Button 组件：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="23807862824994517000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// app2: Button.js\nimport React from \'react\';\n\nconst Button = () => <button>App 2 Button</button>;\n\nexport default Button;`, `23807862824994517000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                data-tooltip="复制"\n              >\n                <svg class="gatsby-code-button-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0V0z"/><path d="M16 1H2v16h2V3h12V1zm-1 4l6 6v12H6V5h9zm-1 7h5.5L14 6.5V12z"/></svg>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// app2: Button.js</span>\n<span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">\'react\'</span><span class="token punctuation">;</span>\n\n<span class="token keyword">const</span> <span class="token function-variable function">Button</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token operator">&lt;</span>button<span class="token operator">></span>App <span class="token number">2</span> Button<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">></span><span class="token punctuation">;</span>\n\n<span class="token keyword">export</span> <span class="token keyword">default</span> Button<span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>app2 自身消费 Button 组件：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="43870357387870460000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// app2: App.js\nimport LocalButton from \'./Button\';\nimport React from \'react\';\n\nconst App = () => (\n  <div>\n    <h1>Basic Host-Remote</h1>\n    <h2>App 2</h2>\n    <LocalButton />\n  </div>\n);\n\nexport default App;`, `43870357387870460000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                data-tooltip="复制"\n              >\n                <svg class="gatsby-code-button-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0V0z"/><path d="M16 1H2v16h2V3h12V1zm-1 4l6 6v12H6V5h9zm-1 7h5.5L14 6.5V12z"/></svg>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// app2: App.js</span>\n<span class="token keyword">import</span> LocalButton <span class="token keyword">from</span> <span class="token string">\'./Button\'</span><span class="token punctuation">;</span>\n<span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">\'react\'</span><span class="token punctuation">;</span>\n\n<span class="token keyword">const</span> <span class="token function-variable function">App</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span>\n  <span class="token operator">&lt;</span>div<span class="token operator">></span>\n    <span class="token operator">&lt;</span>h1<span class="token operator">></span>Basic Host<span class="token operator">-</span>Remote<span class="token operator">&lt;</span><span class="token operator">/</span>h1<span class="token operator">></span>\n    <span class="token operator">&lt;</span>h2<span class="token operator">></span>App <span class="token number">2</span><span class="token operator">&lt;</span><span class="token operator">/</span>h2<span class="token operator">></span>\n    <span class="token operator">&lt;</span>LocalButton <span class="token operator">/</span><span class="token operator">></span>\n  <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>\n<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token keyword">export</span> <span class="token keyword">default</span> App<span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>app1 引用 app2 的 Button 组件：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="43806418972319030000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// app1: App.js\nimport React from \'react\';\nconst RemoteButton = React.lazy(() => import(\'app2/Button\'));\n\nconst App = () => (\n  <div>\n    <h1>Basic Host-Remote</h1>\n    <h2>App 1</h2>\n    <React.Suspense fallback=\'Loading Button\'>\n      <RemoteButton />\n    </React.Suspense>\n  </div>\n);\n\nexport default App;`, `43806418972319030000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                data-tooltip="复制"\n              >\n                <svg class="gatsby-code-button-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0V0z"/><path d="M16 1H2v16h2V3h12V1zm-1 4l6 6v12H6V5h9zm-1 7h5.5L14 6.5V12z"/></svg>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// app1: App.js</span>\n<span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">\'react\'</span><span class="token punctuation">;</span>\n<span class="token keyword">const</span> RemoteButton <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">lazy</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">\'app2/Button\'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token keyword">const</span> <span class="token function-variable function">App</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span>\n  <span class="token operator">&lt;</span>div<span class="token operator">></span>\n    <span class="token operator">&lt;</span>h1<span class="token operator">></span>Basic Host<span class="token operator">-</span>Remote<span class="token operator">&lt;</span><span class="token operator">/</span>h1<span class="token operator">></span>\n    <span class="token operator">&lt;</span>h2<span class="token operator">></span>App <span class="token number">1</span><span class="token operator">&lt;</span><span class="token operator">/</span>h2<span class="token operator">></span>\n    <span class="token operator">&lt;</span>React<span class="token punctuation">.</span>Suspense fallback<span class="token operator">=</span><span class="token string">\'Loading Button\'</span><span class="token operator">></span>\n      <span class="token operator">&lt;</span>RemoteButton <span class="token operator">/</span><span class="token operator">></span>\n    <span class="token operator">&lt;</span><span class="token operator">/</span>React<span class="token punctuation">.</span>Suspense<span class="token operator">></span>\n  <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>\n<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token keyword">export</span> <span class="token keyword">default</span> App<span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>先看生产了 Button 组件的 app2，其配置文件：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="21703012817508573000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// app2：webpack.config.js\nconst HtmlWebpackPlugin = require(\'html-webpack-plugin\');\nconst { ModuleFederationPlugin } = require(\'webpack\').container;\nconst path = require(\'path\');\n\nmodule.exports = {\n  entry: \'./src/index\',\n  mode: \'development\',\n  devServer: {\n    contentBase: path.join(__dirname, \'dist\'),\n    port: 3002\n  },\n  output: {\n    publicPath: \'http://localhost:3002/\'\n  },\n  module: {\n    rules: [\n      // ...\n    ]\n  },\n  plugins: [\n    new ModuleFederationPlugin({\n      name: \'app2Lib\',\n      library: { type: \'var\', name: \'app2Lib\' },\n      filename: \'app2-remote-entry.js\',\n      exposes: {\n        Button: \'./src/Button\'\n      },\n      shared: [\'react\', \'react-dom\']\n    }),\n    new HtmlWebpackPlugin({\n      template: \'./index.html\'\n    })\n  ]\n};`, `21703012817508573000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                data-tooltip="复制"\n              >\n                <svg class="gatsby-code-button-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0V0z"/><path d="M16 1H2v16h2V3h12V1zm-1 4l6 6v12H6V5h9zm-1 7h5.5L14 6.5V12z"/></svg>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// app2：webpack.config.js</span>\n<span class="token keyword">const</span> HtmlWebpackPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'html-webpack-plugin\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">const</span> <span class="token punctuation">{</span> ModuleFederationPlugin <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'webpack\'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>container<span class="token punctuation">;</span>\n<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'path\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\nmodule<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>\n  entry<span class="token punctuation">:</span> <span class="token string">\'./src/index\'</span><span class="token punctuation">,</span>\n  mode<span class="token punctuation">:</span> <span class="token string">\'development\'</span><span class="token punctuation">,</span>\n  devServer<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n    contentBase<span class="token punctuation">:</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">\'dist\'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n    port<span class="token punctuation">:</span> <span class="token number">3002</span>\n  <span class="token punctuation">}</span><span class="token punctuation">,</span>\n  output<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n    publicPath<span class="token punctuation">:</span> <span class="token string">\'http://localhost:3002/\'</span>\n  <span class="token punctuation">}</span><span class="token punctuation">,</span>\n  module<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n    rules<span class="token punctuation">:</span> <span class="token punctuation">[</span>\n      <span class="token comment">// ...</span>\n    <span class="token punctuation">]</span>\n  <span class="token punctuation">}</span><span class="token punctuation">,</span>\n  plugins<span class="token punctuation">:</span> <span class="token punctuation">[</span>\n    <span class="token keyword">new</span> <span class="token class-name">ModuleFederationPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n      name<span class="token punctuation">:</span> <span class="token string">\'app2Lib\'</span><span class="token punctuation">,</span>\n      library<span class="token punctuation">:</span> <span class="token punctuation">{</span> type<span class="token punctuation">:</span> <span class="token string">\'var\'</span><span class="token punctuation">,</span> name<span class="token punctuation">:</span> <span class="token string">\'app2Lib\'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>\n      filename<span class="token punctuation">:</span> <span class="token string">\'app2-remote-entry.js\'</span><span class="token punctuation">,</span>\n      exposes<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n        Button<span class="token punctuation">:</span> <span class="token string">\'./src/Button\'</span>\n      <span class="token punctuation">}</span><span class="token punctuation">,</span>\n      shared<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">\'react\'</span><span class="token punctuation">,</span> <span class="token string">\'react-dom\'</span><span class="token punctuation">]</span>\n    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n    <span class="token keyword">new</span> <span class="token class-name">HtmlWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n      template<span class="token punctuation">:</span> <span class="token string">\'./index.html\'</span>\n    <span class="token punctuation">}</span><span class="token punctuation">)</span>\n  <span class="token punctuation">]</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>这段配置描述了，需要暴露出 Button 组件、需要依赖 react、react-dom。管理 exposes 和 shared 的模块为 app2Lib，生成入口文件名为 app-remote-entry.js。</p>\n<p>app1 的配置文件：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="19679265305259320000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`const HtmlWebpackPlugin = require(\'html-webpack-plugin\');\nconst { ModuleFederationPlugin } = require(\'webpack\').container;\nconst path = require(\'path\');\n\nmodule.exports = {\n  entry: \'./src/index\',\n  mode: \'development\',\n  devServer: {\n    contentBase: path.join(__dirname, \'dist\'),\n    port: 3001\n  },\n  output: {\n    publicPath: \'http://localhost:3001/\'\n  },\n  module: {\n    rules: [\n      // ...\n    ]\n  },\n  plugins: [\n    new ModuleFederationPlugin({\n      name: \'app1\',\n      library: { type: \'var\', name: \'app1\' },\n      remotes: {\n        app2: \'app2Lib\'\n      },\n      shared: [\'react\', \'react-dom\']\n    }),\n    new HtmlWebpackPlugin({\n      template: \'./index.html\'\n    })\n  ]\n};`, `19679265305259320000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                data-tooltip="复制"\n              >\n                <svg class="gatsby-code-button-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0V0z"/><path d="M16 1H2v16h2V3h12V1zm-1 4l6 6v12H6V5h9zm-1 7h5.5L14 6.5V12z"/></svg>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">const</span> HtmlWebpackPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'html-webpack-plugin\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">const</span> <span class="token punctuation">{</span> ModuleFederationPlugin <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'webpack\'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>container<span class="token punctuation">;</span>\n<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'path\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\nmodule<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>\n  entry<span class="token punctuation">:</span> <span class="token string">\'./src/index\'</span><span class="token punctuation">,</span>\n  mode<span class="token punctuation">:</span> <span class="token string">\'development\'</span><span class="token punctuation">,</span>\n  devServer<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n    contentBase<span class="token punctuation">:</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">\'dist\'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n    port<span class="token punctuation">:</span> <span class="token number">3001</span>\n  <span class="token punctuation">}</span><span class="token punctuation">,</span>\n  output<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n    publicPath<span class="token punctuation">:</span> <span class="token string">\'http://localhost:3001/\'</span>\n  <span class="token punctuation">}</span><span class="token punctuation">,</span>\n  module<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n    rules<span class="token punctuation">:</span> <span class="token punctuation">[</span>\n      <span class="token comment">// ...</span>\n    <span class="token punctuation">]</span>\n  <span class="token punctuation">}</span><span class="token punctuation">,</span>\n  plugins<span class="token punctuation">:</span> <span class="token punctuation">[</span>\n    <span class="token keyword">new</span> <span class="token class-name">ModuleFederationPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n      name<span class="token punctuation">:</span> <span class="token string">\'app1\'</span><span class="token punctuation">,</span>\n      library<span class="token punctuation">:</span> <span class="token punctuation">{</span> type<span class="token punctuation">:</span> <span class="token string">\'var\'</span><span class="token punctuation">,</span> name<span class="token punctuation">:</span> <span class="token string">\'app1\'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>\n      remotes<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n        app2<span class="token punctuation">:</span> <span class="token string">\'app2Lib\'</span>\n      <span class="token punctuation">}</span><span class="token punctuation">,</span>\n      shared<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">\'react\'</span><span class="token punctuation">,</span> <span class="token string">\'react-dom\'</span><span class="token punctuation">]</span>\n    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n    <span class="token keyword">new</span> <span class="token class-name">HtmlWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n      template<span class="token punctuation">:</span> <span class="token string">\'./index.html\'</span>\n    <span class="token punctuation">}</span><span class="token punctuation">)</span>\n  <span class="token punctuation">]</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>这段配置描述了，使用远端模块 app2Lib，依赖 react、react-dom。</p>\n<p>最后一步：在 app1 html 中加载 app2-remote-entry.js：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="29677075959625167000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`<!-- app1: index.html -->\n<html>\n  <head>\n    <script src=&quot;http://localhost:3002/app2-remote-entry.js&quot;></script>\n  </head>\n  <body>\n    <div id=&quot;root&quot;></div>\n  </body>\n</html>`, `29677075959625167000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                data-tooltip="复制"\n              >\n                <svg class="gatsby-code-button-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0V0z"/><path d="M16 1H2v16h2V3h12V1zm-1 4l6 6v12H6V5h9zm-1 7h5.5L14 6.5V12z"/></svg>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="html"><pre style="counter-reset: linenumber NaN" class="language-html line-numbers"><code class="language-html"><span class="token comment">&lt;!-- app1: index.html --></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>http://localhost:3002/app2-remote-entry.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>root<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>运行结果：</p>\n<p>\n  <a\n    class="gatsby-resp-image-link"\n    href="/static/2020-06-23-12-24-41-059f46c6c68b482aba75065f363fec26-34bc5.png"\n    style="display: block"\n    target="_blank"\n    rel="noopener"\n  >\n  \n  <span\n    class="gatsby-resp-image-wrapper"\n    style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;"\n  >\n    <span\n      class="gatsby-resp-image-background-image"\n      style="padding-bottom: 25.555555555555554%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAIAAADKYVtkAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAA10lEQVQY012O207DMAyG+97TNHoaayuuYBzGHm3aTTuJtlmqnJzziqkACT5bsSPn959kt6sxi3K7Wq2rqqmrJsvLorxP02K9ye7SPMuK78y3dfPw+PTyvH89vB+Pb4ek79qbc/MvMc7zDZFgpAK3EGMMGF9ntM5Za7H3ISR8HIPW+H4RRgmgjdVGY1EA6geDV6Uk7pNScAELyfwXer22p5NgzBhDKZ2miRDS94MQgnMxjCNn7INQCVow/l+Ms+581gD4c6UAzVHWdpdhIN577NFQgfYhYvkE/UwHKN4O80wAAAAASUVORK5CYII=\'); background-size: cover; display: block;"\n    >\n      <img\n        class="gatsby-resp-image-image"\n        style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;"\n        alt="2020 06 23 12 24 41"\n        title=""\n        src="/static/2020-06-23-12-24-41-059f46c6c68b482aba75065f363fec26-fee1c.png"\n        srcset="/static/2020-06-23-12-24-41-059f46c6c68b482aba75065f363fec26-a67b7.png 200w,\n/static/2020-06-23-12-24-41-059f46c6c68b482aba75065f363fec26-0b187.png 400w,\n/static/2020-06-23-12-24-41-059f46c6c68b482aba75065f363fec26-fee1c.png 800w,\n/static/2020-06-23-12-24-41-059f46c6c68b482aba75065f363fec26-34bc5.png 1080w"\n        sizes="(max-width: 800px) 100vw, 800px"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<p>\n  <a\n    class="gatsby-resp-image-link"\n    href="/static/2020-06-23-12-24-46-515d435260220c409fa86d76286fc7f1-34bc5.png"\n    style="display: block"\n    target="_blank"\n    rel="noopener"\n  >\n  \n  <span\n    class="gatsby-resp-image-wrapper"\n    style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;"\n  >\n    <span\n      class="gatsby-resp-image-background-image"\n      style="padding-bottom: 21.759259259259256%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAIAAAABPYjBAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAAlklEQVQI11VPyw7DIAzj/z9zu3QwFUoKCa8ww3aZhYhxEtmY4/kYtcw5dW7oUJ2qylJTyrW23vsYo++CUyG19lXM5WzLGeNYhJTyAjOXIiB4ppSICPwGw013JMIA52y2288V8N5ba0VWN4TgQ7DOHccrRsLueUK4oLNIuMjMf4iIdW9YgJdSEBHxsMMs6y/MyIzkqyvtAwFz6G6OBs0qAAAAAElFTkSuQmCC\'); background-size: cover; display: block;"\n    >\n      <img\n        class="gatsby-resp-image-image"\n        style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;"\n        alt="2020 06 23 12 24 46"\n        title=""\n        src="/static/2020-06-23-12-24-46-515d435260220c409fa86d76286fc7f1-fee1c.png"\n        srcset="/static/2020-06-23-12-24-46-515d435260220c409fa86d76286fc7f1-a67b7.png 200w,\n/static/2020-06-23-12-24-46-515d435260220c409fa86d76286fc7f1-0b187.png 400w,\n/static/2020-06-23-12-24-46-515d435260220c409fa86d76286fc7f1-fee1c.png 800w,\n/static/2020-06-23-12-24-46-515d435260220c409fa86d76286fc7f1-34bc5.png 1080w"\n        sizes="(max-width: 800px) 100vw, 800px"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<h2 id="引用的-app2button-是如何找到的呢？"><a href="#%E5%BC%95%E7%94%A8%E7%9A%84-app2button-%E6%98%AF%E5%A6%82%E4%BD%95%E6%89%BE%E5%88%B0%E7%9A%84%E5%91%A2%EF%BC%9F" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>引用的 app2/Button 是如何找到的呢？</h2>\n<p>通过 app1 的配置文件，知道了 app2 是远端加载。在生成的 app1 main.js 描述为：</p>\n<p>\n  <a\n    class="gatsby-resp-image-link"\n    href="/static/2020-06-23-12-25-08-4b95663a0f44ee978755bcc6b533481f-34bc5.png"\n    style="display: block"\n    target="_blank"\n    rel="noopener"\n  >\n  \n  <span\n    class="gatsby-resp-image-wrapper"\n    style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;"\n  >\n    <span\n      class="gatsby-resp-image-background-image"\n      style="padding-bottom: 60.64814814814814%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAIAAADtbgqsAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABj0lEQVQoz4VQyZLbIBT0//9XDlOpLE4mninL1gpCRiAWsYlNoexU5uZp3qGroF93c1iWGcCxHm4tQGSZ+bqE6Pdczuc47Glfqez/tKQe3HzzZDYI6hvyWu2fbTgkYySaaQdJC8Zzj6+DgsDim+csaZWDfybOzsZto9V5uVQCjgJCNQKDkVdr3lx27pk4aENHigfCsJB0WQlhN8Yw53TVTGT/VFx6ObN1l/nHl8uvr/Xrt8vx5fTz5Xz63jZvndU2uFDCyTWI1RvjjPGr8lobpcNhf3xLDNN1ej/21bHt3kFXgfqtJsPoGDPaCaEZE1YZJ6UVwmkjpFXKHf5nsMoRJOG4TthwYf0jcCrIMcYU435nZfacY8rl4p+40IXqtpcQiQFwSjjndtt8zulp5ztSTKUepWahUopVCieF8c7HEO6uqTyIIaYQgw9litmHOOes0dz+7nE99KeueW1gBXAzkm5EV4iuA24m3CDcDMsABJyi1h/igs060C0IsTKcK1tab8Ukbq6QguIZvY8Pzwf+Au2LsFmLZO6aAAAAAElFTkSuQmCC\'); background-size: cover; display: block;"\n    >\n      <img\n        class="gatsby-resp-image-image"\n        style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;"\n        alt="2020 06 23 12 25 08"\n        title=""\n        src="/static/2020-06-23-12-25-08-4b95663a0f44ee978755bcc6b533481f-fee1c.png"\n        srcset="/static/2020-06-23-12-25-08-4b95663a0f44ee978755bcc6b533481f-a67b7.png 200w,\n/static/2020-06-23-12-25-08-4b95663a0f44ee978755bcc6b533481f-0b187.png 400w,\n/static/2020-06-23-12-25-08-4b95663a0f44ee978755bcc6b533481f-fee1c.png 800w,\n/static/2020-06-23-12-25-08-4b95663a0f44ee978755bcc6b533481f-34bc5.png 1080w"\n        sizes="(max-width: 800px) 100vw, 800px"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<p>看这里的 data 数组：</p>\n<p>data[1] 即 webpack/container/reference/app2，这里是返回 app2Lib 对象：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="75303705176832110000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`module.exports = app2Lib;`, `75303705176832110000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                data-tooltip="复制"\n              >\n                <svg class="gatsby-code-button-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0V0z"/><path d="M16 1H2v16h2V3h12V1zm-1 4l6 6v12H6V5h9zm-1 7h5.5L14 6.5V12z"/></svg>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> app2Lib<span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>data[0] 即 webpack/container/remote-overrides/a46c3e，这里提供了 app2 需要的 react、react-dom 依赖，并返回 app2Lib：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="80272479700586170000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`module.exports = (external) => {\n  if (external.override) {\n    external.override(\n      Object.assign(\n        {\n          react: () => {\n            return Promise.resolve().then(() => {\n              return () => __webpack_require__(/*! react */ \'./node_modules/react/index.js\');\n            });\n          },\n          \'react-dom\': () => {\n            return Promise.resolve().then(() => {\n              return () => __webpack_require__(/*! react-dom */ \'./node_modules/react-dom/index.js\');\n            });\n          }\n        },\n        __webpack_require__.O\n      )\n    );\n  }\n  return external;\n};`, `80272479700586170000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                data-tooltip="复制"\n              >\n                <svg class="gatsby-code-button-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0V0z"/><path d="M16 1H2v16h2V3h12V1zm-1 4l6 6v12H6V5h9zm-1 7h5.5L14 6.5V12z"/></svg>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js">module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">external</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n  <span class="token keyword">if</span> <span class="token punctuation">(</span>external<span class="token punctuation">.</span>override<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    external<span class="token punctuation">.</span><span class="token function">override</span><span class="token punctuation">(</span>\n      Object<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span>\n        <span class="token punctuation">{</span>\n          <span class="token function-variable function">react</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n            <span class="token keyword">return</span> Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n              <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">__webpack_require__</span><span class="token punctuation">(</span><span class="token comment">/*! react */</span> <span class="token string">\'./node_modules/react/index.js\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n          <span class="token punctuation">}</span><span class="token punctuation">,</span>\n          <span class="token string">\'react-dom\'</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n            <span class="token keyword">return</span> Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n              <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">__webpack_require__</span><span class="token punctuation">(</span><span class="token comment">/*! react-dom */</span> <span class="token string">\'./node_modules/react-dom/index.js\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n          <span class="token punctuation">}</span>\n        <span class="token punctuation">}</span><span class="token punctuation">,</span>\n        __webpack_require__<span class="token punctuation">.</span><span class="token constant">O</span>\n      <span class="token punctuation">)</span>\n    <span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n  <span class="token keyword">return</span> external<span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>所以最后 promise 的赋值变成了：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="63692974096574220000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`var promise = app2Lib.get(\'Button\');`, `63692974096574220000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                data-tooltip="复制"\n              >\n                <svg class="gatsby-code-button-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0V0z"/><path d="M16 1H2v16h2V3h12V1zm-1 4l6 6v12H6V5h9zm-1 7h5.5L14 6.5V12z"/></svg>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">var</span> promise <span class="token operator">=</span> app2Lib<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">\'Button\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>这么一看，app2Lib 是全局变量呀。</p>\n<p>继续看 app1 加载的 app2-remote-entry.js 内容。果然，生成了一个全局变量 app2Lib：</p>\n<p>\n  <a\n    class="gatsby-resp-image-link"\n    href="/static/2020-06-23-12-27-39-c7848d196ba8beb9e25f74efa9a72359-34bc5.png"\n    style="display: block"\n    target="_blank"\n    rel="noopener"\n  >\n  \n  <span\n    class="gatsby-resp-image-wrapper"\n    style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;"\n  >\n    <span\n      class="gatsby-resp-image-background-image"\n      style="padding-bottom: 40.648148148148145%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAIAAAB2/0i6AAAACXBIWXMAAA7DAAAOwwHHb6hkAAABQ0lEQVQY04VR2XLkIAz0//9dkkoyEx9rj8GAQJwGO/Ex0czT7tO2KJVKapVaoiolGw8SOQYI2WHQJoCNhgLtlXbSRQQvKUk0cNLPdj+2+xNVKUVZXrP3brq206Xhl8/hrWYfl+Htc3ilYJBtL5s/ou7Fw3N9o/6Yfci+muckQfac9dM4wuhnA24iFS6hT0ikeYnzkvIyky9rTiWSQKqmEirvXXOrudJGGMmV0tp4YufjOO7/Q+WcE8gCiggCGFNcWolOwvdSqHyS/YuTcH++83xMZvp27V8v/UvHP1r2HhPmHH5+1vN+HOf+5JOOfd+3R+PfkxEN3aCTbcO761i3U99O3RdrBjWAMwymEUiM0PQFic6uaPNlW7djiyVWaFGBSNbrUWkOTgcrwCqcY3bgUBojTTQmo/6OYU1hiaF4uwa/pPALK7jA10rqxbYAAAAASUVORK5CYII=\'); background-size: cover; display: block;"\n    >\n      <img\n        class="gatsby-resp-image-image"\n        style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;"\n        alt="2020 06 23 12 27 39"\n        title=""\n        src="/static/2020-06-23-12-27-39-c7848d196ba8beb9e25f74efa9a72359-fee1c.png"\n        srcset="/static/2020-06-23-12-27-39-c7848d196ba8beb9e25f74efa9a72359-a67b7.png 200w,\n/static/2020-06-23-12-27-39-c7848d196ba8beb9e25f74efa9a72359-0b187.png 400w,\n/static/2020-06-23-12-27-39-c7848d196ba8beb9e25f74efa9a72359-fee1c.png 800w,\n/static/2020-06-23-12-27-39-c7848d196ba8beb9e25f74efa9a72359-34bc5.png 1080w"\n        sizes="(max-width: 800px) 100vw, 800px"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<p>app2Lib 对象拥有两个方法，具体为：</p>\n<p>\n  <a\n    class="gatsby-resp-image-link"\n    href="/static/2020-06-23-12-27-48-3a44c0a2e4c4c3b01b93b59fe8661f32-34bc5.png"\n    style="display: block"\n    target="_blank"\n    rel="noopener"\n  >\n  \n  <span\n    class="gatsby-resp-image-wrapper"\n    style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;"\n  >\n    <span\n      class="gatsby-resp-image-background-image"\n      style="padding-bottom: 12.037037037037036%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAACCAIAAADXZGvcAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAAMUlEQVQI12P4+ePnuxcfXz5/+fLli8+fP//79+8/0YDh169fP77+evvm3ZcvIJ0kAQDxbnXluupwVgAAAABJRU5ErkJggg==\'); background-size: cover; display: block;"\n    >\n      <img\n        class="gatsby-resp-image-image"\n        style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;"\n        alt="2020 06 23 12 27 48"\n        title=""\n        src="/static/2020-06-23-12-27-48-3a44c0a2e4c4c3b01b93b59fe8661f32-fee1c.png"\n        srcset="/static/2020-06-23-12-27-48-3a44c0a2e4c4c3b01b93b59fe8661f32-a67b7.png 200w,\n/static/2020-06-23-12-27-48-3a44c0a2e4c4c3b01b93b59fe8661f32-0b187.png 400w,\n/static/2020-06-23-12-27-48-3a44c0a2e4c4c3b01b93b59fe8661f32-fee1c.png 800w,\n/static/2020-06-23-12-27-48-3a44c0a2e4c4c3b01b93b59fe8661f32-34bc5.png 1080w"\n        sizes="(max-width: 800px) 100vw, 800px"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="15577522554839618000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`var get = (module) => {\n  return __webpack_require__.o(moduleMap, module)\n    ? moduleMap[module]()\n    : Promise.resolve().then(() => {\n        throw new Error(\'Module &quot;\' + module + \'&quot; does not exist in container.\');\n      });\n};\n\nvar override = (override) => {\n  Object.assign(__webpack_require__.O, override);\n};`, `15577522554839618000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                data-tooltip="复制"\n              >\n                <svg class="gatsby-code-button-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0V0z"/><path d="M16 1H2v16h2V3h12V1zm-1 4l6 6v12H6V5h9zm-1 7h5.5L14 6.5V12z"/></svg>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">var</span> <span class="token function-variable function">get</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">module</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n  <span class="token keyword">return</span> __webpack_require__<span class="token punctuation">.</span><span class="token function">o</span><span class="token punctuation">(</span>moduleMap<span class="token punctuation">,</span> module<span class="token punctuation">)</span>\n    <span class="token operator">?</span> moduleMap<span class="token punctuation">[</span>module<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n    <span class="token punctuation">:</span> Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">\'Module "\'</span> <span class="token operator">+</span> module <span class="token operator">+</span> <span class="token string">\'" does not exist in container.\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n<span class="token keyword">var</span> <span class="token function-variable function">override</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">override</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n  Object<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span>__webpack_require__<span class="token punctuation">.</span><span class="token constant">O</span><span class="token punctuation">,</span> override<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>所以，app2/Button 实际就是 app2Lib.get(‘Button’)，然后根据映射找到模块，随后 <code class="language-text">__webpack_require__</code>：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="33227500963524137000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`var moduleMap = {\n  Button: () => {\n    return __webpack_require__\n      .e(\'src_Button_js\')\n      .then(() => () => __webpack_require__(/*! ./src/Button */ \'./src/Button.js\'));\n  }\n};`, `33227500963524137000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                data-tooltip="复制"\n              >\n                <svg class="gatsby-code-button-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0V0z"/><path d="M16 1H2v16h2V3h12V1zm-1 4l6 6v12H6V5h9zm-1 7h5.5L14 6.5V12z"/></svg>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">var</span> moduleMap <span class="token operator">=</span> <span class="token punctuation">{</span>\n  <span class="token function-variable function">Button</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n    <span class="token keyword">return</span> __webpack_require__\n      <span class="token punctuation">.</span><span class="token function">e</span><span class="token punctuation">(</span><span class="token string">\'src_Button_js\'</span><span class="token punctuation">)</span>\n      <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">__webpack_require__</span><span class="token punctuation">(</span><span class="token comment">/*! ./src/Button */</span> <span class="token string">\'./src/Button.js\'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>最后再说 shared: [‘react’, ‘react-dom’]：</p>\n<p>app2 中指明了需要依赖 react、react-dom，并期望消费的应用提供。如果 app1 没有提供，或没有提供指定版本，如下把代码注释：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="71311850177784210000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`plugins: [\n  new ModuleFederationPlugin({\n    name: \'app1\',\n    library: { type: \'var\', name: \'app1\' },\n    remotes: {\n      app2: \'app2Lib\'\n    }\n    // shared: [&quot;react&quot;, &quot;react-dom&quot;],\n    // 版本不一致同理\n    // shared: {\n    //   &quot;react-15&quot;: &quot;react&quot;,\n    //   &quot;react-dom&quot;: &quot;react-dom&quot;,\n    // },\n  }),\n  new HtmlWebpackPlugin({\n    template: \'./index.html\'\n  })\n];`, `71311850177784210000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                data-tooltip="复制"\n              >\n                <svg class="gatsby-code-button-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0V0z"/><path d="M16 1H2v16h2V3h12V1zm-1 4l6 6v12H6V5h9zm-1 7h5.5L14 6.5V12z"/></svg>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js">plugins<span class="token punctuation">:</span> <span class="token punctuation">[</span>\n  <span class="token keyword">new</span> <span class="token class-name">ModuleFederationPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n    name<span class="token punctuation">:</span> <span class="token string">\'app1\'</span><span class="token punctuation">,</span>\n    library<span class="token punctuation">:</span> <span class="token punctuation">{</span> type<span class="token punctuation">:</span> <span class="token string">\'var\'</span><span class="token punctuation">,</span> name<span class="token punctuation">:</span> <span class="token string">\'app1\'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>\n    remotes<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n      app2<span class="token punctuation">:</span> <span class="token string">\'app2Lib\'</span>\n    <span class="token punctuation">}</span>\n    <span class="token comment">// shared: ["react", "react-dom"],</span>\n    <span class="token comment">// 版本不一致同理</span>\n    <span class="token comment">// shared: {</span>\n    <span class="token comment">//   "react-15": "react",</span>\n    <span class="token comment">//   "react-dom": "react-dom",</span>\n    <span class="token comment">// },</span>\n  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n  <span class="token keyword">new</span> <span class="token class-name">HtmlWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n    template<span class="token punctuation">:</span> <span class="token string">\'./index.html\'</span>\n  <span class="token punctuation">}</span><span class="token punctuation">)</span>\n<span class="token punctuation">]</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>那么，刚才 app1 main.js 中的 data[0] 即 webpack/container/remote-overrides/a46c3e 会变为：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="50359602132271440000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`module.exports = (external) => {\n  if (external.override) {\n    external.override(__webpack_require__.O);\n    // external.override(Object.assign({\n    //   &quot;react&quot;: () => {\n    //     return Promise.resolve().then(() => {\n    //       return () => __webpack_require__(/*! react */ &quot;./node_modules/react/index.js&quot;)\n    //     })\n    //   },\n    //   &quot;react-dom&quot;: () => {\n    //     return Promise.resolve().then(() => {\n    //       return () => __webpack_require__(/*! react-dom */ &quot;./node_modules/react-dom/index.js&quot;)\n    //     })\n    //   }\n    // }, __webpack_require__.O))\n  }\n  return external;\n};`, `50359602132271440000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                data-tooltip="复制"\n              >\n                <svg class="gatsby-code-button-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0V0z"/><path d="M16 1H2v16h2V3h12V1zm-1 4l6 6v12H6V5h9zm-1 7h5.5L14 6.5V12z"/></svg>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js">module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">external</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n  <span class="token keyword">if</span> <span class="token punctuation">(</span>external<span class="token punctuation">.</span>override<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    external<span class="token punctuation">.</span><span class="token function">override</span><span class="token punctuation">(</span>__webpack_require__<span class="token punctuation">.</span><span class="token constant">O</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token comment">// external.override(Object.assign({</span>\n    <span class="token comment">//   "react": () => {</span>\n    <span class="token comment">//     return Promise.resolve().then(() => {</span>\n    <span class="token comment">//       return () => __webpack_require__(/*! react */ "./node_modules/react/index.js")</span>\n    <span class="token comment">//     })</span>\n    <span class="token comment">//   },</span>\n    <span class="token comment">//   "react-dom": () => {</span>\n    <span class="token comment">//     return Promise.resolve().then(() => {</span>\n    <span class="token comment">//       return () => __webpack_require__(/*! react-dom */ "./node_modules/react-dom/index.js")</span>\n    <span class="token comment">//     })</span>\n    <span class="token comment">//   }</span>\n    <span class="token comment">// }, __webpack_require__.O))</span>\n  <span class="token punctuation">}</span>\n  <span class="token keyword">return</span> external<span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>app1 则从 app2 加载 react 依赖：</p>\n<p>\n  <a\n    class="gatsby-resp-image-link"\n    href="/static/2020-06-23-12-30-00-34869dff6f594dbefff8b138d6b419b9-34bc5.png"\n    style="display: block"\n    target="_blank"\n    rel="noopener"\n  >\n  \n  <span\n    class="gatsby-resp-image-wrapper"\n    style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;"\n  >\n    <span\n      class="gatsby-resp-image-background-image"\n      style="padding-bottom: 39.907407407407405%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAIAAAB2/0i6AAAACXBIWXMAAA7DAAAOwwHHb6hkAAABL0lEQVQY032Qy3aEIAyGff+najdd9XTTRc9csKOOowgBuQgI6DROb3O66H9CyCLfT0hBKW2aZrfbE1JqrY3WjIOUcmDs0lGKF+NbcM4BhBBSKuACBADtC0IIAs45JFNKzlqlDQdVt3176fhNW++NwwMAaGOMHZUqEFuW5fqtMKOCtm6O0YdgrXV+8sFNbvLex5TjPKebQgjFD7auK+ayEQ/P7dMrPL7ww6kaBI4u3is6DGz2PseUYswp5ZzxyXt4yzjzsawHJpX2TVcLw6xyZF8rAd6qFPwS56/W6/UX/lTerGe0wrrta9BDtF5U54lDHMc0ijiKxTuMdUl/4fv/t30DhgXj6yN937fk7XQ+XmjVOSED7ngK/8FNVw2yw2LU/kCAlLTrlZ1wYWvOa4zrB3hGx7iWEIl5AAAAAElFTkSuQmCC\'); background-size: cover; display: block;"\n    >\n      <img\n        class="gatsby-resp-image-image"\n        style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;"\n        alt="2020 06 23 12 30 00"\n        title=""\n        src="/static/2020-06-23-12-30-00-34869dff6f594dbefff8b138d6b419b9-fee1c.png"\n        srcset="/static/2020-06-23-12-30-00-34869dff6f594dbefff8b138d6b419b9-a67b7.png 200w,\n/static/2020-06-23-12-30-00-34869dff6f594dbefff8b138d6b419b9-0b187.png 400w,\n/static/2020-06-23-12-30-00-34869dff6f594dbefff8b138d6b419b9-fee1c.png 800w,\n/static/2020-06-23-12-30-00-34869dff6f594dbefff8b138d6b419b9-34bc5.png 1080w"\n        sizes="(max-width: 800px) 100vw, 800px"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<p>\n  <a\n    class="gatsby-resp-image-link"\n    href="/static/2020-06-23-12-30-06-b35dcecf3d490d9cfe47c91dcf4f102b-34bc5.png"\n    style="display: block"\n    target="_blank"\n    rel="noopener"\n  >\n  \n  <span\n    class="gatsby-resp-image-wrapper"\n    style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;"\n  >\n    <span\n      class="gatsby-resp-image-background-image"\n      style="padding-bottom: 27.22222222222222%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAIAAADKYVtkAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAA20lEQVQY011Qa2uEMBD0//+t9sN5BY+DVu5Or+fbVPMgkajJmthNS1voMAzDsrMMG+V5rpSa5xkVABatpVRSyqYjTduPCEo558OIKrgQjDLGuZomqVSktXbO7T8w1sBmAczmNoBgAq0xFiyqWcEsZp0d7tg1+o15H5QQermUfcc/iHg8SFGQe96+31vSs6phWTmUrbgWQ0EmNP/DdcefDll6G9OMx0kdn+pDUj3HWXKuzld2fKMvKT+mLLlN8Sv9C3/jq+q67y5c89Y5rId/UNgZJ7sH7wLRW7N8AiH+Gfn4UHzzAAAAAElFTkSuQmCC\'); background-size: cover; display: block;"\n    >\n      <img\n        class="gatsby-resp-image-image"\n        style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;"\n        alt="2020 06 23 12 30 06"\n        title=""\n        src="/static/2020-06-23-12-30-06-b35dcecf3d490d9cfe47c91dcf4f102b-fee1c.png"\n        srcset="/static/2020-06-23-12-30-06-b35dcecf3d490d9cfe47c91dcf4f102b-a67b7.png 200w,\n/static/2020-06-23-12-30-06-b35dcecf3d490d9cfe47c91dcf4f102b-0b187.png 400w,\n/static/2020-06-23-12-30-06-b35dcecf3d490d9cfe47c91dcf4f102b-fee1c.png 800w,\n/static/2020-06-23-12-30-06-b35dcecf3d490d9cfe47c91dcf4f102b-34bc5.png 1080w"\n        sizes="(max-width: 800px) 100vw, 800px"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<p>总结，根据 app2 配置的 exposes &#x26; shared 内容，产生对应的模块文件，以及模块映射关系，通过全局变量 app2Lib 进行访问；app1 通过全局变量 get 能知道应该去如何加载 button.js，override 能知道共享依赖的模块。</p>\n<p>以上，Federation 初看很像 DLL + External，但好处是你无需手动维护、打包依赖，代码运行时加载。这种模式下，调试也变得容易，不再需要复制粘贴代码或者 npm link，只需要启动应用即可。这里仅以 Button 组件为例，Button 可以是一个组件，也可以是一个页面、一个应用。Module Federation 的落地，结合自动化流程等系列工作，还需要大家在各自场景中实践。</p>\n<h1 id="其他特性"><a href="#%E5%85%B6%E4%BB%96%E7%89%B9%E6%80%A7" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>其他特性</h1>\n<ul>\n<li>Top Level Await</li>\n<li>SplitChunks 支持更灵活的资源拆分</li>\n<li>不包含 JS 代码的 Chunk 将不再生成 JS 文件</li>\n<li>Output 默认生成 ES6 规范代码，也支持配置为 5 - 11</li>\n</ul>',
excerpt:"从 2017 年发出关于 v5 的投票开始，到 2019 年 10 月发布第一个 beta 版本，目前是 5.0.0-beta.16。现在在收集使用反馈、生态升级的过程中，相信不久后就可以正式发布了。这次升级重点：性能改进、Tree Shacking、Code…",frontmatter:{date:"2020-06-23 12:03:29",path:"/webpack-v5-new-feature/",tags:"前端, 前端构建工具, webpack",title:"Webpack5新特性",draft:null}},prePost:{html:'<h1 id="常用加速方法"><a href="#%E5%B8%B8%E7%94%A8%E5%8A%A0%E9%80%9F%E6%96%B9%E6%B3%95" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>常用加速方法</h1>\n<p>通常的 web 优化方法，基本围绕在资源加载和 html 渲染两个方面。前者针对首屏，后者针对可交互。</p>\n<p>资源优化上，我们总的方向是围绕更小的资源包上，比如常见的：压缩、减包、拆包、动态加载包及图片优化上。</p>\n<p>html 渲染上总的方向是更快的展示内容，比如通过 cdn 分发、dns 解析、http 缓存、数据预请求，数据缓存及首屏优化大杀器——直出等。</p>\n<p>这些方案是各种前端面试中必考点，也是作为一个前端开发，当遇到性能问题、需要解决性能问题时最为首要和基本的思路。而具体应该使用什么样的方案，取决于实际开发需求、优先级、综合成本、及投入产出比等。</p>\n<p>在 react-native、weex 及 flutter 等客户端的技术不断在冲击传统 hybrid 的时候，hybrid 也在一路演化、加速，朝着一个使其达到与原生相媲美的方向发展。下面归纳了 hybrid 发展中出现的一些方案，排序不分先后。</p>\n<h1 id="直出--离线包缓存"><a href="#%E7%9B%B4%E5%87%BA--%E7%A6%BB%E7%BA%BF%E5%8C%85%E7%BC%93%E5%AD%98" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>直出 + 离线包缓存</h1>\n<p>为了优化首屏，大部分主流的页面会通过服务器进行渲染，吐出 html 文件到前端，解决转菊花比较久的问题，不同类型的主流框架，都会有一套后台渲染方案，比如 vue-server-renderer、react-dom/server 等。直出省去了前端渲染，及 ajax 请求的时间，虽然直出能够通过各种缓存策略优化得很好，但加载 html 仍然需要时间。</p>\n<p>通过离线包技术能够很好解决 html 文件本身加载需要时间的问题。离线包基本思路都是通过 webview 统一拦截 url，将资源映射到本地离线包，更新的时候对版本资源检测，下载和维护本地缓存目录中的资源。比如腾讯的 webso 和 Alloykit 的离线包方案。</p>\n<p>\n  <a\n    class="gatsby-resp-image-link"\n    href="/static/2020-06-29-17-23-17-51eabfa35392c61b3d6be00ac4f5b54d-4c847.png"\n    style="display: block"\n    target="_blank"\n    rel="noopener"\n  >\n  \n  <span\n    class="gatsby-resp-image-wrapper"\n    style="position: relative; display: block; ; max-width: 618px; margin-left: auto; margin-right: auto;"\n  >\n    <span\n      class="gatsby-resp-image-background-image"\n      style="padding-bottom: 72.00647249190938%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAIAAACgpqunAAAACXBIWXMAAA7DAAAOwwHHb6hkAAACFklEQVQoz3WSa0/bMBSG8/9/xyTGJhAaKxvTNoEQrRCraGgLbVlTGnohjRPf4kvsJN5pU7p+2M6n2Hkfv6+Pj8cZERQrpd1ecUo0QVKIelm5inHKKeYZh++dzMsYk4xIKY0x9ZbWOssynCZKqS1cOUmoJalifN/DE0ImKQYSmKqqABNSZpSswt9b58r5en4tgis0bOnnTj4H2RaGhHlGGed5nsO6LEswZIwsw0DKLXxkeier9uWofYTvPuT3oNnCIOUbEpy3EZ1TKXKvE4mxkroqii9m+I7dHiyaB+ruzAzK6g0WWUbTVG+q3kJF5vOwuRz0xOJVEmfLT/mDj5+T6fIaDQ7JLyFELfY4ITklYL657TrnpQku2BClq4bst8TEWffZPJ6R3tWsd8q7cBDcGSyLsvTgDOCstTvnlpn+oI8vybwh+rdyCnDDDI5553zlH6vuqX5QWicIgd86NsN4P/aNmX4U/tfV/aH222INn5i+HwcyjG/w+L3qZJS6NGUo9niS6Ciqe1a/wIWd3KCBW6Jz0m1uYn/Pnxqs9zPuQ5Zv+Qh6jNP1wHjAQOyiKHbOkWWBjsfpIrBJpGllC+OKRNAwXrBc6GI9S9AzeDAviqJJEEC36gmrB4BT9hKGnFAlpLHrfbSKx6On18USrgkk6EHpUUoRQjvbulKMZ7MZodRYW23OA4AyWj/H3/F0/6rqrdx/qv71B3ohFtrBN1/tAAAAAElFTkSuQmCC\'); background-size: cover; display: block;"\n    >\n      <img\n        class="gatsby-resp-image-image"\n        style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;"\n        alt="2020 06 29 17 23 17"\n        title=""\n        src="/static/2020-06-29-17-23-17-51eabfa35392c61b3d6be00ac4f5b54d-4c847.png"\n        srcset="/static/2020-06-29-17-23-17-51eabfa35392c61b3d6be00ac4f5b54d-9882a.png 200w,\n/static/2020-06-29-17-23-17-51eabfa35392c61b3d6be00ac4f5b54d-ecdcc.png 400w,\n/static/2020-06-29-17-23-17-51eabfa35392c61b3d6be00ac4f5b54d-4c847.png 618w"\n        sizes="(max-width: 618px) 100vw, 618px"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<p>离线包策略在很多大厂运用比较成熟，它对 web 端而言，是相对透明，侵入性非常小。</p>\n<h1 id="客户端代理的-vassonic：webview-初始化--代理请求并行--动态缓存--增量更新"><a href="#%E5%AE%A2%E6%88%B7%E7%AB%AF%E4%BB%A3%E7%90%86%E7%9A%84-vassonic%EF%BC%9Awebview-%E5%88%9D%E5%A7%8B%E5%8C%96--%E4%BB%A3%E7%90%86%E8%AF%B7%E6%B1%82%E5%B9%B6%E8%A1%8C--%E5%8A%A8%E6%80%81%E7%BC%93%E5%AD%98--%E5%A2%9E%E9%87%8F%E6%9B%B4%E6%96%B0" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>客户端代理的 VasSonic：webview 初始化 + 代理请求并行 + 动态缓存 + 增量更新</h1>\n<p>在 hybrid h5 中，用户从点击到看见页面之间，还存在 webview 初始化，请求资源的时间，而这里的过程是串行的，对于追求更极致的体验来说，这里是有优化掉的空间和可能。</p>\n<p>VasSonic 是腾讯增值会员团队研发的一个轻量级 hybrid 框架，支持上面提到的离线包策略，更进一步的是，它还做了以下优化：</p>\n<ul>\n<li>webview 初始化和通过客户端代理资源请求并行</li>\n<li>流式拦截请求，边加载边渲染</li>\n<li>实现了动态缓存和增量更新</li>\n</ul>\n<p>简单说下它是怎么做到的，客户端代理资源请求并行没什么好说的，就是在创建 webview 之前，通过客户端代理建立网络连接，请求 html，然后缓存起来，等待 webview 线程发起 html 资源请求的时候，客户端进行拦截，将缓存好的 html 返回给 webview。</p>\n<p>动态缓存和增量更新如何做到呢？</p>\n<p>VasSonic 将 html 的内容分为 html 模板和动态数据两部分，如何区分这两种类型呢，它自己定义了一套 html 注释标记规则，通过标签划分哪些是动态数据，哪些是模板数据。然后再拓展了 http 头部，定制了一套请求后台的约定。webview 发起 http 请求时会将页面内容的 id 携带过去，后台处理判断后，再告诉客户端是否需要更新局部数据，如果是则将缓存的 html 模板与新数据拼接成新的 html，最后计算出数据差异部分，通过 js 回调给页面，进行布局刷新。</p>\n<p>\n  <a\n    class="gatsby-resp-image-link"\n    href="/static/2020-06-29-17-51-18-2450c01bd669692279470fe8f1993f76-ab538.png"\n    style="display: block"\n    target="_blank"\n    rel="noopener"\n  >\n  \n  <span\n    class="gatsby-resp-image-wrapper"\n    style="position: relative; display: block; ; max-width: 564px; margin-left: auto; margin-right: auto;"\n  >\n    <span\n      class="gatsby-resp-image-background-image"\n      style="padding-bottom: 96.80851063829786%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAATCAIAAAAf7rriAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAC/ElEQVQ4y4WT/U8ScRzH/bva+qV+abVyc1MrXdZWtGlZZrVc2lq5FBUfEDVIDZhhPk0XPj8jIAgYqHBwCQfdAccddygiJwIefU8E19T67H2fve/u897d93XfywlH41oHnZbGTqvtGQNxXWWjgDR2Ojuz6uAuYhSTSqVyICxS0GwubOF0R7hR3L5ZJLRUKeC3/XD1d/h1nwP4EtFGfmbmbpvlRp1p1BDgwl6KaR13tii3RVPIxwFraZeePwpLZpGuGQR0yaxbMocIJ51gJi3hhLN+FDY4Q1w4lanDeHJw3uLGd1Vb+JiBECjdqf8VF2ZZzvmpyIrZA8zMum/aTP4wkukJNjPBng37dzDxwnvZSr1C2/xN26jQtsjV/AFd04C+oXupqnNmSjQTkC6jX5ewnkVMMo92L2CCccTo2uXC2wHoqexKzXBB2/QzvpInmChtGOcJJsveDRW9Ulwq6RDmNdrf9Fkr5bYXMhvoL+XQ9U+GIZ2fC+/HIlbMuIUaOGFct2JARqBNVK+2Ow2ufROyq4dpHUzpYBoYDUT5aOYvYNk6Ol7c2vZ+7QiOEgyGwDjmuRDYMYtTscd4fpP7SpOf2GGYaBQc6YtngIUOxHMoICGeR3sXMbnKK132ylTewVX/yBoOThVavE/Nmd4TYGj7lMfsDnNhK7p3i2/KbTDd5BvviSwVUtuTbmuFFKqUQcBXKezPpbbyXgAMetC5ASbzmtavftAP63AuHGbiqw4qK609qLWDDvYz9dMVUkNBjYPW/QoBVOAWGNA5qBVb0EtdACxdySN2C4ugFMMmDlLJGJuInbNmAOIodSo2Q5vcS5TLYOV60ON2bWxanS7XEVdsWml+OYBuMhpORuhEOJjcoxJAYRJ4IC/mI0j6PMzZJycOCTEPb71NiB8Sn4EekT1l5JfHpIQXbMoNjdWl9/b5nwosxtdSiNZe87WX+ITFXkE+Z9qK/B333TWXyf7qVPbXOWeTsGyc9scIdwx3xnBXLICcGNx1SHjAy//jl/wDlLHAmnOZfBgAAAAASUVORK5CYII=\'); background-size: cover; display: block;"\n    >\n      <img\n        class="gatsby-resp-image-image"\n        style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;"\n        alt="2020 06 29 17 51 18"\n        title=""\n        src="/static/2020-06-29-17-51-18-2450c01bd669692279470fe8f1993f76-ab538.png"\n        srcset="/static/2020-06-29-17-51-18-2450c01bd669692279470fe8f1993f76-4fcfe.png 200w,\n/static/2020-06-29-17-51-18-2450c01bd669692279470fe8f1993f76-9c055.png 400w,\n/static/2020-06-29-17-51-18-2450c01bd669692279470fe8f1993f76-ab538.png 564w"\n        sizes="(max-width: 564px) 100vw, 564px"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<p>VasSonic 的方案整体思路和效果非常不错，特别是对于大部分 web 场景，通常我们的模板较少发生变化，大部分是数据部分变化，能够很好的通过局部刷新做到秒开效果。对于首次加载而言，通过并发请求和 webview 创建带来了不错的性能提升，还能无缝的支持离线包策略。</p>\n<p>但是 VasSonic 定义了一套特殊的注释标记及拓展了头部，需要包括后台在内的前后端进行改造，对 web 侵入性非常强，接入的工作量及维护成本会非常大。</p>\n<h1 id="pwa--直出--预加载"><a href="#pwa--%E7%9B%B4%E5%87%BA--%E9%A2%84%E5%8A%A0%E8%BD%BD" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>PWA + 直出 + 预加载</h1>\n<p>不管是离线包技术，还是 webview 代理请求，都是对前端侵入非常大的，pwa 作为 web 标准，能够通过纯 web 的方案去加速和优化加载性能。</p>\n<p>首先，pwa 能够通过 cacheStorage 缓存普通的图片、js、css 资源。另一方面，在传统的 http cache 中，我们一般不会缓存 html，这是因为页面一旦设置了过长的 max-age，在浏览器缓存过期时间内，用户看到的永远将是旧的。</p>\n<p>如果使用了 pwa 的 html 页面，能否直接缓存呢？由于 pwa 可精细化控制缓存，答案是可以的。</p>\n<p>对于直出 html，我们可以配合 pwa，将从后台直出的文件，缓存到 cacheStorage，在下一次请求时，优先从本地缓存中获取，同时发起网络请求更新本地 html 文件。</p>\n<p>但是在 hybrid 的 h5 应用，第一次启动的加载资源仍然费时，我们可以通过 app 端上支持预加载一个 javascript 脚本，拉取需要 PWA 缓存的页面，可以提前完成缓存。</p>\n<p>对于非直出的页面，我们仍然无法避免浏览器渲染 html 时间的问题，应该如何减少这里的时间呢？</p>\n<p>这里明确两个点，第一次永远只能靠提前加载，所以上面的借助端上预加载脚本仍然生效；第二点非直出页面，每个页面需要有独一无二的标记，比如 hash。浏览器获取到数据，并且渲染好的 html，能够通过 outerHTML 方法，将 html 页面缓存到 cacheStorage 中，第二次访问优先从本地获取，同时发起 html 请求，通过对比其中唯一标识的差异，决定是否需要更新。</p>\n<p>\n  <a\n    class="gatsby-resp-image-link"\n    href="/static/2020-06-29-17-50-48-14573d440c87d2dfac97b8a15e37a5ee-59d2e.png"\n    style="display: block"\n    target="_blank"\n    rel="noopener"\n  >\n  \n  <span\n    class="gatsby-resp-image-wrapper"\n    style="position: relative; display: block; ; max-width: 400px; margin-left: auto; margin-right: auto;"\n  >\n    <span\n      class="gatsby-resp-image-background-image"\n      style="padding-bottom: 167.00000000000003%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAhCAIAAABWXBxEAAAACXBIWXMAAA7DAAAOwwHHb6hkAAADtUlEQVQ4y5VVW3PaRhjl/z/lrZOn9KWJXXNNpjNxaxfHM8kYGRAEkElkEDcJoQtawaK7UI+0GJPQlPQbj7xa9nzf+c6eXeW2222SJIZhbDabMPB9l/q+v1gsPM8L/i2iKEqeIsfAS9MMwihxl8lKxet8Ptd13bKs5VFomhbH8Tdg0zQppQEqBwFqggibPww2g4yovwOzfwBgFpjpdEosa71es9WHwTj3ej3btlEcM7nDrGDV7/cx2BPbRxiGiqIQQiRJQg1VVaHRM200CTC6BQUI9h0YZTGPFIPBADDHcVarVW7fCahaWeA3PL8rDjAKsL5QFsyxPrcnDMFIFsh6DEa3oIN5kAdHjF3X3YFtYpuGiWe2QwRFkqMAZ2TEAlBju52L4jiKMY4gOMjIiszsATWjTNI9mHGBomwvUjC3Fv90OtdOrxr2L+1WafqxGvWv3d6V07uiXdNb7WnDHsgOtfUsUtpVR8gnzbxXz6+43+TqL+1SidbP7bvili+EDdW19oLNnwJZZFlOt+oDBZh/p3OSOBC6veFwOBWl+5lw5nGVsLV4AsPwUAvVsICJmqpdpUIhaZXs+1ulfSVxf4/qn+ad91qjEDbLAa951qFJmNqQc2eSm41QiPlK3C4k7ddu7eXsfSH5XNy2MFMKmppHUv8lW8YcnWOrUZbZG+AHLC3S+qXJ/zHjLjpX19bnisEVI74U8Iw2AzPlHx8fAd6p/WGT0i4v7nzXswkZjUdJlPDa1zO3tu+Zge0soDY4z2az9GDcZD1X9BqYSMMhx3EbQjuW9CYDy2s9DiM0DAsCwM45wDAp1j+Dl2SpagtZVciSNPWvZ14KHugTe2kR2xYEYTweQy2oDTA6h5dSwdKenXrJrJWM2u+z27fWfZ7UynGrlKrNBEsbRk1UVrMQRRGGy904D1AbS8+j+iuz+qKbP4/rF2GDqc1MEm9Tn0Jq8McThDHYqQ3aRavWML60zMHdpCOsJ5eLRj5slL9V+zjSnuGwtzpHV1RTVFWZU520jcGbI7V/CH5n1peG2RcevvT76kRpm09g77/B2T4XjTvRmMyoJhFFocbNvHXh18snwbdUKIZ82ecLzv3Z8uOvk78wKDqNStgue80TtFceNVwb59YKqLaxxppMQorX9M+1gyhMfhy5wxdcY4+iuLfxydiBcTiNLOA7GFg3jPgn8M/3NpDwID4I7FrH6f9ZMHwPr45Go263ixOHu+J/gFEZNxOe7HKGhw8/pSd6Rgo//UKmpsWAWfdk/ANK7jnbOpVfPgAAAABJRU5ErkJggg==\'); background-size: cover; display: block;"\n    >\n      <img\n        class="gatsby-resp-image-image"\n        style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;"\n        alt="2020 06 29 17 50 48"\n        title=""\n        src="/static/2020-06-29-17-50-48-14573d440c87d2dfac97b8a15e37a5ee-59d2e.png"\n        srcset="/static/2020-06-29-17-50-48-14573d440c87d2dfac97b8a15e37a5ee-01f55.png 200w,\n/static/2020-06-29-17-50-48-14573d440c87d2dfac97b8a15e37a5ee-59d2e.png 400w"\n        sizes="(max-width: 400px) 100vw, 400px"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<p>pwa 一系列方案替代离线包策略，带来的好处是，属于 web 标准，适用于普通能够支持 service-worker 的 H5 页面。在允许兼容问题允许的情况下，建议主加。</p>\n<h1 id="nsr-渲染：js-runtime--预渲染--memorycache"><a href="#nsr-%E6%B8%B2%E6%9F%93%EF%BC%9Ajs-runtime--%E9%A2%84%E6%B8%B2%E6%9F%93--memorycache" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>NSR 渲染：JS-Runtime + 预渲染 + MemoryCache</h1>\n<p>GMTC 2019 全球大前端技术上 UC 团队提到了 0.3 秒的 “闪开” 方案。NSR 就是前端版本的 SSR，非常具有启发性。</p>\n<p>其核心思路是，借助浏览器启用一个 JS-Runtime，提前将下载好的 html 模板及预取的 feed 流数据进行渲染，然后将 html 设置到内存级别的 MemoryCache 中，从而达到点开即看的效果。</p>\n<p>NSR 将 SSR 渲染的过程分发到了各个用户的端中，在减少了后台请求压力的同时，也加进一步快了页面打开速度，堪称做到极致。</p>\n<p>问题是数据预取和预渲染带来额外的流量和性能开销，特别是流量，如何更准确的预测用户行为，提高命中率是非常重要的事。类似 NSR 的方案我们也在逐步探索中。</p>\n<h1 id="客户端-pwa"><a href="#%E5%AE%A2%E6%88%B7%E7%AB%AF-pwa" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>客户端 PWA</h1>\n<p>在实际测试以及和浏览器团队的同学了解和沟通中，service-worker 在 webview 实现性能并没有想象中好。在某项目下掉 sw 后，整体大盘访问速度整体反而提升上升了大概 300ms。这对 hybrid 应用而言，就提出了一项新的思路和挑战，能否在客户端上实现一套基本的 service-worker api？从而达到和 web 标准相兼容。这里也只是一种思路和想法，有大量待探索的问题点，比如 webview sw 具体的性能现状，未来的支持情况呢，自行实现的成本，及最终带来的效果和价值等。</p>\n<h1 id="小程序化"><a href="#%E5%B0%8F%E7%A8%8B%E5%BA%8F%E5%8C%96" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>小程序化</h1>\n<p>小程序生态已经非常成熟了，各大厂也都已经推出了自己平台的小程序，国内厂商也不断在尝试推进 MiniApp w3c 标准。不管从加载速度还是页面流畅度小程序都要高于 H5 页面，其原因是通过在架构上对开发进行规范化和约束化，小程序内部将 webview 渲染和 js 执行分离开来，然后通过离线包，页面拆分，预加载页面等一系列优化手段，让小程序天然具备了大量的 H5 优化后的效果，其代价是牺牲了 web 的灵活性。但对于 hybrid 开发，通过原生客户端底层支持这种小程序环境，然后大量业务逻辑采用小程序方案开发，来达到迭代速度与性能兼并的效果，是一种非常不错的方向。</p>\n<h1 id="小结"><a href="#%E5%B0%8F%E7%BB%93" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>小结</h1>\n<p>不管哪种类型的方案，发现其总的思路和方向都是：</p>\n<ul>\n<li>在整个链路中减少中间环节。比如将串行改并行，包括小程序内部执行机制。</li>\n<li>尽可能的预加载、预执行。比如从数据预取，到页面预取渲染等。</li>\n</ul>\n<p>任何转换都有代价，加速本质上就是在用更多的网络、内存和 CPU 换取速度，以空间换时间。</p>\n<h1 id="以上传统方案的不足"><a href="#%E4%BB%A5%E4%B8%8A%E4%BC%A0%E7%BB%9F%E6%96%B9%E6%A1%88%E7%9A%84%E4%B8%8D%E8%B6%B3" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>以上“传统”方案的不足</h1>\n<p>在大部分场景中，这些方案都足够用，也能得到出色的效果，但仍有无法尽善尽美的地方：</p>\n<ul>\n<li>短暂的白屏现象不可避免</li>\n<li>对于超大型 web 应用难以做到秒开</li>\n</ul>\n<p>结合客户端特性，我们有没有办法，进一步做到极致，打开 web 页面和打开客户端页面无差异的体验呢？</p>\n<p>无论是 html 离线，还是直出，以及让 webview 启动和网络请求并行，页面的切换和打开都无法避免 html 加载这一过程。对于大型应用而言，庞大的 js 初始化解析和执行会耗费巨大的时间。</p>\n<p>\n  <a\n    class="gatsby-resp-image-link"\n    href="/static/2020-06-30-01-23-56-4f96ef96ab97cccd1833661daa570bf0-3c94e.png"\n    style="display: block"\n    target="_blank"\n    rel="noopener"\n  >\n  \n  <span\n    class="gatsby-resp-image-wrapper"\n    style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;"\n  >\n    <span\n      class="gatsby-resp-image-background-image"\n      style="padding-bottom: 64.10635155096011%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAIAAAAmMtkJAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABT0lEQVQoz21S25aDIAzs///l7r5oFRUVIRdwB9CudpuTckqSIZmJj/20eJqq7ndDcNs2771z7pp94JdSwrksS9d1xphpmlB9BTMzUsMwPJ9PvPIBvK5r1/e9MfM8/web3ozjiLzf/AWcIpK7CDln0bdtw7LUSBKRCGdWdt59/3zZxZIQgoho1AcqUqHBRNM4tk1DIaTSWSmwUP6jCrZmMKCGKeqwrAQw11IkwAqnPcdWDqJcxiZwwcwogGx1ZkxUOpdSay30ADFUVHC8gEGoaZqrYAd4L4LBiAhPvCSMdIDrFfirkLfOYIWeWAlkP8BCGiXXiWBsvIsthhA+gCurLExZNZ6wg5nsiEhbbCj2NvYhGKpBeC6CaYxozcFXtaFwTs0zzvfOZavZIxGWmiNw1Rg8adC8aiyWSPLm6to5MlL5C8uCVX/Z3/WWS9mPCK6/Piv3XDalKqwAAAAASUVORK5CYII=\'); background-size: cover; display: block;"\n    >\n      <img\n        class="gatsby-resp-image-image"\n        style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;"\n        alt="2020 06 30 01 23 56"\n        title=""\n        src="/static/2020-06-30-01-23-56-4f96ef96ab97cccd1833661daa570bf0-fee1c.png"\n        srcset="/static/2020-06-30-01-23-56-4f96ef96ab97cccd1833661daa570bf0-a67b7.png 200w,\n/static/2020-06-30-01-23-56-4f96ef96ab97cccd1833661daa570bf0-0b187.png 400w,\n/static/2020-06-30-01-23-56-4f96ef96ab97cccd1833661daa570bf0-fee1c.png 800w,\n/static/2020-06-30-01-23-56-4f96ef96ab97cccd1833661daa570bf0-b1a91.png 1200w,\n/static/2020-06-30-01-23-56-4f96ef96ab97cccd1833661daa570bf0-3c94e.png 1354w"\n        sizes="(max-width: 800px) 100vw, 800px"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<p>速度优化的本质是以空间换时间。我们是否可以从这个思路，将打开 webview 及解析 html 这以过程省略掉呢？答案是可以的。</p>\n<p>\n  <a\n    class="gatsby-resp-image-link"\n    href="/static/2020-06-30-01-25-58-d806f7b3a236b032ea57f7ad9a601ab5-52f0e.png"\n    style="display: block"\n    target="_blank"\n    rel="noopener"\n  >\n  \n  <span\n    class="gatsby-resp-image-wrapper"\n    style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;"\n  >\n    <span\n      class="gatsby-resp-image-background-image"\n      style="padding-bottom: 64.26470588235293%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAIAAAAmMtkJAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABeUlEQVQoz21SS47CMAztabgG50DiJlyBOQI7DsAsOAoSO5alFU3aNKX5OMm8JJ1Cmams6NXxsx0/F+H3894TkbXWOReWX76CHyfw7C9m1Pc957zrOiHEB1lr3TQNbhljwP+RpeRt27UtyB/FlVKc8bquwdfqnYw2UuhTyjYlH6SMHph3Hha8sQYZ79Vd9ALYxwtc+SJYG4wJeI0xgrG6LB0ag9MSqachZZ0lZ5GM8QYnsI1mNKlI9qnyMAwt2hZCSpnbJq0QOjcpe/kaYfCWTOGRhQj/X/v9+Xy+XC673S5HvJPRJHoGZ0GeKzePx3q9Xq1W1+t1kmdZ+V2Fz8oou91uN5vN4XBI5ODMRMZAwIRaOCkFI/VEzpW/T6fb7QZVjscjpt73smUP3kVQlmUnuqqqolRJ54kcB+tdTo8NwczyGuFxVo+WYuVRjXlJcP4hwyhKgCX0SbOss9MKEZA0GjSKIEW4GK1JpyXBM5JzASI/x8VQeuHJg1w/O4rqQNNvxWQAAAAASUVORK5CYII=\'); background-size: cover; display: block;"\n    >\n      <img\n        class="gatsby-resp-image-image"\n        style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;"\n        alt="2020 06 30 01 25 58"\n        title=""\n        src="/static/2020-06-30-01-25-58-d806f7b3a236b032ea57f7ad9a601ab5-fee1c.png"\n        srcset="/static/2020-06-30-01-25-58-d806f7b3a236b032ea57f7ad9a601ab5-a67b7.png 200w,\n/static/2020-06-30-01-25-58-d806f7b3a236b032ea57f7ad9a601ab5-0b187.png 400w,\n/static/2020-06-30-01-25-58-d806f7b3a236b032ea57f7ad9a601ab5-fee1c.png 800w,\n/static/2020-06-30-01-25-58-d806f7b3a236b032ea57f7ad9a601ab5-b1a91.png 1200w,\n/static/2020-06-30-01-25-58-d806f7b3a236b032ea57f7ad9a601ab5-52f0e.png 1360w"\n        sizes="(max-width: 800px) 100vw, 800px"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<h1 id="容器化方案：webview-常驻--数据替换"><a href="#%E5%AE%B9%E5%99%A8%E5%8C%96%E6%96%B9%E6%A1%88%EF%BC%9Awebview-%E5%B8%B8%E9%A9%BB--%E6%95%B0%E6%8D%AE%E6%9B%BF%E6%8D%A2" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>容器化方案：webview 常驻 + 数据替换</h1>\n<p>容器化即是我们最终探索与实践的出来的一套方案。正常 web 页面关闭后，webview 组件即会销毁掉，下一次再打开需要重新启动。通常让 webview 保持常驻的做法可以节省 webview 启动时间， 但简单的常驻 webview 并不能做到页面秒开，页面打开仍然需要重新解析 html。</p>\n<p>对于我们的应用特征而言，页面切换实际上是仅仅内容数据的变化，比如切换一篇文档，其 html 容器及样式都是同一套，而差异仅仅只是在数据上，重新载入 html 及初始化 js 这部分耗时完全可以避免掉。让 webview 组件及其容器内的 html 页面常驻，在文档切换的过程，仅仅对数据进行替换，这即是容器化方案。容器化方案省去了 webview 重复启动和渲染 html 的问题，打开文档，耗时只在做数据替换，真正做到了秒开。</p>\n<p>\n  <a\n    class="gatsby-resp-image-link"\n    href="/static/2020-06-30-01-28-15-cdd9f32452bf072ee33adb4768ff3d07-b6993.png"\n    style="display: block"\n    target="_blank"\n    rel="noopener"\n  >\n  \n  <span\n    class="gatsby-resp-image-wrapper"\n    style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;"\n  >\n    <span\n      class="gatsby-resp-image-background-image"\n      style="padding-bottom: 62.23684210526316%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAIAAADtbgqsAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABnElEQVQoz6WRXVfiMBCG+f8/wLMeb1y91N/gcbcotKUURAWW8tVPaqAtSZNUoMkOKYheuDeb5CIz7zzzTk5qK+qO0vsJfhigOyfVxpnmZPW8SKWUGYuc9PcUPw5X93DG6/pw9est9WjOkiQpy7I2J+YjOjPQpZ1dm+jSXP5sLC+WdA5wkPcayx8gWcmVlVy30FUDnUekL4XcbDdQUPNZexA9BH5Uiq2QJaS8Ql+QEVSEtPsHaVEQv28LIXcgTVJ9itq7jaQ0F0LUXGKG+bNUi3NO1my6ao38buDGk9ge+Po732NCqL7E8rMngDHBh7EX7PUAFwBTBzVd1N8Wchy3h2Fztx/wAAfMDsneScCGsT9giKuUVxgxHSkfO+C2ksrqRf+CpUq5TI9zR8GdgNrHvt/CL1V7qSpOMO5A9dF5p+D2F9glrQXrfx7bZ1YF+6QTsu5X505IXk7wFOtP2a3H9RnTZqw+Z43e+iYm48q5t751eVNJGlwgDPHrCU55NCNNLzfd3DgeixYYNMzRnBif8gb8KykS9TMKlv+x/gLPPpzMUUO+GgAAAABJRU5ErkJggg==\'); background-size: cover; display: block;"\n    >\n      <img\n        class="gatsby-resp-image-image"\n        style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;"\n        alt="2020 06 30 01 28 15"\n        title=""\n        src="/static/2020-06-30-01-28-15-cdd9f32452bf072ee33adb4768ff3d07-fee1c.png"\n        srcset="/static/2020-06-30-01-28-15-cdd9f32452bf072ee33adb4768ff3d07-a67b7.png 200w,\n/static/2020-06-30-01-28-15-cdd9f32452bf072ee33adb4768ff3d07-0b187.png 400w,\n/static/2020-06-30-01-28-15-cdd9f32452bf072ee33adb4768ff3d07-fee1c.png 800w,\n/static/2020-06-30-01-28-15-cdd9f32452bf072ee33adb4768ff3d07-b1a91.png 1200w,\n/static/2020-06-30-01-28-15-cdd9f32452bf072ee33adb4768ff3d07-b6993.png 1520w"\n        sizes="(max-width: 800px) 100vw, 800px"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<h2 id="容器切换"><a href="#%E5%AE%B9%E5%99%A8%E5%88%87%E6%8D%A2" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>容器切换</h2>\n<p>web 侧如何感知到不同的页面在进行互切换，数据如何做到替换呢？</p>\n<p>首先在 app 打开的时候，文档列表会进行数据预拉取，同时触发客户端预启动容器，除此外，其他任意场景也能按需触发容器启动（后面会聊到）。容器内会提前进行 html 渲染和 js 执行，此时的数据是空的。用户点击文档，客户端会对打开 url 这一行为进行监听，同时解析 url，取出唯一标识符，判断本地是否已经存在并且符合要求的数据，如果条件命中，直接使用已经打开的容器切出，通知到容器内的 web，web 收到通知，通过 url 取出标识符，从本地进行数据获取，然后对数据进行替换渲染，从而完成页面切换。</p>\n<p>\n  <a\n    class="gatsby-resp-image-link"\n    href="/static/2020-06-30-01-32-34-1dbe915a8cd37c5db5398d2d7a0a39dd-cae7f.png"\n    style="display: block"\n    target="_blank"\n    rel="noopener"\n  >\n  \n  <span\n    class="gatsby-resp-image-wrapper"\n    style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;"\n  >\n    <span\n      class="gatsby-resp-image-background-image"\n      style="padding-bottom: 98.306389530408%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAIAAAAC64paAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABc0lEQVQ4y5WU63KCQAxGef+XZJxxUBEvKMode+TgFltb2/xgkmy+5Es2S3Q6nfb7/W63S9MUJc9zvk3TnM/nw+FwfAj6drs9Pkt0vV77vgdZ1/VtFJSqqvB3XdfPZBiGoHNEgagsSwwSQwFbL2D9wze5PYTTOxgX1eSfJAl8XlbW7EYx+5325XKxW/AgUYqioGdMvvWztG0LOB8lIm6z2Tiw9XpNLiLMWIxiWTCyQ4FzO8rU820m9OzMVCC1XC6tiZO+UJpR7mBohEkKtiWLrFYrekExDD8Bkv8Eh2EGsBPyhp2T/K38HqxJ8cViQRYC7MVcv4GlDWfm53USaefvwUaAZMgS5uup5nvagLlCFIfqbaP/CYzOFnj6bzCV2R/33C7k/yOY3O48Jgpzdlp4yKt/GtiXDQtPcv4ezMiqxXEMEVlExHEZWZaxCbIIi+0Ozt8WAZxab6JNSkZCtE36Bl6+Z2fuY57A2OG5zAf28mcQhEofD0GPNMq9IbMAAAAASUVORK5CYII=\'); background-size: cover; display: block;"\n    >\n      <img\n        class="gatsby-resp-image-image"\n        style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;"\n        alt="2020 06 30 01 32 34"\n        title=""\n        src="/static/2020-06-30-01-32-34-1dbe915a8cd37c5db5398d2d7a0a39dd-fee1c.png"\n        srcset="/static/2020-06-30-01-32-34-1dbe915a8cd37c5db5398d2d7a0a39dd-a67b7.png 200w,\n/static/2020-06-30-01-32-34-1dbe915a8cd37c5db5398d2d7a0a39dd-0b187.png 400w,\n/static/2020-06-30-01-32-34-1dbe915a8cd37c5db5398d2d7a0a39dd-fee1c.png 800w,\n/static/2020-06-30-01-32-34-1dbe915a8cd37c5db5398d2d7a0a39dd-b1a91.png 1200w,\n/static/2020-06-30-01-32-34-1dbe915a8cd37c5db5398d2d7a0a39dd-cae7f.png 1299w"\n        sizes="(max-width: 800px) 100vw, 800px"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<h2 id="容器化数据替换"><a href="#%E5%AE%B9%E5%99%A8%E5%8C%96%E6%95%B0%E6%8D%AE%E6%9B%BF%E6%8D%A2" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>容器化数据替换</h2>\n<p>直接容器替换的思路省去了代码加载和解析时间，但对于前端代码而言，需要支持直接替换数据。大部分前端项目代码设计都是自执行调用方式，支持容器化的前提是：需要对代码改造成可支持数据组装和销毁。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="48745615640876920000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 大部分应用加载页面初始化的场景\nclass App {\n    public init() {\n     initA();\n     initB();\n     // 初始化各种模块\n    }\n}\n\nconst app = new App();\napp.init();`, `48745615640876920000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                data-tooltip="复制"\n              >\n                <svg class="gatsby-code-button-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0V0z"/><path d="M16 1H2v16h2V3h12V1zm-1 4l6 6v12H6V5h9zm-1 7h5.5L14 6.5V12z"/></svg>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// 大部分应用加载页面初始化的场景</span>\n<span class="token keyword">class</span> <span class="token class-name">App</span> <span class="token punctuation">{</span>\n    <span class="token keyword">public</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n     <span class="token function">initA</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n     <span class="token function">initB</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n     <span class="token comment">// 初始化各种模块</span>\n    <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">App</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\napp<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>自执行调用后，大量的内部依赖模块也依次进行初始化，然后数据常驻在内存中，通常对于加载一个正常网页而言，用户每次都是新开页面，加载 html，重新进行解析和初始化，并不会带来什么问题。</p>\n<p>但是按照容器化思路，页面不会重新载入，只进行数据替代，对于大型应用而言意味着成千上万的模块需要支持内存释放和数据切换，一旦没有处理好，会面临严重的内存泄露和代码健壮性问题。如何组织和管理这些代码，支持可插拔式，让整个页面初始化流程都能链式组装，可以进行配置，是进行容器化代码改造的难点。</p>\n<h3 id="依赖倒置"><a href="#%E4%BE%9D%E8%B5%96%E5%80%92%E7%BD%AE" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>依赖倒置</h3>\n<p>依赖倒置原则的是指内部模块不应该依赖外部模块，底层模块不应该依赖上层模块。</p>\n<p>哪些才是底层模块，哪些才是上层模块呢？通常而言，越稳定不变逻辑，应该是越底层，越接近用户交互，容易变化的部分是上层。具体层级划分需要分析应用的结构和依赖关系，良好划分层级的应用是容器化改造的前提。</p>\n<h3 id="职责链模式"><a href="#%E8%81%8C%E8%B4%A3%E9%93%BE%E6%A8%A1%E5%BC%8F" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>职责链模式</h3>\n<p>职责链模式是指每个对象都有接受请求的可能，这些对象连接成一条链，请求沿着这条链的传递，直到有对象处理，这样做的好处是减少接受者和发送者直接的耦合。</p>\n<p>比如在一个页面加载生命周期中，我们可以让内部模块到外部模块都实现相应的生命周期职责，应用启动和销毁的过程，请求沿着指定链条从外到内传递，也可以按需指定跳跃某个模块，这样大大降低了模块之间的耦合，从而更好的管理代码。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="61275947301472720000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`export default interface IRestart{\n    emitter: EventEmitter;\n    startDestroy(): void;\n    destroy(): void;\n    restart(): void;\n    restartEnd(): void;\n    // ...\n}`, `61275947301472720000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                data-tooltip="复制"\n              >\n                <svg class="gatsby-code-button-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0V0z"/><path d="M16 1H2v16h2V3h12V1zm-1 4l6 6v12H6V5h9zm-1 7h5.5L14 6.5V12z"/></svg>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">interface</span> <span class="token class-name">IRestart</span><span class="token punctuation">{</span>\n    emitter<span class="token punctuation">:</span> EventEmitter<span class="token punctuation">;</span>\n    <span class="token function">startDestroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword">void</span><span class="token punctuation">;</span>\n    <span class="token function">destroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword">void</span><span class="token punctuation">;</span>\n    <span class="token function">restart</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword">void</span><span class="token punctuation">;</span>\n    <span class="token function">restartEnd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword">void</span><span class="token punctuation">;</span>\n    <span class="token comment">// ...</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="32323083408655860000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`class Page {\n  next: PageFlow | null;\n  cache: {\n    start: (() => Promise<any>)[],\n    end: (() => Promise<any>)[]\n  };\n  waitStart(callback: () => Promise<any>) {\n    this.cache.start.push(callback);\n  }\n  waitEnd(callback: () => Promise<any>) {\n    this.cache.end.push(callback);\n  }\n  setNext(flow: PageFlow) {\n    this.next = flow;\n    return flow;\n  }\n  // ...\n}`, `32323083408655860000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                data-tooltip="复制"\n              >\n                <svg class="gatsby-code-button-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0V0z"/><path d="M16 1H2v16h2V3h12V1zm-1 4l6 6v12H6V5h9zm-1 7h5.5L14 6.5V12z"/></svg>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">class</span> <span class="token class-name">Page</span> <span class="token punctuation">{</span>\n  next<span class="token punctuation">:</span> PageFlow <span class="token operator">|</span> <span class="token keyword">null</span><span class="token punctuation">;</span>\n  cache<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n    start<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> Promise<span class="token operator">&lt;</span>any<span class="token operator">></span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>\n    end<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> Promise<span class="token operator">&lt;</span>any<span class="token operator">></span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">]</span>\n  <span class="token punctuation">}</span><span class="token punctuation">;</span>\n  <span class="token function">waitStart</span><span class="token punctuation">(</span><span class="token function-variable function">callback</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> Promise<span class="token operator">&lt;</span>any<span class="token operator">></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">this</span><span class="token punctuation">.</span>cache<span class="token punctuation">.</span>start<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>callback<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n  <span class="token function">waitEnd</span><span class="token punctuation">(</span><span class="token function-variable function">callback</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> Promise<span class="token operator">&lt;</span>any<span class="token operator">></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">this</span><span class="token punctuation">.</span>cache<span class="token punctuation">.</span>end<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>callback<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n  <span class="token function">setNext</span><span class="token punctuation">(</span><span class="token parameter">flow<span class="token punctuation">:</span> PageFlow</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">this</span><span class="token punctuation">.</span>next <span class="token operator">=</span> flow<span class="token punctuation">;</span>\n    <span class="token keyword">return</span> flow<span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n  <span class="token comment">// ...</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="依赖注入"><a href="#%E4%BE%9D%E8%B5%96%E6%B3%A8%E5%85%A5" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>依赖注入</h3>\n<p>所谓依赖注入是当指 A 对象依赖另一个 B 对象时，不直接在 A 对象内初始化 B，而是通过外部环境进行初始化，作为参数传入 A 对象中。</p>\n<p>这样做的好处是当 B 模块的初始化等条件发生变化时，不必在 A 对象中进行重复的修改。管理成百上千个这样模块相互依赖的代码中，统一的依赖注入管理器会让依赖关系管理变得更方便。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="99387017000822640000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 模块加载器\nclass ServiceLoader {\n  source: CONFIG;\n  loaded: boolean; // 是否已加载\n  initialized: boolean; // 是否已初始\n  module: any;\n  constructor(source: CONFIG) {\n    this.loaded = false;\n    this.initialized = false;\n    // ...\n  }\n  async load(params?: any): Promise<any> {\n    // ..load module\n    return this.module;\n  }\n  //...\n}`, `99387017000822640000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                data-tooltip="复制"\n              >\n                <svg class="gatsby-code-button-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0V0z"/><path d="M16 1H2v16h2V3h12V1zm-1 4l6 6v12H6V5h9zm-1 7h5.5L14 6.5V12z"/></svg>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// 模块加载器</span>\n<span class="token keyword">class</span> <span class="token class-name">ServiceLoader</span> <span class="token punctuation">{</span>\n  source<span class="token punctuation">:</span> <span class="token constant">CONFIG</span><span class="token punctuation">;</span>\n  loaded<span class="token punctuation">:</span> boolean<span class="token punctuation">;</span> <span class="token comment">// 是否已加载</span>\n  initialized<span class="token punctuation">:</span> boolean<span class="token punctuation">;</span> <span class="token comment">// 是否已初始</span>\n  module<span class="token punctuation">:</span> any<span class="token punctuation">;</span>\n  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">source<span class="token punctuation">:</span> <span class="token constant">CONFIG</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">this</span><span class="token punctuation">.</span>loaded <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>\n    <span class="token keyword">this</span><span class="token punctuation">.</span>initialized <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>\n    <span class="token comment">// ...</span>\n  <span class="token punctuation">}</span>\n  <span class="token keyword">async</span> <span class="token function">load</span><span class="token punctuation">(</span>params<span class="token operator">?</span><span class="token punctuation">:</span> any<span class="token punctuation">)</span><span class="token punctuation">:</span> Promise<span class="token operator">&lt;</span>any<span class="token operator">></span> <span class="token punctuation">{</span>\n    <span class="token comment">// ..load module</span>\n    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>module<span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n  <span class="token comment">//...</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="46989097172418410000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 模块管理器\nclass ServiceCollection {\n    stack: ServiceLoader[];\n    private services = new Map<CONFIG, ServiceLoader>();\n    constructor() {\n        this.stack = [];\n    }\n    createLoader(config: CONFIG): ServiceLoader {\n        const loader: ServiceLoader =  new ServiceLoader(config);\n        this.services.set(config, loader);\n        return loader;\n    }\n    // ...\n}`, `46989097172418410000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                data-tooltip="复制"\n              >\n                <svg class="gatsby-code-button-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0V0z"/><path d="M16 1H2v16h2V3h12V1zm-1 4l6 6v12H6V5h9zm-1 7h5.5L14 6.5V12z"/></svg>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// 模块管理器</span>\n<span class="token keyword">class</span> <span class="token class-name">ServiceCollection</span> <span class="token punctuation">{</span>\n    stack<span class="token punctuation">:</span> ServiceLoader<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n    <span class="token keyword">private</span> services <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Map</span><span class="token operator">&lt;</span><span class="token constant">CONFIG</span><span class="token punctuation">,</span> ServiceLoader<span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        <span class="token keyword">this</span><span class="token punctuation">.</span>stack <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n    <span class="token function">createLoader</span><span class="token punctuation">(</span>config<span class="token punctuation">:</span> <span class="token constant">CONFIG</span><span class="token punctuation">)</span><span class="token punctuation">:</span> ServiceLoader <span class="token punctuation">{</span>\n        <span class="token keyword">const</span> loader<span class="token punctuation">:</span> ServiceLoader <span class="token operator">=</span>  <span class="token keyword">new</span> <span class="token class-name">ServiceLoader</span><span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token keyword">this</span><span class="token punctuation">.</span>services<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>config<span class="token punctuation">,</span> loader<span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token keyword">return</span> loader<span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n    <span class="token comment">// ...</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="39930594599819180000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`initA () {\n    const ALoader= this.serviceCollection.createLoader(CONFIG.A);\n    const discussMobile = ALoader.init(this.app);\n}`, `39930594599819180000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                data-tooltip="复制"\n              >\n                <svg class="gatsby-code-button-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0V0z"/><path d="M16 1H2v16h2V3h12V1zm-1 4l6 6v12H6V5h9zm-1 7h5.5L14 6.5V12z"/></svg>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token function">initA</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">const</span> ALoader<span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>serviceCollection<span class="token punctuation">.</span><span class="token function">createLoader</span><span class="token punctuation">(</span><span class="token constant">CONFIG</span><span class="token punctuation">.</span><span class="token constant">A</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">const</span> discussMobile <span class="token operator">=</span> ALoader<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>app<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<h1 id="数据预拉服务"><a href="#%E6%95%B0%E6%8D%AE%E9%A2%84%E6%8B%89%E6%9C%8D%E5%8A%A1" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>数据预拉服务</h1>\n<p>容器是否会命中依赖两个条件，其一对应离线包代码是否下载好；其二对应版本的数据是否已经预拉缓存完毕。</p>\n<p>用户进入文档管理首页，首先会去拉取列表索引数据，然后通过列表数据 id 进行文档内容数据做预拉，储存在本地数据库。</p>\n<h2 id="webview-service"><a href="#webview-service" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>webview service</h2>\n<p>在整个数据预拉的过程，我们是通过一套独立的客户端后台 webview 服务执行具体任务，独立服务的好处是让各种容器化基础服务和文档管理列表本身进行解耦，同时将拉取、解析、储存数据这一对性能有消耗的过程放后台服务，减少了列表用户交互界面层的性能压力。</p>\n<p>另一方面，作为多端公用的一个服务，构建流程上单独部署，更新代码的时候能够不依赖其他页面，变得更灵活。</p>\n<p>\n  <a\n    class="gatsby-resp-image-link"\n    href="/static/2020-06-30-01-47-10-7852bb852291ce9543e97e6028b63e02-6a871.png"\n    style="display: block"\n    target="_blank"\n    rel="noopener"\n  >\n  \n  <span\n    class="gatsby-resp-image-wrapper"\n    style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;"\n  >\n    <span\n      class="gatsby-resp-image-background-image"\n      style="padding-bottom: 55.893536121673%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAA70lEQVQoz6WS2w5DQBRF5/+/kJQgxK0uVXdFu8xJpZHUi/0gZrL32WsG9b4gNc/z66tlWc7dmB9aZVlO06TSNJVFlmVVVeFY1/VfGFuSJJZlBUHQtq0i2fd9HMdPrUMYHEEDahiGoiikKc/zcRy3Zgp/m3EzhXcyDL1r7THHcQzDME2zaRoFOgBd1/Ekic91XaiiKBIW27Y9z8PGDoVgh2Ho+z68irWEmbpjM5VmAjRjkGYRNmDZIaJY1HVNFVS8HM68aHEQNjkzgzidcG1h1gBI1fltA4IZFpLktzBJaGstGs6/MwFu5Ka1XdiVP+wDFNZ6sfaTAd0AAAAASUVORK5CYII=\'); background-size: cover; display: block;"\n    >\n      <img\n        class="gatsby-resp-image-image"\n        style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;"\n        alt="2020 06 30 01 47 10"\n        title=""\n        src="/static/2020-06-30-01-47-10-7852bb852291ce9543e97e6028b63e02-fee1c.png"\n        srcset="/static/2020-06-30-01-47-10-7852bb852291ce9543e97e6028b63e02-a67b7.png 200w,\n/static/2020-06-30-01-47-10-7852bb852291ce9543e97e6028b63e02-0b187.png 400w,\n/static/2020-06-30-01-47-10-7852bb852291ce9543e97e6028b63e02-fee1c.png 800w,\n/static/2020-06-30-01-47-10-7852bb852291ce9543e97e6028b63e02-6a871.png 1052w"\n        sizes="(max-width: 800px) 100vw, 800px"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<h2 id="数据快照"><a href="#%E6%95%B0%E6%8D%AE%E5%BF%AB%E7%85%A7" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>数据快照</h2>\n<p>对于纯 dom 结构的文档型品类，我们会在打开文档，解析数据后，把生成的 html 缓存在本地数据库一张快照表里。下一次切换容器时，在取本地数据去解析的同时，会判断对应 id 在快照表是否存在缓存，如果有，直接取出来，覆盖在 html 上，用户可以提前看到上一次渲染的数据，等本地数据真正解析完，再展示可交互界面。解析数据准备渲染也是需要一个上百毫秒的过程，这一策略可以让用户提前看到内容。</p>\n<h2 id="预创建"><a href="#%E9%A2%84%E5%88%9B%E5%BB%BA" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>预创建</h2>\n<p>有了极致的打开速度，如何优化新建速度呢。正常的新建流程是这样的，用户点击新建按钮，前端请求创建 cgi, 等待后台创建成功返回新文档 url，前端再新开 webview，加载展示页面。我们可以看，由于需要等待创建接口返回的原因，到新建的过程比正常打开一个文档还要更久。</p>\n<p>怎么样才能让新建也做到秒开呢？思路和数据预拉取一样，在用户进入文档首页的同时，我们会提前预请求一批创建 id，然后缓存到本地，同时根据创建 id 生成一篇空白文档数据，储存在本地，标示状态为未使用。用户点击新建按钮，本质上是从本地取一个未使用的文档 url，直接用容器切换打开，然后再和后台进行同步。</p>\n<h1 id="监控与开关系统"><a href="#%E7%9B%91%E6%8E%A7%E4%B8%8E%E5%BC%80%E5%85%B3%E7%B3%BB%E7%BB%9F" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>监控与开关系统</h1>\n<p>容器方案使用了数据预取场景，命中率的监控非常重要。由于切换页面的过程，如果命中容器，我们会接受来自客户端的通知，在这个时机，我们可以进行上报。</p>\n<p>另外一个非常重要的是容器能力的开关系统，在发布之初保持现网稳定性是非常重要的措施，但任何程序都不能保证没有 bug，我们通过内部七彩石配置系统控制这套容器方案的各种特性在不同品类下是否启用，同时这套配置也支持灰度和回滚方案，能够应急各种突发问题。</p>\n<p>灰度期容器间命中率</p>\n<p>\n  <a\n    class="gatsby-resp-image-link"\n    href="/static/2020-06-30-01-53-57-a5d9f33b2b28c2b5153f9ccd150f33a0-50f04.png"\n    style="display: block"\n    target="_blank"\n    rel="noopener"\n  >\n  \n  <span\n    class="gatsby-resp-image-wrapper"\n    style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;"\n  >\n    <span\n      class="gatsby-resp-image-background-image"\n      style="padding-bottom: 59.422283356258596%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAIAAADtbgqsAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABKUlEQVQoz42STUvDQBCG83NFoRLBHgIqei+kP0G8FgQrForgwSKCInqoSj0U2yStbWzS7Ff2200DemgS+x4WdnaenX1n1tKFUsoshIr5N+CUmn1hlqV1KY4oB/EcxxPO6aawZIx0OvfHzbbriocbJCBFnlbiP3j12vD0zK/Zn5fdfqsVbG3D257WQstqeEUyPxjt7KaDjzwWt6885yA/qoSlzJrUfx3b+wqTPB0/v2Rbkv7eXlVZQjS269H5RRbgfNpwp41mWVMLPKPHp1Ftzz868eqO7xwaI4VlC7qthDB5zAuW3WvQu5MQ6nJZ6/NVjOvN9AdTJgBKhVFqflXKKSMEUGYiTLKE85JR5XbCCA+GM4wR9t+TxQwAPFkMw+iLwCWN3xIA1ZrtH8XSrtCbSKAYAAAAAElFTkSuQmCC\'); background-size: cover; display: block;"\n    >\n      <img\n        class="gatsby-resp-image-image"\n        style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;"\n        alt="2020 06 30 01 53 57"\n        title=""\n        src="/static/2020-06-30-01-53-57-a5d9f33b2b28c2b5153f9ccd150f33a0-fee1c.png"\n        srcset="/static/2020-06-30-01-53-57-a5d9f33b2b28c2b5153f9ccd150f33a0-a67b7.png 200w,\n/static/2020-06-30-01-53-57-a5d9f33b2b28c2b5153f9ccd150f33a0-0b187.png 400w,\n/static/2020-06-30-01-53-57-a5d9f33b2b28c2b5153f9ccd150f33a0-fee1c.png 800w,\n/static/2020-06-30-01-53-57-a5d9f33b2b28c2b5153f9ccd150f33a0-b1a91.png 1200w,\n/static/2020-06-30-01-53-57-a5d9f33b2b28c2b5153f9ccd150f33a0-50f04.png 1454w"\n        sizes="(max-width: 800px) 100vw, 800px"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<h1 id="待优化的问题"><a href="#%E5%BE%85%E4%BC%98%E5%8C%96%E7%9A%84%E9%97%AE%E9%A2%98" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>待优化的问题</h1>\n<p>容器化方案用各种预创建 webview 的方式换取了打开速度，app 内存占用上会比未使用容器化方案要大非常多，webview 的释放时机、预加载数据的策略优化，以及从客户端到 web 端，如何更好的做内存管理是接下来需要进一步优化的点。</p>',
excerpt:"常用加速方法 通常的 web 优化方法，基本围绕在资源加载和 html 渲染两个方面。前者针对首屏，后者针对可交互。 资源优化上，我们总的方向是围绕更小的资源包上，比如常见的：压缩、减包、拆包、动态加载包及图片优化上。 html 渲染上总的方向是更快的展示内容，比如通过 cdn…",frontmatter:{date:"2020-06-29 17:14:03",path:"/mobile-h5-startup-way/",tags:"前端, 移动端, h5秒开",title:"移动端h5秒开方案总结",draft:null}}},pathContext:{mainPostPath:"/mobile-page-adaptation/",nextPostPath:"/webpack-v5-new-feature/",prePostPath:"/mobile-h5-startup-way/"}}}});