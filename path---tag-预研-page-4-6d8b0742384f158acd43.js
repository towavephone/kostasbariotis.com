webpackJsonp([65116756252467],{1427:function(n,s){n.exports={data:{site:{siteMetadata:{title:"女王控的博客",description:'前端工程师，黑猫女王控，欢迎勾搭，技术相关<a href="https://github.com/towavephone" target="_blank">@towavephone</a>，QQ闲聊<a href="tencent://AddContact/?fromId=45&fromSubId=1&subcmd=all&uin=634407147&website=www.oicqzone.com">@towave</a>，bili关注<a href="https://space.bilibili.com/11507708#/" target="_blank">@towave</a>',siteUrl:"https://blog.towavephone.com"}}},pathContext:{posts:[{excerpt:"需求背景 最近要做一个声音波形图组件，方便运营人员对声音进行切分，以配合完成人工切分录音的工作 核心思路 利用 ref 属性调用原生方法 解决方案 功能点 点击播放只会在播放区域进行播放，再次点击暂停播放，鼠标右键点击播放区域也可播放 可以添加播放区域，添加时会删除上一个播放区域，按住 shift + 鼠标右键可删除播放区域 可以放大缩小波形图 WaveFormDivider/index.js WaveFormDivider/styles.css 类似实现效果",html:'<h1 id="需求背景"><a href="#%E9%9C%80%E6%B1%82%E8%83%8C%E6%99%AF" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>需求背景</h1>\n<p>最近要做一个声音波形图组件，方便运营人员对声音进行切分，以配合完成人工切分录音的工作</p>\n<h1 id="核心思路"><a href="#%E6%A0%B8%E5%BF%83%E6%80%9D%E8%B7%AF" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>核心思路</h1>\n<p>利用 ref 属性调用原生方法</p>\n<h1 id="解决方案"><a href="#%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>解决方案</h1>\n<h2 id="功能点"><a href="#%E5%8A%9F%E8%83%BD%E7%82%B9" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>功能点</h2>\n<ul>\n<li>点击播放只会在播放区域进行播放，再次点击暂停播放，鼠标右键点击播放区域也可播放</li>\n<li>可以添加播放区域，添加时会删除上一个播放区域，按住 shift + 鼠标右键可删除播放区域</li>\n<li>可以放大缩小波形图</li>\n</ul>\n<h2 id="waveformdividerindexjs"><a href="#waveformdividerindexjs" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>WaveFormDivider/index.js</h2>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="94961365827025130000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`/* eslint-disable no-unused-expressions */\n/* eslint-disable import/no-unresolved */\n/* eslint-disable no-param-reassign */\nimport React from \'react\';\nimport WaveSurfer from \'waveSurfer.js\';\nimport RegionsPlugin from \'waveSurfer.js/dist/plugin/waveSurfer.regions\';\nimport TimelinePlugin from \'waveSurfer.js/dist/plugin/waveSurfer.timeline\';\nimport MinimapPlugin from \'waveSurfer.js/dist/plugin/waveSurfer.minimap\';\nimport { Slider, Button, Icon } from \'antd\';\nimport { fromJS } from \'immutable\';\nimport styles from \'./styles.css\';\n\n/**\n * Use formatTimeCallback to style the notch labels as you wish, such\n * as with more detail as the number of pixels per second increases.\n *\n * Here we format as M:SS.frac, with M suppressed for times < 1 minute,\n * and frac having 0, 1, or 2 digits as the zoom increases.\n *\n * Note that if you override the default function, you\'ll almost\n * certainly want to override timeInterval, primaryLabelInterval and/or\n * secondaryLabelInterval so they all work together.\n *\n * @param: seconds\n * @param: pxPerSec\n */\nfunction formatTimeCallback(seconds, pxPerSec) {\n  seconds = Number(seconds);\n  const minutes = Math.floor(seconds / 60);\n  seconds %= 60;\n\n  // fill up seconds with zeroes\n  let secondsStr = Math.round(seconds).toString();\n  if (pxPerSec >= 25 * 10) {\n    secondsStr = seconds.toFixed(2);\n  } else if (pxPerSec >= 25 * 1) {\n    secondsStr = seconds.toFixed(1);\n  }\n\n  if (minutes > 0) {\n    if (seconds < 10) {\n      secondsStr = \\`0\\${secondsStr}\\`;\n    }\n    return \\`\\${minutes}:\\${secondsStr}\\`;\n  }\n  return secondsStr;\n}\n\n/**\n * Use timeInterval to set the period between notches, in seconds,\n * adding notches as the number of pixels per second increases.\n *\n * Note that if you override the default function, you\'ll almost\n * certainly want to override formatTimeCallback, primaryLabelInterval\n * and/or secondaryLabelInterval so they all work together.\n *\n * @param: pxPerSec\n */\nfunction timeInterval(pxPerSec) {\n  let retval = 1;\n  if (pxPerSec >= 25 * 100) {\n    retval = 0.01;\n  } else if (pxPerSec >= 25 * 40) {\n    retval = 0.025;\n  } else if (pxPerSec >= 25 * 10) {\n    retval = 0.1;\n  } else if (pxPerSec >= 25 * 4) {\n    retval = 0.25;\n  } else if (pxPerSec >= 25) {\n    retval = 1;\n  } else if (pxPerSec * 5 >= 25) {\n    retval = 5;\n  } else if (pxPerSec * 15 >= 25) {\n    retval = 15;\n  } else {\n    retval = Math.ceil(0.5 / pxPerSec) * 60;\n  }\n  return retval;\n}\n\n/**\n * Return the cadence of notches that get labels in the primary color.\n * EG, return 2 if every 2nd notch should be labeled,\n * return 10 if every 10th notch should be labeled, etc.\n *\n * Note that if you override the default function, you\'ll almost\n * certainly want to override formatTimeCallback, primaryLabelInterval\n * and/or secondaryLabelInterval so they all work together.\n *\n * @param pxPerSec\n */\nfunction primaryLabelInterval(pxPerSec) {\n  let retval = 1;\n  if (pxPerSec >= 25 * 100) {\n    retval = 10;\n  } else if (pxPerSec >= 25 * 40) {\n    retval = 4;\n  } else if (pxPerSec >= 25 * 10) {\n    retval = 10;\n  } else if (pxPerSec >= 25 * 4) {\n    retval = 4;\n  } else if (pxPerSec >= 25) {\n    retval = 1;\n  } else if (pxPerSec * 5 >= 25) {\n    retval = 5;\n  } else if (pxPerSec * 15 >= 25) {\n    retval = 15;\n  } else {\n    retval = Math.ceil(0.5 / pxPerSec) * 60;\n  }\n  return retval;\n}\n\n/**\n * Return the cadence of notches to get labels in the secondary color.\n * EG, return 2 if every 2nd notch should be labeled,\n * return 10 if every 10th notch should be labeled, etc.\n *\n * Secondary labels are drawn after primary labels, so if\n * you want to have labels every 10 seconds and another color labels\n * every 60 seconds, the 60 second labels should be the secondaries.\n *\n * Note that if you override the default function, you\'ll almost\n * certainly want to override formatTimeCallback, primaryLabelInterval\n * and/or secondaryLabelInterval so they all work together.\n *\n * @param pxPerSec\n */\nfunction secondaryLabelInterval(pxPerSec) {\n  // draw one every 10s as an example\n  return Math.floor(10 / timeInterval(pxPerSec));\n}\n\nexport class WaveFormDivider extends React.PureComponent {\n  // eslint-disable-line react/prefer-stateless-function\n  static defaultProps = {\n    startTime: undefined,\n    endTime: undefined,\n    src: \'\'\n  };\n\n  static initState = {\n    data: fromJS({\n      zoom: 0,\n      playing: false\n    })\n  };\n\n  state = WaveFormDivider.initState;\n\n  componentDidMount() {\n    const { src } = this.props;\n    src && this.initWaveSurfer();\n  }\n\n  componentWillUnmount() {\n    this.destroyWaveSurfer();\n  }\n\n  setImmState = (fn, cb) => {\n    this.setState(\n      ({ data }) => ({\n        data: fn(data)\n      }),\n      cb\n    );\n  };\n\n  destroyWaveSurfer = () => {\n    this.setState(WaveFormDivider.initState);\n    this.waveSurfer && this.waveSurfer.destroy();\n  };\n\n  initWaveSurfer = () => {\n    const { data } = this.state;\n    const { handleChangeStartEnd, src, startTime, endTime } = this.props;\n    this.waveSurfer = WaveSurfer.create({\n      container: this.waveForm,\n      scrollParent: true,\n      waveColor: \'#A8DBA8\',\n      progressColor: \'#3B8686\',\n      plugins: [\n        MinimapPlugin.create(),\n        RegionsPlugin.create({\n          dragSelection: {\n            slop: 5\n          }\n        }),\n        TimelinePlugin.create({\n          container: this.waveTimeline,\n          formatTimeCallback,\n          timeInterval,\n          primaryLabelInterval,\n          secondaryLabelInterval,\n          primaryColor: \'blue\',\n          secondaryColor: \'red\',\n          primaryFontColor: \'blue\',\n          secondaryFontColor: \'red\'\n        })\n      ]\n    });\n    this.waveSurfer.load(src);\n    this.waveSurfer.on(\'ready\', () => {\n      this.waveSurfer.zoom(data.get(\'zoom\'));\n      if (data.get(\'playing\')) {\n        this.waveSurfer.play();\n      }\n      startTime !== undefined && endTime !== undefined && this.addWaveFormRegion(startTime, endTime);\n    });\n    this.waveSurfer.on(\'region-update-end\', (e) => {\n      const { start, end } = e;\n      handleChangeStartEnd && handleChangeStartEnd(start, end);\n    });\n    this.waveSurfer.on(\'region-created\', () => {\n      this.waveSurfer.clearRegions();\n    });\n    // this.waveSurfer.on(\'region-removed\', () => {\n    //   handleChangeStartEnd && handleChangeStartEnd(undefined, undefined);\n    // });\n    this.waveSurfer.on(\'pause\', () => {\n      this.setImmState((dat) => dat.set(\'playing\', false));\n    });\n    this.waveSurfer.on(\'play\', () => {\n      this.setImmState((dat) => dat.set(\'playing\', true));\n    });\n    this.waveSurfer.on(\'zoom\', (value) => {\n      this.setImmState((dat) => dat.set(\'zoom\', value));\n    });\n    this.waveSurfer.on(\'region-click\', (region, e) => {\n      e.stopPropagation();\n      if (e.shiftKey) {\n        region.remove();\n        handleChangeStartEnd && handleChangeStartEnd(undefined, undefined);\n      } else {\n        region.play();\n      }\n    });\n  };\n\n  addWaveFormRegion = (start, end) => {\n    this.waveSurfer.addRegion({\n      start,\n      end,\n      color: \'hsla(400, 100%, 30%, 0.5)\'\n    });\n  };\n\n  handleWaveFormZoom = (value) => {\n    let tmp = value;\n    if (value < 0) {\n      tmp = 0;\n    }\n    if (value > 1000) {\n      tmp = 1000;\n    }\n    this.waveSurfer.zoom(tmp);\n  };\n\n  handleWaveFormPlayOrPause = () => {\n    const { data } = this.state;\n    const { startTime, endTime } = this.props;\n    if (data.get(\'playing\')) {\n      this.waveSurfer.pause();\n    } else {\n      this.waveSurfer.play(startTime, endTime);\n    }\n  };\n\n  render() {\n    const { data } = this.state;\n    return (\n      <div className={styles.container}>\n        <div\n          ref={(r) => {\n            this.waveForm = r;\n          }}\n          className={styles.waveForm}\n        />\n        <div\n          ref={(r) => {\n            this.waveTimeline = r;\n          }}\n        />\n        <div className={styles.control}>\n          <div className={styles.zoomContainer}>\n            <Icon type=\'minus-circle-o\' onClick={() => this.handleWaveFormZoom(data.get(\'zoom\') - 100)} />\n            <Slider\n              tipFormatter={(value) => \\`\\${value}%\\`}\n              max={1000}\n              onChange={(value) => this.handleWaveFormZoom(value)}\n              value={data.get(\'zoom\')}\n            />\n            <Icon type=\'plus-circle-o\' onClick={() => this.handleWaveFormZoom(data.get(\'zoom\') + 100)} />\n          </div>\n          <Button className={styles.playBtn} type=\'primary\' onClick={this.handleWaveFormPlayOrPause}>\n            {data.get(\'playing\') ? \'暂停\' : \'播放\'}\n          </Button>\n        </div>\n      </div>\n    );\n  }\n}\n\nWaveFormDivider.propTypes = {\n  src: React.PropTypes.string,\n  handleChangeStartEnd: React.PropTypes.func,\n  startTime: React.PropTypes.number,\n  endTime: React.PropTypes.number\n};\n\nexport default WaveFormDivider;`, `94961365827025130000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                data-tooltip="复制"\n              >\n                <svg class="gatsby-code-button-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0V0z"/><path d="M16 1H2v16h2V3h12V1zm-1 4l6 6v12H6V5h9zm-1 7h5.5L14 6.5V12z"/></svg>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="jsx"><pre style="counter-reset: linenumber NaN" class="language-jsx line-numbers"><code class="language-jsx"><span class="token comment">/* eslint-disable no-unused-expressions */</span>\n<span class="token comment">/* eslint-disable import/no-unresolved */</span>\n<span class="token comment">/* eslint-disable no-param-reassign */</span>\n<span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">\'react\'</span><span class="token punctuation">;</span>\n<span class="token keyword">import</span> WaveSurfer <span class="token keyword">from</span> <span class="token string">\'waveSurfer.js\'</span><span class="token punctuation">;</span>\n<span class="token keyword">import</span> RegionsPlugin <span class="token keyword">from</span> <span class="token string">\'waveSurfer.js/dist/plugin/waveSurfer.regions\'</span><span class="token punctuation">;</span>\n<span class="token keyword">import</span> TimelinePlugin <span class="token keyword">from</span> <span class="token string">\'waveSurfer.js/dist/plugin/waveSurfer.timeline\'</span><span class="token punctuation">;</span>\n<span class="token keyword">import</span> MinimapPlugin <span class="token keyword">from</span> <span class="token string">\'waveSurfer.js/dist/plugin/waveSurfer.minimap\'</span><span class="token punctuation">;</span>\n<span class="token keyword">import</span> <span class="token punctuation">{</span> Slider<span class="token punctuation">,</span> Button<span class="token punctuation">,</span> Icon <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">\'antd\'</span><span class="token punctuation">;</span>\n<span class="token keyword">import</span> <span class="token punctuation">{</span> fromJS <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">\'immutable\'</span><span class="token punctuation">;</span>\n<span class="token keyword">import</span> styles <span class="token keyword">from</span> <span class="token string">\'./styles.css\'</span><span class="token punctuation">;</span>\n\n<span class="token comment">/**\n * Use formatTimeCallback to style the notch labels as you wish, such\n * as with more detail as the number of pixels per second increases.\n *\n * Here we format as M:SS.frac, with M suppressed for times &lt; 1 minute,\n * and frac having 0, 1, or 2 digits as the zoom increases.\n *\n * Note that if you override the default function, you\'ll almost\n * certainly want to override timeInterval, primaryLabelInterval and/or\n * secondaryLabelInterval so they all work together.\n *\n * @param: seconds\n * @param: pxPerSec\n */</span>\n<span class="token keyword">function</span> <span class="token function">formatTimeCallback</span><span class="token punctuation">(</span><span class="token parameter">seconds<span class="token punctuation">,</span> pxPerSec</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  seconds <span class="token operator">=</span> <span class="token function">Number</span><span class="token punctuation">(</span>seconds<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token keyword">const</span> minutes <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span>seconds <span class="token operator">/</span> <span class="token number">60</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  seconds <span class="token operator">%=</span> <span class="token number">60</span><span class="token punctuation">;</span>\n\n  <span class="token comment">// fill up seconds with zeroes</span>\n  <span class="token keyword">let</span> secondsStr <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">round</span><span class="token punctuation">(</span>seconds<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token keyword">if</span> <span class="token punctuation">(</span>pxPerSec <span class="token operator">>=</span> <span class="token number">25</span> <span class="token operator">*</span> <span class="token number">10</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    secondsStr <span class="token operator">=</span> seconds<span class="token punctuation">.</span><span class="token function">toFixed</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>pxPerSec <span class="token operator">>=</span> <span class="token number">25</span> <span class="token operator">*</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    secondsStr <span class="token operator">=</span> seconds<span class="token punctuation">.</span><span class="token function">toFixed</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n\n  <span class="token keyword">if</span> <span class="token punctuation">(</span>minutes <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">if</span> <span class="token punctuation">(</span>seconds <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      secondsStr <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">0</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>secondsStr<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n    <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>minutes<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>secondsStr<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n  <span class="token keyword">return</span> secondsStr<span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token comment">/**\n * Use timeInterval to set the period between notches, in seconds,\n * adding notches as the number of pixels per second increases.\n *\n * Note that if you override the default function, you\'ll almost\n * certainly want to override formatTimeCallback, primaryLabelInterval\n * and/or secondaryLabelInterval so they all work together.\n *\n * @param: pxPerSec\n */</span>\n<span class="token keyword">function</span> <span class="token function">timeInterval</span><span class="token punctuation">(</span><span class="token parameter">pxPerSec</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">let</span> retval <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>\n  <span class="token keyword">if</span> <span class="token punctuation">(</span>pxPerSec <span class="token operator">>=</span> <span class="token number">25</span> <span class="token operator">*</span> <span class="token number">100</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    retval <span class="token operator">=</span> <span class="token number">0.01</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>pxPerSec <span class="token operator">>=</span> <span class="token number">25</span> <span class="token operator">*</span> <span class="token number">40</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    retval <span class="token operator">=</span> <span class="token number">0.025</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>pxPerSec <span class="token operator">>=</span> <span class="token number">25</span> <span class="token operator">*</span> <span class="token number">10</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    retval <span class="token operator">=</span> <span class="token number">0.1</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>pxPerSec <span class="token operator">>=</span> <span class="token number">25</span> <span class="token operator">*</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    retval <span class="token operator">=</span> <span class="token number">0.25</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>pxPerSec <span class="token operator">>=</span> <span class="token number">25</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    retval <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>pxPerSec <span class="token operator">*</span> <span class="token number">5</span> <span class="token operator">>=</span> <span class="token number">25</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    retval <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>pxPerSec <span class="token operator">*</span> <span class="token number">15</span> <span class="token operator">>=</span> <span class="token number">25</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    retval <span class="token operator">=</span> <span class="token number">15</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>\n    retval <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">ceil</span><span class="token punctuation">(</span><span class="token number">0.5</span> <span class="token operator">/</span> pxPerSec<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">60</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n  <span class="token keyword">return</span> retval<span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token comment">/**\n * Return the cadence of notches that get labels in the primary color.\n * EG, return 2 if every 2nd notch should be labeled,\n * return 10 if every 10th notch should be labeled, etc.\n *\n * Note that if you override the default function, you\'ll almost\n * certainly want to override formatTimeCallback, primaryLabelInterval\n * and/or secondaryLabelInterval so they all work together.\n *\n * @param pxPerSec\n */</span>\n<span class="token keyword">function</span> <span class="token function">primaryLabelInterval</span><span class="token punctuation">(</span><span class="token parameter">pxPerSec</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">let</span> retval <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>\n  <span class="token keyword">if</span> <span class="token punctuation">(</span>pxPerSec <span class="token operator">>=</span> <span class="token number">25</span> <span class="token operator">*</span> <span class="token number">100</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    retval <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>pxPerSec <span class="token operator">>=</span> <span class="token number">25</span> <span class="token operator">*</span> <span class="token number">40</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    retval <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>pxPerSec <span class="token operator">>=</span> <span class="token number">25</span> <span class="token operator">*</span> <span class="token number">10</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    retval <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>pxPerSec <span class="token operator">>=</span> <span class="token number">25</span> <span class="token operator">*</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    retval <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>pxPerSec <span class="token operator">>=</span> <span class="token number">25</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    retval <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>pxPerSec <span class="token operator">*</span> <span class="token number">5</span> <span class="token operator">>=</span> <span class="token number">25</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    retval <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>pxPerSec <span class="token operator">*</span> <span class="token number">15</span> <span class="token operator">>=</span> <span class="token number">25</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    retval <span class="token operator">=</span> <span class="token number">15</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>\n    retval <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">ceil</span><span class="token punctuation">(</span><span class="token number">0.5</span> <span class="token operator">/</span> pxPerSec<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">60</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n  <span class="token keyword">return</span> retval<span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token comment">/**\n * Return the cadence of notches to get labels in the secondary color.\n * EG, return 2 if every 2nd notch should be labeled,\n * return 10 if every 10th notch should be labeled, etc.\n *\n * Secondary labels are drawn after primary labels, so if\n * you want to have labels every 10 seconds and another color labels\n * every 60 seconds, the 60 second labels should be the secondaries.\n *\n * Note that if you override the default function, you\'ll almost\n * certainly want to override formatTimeCallback, primaryLabelInterval\n * and/or secondaryLabelInterval so they all work together.\n *\n * @param pxPerSec\n */</span>\n<span class="token keyword">function</span> <span class="token function">secondaryLabelInterval</span><span class="token punctuation">(</span><span class="token parameter">pxPerSec</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token comment">// draw one every 10s as an example</span>\n  <span class="token keyword">return</span> Math<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span><span class="token number">10</span> <span class="token operator">/</span> <span class="token function">timeInterval</span><span class="token punctuation">(</span>pxPerSec<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">WaveFormDivider</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>PureComponent</span> <span class="token punctuation">{</span>\n  <span class="token comment">// eslint-disable-line react/prefer-stateless-function</span>\n  <span class="token keyword">static</span> defaultProps <span class="token operator">=</span> <span class="token punctuation">{</span>\n    startTime<span class="token punctuation">:</span> <span class="token keyword">undefined</span><span class="token punctuation">,</span>\n    endTime<span class="token punctuation">:</span> <span class="token keyword">undefined</span><span class="token punctuation">,</span>\n    src<span class="token punctuation">:</span> <span class="token string">\'\'</span>\n  <span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n  <span class="token keyword">static</span> initState <span class="token operator">=</span> <span class="token punctuation">{</span>\n    data<span class="token punctuation">:</span> <span class="token function">fromJS</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n      zoom<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span>\n      playing<span class="token punctuation">:</span> <span class="token boolean">false</span>\n    <span class="token punctuation">}</span><span class="token punctuation">)</span>\n  <span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n  state <span class="token operator">=</span> WaveFormDivider<span class="token punctuation">.</span>initState<span class="token punctuation">;</span>\n\n  <span class="token function">componentDidMount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">const</span> <span class="token punctuation">{</span> src <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">;</span>\n    src <span class="token operator">&amp;&amp;</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">initWaveSurfer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n\n  <span class="token function">componentWillUnmount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">destroyWaveSurfer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n\n  <span class="token function-variable function">setImmState</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">fn<span class="token punctuation">,</span> cb</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span>\n      <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> data <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">{</span>\n        data<span class="token punctuation">:</span> <span class="token function">fn</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>\n      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n      cb\n    <span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n  <span class="token function-variable function">destroyWaveSurfer</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span>WaveFormDivider<span class="token punctuation">.</span>initState<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">this</span><span class="token punctuation">.</span>waveSurfer <span class="token operator">&amp;&amp;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>waveSurfer<span class="token punctuation">.</span><span class="token function">destroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n  <span class="token function-variable function">initWaveSurfer</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n    <span class="token keyword">const</span> <span class="token punctuation">{</span> data <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">;</span>\n    <span class="token keyword">const</span> <span class="token punctuation">{</span> handleChangeStartEnd<span class="token punctuation">,</span> src<span class="token punctuation">,</span> startTime<span class="token punctuation">,</span> endTime <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">;</span>\n    <span class="token keyword">this</span><span class="token punctuation">.</span>waveSurfer <span class="token operator">=</span> WaveSurfer<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n      container<span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>waveForm<span class="token punctuation">,</span>\n      scrollParent<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>\n      waveColor<span class="token punctuation">:</span> <span class="token string">\'#A8DBA8\'</span><span class="token punctuation">,</span>\n      progressColor<span class="token punctuation">:</span> <span class="token string">\'#3B8686\'</span><span class="token punctuation">,</span>\n      plugins<span class="token punctuation">:</span> <span class="token punctuation">[</span>\n        MinimapPlugin<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n        RegionsPlugin<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n          dragSelection<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n            slop<span class="token punctuation">:</span> <span class="token number">5</span>\n          <span class="token punctuation">}</span>\n        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n        TimelinePlugin<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n          container<span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>waveTimeline<span class="token punctuation">,</span>\n          formatTimeCallback<span class="token punctuation">,</span>\n          timeInterval<span class="token punctuation">,</span>\n          primaryLabelInterval<span class="token punctuation">,</span>\n          secondaryLabelInterval<span class="token punctuation">,</span>\n          primaryColor<span class="token punctuation">:</span> <span class="token string">\'blue\'</span><span class="token punctuation">,</span>\n          secondaryColor<span class="token punctuation">:</span> <span class="token string">\'red\'</span><span class="token punctuation">,</span>\n          primaryFontColor<span class="token punctuation">:</span> <span class="token string">\'blue\'</span><span class="token punctuation">,</span>\n          secondaryFontColor<span class="token punctuation">:</span> <span class="token string">\'red\'</span>\n        <span class="token punctuation">}</span><span class="token punctuation">)</span>\n      <span class="token punctuation">]</span>\n    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">this</span><span class="token punctuation">.</span>waveSurfer<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span>src<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">this</span><span class="token punctuation">.</span>waveSurfer<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">\'ready\'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n      <span class="token keyword">this</span><span class="token punctuation">.</span>waveSurfer<span class="token punctuation">.</span><span class="token function">zoom</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">\'zoom\'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token keyword">if</span> <span class="token punctuation">(</span>data<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">\'playing\'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        <span class="token keyword">this</span><span class="token punctuation">.</span>waveSurfer<span class="token punctuation">.</span><span class="token function">play</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span>\n      startTime <span class="token operator">!==</span> <span class="token keyword">undefined</span> <span class="token operator">&amp;&amp;</span> endTime <span class="token operator">!==</span> <span class="token keyword">undefined</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">addWaveFormRegion</span><span class="token punctuation">(</span>startTime<span class="token punctuation">,</span> endTime<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">this</span><span class="token punctuation">.</span>waveSurfer<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">\'region-update-end\'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n      <span class="token keyword">const</span> <span class="token punctuation">{</span> start<span class="token punctuation">,</span> end <span class="token punctuation">}</span> <span class="token operator">=</span> e<span class="token punctuation">;</span>\n      handleChangeStartEnd <span class="token operator">&amp;&amp;</span> <span class="token function">handleChangeStartEnd</span><span class="token punctuation">(</span>start<span class="token punctuation">,</span> end<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">this</span><span class="token punctuation">.</span>waveSurfer<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">\'region-created\'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n      <span class="token keyword">this</span><span class="token punctuation">.</span>waveSurfer<span class="token punctuation">.</span><span class="token function">clearRegions</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token comment">// this.waveSurfer.on(\'region-removed\', () => {</span>\n    <span class="token comment">//   handleChangeStartEnd &amp;&amp; handleChangeStartEnd(undefined, undefined);</span>\n    <span class="token comment">// });</span>\n    <span class="token keyword">this</span><span class="token punctuation">.</span>waveSurfer<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">\'pause\'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setImmState</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">dat</span><span class="token punctuation">)</span> <span class="token operator">=></span> dat<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">\'playing\'</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">this</span><span class="token punctuation">.</span>waveSurfer<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">\'play\'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setImmState</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">dat</span><span class="token punctuation">)</span> <span class="token operator">=></span> dat<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">\'playing\'</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">this</span><span class="token punctuation">.</span>waveSurfer<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">\'zoom\'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setImmState</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">dat</span><span class="token punctuation">)</span> <span class="token operator">=></span> dat<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">\'zoom\'</span><span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">this</span><span class="token punctuation">.</span>waveSurfer<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">\'region-click\'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">region<span class="token punctuation">,</span> e</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n      e<span class="token punctuation">.</span><span class="token function">stopPropagation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token keyword">if</span> <span class="token punctuation">(</span>e<span class="token punctuation">.</span>shiftKey<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        region<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n        handleChangeStartEnd <span class="token operator">&amp;&amp;</span> <span class="token function">handleChangeStartEnd</span><span class="token punctuation">(</span><span class="token keyword">undefined</span><span class="token punctuation">,</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>\n        region<span class="token punctuation">.</span><span class="token function">play</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span>\n    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n  <span class="token function-variable function">addWaveFormRegion</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">start<span class="token punctuation">,</span> end</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n    <span class="token keyword">this</span><span class="token punctuation">.</span>waveSurfer<span class="token punctuation">.</span><span class="token function">addRegion</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n      start<span class="token punctuation">,</span>\n      end<span class="token punctuation">,</span>\n      color<span class="token punctuation">:</span> <span class="token string">\'hsla(400, 100%, 30%, 0.5)\'</span>\n    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n  <span class="token function-variable function">handleWaveFormZoom</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> tmp <span class="token operator">=</span> value<span class="token punctuation">;</span>\n    <span class="token keyword">if</span> <span class="token punctuation">(</span>value <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      tmp <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n    <span class="token keyword">if</span> <span class="token punctuation">(</span>value <span class="token operator">></span> <span class="token number">1000</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      tmp <span class="token operator">=</span> <span class="token number">1000</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n    <span class="token keyword">this</span><span class="token punctuation">.</span>waveSurfer<span class="token punctuation">.</span><span class="token function">zoom</span><span class="token punctuation">(</span>tmp<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n  <span class="token function-variable function">handleWaveFormPlayOrPause</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n    <span class="token keyword">const</span> <span class="token punctuation">{</span> data <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">;</span>\n    <span class="token keyword">const</span> <span class="token punctuation">{</span> startTime<span class="token punctuation">,</span> endTime <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">;</span>\n    <span class="token keyword">if</span> <span class="token punctuation">(</span>data<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">\'playing\'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token keyword">this</span><span class="token punctuation">.</span>waveSurfer<span class="token punctuation">.</span><span class="token function">pause</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>\n      <span class="token keyword">this</span><span class="token punctuation">.</span>waveSurfer<span class="token punctuation">.</span><span class="token function">play</span><span class="token punctuation">(</span>startTime<span class="token punctuation">,</span> endTime<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n  <span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">const</span> <span class="token punctuation">{</span> data <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">;</span>\n    <span class="token keyword">return</span> <span class="token punctuation">(</span>\n      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">className</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>styles<span class="token punctuation">.</span>container<span class="token punctuation">}</span></span><span class="token punctuation">></span></span><span class="token plain-text">\n        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span>\n          <span class="token attr-name">ref</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token parameter">r</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n            <span class="token keyword">this</span><span class="token punctuation">.</span>waveForm <span class="token operator">=</span> r<span class="token punctuation">;</span>\n          <span class="token punctuation">}</span><span class="token punctuation">}</span></span>\n          <span class="token attr-name">className</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>styles<span class="token punctuation">.</span>waveForm<span class="token punctuation">}</span></span>\n        <span class="token punctuation">/></span></span><span class="token plain-text">\n        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span>\n          <span class="token attr-name">ref</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token parameter">r</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n            <span class="token keyword">this</span><span class="token punctuation">.</span>waveTimeline <span class="token operator">=</span> r<span class="token punctuation">;</span>\n          <span class="token punctuation">}</span><span class="token punctuation">}</span></span>\n        <span class="token punctuation">/></span></span><span class="token plain-text">\n        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">className</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>styles<span class="token punctuation">.</span>control<span class="token punctuation">}</span></span><span class="token punctuation">></span></span><span class="token plain-text">\n          </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">className</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>styles<span class="token punctuation">.</span>zoomContainer<span class="token punctuation">}</span></span><span class="token punctuation">></span></span><span class="token plain-text">\n            </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Icon</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">\'</span>minus-circle-o<span class="token punctuation">\'</span></span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">handleWaveFormZoom</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">\'zoom\'</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span> <span class="token punctuation">/></span></span><span class="token plain-text">\n            </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Slider</span></span>\n              <span class="token attr-name">tipFormatter</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>value<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">%</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">}</span></span>\n              <span class="token attr-name">max</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token number">1000</span><span class="token punctuation">}</span></span>\n              <span class="token attr-name">onChange</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">handleWaveFormZoom</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">}</span></span>\n              <span class="token attr-name">value</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>data<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">\'zoom\'</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span>\n            <span class="token punctuation">/></span></span><span class="token plain-text">\n            </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Icon</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">\'</span>plus-circle-o<span class="token punctuation">\'</span></span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">handleWaveFormZoom</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">\'zoom\'</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span> <span class="token punctuation">/></span></span><span class="token plain-text">\n          </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">\n          </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Button</span></span> <span class="token attr-name">className</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>styles<span class="token punctuation">.</span>playBtn<span class="token punctuation">}</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">\'</span>primary<span class="token punctuation">\'</span></span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>handleWaveFormPlayOrPause<span class="token punctuation">}</span></span><span class="token punctuation">></span></span><span class="token plain-text">\n            </span><span class="token punctuation">{</span>data<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">\'playing\'</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token string">\'暂停\'</span> <span class="token punctuation">:</span> <span class="token string">\'播放\'</span><span class="token punctuation">}</span><span class="token plain-text">\n          </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Button</span></span><span class="token punctuation">></span></span><span class="token plain-text">\n        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">\n      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>\n    <span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n\nWaveFormDivider<span class="token punctuation">.</span>propTypes <span class="token operator">=</span> <span class="token punctuation">{</span>\n  src<span class="token punctuation">:</span> React<span class="token punctuation">.</span>PropTypes<span class="token punctuation">.</span>string<span class="token punctuation">,</span>\n  handleChangeStartEnd<span class="token punctuation">:</span> React<span class="token punctuation">.</span>PropTypes<span class="token punctuation">.</span>func<span class="token punctuation">,</span>\n  startTime<span class="token punctuation">:</span> React<span class="token punctuation">.</span>PropTypes<span class="token punctuation">.</span>number<span class="token punctuation">,</span>\n  endTime<span class="token punctuation">:</span> React<span class="token punctuation">.</span>PropTypes<span class="token punctuation">.</span>number\n<span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n<span class="token keyword">export</span> <span class="token keyword">default</span> WaveFormDivider<span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id="waveformdividerstylescss"><a href="#waveformdividerstylescss" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>WaveFormDivider/styles.css</h2>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="42688348954318725000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`@import \'styles/vars.css\';\n\n.control {\n  text-align: center;\n}\n\n.zoomContainer {\n  position: relative;\n  padding: 0 30px;\n\n  :global {\n    .anticon {\n      position: absolute;\n      top: -2px;\n      width: 16px;\n      height: 16px;\n      line-height: 1;\n      font-size: 16px;\n      color: rgba(0, 0, 0, 0.25);\n      cursor: pointer;\n\n      &:hover {\n        color: var(--color-primary);\n      }\n    }\n\n    .anticon:first-child {\n      left: 0;\n    }\n\n    .anticon:last-child {\n      right: 0;\n    }\n  }\n}`, `42688348954318725000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                data-tooltip="复制"\n              >\n                <svg class="gatsby-code-button-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0V0z"/><path d="M16 1H2v16h2V3h12V1zm-1 4l6 6v12H6V5h9zm-1 7h5.5L14 6.5V12z"/></svg>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token atrule"><span class="token rule">@import</span> <span class="token string">\'styles/vars.css\'</span><span class="token punctuation">;</span></span>\n\n<span class="token selector">.control</span> <span class="token punctuation">{</span>\n  <span class="token property">text-align</span><span class="token punctuation">:</span> center<span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token selector">.zoomContainer</span> <span class="token punctuation">{</span>\n  <span class="token property">position</span><span class="token punctuation">:</span> relative<span class="token punctuation">;</span>\n  <span class="token property">padding</span><span class="token punctuation">:</span> 0 30px<span class="token selector">;\n\n  :global</span> <span class="token punctuation">{</span>\n    <span class="token selector">.anticon</span> <span class="token punctuation">{</span>\n      <span class="token property">position</span><span class="token punctuation">:</span> absolute<span class="token punctuation">;</span>\n      <span class="token property">top</span><span class="token punctuation">:</span> -2px<span class="token punctuation">;</span>\n      <span class="token property">width</span><span class="token punctuation">:</span> 16px<span class="token punctuation">;</span>\n      <span class="token property">height</span><span class="token punctuation">:</span> 16px<span class="token punctuation">;</span>\n      <span class="token property">line-height</span><span class="token punctuation">:</span> 1<span class="token punctuation">;</span>\n      <span class="token property">font-size</span><span class="token punctuation">:</span> 16px<span class="token punctuation">;</span>\n      <span class="token property">color</span><span class="token punctuation">:</span> <span class="token function">rgba</span><span class="token punctuation">(</span>0<span class="token punctuation">,</span> 0<span class="token punctuation">,</span> 0<span class="token punctuation">,</span> 0.25<span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token property">cursor</span><span class="token punctuation">:</span> pointer<span class="token selector">;\n\n      &amp;:hover</span> <span class="token punctuation">{</span>\n        <span class="token property">color</span><span class="token punctuation">:</span> <span class="token function">var</span><span class="token punctuation">(</span>--color-primary<span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span>\n    <span class="token punctuation">}</span>\n\n    <span class="token selector">.anticon:first-child</span> <span class="token punctuation">{</span>\n      <span class="token property">left</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n\n    <span class="token selector">.anticon:last-child</span> <span class="token punctuation">{</span>\n      <span class="token property">right</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h1 id="类似实现效果"><a href="#%E7%B1%BB%E4%BC%BC%E5%AE%9E%E7%8E%B0%E6%95%88%E6%9E%9C" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>类似实现效果</h1>\n<p>\n  <a\n    class="gatsby-resp-image-link"\n    href="/static/2019-02-13-21-04-20-af1dd3e56833318bd0edabddebf90dc2-370b5.png"\n    style="display: block"\n    target="_blank"\n    rel="noopener"\n  >\n  \n  <span\n    class="gatsby-resp-image-wrapper"\n    style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;"\n  >\n    <span\n      class="gatsby-resp-image-background-image"\n      style="padding-bottom: 26.169265033407573%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAIAAADKYVtkAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAA7ElEQVQY0z2O206DQBCGef8rLxr1LTRpoykv4IXetIZGoBJICzTA7BHYA7uLS0mcfPky82cu/mCeZzc7JejA2pHD2MNIG6PEmhvrhDYrcrJycmLxgjY28E/fZbnZ757D7VO4fdzvXj/eo9tXQs8nfDpCdGjTY5tG3e+ZlAVtMlKn6BJDUfE20FoDIcUly/M4LxJPlkVNe0UMY4Y6giqACjrvGkEN0DGGh6HjvJcyELwnmFPSe7jvTjw+6TFaoEA96L6jBc65UtJJYaS41/6fl8/rJkwe3uKfkvnTOrfmSikzGWvM7Jy3tV5G6+kPBjYVZAAEFH0AAAAASUVORK5CYII=\'); background-size: cover; display: block;"\n    >\n      <img\n        class="gatsby-resp-image-image"\n        style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;"\n        alt="2019 02 13 21 04 20"\n        title=""\n        src="/static/2019-02-13-21-04-20-af1dd3e56833318bd0edabddebf90dc2-fee1c.png"\n        srcset="/static/2019-02-13-21-04-20-af1dd3e56833318bd0edabddebf90dc2-a67b7.png 200w,\n/static/2019-02-13-21-04-20-af1dd3e56833318bd0edabddebf90dc2-0b187.png 400w,\n/static/2019-02-13-21-04-20-af1dd3e56833318bd0edabddebf90dc2-fee1c.png 800w,\n/static/2019-02-13-21-04-20-af1dd3e56833318bd0edabddebf90dc2-370b5.png 898w"\n        sizes="(max-width: 800px) 100vw, 800px"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>',
id:"/github/workspace/blog/基于wavesurfer.js声音波形图的研究/index.md absPath of file >>> MarkdownRemark",timeToRead:6,frontmatter:{date:"2019-02-13 20:39:46",path:"/wavesurfer-voice-wave-research/",tags:"前端, wavesurfer, 声音波形图, 预研",title:"基于wavesurfer.js声音波形图的研究",draft:null}},{excerpt:"需求背景 最近要做一个需求类似于富文本框的功能，需要输入带有 span 标签并显示，同时 span 标签是一个整体，只能同时输入同时删除，目前需求只有这一个 html 标签，暂时无其他标签 需求难点 placeholder 提示语 input 和 textarea 能轻松实现 placeholder 提示语的效果，但作用于 contenteditable 的元素，placeholder 不起作用，可以通过 css 的:empty 解决： 获取输入框的内容 可以利用 innerHTML…",html:'<h1 id="需求背景"><a href="#%E9%9C%80%E6%B1%82%E8%83%8C%E6%99%AF" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>需求背景</h1>\n<p>最近要做一个需求类似于富文本框的功能，需要输入带有 span 标签并显示，同时 span 标签是一个整体，只能同时输入同时删除，目前需求只有这一个 html 标签，暂时无其他标签</p>\n<p>\n  <a\n    class="gatsby-resp-image-link"\n    href="/static/2018-11-26-09-42-43-6e232250eebef2695e175b9c1728f894-262af.png"\n    style="display: block"\n    target="_blank"\n    rel="noopener"\n  >\n  \n  <span\n    class="gatsby-resp-image-wrapper"\n    style="position: relative; display: block; ; max-width: 517px; margin-left: auto; margin-right: auto;"\n  >\n    <span\n      class="gatsby-resp-image-background-image"\n      style="padding-bottom: 76.40232108317214%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAIAAABr+ngCAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABcElEQVQoz6WRzU7CQBCA9018F+WCBxGsBylwNproCxjfQgmirTdPnvRigjQxUqIXw80ohkCMCUEEYpd2u9sdp638JMUE4pev23a6szO7JVsR0um0oiiapl/dmtflarFYTCaTqqpGZxI1QiaT3VQU8+FxtwL7Vaia94m1RDaXi84k6yMS4Q2rpDbiq3HjrnJgwqEJhmGsxGIpRcFPEwOIhv2hOopDgK4XTwov9cZOCfbKUK+/5vPHun6uRSDC8/q9PrVos9miQxsApMQBmIDtG98QCTMgnLuObTPmUGq5jHlCoFJwl4vTmjyrSYnvnIfxsRjBi7gCLEdSx7MChy6E4rPHBTodHEsZYCLBzI/2Z7vdabbeu1997Fl4v9rcV0xFxvolGRBcQ3gy2JT8Y2szwAw6SoZFmSRz4ZeUi8jDthnHs/GXmd9vBwY2OHhg8A+InBv/77qMMlFqyMtn+daTC1R2GBt0O62eu3wBS0ei8AQ/QIX1KtIumHEAAAAASUVORK5CYII=\'); background-size: cover; display: block;"\n    >\n      <img\n        class="gatsby-resp-image-image"\n        style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;"\n        alt="2018 11 26 09 42 43"\n        title=""\n        src="/static/2018-11-26-09-42-43-6e232250eebef2695e175b9c1728f894-262af.png"\n        srcset="/static/2018-11-26-09-42-43-6e232250eebef2695e175b9c1728f894-1499b.png 200w,\n/static/2018-11-26-09-42-43-6e232250eebef2695e175b9c1728f894-ea081.png 400w,\n/static/2018-11-26-09-42-43-6e232250eebef2695e175b9c1728f894-262af.png 517w"\n        sizes="(max-width: 517px) 100vw, 517px"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<p>\n  <a\n    class="gatsby-resp-image-link"\n    href="/static/2018-11-26-09-43-03-0442172c9f7cda8456f5c041925c2056-bb96f.png"\n    style="display: block"\n    target="_blank"\n    rel="noopener"\n  >\n  \n  <span\n    class="gatsby-resp-image-wrapper"\n    style="position: relative; display: block; ; max-width: 512px; margin-left: auto; margin-right: auto;"\n  >\n    <span\n      class="gatsby-resp-image-background-image"\n      style="padding-bottom: 59.1796875%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAIAAADtbgqsAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAA2klEQVQoz5WSPY7CMBCFfTfuQUHPETgDJTegoUJoq+22oEKiJFWQoFliWYmNIY49PzjKIsGyWofRkxvP55l5HgEAZ2OstbKQ1l64dyCiCN6fvk9GV/s8V2VJzERpkohC8IJ+5xIgBUgLkYXzKJUulFGFXO7c+JMzSfHl2lMT/tO1IRGTtDY6jl2p9aGZbvhousYSnUewhfElj1J6hOnHBSa83yXDdXByvD91cRTdZsD35IEdtGf3Vf315Inov1KxTLuCoV5kPPrAydc7cPS1LCusz7MtD+YwXOENMGe/iP1tGC4AAAAASUVORK5CYII=\'); background-size: cover; display: block;"\n    >\n      <img\n        class="gatsby-resp-image-image"\n        style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;"\n        alt="2018 11 26 09 43 03"\n        title=""\n        src="/static/2018-11-26-09-43-03-0442172c9f7cda8456f5c041925c2056-bb96f.png"\n        srcset="/static/2018-11-26-09-43-03-0442172c9f7cda8456f5c041925c2056-7728b.png 200w,\n/static/2018-11-26-09-43-03-0442172c9f7cda8456f5c041925c2056-23f96.png 400w,\n/static/2018-11-26-09-43-03-0442172c9f7cda8456f5c041925c2056-bb96f.png 512w"\n        sizes="(max-width: 512px) 100vw, 512px"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<h1 id="需求难点"><a href="#%E9%9C%80%E6%B1%82%E9%9A%BE%E7%82%B9" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>需求难点</h1>\n<h2 id="placeholder-提示语"><a href="#placeholder-%E6%8F%90%E7%A4%BA%E8%AF%AD" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>placeholder 提示语</h2>\n<p>input 和 textarea 能轻松实现 placeholder 提示语的效果，但作用于 contenteditable 的元素，placeholder 不起作用，可以通过 css 的:empty 解决：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="72297293131383760000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`[contenteditable=\'true\']:empty::before {\n  content: attr(placeholder);\n}`, `72297293131383760000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                data-tooltip="复制"\n              >\n                <svg class="gatsby-code-button-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0V0z"/><path d="M16 1H2v16h2V3h12V1zm-1 4l6 6v12H6V5h9zm-1 7h5.5L14 6.5V12z"/></svg>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">[contenteditable=\'true\']:empty::before</span> <span class="token punctuation">{</span>\n  <span class="token property">content</span><span class="token punctuation">:</span> <span class="token function">attr</span><span class="token punctuation">(</span>placeholder<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<h2 id="获取输入框的内容"><a href="#%E8%8E%B7%E5%8F%96%E8%BE%93%E5%85%A5%E6%A1%86%E7%9A%84%E5%86%85%E5%AE%B9" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>获取输入框的内容</h2>\n<p>可以利用 innerHTML、innerText、textContent 获取输入框的内容，详细对比介绍一下这几个方法：</p>\n<ol>\n<li>innerHTML 返回或修改标签之间的内容，包括标签和文本信息，基本上所有浏览器都支持。</li>\n<li>innerText 打印标签之间的纯文本信息，会将标签过滤掉,此功能最初由 Internet Explorer 引入，在 Firefox 上存在兼容问题。</li>\n</ol>\n<h3 id="innertext--textcontent"><a href="#innertext--textcontent" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>innerText !== textContent</h3>\n<p>innerText 和 textContent 均能获取标签的内容，但二者存在差别，使用的时候还需注意浏览器兼容性：</p>\n<ol>\n<li>textContent 会获取 style 元素里的文本（若有 script 元素也是这样），而 innerText 不会</li>\n<li>textContent 会保留空行、空格与换行符</li>\n<li>innerText 并不是标准，而 textContent 更早被纳入标准中</li>\n<li>innerText 会忽略 display: none 标签内的内容，textContent 则不会</li>\n<li>性能上 textContent > innerText</li>\n</ol>\n<h2 id="光标的位置"><a href="#%E5%85%89%E6%A0%87%E7%9A%84%E4%BD%8D%E7%BD%AE" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>光标的位置</h2>\n<p>首先遇到的一个问题是利用上述方法实现 placeholder 后，输入框的光标在 Firefox 中的位置会比其它浏览器要高一截。</p>\n<p>\n  <a\n    class="gatsby-resp-image-link"\n    href="/static/2018-11-26-09-37-29-8ad3cfaf5af4a8082cd2deccd1bcab8e-38753.png"\n    style="display: block"\n    target="_blank"\n    rel="noopener"\n  >\n  \n  <span\n    class="gatsby-resp-image-wrapper"\n    style="position: relative; display: block; ; max-width: 665px; margin-left: auto; margin-right: auto;"\n  >\n    <span\n      class="gatsby-resp-image-background-image"\n      style="padding-bottom: 14.73684210526316%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAIAAAAcOLh5AAAACXBIWXMAAA7DAAAOwwHHb6hkAAAAQklEQVQI15XNwQ0AIQhEUfoviAboxIXIxQ0cV4NICe47z88AESFiezgzI2Jfqz2YGbOM8VY557pXPYiIdnX376c6O9FlreVw/XlNAAAAAElFTkSuQmCC\'); background-size: cover; display: block;"\n    >\n      <img\n        class="gatsby-resp-image-image"\n        style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;"\n        alt="2018 11 26 09 37 29"\n        title=""\n        src="/static/2018-11-26-09-37-29-8ad3cfaf5af4a8082cd2deccd1bcab8e-38753.png"\n        srcset="/static/2018-11-26-09-37-29-8ad3cfaf5af4a8082cd2deccd1bcab8e-a480d.png 200w,\n/static/2018-11-26-09-37-29-8ad3cfaf5af4a8082cd2deccd1bcab8e-4026e.png 400w,\n/static/2018-11-26-09-37-29-8ad3cfaf5af4a8082cd2deccd1bcab8e-38753.png 665w"\n        sizes="(max-width: 665px) 100vw, 665px"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<p>尝试了很多方法来解决均无果，最终发现默认放置 <code class="language-text">&lt;\\br&gt;</code> 标签后，光标位置正常了。</p>\n<h3 id="受控组件下光标每次输入跳到文本开头"><a href="#%E5%8F%97%E6%8E%A7%E7%BB%84%E4%BB%B6%E4%B8%8B%E5%85%89%E6%A0%87%E6%AF%8F%E6%AC%A1%E8%BE%93%E5%85%A5%E8%B7%B3%E5%88%B0%E6%96%87%E6%9C%AC%E5%BC%80%E5%A4%B4" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>受控组件下光标每次输入跳到文本开头</h3>\n<p>另一个需求是输入文本时，在 react 富文本组件受控（即 setState) 的影响下，光标每次输入会跳到文本开头，而非受控组件不会出现此问题，但是需求原因，非受控组件是 react 的一种反模式，同时也会影响到组件的取值赋值过程不好同步，解决办法是只能自己控制光标的位置，实现受控组件</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="66883242176247325000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`function isChildOf(node, parentId) {\n  while (node !== null) {\n    if (node.id === parentId) {\n      return true;\n    }\n    node = node.parentNode;\n  }\n\n  return false;\n}\n\nfunction getCurrentCursorPosition(parentId) {\n  const selection = window.getSelection();\n  let charCount = -1;\n  let node;\n\n  if (selection.focusNode) {\n    if (isChildOf(selection.focusNode, parentId)) {\n      node = selection.focusNode;\n      charCount = selection.focusOffset;\n      while (node) {\n        if (node.id === parentId) {\n          break;\n        }\n\n        if (node.previousSibling) {\n          node = node.previousSibling;\n          charCount += node.textContent.length;\n        } else {\n          node = node.parentNode;\n          if (node === null) {\n            break;\n          }\n        }\n      }\n    }\n  }\n\n  return charCount;\n}\n\nfunction createRange(node, chars, range) {\n  if (!range) {\n    range = document.createRange();\n    range.selectNode(node);\n    range.setStart(node, 0);\n  }\n\n  if (chars.count === 0) {\n    range.setEnd(node, chars.count);\n  } else if (node && chars.count > 0) {\n    if (node.nodeType === Node.TEXT_NODE) {\n      if (node.textContent.length < chars.count) {\n        chars.count -= node.textContent.length;\n      } else {\n        range.setEnd(node, chars.count);\n        chars.count = 0;\n      }\n    } else {\n      for (let lp = 0; lp < node.childNodes.length; lp++) {\n        range = createRange(node.childNodes[lp], chars, range);\n\n        if (chars.count === 0) {\n          break;\n        }\n      }\n    }\n  }\n\n  return range;\n}\n\nfunction setCurrentCursorPosition(that, chars, node) {\n  if (chars >= 0) {\n    const selection = window.getSelection();\n\n    const range = createRange(that, { count: chars }, node);\n\n    if (range) {\n      range.collapse(false);\n      selection.removeAllRanges();\n      selection.addRange(range);\n    }\n  }\n}`, `66883242176247325000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                data-tooltip="复制"\n              >\n                <svg class="gatsby-code-button-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0V0z"/><path d="M16 1H2v16h2V3h12V1zm-1 4l6 6v12H6V5h9zm-1 7h5.5L14 6.5V12z"/></svg>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">function</span> <span class="token function">isChildOf</span><span class="token punctuation">(</span><span class="token parameter">node<span class="token punctuation">,</span> parentId</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">while</span> <span class="token punctuation">(</span>node <span class="token operator">!==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">if</span> <span class="token punctuation">(</span>node<span class="token punctuation">.</span>id <span class="token operator">===</span> parentId<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n    node <span class="token operator">=</span> node<span class="token punctuation">.</span>parentNode<span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n\n  <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">function</span> <span class="token function">getCurrentCursorPosition</span><span class="token punctuation">(</span><span class="token parameter">parentId</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">const</span> selection <span class="token operator">=</span> window<span class="token punctuation">.</span><span class="token function">getSelection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token keyword">let</span> charCount <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>\n  <span class="token keyword">let</span> node<span class="token punctuation">;</span>\n\n  <span class="token keyword">if</span> <span class="token punctuation">(</span>selection<span class="token punctuation">.</span>focusNode<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isChildOf</span><span class="token punctuation">(</span>selection<span class="token punctuation">.</span>focusNode<span class="token punctuation">,</span> parentId<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      node <span class="token operator">=</span> selection<span class="token punctuation">.</span>focusNode<span class="token punctuation">;</span>\n      charCount <span class="token operator">=</span> selection<span class="token punctuation">.</span>focusOffset<span class="token punctuation">;</span>\n      <span class="token keyword">while</span> <span class="token punctuation">(</span>node<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        <span class="token keyword">if</span> <span class="token punctuation">(</span>node<span class="token punctuation">.</span>id <span class="token operator">===</span> parentId<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n          <span class="token keyword">break</span><span class="token punctuation">;</span>\n        <span class="token punctuation">}</span>\n\n        <span class="token keyword">if</span> <span class="token punctuation">(</span>node<span class="token punctuation">.</span>previousSibling<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n          node <span class="token operator">=</span> node<span class="token punctuation">.</span>previousSibling<span class="token punctuation">;</span>\n          charCount <span class="token operator">+=</span> node<span class="token punctuation">.</span>textContent<span class="token punctuation">.</span>length<span class="token punctuation">;</span>\n        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>\n          node <span class="token operator">=</span> node<span class="token punctuation">.</span>parentNode<span class="token punctuation">;</span>\n          <span class="token keyword">if</span> <span class="token punctuation">(</span>node <span class="token operator">===</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n            <span class="token keyword">break</span><span class="token punctuation">;</span>\n          <span class="token punctuation">}</span>\n        <span class="token punctuation">}</span>\n      <span class="token punctuation">}</span>\n    <span class="token punctuation">}</span>\n  <span class="token punctuation">}</span>\n\n  <span class="token keyword">return</span> charCount<span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">function</span> <span class="token function">createRange</span><span class="token punctuation">(</span><span class="token parameter">node<span class="token punctuation">,</span> chars<span class="token punctuation">,</span> range</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>range<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    range <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createRange</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    range<span class="token punctuation">.</span><span class="token function">selectNode</span><span class="token punctuation">(</span>node<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    range<span class="token punctuation">.</span><span class="token function">setStart</span><span class="token punctuation">(</span>node<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n\n  <span class="token keyword">if</span> <span class="token punctuation">(</span>chars<span class="token punctuation">.</span>count <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    range<span class="token punctuation">.</span><span class="token function">setEnd</span><span class="token punctuation">(</span>node<span class="token punctuation">,</span> chars<span class="token punctuation">.</span>count<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>node <span class="token operator">&amp;&amp;</span> chars<span class="token punctuation">.</span>count <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">if</span> <span class="token punctuation">(</span>node<span class="token punctuation">.</span>nodeType <span class="token operator">===</span> Node<span class="token punctuation">.</span><span class="token constant">TEXT_NODE</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token keyword">if</span> <span class="token punctuation">(</span>node<span class="token punctuation">.</span>textContent<span class="token punctuation">.</span>length <span class="token operator">&lt;</span> chars<span class="token punctuation">.</span>count<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        chars<span class="token punctuation">.</span>count <span class="token operator">-=</span> node<span class="token punctuation">.</span>textContent<span class="token punctuation">.</span>length<span class="token punctuation">;</span>\n      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>\n        range<span class="token punctuation">.</span><span class="token function">setEnd</span><span class="token punctuation">(</span>node<span class="token punctuation">,</span> chars<span class="token punctuation">.</span>count<span class="token punctuation">)</span><span class="token punctuation">;</span>\n        chars<span class="token punctuation">.</span>count <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span>\n    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>\n      <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> lp <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> lp <span class="token operator">&lt;</span> node<span class="token punctuation">.</span>childNodes<span class="token punctuation">.</span>length<span class="token punctuation">;</span> lp<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        range <span class="token operator">=</span> <span class="token function">createRange</span><span class="token punctuation">(</span>node<span class="token punctuation">.</span>childNodes<span class="token punctuation">[</span>lp<span class="token punctuation">]</span><span class="token punctuation">,</span> chars<span class="token punctuation">,</span> range<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n        <span class="token keyword">if</span> <span class="token punctuation">(</span>chars<span class="token punctuation">.</span>count <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n          <span class="token keyword">break</span><span class="token punctuation">;</span>\n        <span class="token punctuation">}</span>\n      <span class="token punctuation">}</span>\n    <span class="token punctuation">}</span>\n  <span class="token punctuation">}</span>\n\n  <span class="token keyword">return</span> range<span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">function</span> <span class="token function">setCurrentCursorPosition</span><span class="token punctuation">(</span><span class="token parameter">that<span class="token punctuation">,</span> chars<span class="token punctuation">,</span> node</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">if</span> <span class="token punctuation">(</span>chars <span class="token operator">>=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">const</span> selection <span class="token operator">=</span> window<span class="token punctuation">.</span><span class="token function">getSelection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">const</span> range <span class="token operator">=</span> <span class="token function">createRange</span><span class="token punctuation">(</span>that<span class="token punctuation">,</span> <span class="token punctuation">{</span> count<span class="token punctuation">:</span> chars <span class="token punctuation">}</span><span class="token punctuation">,</span> node<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">if</span> <span class="token punctuation">(</span>range<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      range<span class="token punctuation">.</span><span class="token function">collapse</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n      selection<span class="token punctuation">.</span><span class="token function">removeAllRanges</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n      selection<span class="token punctuation">.</span><span class="token function">addRange</span><span class="token punctuation">(</span>range<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>具体用法是先得到富文本框之前的光标位置，然后在 setState 之后恢复光标的位置</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="84543060103794840000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`const lastRange = getCurrentCursorPosition(this.id);\nthis.setState(innerHTML, () => {\n  const that = document.getElementById(this.id);\n  setCurrentCursorPosition(that, lastRange);\n});`, `84543060103794840000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                data-tooltip="复制"\n              >\n                <svg class="gatsby-code-button-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0V0z"/><path d="M16 1H2v16h2V3h12V1zm-1 4l6 6v12H6V5h9zm-1 7h5.5L14 6.5V12z"/></svg>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">const</span> lastRange <span class="token operator">=</span> <span class="token function">getCurrentCursorPosition</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span>innerHTML<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n  <span class="token keyword">const</span> that <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token function">setCurrentCursorPosition</span><span class="token punctuation">(</span>that<span class="token punctuation">,</span> lastRange<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="删除遇到-span-时光标跳到文本开头"><a href="#%E5%88%A0%E9%99%A4%E9%81%87%E5%88%B0-span-%E6%97%B6%E5%85%89%E6%A0%87%E8%B7%B3%E5%88%B0%E6%96%87%E6%9C%AC%E5%BC%80%E5%A4%B4" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>删除遇到 span 时光标跳到文本开头</h3>\n<p>接着又遇到一个坑，因为想实现的是整体删除 span，所以设置了 contenteditable 属性为 false，在删除光标遇到带有 span 标签的字符时，光标也会跳到不正确的位置</p>\n<p>经过一步步的调试，发现取出函数 getCurrentCursorPosition 的光标位置是不对的，它取出的是在 span 内部光标的位置，比如说<code class="language-text">3233&lt;span&gt; 我是 &lt;/span&gt;</code>，此时取出的光标位置值为 2，而不是 6，考虑到修改 getCurrentCursorPosition 会影响之前的 bug，所以只能在删除遇到标签时做下特殊处理，在遇到 span 标签删除后，光标强制移到文本最后</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="55400772203451520000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`function selectAllText(elem) {\n  // 将光标移到文本末尾\n  if (window.getSelection) {\n    elem.focus();\n    const range = window.getSelection();\n    range.selectAllChildren(elem);\n    range.collapseToEnd();\n  } else if (document.selection) {\n    const range = document.selection.createTextRange();\n    range.moveToElementText(elem);\n    range.collapse(false);\n    range.select(); /* 避免产生空格*/\n  }\n}\n\nconst selection = window.getSelection();\nif (selection.focusNode.id === this.id) {\n  // 焦点在 span 内部，即光标遇到 span 标签\n  this.props.onChange(innerHTML, () => {\n    const that = document.getElementById(this.id);\n    selectAllText(that);\n  });\n  return;\n}`, `55400772203451520000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                data-tooltip="复制"\n              >\n                <svg class="gatsby-code-button-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0V0z"/><path d="M16 1H2v16h2V3h12V1zm-1 4l6 6v12H6V5h9zm-1 7h5.5L14 6.5V12z"/></svg>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">function</span> <span class="token function">selectAllText</span><span class="token punctuation">(</span><span class="token parameter">elem</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token comment">// 将光标移到文本末尾</span>\n  <span class="token keyword">if</span> <span class="token punctuation">(</span>window<span class="token punctuation">.</span>getSelection<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    elem<span class="token punctuation">.</span><span class="token function">focus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">const</span> range <span class="token operator">=</span> window<span class="token punctuation">.</span><span class="token function">getSelection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    range<span class="token punctuation">.</span><span class="token function">selectAllChildren</span><span class="token punctuation">(</span>elem<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    range<span class="token punctuation">.</span><span class="token function">collapseToEnd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>document<span class="token punctuation">.</span>selection<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">const</span> range <span class="token operator">=</span> document<span class="token punctuation">.</span>selection<span class="token punctuation">.</span><span class="token function">createTextRange</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    range<span class="token punctuation">.</span><span class="token function">moveToElementText</span><span class="token punctuation">(</span>elem<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    range<span class="token punctuation">.</span><span class="token function">collapse</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    range<span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">/* 避免产生空格*/</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">const</span> selection <span class="token operator">=</span> window<span class="token punctuation">.</span><span class="token function">getSelection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">if</span> <span class="token punctuation">(</span>selection<span class="token punctuation">.</span>focusNode<span class="token punctuation">.</span>id <span class="token operator">===</span> <span class="token keyword">this</span><span class="token punctuation">.</span>id<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token comment">// 焦点在 span 内部，即光标遇到 span 标签</span>\n  <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span><span class="token function">onChange</span><span class="token punctuation">(</span>innerHTML<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n    <span class="token keyword">const</span> that <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">selectAllText</span><span class="token punctuation">(</span>that<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token keyword">return</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id="中文输入法会将英文字符一起输入"><a href="#%E4%B8%AD%E6%96%87%E8%BE%93%E5%85%A5%E6%B3%95%E4%BC%9A%E5%B0%86%E8%8B%B1%E6%96%87%E5%AD%97%E7%AC%A6%E4%B8%80%E8%B5%B7%E8%BE%93%E5%85%A5" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>中文输入法会将英文字符一起输入</h2>\n<p>在输入中文字符时，会将英文字符一起输入，解决办法是触发相应事件给一个标志变量，判断中文输入是否已完成</p>\n<p>\n  <a\n    class="gatsby-resp-image-link"\n    href="/static/2018-11-26-10-07-29-b4670c1a79f7577f8ffd3da66e1b49e8-262af.png"\n    style="display: block"\n    target="_blank"\n    rel="noopener"\n  >\n  \n  <span\n    class="gatsby-resp-image-wrapper"\n    style="position: relative; display: block; ; max-width: 517px; margin-left: auto; margin-right: auto;"\n  >\n    <span\n      class="gatsby-resp-image-background-image"\n      style="padding-bottom: 58.027079303675045%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAIAAADtbgqsAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABZElEQVQoz41SS07DMBDNDRFrbgAHYM8NOAQLpIoFK1ixAMQKNkhVVQRqq7YpIXGaxPFvxjPYCXQBSGT0Ir1x/OyZN05KIaqq3qRpWZY8OBCRiJI8F8W2WS2XQuRI7DD8Iib6RwwQxbtdkUQNoWcgNkAWyCG5jvTp1woSIEfx+ZgOLvlhZtpGntzR8Q2noi1EZSxaZGVZOdbIznNIDXQp8FbHGpP7JZ8+8lvhyOnRhM7GLFv1MltPN22rXSwIjJVyXVrRWGOB2QcARiThmB8R6ilr9zpZy/kqVJvXZpXLWWGf13pRWgM+k7jVGEgSyghNUtcteMZoliejucj4PTXGZRIKhRZw00DWgLL4ISGgMZhUOnaif0F51tG22Bt03cI3CZdJEy1Iwvc3ensjiYLerR4qnO7iZJJuRgOxmyl1zoQ5dy9iCFqlvVFPKR1d+8MrP6/izUOjbqRrq9uF37/weyM/FfwJXsW31yUTGZIAAAAASUVORK5CYII=\'); background-size: cover; display: block;"\n    >\n      <img\n        class="gatsby-resp-image-image"\n        style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;"\n        alt="2018 11 26 10 07 29"\n        title=""\n        src="/static/2018-11-26-10-07-29-b4670c1a79f7577f8ffd3da66e1b49e8-262af.png"\n        srcset="/static/2018-11-26-10-07-29-b4670c1a79f7577f8ffd3da66e1b49e8-1499b.png 200w,\n/static/2018-11-26-10-07-29-b4670c1a79f7577f8ffd3da66e1b49e8-ea081.png 400w,\n/static/2018-11-26-10-07-29-b4670c1a79f7577f8ffd3da66e1b49e8-262af.png 517w"\n        sizes="(max-width: 517px) 100vw, 517px"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="50462403363906020000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`<html>\n  <script>\n    handlingComposition = () => {\n      this.isCompositionEnd = false;\n    };\n\n    handleComposition = (e) => {\n      this.isCompositionEnd = true;\n      // 以下是解决中文字符在文本框末尾时不赋值的 bug\n      this.setState(e.target.innerHTML, () => {\n        const that = document.getElementById(this.id);\n        selectAllText(that); // 光标跳转到最后\n      });\n    };\n\n    emitChange = (e) => {\n      if (!this.isCompositionEnd) {\n        return; // 直接跳过，不赋值\n      }\n    };\n  </script>\n  <div\n    contenteditable\n    onInput=&quot;{this.emitChange}&quot;\n    onCompositionStart=&quot;{this.handlingComposition}&quot;\n    onCompositionUpdate=&quot;{this.handlingComposition}&quot;\n    onCompositionEnd=&quot;{this.handleComposition}&quot;\n  />\n</html>`, `50462403363906020000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                data-tooltip="复制"\n              >\n                <svg class="gatsby-code-button-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0V0z"/><path d="M16 1H2v16h2V3h12V1zm-1 4l6 6v12H6V5h9zm-1 7h5.5L14 6.5V12z"/></svg>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="html"><pre style="counter-reset: linenumber NaN" class="language-html line-numbers"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">\n    <span class="token function-variable function">handlingComposition</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n      <span class="token keyword">this</span><span class="token punctuation">.</span>isCompositionEnd <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n    <span class="token function-variable function">handleComposition</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n      <span class="token keyword">this</span><span class="token punctuation">.</span>isCompositionEnd <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>\n      <span class="token comment">// 以下是解决中文字符在文本框末尾时不赋值的 bug</span>\n      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>innerHTML<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n        <span class="token keyword">const</span> that <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token function">selectAllText</span><span class="token punctuation">(</span>that<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 光标跳转到最后</span>\n      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n    <span class="token function-variable function">emitChange</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>isCompositionEnd<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        <span class="token keyword">return</span><span class="token punctuation">;</span> <span class="token comment">// 直接跳过，不赋值</span>\n      <span class="token punctuation">}</span>\n    <span class="token punctuation">}</span><span class="token punctuation">;</span>\n  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span>\n    <span class="token attr-name">contenteditable</span>\n    <span class="token attr-name">onInput</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>{this.emitChange}<span class="token punctuation">"</span></span>\n    <span class="token attr-name">onCompositionStart</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>{this.handlingComposition}<span class="token punctuation">"</span></span>\n    <span class="token attr-name">onCompositionUpdate</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>{this.handlingComposition}<span class="token punctuation">"</span></span>\n    <span class="token attr-name">onCompositionEnd</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>{this.handleComposition}<span class="token punctuation">"</span></span>\n  <span class="token punctuation">/></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>暂时遇到这么多问题，以后遇到 bug 再更新</p>\n<p>以上更新于<code class="language-text">2018-11-26 08:55:56</code></p>\n<hr>\n<h1 id="最终解决方案-draft-js"><a href="#%E6%9C%80%E7%BB%88%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88-draft-js" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>最终解决方案 draft-js</h1>\n<h2 id="代码注释"><a href="#%E4%BB%A3%E7%A0%81%E6%B3%A8%E9%87%8A" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>代码注释</h2>\n<p>以上方法有很多未知的 bug，比较明显的问题就是光标会到处乱跑，自己解决起来有太多的坑，故采用业界比较成熟的 <a href="https://github.com/draft-js-plugins/draft-js-plugins" target="_blank" rel="nofollow noreferrer noopener">draft-js-plugins</a>，底层采用 facebook 的开源库 <a href="https://github.com/facebook/draft-js" target="_blank" rel="nofollow noreferrer noopener">draft-js</a>，期间也遇到不少问题，详见代码注释</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="75779368754283170000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`import React from \'react\';\nimport PropTypes from \'prop-types\';\nimport { EditorState } from \'draft-js\';\nimport { convertFromHTML, convertToHTML } from \'draft-convert\';\nimport classnames from \'classnames\';\nimport Editor from \'draft-js-plugins-editor\';\nimport createMentionPlugin, { defaultSuggestionsFilter, defaultTheme } from \'draft-js-mention-plugin\';\nimport \'draft-js-mention-plugin/lib/plugin.css\';\nimport utils from \'utils\';\n\nimport styles from \'./styles.css\';\n// 为了解决ie9下parseFromString(\'\', \'text/html\')的报错\nimport \'./DomParserPloyfill\';\n\nclass GraphHintTextArea extends React.PureComponent {\n  // eslint-disable-line react/prefer-stateless-function\n  constructor(props) {\n    super(props);\n    let theme = {\n      ...defaultTheme,\n      mention: styles.mention\n    };\n    const browser = utils.getBrowserInfo();\n    if (browser.name === \'msie\' && browser.version === \'9\') {\n      theme = {\n        ...defaultTheme,\n        mention: styles.mention,\n        mentionSuggestions: styles.mentionSuggestions\n      };\n    }\n    // 设置mention标签的可变性、触发字符、样式\n    this.mentionPlugin = createMentionPlugin({\n      entityMutability: \'IMMUTABLE\',\n      mentionTrigger: \'\\$\',\n      theme\n    });\n\n    const { value } = this.props;\n    const contentState = convertFromHTML({\n      // 遇到class带有mention的标签进行实体的不可变转化，此时mention即话术变量标签是一体的\n      // 删除只能整个删除，添加也将转化为普通字符\n      // eslint-disable-next-line consistent-return\n      htmlToEntity: (nodeName, node, createEntity) => {\n        if (nodeName === \'span\' && node.className === \'mention\') {\n          const name = node.innerText || \'\';\n          return createEntity(\'\\$mention\', \'IMMUTABLE\', {\n            mention: {\n              name,\n              _id: node.id\n            }\n          });\n        }\n      }\n    })(value);\n\n    this.state = {\n      editorState: EditorState.createWithContent(contentState),\n      suggestions: []\n    };\n  }\n\n  // componentDidMount = () => {\n  //   this.focus();\n  // }\n\n  // https://github.com/facebook/draft-js/issues/1198\n  // 因为此处最开始打算使用componentWillReceiveProps，但在和onChange一起作用时，\n  // 导致多次执行，光标跳到行首，只能采用非受控组件的方式手动调用\n  setEditorContent(text) {\n    const contentState = convertFromHTML({\n      // eslint-disable-next-line consistent-return\n      htmlToEntity: (nodeName, node, createEntity) => {\n        if (nodeName === \'span\' && node.className === \'mention\') {\n          const name = node.innerText || \'\';\n          return createEntity(\'\\$mention\', \'IMMUTABLE\', {\n            mention: {\n              name,\n              _id: node.id\n            }\n          });\n        }\n      }\n    })(text);\n    const { editorState } = this.state;\n    // 这里必须用push方法，不然会导致编辑器提示框不能弹出\n    // https://github.com/draft-js-plugins/draft-js-plugins/issues/210\n    const newEditorState = EditorState.push(editorState, contentState);\n    this.setState({\n      editorState: newEditorState\n    });\n  }\n\n  // https://github.com/draft-js-plugins/draft-js-plugins/issues/800\n  // 不能直接调用focus，否则会造成draft-js-mention-plugin的失效\n  // focus = () => {\n  //   setTimeout(() => {\n  //     this.editor.focus();\n  //   }, 0);\n  // }\n\n  handleChange = (editorState) => {\n    const contentState = editorState.getCurrentContent();\n    const pureText = this.convertToPureText(contentState);\n    // 暂时不能阻挡非受控组件的输入\n    // const { maxLength } = this.props;\n    // if (pureText.length > maxLength) {\n    //   return;\n    // }\n    this.setState(\n      {\n        editorState\n      },\n      () => {\n        this.triggerChange(contentState, pureText);\n      }\n    );\n  };\n\n  handleSearchChange = ({ value }) => {\n    const { hints } = this.props;\n    this.setState({\n      suggestions: defaultSuggestionsFilter(value, hints)\n    });\n  };\n\n  // 这里是转成看到标签的效果，目的是得到实际字符\n  convertToPureText = (contentState) => {\n    let htmlToPureText = convertToHTML({\n      // eslint-disable-next-line consistent-return\n      blockToHTML: (data) => {\n        const { type } = data;\n        if (type === \'unstyled\') {\n          return {\n            start: \'\',\n            end: \'\',\n            empty: \'\'\n          };\n        }\n      }\n    })(contentState);\n    htmlToPureText = htmlToPureText.replace(/<\\/?.+?\\/?>|\\s+/g, \'\');\n    return htmlToPureText;\n  };\n\n  // 这里是转成要传给后端的效果\n  triggerChange = (contentState, pureText) => {\n    const { onChange } = this.props;\n    let html = convertToHTML({\n      // 将遇到的实体标签转化为\\${id}，以便后端进行处理\n      entityToHTML: (entity, originalText) => {\n        if (entity.type === \'\\$mention\') {\n          return \\`\\$\\{\\${entity.data.mention._id}}\\`;\n        }\n        return originalText;\n      },\n      // 语音合成需求要求，去除所有换行，即所有无用标签p，否则会读出标签p\n      // https://github.com/HubSpot/draft-convert/issues/59\n      // eslint-disable-next-line consistent-return\n      blockToHTML: (data) => {\n        const { type } = data;\n        if (type === \'unstyled\') {\n          return {\n            start: \'\',\n            end: \'\',\n            // empty属性代表所有换行都去掉，而不是转为空格\n            empty: \'\'\n          };\n        }\n      }\n    })(contentState);\n    // 语音合成需求要求，去掉所有空白字符（包含空格、制表符、换页符）和html标签（包含<div class=&quot;test&quot;></div>、<img />、<My-Tag></My-Tag>这几种）\n    html = html.replace(/<\\/?.+?\\/?>|\\s+/g, \'\');\n    if (typeof onChange === \'function\') {\n      onChange(html, pureText);\n    }\n    return html;\n  };\n\n  handleFocus = () => {\n    const { onFocus } = this.props;\n    if (typeof onFocus === \'function\') {\n      onFocus();\n    }\n  };\n\n  handleBlur = () => {\n    const { onBlur } = this.props;\n    if (typeof onBlur === \'function\') {\n      onBlur();\n    }\n  };\n\n  render() {\n    const { placeholder, className } = this.props;\n    const { MentionSuggestions } = this.mentionPlugin;\n    const plugins = [this.mentionPlugin];\n    return (\n      <div className={classnames(styles.editor, className)}>\n        <Editor\n          editorState={this.state.editorState}\n          onChange={this.handleChange}\n          plugins={plugins}\n          placeholder={placeholder}\n          onFocus={this.handleFocus}\n          onBlur={this.handleBlur}\n          ref={(r) => {\n            this.editor = r;\n          }}\n        />\n        <MentionSuggestions onSearchChange={this.handleSearchChange} suggestions={this.state.suggestions} />\n      </div>\n    );\n  }\n}\n\nGraphHintTextArea.propTypes = {\n  placeholder: PropTypes.string,\n  onChange: PropTypes.func,\n  value: PropTypes.string,\n  hints: PropTypes.array,\n  className: PropTypes.string,\n  onFocus: PropTypes.func,\n  onBlur: PropTypes.func\n};\n\nexport default GraphHintTextArea;`, `75779368754283170000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                data-tooltip="复制"\n              >\n                <svg class="gatsby-code-button-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0V0z"/><path d="M16 1H2v16h2V3h12V1zm-1 4l6 6v12H6V5h9zm-1 7h5.5L14 6.5V12z"/></svg>\n              </div>\n            </div>\n<div class="gatsby-highlight has-highlighted-lines" data-language="jsx"><pre style="counter-reset: linenumber NaN" class="language-jsx line-numbers"><code class="language-jsx"><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">\'react\'</span><span class="token punctuation">;</span>\n<span class="token keyword">import</span> PropTypes <span class="token keyword">from</span> <span class="token string">\'prop-types\'</span><span class="token punctuation">;</span>\n<span class="token keyword">import</span> <span class="token punctuation">{</span> EditorState <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">\'draft-js\'</span><span class="token punctuation">;</span>\n<span class="token keyword">import</span> <span class="token punctuation">{</span> convertFromHTML<span class="token punctuation">,</span> convertToHTML <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">\'draft-convert\'</span><span class="token punctuation">;</span>\n<span class="token keyword">import</span> classnames <span class="token keyword">from</span> <span class="token string">\'classnames\'</span><span class="token punctuation">;</span>\n<span class="token keyword">import</span> Editor <span class="token keyword">from</span> <span class="token string">\'draft-js-plugins-editor\'</span><span class="token punctuation">;</span>\n<span class="token keyword">import</span> createMentionPlugin<span class="token punctuation">,</span> <span class="token punctuation">{</span> defaultSuggestionsFilter<span class="token punctuation">,</span> defaultTheme <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">\'draft-js-mention-plugin\'</span><span class="token punctuation">;</span>\n<span class="token keyword">import</span> <span class="token string">\'draft-js-mention-plugin/lib/plugin.css\'</span><span class="token punctuation">;</span>\n<span class="token keyword">import</span> utils <span class="token keyword">from</span> <span class="token string">\'utils\'</span><span class="token punctuation">;</span>\n\n<span class="token keyword">import</span> styles <span class="token keyword">from</span> <span class="token string">\'./styles.css\'</span><span class="token punctuation">;</span>\n<span class="gatsby-highlight-code-line"><span class="token comment">// 为了解决ie9下parseFromString(\'\', \'text/html\')的报错</span></span><span class="gatsby-highlight-code-line"><span class="token keyword">import</span> <span class="token string">\'./DomParserPloyfill\'</span><span class="token punctuation">;</span></span>\n<span class="token keyword">class</span> <span class="token class-name">GraphHintTextArea</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>PureComponent</span> <span class="token punctuation">{</span>\n  <span class="token comment">// eslint-disable-line react/prefer-stateless-function</span>\n  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">super</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">let</span> theme <span class="token operator">=</span> <span class="token punctuation">{</span>\n      <span class="token operator">...</span>defaultTheme<span class="token punctuation">,</span>\n      mention<span class="token punctuation">:</span> styles<span class="token punctuation">.</span>mention\n    <span class="token punctuation">}</span><span class="token punctuation">;</span>\n<span class="gatsby-highlight-code-line">    <span class="token keyword">const</span> browser <span class="token operator">=</span> utils<span class="token punctuation">.</span><span class="token function">getBrowserInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><span class="gatsby-highlight-code-line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>browser<span class="token punctuation">.</span>name <span class="token operator">===</span> <span class="token string">\'msie\'</span> <span class="token operator">&amp;&amp;</span> browser<span class="token punctuation">.</span>version <span class="token operator">===</span> <span class="token string">\'9\'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span><span class="gatsby-highlight-code-line">      theme <span class="token operator">=</span> <span class="token punctuation">{</span></span><span class="gatsby-highlight-code-line">        <span class="token operator">...</span>defaultTheme<span class="token punctuation">,</span></span><span class="gatsby-highlight-code-line">        mention<span class="token punctuation">:</span> styles<span class="token punctuation">.</span>mention<span class="token punctuation">,</span></span><span class="gatsby-highlight-code-line">        mentionSuggestions<span class="token punctuation">:</span> styles<span class="token punctuation">.</span>mentionSuggestions</span><span class="gatsby-highlight-code-line">      <span class="token punctuation">}</span><span class="token punctuation">;</span></span>    <span class="token punctuation">}</span>\n    <span class="token comment">// 设置mention标签的可变性、触发字符、样式</span>\n    <span class="token keyword">this</span><span class="token punctuation">.</span>mentionPlugin <span class="token operator">=</span> <span class="token function">createMentionPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n      entityMutability<span class="token punctuation">:</span> <span class="token string">\'IMMUTABLE\'</span><span class="token punctuation">,</span>\n      mentionTrigger<span class="token punctuation">:</span> <span class="token string">\'$\'</span><span class="token punctuation">,</span>\n      theme\n    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">const</span> <span class="token punctuation">{</span> value <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">;</span>\n    <span class="token keyword">const</span> contentState <span class="token operator">=</span> <span class="token function">convertFromHTML</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n      <span class="token comment">// 遇到class带有mention的标签进行实体的不可变转化，此时mention即话术变量标签是一体的</span>\n      <span class="token comment">// 删除只能整个删除，添加也将转化为普通字符</span>\n      <span class="token comment">// eslint-disable-next-line consistent-return</span>\n      <span class="token function-variable function">htmlToEntity</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token parameter">nodeName<span class="token punctuation">,</span> node<span class="token punctuation">,</span> createEntity</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n        <span class="token keyword">if</span> <span class="token punctuation">(</span>nodeName <span class="token operator">===</span> <span class="token string">\'span\'</span> <span class="token operator">&amp;&amp;</span> node<span class="token punctuation">.</span>className <span class="token operator">===</span> <span class="token string">\'mention\'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n          <span class="token keyword">const</span> name <span class="token operator">=</span> node<span class="token punctuation">.</span>innerText <span class="token operator">||</span> <span class="token string">\'\'</span><span class="token punctuation">;</span>\n          <span class="token keyword">return</span> <span class="token function">createEntity</span><span class="token punctuation">(</span><span class="token string">\'$mention\'</span><span class="token punctuation">,</span> <span class="token string">\'IMMUTABLE\'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>\n            mention<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n              name<span class="token punctuation">,</span>\n              _id<span class="token punctuation">:</span> node<span class="token punctuation">.</span>id\n            <span class="token punctuation">}</span>\n          <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token punctuation">}</span>\n      <span class="token punctuation">}</span>\n    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token punctuation">{</span>\n      editorState<span class="token punctuation">:</span> EditorState<span class="token punctuation">.</span><span class="token function">createWithContent</span><span class="token punctuation">(</span>contentState<span class="token punctuation">)</span><span class="token punctuation">,</span>\n      suggestions<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>\n    <span class="token punctuation">}</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n\n  <span class="token comment">// componentDidMount = () => {</span>\n  <span class="token comment">//   this.focus();</span>\n  <span class="token comment">// }</span>\n\n  <span class="token comment">// https://github.com/facebook/draft-js/issues/1198</span>\n  <span class="token comment">// 因为此处最开始打算使用componentWillReceiveProps，但在和onChange一起作用时，</span>\n  <span class="token comment">// 导致多次执行，光标跳到行首，只能采用非受控组件的方式手动调用</span>\n  <span class="token function">setEditorContent</span><span class="token punctuation">(</span><span class="token parameter">text</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">const</span> contentState <span class="token operator">=</span> <span class="token function">convertFromHTML</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n      <span class="token comment">// eslint-disable-next-line consistent-return</span>\n      <span class="token function-variable function">htmlToEntity</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token parameter">nodeName<span class="token punctuation">,</span> node<span class="token punctuation">,</span> createEntity</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n        <span class="token keyword">if</span> <span class="token punctuation">(</span>nodeName <span class="token operator">===</span> <span class="token string">\'span\'</span> <span class="token operator">&amp;&amp;</span> node<span class="token punctuation">.</span>className <span class="token operator">===</span> <span class="token string">\'mention\'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n          <span class="token keyword">const</span> name <span class="token operator">=</span> node<span class="token punctuation">.</span>innerText <span class="token operator">||</span> <span class="token string">\'\'</span><span class="token punctuation">;</span>\n          <span class="token keyword">return</span> <span class="token function">createEntity</span><span class="token punctuation">(</span><span class="token string">\'$mention\'</span><span class="token punctuation">,</span> <span class="token string">\'IMMUTABLE\'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>\n            mention<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n              name<span class="token punctuation">,</span>\n              _id<span class="token punctuation">:</span> node<span class="token punctuation">.</span>id\n            <span class="token punctuation">}</span>\n          <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token punctuation">}</span>\n      <span class="token punctuation">}</span>\n    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">const</span> <span class="token punctuation">{</span> editorState <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">;</span>\n    <span class="token comment">// 这里必须用push方法，不然会导致编辑器提示框不能弹出</span>\n    <span class="token comment">// https://github.com/draft-js-plugins/draft-js-plugins/issues/210</span>\n    <span class="token keyword">const</span> newEditorState <span class="token operator">=</span> EditorState<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>editorState<span class="token punctuation">,</span> contentState<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n      editorState<span class="token punctuation">:</span> newEditorState\n    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n\n  <span class="token comment">// https://github.com/draft-js-plugins/draft-js-plugins/issues/800</span>\n  <span class="token comment">// 不能直接调用focus，否则会造成draft-js-mention-plugin的失效</span>\n  <span class="token comment">// focus = () => {</span>\n  <span class="token comment">//   setTimeout(() => {</span>\n  <span class="token comment">//     this.editor.focus();</span>\n  <span class="token comment">//   }, 0);</span>\n  <span class="token comment">// }</span>\n\n  <span class="token function-variable function">handleChange</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">editorState</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n    <span class="token keyword">const</span> contentState <span class="token operator">=</span> editorState<span class="token punctuation">.</span><span class="token function">getCurrentContent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">const</span> pureText <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">convertToPureText</span><span class="token punctuation">(</span>contentState<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token comment">// 暂时不能阻挡非受控组件的输入</span>\n    <span class="token comment">// const { maxLength } = this.props;</span>\n    <span class="token comment">// if (pureText.length > maxLength) {</span>\n    <span class="token comment">//   return;</span>\n    <span class="token comment">// }</span>\n    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span>\n      <span class="token punctuation">{</span>\n        editorState\n      <span class="token punctuation">}</span><span class="token punctuation">,</span>\n      <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">triggerChange</span><span class="token punctuation">(</span>contentState<span class="token punctuation">,</span> pureText<span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span>\n    <span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n  <span class="token function-variable function">handleSearchChange</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> value <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n    <span class="token keyword">const</span> <span class="token punctuation">{</span> hints <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">;</span>\n    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n      suggestions<span class="token punctuation">:</span> <span class="token function">defaultSuggestionsFilter</span><span class="token punctuation">(</span>value<span class="token punctuation">,</span> hints<span class="token punctuation">)</span>\n    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n  <span class="token comment">// 这里是转成看到标签的效果，目的是得到实际字符</span>\n  <span class="token function-variable function">convertToPureText</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">contentState</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> htmlToPureText <span class="token operator">=</span> <span class="token function">convertToHTML</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n      <span class="token comment">// eslint-disable-next-line consistent-return</span>\n      <span class="token function-variable function">blockToHTML</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n        <span class="token keyword">const</span> <span class="token punctuation">{</span> type <span class="token punctuation">}</span> <span class="token operator">=</span> data<span class="token punctuation">;</span>\n        <span class="token keyword">if</span> <span class="token punctuation">(</span>type <span class="token operator">===</span> <span class="token string">\'unstyled\'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n          <span class="token keyword">return</span> <span class="token punctuation">{</span>\n            start<span class="token punctuation">:</span> <span class="token string">\'\'</span><span class="token punctuation">,</span>\n            end<span class="token punctuation">:</span> <span class="token string">\'\'</span><span class="token punctuation">,</span>\n            empty<span class="token punctuation">:</span> <span class="token string">\'\'</span>\n          <span class="token punctuation">}</span><span class="token punctuation">;</span>\n        <span class="token punctuation">}</span>\n      <span class="token punctuation">}</span>\n    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span>contentState<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    htmlToPureText <span class="token operator">=</span> htmlToPureText<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex">/&lt;\\/?.+?\\/?>|\\s+/g</span><span class="token punctuation">,</span> <span class="token string">\'\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">return</span> htmlToPureText<span class="token punctuation">;</span>\n  <span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n  <span class="token comment">// 这里是转成要传给后端的效果</span>\n  <span class="token function-variable function">triggerChange</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">contentState<span class="token punctuation">,</span> pureText</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n    <span class="token keyword">const</span> <span class="token punctuation">{</span> onChange <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">;</span>\n    <span class="token keyword">let</span> html <span class="token operator">=</span> <span class="token function">convertToHTML</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n      <span class="token comment">// 将遇到的实体标签转化为${id}，以便后端进行处理</span>\n      <span class="token function-variable function">entityToHTML</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token parameter">entity<span class="token punctuation">,</span> originalText</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n        <span class="token keyword">if</span> <span class="token punctuation">(</span>entity<span class="token punctuation">.</span>type <span class="token operator">===</span> <span class="token string">\'$mention\'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n          <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">$\\{</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>entity<span class="token punctuation">.</span>data<span class="token punctuation">.</span>mention<span class="token punctuation">.</span>_id<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">}</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>\n        <span class="token punctuation">}</span>\n        <span class="token keyword">return</span> originalText<span class="token punctuation">;</span>\n      <span class="token punctuation">}</span><span class="token punctuation">,</span>\n      <span class="token comment">// 语音合成需求要求，去除所有换行，即所有无用标签p，否则会读出标签p</span>\n      <span class="token comment">// https://github.com/HubSpot/draft-convert/issues/59</span>\n      <span class="token comment">// eslint-disable-next-line consistent-return</span>\n      <span class="token function-variable function">blockToHTML</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n        <span class="token keyword">const</span> <span class="token punctuation">{</span> type <span class="token punctuation">}</span> <span class="token operator">=</span> data<span class="token punctuation">;</span>\n        <span class="token keyword">if</span> <span class="token punctuation">(</span>type <span class="token operator">===</span> <span class="token string">\'unstyled\'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n          <span class="token keyword">return</span> <span class="token punctuation">{</span>\n            start<span class="token punctuation">:</span> <span class="token string">\'\'</span><span class="token punctuation">,</span>\n            end<span class="token punctuation">:</span> <span class="token string">\'\'</span><span class="token punctuation">,</span>\n            <span class="token comment">// empty属性代表所有换行都去掉，而不是转为空格</span>\n            empty<span class="token punctuation">:</span> <span class="token string">\'\'</span>\n          <span class="token punctuation">}</span><span class="token punctuation">;</span>\n        <span class="token punctuation">}</span>\n      <span class="token punctuation">}</span>\n    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span>contentState<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token comment">// 语音合成需求要求，去掉所有空白字符（包含空格、制表符、换页符）和html标签（包含&lt;div class="test">&lt;/div>、&lt;img />、&lt;My-Tag>&lt;/My-Tag>这几种）</span>\n    html <span class="token operator">=</span> html<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex">/&lt;\\/?.+?\\/?>|\\s+/g</span><span class="token punctuation">,</span> <span class="token string">\'\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> onChange <span class="token operator">===</span> <span class="token string">\'function\'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token function">onChange</span><span class="token punctuation">(</span>html<span class="token punctuation">,</span> pureText<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n    <span class="token keyword">return</span> html<span class="token punctuation">;</span>\n  <span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n  <span class="token function-variable function">handleFocus</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n    <span class="token keyword">const</span> <span class="token punctuation">{</span> onFocus <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">;</span>\n    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> onFocus <span class="token operator">===</span> <span class="token string">\'function\'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token function">onFocus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n  <span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n  <span class="token function-variable function">handleBlur</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n    <span class="token keyword">const</span> <span class="token punctuation">{</span> onBlur <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">;</span>\n    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> onBlur <span class="token operator">===</span> <span class="token string">\'function\'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token function">onBlur</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n  <span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">const</span> <span class="token punctuation">{</span> placeholder<span class="token punctuation">,</span> className <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">;</span>\n    <span class="token keyword">const</span> <span class="token punctuation">{</span> MentionSuggestions <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>mentionPlugin<span class="token punctuation">;</span>\n    <span class="token keyword">const</span> plugins <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token keyword">this</span><span class="token punctuation">.</span>mentionPlugin<span class="token punctuation">]</span><span class="token punctuation">;</span>\n    <span class="token keyword">return</span> <span class="token punctuation">(</span>\n      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">className</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token function">classnames</span><span class="token punctuation">(</span>styles<span class="token punctuation">.</span>editor<span class="token punctuation">,</span> className<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token punctuation">></span></span><span class="token plain-text"></span>\n<span class="token plain-text">        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Editor</span></span>\n          <span class="token attr-name">editorState</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>editorState<span class="token punctuation">}</span></span>\n          <span class="token attr-name">onChange</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>handleChange<span class="token punctuation">}</span></span>\n          <span class="token attr-name">plugins</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>plugins<span class="token punctuation">}</span></span>\n          <span class="token attr-name">placeholder</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>placeholder<span class="token punctuation">}</span></span>\n          <span class="token attr-name">onFocus</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>handleFocus<span class="token punctuation">}</span></span>\n          <span class="token attr-name">onBlur</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>handleBlur<span class="token punctuation">}</span></span>\n          <span class="token attr-name">ref</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token parameter">r</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n            <span class="token keyword">this</span><span class="token punctuation">.</span>editor <span class="token operator">=</span> r<span class="token punctuation">;</span>\n          <span class="token punctuation">}</span><span class="token punctuation">}</span></span>\n        <span class="token punctuation">/></span></span><span class="token plain-text"></span>\n<span class="token plain-text">        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">MentionSuggestions</span></span> <span class="token attr-name">onSearchChange</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>handleSearchChange<span class="token punctuation">}</span></span> <span class="token attr-name">suggestions</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>suggestions<span class="token punctuation">}</span></span> <span class="token punctuation">/></span></span><span class="token plain-text"></span>\n<span class="token plain-text">      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>\n    <span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n\nGraphHintTextArea<span class="token punctuation">.</span>propTypes <span class="token operator">=</span> <span class="token punctuation">{</span>\n  placeholder<span class="token punctuation">:</span> PropTypes<span class="token punctuation">.</span>string<span class="token punctuation">,</span>\n  onChange<span class="token punctuation">:</span> PropTypes<span class="token punctuation">.</span>func<span class="token punctuation">,</span>\n  value<span class="token punctuation">:</span> PropTypes<span class="token punctuation">.</span>string<span class="token punctuation">,</span>\n  hints<span class="token punctuation">:</span> PropTypes<span class="token punctuation">.</span>array<span class="token punctuation">,</span>\n  className<span class="token punctuation">:</span> PropTypes<span class="token punctuation">.</span>string<span class="token punctuation">,</span>\n  onFocus<span class="token punctuation">:</span> PropTypes<span class="token punctuation">.</span>func<span class="token punctuation">,</span>\n  onBlur<span class="token punctuation">:</span> PropTypes<span class="token punctuation">.</span>func\n<span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n<span class="token keyword">export</span> <span class="token keyword">default</span> GraphHintTextArea<span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>效果如下：</p>\n<p>\n  <a\n    class="gatsby-resp-image-link"\n    href="/static/2019-02-13-20-25-26-c7c9f642535351288665d3e4f1a6baa7-91452.png"\n    style="display: block"\n    target="_blank"\n    rel="noopener"\n  >\n  \n  <span\n    class="gatsby-resp-image-wrapper"\n    style="position: relative; display: block; ; max-width: 521px; margin-left: auto; margin-right: auto;"\n  >\n    <span\n      class="gatsby-resp-image-background-image"\n      style="padding-bottom: 61.42034548944337%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAIAAADtbgqsAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABOUlEQVQoz42SS1LDMAyGcySOwe1Ys2HZy3TFY90FTV9JhySOI/kp8SfpQGlhqEbj0dj6ZP2yCyZqmqZr2+1m23ZGVUVE/7M8WUFEXdP2nTkc9r21N8NphJk5qUbRLJqy+CQu3uAJ+VKYwVXVx7Gu3xtZllq2yTGhUEwoLueO7DzdMZ5mBT/CIaYYg49qvbKPgL33+cJQK8XvtkX9DE8STzpRprcDMc8ZoifHtSGEP+F5JR9XlX1d7VYV7axujGx7hSOwfAV3g0ujjJMetF23tD40R+NsUOOk9wpHAH1zjnxpJnY+owzmrC4CDsxUV3uiYeonz40jIBcAwAnTiSNfOOfOHxCasQN5WPmn4ejitQsM9voPiPzyUzDy4B2F/PSiD0t9q6G568C7G8yYfleu13V/v+C7x2HxzJ+1K7veUJ4W1gAAAABJRU5ErkJggg==\'); background-size: cover; display: block;"\n    >\n      <img\n        class="gatsby-resp-image-image"\n        style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;"\n        alt="2019 02 13 20 25 26"\n        title=""\n        src="/static/2019-02-13-20-25-26-c7c9f642535351288665d3e4f1a6baa7-91452.png"\n        srcset="/static/2019-02-13-20-25-26-c7c9f642535351288665d3e4f1a6baa7-e8fc4.png 200w,\n/static/2019-02-13-20-25-26-c7c9f642535351288665d3e4f1a6baa7-c0ace.png 400w,\n/static/2019-02-13-20-25-26-c7c9f642535351288665d3e4f1a6baa7-91452.png 521w"\n        sizes="(max-width: 521px) 100vw, 521px"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<h2 id="兼容性问题"><a href="#%E5%85%BC%E5%AE%B9%E6%80%A7%E9%97%AE%E9%A2%98" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>兼容性问题</h2>\n<p>这里遇到两个兼容性问题，如以上代码高亮部分</p>\n<ul>\n<li>在 IE9 下 draft-js 源码里面的 <code class="language-text">parseFromString(&#39;&#39;, &#39;text/html&#39;)</code> 会报错，引入一段兼容代码如下</li>\n</ul>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="45033410609918460000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`/*\n * DOMParser HTML extension\n * 2012-09-04\n *\n * By Eli Grey, http://eligrey.com\n * Public domain.\n * NO WARRANTY EXPRESSED OR IMPLIED. USE AT YOUR OWN RISK.\n */\n\n/*! @source https://gist.github.com/1129031 */\n/* global document, DOMParser*/\n\n// eslint-disable-next-line func-names\n(function(DOMParser) {\n  // eslint-disable-next-line\n  const DOMParser_proto = DOMParser.prototype,\n    real_parseFromString = DOMParser_proto.parseFromString;\n  // Firefox/Opera/IE throw errors on unsupported types\n  try {\n    // WebKit returns null on unsupported types\n    if (new DOMParser().parseFromString(\'\', \'text/html\')) {\n      // text/html parsing is natively supported\n      return;\n    }\n    // eslint-disable-next-line no-empty\n  } catch (ex) {}\n\n  // eslint-disable-next-line func-names\n  DOMParser_proto.parseFromString = function(markup, type) {\n    if (/^\\s*text\\/html\\s*(?:;|\\$)/i.test(type)) {\n      const doc = document.implementation.createHTMLDocument(\'\');\n      if (markup.toLowerCase().indexOf(\'<!doctype\') > -1) {\n        doc.documentElement.innerHTML = markup;\n      } else {\n        doc.body.innerHTML = markup;\n      }\n      return doc;\n      // eslint-disable-next-line no-else-return\n    } else {\n      // eslint-disable-next-line prefer-rest-params\n      return real_parseFromString.apply(this, arguments);\n    }\n  };\n})(DOMParser);`, `45033410609918460000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                data-tooltip="复制"\n              >\n                <svg class="gatsby-code-button-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0V0z"/><path d="M16 1H2v16h2V3h12V1zm-1 4l6 6v12H6V5h9zm-1 7h5.5L14 6.5V12z"/></svg>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">/*\n * DOMParser HTML extension\n * 2012-09-04\n *\n * By Eli Grey, http://eligrey.com\n * Public domain.\n * NO WARRANTY EXPRESSED OR IMPLIED. USE AT YOUR OWN RISK.\n */</span>\n\n<span class="token comment">/*! @source https://gist.github.com/1129031 */</span>\n<span class="token comment">/* global document, DOMParser*/</span>\n\n<span class="token comment">// eslint-disable-next-line func-names</span>\n<span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">DOMParser</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token comment">// eslint-disable-next-line</span>\n  <span class="token keyword">const</span> DOMParser_proto <span class="token operator">=</span> <span class="token class-name">DOMParser</span><span class="token punctuation">.</span>prototype<span class="token punctuation">,</span>\n    real_parseFromString <span class="token operator">=</span> DOMParser_proto<span class="token punctuation">.</span>parseFromString<span class="token punctuation">;</span>\n  <span class="token comment">// Firefox/Opera/IE throw errors on unsupported types</span>\n  <span class="token keyword">try</span> <span class="token punctuation">{</span>\n    <span class="token comment">// WebKit returns null on unsupported types</span>\n    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">DOMParser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">parseFromString</span><span class="token punctuation">(</span><span class="token string">\'\'</span><span class="token punctuation">,</span> <span class="token string">\'text/html\'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token comment">// text/html parsing is natively supported</span>\n      <span class="token keyword">return</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n    <span class="token comment">// eslint-disable-next-line no-empty</span>\n  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>ex<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>\n\n  <span class="token comment">// eslint-disable-next-line func-names</span>\n  DOMParser_proto<span class="token punctuation">.</span><span class="token function-variable function">parseFromString</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">markup<span class="token punctuation">,</span> type</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token regex">/^\\s*text\\/html\\s*(?:;|$)/i</span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>type<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token keyword">const</span> doc <span class="token operator">=</span> document<span class="token punctuation">.</span>implementation<span class="token punctuation">.</span><span class="token function">createHTMLDocument</span><span class="token punctuation">(</span><span class="token string">\'\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token keyword">if</span> <span class="token punctuation">(</span>markup<span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">\'&lt;!doctype\'</span><span class="token punctuation">)</span> <span class="token operator">></span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        doc<span class="token punctuation">.</span>documentElement<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> markup<span class="token punctuation">;</span>\n      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>\n        doc<span class="token punctuation">.</span>body<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> markup<span class="token punctuation">;</span>\n      <span class="token punctuation">}</span>\n      <span class="token keyword">return</span> doc<span class="token punctuation">;</span>\n      <span class="token comment">// eslint-disable-next-line no-else-return</span>\n    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>\n      <span class="token comment">// eslint-disable-next-line prefer-rest-params</span>\n      <span class="token keyword">return</span> <span class="token function">real_parseFromString</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> arguments<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n  <span class="token punctuation">}</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span>DOMParser<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<ul>\n<li>IE9 下不能弹出下拉框，这里查看了源码发现了是 IE9 transfrom 属性需要兼容下 IE9，去掉 transfrom 变换或者添加 -ms 前缀</li>\n</ul>',
id:"/github/workspace/blog/富文本框疑难点处理过程/index.md absPath of file >>> MarkdownRemark",timeToRead:9,frontmatter:{date:"2019-02-13 20:13:58",path:"/rich-input-question/",tags:"前端, 富文本框, contenteditable, 预研",title:"富文本框疑难点处理过程",draft:null}},{excerpt:"需求背景 解决 react-player 控件在 IE 浏览器下声音的播放 核心思路 ReactPlayer 底层调用了 audio 标签来播放音频，video 标签来播放视频，因为在 IE 浏览器下是没有 audio 标签的，所以使用了 embed 标签，其在 IE 下是调用 windows media player，关于其用法如下 功能 播放: MediaPlayer.Play() 暂停: MediaPlayer.Pause() 定位: MediaPlayer.SetCurrentEntry…",html:'<h1 id="需求背景"><a href="#%E9%9C%80%E6%B1%82%E8%83%8C%E6%99%AF" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>需求背景</h1>\n<p>解决 react-player 控件在 IE 浏览器下声音的播放</p>\n<h1 id="核心思路"><a href="#%E6%A0%B8%E5%BF%83%E6%80%9D%E8%B7%AF" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>核心思路</h1>\n<p>ReactPlayer 底层调用了 audio 标签来播放音频，video 标签来播放视频，因为在 IE 浏览器下是没有 audio 标签的，所以使用了 embed 标签，其在 IE 下是调用 windows media player，关于其用法如下</p>\n<h2 id="功能"><a href="#%E5%8A%9F%E8%83%BD" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>功能</h2>\n<blockquote>\n<p>播放: MediaPlayer.Play()<br>\n暂停: MediaPlayer.Pause()<br>\n定位:</p>\n<ul>\n<li>MediaPlayer.SetCurrentEntry(lWhichEntry)</li>\n<li>MediaPlayer.Next()</li>\n<li>MediaPlayer.Previous()</li>\n</ul>\n<p>循环: MediaPlayer.PlayCount = 0</p>\n<ul>\n<li>0: the clip plays repeatedly</li>\n<li>1: once</li>\n</ul>\n<p>停止: MediaPlayer.Stop()</p>\n</blockquote>\n<h2 id="属性"><a href="#%E5%B1%9E%E6%80%A7" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>属性</h2>\n<blockquote>\n<p>AllowChangeDisplaySize 返回或设置最终用户是否能设置显示尺寸(逻辑型)<br>\nAllowScan 返回或设置是否允许扫描(逻辑型)<br>\nAnimationAtStart 返回或设置控件开始播放之前是否先播放一个动画序列(逻辑型)<br>\nAudioStream 返回或设置音频流的编号(用于多音频流的剪辑，默认为-1)(长整型)<br>\nAutoRewind 返回或设置媒体文件播放完毕后是否自动回绕(逻辑型)<br>\nAutoSize 返回或设置是否自动调整控件大小来适应载入的媒体(逻辑型)<br>\nAutoStart 返回或设置在载入媒体文件之后是否自动开始播放(逻辑型)<br>\nBalance 返回或设置指定立体声媒体文件的播放声道(-10000 为左声道，10000 为右声道，0 为立体声)(长整型)<br>\nBandwidth 返回或设置当前文件的带宽(长整型)<br>\nBaseURL 返回基本的 HTTP URL(字符串)<br>\nBufferingCount 返回媒体文件回放时缓冲的总时间(长整型)<br>\nBufferingProgress 返回缓冲完成的百分比(长整型)<br>\nBufferingTime 返回缓冲的时间(双精度型)<br>\nCanPreview 返回或设置当前显示的剪辑是能否被预览(逻辑型)<br>\nCanScan 返回或设置当前文件是否支持快进或快退(逻辑型)<br>\nCanSeek 返回或设置当前文件是否能搜索并定位到某个时间(逻辑型)<br>\nCanSeekToMarkers 返回或设置文件是否支持搜索到标签(逻辑型)<br>\nCaptioningID 返回在标题中显示的帧或控件的名称(字符串)<br>\nChannelDescription 返回电台的描述(字符串)<br>\nChannelName 返回电台的名称(字符串)<br>\nChannelURL 返回电台的元文件的位置(字符串)<br>\nClickToPlay 返回或设置是否可以通过点击图像暂停或播放剪辑(逻辑型)<br>\nClientID 返回客户端唯一的标识符(字符串)<br>\nCodecCount 返回文件使用的可安装的 codecs 的个数(长整型)<br>\nContactAddress 返回电台的联系地址(字符串)<br>\nContactEmail 返回电台的联系电子邮件地址(字符串)<br>\nContactPhone 返回电台的联系电话(字符串)<br>\nCreationDate 返回剪辑的创建日期(日期型)<br>\nCurrentMarker 返回或设置当前书签号码(长整型)<br>\nCurrentPosition 返回或设置剪辑的当前位置(双精度型)<br>\nCursorType 返回或设置指针类型(长整型)<br>\nDefaultFrame 返回或设置控件的默认目标 Http 帧(字符串)<br>\nDisplayBackColor 返回或设置显示面板的背景色(OLE<em>COLOR 值)<br>\nDisplayForeColor 返回或设置显示面板的前景色(OLE_COLOR 值)<br>\nDisplayMode 返回或设置显示面板是否用秒或帧的形式显示当前位置(MPDisplayModeConstants 值)<br>\nDisplaySize 返回或设置图像显示窗口的大小(MPDisplaySizeConstant 值)<br>\nDuration 返回或设置剪辑剪辑的播放时间(双精度型)<br>\nEnableContextMenu 返回或设置是否允许使用上下文菜单(逻辑型)<br>\nEnabled 返回或设置控件是否可用(逻辑型)<br>\nEnableFullScreenControls 返回或设置全屏幕控制是否可用(逻辑型)<br>\nEnablePositionControls 返回或设置位置控制是否可用(逻辑型)<br>\nEnableTracker 返回或设置搜索栏控制是否可用(逻辑型)<br>\nErrorCode 返回当前错误代码(长整型)<br>\nErrorCorrection 返回当前剪辑的错误修正类型(长整型)<br>\nErrorDescription 返回当前错误的描述(字符串)<br>\nFileName 返回或设置要播放的剪辑的文件名称(字符串)<br>\nHasError 返回控件是否发生错误(逻辑型)<br>\nHasMultipleItems 返回或设置控件是否包含某些多重项目的内容(逻辑型)<br>\nImageSourceHeight 返回或设置当前剪辑的原始图像高度(长整型)<br>\nImageSourceWidth 返回或设置当前剪辑的原始图像宽度(长整型)<br>\nInvokeURLs 返回或设置 URL 是否自动发送请求(逻辑型)<br>\nIsBroadcast 返回或设置源是否进行广播(逻辑型)<br>\nIsDurationValid 返回或设置持续时间值是否有效(逻辑型)<br>\nLanguage 返回或设置用于本地化语言支持的当前区域语言(长整型)<br>\nLostPackets 返回丢失的数据包数量(长整型)<br>\nMarkerCount 返回文件书签的数量(长整型)<br>\nMute 返回或设置控件是否播放声音(逻辑型)<br>\nOpenState 返回控件的内容源状态(长整型)<br>\nPlayCount 返回或设置一个剪辑播放的次数(长整型)<br>\nPlayState 返回控件的当前操作状态(长整型)<br>\nPreviewMode 返回或设置控件是否处在预览模式(逻辑型)<br>\nRate 返回或设置回放帧频(双精度型)<br>\nReadyState 返回控件是否准备就绪(ReadyStateConstant 值)<br>\nReceivedPackets 返回已接收到的数据包的数量(长整型)<br>\nReceptionQuality 返回最后 30 秒接收到的数据包的百分比(长整型)<br>\nRecoveredPackets 返回已转换的数据包的数量(长整型)<br>\nSAMIFileName 返回或设置 closed-captioning 文件名(字符串)<br>\nSAMILang 返回或设置 closed captioning 语言(字符串)<br>\nSAMIStyle 返回或设置 closed captioning 风格(字符串)<br>\nSelectionEnd 返回或设置流的结束位置(双精度型)<br>\nSelectionStart 返回或设置流的起始位置(双精度型)<br>\nSendErrorEvents 返回或设置控件是否发送错误事件(逻辑型)<br>\nSendKeyboardEvents 返回或设置控件是否发送键盘事件(逻辑型)<br>\nSendMouseClickEvents 返回或设置控件是否发送鼠标单击事件(逻辑型)<br>\nSendMouseMoveEvents 返回或设置控件是否发送鼠标移动事件(逻辑型)<br>\nSendOpenStateChangeEvents 返回或设置控件是否发送打开状态改变事件(逻辑型)<br>\nSendPlayStateChangeEvents 返回或设置控件是否发送播放状态改变事件(逻辑型)<br>\nSendWarningEvents 返回或设置控件是否发送警告事件(逻辑型)<br>\nShowAudioControls 返回或设置是否显示音频控制(逻辑型)<br>\nShowCaptioning 返回或设置是否显示字幕(逻辑型)<br>\nShowControls 返回或设置控制面板是否可见(逻辑型)<br>\nShowDisplay 返回或设置是否显示显示面板(逻辑型)<br>\nShowGotoBar 返回或设置是否显示跳转栏(逻辑型)<br>\nShowPositionControls 返回或设置是否显示位置控制(逻辑型)<br>\nShowStatusBar 返回或设置是否显示状态栏(逻辑型)<br>\nShowTracker 返回或设置是否显示搜索栏(逻辑型)<br>\nSourceLink 返回内容文件的路径(字符串)<br>\nSourceProtocol 返回用于接收数据的协议(长整型)<br>\nStreamCount 返回媒体帧的数量(长整型)<br>\nTransparentAtStart 返回或设置在开始播放之前和停止之后控件是否透明(逻辑型)<br>\nVideoBorder3D 返回或设置视频边框是否显示为 3D 效果(逻辑型)<br>\nVideoBorderColor 返回或设置视频边框的颜色(OLE</em>颜色)<br>\nVideoBorderWidth 返回或设置视频边框的宽度(长整型)<br>\nVolume 返回或设置音量(长整型)</p>\n</blockquote>\n<h1 id="解决方案"><a href="#%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>解决方案</h1>\n<p>兼容 IE9~IE11 的 react-player</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="13780982032620526000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`import React from \'react\';\nimport PropTypes from \'prop-types\';\n\nfunction noop() {}\n\n// IE下的audio标签不能播放wav文件，改用embed标签播放，兼容版本：IE9~11\nexport class IEReactPlayer extends React.PureComponent {\n  static propTypes = {\n    url: PropTypes.string, // 播放路径\n    playing: PropTypes.bool, // 播放状态\n    onProgress: PropTypes.func, // 进度更新回调，返回已播放百分比\n    onDuration: PropTypes.func, // 录音长度回调，返回录音总时长，单位为秒\n    onEnded: PropTypes.func, // 录音结束回调，无返回值\n    volume: PropTypes.number, // 音量属性，范围0~1，此属性调整音量不生效，待解决\n    autostart: PropTypes.string, // 是否自动播放，此属性为了兼容Audio组件点击按钮后才请求url，防止点击两次播放按钮才开始播放的情况出现\n    progressInterval: PropTypes.number // 进度刷新间隔，默认100\n  };\n\n  static defaultProps = {\n    url: \'\',\n    playing: false,\n    autostart: \'false\',\n    progressInterval: 100\n  };\n\n  componentDidMount() {\n    const { progressInterval } = this.props;\n    this.timer = setInterval(() => {\n      // 0：停止状态，1：暂停状态，2：播放状态，4:资源加载完成\n      const { onProgress = noop, onDuration = noop, onEnded = noop } = this.props;\n      if (this.embed && this.embed.ReadyState === 4) {\n        onDuration(this.embed.Duration);\n        if (this.embed.PlayState !== 2) {\n          onEnded();\n        }\n        if (this.embed.PlayState === 2 || this.embed.PlayState === 0) {\n          onProgress({\n            played: this.embed.CurrentPosition / this.embed.Duration\n          });\n        }\n      }\n    }, progressInterval);\n  }\n\n  componentWillUnmount() {\n    this.timer && clearInterval(this.timer);\n  }\n\n  seekTo = (value) => {\n    // 设置播放位置，以秒为单位\n    this.embed.CurrentPosition = value * this.embed.Duration;\n  };\n\n  render() {\n    const { url, playing, volume, autostart } = this.props;\n    if (this.embed && this.embed.ReadyState === 4) {\n      if (playing) {\n        this.embed.play();\n      } else {\n        this.embed.pause();\n      }\n      this.embed.Volume = volume * 100;\n    }\n    return (\n      <div>\n        {url && (\n          <embed\n            ref={(r) => {\n              this.embed = r;\n            }}\n            src={url}\n            autostart={autostart}\n            hidden\n          />\n        )}\n      </div>\n    );\n  }\n}\n\nexport default IEReactPlayer;`, `13780982032620526000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                data-tooltip="复制"\n              >\n                <svg class="gatsby-code-button-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0V0z"/><path d="M16 1H2v16h2V3h12V1zm-1 4l6 6v12H6V5h9zm-1 7h5.5L14 6.5V12z"/></svg>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="jsx"><pre style="counter-reset: linenumber NaN" class="language-jsx line-numbers"><code class="language-jsx"><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">\'react\'</span><span class="token punctuation">;</span>\n<span class="token keyword">import</span> PropTypes <span class="token keyword">from</span> <span class="token string">\'prop-types\'</span><span class="token punctuation">;</span>\n\n<span class="token keyword">function</span> <span class="token function">noop</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>\n\n<span class="token comment">// IE下的audio标签不能播放wav文件，改用embed标签播放，兼容版本：IE9~11</span>\n<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">IEReactPlayer</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>PureComponent</span> <span class="token punctuation">{</span>\n  <span class="token keyword">static</span> propTypes <span class="token operator">=</span> <span class="token punctuation">{</span>\n    url<span class="token punctuation">:</span> PropTypes<span class="token punctuation">.</span>string<span class="token punctuation">,</span> <span class="token comment">// 播放路径</span>\n    playing<span class="token punctuation">:</span> PropTypes<span class="token punctuation">.</span>bool<span class="token punctuation">,</span> <span class="token comment">// 播放状态</span>\n    onProgress<span class="token punctuation">:</span> PropTypes<span class="token punctuation">.</span>func<span class="token punctuation">,</span> <span class="token comment">// 进度更新回调，返回已播放百分比</span>\n    onDuration<span class="token punctuation">:</span> PropTypes<span class="token punctuation">.</span>func<span class="token punctuation">,</span> <span class="token comment">// 录音长度回调，返回录音总时长，单位为秒</span>\n    onEnded<span class="token punctuation">:</span> PropTypes<span class="token punctuation">.</span>func<span class="token punctuation">,</span> <span class="token comment">// 录音结束回调，无返回值</span>\n    volume<span class="token punctuation">:</span> PropTypes<span class="token punctuation">.</span>number<span class="token punctuation">,</span> <span class="token comment">// 音量属性，范围0~1，此属性调整音量不生效，待解决</span>\n    autostart<span class="token punctuation">:</span> PropTypes<span class="token punctuation">.</span>string<span class="token punctuation">,</span> <span class="token comment">// 是否自动播放，此属性为了兼容Audio组件点击按钮后才请求url，防止点击两次播放按钮才开始播放的情况出现</span>\n    progressInterval<span class="token punctuation">:</span> PropTypes<span class="token punctuation">.</span>number <span class="token comment">// 进度刷新间隔，默认100</span>\n  <span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n  <span class="token keyword">static</span> defaultProps <span class="token operator">=</span> <span class="token punctuation">{</span>\n    url<span class="token punctuation">:</span> <span class="token string">\'\'</span><span class="token punctuation">,</span>\n    playing<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>\n    autostart<span class="token punctuation">:</span> <span class="token string">\'false\'</span><span class="token punctuation">,</span>\n    progressInterval<span class="token punctuation">:</span> <span class="token number">100</span>\n  <span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n  <span class="token function">componentDidMount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">const</span> <span class="token punctuation">{</span> progressInterval <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">;</span>\n    <span class="token keyword">this</span><span class="token punctuation">.</span>timer <span class="token operator">=</span> <span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n      <span class="token comment">// 0：停止状态，1：暂停状态，2：播放状态，4:资源加载完成</span>\n      <span class="token keyword">const</span> <span class="token punctuation">{</span> onProgress <span class="token operator">=</span> noop<span class="token punctuation">,</span> onDuration <span class="token operator">=</span> noop<span class="token punctuation">,</span> onEnded <span class="token operator">=</span> noop <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">;</span>\n      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>embed <span class="token operator">&amp;&amp;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>embed<span class="token punctuation">.</span>ReadyState <span class="token operator">===</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        <span class="token function">onDuration</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>embed<span class="token punctuation">.</span>Duration<span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>embed<span class="token punctuation">.</span>PlayState <span class="token operator">!==</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n          <span class="token function">onEnded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token punctuation">}</span>\n        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>embed<span class="token punctuation">.</span>PlayState <span class="token operator">===</span> <span class="token number">2</span> <span class="token operator">||</span> <span class="token keyword">this</span><span class="token punctuation">.</span>embed<span class="token punctuation">.</span>PlayState <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n          <span class="token function">onProgress</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n            played<span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>embed<span class="token punctuation">.</span>CurrentPosition <span class="token operator">/</span> <span class="token keyword">this</span><span class="token punctuation">.</span>embed<span class="token punctuation">.</span>Duration\n          <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token punctuation">}</span>\n      <span class="token punctuation">}</span>\n    <span class="token punctuation">}</span><span class="token punctuation">,</span> progressInterval<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n\n  <span class="token function">componentWillUnmount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">this</span><span class="token punctuation">.</span>timer <span class="token operator">&amp;&amp;</span> <span class="token function">clearInterval</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>timer<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n\n  <span class="token function-variable function">seekTo</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n    <span class="token comment">// 设置播放位置，以秒为单位</span>\n    <span class="token keyword">this</span><span class="token punctuation">.</span>embed<span class="token punctuation">.</span>CurrentPosition <span class="token operator">=</span> value <span class="token operator">*</span> <span class="token keyword">this</span><span class="token punctuation">.</span>embed<span class="token punctuation">.</span>Duration<span class="token punctuation">;</span>\n  <span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">const</span> <span class="token punctuation">{</span> url<span class="token punctuation">,</span> playing<span class="token punctuation">,</span> volume<span class="token punctuation">,</span> autostart <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">;</span>\n    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>embed <span class="token operator">&amp;&amp;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>embed<span class="token punctuation">.</span>ReadyState <span class="token operator">===</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token keyword">if</span> <span class="token punctuation">(</span>playing<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        <span class="token keyword">this</span><span class="token punctuation">.</span>embed<span class="token punctuation">.</span><span class="token function">play</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>\n        <span class="token keyword">this</span><span class="token punctuation">.</span>embed<span class="token punctuation">.</span><span class="token function">pause</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span>\n      <span class="token keyword">this</span><span class="token punctuation">.</span>embed<span class="token punctuation">.</span>Volume <span class="token operator">=</span> volume <span class="token operator">*</span> <span class="token number">100</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n    <span class="token keyword">return</span> <span class="token punctuation">(</span>\n      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">\n        </span><span class="token punctuation">{</span>url <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>\n          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>embed</span>\n            <span class="token attr-name">ref</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token parameter">r</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n              <span class="token keyword">this</span><span class="token punctuation">.</span>embed <span class="token operator">=</span> r<span class="token punctuation">;</span>\n            <span class="token punctuation">}</span><span class="token punctuation">}</span></span>\n            <span class="token attr-name">src</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>url<span class="token punctuation">}</span></span>\n            <span class="token attr-name">autostart</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>autostart<span class="token punctuation">}</span></span>\n            <span class="token attr-name">hidden</span>\n          <span class="token punctuation">/></span></span>\n        <span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token plain-text">\n      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>\n    <span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">export</span> <span class="token keyword">default</span> IEReactPlayer<span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h1 id="实现效果"><a href="#%E5%AE%9E%E7%8E%B0%E6%95%88%E6%9E%9C" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>实现效果</h1>\n<p>\n  <a\n    class="gatsby-resp-image-link"\n    href="/static/2019-02-13-20-52-02-f4d5994a8a436d0e7485e76e6dd1fed7-2936c.png"\n    style="display: block"\n    target="_blank"\n    rel="noopener"\n  >\n  \n  <span\n    class="gatsby-resp-image-wrapper"\n    style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;"\n  >\n    <span\n      class="gatsby-resp-image-background-image"\n      style="padding-bottom: 71.52941176470588%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAIAAACgpqunAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABZElEQVQoz41Su07EMBD0l9LxDTR8BQX/QIsQJaKgAyFRIEBUp0hwcnIJeTj2rl9M4rsoF+DEyLHs3Z3d2XVE27Z5nocQYoxhRPwfnHOCmZVS2LXW3vu5G4mstTASEbwLMryi7/uyLKWUWZbh0HXdlAKHoiiqqlqv1yjws7hAVjjqut5sNtjRAvhTbrhwRYHhCqlhWFNjAumh2e6ATngHjANqk4UIMRwjDSuwMabvlYCPZoB1OoOZrvgsU9XR+YM7vfV3Kzbdl8yLJXkOqJ2TtaGLZ3t27x4/2Bo01B8iN02DEBpFK01Pn/wm+b3gvEU+jUYOkTECEFHbMZUdndz44+twdBUuX9mbDkIGMrSlCS3IGD5GPdknP1owIwTSIwIPglC7z08Rv4raklPlrKIXSW1PPI5nV4r/6ggUvIVw3htiZbjVvEAaWOp8gS1ZcZAqGhdbG1d1tC5M8CNC2LOAk0ThD/sGEMUrqJkTcrQAAAAASUVORK5CYII=\'); background-size: cover; display: block;"\n    >\n      <img\n        class="gatsby-resp-image-image"\n        style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;"\n        alt="2019 02 13 20 52 02"\n        title=""\n        src="/static/2019-02-13-20-52-02-f4d5994a8a436d0e7485e76e6dd1fed7-fee1c.png"\n        srcset="/static/2019-02-13-20-52-02-f4d5994a8a436d0e7485e76e6dd1fed7-a67b7.png 200w,\n/static/2019-02-13-20-52-02-f4d5994a8a436d0e7485e76e6dd1fed7-0b187.png 400w,\n/static/2019-02-13-20-52-02-f4d5994a8a436d0e7485e76e6dd1fed7-fee1c.png 800w,\n/static/2019-02-13-20-52-02-f4d5994a8a436d0e7485e76e6dd1fed7-2936c.png 850w"\n        sizes="(max-width: 800px) 100vw, 800px"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>',id:"/github/workspace/blog/ReactPlayer之IE兼容性研究/index.md absPath of file >>> MarkdownRemark",timeToRead:4,frontmatter:{date:"2019-02-13 19:50:08",path:"/reactplayer-ie-compatibility/",tags:"前端, ReactPlayer, IE兼容性, 预研",title:"ReactPlayer之IE兼容性研究",draft:null}}],length:18,tag:"预研",pagesSum:4,page:4}}}});