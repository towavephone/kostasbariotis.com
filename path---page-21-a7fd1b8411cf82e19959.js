webpackJsonp([9469948045756],{1192:function(n,s){n.exports={data:{site:{siteMetadata:{description:'前端工程师，黑猫女王控，欢迎勾搭，技术相关<a href="https://github.com/towavephone" target="_blank">@towavephone</a>，QQ闲聊<a href="tencent://AddContact/?fromId=45&fromSubId=1&subcmd=all&uin=634407147&website=www.oicqzone.com">@towave</a>，bili关注<a href="https://space.bilibili.com/11507708#/" target="_blank">@towave</a>',siteUrl:"https://blog.towavephone.com"}}},pathContext:{posts:[{excerpt:"广度优先搜索 以二叉树的层次遍历举例： 深度优先搜索 深度优先拷贝 目前只拷贝了 Object, Array",html:'<h1 id="广度优先搜索"><a href="#%E5%B9%BF%E5%BA%A6%E4%BC%98%E5%85%88%E6%90%9C%E7%B4%A2" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>广度优先搜索</h1>\n<p>以二叉树的层次遍历举例：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="37291908902947940000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`/*\n * @lc app=leetcode.cn id=102 lang=javascript\n *\n * [102] 二叉树的层次遍历\n *\n * https://leetcode-cn.com/problems/binary-tree-level-order-traversal/description/\n *\n * algorithms\n * Medium (53.64%)\n * Total Accepted:    17.4K\n * Total Submissions: 32.4K\n * Testcase Example:  \'[3,9,20,null,null,15,7]\'\n *\n * 给定一个二叉树，返回其按层次遍历的节点值。 （即逐层地，从左到右访问所有节点）。\n *\n * 例如:\n * 给定二叉树: [3,9,20,null,null,15,7],\n *\n * ⁠   3\n * ⁠  / \\\n * ⁠ 9  20\n * ⁠   /  \\\n * ⁠  15   7\n *\n *\n * 返回其层次遍历结果：\n *\n * [\n * ⁠ [3],\n * ⁠ [9,20],\n * ⁠ [15,7]\n * ]\n *\n *\n */\n/**\n * Definition for a binary tree node.\n * function TreeNode(val) {\n *     this.val = val;\n *     this.left = this.right = null;\n * }\n */\n/**\n * @param {TreeNode} root\n * @return {number[][]}\n */\nvar levelOrder = function(root) {\n  if (!root) {\n    return [];\n  }\n  const queue = [root];\n  const results = [];\n  while (queue.length) {\n    let count = queue.length;\n    const result = [];\n    while (count--) {\n      const t1 = queue.shift();\n      result.push(t1.val);\n      t1.left && queue.push(t1.left);\n      t1.right && queue.push(t1.right);\n    }\n    results.push(result);\n  }\n  return results;\n};`, `37291908902947940000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                js 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">/*\n * @lc app=leetcode.cn id=102 lang=javascript\n *\n * [102] 二叉树的层次遍历\n *\n * https://leetcode-cn.com/problems/binary-tree-level-order-traversal/description/\n *\n * algorithms\n * Medium (53.64%)\n * Total Accepted:    17.4K\n * Total Submissions: 32.4K\n * Testcase Example:  \'[3,9,20,null,null,15,7]\'\n *\n * 给定一个二叉树，返回其按层次遍历的节点值。 （即逐层地，从左到右访问所有节点）。\n *\n * 例如:\n * 给定二叉树: [3,9,20,null,null,15,7],\n *\n * ⁠   3\n * ⁠  / \\\n * ⁠ 9  20\n * ⁠   /  \\\n * ⁠  15   7\n *\n *\n * 返回其层次遍历结果：\n *\n * [\n * ⁠ [3],\n * ⁠ [9,20],\n * ⁠ [15,7]\n * ]\n *\n *\n */</span>\n<span class="token comment">/**\n * Definition for a binary tree node.\n * function TreeNode(val) {\n *     this.val = val;\n *     this.left = this.right = null;\n * }\n */</span>\n<span class="token comment">/**\n * @param {TreeNode} root\n * @return {number[][]}\n */</span>\n<span class="token keyword">var</span> <span class="token function-variable function">levelOrder</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">root</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>root<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n  <span class="token keyword">const</span> queue <span class="token operator">=</span> <span class="token punctuation">[</span>root<span class="token punctuation">]</span><span class="token punctuation">;</span>\n  <span class="token keyword">const</span> results <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n  <span class="token keyword">while</span> <span class="token punctuation">(</span>queue<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> count <span class="token operator">=</span> queue<span class="token punctuation">.</span>length<span class="token punctuation">;</span>\n    <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n    <span class="token keyword">while</span> <span class="token punctuation">(</span>count<span class="token operator">--</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token keyword">const</span> t1 <span class="token operator">=</span> queue<span class="token punctuation">.</span><span class="token function">shift</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n      result<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>t1<span class="token punctuation">.</span>val<span class="token punctuation">)</span><span class="token punctuation">;</span>\n      t1<span class="token punctuation">.</span>left <span class="token operator">&amp;&amp;</span> queue<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>t1<span class="token punctuation">.</span>left<span class="token punctuation">)</span><span class="token punctuation">;</span>\n      t1<span class="token punctuation">.</span>right <span class="token operator">&amp;&amp;</span> queue<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>t1<span class="token punctuation">.</span>right<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n    results<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n  <span class="token keyword">return</span> results<span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h1 id="深度优先搜索"><a href="#%E6%B7%B1%E5%BA%A6%E4%BC%98%E5%85%88%E6%90%9C%E7%B4%A2" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>深度优先搜索</h1>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="60142558788489800000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`/*深度优先遍历三种方式*/\nlet deepTraversal1 = (node, nodeList = []) => {\n  if (node !== null) {\n    nodeList.push(node);\n    let children = node.children;\n    for (let i = 0; i < children.length; i++) {\n      deepTraversal1(children[i], nodeList);\n    }\n  }\n  return nodeList;\n};\nlet deepTraversal2 = (node) => {\n  let nodes = [];\n  if (node !== null) {\n    nodes.push(node);\n    let children = node.children;\n    for (let i = 0; i < children.length; i++) {\n      nodes = nodes.concat(deepTraversal2(children[i]));\n    }\n  }\n  return nodes;\n};\n// 非递归\nlet deepTraversal3 = (node) => {\n  let stack = [];\n  let nodes = [];\n  if (node) {\n    // 推入当前处理的node\n    stack.push(node);\n    while (stack.length) {\n      let item = stack.pop();\n      let children = item.children;\n      nodes.push(item);\n      // node = [] stack = [parent]\n      // node = [parent] stack = [child3,child2,child1]\n      // node = [parent, child1] stack = [child3,child2,child1-2,child1-1]\n      // node = [parent, child1-1] stack = [child3,child2,child1-2]\n      for (let i = children.length - 1; i >= 0; i--) {\n        stack.push(children[i]);\n      }\n    }\n  }\n  return nodes;\n};`, `60142558788489800000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                js 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">/*深度优先遍历三种方式*/</span>\n<span class="token keyword">let</span> <span class="token function-variable function">deepTraversal1</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">node<span class="token punctuation">,</span> nodeList <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n  <span class="token keyword">if</span> <span class="token punctuation">(</span>node <span class="token operator">!==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    nodeList<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>node<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">let</span> children <span class="token operator">=</span> node<span class="token punctuation">.</span>children<span class="token punctuation">;</span>\n    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> children<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token function">deepTraversal1</span><span class="token punctuation">(</span>children<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> nodeList<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n  <span class="token punctuation">}</span>\n  <span class="token keyword">return</span> nodeList<span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span>\n<span class="token keyword">let</span> <span class="token function-variable function">deepTraversal2</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">node</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n  <span class="token keyword">let</span> nodes <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n  <span class="token keyword">if</span> <span class="token punctuation">(</span>node <span class="token operator">!==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    nodes<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>node<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">let</span> children <span class="token operator">=</span> node<span class="token punctuation">.</span>children<span class="token punctuation">;</span>\n    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> children<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      nodes <span class="token operator">=</span> nodes<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span><span class="token function">deepTraversal2</span><span class="token punctuation">(</span>children<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n  <span class="token punctuation">}</span>\n  <span class="token keyword">return</span> nodes<span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span>\n<span class="token comment">// 非递归</span>\n<span class="token keyword">let</span> <span class="token function-variable function">deepTraversal3</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">node</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n  <span class="token keyword">let</span> stack <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n  <span class="token keyword">let</span> nodes <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n  <span class="token keyword">if</span> <span class="token punctuation">(</span>node<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token comment">// 推入当前处理的node</span>\n    stack<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>node<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">while</span> <span class="token punctuation">(</span>stack<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token keyword">let</span> item <span class="token operator">=</span> stack<span class="token punctuation">.</span><span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token keyword">let</span> children <span class="token operator">=</span> item<span class="token punctuation">.</span>children<span class="token punctuation">;</span>\n      nodes<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token comment">// node = [] stack = [parent]</span>\n      <span class="token comment">// node = [parent] stack = [child3,child2,child1]</span>\n      <span class="token comment">// node = [parent, child1] stack = [child3,child2,child1-2,child1-1]</span>\n      <span class="token comment">// node = [parent, child1-1] stack = [child3,child2,child1-2]</span>\n      <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> children<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">>=</span> <span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">--</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        stack<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>children<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span>\n    <span class="token punctuation">}</span>\n  <span class="token punctuation">}</span>\n  <span class="token keyword">return</span> nodes<span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h1 id="深度优先拷贝"><a href="#%E6%B7%B1%E5%BA%A6%E4%BC%98%E5%85%88%E6%8B%B7%E8%B4%9D" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>深度优先拷贝</h1>\n<p>目前只拷贝了 Object, Array</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="4535704695055198000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 如果是对象/数组，返回一个空的对象/数组，\n// 都不是的话直接返回原对象\n// 判断返回的对象和原有对象是否相同就可以知道是否需要继续深拷贝\n// 处理其他的数据类型的话就在这里加判断\nfunction getEmpty(o) {\n  if (Object.prototype.toString.call(o) === \'[object Object]\') {\n    return {};\n  }\n  if (Object.prototype.toString.call(o) === \'[object Array]\') {\n    return [];\n  }\n  return o;\n}\n\nfunction deepCopyBFS(origin) {\n  let queue = [];\n  let map = new Map(); // 记录出现过的对象，用于处理环\n\n  let target = getEmpty(origin);\n  if (target !== origin) {\n    queue.push([origin, target]);\n    map.set(origin, target);\n  }\n\n  while (queue.length) {\n    let [ori, tar] = queue.shift();\n    for (let key in ori) {\n      // 处理环状\n      if (map.get(ori[key])) {\n        tar[key] = map.get(ori[key]);\n        continue;\n      }\n\n      tar[key] = getEmpty(ori[key]);\n      if (tar[key] !== ori[key]) {\n        queue.push([ori[key], tar[key]]);\n        map.set(ori[key], tar[key]);\n      }\n    }\n  }\n\n  return target;\n}\n\nfunction deepCopyDFS(origin) {\n  let stack = [];\n  let map = new Map(); // 记录出现过的对象，用于处理环\n\n  let target = getEmpty(origin);\n  if (target !== origin) {\n    stack.push([origin, target]);\n    map.set(origin, target);\n  }\n\n  while (stack.length) {\n    let [ori, tar] = stack.pop();\n    for (let key in ori) {\n      // 处理环状\n      if (map.get(ori[key])) {\n        tar[key] = map.get(ori[key]);\n        continue;\n      }\n\n      tar[key] = getEmpty(ori[key]);\n      if (tar[key] !== ori[key]) {\n        stack.push([ori[key], tar[key]]);\n        map.set(ori[key], tar[key]);\n      }\n    }\n  }\n\n  return target;\n}`, `4535704695055198000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                js 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// 如果是对象/数组，返回一个空的对象/数组，</span>\n<span class="token comment">// 都不是的话直接返回原对象</span>\n<span class="token comment">// 判断返回的对象和原有对象是否相同就可以知道是否需要继续深拷贝</span>\n<span class="token comment">// 处理其他的数据类型的话就在这里加判断</span>\n<span class="token keyword">function</span> <span class="token function">getEmpty</span><span class="token punctuation">(</span><span class="token parameter">o</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">Object</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>o<span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token string">\'[object Object]\'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">return</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">Object</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>o<span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token string">\'[object Array]\'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n  <span class="token keyword">return</span> o<span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">function</span> <span class="token function">deepCopyBFS</span><span class="token punctuation">(</span><span class="token parameter">origin</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">let</span> queue <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n  <span class="token keyword">let</span> map <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Map</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 记录出现过的对象，用于处理环</span>\n\n  <span class="token keyword">let</span> target <span class="token operator">=</span> <span class="token function">getEmpty</span><span class="token punctuation">(</span>origin<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token keyword">if</span> <span class="token punctuation">(</span>target <span class="token operator">!==</span> origin<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    queue<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">[</span>origin<span class="token punctuation">,</span> target<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    map<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>origin<span class="token punctuation">,</span> target<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n\n  <span class="token keyword">while</span> <span class="token punctuation">(</span>queue<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> <span class="token punctuation">[</span>ori<span class="token punctuation">,</span> tar<span class="token punctuation">]</span> <span class="token operator">=</span> queue<span class="token punctuation">.</span><span class="token function">shift</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> key <span class="token keyword">in</span> ori<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token comment">// 处理环状</span>\n      <span class="token keyword">if</span> <span class="token punctuation">(</span>map<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>ori<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        tar<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> map<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>ori<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token keyword">continue</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span>\n\n      tar<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">getEmpty</span><span class="token punctuation">(</span>ori<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token keyword">if</span> <span class="token punctuation">(</span>tar<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">!==</span> ori<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        queue<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">[</span>ori<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">,</span> tar<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n        map<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>ori<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">,</span> tar<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span>\n    <span class="token punctuation">}</span>\n  <span class="token punctuation">}</span>\n\n  <span class="token keyword">return</span> target<span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">function</span> <span class="token function">deepCopyDFS</span><span class="token punctuation">(</span><span class="token parameter">origin</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">let</span> stack <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n  <span class="token keyword">let</span> map <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Map</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 记录出现过的对象，用于处理环</span>\n\n  <span class="token keyword">let</span> target <span class="token operator">=</span> <span class="token function">getEmpty</span><span class="token punctuation">(</span>origin<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token keyword">if</span> <span class="token punctuation">(</span>target <span class="token operator">!==</span> origin<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    stack<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">[</span>origin<span class="token punctuation">,</span> target<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    map<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>origin<span class="token punctuation">,</span> target<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n\n  <span class="token keyword">while</span> <span class="token punctuation">(</span>stack<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> <span class="token punctuation">[</span>ori<span class="token punctuation">,</span> tar<span class="token punctuation">]</span> <span class="token operator">=</span> stack<span class="token punctuation">.</span><span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> key <span class="token keyword">in</span> ori<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token comment">// 处理环状</span>\n      <span class="token keyword">if</span> <span class="token punctuation">(</span>map<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>ori<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        tar<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> map<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>ori<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token keyword">continue</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span>\n\n      tar<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">getEmpty</span><span class="token punctuation">(</span>ori<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token keyword">if</span> <span class="token punctuation">(</span>tar<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">!==</span> ori<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        stack<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">[</span>ori<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">,</span> tar<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n        map<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>ori<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">,</span> tar<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span>\n    <span class="token punctuation">}</span>\n  <span class="token punctuation">}</span>\n\n  <span class="token keyword">return</span> target<span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>',
id:"/github/workspace/blog/树的遍历算法与深度拷贝函数/index.md absPath of file >>> MarkdownRemark",timeToRead:2,frontmatter:{date:"2019-07-19 11:47:41",path:"/tree-traversal-depth-copy/",tags:"前端, 深度拷贝, 树的遍历",title:"树的遍历算法与深度拷贝函数",draft:null}},{excerpt:"防抖动是将多次执行变为最后一次执行，节流是将多次执行变成每隔一段时间执行。 防抖 触发高频事件后 n 秒内函数只会执行一次，如果 n 秒内高频事件再次被触发，则重新计算时间 思路： 每次触发事件时都取消之前的延时调用方法 节流 高频事件触发，但在 n 秒内只会执行一次，所以节流会稀释函数的执行频率 思路： 每次触发事件时都判断当前是否有等待执行的延时函数",html:'<p>防抖动是将多次执行变为最后一次执行，节流是将多次执行变成每隔一段时间执行。</p>\n<h1 id="防抖"><a href="#%E9%98%B2%E6%8A%96" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>防抖</h1>\n<p>触发高频事件后 n 秒内函数只会执行一次，如果 n 秒内高频事件再次被触发，则重新计算时间</p>\n<h2 id="思路："><a href="#%E6%80%9D%E8%B7%AF%EF%BC%9A" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>思路：</h2>\n<p>每次触发事件时都取消之前的延时调用方法</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="66073117141667170000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`function debounce(fn) {\n  let timeout = null; // 创建一个标记用来存放定时器的返回值\n  return function() {\n    clearTimeout(timeout); // 每当用户输入的时候把前一个 setTimeout clear 掉\n    // 然后又创建一个新的 setTimeout, 这样就能保证输入字符后的 interval 间隔内如果还有字符输入的话，就不会执行 fn 函数\n    timeout = setTimeout(() => {\n      fn.apply(this, arguments);\n    }, 500);\n  };\n}\n\nfunction sayHi() {\n  console.log(\'防抖成功\');\n}\n\nvar inp = document.getElementById(\'inp\');\ninp.addEventListener(\'input\', debounce(sayHi)); // 防抖`, `66073117141667170000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                js 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">function</span> <span class="token function">debounce</span><span class="token punctuation">(</span><span class="token parameter">fn</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">let</span> timeout <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span> <span class="token comment">// 创建一个标记用来存放定时器的返回值</span>\n  <span class="token keyword">return</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token function">clearTimeout</span><span class="token punctuation">(</span>timeout<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 每当用户输入的时候把前一个 setTimeout clear 掉</span>\n    <span class="token comment">// 然后又创建一个新的 setTimeout, 这样就能保证输入字符后的 interval 间隔内如果还有字符输入的话，就不会执行 fn 函数</span>\n    timeout <span class="token operator">=</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n      <span class="token function">fn</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> arguments<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">function</span> <span class="token function">sayHi</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">\'防抖成功\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">var</span> inp <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">\'inp\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\ninp<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">\'input\'</span><span class="token punctuation">,</span> <span class="token function">debounce</span><span class="token punctuation">(</span>sayHi<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 防抖</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h1 id="节流"><a href="#%E8%8A%82%E6%B5%81" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>节流</h1>\n<p>高频事件触发，但在 n 秒内只会执行一次，所以节流会稀释函数的执行频率</p>\n<h2 id="思路：-1"><a href="#%E6%80%9D%E8%B7%AF%EF%BC%9A-1" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>思路：</h2>\n<p>每次触发事件时都判断当前是否有等待执行的延时函数</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="49205668397259350000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`function throttle(fn) {\n  let canRun = true; // 通过闭包保存一个标记\n  return function() {\n    if (!canRun) return; // 在函数开头判断标记是否为 true，不为 true 则 return\n    canRun = false; // 立即设置为 false\n    setTimeout(() => {\n      // 将外部传入的函数的执行放在 setTimeout 中\n      fn.apply(this, arguments);\n      // 最后在 setTimeout 执行完毕后再把标记设置为 true(关键) 表示可以执行下一次循环了\n      // 当定时器没有执行的时候标记永远是 false，在开头被 return 掉\n      canRun = true;\n    }, 500);\n  };\n}\n\nfunction sayHi(e) {\n  console.log(e.target.innerWidth, e.target.innerHeight);\n}\n\nwindow.addEventListener(\'resize\', throttle(sayHi));`, `49205668397259350000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                js 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">function</span> <span class="token function">throttle</span><span class="token punctuation">(</span><span class="token parameter">fn</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">let</span> canRun <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span> <span class="token comment">// 通过闭包保存一个标记</span>\n  <span class="token keyword">return</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>canRun<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span> <span class="token comment">// 在函数开头判断标记是否为 true，不为 true 则 return</span>\n    canRun <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span> <span class="token comment">// 立即设置为 false</span>\n    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n      <span class="token comment">// 将外部传入的函数的执行放在 setTimeout 中</span>\n      <span class="token function">fn</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> arguments<span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token comment">// 最后在 setTimeout 执行完毕后再把标记设置为 true(关键) 表示可以执行下一次循环了</span>\n      <span class="token comment">// 当定时器没有执行的时候标记永远是 false，在开头被 return 掉</span>\n      canRun <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">function</span> <span class="token function">sayHi</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>innerWidth<span class="token punctuation">,</span> e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>innerHeight<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\nwindow<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">\'resize\'</span><span class="token punctuation">,</span> <span class="token function">throttle</span><span class="token punctuation">(</span>sayHi<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>',id:"/github/workspace/blog/防抖节流的区别与实现/index.md absPath of file >>> MarkdownRemark",timeToRead:1,frontmatter:{date:"2019-07-19 11:31:28",path:"/debounce-throttle-difference-realize/",tags:"前端, JS, 防抖, 节流",title:"防抖节流的区别与实现",draft:null}},{excerpt:"需求背景 在做侧边抽屉时遇到了需要强行撑满剩余高度的情况，左边的外呼结果要强行撑满剩余高度，这考察了等高布局的应用 解决方案 首先明确侧边栏左边 html 的结构，其中 html 采用 react 写法，css 采用 less 写法 table 布局 比较 hack 的方法 margin 与 padding absolute 此方法需要对 html…",html:'<h1 id="需求背景"><a href="#%E9%9C%80%E6%B1%82%E8%83%8C%E6%99%AF" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>需求背景</h1>\n<p>在做侧边抽屉时遇到了需要强行撑满剩余高度的情况，左边的外呼结果要强行撑满剩余高度，这考察了等高布局的应用</p>\n<p>\n  <a\n    class="gatsby-resp-image-link"\n    href="/static/2019-06-20-15-48-45-f87613b3e70991756ee12e62144846b7-055ed.png"\n    style="display: block"\n    target="_blank"\n    rel="noopener"\n  >\n  \n  <span\n    class="gatsby-resp-image-wrapper"\n    style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;"\n  >\n    <span\n      class="gatsby-resp-image-background-image"\n      style="padding-bottom: 105.87570621468927%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAVCAIAAADJt1n/AAAACXBIWXMAAA7DAAAOwwHHb6hkAAACiklEQVQ4y31TTWsUQRCdX+VP8K5B9Gh+g2cPngTx5MmrCuLFkEAIHmTBIDEgHjQoSmKMCe5mP2Z2pqe/qqq7y+qZjURj9lEz9Ez366p6VVXU87ppmhCj2D9IcRkQqaibtm4UYgAxoD9mHbaOHJD/26wD58ADOg9FVc2HwyHIcSI+B6GNdIKYOGXkXynFlIwVFopnCrHQWk+mk2nGrD/TA1Buo0ALoAAgJXFAnCRG8e8LY2xVlXVdt2173rOQvZfwOiAaY5w1uyf4fI8+j1Gr+aysikapyfi0bZVsC1/8hRAkTiFnEnYPgPc+oN/ap/s7cec42J4cQpQtEVziF7K11jmX46QgC+/zCzvPWpsYgCOkSEq1ZVUVQCHlIOWSFCLLF1LMTI/dRRac5ohMPmWDmA2VUpksZR4OR500C+vUTS7HK/XAUUO/ajyemZPSnDYwrKGx2Komk9tWV2UpAesFWi1uEktJOcD3Ga6s8eomr27x7S2+sc5XX/DTjwHaaio5iyqSH/4BQOMZY1ZbIhw18GA3PXqfHr4L97bp7pt453Uc/Aho1bQXjP8HIWepwDG5hA6dppx8L9hZzhfJaUEOVopn7HhuqkaLAn1L5v7Cy8k9JGc5pB2MGzQOObpENntOfalUWZbLyIQiLLz9SdtHYXDgBvtW1oNDOiylw+pqXl9Kdp3a+zO8vsa3NnhlnW9u8LWXfOUJP/5ADFrGa5nnQFhpfHUQxNa+wOY3v/6Vnn2ivVOM6PNILlFbGkyGh4PhKNUzycvkgJg0aW7c5WRpa2X80UQpY/OQAVoPths175eTe7UtThRJcZyVwhk4QzczvshDH+JFsx6lvfvyGo/KeqWdLEz3X5xLTr8Bt9ezefNAny4AAAAASUVORK5CYII=\'); background-size: cover; display: block;"\n    >\n      <img\n        class="gatsby-resp-image-image"\n        style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;"\n        alt="2019 06 20 15 48 45"\n        title=""\n        src="/static/2019-06-20-15-48-45-f87613b3e70991756ee12e62144846b7-fee1c.png"\n        srcset="/static/2019-06-20-15-48-45-f87613b3e70991756ee12e62144846b7-a67b7.png 200w,\n/static/2019-06-20-15-48-45-f87613b3e70991756ee12e62144846b7-0b187.png 400w,\n/static/2019-06-20-15-48-45-f87613b3e70991756ee12e62144846b7-fee1c.png 800w,\n/static/2019-06-20-15-48-45-f87613b3e70991756ee12e62144846b7-055ed.png 885w"\n        sizes="(max-width: 800px) 100vw, 800px"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<h1 id="解决方案"><a href="#%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>解决方案</h1>\n<p>首先明确侧边栏左边 html 的结构，其中 html 采用 react 写法，css 采用 less 写法</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="92636273265060940000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`<div className=&quot;{styles.leftBody}&quot;>\n  <div className=&quot;{styles.leftBodyTop}&quot;></div>\n  <div className=&quot;{styles.leftBodyBottom}&quot;></div>\n</div>`, `92636273265060940000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                html 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="html"><pre style="counter-reset: linenumber NaN" class="language-html line-numbers"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>{styles.leftBody}<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>{styles.leftBodyTop}<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>{styles.leftBodyBottom}<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id="table-布局"><a href="#table-%E5%B8%83%E5%B1%80" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>table 布局</h2>\n<p>比较 hack 的方法</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="79130045437657060000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`.leftBody {\n  display: table;\n\n  .leftBodyTop {\n    background: #fff;\n    display: table-row;\n    height: 0; /* 尽可能的减小高度，即自适应内容 */\n  }\n\n  .leftBodyBottom {\n    background: #fff;\n    display: table-row; /* 占满剩余空间，自适应父类剩余高度 */\n    vertical-align: top; /* 将内容放在顶部 */\n\n    &::before {\n      /* 设置 display：table-row; 时，margin 和 padding 设置会失效，故这里用伪元素代替显示 */\n      content: \'\';\n      display: block;\n      width: 100%;\n      height: 16px;\n      background: #edf0f4;\n    }\n  }\n}`, `79130045437657060000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                css 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">.leftBody</span> <span class="token punctuation">{</span>\n  <span class="token property">display</span><span class="token punctuation">:</span> table<span class="token selector">;\n\n  .leftBodyTop</span> <span class="token punctuation">{</span>\n    <span class="token property">background</span><span class="token punctuation">:</span> #fff<span class="token punctuation">;</span>\n    <span class="token property">display</span><span class="token punctuation">:</span> table-row<span class="token punctuation">;</span>\n    <span class="token property">height</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span> <span class="token comment">/* 尽可能的减小高度，即自适应内容 */</span>\n  <span class="token punctuation">}</span>\n\n  <span class="token selector">.leftBodyBottom</span> <span class="token punctuation">{</span>\n    <span class="token property">background</span><span class="token punctuation">:</span> #fff<span class="token punctuation">;</span>\n    <span class="token property">display</span><span class="token punctuation">:</span> table-row<span class="token punctuation">;</span> <span class="token comment">/* 占满剩余空间，自适应父类剩余高度 */</span>\n    <span class="token property">vertical-align</span><span class="token punctuation">:</span> top<span class="token punctuation">;</span> <span class="token comment">/* 将内容放在顶部 */</span>\n\n    <span class="token selector">&amp;::before</span> <span class="token punctuation">{</span>\n      <span class="token comment">/* 设置 display：table-row; 时，margin 和 padding 设置会失效，故这里用伪元素代替显示 */</span>\n      <span class="token property">content</span><span class="token punctuation">:</span> <span class="token string">\'\'</span><span class="token punctuation">;</span>\n      <span class="token property">display</span><span class="token punctuation">:</span> block<span class="token punctuation">;</span>\n      <span class="token property">width</span><span class="token punctuation">:</span> 100%<span class="token punctuation">;</span>\n      <span class="token property">height</span><span class="token punctuation">:</span> 16px<span class="token punctuation">;</span>\n      <span class="token property">background</span><span class="token punctuation">:</span> #edf0f4<span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id="margin-与-padding"><a href="#margin-%E4%B8%8E-padding" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>margin 与 padding</h2>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="12154116910348157000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`.leftBody {\n  overflow: hidden; /* 必须设置，否则露底 */\n\n  .leftBodyTop {\n    background: #fff;\n  }\n\n  .leftBodyBottom {\n    background: #fff;\n    margin-top: 16px;\n    margin-bottom: -3000px; /* margin 与 padding 相互抵消来撑满剩余高度 */\n    padding-bottom: 3000px;\n  }\n}`, `12154116910348157000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                css 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">.leftBody</span> <span class="token punctuation">{</span>\n  <span class="token property">overflow</span><span class="token punctuation">:</span> hidden<span class="token punctuation">;</span> <span class="token comment">/* 必须设置，否则露底 */</span>\n\n  <span class="token selector">.leftBodyTop</span> <span class="token punctuation">{</span>\n    <span class="token property">background</span><span class="token punctuation">:</span> #fff<span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n\n  <span class="token selector">.leftBodyBottom</span> <span class="token punctuation">{</span>\n    <span class="token property">background</span><span class="token punctuation">:</span> #fff<span class="token punctuation">;</span>\n    <span class="token property">margin-top</span><span class="token punctuation">:</span> 16px<span class="token punctuation">;</span>\n    <span class="token property">margin-bottom</span><span class="token punctuation">:</span> -3000px<span class="token punctuation">;</span> <span class="token comment">/* margin 与 padding 相互抵消来撑满剩余高度 */</span>\n    <span class="token property">padding-bottom</span><span class="token punctuation">:</span> 3000px<span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id="absolute"><a href="#absolute" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>absolute</h2>\n<p>此方法需要对 html 做出改动</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="56923106148929150000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`<div className=&quot;{styles.leftBody}&quot;>\n  <div className=&quot;{styles.leftBodyTop}&quot;></div>\n  <div className=&quot;{styles.leftBodyBottom}&quot;>\n    <div className=&quot;{styles.equalHeight}&quot; />\n    <div className=&quot;{styles.content}&quot;></div>\n  </div>\n</div>`, `56923106148929150000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                html 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="html"><pre style="counter-reset: linenumber NaN" class="language-html line-numbers"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>{styles.leftBody}<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>{styles.leftBodyTop}<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>{styles.leftBodyBottom}<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>{styles.equalHeight}<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>{styles.content}<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>由于绝对定位元素无高度的特性无宽度的特性，我们可以伪造一个高度足够高的绝对定位层（设置背景色，边框等属性），同时设置父标签溢出隐藏，那么其多出来的高度就不会显示了，也就实现了看上去的等高布局效果了</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="38440178975770630000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`.leftBody {\n  overflow: hidden; /* 必须设置，否则露底 */\n\n  .leftBodyTop {\n    background: #fff;\n  }\n\n  .leftBodyBottom {\n    background: #fff;\n    margin-top: 16px;\n    position: relative;\n\n    .equalHeight {\n      background: #fff;\n      width: 100%;\n      height: 999em;\n      position: absolute;\n      left: 0;\n      top: 0;\n    }\n\n    .content {\n      position: relative;\n      z-index: 1; /* 内容必须在上方，否则被 equalHeight 覆盖 */\n    }\n  }\n}`, `38440178975770630000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                css 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">.leftBody</span> <span class="token punctuation">{</span>\n  <span class="token property">overflow</span><span class="token punctuation">:</span> hidden<span class="token punctuation">;</span> <span class="token comment">/* 必须设置，否则露底 */</span>\n\n  <span class="token selector">.leftBodyTop</span> <span class="token punctuation">{</span>\n    <span class="token property">background</span><span class="token punctuation">:</span> #fff<span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n\n  <span class="token selector">.leftBodyBottom</span> <span class="token punctuation">{</span>\n    <span class="token property">background</span><span class="token punctuation">:</span> #fff<span class="token punctuation">;</span>\n    <span class="token property">margin-top</span><span class="token punctuation">:</span> 16px<span class="token punctuation">;</span>\n    <span class="token property">position</span><span class="token punctuation">:</span> relative<span class="token selector">;\n\n    .equalHeight</span> <span class="token punctuation">{</span>\n      <span class="token property">background</span><span class="token punctuation">:</span> #fff<span class="token punctuation">;</span>\n      <span class="token property">width</span><span class="token punctuation">:</span> 100%<span class="token punctuation">;</span>\n      <span class="token property">height</span><span class="token punctuation">:</span> 999em<span class="token punctuation">;</span>\n      <span class="token property">position</span><span class="token punctuation">:</span> absolute<span class="token punctuation">;</span>\n      <span class="token property">left</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>\n      <span class="token property">top</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n\n    <span class="token selector">.content</span> <span class="token punctuation">{</span>\n      <span class="token property">position</span><span class="token punctuation">:</span> relative<span class="token punctuation">;</span>\n      <span class="token property">z-index</span><span class="token punctuation">:</span> 1<span class="token punctuation">;</span> <span class="token comment">/* 内容必须在上方，否则被 equalHeight 覆盖 */</span>\n    <span class="token punctuation">}</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id="flex"><a href="#flex" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>flex</h2>\n<p>代码最简洁</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="12732510769401405000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`.leftBody {\n  display: flex;\n  flex-direction: column;\n\n  .leftBodyTop {\n    background: #fff;\n  }\n\n  .leftBodyBottom {\n    background: #fff;\n    margin-top: 16px;\n    flex: 1;\n  }\n}`, `12732510769401405000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                css 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">.leftBody</span> <span class="token punctuation">{</span>\n  <span class="token property">display</span><span class="token punctuation">:</span> flex<span class="token punctuation">;</span>\n  <span class="token property">flex-direction</span><span class="token punctuation">:</span> column<span class="token selector">;\n\n  .leftBodyTop</span> <span class="token punctuation">{</span>\n    <span class="token property">background</span><span class="token punctuation">:</span> #fff<span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n\n  <span class="token selector">.leftBodyBottom</span> <span class="token punctuation">{</span>\n    <span class="token property">background</span><span class="token punctuation">:</span> #fff<span class="token punctuation">;</span>\n    <span class="token property">margin-top</span><span class="token punctuation">:</span> 16px<span class="token punctuation">;</span>\n    <span class="token property">flex</span><span class="token punctuation">:</span> 1<span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>以上更新于<code class="language-text">2019-6-20 16:39:27</code></p>\n<hr>',
id:"/github/workspace/blog/CSS等高布局的应用/index.md absPath of file >>> MarkdownRemark",timeToRead:2,frontmatter:{date:"2019-06-20 15:45:59",path:"/css-equal-height/",tags:"前端, CSS, 等高布局, 预研",title:"CSS等高布局的应用",draft:null}},{excerpt:"需求背景 最近由于第三方云端电话私自更改接口导致了线上事故的发生，所以公司决定由前端直接连接 freeswitch ，用它来借助第三方线路打云端电话 知识背景 SIP 协议入门学习 核心思路 首先在网上找到相应前端的 SIP 连接库，发现大概满足的有 2 种，一个是 JsSIP，看了一下支持的列表里面是没有 freeswitch 的，所以选了支持 freeswitch 的 SIP.js…",html:'<h1 id="需求背景"><a href="#%E9%9C%80%E6%B1%82%E8%83%8C%E6%99%AF" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>需求背景</h1>\n<p>最近由于第三方云端电话私自更改接口导致了线上事故的发生，所以公司决定由前端直接连接 freeswitch ，用它来借助第三方线路打云端电话</p>\n<h1 id="知识背景"><a href="#%E7%9F%A5%E8%AF%86%E8%83%8C%E6%99%AF" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>知识背景</h1>\n<p><a href="/SIP-protocol-introduction-learning/">SIP 协议入门学习</a></p>\n<h1 id="核心思路"><a href="#%E6%A0%B8%E5%BF%83%E6%80%9D%E8%B7%AF" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>核心思路</h1>\n<p>首先在网上找到相应前端的 SIP 连接库，发现大概满足的有 2 种，一个是 JsSIP，看了一下支持的列表里面是没有 freeswitch 的，所以选了支持 freeswitch 的 SIP.js</p>\n<h1 id="代码预览"><a href="#%E4%BB%A3%E7%A0%81%E9%A2%84%E8%A7%88" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>代码预览</h1>\n<p>在写代码时考虑到要兼容之前第三方云端电话的逻辑，所以需要将所有的方法封装成一个类</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="2358093480850942500"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// Call\nimport { UA } from \'./libs/sip-0.14.1\';\n\nclass Call {\n  constructor() {\n    // eslint-disable-next-line constructor-super\n    this.callInfo = null;\n    this.userAgent = null; // 注册 SIP 后实例\n    this.session = null; // 拨打成功后 session 实例\n    this.remoteView = null;\n\n    this.hasSignedIn = false;\n    this.createElements();\n\n    window.onbeforeunload = () => {\n      // eslint-disable-line\n      this.signOut();\n    };\n  }\n\n  createElements() {\n    this.remoteView = document.createElement(\'video\');\n    this.remoteView.style.display = \'none\';\n    document.body.appendChild(this.remoteView);\n  }\n\n  async signIn(callInfo) {\n    const { ws_domain: sipServer, ws_port: sipPort, ws_protocol: wsType } = await getCallInfo();\n    return new Promise((resolve, reject) => {\n      this.signInResolve = resolve;\n      this.signInReject = reject;\n      this.callInfo = {\n        authorizationUser: callInfo.agent_id,\n        password: callInfo.agent_pwd,\n        sipServer,\n        sipPort,\n        wsType\n      };\n      this.registerSip();\n    });\n  }\n\n  // 注册分机（软电话）\n  registerSip() {\n    const { authorizationUser, password, sipServer, sipPort, wsType } = this.callInfo;\n    const config = {\n      // Replace this IP address with your FreeSWITCH IP address\n      uri: \\`\\${authorizationUser}@\\${sipServer}:\\${sipPort}\\`,\n      transportOptions: {\n        wsServers: [\\`\\${wsType}://\\${sipServer}:\\${sipPort}\\`]\n      },\n      // Replace sipjs.com with your domain name\n      // and replace the port with your FreeSWITCH wss port\n      ws_servers: \\`\\${wsType}://\\${sipServer}:\\${sipPort}/\\`,\n      // FreeSWITCH Default Username\n      authorizationUser,\n      // FreeSWITCH Default Password\n      password,\n      // displayName: \'8300211193\',\n      hackIpInContact: true,\n      // register: true,\n      sessionDescriptionHandlerFactoryOptions: {\n        constraints: {\n          audio: true,\n          video: false\n        }\n      }\n    };\n\n    this.userAgent = new UA(config);\n\n    this.userAgent.on(\'connected\', () => {\n      console.log(\'连接成功\');\n    });\n\n    this.userAgent.on(\'disconnected\', () => {\n      console.log(\'连接断开\');\n    });\n\n    this.userAgent.on(\'registered\', () => {\n      console.log(\'注册成功\');\n      this.hasSignedIn = true;\n      this.signInResolve();\n    });\n\n    this.userAgent.on(\'unregistered\', () => {\n      console.log(\'反注册成功\');\n      this.upperSelf.onAgentStateChange && this.upperSelf.onAgentStateChange(\'0\', \'2\');\n      this.hasSignedIn = false;\n      this.signInReject();\n    });\n\n    this.userAgent.on(\'registrationFailed\', () => {\n      console.log(\'注册失败\');\n      this.hasSignedIn = false;\n      this.signInReject();\n    });\n\n    this.userAgent.once(\'transportCreated\', (transport) => {\n      console.log(\'transportCreated\', transport);\n    });\n\n    this.userAgent.on(\'message\', () => {\n      console.log(\'message\');\n    });\n\n    this.userAgent.on(\'invite\', (incomingSession) => {\n      console.log(\'incomingSession\', incomingSession);\n      this.session = incomingSession;\n      this.session.accept();\n      // 播放对方会话\n      this.session.on(\'trackAdded\', () => {\n        console.log(\'trackAdded\');\n        const pc = this.session.sessionDescriptionHandler.peerConnection;\n        // Gets remote tracks\n        const remoteStream = new MediaStream();\n        pc.getReceivers().forEach((receiver) => {\n          remoteStream.addTrack(receiver.track);\n        });\n        this.remoteView.srcObject = remoteStream;\n        this.remoteView.play();\n      });\n      this.session.on(\'progress\', (response) => {\n        console.log(\'progress\', response);\n      });\n      this.session.on(\'failed\', (response, cause) => {\n        console.log(\'failed\', response, cause);\n      });\n      // 响铃动作\n      this.session.on(\'accepted\', (data) => {\n        console.log(\'accepted\', data);\n      });\n      this.session.on(\'rejected\', (response, cause) => {\n        console.log(\'rejected\', response, cause);\n      });\n      // 挂断动作\n      this.session.on(\'terminated\', (message, cause) => {\n        console.log(\'terminated\', message, cause);\n      });\n      this.session.on(\'referRequested\', () => {\n        console.log(\'referRequested\');\n      });\n      this.session.on(\'reinvite\', () => {\n        console.log(\'reinvite\');\n      });\n      this.session.on(\'replaced\', () => {\n        console.log(\'replaced\');\n      });\n      this.session.on(\'cancel\', () => {\n        console.log(\'cancel\');\n      });\n      // 挂断动作\n      this.session.on(\'bye\', (request) => {\n        console.log(\'bye\', request);\n      });\n      this.session.on(\'directionChanged\', () => {\n        console.log(\'directionChanged\');\n      });\n      this.session.on(\'SessionDescriptionHandler-created\', () => {\n        console.log(\'SessionDescriptionHandler-created\');\n      });\n    });\n  }\n\n  // 来电挂断\n  hangup() {\n    console.log(\'挂断\', this.session);\n    if (this.session) {\n      this.session.bye();\n    }\n  }\n\n  signOut() {\n    console.log(\'退出登录成功\');\n    if (this.userAgent) {\n      this.userAgent.stop();\n      this.userAgent = null;\n    }\n    if (this.session) {\n      this.session.terminate();\n      this.session = null;\n    }\n    this.hasSignedIn = false;\n  }\n\n  // 603 Decline\n  // 当成功访问到被叫方的设备，但是用户明确的不想应答。这个应答可以通过增加一个Retry-After头域更明确的告诉呼叫方多久以后可以继续呼叫\n  // 只有当终端知道没有其他任何终端设备能够响应这个呼叫的势能才能给出这个应答。\n  makeIdle() {\n    console.log(\'在忙\');\n    // this.session.reply({\n    //   statusCode: \'486\',\n    // });\n  }\n}\n\nexport default Call;`, `2358093480850942500`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                js 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// Call</span>\n<span class="token keyword">import</span> <span class="token punctuation">{</span> <span class="token constant">UA</span> <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">\'./libs/sip-0.14.1\'</span><span class="token punctuation">;</span>\n\n<span class="token keyword">class</span> <span class="token class-name">Call</span> <span class="token punctuation">{</span>\n  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token comment">// eslint-disable-next-line constructor-super</span>\n    <span class="token keyword">this</span><span class="token punctuation">.</span>callInfo <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>\n    <span class="token keyword">this</span><span class="token punctuation">.</span>userAgent <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span> <span class="token comment">// 注册 SIP 后实例</span>\n    <span class="token keyword">this</span><span class="token punctuation">.</span>session <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span> <span class="token comment">// 拨打成功后 session 实例</span>\n    <span class="token keyword">this</span><span class="token punctuation">.</span>remoteView <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">this</span><span class="token punctuation">.</span>hasSignedIn <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>\n    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">createElements</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    window<span class="token punctuation">.</span><span class="token function-variable function">onbeforeunload</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n      <span class="token comment">// eslint-disable-line</span>\n      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">signOut</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n\n  <span class="token function">createElements</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">this</span><span class="token punctuation">.</span>remoteView <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">\'video\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">this</span><span class="token punctuation">.</span>remoteView<span class="token punctuation">.</span>style<span class="token punctuation">.</span>display <span class="token operator">=</span> <span class="token string">\'none\'</span><span class="token punctuation">;</span>\n    document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>remoteView<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n\n  <span class="token keyword">async</span> <span class="token function">signIn</span><span class="token punctuation">(</span><span class="token parameter">callInfo</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">const</span> <span class="token punctuation">{</span> ws_domain<span class="token punctuation">:</span> sipServer<span class="token punctuation">,</span> ws_port<span class="token punctuation">:</span> sipPort<span class="token punctuation">,</span> ws_protocol<span class="token punctuation">:</span> wsType <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">getCallInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n      <span class="token keyword">this</span><span class="token punctuation">.</span>signInResolve <span class="token operator">=</span> resolve<span class="token punctuation">;</span>\n      <span class="token keyword">this</span><span class="token punctuation">.</span>signInReject <span class="token operator">=</span> reject<span class="token punctuation">;</span>\n      <span class="token keyword">this</span><span class="token punctuation">.</span>callInfo <span class="token operator">=</span> <span class="token punctuation">{</span>\n        authorizationUser<span class="token punctuation">:</span> callInfo<span class="token punctuation">.</span>agent_id<span class="token punctuation">,</span>\n        password<span class="token punctuation">:</span> callInfo<span class="token punctuation">.</span>agent_pwd<span class="token punctuation">,</span>\n        sipServer<span class="token punctuation">,</span>\n        sipPort<span class="token punctuation">,</span>\n        wsType\n      <span class="token punctuation">}</span><span class="token punctuation">;</span>\n      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">registerSip</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n\n  <span class="token comment">// 注册分机（软电话）</span>\n  <span class="token function">registerSip</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">const</span> <span class="token punctuation">{</span> authorizationUser<span class="token punctuation">,</span> password<span class="token punctuation">,</span> sipServer<span class="token punctuation">,</span> sipPort<span class="token punctuation">,</span> wsType <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>callInfo<span class="token punctuation">;</span>\n    <span class="token keyword">const</span> config <span class="token operator">=</span> <span class="token punctuation">{</span>\n      <span class="token comment">// Replace this IP address with your FreeSWITCH IP address</span>\n      uri<span class="token punctuation">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>authorizationUser<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">@</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>sipServer<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>sipPort<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>\n      transportOptions<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n        wsServers<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>wsType<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">://</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>sipServer<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>sipPort<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">]</span>\n      <span class="token punctuation">}</span><span class="token punctuation">,</span>\n      <span class="token comment">// Replace sipjs.com with your domain name</span>\n      <span class="token comment">// and replace the port with your FreeSWITCH wss port</span>\n      ws_servers<span class="token punctuation">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>wsType<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">://</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>sipServer<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>sipPort<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>\n      <span class="token comment">// FreeSWITCH Default Username</span>\n      authorizationUser<span class="token punctuation">,</span>\n      <span class="token comment">// FreeSWITCH Default Password</span>\n      password<span class="token punctuation">,</span>\n      <span class="token comment">// displayName: \'8300211193\',</span>\n      hackIpInContact<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>\n      <span class="token comment">// register: true,</span>\n      sessionDescriptionHandlerFactoryOptions<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n        constraints<span class="token punctuation">:</span> <span class="token punctuation">{</span>\n          audio<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>\n          video<span class="token punctuation">:</span> <span class="token boolean">false</span>\n        <span class="token punctuation">}</span>\n      <span class="token punctuation">}</span>\n    <span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">this</span><span class="token punctuation">.</span>userAgent <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">UA</span><span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">this</span><span class="token punctuation">.</span>userAgent<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">\'connected\'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">\'连接成功\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">this</span><span class="token punctuation">.</span>userAgent<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">\'disconnected\'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">\'连接断开\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">this</span><span class="token punctuation">.</span>userAgent<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">\'registered\'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">\'注册成功\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token keyword">this</span><span class="token punctuation">.</span>hasSignedIn <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>\n      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">signInResolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">this</span><span class="token punctuation">.</span>userAgent<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">\'unregistered\'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">\'反注册成功\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token keyword">this</span><span class="token punctuation">.</span>upperSelf<span class="token punctuation">.</span>onAgentStateChange <span class="token operator">&amp;&amp;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>upperSelf<span class="token punctuation">.</span><span class="token function">onAgentStateChange</span><span class="token punctuation">(</span><span class="token string">\'0\'</span><span class="token punctuation">,</span> <span class="token string">\'2\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token keyword">this</span><span class="token punctuation">.</span>hasSignedIn <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>\n      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">signInReject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">this</span><span class="token punctuation">.</span>userAgent<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">\'registrationFailed\'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">\'注册失败\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token keyword">this</span><span class="token punctuation">.</span>hasSignedIn <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>\n      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">signInReject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">this</span><span class="token punctuation">.</span>userAgent<span class="token punctuation">.</span><span class="token function">once</span><span class="token punctuation">(</span><span class="token string">\'transportCreated\'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">transport</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">\'transportCreated\'</span><span class="token punctuation">,</span> transport<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">this</span><span class="token punctuation">.</span>userAgent<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">\'message\'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">\'message\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">this</span><span class="token punctuation">.</span>userAgent<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">\'invite\'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">incomingSession</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">\'incomingSession\'</span><span class="token punctuation">,</span> incomingSession<span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token keyword">this</span><span class="token punctuation">.</span>session <span class="token operator">=</span> incomingSession<span class="token punctuation">;</span>\n      <span class="token keyword">this</span><span class="token punctuation">.</span>session<span class="token punctuation">.</span><span class="token function">accept</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token comment">// 播放对方会话</span>\n      <span class="token keyword">this</span><span class="token punctuation">.</span>session<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">\'trackAdded\'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">\'trackAdded\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token keyword">const</span> pc <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>session<span class="token punctuation">.</span>sessionDescriptionHandler<span class="token punctuation">.</span>peerConnection<span class="token punctuation">;</span>\n        <span class="token comment">// Gets remote tracks</span>\n        <span class="token keyword">const</span> remoteStream <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MediaStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n        pc<span class="token punctuation">.</span><span class="token function">getReceivers</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">receiver</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n          remoteStream<span class="token punctuation">.</span><span class="token function">addTrack</span><span class="token punctuation">(</span>receiver<span class="token punctuation">.</span>track<span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token keyword">this</span><span class="token punctuation">.</span>remoteView<span class="token punctuation">.</span>srcObject <span class="token operator">=</span> remoteStream<span class="token punctuation">;</span>\n        <span class="token keyword">this</span><span class="token punctuation">.</span>remoteView<span class="token punctuation">.</span><span class="token function">play</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token keyword">this</span><span class="token punctuation">.</span>session<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">\'progress\'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">response</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">\'progress\'</span><span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token keyword">this</span><span class="token punctuation">.</span>session<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">\'failed\'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">response<span class="token punctuation">,</span> cause</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">\'failed\'</span><span class="token punctuation">,</span> response<span class="token punctuation">,</span> cause<span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token comment">// 响铃动作</span>\n      <span class="token keyword">this</span><span class="token punctuation">.</span>session<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">\'accepted\'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">\'accepted\'</span><span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token keyword">this</span><span class="token punctuation">.</span>session<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">\'rejected\'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">response<span class="token punctuation">,</span> cause</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">\'rejected\'</span><span class="token punctuation">,</span> response<span class="token punctuation">,</span> cause<span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token comment">// 挂断动作</span>\n      <span class="token keyword">this</span><span class="token punctuation">.</span>session<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">\'terminated\'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">message<span class="token punctuation">,</span> cause</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">\'terminated\'</span><span class="token punctuation">,</span> message<span class="token punctuation">,</span> cause<span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token keyword">this</span><span class="token punctuation">.</span>session<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">\'referRequested\'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">\'referRequested\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token keyword">this</span><span class="token punctuation">.</span>session<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">\'reinvite\'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">\'reinvite\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token keyword">this</span><span class="token punctuation">.</span>session<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">\'replaced\'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">\'replaced\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token keyword">this</span><span class="token punctuation">.</span>session<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">\'cancel\'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">\'cancel\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token comment">// 挂断动作</span>\n      <span class="token keyword">this</span><span class="token punctuation">.</span>session<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">\'bye\'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">request</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">\'bye\'</span><span class="token punctuation">,</span> request<span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token keyword">this</span><span class="token punctuation">.</span>session<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">\'directionChanged\'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">\'directionChanged\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token keyword">this</span><span class="token punctuation">.</span>session<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">\'SessionDescriptionHandler-created\'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">\'SessionDescriptionHandler-created\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n\n  <span class="token comment">// 来电挂断</span>\n  <span class="token function">hangup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">\'挂断\'</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>session<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>session<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token keyword">this</span><span class="token punctuation">.</span>session<span class="token punctuation">.</span><span class="token function">bye</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n  <span class="token punctuation">}</span>\n\n  <span class="token function">signOut</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">\'退出登录成功\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>userAgent<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token keyword">this</span><span class="token punctuation">.</span>userAgent<span class="token punctuation">.</span><span class="token function">stop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token keyword">this</span><span class="token punctuation">.</span>userAgent <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>session<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token keyword">this</span><span class="token punctuation">.</span>session<span class="token punctuation">.</span><span class="token function">terminate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token keyword">this</span><span class="token punctuation">.</span>session <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n    <span class="token keyword">this</span><span class="token punctuation">.</span>hasSignedIn <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n\n  <span class="token comment">// 603 Decline</span>\n  <span class="token comment">// 当成功访问到被叫方的设备，但是用户明确的不想应答。这个应答可以通过增加一个Retry-After头域更明确的告诉呼叫方多久以后可以继续呼叫</span>\n  <span class="token comment">// 只有当终端知道没有其他任何终端设备能够响应这个呼叫的势能才能给出这个应答。</span>\n  <span class="token function">makeIdle</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">\'在忙\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token comment">// this.session.reply({</span>\n    <span class="token comment">//   statusCode: \'486\',</span>\n    <span class="token comment">// });</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">export</span> <span class="token keyword">default</span> Call<span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h1 id="疑难问题"><a href="#%E7%96%91%E9%9A%BE%E9%97%AE%E9%A2%98" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>疑难问题</h1>\n<p>以上因为 freeswitch 第三方线路的失败回调导致挂断电话不能正常挂断，此时最佳的解决办法就是后端写 websocket 来推送给前端以做到实时更新，否则总是有些不成功的回调导致 UI 显示错误，现阶段主要采用轮询后端的方式来获取最新的状态。</p>\n<p>以上更新于<code class="language-text">2019-6-10 20:20:52</code></p>\n<hr>\n<h1 id="实现效果"><a href="#%E5%AE%9E%E7%8E%B0%E6%95%88%E6%9E%9C" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>实现效果</h1>\n<p>\n  <a\n    class="gatsby-resp-image-link"\n    href="/static/2019-06-10-20-13-17-e7449dfdbccd9eff74982deac6aa1e14-d42cb.png"\n    style="display: block"\n    target="_blank"\n    rel="noopener"\n  >\n  \n  <span\n    class="gatsby-resp-image-wrapper"\n    style="position: relative; display: block; ; max-width: 407px; margin-left: auto; margin-right: auto;"\n  >\n    <span\n      class="gatsby-resp-image-background-image"\n      style="padding-bottom: 107.37100737100738%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAVCAIAAADJt1n/AAAACXBIWXMAAA7DAAAOwwHHb6hkAAAC50lEQVQ4y3WUWW4TQRCGfRwilHgWe2a8Jk5CVie2Z/Esnhk7ju04xNl4gQeIeAURieUAHARxFQSchK+7k4AiIZXbf5Vr+aury4WyZQf90A/6QRjW6g1NMwyzdCeGqRsmQJ2lsoXgz9loNC3LLlSqNcSpVG2nCqjWalVx1h/LP0ZqiLNWL4hkSiyb0yyVRUHdoBpY042ipgOEcl9Zk4xs2yn8JWmWsEKh0+0Nh6M0y2lnMp0ejceu53l+oNItrxQPO92d3T3yFlRWIdQ0S3SyvrF5cNjZ29/f3tnFj7Ct7R3ElG0Ts7H5bK21jiaCbaciexYngsfD9YjUUsAPPjDHYtl2wbKdMIphOEizOBkA+mEUhhEA5ghqFMdiHNKSDFIs3Z5LYIFkWZZHcXIyPx0fTwBpmpOIjGeL8+nsBEueD8mrLLOTOYBeRLCYMznRPR8ToOd6Cvh+4EuA7rpeGCeu8gmjdvsA5qJyLK2T6ex4MgWgQhQwm50MR0d4DwYp+V0vOH1+NhodkbHnugSKnvv90HM9yMMW4AcBQjVUOgTg4MpxEZkkA4KZgqRtO3SFCVfhnQxwhZiyEMwXKkYAKvY0zXo9l6kK2iJ90Ic2JLlVVK4HBpdX11wYTDJ554CLyyvc8IGIoM2FidlEMSKnksBKXSFYCd5EApQbqTudbpnKUI/knLN8mMiLCeWcCeD+8uFI5klI59+zw8Kcxdvmo8JGR2NcRUdpluZ5lKYXV1ez+Txm7qMR1ZDF4px4fEhkO06Bd9horjZX1zgVqDeaNatWt+q26dTLAgiV39Zaah8BnPQr3rYuV+xOdFMvlZpv/NbnrP1x0ryN17/kzde+rhn8TYi1teyiprEeomf16O/EsiBSrjjt7y8Of97c/Pq6+PGp8/tt+9t1yRQ7t7u3zzIacm/uKj+WsrX6ymt9SLfe5d3309ZtuvrSMw2xs2RXK2X+N5hGnur6kqYtFZefrABQlV39Zwggg/8AMdtoygCum2QAAAAASUVORK5CYII=\'); background-size: cover; display: block;"\n    >\n      <img\n        class="gatsby-resp-image-image"\n        style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;"\n        alt="2019 06 10 20 13 17"\n        title=""\n        src="/static/2019-06-10-20-13-17-e7449dfdbccd9eff74982deac6aa1e14-d42cb.png"\n        srcset="/static/2019-06-10-20-13-17-e7449dfdbccd9eff74982deac6aa1e14-68801.png 200w,\n/static/2019-06-10-20-13-17-e7449dfdbccd9eff74982deac6aa1e14-d3489.png 400w,\n/static/2019-06-10-20-13-17-e7449dfdbccd9eff74982deac6aa1e14-d42cb.png 407w"\n        sizes="(max-width: 407px) 100vw, 407px"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<p>\n  <a\n    class="gatsby-resp-image-link"\n    href="/static/2019-06-10-20-15-11-12c3396656165e1bd7b9806e449b6697-17038.png"\n    style="display: block"\n    target="_blank"\n    rel="noopener"\n  >\n  \n  <span\n    class="gatsby-resp-image-wrapper"\n    style="position: relative; display: block; ; max-width: 463px; margin-left: auto; margin-right: auto;"\n  >\n    <span\n      class="gatsby-resp-image-background-image"\n      style="padding-bottom: 117.27861771058315%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAXCAIAAACEf/j0AAAACXBIWXMAAA7DAAAOwwHHb6hkAAAC4UlEQVQ4y41US0/bQBD2z2nLI3aefsWQxMT2Ou84CUnsJBDIgxJAfd577rU/oTf6GzjSE5ckSFSkUi+gHuEO6bc2iqLSQFej0ay9387MNzPLcP5ALKEaWtKnEKG45+c4lvM/LYAIogSDCUf4XKFoVysBrZrsfOL5SDAcCT0pgChr6zAYXhBFUeJFSZElIcjRrSR7AnuRRHgBmkEMVqlkO47daCL+peWV5ZXVV0vLMHzsMykwgWBIN0i1Vq9sVpOaHk+oRcvCtlC05KgCPG5fJBRMzFS322vv7MAwiAnj8OhoZ7ezHosD7A8EF4LxT9ONjaSmGUSSoyurPggih/aInQfDnt9SsJlKw2cmm4Mr11MICto76mU+s+cToWGnM9ler9/pdoFH/sh5t9PN5vJIgRCz1+83mi1NJ/jV7fUHB4dgF3Q8EJYvFJxGs9lq4RbEn8sXanUbNvgDvlarl8oV2PhVtx3baVilMgpJwQgGnwaDg/cfPm5WazgE2vf3B2CbejZTe3uvHaeBazzPb96+a21tgx0KDobCOIS7Ibgb4FQ6U7dt6Kiy5iXvCdzM217O4Vg8gVDLlU11Iwk8+EOS0ADPqHosFAzP+UIRfrBHV3l1eokWc6u1SNw6umCwtbXdBkOaptPcdMNwtQ6G/yWGYaIRKRipn52dTSY/IVdXV7+fW9fX1zc3NycnJxSM4bq9vZ1Op/f399P/WHd3d9DD4RBpMhjr09PvFxc/xuPx+fk51JiumfH3Go1Gl5eT4+NvLOunYF6QoF1DhEYDeLYsKyB8XpCjQL9HqSFKDB6EdMrMZjKoDRoTtKPU6A00CTJCSWcPCOxoQiWWJasqaIYwLBeQVHMtmcJRcIiao9rgG/XD9SjJw7vF+Zd87Jaqfmm3B4SgWjTnQCgSt9pKuqaqKloNHM6mcn6AMI0vWO7zeuzXbucrIaw7Xu5jgIrqGnoLMeNxm3XV4+lfxdUsB40zGKw/Rju/D0XzkCoAAAAASUVORK5CYII=\'); background-size: cover; display: block;"\n    >\n      <img\n        class="gatsby-resp-image-image"\n        style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;"\n        alt="2019 06 10 20 15 11"\n        title=""\n        src="/static/2019-06-10-20-15-11-12c3396656165e1bd7b9806e449b6697-17038.png"\n        srcset="/static/2019-06-10-20-15-11-12c3396656165e1bd7b9806e449b6697-ebf63.png 200w,\n/static/2019-06-10-20-15-11-12c3396656165e1bd7b9806e449b6697-37c59.png 400w,\n/static/2019-06-10-20-15-11-12c3396656165e1bd7b9806e449b6697-17038.png 463w"\n        sizes="(max-width: 463px) 100vw, 463px"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<p>\n  <a\n    class="gatsby-resp-image-link"\n    href="/static/2019-06-10-20-16-33-10e6d5bc526cb8b2d68f7c178624429f-cac7f.png"\n    style="display: block"\n    target="_blank"\n    rel="noopener"\n  >\n  \n  <span\n    class="gatsby-resp-image-wrapper"\n    style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;"\n  >\n    <span\n      class="gatsby-resp-image-background-image"\n      style="padding-bottom: 21.52542372881356%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAIAAAABPYjBAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAArklEQVQI1y2O2Q6CMBBF+f9vU1BEsZ3pQmfYRCMKxiU+OFWTk5M7NzdpEx1K3xjXoG3gB7KyNfzwnXEtGtYyoMG1Ix9vvVhXpThxDJbBEJi4jjskhaSNwOBiA+Z7Niee3xfhOB8gaHGypWzj0yJE5y6Nucpyt5Swo7X0RVjlPl3bBR7K/k79g8KIcooTyxqCMqTkzS+AQWlfYmxi/n+EoTvX1+d5eo3DtdfVfpi6Dx0E0hghIQOYAAAAAElFTkSuQmCC\'); background-size: cover; display: block;"\n    >\n      <img\n        class="gatsby-resp-image-image"\n        style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;"\n        alt="2019 06 10 20 16 33"\n        title=""\n        src="/static/2019-06-10-20-16-33-10e6d5bc526cb8b2d68f7c178624429f-fee1c.png"\n        srcset="/static/2019-06-10-20-16-33-10e6d5bc526cb8b2d68f7c178624429f-a67b7.png 200w,\n/static/2019-06-10-20-16-33-10e6d5bc526cb8b2d68f7c178624429f-0b187.png 400w,\n/static/2019-06-10-20-16-33-10e6d5bc526cb8b2d68f7c178624429f-fee1c.png 800w,\n/static/2019-06-10-20-16-33-10e6d5bc526cb8b2d68f7c178624429f-cac7f.png 1180w"\n        sizes="(max-width: 800px) 100vw, 800px"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>',
id:"/github/workspace/blog/基于SIP协议云端电话的实践/index.md absPath of file >>> MarkdownRemark",timeToRead:3,frontmatter:{date:"2019-06-10 11:44:03",path:"/sip-protocol-practice/",tags:"前端, SIP, webrtc, 预研",title:"基于SIP协议云端电话的实践",draft:null}},{excerpt:"会话发起协议（SIP）是 VoIP 技术中最常用的协议之一。它是一种应用层协议，与其他应用层协议协同工作，通过 Internet 控制多媒体通信会话。 概述 SIP 是用于通过因特网协议创建，修改和终止多媒体会话的信令协议。会话只不过是两个端点之间的简单调用。端点可以是智能电话，笔记本电脑或可以通过因特网接收和发送多媒体内容的任何设备。 SIP 是由 IETF（Internet Engineering Task Force） 标准定义的应用层协议。它在 RFC 3261 中定义。 SIP…",html:'<p>会话发起协议（SIP）是 VoIP 技术中最常用的协议之一。它是一种应用层协议，与其他应用层协议协同工作，通过 Internet 控制多媒体通信会话。</p>\n<h1 id="概述"><a href="#%E6%A6%82%E8%BF%B0" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>概述</h1>\n<ul>\n<li>SIP 是用于通过因特网协议创建，修改和终止多媒体会话的信令协议。会话只不过是两个端点之间的简单调用。端点可以是智能电话，笔记本电脑或可以通过因特网接收和发送多媒体内容的任何设备。</li>\n<li>SIP 是由 IETF（Internet Engineering Task Force） 标准定义的应用层协议。它在 RFC 3261 中定义。</li>\n<li>SIP 体现了客户端 - 服务器体系结构，以及使用 HTTP 和 URL 的 URL 和 URI 以及 SMTP 的文本编码方案和头样式。</li>\n<li>SIP 采用 SDP（会话描述协议） 的帮助，它描述了用于通过 IP 网络传送语音和视频的会话和 RTP（实时传输协议）。</li>\n<li>SIP 可用于双方（单播）或多方（多播）会话。</li>\n<li>其他 SIP 应用包括文件传输，即时通讯，视频会议，网络游戏，以及流多媒体分发。</li>\n</ul>\n<p>下图说明了 SIP 在一般方案中的适用性：</p>\n<p>\n  <a\n    class="gatsby-resp-image-link"\n    href="/static/2019-06-10-11-59-57-0bd90a523363ae44be5b2b5404553e73-ae33f.png"\n    style="display: block"\n    target="_blank"\n    rel="noopener"\n  >\n  \n  <span\n    class="gatsby-resp-image-wrapper"\n    style="position: relative; display: block; ; max-width: 391px; margin-left: auto; margin-right: auto;"\n  >\n    <span\n      class="gatsby-resp-image-background-image"\n      style="padding-bottom: 138.3631713554987%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAcCAIAAADuuAg3AAAACXBIWXMAAA7DAAAOwwHHb6hkAAADy0lEQVQ4y02U2S/jURTHf3+DeCHxYN9DIkHif/AkXomE2qrtaKltqFqr9jG2zLRCYoklwzBoEYraZkxCePcgvEgk/oD59J62me/DzbnnnnO+Z7n3aq+vr06ns6enx263d3Z2hlcRBN3d3V1dXfYQ+vr6bDbbwcGBtr6+HhkZGRMTk5+fn52dnZaWlpeXl5GRkZKSkpubm5WVlZ6enpycjCY1NZXTzMzM2NjYiIiIoqIibWNjg4OcnJy6urr+/v7m5ubq6mqDwWA2m00mk9VqZS0sLETT0tLS1tZWW1tbUFCAS2lpqba2thYVFZWYmJiQkIAKnvj4+KSkJNGwxsXFoYEcWsihRR8dHV1cXKxRMzVInTYF5I6ODtbPClJtuH62tIAUPB6P9vz87Ha7vyu4XC7WhYWFpaWllZWVubm52dnZbwouhbDZzMzMycmJdnh4qNPpqPCTApVDS7ixsTFIJiYmpqamMHU4HCYFbOrr6/V6Pfza2dmZ0Whkj9as0NTURJ5Whd7eXqZIlNbWVjkVDqKMjIxop6enlZWVWGNBPLSQCwkCGgldU1ODhllgSTg0dCrgTNowMCc4JXNWBoYFnrDhQxT829vbMRsYGLBYLLgEnBldVVUVIRBqFPBEJiP0CGzDep0CwtDQUDBtSoKW8PBAKKskb1FA09DQgCBXhTtDC4Npc70HBwelTg4gIRCmHOHT2NgoWSBjOTo6iobKA87kIA0ERgUJwUrO0gUEaadMiy1Rgs4GBVRQYSSm8MPGqcTSK4iMAZkGnameubEXQshxEwcyJNuKigr0XE9y5v7Q/8Cojo+PS0pKzCGQFVGxo0gEqYIUZCu9JBYJMnDt5eWFq/slhIkQJicnYYDn638Im3Hk8/m09/f33d3dnZ2dXwrb29vIW1tbrD8UEH6GIGbYb25uPjw8aEdHR2VlZeRJ5bxHKufqOBTYMg+53qzdCtJL0uY6a7DTeubO9HlPzhBwlgfMZcSTjqLBGTNuFG9meHg48CTLy8tlwkRFS88xYqWfRIEfN7ZcQTrHCKSFAWZ+Eh69W4GHjiyfwerq6uLi4vz8/PLyMv8cW2S+Aczkk+Atax8fH38Ubm9v7+7u/iqI5vLy8urqCv1vhf+Prq+vn56eNBz29/cJw7cCFZ2k4R6Fvb092u71elHyS2OG0qfA1UKvPT4+4natwNypdnp6mvbSp/HxcQZO2sjUjJLkSYGMbm5uAn/Y/f098fx+v5DDwPC8CgiigZkho4Hz/PwcS9YA89vbG5Jf4eLigqiyihCWKV40YknapPwPExCBytBOBXIAAAAASUVORK5CYII=\'); background-size: cover; display: block;"\n    >\n      <img\n        class="gatsby-resp-image-image"\n        style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;"\n        alt="2019 06 10 11 59 57"\n        title=""\n        src="/static/2019-06-10-11-59-57-0bd90a523363ae44be5b2b5404553e73-ae33f.png"\n        srcset="/static/2019-06-10-11-59-57-0bd90a523363ae44be5b2b5404553e73-12493.png 200w,\n/static/2019-06-10-11-59-57-0bd90a523363ae44be5b2b5404553e73-ae33f.png 391w"\n        sizes="(max-width: 391px) 100vw, 391px"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<p>通常，SIP 协议用于两个或多个端点之间的互联网电话和多媒体分发。例如，一个人可以使用 SIP 发起对另一个人的电话呼叫，或者有人可以与许多参与者建立电话会议。</p>\n<p>SIP 协议的设计非常简单，配置有限的命令。它也是基于文本的，所以任何人都可以读取 SIP 会话中的端点之间传递的 SIP 消息。</p>\n<p>有一些实体帮助 SIP 创建其网络。在 SIP 中，每个网元由 SIP URI（统一资源标识符） 来标识，它像一个地址。以下是网络元素：</p>\n<ul>\n<li>用户代理</li>\n<li>代理服务器</li>\n<li>注册服务器</li>\n<li>重定向服务器</li>\n<li>位置服务器</li>\n</ul>\n<h2 id="用户代理"><a href="#%E7%94%A8%E6%88%B7%E4%BB%A3%E7%90%86" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>用户代理</h2>\n<p>它是 SIP 网络的端点和最重要的网络元素之一。端点可以启动，修改或终止会话。用户代理是 SIP 网络中最智能的设备或网络元件。它可以是软电话，手机或笔记本电脑。</p>\n<p>用户代理在逻辑上分为两部分：</p>\n<ul>\n<li>用户代理客户端（UAC） - 发送请求并接收响应的实体。</li>\n<li>用户代理服务器（UAS） - 接收请求并发送响应的实体。</li>\n</ul>\n<p>SIP 基于客户机 - 服务器架构，其中呼叫者的电话充当发起呼叫的客户端，被叫方的电话充当响应呼叫的服务器。</p>\n<h2 id="代理服务器"><a href="#%E4%BB%A3%E7%90%86%E6%9C%8D%E5%8A%A1%E5%99%A8" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>代理服务器</h2>\n<p>网络元素接收来自用户代理的请求并将其转发给另一个用户。</p>\n<ul>\n<li>基本上代理服务器的作用就像一个路由器。</li>\n<li>它有一些智慧来了解 SIP 请求，并在 URI 的帮助下发送它。</li>\n<li>代理服务器位于两个用户代理之间。</li>\n<li>源和目的地之间最多可以有 70 个代理服务器。</li>\n</ul>\n<p>有两种类型的代理服务器：</p>\n<ul>\n<li>无状态代理服务器 - 它只是转发收到的消息。这种类型的服务器不存储任何呼叫或交易的信息。</li>\n<li>有状态代理服务器 - 这种类型的代理服务器可以跟踪收到的每个请求和响应，并且如果需要，可以将来使用它。如果对方没有响应，它可以重新发送请求。</li>\n</ul>\n<h2 id="注册服务器"><a href="#%E6%B3%A8%E5%86%8C%E6%9C%8D%E5%8A%A1%E5%99%A8" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>注册服务器</h2>\n<p>注册服务器接受用户代理的注册请求。它可以帮助用户在网络中进行身份验证。它将 URI 和用户的位置存储在数据库中，以帮助同一域内的其他 SIP 服务器。</p>\n<p>看看下面的示例，显示 SIP 注册的过程：</p>\n<p>\n  <a\n    class="gatsby-resp-image-link"\n    href="/static/2019-06-10-14-04-44-4eb490983807564e1c88fba3a92a375e-16a51.png"\n    style="display: block"\n    target="_blank"\n    rel="noopener"\n  >\n  \n  <span\n    class="gatsby-resp-image-wrapper"\n    style="position: relative; display: block; ; max-width: 324px; margin-left: auto; margin-right: auto;"\n  >\n    <span\n      class="gatsby-resp-image-background-image"\n      style="padding-bottom: 62.96296296296296%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAIAAAAmMtkJAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABoElEQVQoz5VSWVOCUBTm/7/4H+rJl7JtpmZkiUAsSNZroCzSAtoVyRG75ih1zBHU6qHzcDjnO/t3oZ4eQ0mUCJl9/l+oe0Wh60wvDAkhv2bkeQ46cB2eFwxdl+U7luHlu9th8kbRddpCbV3XXnFSpIL6/pYyIwTj4RDjJEmiuI8xficf1HQ6jeMYwsuN5Ju6/Fu2wUmWjdK0mEFBD4RQkQqG77nnZxfXLMexLHpwtkNRFHW73fWkVfFkMqlUKrIsa5rWUlVd0xoN8eryiqZpjuMEQQRcVdVWq2UYBoCu65aT0zQVRXE+n882AvYSll0sF4tFgQOd4IZh6HleWTwajbb97Wv3ENBwYxAEO5MVRRmPx0AjNAJ3iAcHhwcntaPj2ikQCwjgEM2yDDJt2y6LoYxhGICANsuy1hruNOBNdR3sNkJr0Pf9arVqmmZJGLR0HGdv7b9+lX6/v0MYWb0+Busx7Kma+mDbQa/nuh3PC2zH8X3vJY47Hfv5JYIcmDQYDMriwkKWeSPwzWYTbuV5tiHd0gwrNSUTWYLAm1b753Zfns7NFTZjlLcAAAAASUVORK5CYII=\'); background-size: cover; display: block;"\n    >\n      <img\n        class="gatsby-resp-image-image"\n        style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;"\n        alt="2019 06 10 14 04 44"\n        title=""\n        src="/static/2019-06-10-14-04-44-4eb490983807564e1c88fba3a92a375e-16a51.png"\n        srcset="/static/2019-06-10-14-04-44-4eb490983807564e1c88fba3a92a375e-6752f.png 200w,\n/static/2019-06-10-14-04-44-4eb490983807564e1c88fba3a92a375e-16a51.png 324w"\n        sizes="(max-width: 324px) 100vw, 324px"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<p>这里呼叫者想要向 TMC 域注册。因此，它向 TMC 的 Registrar 服务器发送 REGISTER 请求，并且服务器在授权客户端时返回 200 OK 响应。</p>\n<h2 id="重定向服务器"><a href="#%E9%87%8D%E5%AE%9A%E5%90%91%E6%9C%8D%E5%8A%A1%E5%99%A8" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>重定向服务器</h2>\n<p>重定向服务器接收请求，并在注册器创建的位置数据库中查找请求的预期收件人。</p>\n<p>重定向服务器使用数据库获取位置信息，并以 3xx（重定向响应） 响应给用户。我们将在本教程的后面讨论响应代码。</p>\n<h2 id="位置服务器"><a href="#%E4%BD%8D%E7%BD%AE%E6%9C%8D%E5%8A%A1%E5%99%A8" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>位置服务器</h2>\n<p>位置服务器提供有关呼叫者可能的位置到重定向和代理服务器的信息。</p>\n<p>只有代理服务器或重定向服务器可以联系位置服务器。</p>\n<p>下图描绘了每个网络元素在建立会话中所扮演的角色：</p>\n<p>\n  <a\n    class="gatsby-resp-image-link"\n    href="/static/2019-06-10-14-06-20-13440bdd0d351c261f85053275b31948-28759.png"\n    style="display: block"\n    target="_blank"\n    rel="noopener"\n  >\n  \n  <span\n    class="gatsby-resp-image-wrapper"\n    style="position: relative; display: block; ; max-width: 500px; margin-left: auto; margin-right: auto;"\n  >\n    <span\n      class="gatsby-resp-image-background-image"\n      style="padding-bottom: 63.6%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAIAAAAmMtkJAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAB20lEQVQoz4VSz2/TMBTO37sTNw5oQhwQ4gKckLjsgpC4DgmBEAfQmBgrLVvXrmu6po27JG1+2E4cx3bsJDjJGrYdxpMd+f343vf0vRjVvcYgxDNTYFyWpWpMP7qsUZVloY++VRNtcs7aA44jOU/X3vz4yB8NsxUArjM1TcZZU1U24M5qeBOT4vNg8v7XRCW4FCKMY5qmJct6F/Mv/THlQtfkShVlZUQbZ//wdP8ESMErpRiCaHRqL+Zg7bKV7f/pR+cjOL0QNN0EAZjPfM9zIUYZZ1IaL188f/Tm7c6rPQQWm4WFA19zF3kuKNW984wmV4Aj2A4nwNId9PwwbCc3Hu7uPnv65NunD9q3Bv21vayrpAwj5IZxdUOeJpwTHPGMXgtmef5gtjQDgvQclCoh6q6FihLmYJ5Lpb2apekSQHRwcna5cq7BXBX6QMpZLju1cxjlKOrcql1EShxw9fF4eGaBNmT8y3Wa67KlRVa2YEylpI4pqdnpbEKARQiiJN7u+Qa6pUmoeH2AH3wV339OK9vMRE4pFVzI4rYAt/a8XT2M6eN3w529cc/caFdvZRHFK5h4mMii+A/Ycd3e0Y/z4W9zOtmKLHGclHeJ74CbL8zEZZSO/cRG9P4//y+u7uAR2J+vYAAAAABJRU5ErkJggg==\'); background-size: cover; display: block;"\n    >\n      <img\n        class="gatsby-resp-image-image"\n        style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;"\n        alt="2019 06 10 14 06 20"\n        title=""\n        src="/static/2019-06-10-14-06-20-13440bdd0d351c261f85053275b31948-28759.png"\n        srcset="/static/2019-06-10-14-06-20-13440bdd0d351c261f85053275b31948-6ac48.png 200w,\n/static/2019-06-10-14-06-20-13440bdd0d351c261f85053275b31948-4b8bf.png 400w,\n/static/2019-06-10-14-06-20-13440bdd0d351c261f85053275b31948-28759.png 500w"\n        sizes="(max-width: 500px) 100vw, 500px"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<h1 id="系统架构"><a href="#%E7%B3%BB%E7%BB%9F%E6%9E%B6%E6%9E%84" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>系统架构</h1>\n<p>SIP 被构造为分层协议，这意味着其行为根据一组相当独立的处理阶段来描述，只有每个阶段之间的松散耦合。</p>\n<p>\n  <a\n    class="gatsby-resp-image-link"\n    href="/static/2019-06-10-19-31-14-e385c71fd6dcf4e7b44bbad3b8ab1600-b50a0.png"\n    style="display: block"\n    target="_blank"\n    rel="noopener"\n  >\n  \n  <span\n    class="gatsby-resp-image-wrapper"\n    style="position: relative; display: block; ; max-width: 202px; margin-left: auto; margin-right: auto;"\n  >\n    <span\n      class="gatsby-resp-image-background-image"\n      style="padding-bottom: 216.83168316831686%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAArCAIAAAD3xz8iAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAFvUlEQVRIx32WiVMaWRCH+X9TW4myiqLGmOx6lUe8keFGRDlGRUEFRQUUZFAwKrmrclVSlfu+1XzDYyeIZluB9+Z1v75+3T26k5OTFy9ezM/PT3mnLBaL0+mcmZHD4fBCiXi+EA7Pzc15PBNmszQxMREIBB48eIDU8fGx7tatW4ODg8Fg0GQak2V5bnYWmblQiIXP5w8Eg6FQKBJecHsm+fYH/NM+3+jIyMbGBvI6m82GzJ07dySrpa3V+NeFC82tVy/V6Ov0+vbOrjpDfUOj0TQ6bDAa62ovsonGN7Lbmfb2dlX48ePHAwMDbrc7Eomk0+ntErHIZDLb/PGdzfIkU6Ll5eWpqane3t58Pq8K8/n8+XMikcCf8fHx4eFhbJmcnAwG5dnZ2ZmZmenpaYfDMTo6ajKZ0LG4uPjq1auyz3xO/qNPnz69efPm9u3bhUKBUPX19a2vr6O2WCw+f/7848ePR0dHglNI6cSGp9otYsEtm5ub2lYjTf638Nlj8heLxVj8/PmzUqCSdJo2mIQSTTOBqNKs8ZSFj0okNt+/f3/27BkYIAWZdNoiSXt7e2Tx4cOHjx49wudKTWXN3759Ozw8BCfEWZLMBHZoaMhqtTmcTrvdPjI6whMustmsToeDQLx7964cbcwjQ+bxcb8/EF9b39/fPzjYLxYPWeSU3G4+Xzws7uzs7OZ3lWwWYM3IMlngVNVM6kjmzZs3hwb72zv+aayvb2q5ov+7oa31cktrW6PR2NLSIlksrc1GY/Pl5uam7p4eEHT9+nXQoSMqYJt8rq7GALXbxW0TJpMZgz2TXuBhtzvIuau0stmdU75pp8sFoso+K4oCenDY7/fDl0omd3ZyOyXKKtmcoiSTyaXlZVkO+nw+SZKonC9fvqjCWuiJJ0ygz+PxoBbHrl69RpFyKcZQlVh3cHBAdE8hrAoD4uD+/fsrKysif2dBdgqeWva0A2GIdrV2eg7CBJM4FhzgpEpYMJxCmHZQZTbuAZsPHz68fftW4Okcs49LxApgbm1tUevEU7JIZrN5ZGSEyJFk1larlX5E/N+/f6+Zo2qmuMnB2NgYcaaSNjbWE8kEzSSbVdSukkkDLEI9v7DAFcBxdXVVxFwHUMkKTSOTSc+H5iOLi0tLJHU5Go3yQ/ukF8ZWVviPx9fW4vGNRAK4gBNVGCYaYD5fSKytdnZ3NTU1XbpU09HZrtfr6+oNDQ0NQwP9A8NDtTW1+pqLdYYGnzwH+MdMJtKhNsCenp61tbVcTtlKb5FbdMei0aAcBEmxGArjtPEQRkUisGUVBTNB5I8fP1SfqUc1RhYLTMlUSvVWUXZ3dwmPkstlcV1ReJhKpcAZPgNs0QPL8CQA1D32c0aEwSOjg/BQDrCyFQEnFiBPy6iuqvuJ4N+9e/fGjRtSqZMwUhDQ2ogQOwXPs+hjS3pwrFKmsmf9sXvC9/XrV3LGt5Cpqo0/CgsiCnhYWYD/J1zZfSEMrjL7nNZbNQfEFSh88uQJyWPQAAQxaCpHyu+AiRUFRDJLg9rEuCMxtFuXy+WecFssEkVCzWDLy5cvNXmdMIZ6oFeTW9ADKtwOK9Ds6u5uNBgMdYaunt7NzS3RobiXVoemsmZgQKOim4MkhjCLlVjUbrW4PF454LdK1imfH3hRsNwLA0MXQ6hzHY+AFMOaHkzpJUrEb6GQv9bWYnd5GLfwJMvPVQK2GAjsdPRaII23nNF3+N5MpTLb20p2u6+32+72AHJsUeVLBAOeY2NHR4fu6dOn1DNWUfdCnpJy2m1BWY5EFnEPVKsvOqGQsAs1uVyOiYELqs8MHl5L4OOsUNhbWgo3GWr/be9kvhgMDbzKXGlpulirZ15hAs2ov79fdOVyVb1+/ZpyU2ciKfF6F0rvYbxN0UjC4Qg7MsespFRoWEzc31WlJZ13EoYz15Ntr9cripH0+gMB/Lx37x4RPued5Gxh/okqq+oXawI1RHjArH8AAAAASUVORK5CYII=\'); background-size: cover; display: block;"\n    >\n      <img\n        class="gatsby-resp-image-image"\n        style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;"\n        alt="2019 06 10 19 31 14"\n        title=""\n        src="/static/2019-06-10-19-31-14-e385c71fd6dcf4e7b44bbad3b8ab1600-b50a0.png"\n        srcset="/static/2019-06-10-19-31-14-e385c71fd6dcf4e7b44bbad3b8ab1600-0e5e0.png 200w,\n/static/2019-06-10-19-31-14-e385c71fd6dcf4e7b44bbad3b8ab1600-b50a0.png 202w"\n        sizes="(max-width: 202px) 100vw, 202px"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<ul>\n<li>SIP 的最低层是其语法和编码。其编码使用增强的 Backus-Naur 表格语法（BNF）来指定。</li>\n<li>第二层是传输层。它定义客户端如何发送请求并接收响应，以及服务器如何接收请求并通过网络发送响应，所有 SIP 元素都包含传输层。</li>\n<li>接下来是事务层。事务是由客户端事务（使用传输层）发送到服务器事务的请求，以及从服务器事务发送回客户端的对该请求的所有响应。用户代理客户端（UAC）完成的任何任务都将使用一系列事务进行。无状态代理不包含事务层。</li>\n<li>事务层上面的层称为事务用户。除了无状态代理之外，每个 SIP 实体都是一个事务用户。</li>\n</ul>\n<p>下图显示了 SIP 会话的基本呼叫流程：</p>\n<p>\n  <a\n    class="gatsby-resp-image-link"\n    href="/static/2019-06-10-19-32-44-85675d7f82b065969cdc941857fb2901-81a6c.png"\n    style="display: block"\n    target="_blank"\n    rel="noopener"\n  >\n  \n  <span\n    class="gatsby-resp-image-wrapper"\n    style="position: relative; display: block; ; max-width: 600px; margin-left: auto; margin-right: auto;"\n  >\n    <span\n      class="gatsby-resp-image-background-image"\n      style="padding-bottom: 61.33333333333334%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAIAAADtbgqsAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABWklEQVQoz22RyXLCQAxE/f8/RW6BQ6jyxXbZLvAKNuB930heEMWSig4qjaa71aNRuq77vgVF0zTX6/UYHbMso1OW5TAMy7LUdU1Bp23bV7zCmQoEzDRND4fDZrNRVTWKojAM6Wy3X6uP1Xr9iVYcxwj1fS9CT3JRFEDJjuP4vn+5XKhB73Y7z/PQAklnmiYyk/IiV+T6fD5XVYVb+Lqua5oGH1CSJJZlua6LbQbSIYNk2K/tPM8hYIYLPJNhCjoIAnDyQtCsAybzx3GkU9XV07ZMRoWMIkfTNDEvBOYgh0EZM47D6RS/kYl5nhHmCA2ybds8j3fC5AqPMvafhclWkCCzaphiQQIVmmRU3sic8cMFJnGIPKsSqKyKoIltChTxAuA5mW/kDoQ8Dy3DMPb7vchJE3fgUYQC4E5mk4hRY2G6BSrkx1FqJCgA320zPb2FLDl7iUf/T0gfmz8636l8ExiFGAAAAABJRU5ErkJggg==\'); background-size: cover; display: block;"\n    >\n      <img\n        class="gatsby-resp-image-image"\n        style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;"\n        alt="2019 06 10 19 32 44"\n        title=""\n        src="/static/2019-06-10-19-32-44-85675d7f82b065969cdc941857fb2901-81a6c.png"\n        srcset="/static/2019-06-10-19-32-44-85675d7f82b065969cdc941857fb2901-468c3.png 200w,\n/static/2019-06-10-19-32-44-85675d7f82b065969cdc941857fb2901-3ff2b.png 400w,\n/static/2019-06-10-19-32-44-85675d7f82b065969cdc941857fb2901-81a6c.png 600w"\n        sizes="(max-width: 600px) 100vw, 600px"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<p>以下是对上述呼叫流程的逐步说明：</p>\n<ul>\n<li>发送到代理服务器的 INVITE 请求负责启动会话。</li>\n<li>代理服务器发送 100 尝试立即响应呼叫者（Alice）以停止 INVITE 请求的重新发送。</li>\n<li>代理服务器在位置服务器中搜索 Bob 的地址。获取地址后，进一步转发 INVITE 请求。</li>\n<li>此后，Bob 手机生成的 180 振铃（临时响应）返回给爱丽丝。</li>\n<li>鲍勃拿起手机后一个 200 OK 响应很快产生。</li>\n<li>一旦 200 OK 到达 Alice，Bob 从 Alice 收到一个 ACK。</li>\n<li>同时，会话建立，RTP 数据包（会话）从两端开始流动。</li>\n<li>会话结束后，任何参与者（Alice 或 Bob）都可以发送一个 BYE 请求来终止会话。</li>\n<li>BYE 直接从 Alice 到 Bob 绕过代理服务器。</li>\n<li>最后，Bob 发送 200 OK 响应来确认 BYE，会话终止。</li>\n<li>在上述基本呼叫流程中，可以使用三个事务（标记为 1，2，3）。</li>\n</ul>\n<p>完整的呼叫（从 INVITE 到 200 OK）称为对话 Dialog。</p>\n<h1 id="sip-梯形"><a href="#sip-%E6%A2%AF%E5%BD%A2" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>SIP 梯形</h1>\n<p>代理如何帮助一个用户与另一个用户连接？让我们在下图的帮助下找出。</p>\n<p>\n  <a\n    class="gatsby-resp-image-link"\n    href="/static/2019-06-10-19-41-07-7d5711e5dede53ec10bbc9f58c34155c-068c2.png"\n    style="display: block"\n    target="_blank"\n    rel="noopener"\n  >\n  \n  <span\n    class="gatsby-resp-image-wrapper"\n    style="position: relative; display: block; ; max-width: 422px; margin-left: auto; margin-right: auto;"\n  >\n    <span\n      class="gatsby-resp-image-background-image"\n      style="padding-bottom: 62.085308056872044%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAIAAADtbgqsAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABT0lEQVQoz3WSSZKCUBBE//1vINHiom3u4BI2gi7RFQ4R4gRoAI44oP2kOghbMRcMRWVVZn7UYrHY7XabAtvtdjabTSaTOI55pU4lTVN6KAZBsPkPxed7gdvtxtXzPNu2ecjzPMuy8/ksz5ZlTafTsk2gGCAlqZqm2Wx+n04n9vT7/fF4PBgMXNet1796vZ4MqiBLlQ2G8XO5XNAsm6MoQnOjoTNLyOXyP7IwvQLL5fJZm4xGgu/7r7IZvFqt9vv99XrtdDoSwXNH6SgMQzppI06kPci8J0lyOBzIGasvrkpIkU1IWK/X0qk4CW5ILc3fP0A+saz0pRB8PB4pvTPzAu983BHNg9ztdnVdb7VaTEEMgwiZKzljkpyzAlRwizXWtNvtWq3G76DI0DAMx3HkbKMPYBA5ceDz+Xw0GmmaxlxFWvw6ZFBpsjICKMPhEDm/tGakTbrJ1VsAAAAASUVORK5CYII=\'); background-size: cover; display: block;"\n    >\n      <img\n        class="gatsby-resp-image-image"\n        style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;"\n        alt="2019 06 10 19 41 07"\n        title=""\n        src="/static/2019-06-10-19-41-07-7d5711e5dede53ec10bbc9f58c34155c-068c2.png"\n        srcset="/static/2019-06-10-19-41-07-7d5711e5dede53ec10bbc9f58c34155c-2e5ea.png 200w,\n/static/2019-06-10-19-41-07-7d5711e5dede53ec10bbc9f58c34155c-68ec0.png 400w,\n/static/2019-06-10-19-41-07-7d5711e5dede53ec10bbc9f58c34155c-068c2.png 422w"\n        sizes="(max-width: 422px) 100vw, 422px"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<p>图中所示的拓扑结构称为 SIP 梯形图。该过程发生如下：</p>\n<ul>\n<li>当呼叫方发起呼叫时，将向代理服务器发送 INVITE 消息。代理服务器收到 INVITE 后，尝试借助 DNS 服务器解析受理者的地址。</li>\n<li>在获得下一个路由之后，呼叫者的代理服务器（代理 1，也称为出站代理服务器）将 INVITE 请求转发给作为被呼叫者的入站代理服务器（代理服务器 2）的被呼叫者的代理服务器。</li>\n<li>入站代理服务器联系位置服务器以获取用户注册的被叫方地址信息。</li>\n<li>从位置服务器获取信息后，将呼叫转发到其目的地。</li>\n<li>一旦用户代理知道他们的地址，他们可以绕过呼叫，即直接通话。</li>\n</ul>\n<p>以上更新于<code class="language-text">2019-6-10 20:24:54</code></p>\n<hr>',id:"/github/workspace/blog/SIP协议入门学习/index.md absPath of file >>> MarkdownRemark",timeToRead:3,frontmatter:{date:"2019-06-10 11:43:51",path:"/sip-protocol-introduction-learning/",tags:"前端, SIP",title:"SIP协议入门学习",draft:null}}],page:21,pagesSum:38,length:186,prevPath:"/page/20",nextPath:"/page/22"}}}});