webpackJsonp([33678702584530],{1388:function(n,a){n.exports={data:{site:{siteMetadata:{title:"女王控的博客",description:'前端工程师，黑猫女王控，欢迎勾搭，技术相关<a href="https://github.com/towavephone" target="_blank">@towavephone</a>，QQ闲聊<a href="tencent://AddContact/?fromId=45&fromSubId=1&subcmd=all&uin=634407147&website=www.oicqzone.com">@towave</a>，bili关注<a href="https://space.bilibili.com/11507708#/" target="_blank">@towave</a>',siteUrl:"https://blog.towavephone.com"}}},pathContext:{posts:[{excerpt:"需求 接下来我要添加 IF 语句，但是后来我意识到最好先添加一些比较运算符。事实证明这很容易，因为它们像现有的一样是二进制运算符。 因此让我们赶紧看看增加六个比较符有什么变化：==，!=，<，>，<= 和 >=。 核心逻辑 添加新令牌 我们有六个新令牌，所以我们将它们添加到 defs.h…",html:'<h1 id="需求"><a href="#%E9%9C%80%E6%B1%82" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>需求</h1>\n<p>接下来我要添加 IF 语句，但是后来我意识到最好先添加一些比较运算符。事实证明这很容易，因为它们像现有的一样是二进制运算符。</p>\n<p>因此让我们赶紧看看增加六个比较符有什么变化：==，!=，&#x3C;，>，&#x3C;= 和 >=。</p>\n<h1 id="核心逻辑"><a href="#%E6%A0%B8%E5%BF%83%E9%80%BB%E8%BE%91" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>核心逻辑</h1>\n<h2 id="添加新令牌"><a href="#%E6%B7%BB%E5%8A%A0%E6%96%B0%E4%BB%A4%E7%89%8C" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>添加新令牌</h2>\n<p>我们有六个新令牌，所以我们将它们添加到 defs.h：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="79269740002163540000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// Token types\nenum {\n  T_EOF,\n  T_PLUS, T_MINUS,\n  T_STAR, T_SLASH,\n  T_EQ, T_NE,\n  T_LT, T_GT, T_LE, T_GE,\n  T_INTLIT, T_SEMI, T_ASSIGN, T_IDENT,\n  // Keywords\n  T_PRINT, T_INT\n};`, `79269740002163540000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                data-tooltip="复制"\n              >\n                <svg class="gatsby-code-button-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0V0z"/><path d="M16 1H2v16h2V3h12V1zm-1 4l6 6v12H6V5h9zm-1 7h5.5L14 6.5V12z"/></svg>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="c"><pre style="counter-reset: linenumber NaN" class="language-c line-numbers"><code class="language-c"><span class="token comment">// Token types</span>\n<span class="token keyword">enum</span> <span class="token punctuation">{</span>\n  T_EOF<span class="token punctuation">,</span>\n  T_PLUS<span class="token punctuation">,</span> T_MINUS<span class="token punctuation">,</span>\n  T_STAR<span class="token punctuation">,</span> T_SLASH<span class="token punctuation">,</span>\n  T_EQ<span class="token punctuation">,</span> T_NE<span class="token punctuation">,</span>\n  T_LT<span class="token punctuation">,</span> T_GT<span class="token punctuation">,</span> T_LE<span class="token punctuation">,</span> T_GE<span class="token punctuation">,</span>\n  T_INTLIT<span class="token punctuation">,</span> T_SEMI<span class="token punctuation">,</span> T_ASSIGN<span class="token punctuation">,</span> T_IDENT<span class="token punctuation">,</span>\n  <span class="token comment">// Keywords</span>\n  T_PRINT<span class="token punctuation">,</span> T_INT\n<span class="token punctuation">}</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>我已经重新排列了令牌，以便让令牌从低到高的优先级顺序出现。</p>\n<h2 id="扫描令牌"><a href="#%E6%89%AB%E6%8F%8F%E4%BB%A4%E7%89%8C" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>扫描令牌</h2>\n<p>现在我们必须扫描它们，请注意我们必须区分 = 和 ==，&#x3C; 和 &#x3C;=，> 和 >=。因此我们将需要从输入中读取一个额外的字符，然后在不需要时将其放回原处，下面是来自 scan.c 新的代码 scan()：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="68712879865532670000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`case \'=\':\n  if ((c = next()) == \'=\') {\n    t->token = T_EQ;\n  } else {\n    putback(c);\n    t->token = T_ASSIGN;\n  }\n  break;\ncase \'!\':\n  if ((c = next()) == \'=\') {\n    t->token = T_NE;\n  } else {\n    fatalc(&quot;Unrecognised character&quot;, c);\n  }\n  break;\ncase \'<\':\n  if ((c = next()) == \'=\') {\n    t->token = T_LE;\n  } else {\n    putback(c);\n    t->token = T_LT;\n  }\n  break;\ncase \'>\':\n  if ((c = next()) == \'=\') {\n    t->token = T_GE;\n  } else {\n    putback(c);\n    t->token = T_GT;\n  }\n  break;`, `68712879865532670000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                data-tooltip="复制"\n              >\n                <svg class="gatsby-code-button-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0V0z"/><path d="M16 1H2v16h2V3h12V1zm-1 4l6 6v12H6V5h9zm-1 7h5.5L14 6.5V12z"/></svg>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="c"><pre style="counter-reset: linenumber NaN" class="language-c line-numbers"><code class="language-c"><span class="token keyword">case</span> <span class="token string">\'=\'</span><span class="token operator">:</span>\n  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>c <span class="token operator">=</span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">\'=\'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    t<span class="token operator">-></span>token <span class="token operator">=</span> T_EQ<span class="token punctuation">;</span>\n  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>\n    <span class="token function">putback</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    t<span class="token operator">-></span>token <span class="token operator">=</span> T_ASSIGN<span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n  <span class="token keyword">break</span><span class="token punctuation">;</span>\n<span class="token keyword">case</span> <span class="token string">\'!\'</span><span class="token operator">:</span>\n  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>c <span class="token operator">=</span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">\'=\'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    t<span class="token operator">-></span>token <span class="token operator">=</span> T_NE<span class="token punctuation">;</span>\n  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>\n    <span class="token function">fatalc</span><span class="token punctuation">(</span><span class="token string">"Unrecognised character"</span><span class="token punctuation">,</span> c<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n  <span class="token keyword">break</span><span class="token punctuation">;</span>\n<span class="token keyword">case</span> <span class="token string">\'&lt;\'</span><span class="token operator">:</span>\n  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>c <span class="token operator">=</span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">\'=\'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    t<span class="token operator">-></span>token <span class="token operator">=</span> T_LE<span class="token punctuation">;</span>\n  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>\n    <span class="token function">putback</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    t<span class="token operator">-></span>token <span class="token operator">=</span> T_LT<span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n  <span class="token keyword">break</span><span class="token punctuation">;</span>\n<span class="token keyword">case</span> <span class="token string">\'>\'</span><span class="token operator">:</span>\n  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>c <span class="token operator">=</span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">\'=\'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    t<span class="token operator">-></span>token <span class="token operator">=</span> T_GE<span class="token punctuation">;</span>\n  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>\n    <span class="token function">putback</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    t<span class="token operator">-></span>token <span class="token operator">=</span> T_GT<span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n  <span class="token keyword">break</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>我还将 = 令牌的名称更改为 T<em>ASSIGN，以确保不会与新的 T</em>EQ 令牌混淆。</p>\n<h2 id="新的表达代码"><a href="#%E6%96%B0%E7%9A%84%E8%A1%A8%E8%BE%BE%E4%BB%A3%E7%A0%81" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>新的表达代码</h2>\n<p>现在我们可以扫描六个新令牌，因此我们必须解析它们何时出现在表达式中，并强制其运算符优先级。</p>\n<p>到现在为止，您已经知道：</p>\n<ul>\n<li>我正在构建将成为自编译器的东西</li>\n<li>用 C 语言</li>\n<li>使用 SubC 编译器作为参考</li>\n</ul>\n<p>这意味着我正在为足够一部分 C 的子集（就像 SubC）编写一个编译器，以便它可以自己编译。因此我应该使用普通的 C 运算符优先顺序，这意味着比较运算符的优先级高于乘法和除法。</p>\n<p>我还意识到我用来将令牌映射到 AST 节点类型的 switch 语句只会变得更大，因此我决定重新排列 AST 节点类型，以便所有二进制运算符（在 defs.h 中）之间都具有 1:1 的映射：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="77426303519312530000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// AST node types. The first few line up\n// with the related tokens\nenum {\n  A_ADD=1, A_SUBTRACT, A_MULTIPLY, A_DIVIDE,\n  A_EQ, A_NE, A_LT, A_GT, A_LE, A_GE,\n  A_INTLIT,\n  A_IDENT, A_LVIDENT, A_ASSIGN\n};`, `77426303519312530000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                data-tooltip="复制"\n              >\n                <svg class="gatsby-code-button-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0V0z"/><path d="M16 1H2v16h2V3h12V1zm-1 4l6 6v12H6V5h9zm-1 7h5.5L14 6.5V12z"/></svg>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="c"><pre style="counter-reset: linenumber NaN" class="language-c line-numbers"><code class="language-c"><span class="token comment">// AST node types. The first few line up</span>\n<span class="token comment">// with the related tokens</span>\n<span class="token keyword">enum</span> <span class="token punctuation">{</span>\n  A_ADD<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> A_SUBTRACT<span class="token punctuation">,</span> A_MULTIPLY<span class="token punctuation">,</span> A_DIVIDE<span class="token punctuation">,</span>\n  A_EQ<span class="token punctuation">,</span> A_NE<span class="token punctuation">,</span> A_LT<span class="token punctuation">,</span> A_GT<span class="token punctuation">,</span> A_LE<span class="token punctuation">,</span> A_GE<span class="token punctuation">,</span>\n  A_INTLIT<span class="token punctuation">,</span>\n  A_IDENT<span class="token punctuation">,</span> A_LVIDENT<span class="token punctuation">,</span> A_ASSIGN\n<span class="token punctuation">}</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>在 expr.c 中我可以简化令牌到 AST 节点的转换，还可以添加新令牌的优先级：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="30345787924973576000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// Convert a binary operator token into an AST operation.\n// We rely on a 1:1 mapping from token to AST operation\nstatic int arithop(int tokentype) {\n  if (tokentype > T_EOF && tokentype < T_INTLIT)\n    return(tokentype);\n  fatald(&quot;Syntax error, token&quot;, tokentype);\n}\n\n// Operator precedence for each token. Must\n// match up with the order of tokens in defs.h\nstatic int OpPrec[] = {\n  0, 10, 10,                    // T_EOF, T_PLUS, T_MINUS\n  20, 20,                       // T_STAR, T_SLASH\n  30, 30,                       // T_EQ, T_NE\n  40, 40, 40, 40                // T_LT, T_GT, T_LE, T_GE\n};`, `30345787924973576000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                data-tooltip="复制"\n              >\n                <svg class="gatsby-code-button-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0V0z"/><path d="M16 1H2v16h2V3h12V1zm-1 4l6 6v12H6V5h9zm-1 7h5.5L14 6.5V12z"/></svg>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="c"><pre style="counter-reset: linenumber NaN" class="language-c line-numbers"><code class="language-c"><span class="token comment">// Convert a binary operator token into an AST operation.</span>\n<span class="token comment">// We rely on a 1:1 mapping from token to AST operation</span>\n<span class="token keyword">static</span> <span class="token keyword">int</span> <span class="token function">arithop</span><span class="token punctuation">(</span><span class="token keyword">int</span> tokentype<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">if</span> <span class="token punctuation">(</span>tokentype <span class="token operator">></span> T_EOF <span class="token operator">&amp;&amp;</span> tokentype <span class="token operator">&lt;</span> T_INTLIT<span class="token punctuation">)</span>\n    <span class="token keyword">return</span><span class="token punctuation">(</span>tokentype<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token function">fatald</span><span class="token punctuation">(</span><span class="token string">"Syntax error, token"</span><span class="token punctuation">,</span> tokentype<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token comment">// Operator precedence for each token. Must</span>\n<span class="token comment">// match up with the order of tokens in defs.h</span>\n<span class="token keyword">static</span> <span class="token keyword">int</span> OpPrec<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span>\n  <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span>                    <span class="token comment">// T_EOF, T_PLUS, T_MINUS</span>\n  <span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span>                       <span class="token comment">// T_STAR, T_SLASH</span>\n  <span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">,</span>                       <span class="token comment">// T_EQ, T_NE</span>\n  <span class="token number">40</span><span class="token punctuation">,</span> <span class="token number">40</span><span class="token punctuation">,</span> <span class="token number">40</span><span class="token punctuation">,</span> <span class="token number">40</span>                <span class="token comment">// T_LT, T_GT, T_LE, T_GE</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>解析和运算符优先级就到此了！</p>\n<h2 id="代码生成"><a href="#%E4%BB%A3%E7%A0%81%E7%94%9F%E6%88%90" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>代码生成</h2>\n<p>由于这六个新运算符是二进制运算符，因此很容易修改通用代码生成器 gen.c 来处理它们：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="47645661537756240000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`case A_EQ:\n  return (cgequal(leftreg, rightreg));\ncase A_NE:\n  return (cgnotequal(leftreg, rightreg));\ncase A_LT:\n  return (cglessthan(leftreg, rightreg));\ncase A_GT:\n  return (cggreaterthan(leftreg, rightreg));\ncase A_LE:\n  return (cglessequal(leftreg, rightreg));\ncase A_GE:\n  return (cggreaterequal(leftreg, rightreg));`, `47645661537756240000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                data-tooltip="复制"\n              >\n                <svg class="gatsby-code-button-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0V0z"/><path d="M16 1H2v16h2V3h12V1zm-1 4l6 6v12H6V5h9zm-1 7h5.5L14 6.5V12z"/></svg>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="c"><pre style="counter-reset: linenumber NaN" class="language-c line-numbers"><code class="language-c"><span class="token keyword">case</span> A_EQ<span class="token operator">:</span>\n  <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token function">cgequal</span><span class="token punctuation">(</span>leftreg<span class="token punctuation">,</span> rightreg<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">case</span> A_NE<span class="token operator">:</span>\n  <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token function">cgnotequal</span><span class="token punctuation">(</span>leftreg<span class="token punctuation">,</span> rightreg<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">case</span> A_LT<span class="token operator">:</span>\n  <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token function">cglessthan</span><span class="token punctuation">(</span>leftreg<span class="token punctuation">,</span> rightreg<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">case</span> A_GT<span class="token operator">:</span>\n  <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token function">cggreaterthan</span><span class="token punctuation">(</span>leftreg<span class="token punctuation">,</span> rightreg<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">case</span> A_LE<span class="token operator">:</span>\n  <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token function">cglessequal</span><span class="token punctuation">(</span>leftreg<span class="token punctuation">,</span> rightreg<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">case</span> A_GE<span class="token operator">:</span>\n  <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token function">cggreaterequal</span><span class="token punctuation">(</span>leftreg<span class="token punctuation">,</span> rightreg<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id="x86-64-代码生成"><a href="#x86-64-%E4%BB%A3%E7%A0%81%E7%94%9F%E6%88%90" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>x86-64 代码生成</h2>\n<p>在 C 中比较麻烦的是，比较运算符返回一个值，如果它们的执行结果为 true，则结果为 1。如果它们的执行结果为 false，则结果为 0。我们需要编写 x86-64 汇编代码来反映这一点。</p>\n<p>幸运的是有一些 x86-64 指令可以做到这一点，不幸的是在此过程中需要处理一些问题，考虑以下 x86-64 指令：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="57363139464939210000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`cmpq %r8,%r9`, `57363139464939210000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                data-tooltip="复制"\n              >\n                <svg class="gatsby-code-button-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0V0z"/><path d="M16 1H2v16h2V3h12V1zm-1 4l6 6v12H6V5h9zm-1 7h5.5L14 6.5V12z"/></svg>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="c"><pre style="counter-reset: linenumber NaN" class="language-c line-numbers"><code class="language-c">cmpq <span class="token operator">%</span>r8<span class="token punctuation">,</span><span class="token operator">%</span>r9</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>上面的 cmpq 指令执行 <code class="language-text">%r9-%r8</code> 并设置几个状态标志，包括负标志和零标志，因此我们可以查看标志组合以查看比较结果：</p>\n<table>\n<thead>\n<tr>\n<th>比较</th>\n<th>操作</th>\n<th>执行结果</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>%r8 == %r9</td>\n<td>%r9 - %r8</td>\n<td>零</td>\n</tr>\n<tr>\n<td>%r8 != %r9</td>\n<td>%r9 - %r8</td>\n<td>不为零</td>\n</tr>\n<tr>\n<td>%r8 > %r9</td>\n<td>%r9 - %r8</td>\n<td>不为零，负数</td>\n</tr>\n<tr>\n<td>%r8 &#x3C; %r9</td>\n<td>%r9 - %r8</td>\n<td>不为零，不为负</td>\n</tr>\n<tr>\n<td>%r8 >= %r9</td>\n<td>%r9 - %r8</td>\n<td>零或负</td>\n</tr>\n<tr>\n<td>%r8 &#x3C;= %r9</td>\n<td>%r9 - %r8</td>\n<td>零或非负</td>\n</tr>\n</tbody>\n</table>\n<p>问题是这些指令仅设置寄存器的最低字节，如果寄存器的最低位之外的其他位已置 1，则它们将保持置位状态。因此我们可以将变量设置为 1，但是如果它已经具有值 1000（十进制），那么现在它将是 1001，这不是我们想要的。</p>\n<p>解决方案是 andq 在 setX 指令后清除寄存器中不需要的，在 cg.c 中有一个比较功能可以做到这一点：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="74441997127805940000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// Compare two registers.\nstatic int cgcompare(int r1, int r2, char *how) {\n  fprintf(Outfile, &quot;\\tcmpq\\t%s, %s\\n&quot;, reglist[r2], reglist[r1]);\n  fprintf(Outfile, &quot;\\t%s\\t%s\\n&quot;, how, breglist[r2]);\n  fprintf(Outfile, &quot;\\tandq\\t\\$255,%s\\n&quot;, reglist[r2]);\n  free_register(r1);\n  return (r2);\n}`, `74441997127805940000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                data-tooltip="复制"\n              >\n                <svg class="gatsby-code-button-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0V0z"/><path d="M16 1H2v16h2V3h12V1zm-1 4l6 6v12H6V5h9zm-1 7h5.5L14 6.5V12z"/></svg>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="c"><pre style="counter-reset: linenumber NaN" class="language-c line-numbers"><code class="language-c"><span class="token comment">// Compare two registers.</span>\n<span class="token keyword">static</span> <span class="token keyword">int</span> <span class="token function">cgcompare</span><span class="token punctuation">(</span><span class="token keyword">int</span> r1<span class="token punctuation">,</span> <span class="token keyword">int</span> r2<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span>how<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token function">fprintf</span><span class="token punctuation">(</span>Outfile<span class="token punctuation">,</span> <span class="token string">"\\tcmpq\\t%s, %s\\n"</span><span class="token punctuation">,</span> reglist<span class="token punctuation">[</span>r2<span class="token punctuation">]</span><span class="token punctuation">,</span> reglist<span class="token punctuation">[</span>r1<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token function">fprintf</span><span class="token punctuation">(</span>Outfile<span class="token punctuation">,</span> <span class="token string">"\\t%s\\t%s\\n"</span><span class="token punctuation">,</span> how<span class="token punctuation">,</span> breglist<span class="token punctuation">[</span>r2<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token function">fprintf</span><span class="token punctuation">(</span>Outfile<span class="token punctuation">,</span> <span class="token string">"\\tandq\\t$255,%s\\n"</span><span class="token punctuation">,</span> reglist<span class="token punctuation">[</span>r2<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token function">free_register</span><span class="token punctuation">(</span>r1<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token keyword">return</span> <span class="token punctuation">(</span>r2<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>指令 how 之一在哪里 setX，请注意我们执行</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="69513672051864270000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`cmpq reglist[r2], reglist[r1]`, `69513672051864270000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                data-tooltip="复制"\n              >\n                <svg class="gatsby-code-button-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0V0z"/><path d="M16 1H2v16h2V3h12V1zm-1 4l6 6v12H6V5h9zm-1 7h5.5L14 6.5V12z"/></svg>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="c"><pre style="counter-reset: linenumber NaN" class="language-c line-numbers"><code class="language-c">cmpq reglist<span class="token punctuation">[</span>r2<span class="token punctuation">]</span><span class="token punctuation">,</span> reglist<span class="token punctuation">[</span>r1<span class="token punctuation">]</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>因为实际上 <code class="language-text">reglist[r1] - reglist[r2]</code> 是我们真正想要的。</p>\n<h2 id="x86-64-寄存器"><a href="#x86-64-%E5%AF%84%E5%AD%98%E5%99%A8" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>x86-64 寄存器</h2>\n<p>我们需要在这里讨论 x86-64 体系结构中的寄存器，x86-64 有几个 64 位通用寄存器，但是我们也可以使用不同的寄存器名称来访问和处理这些寄存器的子部分。</p>\n<p>\n  <a\n    class="gatsby-resp-image-link"\n    href="/static/2020-03-11-10-20-36-ec8e82992658996a9b56814a2e33b7ac-dab2c.png"\n    style="display: block"\n    target="_blank"\n    rel="noopener"\n  >\n  \n  <span\n    class="gatsby-resp-image-wrapper"\n    style="position: relative; display: block; ; max-width: 397px; margin-left: auto; margin-right: auto;"\n  >\n    <span\n      class="gatsby-resp-image-background-image"\n      style="padding-bottom: 105.54156171284635%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAVCAIAAADJt1n/AAAACXBIWXMAAA7DAAAOwwHHb6hkAAACq0lEQVQ4y1VU21LbMBTM//8InSEhhTDDlIYfKA9MwcS3ECe2Ykvy/cI0TmK7K8nYQQ8aS+ccrXbPypOHh4fp9fXtz9vpdDqbzR5/PS4Wi1sx7sTy93I+ny/u7+czMZ6enm5uZneLxY+rq+VyOdG0t5eXl83G0XXdtm3LNJ//PK/X64+1GPpq9ff1dbvdIoI9Q9e1N81xHMMwsDnhnIVR3HVd27aYq7JwXbeTa0xxFOVFMURDHn5Wn50cTdNMPNf1/QCR0+nUtG2SJLZlnU5nDGzSwA+jqJNR1Ae+n+c5PhA9Ho8TRmkcJwiL7LbNs8wjpGlxboPNNE0VsoqmaVKWQBZhHDchnrdzPXU2thAG+foooLHp7wll4YBMyP4bMjinaTYi55kfBI2EbgWLuKoqFcXMOc9k8hcyIWEY9cVdl8Sx42zV2TKb5UU5FHueF/JoLPZ9n/PwkrOz2QrGjcgOGcuyfCjek30ok/tid7cjHhk4A9lYXXAmhFLWc+46IdB2N3JGM1RYIRd5Bg+cBWeJHPJBEcyMBkFAR+Q9IejtEAYy1G5Gzhw+u7i2B0XGYkppWVXA7FuVJB/rj0YuhdpxjGUrU5VndjtPnaVMEih7DoKZpnU41G0rWoWzLMs6Hk/KM5xR215LORvZZxbs/WAoLsvCNM30q5lFkRuGnkrBVdvxVA6HA75Fcci+2RPFEKyUvZXFWG5K4RNxE9wLb6uu676YBnvi+wNnOAyCwUaqH/A2oLK8wBJRPDJN0/4dDv214xAeidov5KoqN0Aue2R1kQrPsBUjyzK887o+9siM+pecizwXyJIk3I3s1eodyD3nOHrXtAvOnDHOLzmjsYXMVoIBqizF2wDnLE0h/sgZ6geUDZyh0Nq2C0nyfBYS4N+AtyEpw7yRJRupOP8HOLWbdBJtut4AAAAASUVORK5CYII=\'); background-size: cover; display: block;"\n    >\n      <img\n        class="gatsby-resp-image-image"\n        style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;"\n        alt="2020 03 11 10 20 36"\n        title=""\n        src="/static/2020-03-11-10-20-36-ec8e82992658996a9b56814a2e33b7ac-dab2c.png"\n        srcset="/static/2020-03-11-10-20-36-ec8e82992658996a9b56814a2e33b7ac-06022.png 200w,\n/static/2020-03-11-10-20-36-ec8e82992658996a9b56814a2e33b7ac-dab2c.png 397w"\n        sizes="(max-width: 397px) 100vw, 397px"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<p>上面来自 stack.imgur.com 的图片显示，对于 64 位 <code class="language-text">r8</code> 寄存器，我们可以使用 <code class="language-text">r8d</code> 寄存器访问该寄存器的低 32 位。同样 <code class="language-text">r8w</code> 寄存器是 <code class="language-text">r8</code> 寄存器的低 16 位，<code class="language-text">r8b</code> 寄存器是 <code class="language-text">r8</code> 寄存器的低 8 位。</p>\n<p>在该 cgcompare() 函数中，代码使用 <code class="language-text">reglist[]</code> 数组比较两个 64 位寄存器，然后通过使用 <code class="language-text">breglist[]</code> 数组中的名称在第二个寄存器的 8 位版本中设置标志，x86-64 体系结构仅允许 setX 指令对 8 位寄存器名称进行操作，因此需要 <code class="language-text">breglist[]</code> 阵列。</p>\n<h2 id="创建多个比较指令"><a href="#%E5%88%9B%E5%BB%BA%E5%A4%9A%E4%B8%AA%E6%AF%94%E8%BE%83%E6%8C%87%E4%BB%A4" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>创建多个比较指令</h2>\n<p>现在我们有了这个通用功能，我们可以编写六个实际的比较功能：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="8867762726739104000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`int cgequal(int r1, int r2) { return(cgcompare(r1, r2, &quot;sete&quot;)); }\nint cgnotequal(int r1, int r2) { return(cgcompare(r1, r2, &quot;setne&quot;)); }\nint cglessthan(int r1, int r2) { return(cgcompare(r1, r2, &quot;setl&quot;)); }\nint cggreaterthan(int r1, int r2) { return(cgcompare(r1, r2, &quot;setg&quot;)); }\nint cglessequal(int r1, int r2) { return(cgcompare(r1, r2, &quot;setle&quot;)); }\nint cggreaterequal(int r1, int r2) { return(cgcompare(r1, r2, &quot;setge&quot;)); }`, `8867762726739104000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                data-tooltip="复制"\n              >\n                <svg class="gatsby-code-button-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0V0z"/><path d="M16 1H2v16h2V3h12V1zm-1 4l6 6v12H6V5h9zm-1 7h5.5L14 6.5V12z"/></svg>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="c"><pre style="counter-reset: linenumber NaN" class="language-c line-numbers"><code class="language-c"><span class="token keyword">int</span> <span class="token function">cgequal</span><span class="token punctuation">(</span><span class="token keyword">int</span> r1<span class="token punctuation">,</span> <span class="token keyword">int</span> r2<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span><span class="token punctuation">(</span><span class="token function">cgcompare</span><span class="token punctuation">(</span>r1<span class="token punctuation">,</span> r2<span class="token punctuation">,</span> <span class="token string">"sete"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>\n<span class="token keyword">int</span> <span class="token function">cgnotequal</span><span class="token punctuation">(</span><span class="token keyword">int</span> r1<span class="token punctuation">,</span> <span class="token keyword">int</span> r2<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span><span class="token punctuation">(</span><span class="token function">cgcompare</span><span class="token punctuation">(</span>r1<span class="token punctuation">,</span> r2<span class="token punctuation">,</span> <span class="token string">"setne"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>\n<span class="token keyword">int</span> <span class="token function">cglessthan</span><span class="token punctuation">(</span><span class="token keyword">int</span> r1<span class="token punctuation">,</span> <span class="token keyword">int</span> r2<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span><span class="token punctuation">(</span><span class="token function">cgcompare</span><span class="token punctuation">(</span>r1<span class="token punctuation">,</span> r2<span class="token punctuation">,</span> <span class="token string">"setl"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>\n<span class="token keyword">int</span> <span class="token function">cggreaterthan</span><span class="token punctuation">(</span><span class="token keyword">int</span> r1<span class="token punctuation">,</span> <span class="token keyword">int</span> r2<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span><span class="token punctuation">(</span><span class="token function">cgcompare</span><span class="token punctuation">(</span>r1<span class="token punctuation">,</span> r2<span class="token punctuation">,</span> <span class="token string">"setg"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>\n<span class="token keyword">int</span> <span class="token function">cglessequal</span><span class="token punctuation">(</span><span class="token keyword">int</span> r1<span class="token punctuation">,</span> <span class="token keyword">int</span> r2<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span><span class="token punctuation">(</span><span class="token function">cgcompare</span><span class="token punctuation">(</span>r1<span class="token punctuation">,</span> r2<span class="token punctuation">,</span> <span class="token string">"setle"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>\n<span class="token keyword">int</span> <span class="token function">cggreaterequal</span><span class="token punctuation">(</span><span class="token keyword">int</span> r1<span class="token punctuation">,</span> <span class="token keyword">int</span> r2<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span><span class="token punctuation">(</span><span class="token function">cgcompare</span><span class="token punctuation">(</span>r1<span class="token punctuation">,</span> r2<span class="token punctuation">,</span> <span class="token string">"setge"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>与其他二进制运算符函数一样，一个寄存器被释放，另一个寄存器返回结果。</p>\n<h1 id="运行结果"><a href="#%E8%BF%90%E8%A1%8C%E7%BB%93%E6%9E%9C" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>运行结果</h1>\n<h2 id="输入"><a href="#%E8%BE%93%E5%85%A5" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>输入</h2>\n<p>input04</p>\n<div class="gatsby-highlight" data-language="text"><pre style="counter-reset: linenumber NaN" class="language-text line-numbers"><code class="language-text">int x;\nx= 7 &lt; 9;  print x;\nx= 7 &lt;= 9; print x;\nx= 7 != 9; print x;\nx= 7 == 7; print x;\nx= 7 &gt;= 7; print x;\nx= 7 &lt;= 7; print x;\nx= 9 &gt; 7;  print x;\nx= 9 &gt;= 7; print x;\nx= 9 != 7; print x;</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id="输出"><a href="#%E8%BE%93%E5%87%BA" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>输出</h2>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="82562105906667140000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`\\$ make test\ncc -o comp1 -g cg.c decl.c expr.c gen.c main.c misc.c scan.c stmt.c sym.c tree.c\n./comp1 input04\ncc -o out out.s\n./out\n1\n1\n1\n1\n1\n1\n1\n1\n1`, `82562105906667140000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                data-tooltip="复制"\n              >\n                <svg class="gatsby-code-button-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0V0z"/><path d="M16 1H2v16h2V3h12V1zm-1 4l6 6v12H6V5h9zm-1 7h5.5L14 6.5V12z"/></svg>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">$ <span class="token function">make</span> <span class="token builtin class-name">test</span>\ncc -o comp1 -g cg.c decl.c expr.c gen.c main.c misc.c scan.c stmt.c sym.c tree.c\n./comp1 input04\ncc -o out out.s\n./out\n<span class="token number">1</span>\n<span class="token number">1</span>\n<span class="token number">1</span>\n<span class="token number">1</span>\n<span class="token number">1</span>\n<span class="token number">1</span>\n<span class="token number">1</span>\n<span class="token number">1</span>\n<span class="token number">1</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>out.s</p>\n<div class="gatsby-highlight" data-language="text"><pre style="counter-reset: linenumber NaN" class="language-text line-numbers"><code class="language-text">.text\n.LC0:\n        .string &quot;%d\\n&quot;\nprintint:\n        pushq   %rbp\n        movq    %rsp, %rbp\n        subq    $16, %rsp\n        movl    %edi, -4(%rbp)\n        movl    -4(%rbp), %eax\n        movl    %eax, %esi\n        leaq    .LC0(%rip), %rdi\n        movl    $0, %eax\n        call    printf@PLT\n        nop\n        leave\n        ret\n\n        .globl  main\n        .type   main, @function\nmain:\n        pushq   %rbp\n        movq    %rsp, %rbp\n        .comm   x,8,8\n        movq    $7, %r8\n        movq    $9, %r9\n        cmpq    %r9, %r8\n        setl    %r9b\n        andq    $255,%r9\n        movq    %r9, x(%rip)\n        movq    x(%rip), %r8\n        movq    %r8, %rdi\n        call    printint\n        movq    $7, %r8\n        movq    $9, %r9\n        cmpq    %r9, %r8\n        setle   %r9b\n        andq    $255,%r9\n        movq    %r9, x(%rip)\n        movq    x(%rip), %r8\n        movq    %r8, %rdi\n        call    printint\n        movq    $7, %r8\n        movq    $9, %r9\n        cmpq    %r9, %r8\n        setne   %r9b\n        andq    $255,%r9\n        movq    %r9, x(%rip)\n        movq    x(%rip), %r8\n        movq    %r8, %rdi\n        call    printint\n        movq    $7, %r8\n        movq    $7, %r9\n        cmpq    %r9, %r8\n        sete    %r9b\n        andq    $255,%r9\n        movq    %r9, x(%rip)\n        movq    x(%rip), %r8\n        movq    %r8, %rdi\n        call    printint\n        movq    $7, %r8\n        movq    $7, %r9\n        cmpq    %r9, %r8\n        setge   %r9b\n        andq    $255,%r9\n        movq    %r9, x(%rip)\n        movq    x(%rip), %r8\n        movq    %r8, %rdi\n        call    printint\n        movq    $7, %r8\n        movq    $7, %r9\n        cmpq    %r9, %r8\n        setle   %r9b\n        andq    $255,%r9\n        movq    %r9, x(%rip)\n        movq    x(%rip), %r8\n        movq    %r8, %rdi\n        call    printint\n        movq    $9, %r8\n        movq    $7, %r9\n        cmpq    %r9, %r8\n        setg    %r9b\n        andq    $255,%r9\n        movq    %r9, x(%rip)\n        movq    x(%rip), %r8\n        movq    %r8, %rdi\n        call    printint\n        movq    $9, %r8\n        movq    $7, %r9\n        cmpq    %r9, %r8\n        setge   %r9b\n        andq    $255,%r9\n        movq    %r9, x(%rip)\n        movq    x(%rip), %r8\n        movq    %r8, %rdi\n        call    printint\n        movq    $9, %r8\n        movq    $7, %r9\n        cmpq    %r9, %r8\n        setne   %r9b\n        andq    $255,%r9\n        movq    %r9, x(%rip)\n        movq    x(%rip), %r8\n        movq    %r8, %rdi\n        call    printint\n        movl    $0, %eax\n        popq    %rbp\n        ret</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h1 id="结论"><a href="#%E7%BB%93%E8%AE%BA" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>结论</h1>\n<p>这是对编译器的一种很好而又轻松的添加，接下来的旅程将更加复杂。</p>\n<p>在编译器编写过程的下一部分中，我们将 IF 语句添加到编译器中，并使用刚刚添加的比较运算符。</p>',
id:"/github/workspace/blog/编译器之旅（七）——比较运算符/index.md absPath of file >>> MarkdownRemark",timeToRead:7,frontmatter:{date:"2020-03-11 10:03:11",path:"/tour-of-compiler-comparison-operators/",tags:"编译原理, 比较运算符",title:"编译器之旅（七）——比较运算符",draft:null}}],length:1,tag:"比较运算符",pagesSum:1,page:1}}}});