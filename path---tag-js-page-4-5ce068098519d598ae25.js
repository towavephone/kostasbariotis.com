webpackJsonp([0xe4b0d89fa0ff],{1299:function(n,a){n.exports={data:{site:{siteMetadata:{title:"女王控的博客",description:'前端工程师，黑猫女王控，欢迎勾搭，技术相关<a href="https://github.com/towavephone" target="_blank">@towavephone</a>，QQ闲聊<a href="tencent://AddContact/?fromId=45&fromSubId=1&subcmd=all&uin=634407147&website=www.oicqzone.com">@towave</a>，bili关注<a href="https://space.bilibili.com/11507708#/" target="_blank">@towave</a>',siteUrl:"https://blog.towavephone.com"}}},pathContext:{posts:[{excerpt:"JS 测试一 具体实现 我的解答 最佳解答 实现要点 空数组项也会作为 length 的一部分；空数组项和空字符串项是有区别的。 第 2 题，本题只是过滤空数组项，不包括 null, undefined 这类。 去除空数组项两个比较好的回答： 数组中的 empty 元素不会参与数组项遍历，故只需返回 true 即可过滤掉 empty 元素（而不会牵连 0、NaN、null、undefined、” 这些）arr.filter(it => true)。然后补充，但是走 for…",html:'<h1 id="js-测试一"><a href="#js-%E6%B5%8B%E8%AF%95%E4%B8%80" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>JS 测试一</h1>\n<p>\n  <a\n    class="gatsby-resp-image-link"\n    href="/static/2019-07-22-17-18-49-a275e9b92ec445a88c4bc5626cf73bf4-8662f.png"\n    style="display: block"\n    target="_blank"\n    rel="noopener"\n  >\n  \n  <span\n    class="gatsby-resp-image-wrapper"\n    style="position: relative; display: block; ; max-width: 633px; margin-left: auto; margin-right: auto;"\n  >\n    <span\n      class="gatsby-resp-image-background-image"\n      style="padding-bottom: 144.07582938388626%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAdCAIAAAAl5NuSAAAACXBIWXMAAA7DAAAOwwHHb6hkAAACFklEQVQ4y7VU2ariQBD1/z/BJxEfFJcHEVQUFCSCDy6JoqIiPt1xTSeddBK17Tsny+R6XTKXCVNg7HTnVJ06VdWJzxiWwE8IcbvdHg6wc71eL5cL5zwK/GxAjWS5XC5XKpXhcKhT6sd4Ad7v99vt9mVkGDCWxSil2LFtW1VV7lkAHiuK1JUYYzizLOt8Pp9OJ2ZZoSPhWbj+FtmgVCXqx8cvIDlHAM6Y6+Ingomz44CVrmm6rkMhrCNEeswZANt2wNlxHMDwfBb/R2r7MK92gXEvk2epA9oIdTweCSGHw2G32xmGcVJVQlTdNQ21gMLWnX6PTeI7Fv/QYbHa0zRNQjTUFpzBXPeUB23sQHmk806/hC+SL4zfyaGhvbjbZ1yISNpBzn8m5EsFIf5CmzETDEEPTzS5nwL0NwxKNBJR89iCITe3opRiNvDPTAyFhRlBwSk1IOe7bnWbxANDVwoM9VxYXrsCBjySigDHox3KG5rXbPevn/8tcqzb874lnm+cd8xfRMankPeli4eGccGj0ajX68mynMvlisXifD6fzWbpdDqfzxcKhc1m02q1UqlUo9GoVqtYYH+5XAZgTdNwP0uSBC/JZLJer3e7Xbgbj8e1Wq3ZbGaz2VKp1Ol0sJ/JZHCT484Ci2CqJpMJnGEe2+32YDBYrVbr9Rp3yGKxAAv4VRRlOp3itd/vY3L9LBIRekRU2D/6DXRHkDZfIP84AAAAAElFTkSuQmCC\'); background-size: cover; display: block;"\n    >\n      <img\n        class="gatsby-resp-image-image"\n        style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;"\n        alt="2019 07 22 17 18 49"\n        title=""\n        src="/static/2019-07-22-17-18-49-a275e9b92ec445a88c4bc5626cf73bf4-8662f.png"\n        srcset="/static/2019-07-22-17-18-49-a275e9b92ec445a88c4bc5626cf73bf4-60d28.png 200w,\n/static/2019-07-22-17-18-49-a275e9b92ec445a88c4bc5626cf73bf4-c9c95.png 400w,\n/static/2019-07-22-17-18-49-a275e9b92ec445a88c4bc5626cf73bf4-8662f.png 633w"\n        sizes="(max-width: 633px) 100vw, 633px"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<h2 id="具体实现"><a href="#%E5%85%B7%E4%BD%93%E5%AE%9E%E7%8E%B0" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>具体实现</h2>\n<h3 id="我的解答"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="28678517076269960000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`//第一题\n4;\n//第二题\narr.filter((item) => !!item)[\n  //第三题\n  (1, NaN, empty, NAN)\n];\n//第四题\nvar arr3 = [];\nfor (var i = 0; i < arr.length; i++) {\n  arr3.push(arr[i]);\n}\nfor (var j = 0; j < arr2.length; j++) {\n  arr3.push(arr2[i]);\n}\n//第五题\n[...new Set(arr3)];`, `28678517076269960000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                js 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">//第一题</span>\n<span class="token number">4</span><span class="token punctuation">;</span>\n<span class="token comment">//第二题</span>\narr<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token operator">!</span><span class="token operator">!</span>item<span class="token punctuation">)</span><span class="token punctuation">[</span>\n  <span class="token comment">//第三题</span>\n  <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">NaN</span><span class="token punctuation">,</span> empty<span class="token punctuation">,</span> <span class="token constant">NAN</span><span class="token punctuation">)</span>\n<span class="token punctuation">]</span><span class="token punctuation">;</span>\n<span class="token comment">//第四题</span>\n<span class="token keyword">var</span> arr3 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> arr<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  arr3<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> arr2<span class="token punctuation">.</span>length<span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  arr3<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>arr2<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n<span class="token comment">//第五题</span>\n<span class="token punctuation">[</span><span class="token operator">...</span>new <span class="token class-name">Set</span><span class="token punctuation">(</span>arr3<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="最佳解答"><a href="#%E6%9C%80%E4%BD%B3%E8%A7%A3%E7%AD%94" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>最佳解答</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="6514901381582750000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`//第一题\n4\n//第二题\narr.filter((item) => true)\n// 或者 arr.flat()\n//第三题\n[1, NaN, empty, NAN]\n//第四题\narr.concat(arr2)\n//第五题\n[...new Set(arr3)]`, `6514901381582750000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                js 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">//第一题</span>\n<span class="token number">4</span>\n<span class="token comment">//第二题</span>\narr<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token boolean">true</span><span class="token punctuation">)</span>\n<span class="token comment">// 或者 arr.flat()</span>\n<span class="token comment">//第三题</span>\n<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">NaN</span><span class="token punctuation">,</span> empty<span class="token punctuation">,</span> <span class="token constant">NAN</span><span class="token punctuation">]</span>\n<span class="token comment">//第四题</span>\narr<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>arr2<span class="token punctuation">)</span>\n<span class="token comment">//第五题</span>\n<span class="token punctuation">[</span><span class="token operator">...</span>new <span class="token class-name">Set</span><span class="token punctuation">(</span>arr3<span class="token punctuation">)</span><span class="token punctuation">]</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id="实现要点"><a href="#%E5%AE%9E%E7%8E%B0%E8%A6%81%E7%82%B9" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>实现要点</h2>\n<ol>\n<li>空数组项也会作为 length 的一部分；空数组项和空字符串项是有区别的。</li>\n<li>第 2 题，本题只是过滤空数组项，不包括 null, undefined 这类。</li>\n<li>\n<p>去除空数组项两个比较好的回答：</p>\n<ol>\n<li>数组中的 empty 元素不会参与数组项遍历，故只需返回 true 即可过滤掉 empty 元素（而不会牵连 0、NaN、null、undefined、” 这些）arr.filter(it => true)。然后补充，但是走 for 循环，还是会遍历 empty 数组项。</li>\n<li>或者 filter 方法参数直接就是一个 function 即可。例如：~arr.filter(Boolean)~（纠正：不能是 Boolean，false 会被过滤），arr.filter(Number)， arr.filter(String)</li>\n<li>上面并不是最好的方法。数组有个 API，天然去除空数组项，arr.flat()。flat()可以让数组扁平化的方法。</li>\n</ol>\n</li>\n<li>第 3 题标准答案应该是[1, NaN, NaN]，map 里面 Function 支持参数(value, index, arr)，参见 wingmeng 的释义。</li>\n<li>第 4 题就是 concat，可以数组合并。我自己用“连接猫”记忆这个 API。可以分别连接子项，也可以直接连接数组。如果不考虑兼容，可以[…arr, …arr2]。其他参考方法：Array.prototype.push.apply(arr3, arr2)，也可以[].push.apply(arr3, arr2)，此时 arr3 是合并后的数组。</li>\n<li>数组去重。使用 new Set(arr3)，然后把 Set 对象转换成数组。转数组两个常用方法，一个是 Array.from，还有一个是<code class="language-text">[...]</code>。</li>\n</ol>\n<h1 id="js-测试二"><a href="#js-%E6%B5%8B%E8%AF%95%E4%BA%8C" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>JS 测试二</h1>\n<p>\n  <a\n    class="gatsby-resp-image-link"\n    href="/static/2019-07-23-19-34-27-d995dcb262208fcb7153968cb74dc29c-0f06a.png"\n    style="display: block"\n    target="_blank"\n    rel="noopener"\n  >\n  \n  <span\n    class="gatsby-resp-image-wrapper"\n    style="position: relative; display: block; ; max-width: 643px; margin-left: auto; margin-right: auto;"\n  >\n    <span\n      class="gatsby-resp-image-background-image"\n      style="padding-bottom: 139.19129082426127%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAcCAIAAADuuAg3AAAACXBIWXMAAA7DAAAOwwHHb6hkAAABkUlEQVQ4y9VUSXLCMBDk/9/hRJ5AFXdyoCo4wVhSvGi1LHlJWzgOYa9ADjQulRZGM9PTmknXdW3bNk3TnQFOx3F/AkzO2ayjaPYym06n8/mckOTA7MfYWhvHsfd+/wBL7JfGOOdKaznn2HHeZVnmKudrj7t6YyHEYrEwxnTnMeZ1GDYO4IRSEsdbQmmSJPCTpanWuruIyUjYPnY7x0meMK7rWhtNQcs2ofBMiOACuWHzuvGfMYQNSkGYKXvAIX5lafFdjnxHWK2UYuwTKAqeB4gAZPSfYeN6KSUhKBPNs5whBsYKIC9u8ozC9AJyzu9QD7ieMygbq/r970tP5TDsNE3fo+h1uXxbr6EwpMC5uMkYkFJsNh+r1YoyppQG+RBsSKSyAcioCsAcIxbDwwjOPeoEnygP6o1AQJ5UCqyxUEMBtQNpyhjNshz74OXuUo1vbeTseH6MR4jkeY3bm/HYZtC0EIaQ0pRGaxU+jVZgAiA3LCvbawut4nQzgGowQmE8AM1EKdkv0R+KYrjodz+9K+wvUjdxUmEoutwAAAAASUVORK5CYII=\'); background-size: cover; display: block;"\n    >\n      <img\n        class="gatsby-resp-image-image"\n        style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;"\n        alt="2019 07 23 19 34 27"\n        title=""\n        src="/static/2019-07-23-19-34-27-d995dcb262208fcb7153968cb74dc29c-0f06a.png"\n        srcset="/static/2019-07-23-19-34-27-d995dcb262208fcb7153968cb74dc29c-66246.png 200w,\n/static/2019-07-23-19-34-27-d995dcb262208fcb7153968cb74dc29c-2dbe7.png 400w,\n/static/2019-07-23-19-34-27-d995dcb262208fcb7153968cb74dc29c-0f06a.png 643w"\n        sizes="(max-width: 643px) 100vw, 643px"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<h2 id="具体实现-1"><a href="#%E5%85%B7%E4%BD%93%E5%AE%9E%E7%8E%B0-1" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>具体实现</h2>\n<h3 id="我的解答-1"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-1" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="20084147801190322000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`//第一题\n\'1\';\n//第二题\n\'2\';\n//第三题\n\'0.04\';\n//第四题\n\'0.04\';\n//第五题\n//不会`, `20084147801190322000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                js 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">//第一题</span>\n<span class="token string">\'1\'</span><span class="token punctuation">;</span>\n<span class="token comment">//第二题</span>\n<span class="token string">\'2\'</span><span class="token punctuation">;</span>\n<span class="token comment">//第三题</span>\n<span class="token string">\'0.04\'</span><span class="token punctuation">;</span>\n<span class="token comment">//第四题</span>\n<span class="token string">\'0.04\'</span><span class="token punctuation">;</span>\n<span class="token comment">//第五题</span>\n<span class="token comment">//不会</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="最佳解答-1"><a href="#%E6%9C%80%E4%BD%B3%E8%A7%A3%E7%AD%94-1" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>最佳解答</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="85837671142878480000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`//第一题\n\'1\';\n//第二题\n\'2\';\n//第三题\n\'0.04\';\n//第四题\n\'0.04\';\n//第五题\nvar oldtoFixed = Number.prototype.toFixed;\nNumber.prototype.toFixed = function(digits) {\n  var length = (parseFloat(this) + \'\').replace(/^\\d+\\.?/, \'\').length;\n  var len = length > digits ? length : digits;\n  var number = Number(this) + Math.pow(10, -len - 1);\n  return oldtoFixed.call(number, digits);\n};`, `85837671142878480000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                js 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">//第一题</span>\n<span class="token string">\'1\'</span><span class="token punctuation">;</span>\n<span class="token comment">//第二题</span>\n<span class="token string">\'2\'</span><span class="token punctuation">;</span>\n<span class="token comment">//第三题</span>\n<span class="token string">\'0.04\'</span><span class="token punctuation">;</span>\n<span class="token comment">//第四题</span>\n<span class="token string">\'0.04\'</span><span class="token punctuation">;</span>\n<span class="token comment">//第五题</span>\n<span class="token keyword">var</span> oldtoFixed <span class="token operator">=</span> <span class="token class-name">Number</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>toFixed<span class="token punctuation">;</span>\n<span class="token class-name">Number</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">toFixed</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">digits</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">var</span> length <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token function">parseFloat</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">\'\'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex">/^\\d+\\.?/</span><span class="token punctuation">,</span> <span class="token string">\'\'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>length<span class="token punctuation">;</span>\n  <span class="token keyword">var</span> len <span class="token operator">=</span> length <span class="token operator">></span> digits <span class="token operator">?</span> length <span class="token punctuation">:</span> digits<span class="token punctuation">;</span>\n  <span class="token keyword">var</span> number <span class="token operator">=</span> <span class="token function">Number</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span> <span class="token operator">+</span> Math<span class="token punctuation">.</span><span class="token function">pow</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token operator">-</span>len <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token keyword">return</span> <span class="token function">oldtoFixed</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>number<span class="token punctuation">,</span> digits<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id="实现要点-1"><a href="#%E5%AE%9E%E7%8E%B0%E8%A6%81%E7%82%B9-1" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>实现要点</h2>\n<ol>\n<li>toFixed 有两个问题，一是兼容性，二是四舍五入不符合正常的四舍五入认知。金钱计算的时候容易出问题，必须两位小数。</li>\n<li>应该返回字符串；补全末尾的 0。</li>\n<li>机智是实现：方式一：替换小数点保留精度后面一位 5 为 6，方式二：给小数点保留精度后面补一位小数。其中方式 2 是最简单的</li>\n</ol>\n<h1 id="js-测试三"><a href="#js-%E6%B5%8B%E8%AF%95%E4%B8%89" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>JS 测试三</h1>\n<p>\n  <a\n    class="gatsby-resp-image-link"\n    href="/static/2019-07-24-17-42-15-39844983d4b5b540b0f98c9c38864285-3086a.png"\n    style="display: block"\n    target="_blank"\n    rel="noopener"\n  >\n  \n  <span\n    class="gatsby-resp-image-wrapper"\n    style="position: relative; display: block; ; max-width: 656px; margin-left: auto; margin-right: auto;"\n  >\n    <span\n      class="gatsby-resp-image-background-image"\n      style="padding-bottom: 134.90853658536585%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAbCAIAAADzvTiPAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAB0ElEQVQ4y71U2XbCIBT0/z/HD/AXtK++RE3rkrAEAiSYpR0uaVzqck7r6TzgBRly586FyecddH13JPR9f2/P5Goet/q6XizeptPpbDZbLpd17b//7c7PCmSt9W63uzqiaZr45a7rylJXVR0Cra1zbdsiHsjb7XY+n2MfCN57jB3h/CM94Tw4pQ0OY0wKwXL8Mmst0qmqahTySPODHQ8QyNDgnFVKQZuxtixLayDNSVkgBWuwZpEacolSr8nIEByHXc6pQoEZVrTGoilLnAuyMeYG+dcIZNSZsXyz2ayShHF+yLKc5UAhJUIhJWYCtWS0GpDBuYGMaoGPPJHhULxLV/ozxPq+KO345dge7YjYYUOfeZTqZ58PmiWEcS6lyLNcBqkZKizQNAKSZVEUcAExznxptZFMS80eO34cn7bdkDby5GQGFxwxekMIXnv/nPyntF+gmRzx5I2Pzh0paghHmsYXYixH1Ow/3tP9/gDBcEYQclSBc/gHn5QqeAArFFpW4vo05NmQdndp4H9phqtQWBFw9YHKOXoFDPrM0CWPjwRGXPSQdtOcyOl6nSSrNE1hsqY3ACOYKECY6QCoVbSIdjhdyRf4PDYjBf1t0FUe7/UXWf0wq2dKgvIAAAAASUVORK5CYII=\'); background-size: cover; display: block;"\n    >\n      <img\n        class="gatsby-resp-image-image"\n        style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;"\n        alt="2019 07 24 17 42 15"\n        title=""\n        src="/static/2019-07-24-17-42-15-39844983d4b5b540b0f98c9c38864285-3086a.png"\n        srcset="/static/2019-07-24-17-42-15-39844983d4b5b540b0f98c9c38864285-a142c.png 200w,\n/static/2019-07-24-17-42-15-39844983d4b5b540b0f98c9c38864285-201ef.png 400w,\n/static/2019-07-24-17-42-15-39844983d4b5b540b0f98c9c38864285-3086a.png 656w"\n        sizes="(max-width: 656px) 100vw, 656px"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<h2 id="具体实现-2"><a href="#%E5%85%B7%E4%BD%93%E5%AE%9E%E7%8E%B0-2" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>具体实现</h2>\n<h3 id="我的解答-2"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-2" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="49673010665121000000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`//第一题\ndocument.cookie;\n//第二题\ndocument.cookie = \'userid=1\';\n//第三题\ndocument.cookie = \'userid=1;expire=\' + new Date(Date.now() + 24 * 3600 * 1000).toGMTString();\n//第四题\nfunction getCookie(name) {\n  var strCookie = document.cookie;\n  var arrCookie = strCookie.split(\'; \');\n  for (var i = 0; i < arrCookie.length; i++) {\n    var arr = arrCookie[i].split(\'=\');\n    if (arr[0] === name) {\n      return arr[1];\n    }\n  }\n  return \'\';\n}\ngetCookie(\'_csrfToken\');\n//第五题\ndocument.cookie = \'ywkey=1;expire=\' + new Date(Date.now() - 24 * 3600 * 1000).toGMTString();\n//第六题\nlocalStorage.setItem(\'userid\', 1);\n//第七题\nif (timestamp <= Date.now()) {\n  localStorage.removeItem(\'userid\');\n}`, `49673010665121000000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                js 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">//第一题</span>\ndocument<span class="token punctuation">.</span>cookie<span class="token punctuation">;</span>\n<span class="token comment">//第二题</span>\ndocument<span class="token punctuation">.</span>cookie <span class="token operator">=</span> <span class="token string">\'userid=1\'</span><span class="token punctuation">;</span>\n<span class="token comment">//第三题</span>\ndocument<span class="token punctuation">.</span>cookie <span class="token operator">=</span> <span class="token string">\'userid=1;expire=\'</span> <span class="token operator">+</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span>Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">24</span> <span class="token operator">*</span> <span class="token number">3600</span> <span class="token operator">*</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toGMTString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token comment">//第四题</span>\n<span class="token keyword">function</span> <span class="token function">getCookie</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">var</span> strCookie <span class="token operator">=</span> document<span class="token punctuation">.</span>cookie<span class="token punctuation">;</span>\n  <span class="token keyword">var</span> arrCookie <span class="token operator">=</span> strCookie<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">\'; \'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> arrCookie<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">var</span> arr <span class="token operator">=</span> arrCookie<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">\'=\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">if</span> <span class="token punctuation">(</span>arr<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">===</span> name<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token keyword">return</span> arr<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n  <span class="token punctuation">}</span>\n  <span class="token keyword">return</span> <span class="token string">\'\'</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n<span class="token function">getCookie</span><span class="token punctuation">(</span><span class="token string">\'_csrfToken\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token comment">//第五题</span>\ndocument<span class="token punctuation">.</span>cookie <span class="token operator">=</span> <span class="token string">\'ywkey=1;expire=\'</span> <span class="token operator">+</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span>Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">24</span> <span class="token operator">*</span> <span class="token number">3600</span> <span class="token operator">*</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toGMTString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token comment">//第六题</span>\nlocalStorage<span class="token punctuation">.</span><span class="token function">setItem</span><span class="token punctuation">(</span><span class="token string">\'userid\'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token comment">//第七题</span>\n<span class="token keyword">if</span> <span class="token punctuation">(</span>timestamp <span class="token operator">&lt;=</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  localStorage<span class="token punctuation">.</span><span class="token function">removeItem</span><span class="token punctuation">(</span><span class="token string">\'userid\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="最佳解答-2"><a href="#%E6%9C%80%E4%BD%B3%E8%A7%A3%E7%AD%94-2" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>最佳解答</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="14983159311965987000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`//第七题\n/**\n * 重写localStorage\n */\nfunction rewriteLocalStorage() {\n  if (!window.__rewrite__localStorage) {\n    Object.assign(window, {\n      __rewrite__localStorage: true,\n      __localStorage__setItem: localStorage.setItem,\n      __localStorage__getItem: localStorage.getItem,\n      __localStorage__removeItem: localStorage.removeItem\n    });\n\n    if (!localStorage.__expires) {\n      localStorage.__expires = \'{}\';\n    }\n\n    localStorage.setItem = function(key, value, millisecond) {\n      if (millisecond) {\n        let __expires = JSON.parse(localStorage.__expires);\n        __expires[key] = +Date.now() + millisecond;\n        localStorage.__expires = JSON.stringify(__expires);\n      }\n      window.__localStorage__setItem.call(this, key, value);\n    };\n\n    localStorage.getItem = function(key) {\n      window.clearExpires();\n      return window.__localStorage__getItem.call(this, key);\n    };\n\n    localStorage.removeItem = function(key) {\n      let __expires = JSON.parse(localStorage.__expires);\n      delete __expires[key];\n      localStorage.__expires = JSON.stringify(__expires);\n      return window.__localStorage__removeItem.call(this, key);\n    };\n\n    window.clearExpires = function() {\n      let __expires = JSON.parse(localStorage.__expires);\n      for (let key in __expires) {\n        if (__expires[key] < Date.now()) {\n          localStorage.removeItem(key);\n        }\n      }\n    };\n  }\n}\n/**\n * 销毁重写localStorage\n */\nfunction destoryRewriteLocalStorage() {\n  if (window.__rewrite__localStorage) {\n    localStorage.setItem = window.__localStorage__setItem;\n\n    localStorage.getItem = window.__localStorage__getItem;\n\n    localStorage.removeItem = window.__localStorage__removeItem;\n\n    delete window.__rewrite__localStorage;\n    delete window.__localStorage__setItem;\n    delete window.__localStorage__getItem;\n    delete window.__localStorage__removeItem;\n    delete window.clearExpires;\n    localStorage.removeItem(\'__expires\');\n  }\n}`, `14983159311965987000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                js 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">//第七题</span>\n<span class="token comment">/**\n * 重写localStorage\n */</span>\n<span class="token keyword">function</span> <span class="token function">rewriteLocalStorage</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>window<span class="token punctuation">.</span>__rewrite__localStorage<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    Object<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span>window<span class="token punctuation">,</span> <span class="token punctuation">{</span>\n      __rewrite__localStorage<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>\n      __localStorage__setItem<span class="token punctuation">:</span> localStorage<span class="token punctuation">.</span>setItem<span class="token punctuation">,</span>\n      __localStorage__getItem<span class="token punctuation">:</span> localStorage<span class="token punctuation">.</span>getItem<span class="token punctuation">,</span>\n      __localStorage__removeItem<span class="token punctuation">:</span> localStorage<span class="token punctuation">.</span>removeItem\n    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>localStorage<span class="token punctuation">.</span>__expires<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      localStorage<span class="token punctuation">.</span>__expires <span class="token operator">=</span> <span class="token string">\'{}\'</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n\n    localStorage<span class="token punctuation">.</span><span class="token function-variable function">setItem</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">key<span class="token punctuation">,</span> value<span class="token punctuation">,</span> millisecond</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token keyword">if</span> <span class="token punctuation">(</span>millisecond<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        <span class="token keyword">let</span> __expires <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>localStorage<span class="token punctuation">.</span>__expires<span class="token punctuation">)</span><span class="token punctuation">;</span>\n        __expires<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token operator">+</span>Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> millisecond<span class="token punctuation">;</span>\n        localStorage<span class="token punctuation">.</span>__expires <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>__expires<span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span>\n      window<span class="token punctuation">.</span><span class="token function">__localStorage__setItem</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> key<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n    localStorage<span class="token punctuation">.</span><span class="token function-variable function">getItem</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">key</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      window<span class="token punctuation">.</span><span class="token function">clearExpires</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token keyword">return</span> window<span class="token punctuation">.</span><span class="token function">__localStorage__getItem</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n    localStorage<span class="token punctuation">.</span><span class="token function-variable function">removeItem</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">key</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token keyword">let</span> __expires <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>localStorage<span class="token punctuation">.</span>__expires<span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token keyword">delete</span> __expires<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">;</span>\n      localStorage<span class="token punctuation">.</span>__expires <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>__expires<span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token keyword">return</span> window<span class="token punctuation">.</span><span class="token function">__localStorage__removeItem</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n    window<span class="token punctuation">.</span><span class="token function-variable function">clearExpires</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token keyword">let</span> __expires <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>localStorage<span class="token punctuation">.</span>__expires<span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> key <span class="token keyword">in</span> __expires<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        <span class="token keyword">if</span> <span class="token punctuation">(</span>__expires<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">&lt;</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n          localStorage<span class="token punctuation">.</span><span class="token function">removeItem</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token punctuation">}</span>\n      <span class="token punctuation">}</span>\n    <span class="token punctuation">}</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n<span class="token comment">/**\n * 销毁重写localStorage\n */</span>\n<span class="token keyword">function</span> <span class="token function">destoryRewriteLocalStorage</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">if</span> <span class="token punctuation">(</span>window<span class="token punctuation">.</span>__rewrite__localStorage<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    localStorage<span class="token punctuation">.</span>setItem <span class="token operator">=</span> window<span class="token punctuation">.</span>__localStorage__setItem<span class="token punctuation">;</span>\n\n    localStorage<span class="token punctuation">.</span>getItem <span class="token operator">=</span> window<span class="token punctuation">.</span>__localStorage__getItem<span class="token punctuation">;</span>\n\n    localStorage<span class="token punctuation">.</span>removeItem <span class="token operator">=</span> window<span class="token punctuation">.</span>__localStorage__removeItem<span class="token punctuation">;</span>\n\n    <span class="token keyword">delete</span> window<span class="token punctuation">.</span>__rewrite__localStorage<span class="token punctuation">;</span>\n    <span class="token keyword">delete</span> window<span class="token punctuation">.</span>__localStorage__setItem<span class="token punctuation">;</span>\n    <span class="token keyword">delete</span> window<span class="token punctuation">.</span>__localStorage__getItem<span class="token punctuation">;</span>\n    <span class="token keyword">delete</span> window<span class="token punctuation">.</span>__localStorage__removeItem<span class="token punctuation">;</span>\n    <span class="token keyword">delete</span> window<span class="token punctuation">.</span>clearExpires<span class="token punctuation">;</span>\n    localStorage<span class="token punctuation">.</span><span class="token function">removeItem</span><span class="token punctuation">(</span><span class="token string">\'__expires\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id="实现要点-2"><a href="#%E5%AE%9E%E7%8E%B0%E8%A6%81%E7%82%B9-2" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>实现要点</h2>\n<ol>\n<li>通过前端手段设置 cookie 的过期时间，一定要使用服务器时间，不能使用本地时间。两个原因：一个是和服务端统一；本地时间是不准的，用户可以修改的；</li>\n<li>获取 cookie 方法，一类：字符分隔，数组遍历，查询对应的键值。二类：正则，可以看看 Seasonley 的实现。</li>\n<li>?&#x3C;指的什么？--- （“(?&#x3C;=\\bsub)\\w+\\b”定位“sub”后面的字符串）。零宽断言。有兼容性问题，见下面讨论，不推荐实际项目使用。</li>\n<li>设置过期时间可以 expires，也可以是 max-age。区别是什么呢？max-age 是更新的过期时间用法，是 IE9+浏览器才支持的，更容易理解和记忆。</li>\n<li>删除 cookie 可以设置过期时间为之前。</li>\n<li>localStorage.setItem(‘userid’, 1)或者简写：localStorage.userid = 1;</li>\n<li>localStorage 过期时间，JSON.stringify 和 JSON.parse 是可读性很不错，也容易维护的实现。</li>\n<li>可以以上 localStorage 重写，隐藏时间过期的细节，非常适合作为小工具，小组件。</li>\n</ol>\n<h1 id="js-测试四"><a href="#js-%E6%B5%8B%E8%AF%95%E5%9B%9B" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>JS 测试四</h1>\n<p>\n  <a\n    class="gatsby-resp-image-link"\n    href="/static/2019-07-30-16-01-42-9226f4fc3a6c9eb9782cbb766072da54-81a6c.png"\n    style="display: block"\n    target="_blank"\n    rel="noopener"\n  >\n  \n  <span\n    class="gatsby-resp-image-wrapper"\n    style="position: relative; display: block; ; max-width: 600px; margin-left: auto; margin-right: auto;"\n  >\n    <span\n      class="gatsby-resp-image-background-image"\n      style="padding-bottom: 143.00000000000003%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAdCAIAAAAl5NuSAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAD9ElEQVQ4y1VVCY7jOAz0/1+3i5mke5L4vu9Tt+RsUc42MAYRqA0XWSSr1EE3tuPSL9u0s4XLXRturHROn6c5T+vjfL9/4ufB2QbN0PRTP6/TdqyMH0JypaWx2jmA3fvtTgQdfpBIhoTOOB00XdWP3TiPyzofbOeCKSW0UcYoqYSUwlpLH5/n/xVPdzp3WhQIqqbo+mYYu2WdDrZdla0zgJVVGcdR09Scc1+NYJ/DG5VNkFdZ3VbD1H/9ub+iB7LMy7huaAEUJMJYK4RQWmmj8RJ/Ojzvk8BZkZQ1FQ+T1+P1nWUJchVlXpTFsi7bvqEs2OOAjDs71n0TSqIHAqd5XFQFOi/rMiuytmsQ/Th0fbeu68EYF1xKeV6PnxYNEGtwNkhSgHNUq9u66Zpu6LoRw18Wgu4Hw/ylVPoCOJ/BfsIGcRrmZVY2ZdM3gI3zsGwLuO2cMdRUaNUY7M2hSWevmj/gMAnBFm03XY2y/TSO87SgwWPfGfBCYlD2JDDp5u1Xf4FdEMavNE+qpgzj8Pf99yt8RXEUJXGap2UNCYz9ME4zuBzTsg7zPK8YmEIK4INXRGBMC1/HaZLlWVGVgFVNM87LBt0cggstlAEH2pgxtCvfPMBPwPKqqDztYRyGCaVQy1M/xMGBsVI7qazSp0Gv7ryav8AJwHWLUfe9B4+e3gYkUygrlZP6RFxg87ELwCGBseo0z8IoTLIkzdKiqnKwr7q2m6Z5m9cD0weLnUmG1YH5X+C6iNP49nW7f3/9ef55RWEYJVGC/luYDjsAkgnFhOaSTGOcpx2GzyxPSSfUM9GmbU0Y7YZqB1dc2oswlCK11ZAlrR0z86vKCmwFNUhkbd+1PsVIM9u3a2DSYmY0NmXIHwZ+tCSSCCIpSSRQKOTZ08ChswkK3Y7jYMTWT5tCwcTWaYtfKMcAHOVVDpGgcuEP4A8K19ihCjgLaSgRF95VO4wCpMJlEKcAZ9Dm4/n9769/7t83jO12v2Fm0MwzfL2iKM7SNM/Lusb4sFEkAhiDI0uSsNsaWRBEm660ednXA96QgispNO4EI7RGKIMrDgfcVTLIaE/Etu1aXGZATgvdZ3A/SMJYQkKXStLXaF5ewRSScvJzXqYAe1c1vixc5dvkBOZSfDD6g8QbYiRZEHlX4d5p2gqXkffzvO7LDkdwukY4ffdXsM+BQduPBNouM7RNxsAdTGBvCn8fcHkFdoZkzNPBe/wewTN8xFmUlSmBx27y4A3TooavyhSUBWDAOHZ2kFP5Hnw9v57xM85itN1DmguV3cmLjLr9MLzAyEWVAaOm2BbcHzfgoTMMbJio4f3YkJ4Kwo6+rFCfoP8h9MukOpTe/wPEuGTPzhyJEQAAAABJRU5ErkJggg==\'); background-size: cover; display: block;"\n    >\n      <img\n        class="gatsby-resp-image-image"\n        style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;"\n        alt="2019 07 30 16 01 42"\n        title=""\n        src="/static/2019-07-30-16-01-42-9226f4fc3a6c9eb9782cbb766072da54-81a6c.png"\n        srcset="/static/2019-07-30-16-01-42-9226f4fc3a6c9eb9782cbb766072da54-468c3.png 200w,\n/static/2019-07-30-16-01-42-9226f4fc3a6c9eb9782cbb766072da54-3ff2b.png 400w,\n/static/2019-07-30-16-01-42-9226f4fc3a6c9eb9782cbb766072da54-81a6c.png 600w"\n        sizes="(max-width: 600px) 100vw, 600px"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<h2 id="具体实现-3"><a href="#%E5%85%B7%E4%BD%93%E5%AE%9E%E7%8E%B0-3" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>具体实现</h2>\n<h3 id="我的解答-3"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-3" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="36474075453090517000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 第一题\ncontent.length <= 140;\n// 第二题\ncontent.trim().replace(/\\s+/g, \' \');\n// 第三题\nMath.ceil([...content.trim().replace(/\\s+/g, \' \')].map((item) => item.charCodeAt()).join(\'\').length / 2);\n// 第四题\n// 正则实现`, `36474075453090517000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                js 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// 第一题</span>\ncontent<span class="token punctuation">.</span>length <span class="token operator">&lt;=</span> <span class="token number">140</span><span class="token punctuation">;</span>\n<span class="token comment">// 第二题</span>\ncontent<span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex">/\\s+/g</span><span class="token punctuation">,</span> <span class="token string">\' \'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token comment">// 第三题</span>\nMath<span class="token punctuation">.</span><span class="token function">ceil</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token operator">...</span>content<span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex">/\\s+/g</span><span class="token punctuation">,</span> <span class="token string">\' \'</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class="token punctuation">)</span> <span class="token operator">=></span> item<span class="token punctuation">.</span><span class="token function">charCodeAt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">\'\'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>length <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token comment">// 第四题</span>\n<span class="token comment">// 正则实现</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="最佳解答-3"><a href="#%E6%9C%80%E4%BD%B3%E8%A7%A3%E7%AD%94-3" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>最佳解答</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="6673618256653290000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 第一题\nfunction testLength(str) {\n  return str.length > 140;\n}\n\n// 第二题\nfunction testLengthNoSpace(str) {\n  return testLength(str.trim().replace(/\\s+/g, \' \'));\n}\n\n// 第三题\nfunction testLengthNoASCII(str) {\n  str = str.trim().replace(/\\s+/g, \' \');\n  let ascLen = 0;\n  for (let i = 0; i < str.length; i++) {\n    // 小于 128 的是可见字符\n    str.charCodeAt(i) < 128 && ascLen++;\n  }\n  return str.length - Math.floor(ascLen / 2) > 140;\n}\n\n// 第四题\nfunction testLengthNoURL(str) {\n  let placeHolder = Array(21).join(\',\');\n  str = str\n    .trim()\n    .replace(/\\s+/g, \' \')\n    // \\x21-\\x7e 匹配不可见字符\n    .replace(/http:\\/\\/[\\x21-\\x7e]{13,}?(?=[^\\x21-\\x7e]|\\$)/g, placeHolder)\n    .replace(/https:\\/\\/[\\x21-\\x7e]{12,}?(?=[^\\x21-\\x7e]|\\$)/g, placeHolder);\n  return testLengthNoASCII(str);\n}`, `6673618256653290000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                js 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// 第一题</span>\n<span class="token keyword">function</span> <span class="token function">testLength</span><span class="token punctuation">(</span><span class="token parameter">str</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">return</span> str<span class="token punctuation">.</span>length <span class="token operator">></span> <span class="token number">140</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token comment">// 第二题</span>\n<span class="token keyword">function</span> <span class="token function">testLengthNoSpace</span><span class="token punctuation">(</span><span class="token parameter">str</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">return</span> <span class="token function">testLength</span><span class="token punctuation">(</span>str<span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex">/\\s+/g</span><span class="token punctuation">,</span> <span class="token string">\' \'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token comment">// 第三题</span>\n<span class="token keyword">function</span> <span class="token function">testLengthNoASCII</span><span class="token punctuation">(</span><span class="token parameter">str</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  str <span class="token operator">=</span> str<span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex">/\\s+/g</span><span class="token punctuation">,</span> <span class="token string">\' \'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token keyword">let</span> ascLen <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>\n  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> str<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token comment">// 小于 128 的是可见字符</span>\n    str<span class="token punctuation">.</span><span class="token function">charCodeAt</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">128</span> <span class="token operator">&amp;&amp;</span> ascLen<span class="token operator">++</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n  <span class="token keyword">return</span> str<span class="token punctuation">.</span>length <span class="token operator">-</span> Math<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span>ascLen <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">140</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token comment">// 第四题</span>\n<span class="token keyword">function</span> <span class="token function">testLengthNoURL</span><span class="token punctuation">(</span><span class="token parameter">str</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">let</span> placeHolder <span class="token operator">=</span> <span class="token function">Array</span><span class="token punctuation">(</span><span class="token number">21</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">\',\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  str <span class="token operator">=</span> str\n    <span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n    <span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex">/\\s+/g</span><span class="token punctuation">,</span> <span class="token string">\' \'</span><span class="token punctuation">)</span>\n    <span class="token comment">// \\x21-\\x7e 匹配不可见字符</span>\n    <span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex">/http:\\/\\/[\\x21-\\x7e]{13,}?(?=[^\\x21-\\x7e]|$)/g</span><span class="token punctuation">,</span> placeHolder<span class="token punctuation">)</span>\n    <span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex">/https:\\/\\/[\\x21-\\x7e]{12,}?(?=[^\\x21-\\x7e]|$)/g</span><span class="token punctuation">,</span> placeHolder<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token keyword">return</span> <span class="token function">testLengthNoASCII</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id="实现要点-3"><a href="#%E5%AE%9E%E7%8E%B0%E8%A6%81%E7%82%B9-3" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>实现要点</h2>\n<ol>\n<li>空格替换直接 trim()方法，以及/\\s+/g 正则即可；</li>\n<li>ASCII 字符非连续也算半个字符，可以使用<code class="language-text">str.match(/[\\x00-\\xff]/g).length</code>；</li>\n<li>网址优先判断；</li>\n<li>替换的字符务必是非 ASCII 字符（否则会认为是 5 个字符长度）；</li>\n<li>20 个 ASCII 字符长度，可以 Array(20).join()或者’,‘.repeat(20)；</li>\n</ol>\n<h1 id="js-测试五"><a href="#js-%E6%B5%8B%E8%AF%95%E4%BA%94" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>JS 测试五</h1>\n<p>\n  <a\n    class="gatsby-resp-image-link"\n    href="/static/2019-08-02-14-30-42-b4df7c04e1769dbc5c5869a67b8046b4-81a6c.png"\n    style="display: block"\n    target="_blank"\n    rel="noopener"\n  >\n  \n  <span\n    class="gatsby-resp-image-wrapper"\n    style="position: relative; display: block; ; max-width: 600px; margin-left: auto; margin-right: auto;"\n  >\n    <span\n      class="gatsby-resp-image-background-image"\n      style="padding-bottom: 133.33333333333331%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAbCAIAAADzvTiPAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAEOklEQVQ4y6VSaXOiWBTl//+GSU/1dKc6bRJDjFtc2iVoRKNxV0Rk50EAQVEBWZxrumaqq2a658O8OvW8vsc5954D2OmXK47jX9xip/+xsJ91gJMwDI7vK4qi/+gc/7W+14oiT6fj4XCwXNK2bf+rkTMZhB3H+af831q+71uWFQSB73vm2oC/UMMVkGM4oqippqmbjWXbluNsYQf8bNofO0eg4Xrubud4ngdCYRiCT5D/edRwDroR9v4T73ZbyzaBEwRH93AACaD/QD4/HYO/OIxPQXQ6RrEfxh6Qw/fm4W5nq0jW3hRJFkSR1zQEs8BFdIrCKAhCP4i8Y+j6weE73OMOi0/+6RSEkbe2NaSKwDFMneMZhGRVRWDbO/oH77B3d3vX2bvb3WGzB0Cxt85kAMygr5Ekc6oqK4oEACZAQcrGcTbOxtpYgI2ztrfmZnve17aOhZEbRK5paRxPI030/f3ZcHD+MIIwNNambhqAN0PXzTdj/R2aYai6jrAgPBzDg+c7qi4tllOWo1luiZACb9LZ7UxrjTRVVpGEFEVVkKZoOlJ1GWmyogoY0ADmWmXYOcsttDdZ0+S1ZbquK0iyJCNRVgRZ4kVBgChVgCgjASDKHHY42PuDrRsKtJ3OBooiGMab57nxKdYNk+UEoPEizwkcL3IgJSq8ILGCCDcM5uzWgM3WYHl6OO7NqdGSmdu2uXf3DMfSDLPi2BUPj3KCxEsKL8k8MMEaw1KYvTUAENiKW0zmA4qe8AIDw8PbIhpPvX6XfHkmnp863RZgyS7eB2ah+Zm83kB6qm4qholMW3P2FuQH34CiiqNJf0ZNpvPxaDyYzEZQrzgaaCue5kWGYReYYSGopvMh9BxP+vRyumRmMEV/0K1Ui0Sz1niuN5o1ollvtZsvPbLTI19eyd6gQzFTTNUFQVqNJq/AWdATajFmVnNegPSG3R7Z7ZKdzjPZbrZIotVudLok2Wk2SaLZJkbUAJMQB1HNqBFwlqvZcjWHzIajXrVayuUf8o9p2HP5NBSPxWy5UgDn7dcWNO+Ouhgv0oLIKEhQEGS6ACFBXFGLCdlu1Ovlaq30rVIolfPFUrZQyhbLj8Rz/em59tSstV9JjBUo8CwqLC8uZ9QQPMMIw1EXfBZLwMkVSjkogP+tWqjWS5V6uVIrAZovDWzBzlhhyUvMgplCDP1RbzjugkNIK53B01n8AfYMnsmmsjD/efhMoZx7LOcI8gmb0mPwSbPz4eS11SbaL03YgZnPp5PJRBJPJO8Sd/g1nrq9T9+BUCpzl8ri6fzDE0lg4/lgDMT5gHxpVOololGt1IrZ3P0dnvhy9elL4vIKcH2ZSF4lUzd4+u72IXmbSuKZVL3VwAaTfnfQ6fTJUr2Qyt9ni5mH3P0t/vXTl48XH3/78MfFh08Xv3++uLy5TOBfE3gigV9f4dc3KbzWIv4EZKea8KgdFcYAAAAASUVORK5CYII=\'); background-size: cover; display: block;"\n    >\n      <img\n        class="gatsby-resp-image-image"\n        style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;"\n        alt="2019 08 02 14 30 42"\n        title=""\n        src="/static/2019-08-02-14-30-42-b4df7c04e1769dbc5c5869a67b8046b4-81a6c.png"\n        srcset="/static/2019-08-02-14-30-42-b4df7c04e1769dbc5c5869a67b8046b4-468c3.png 200w,\n/static/2019-08-02-14-30-42-b4df7c04e1769dbc5c5869a67b8046b4-3ff2b.png 400w,\n/static/2019-08-02-14-30-42-b4df7c04e1769dbc5c5869a67b8046b4-81a6c.png 600w"\n        sizes="(max-width: 600px) 100vw, 600px"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<h2 id="具体实现-4"><a href="#%E5%85%B7%E4%BD%93%E5%AE%9E%E7%8E%B0-4" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>具体实现</h2>\n<h3 id="最佳解答-4"><a href="#%E6%9C%80%E4%BD%B3%E8%A7%A3%E7%AD%94-4" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>最佳解答</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="73428976314857990000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`var testSpecs = [\n  \'在LeanCloud上，数据存储是围绕AVObject进行的。\',\n  \'今天出去买菜花了 5000元。\',\n  \'我家的光纤入户宽带有 10Gbps，SSD 一共有 10TB。显示器分辨率宽度是1920px。\',\n  \'今天是 233 ° 的高温。新 MacBook Pro 有 15 % 的 CPU 性能提升。\',\n  \'刚刚买了一部 iPhone ，好开心 ！\',\n  \'她竟然对你说「喵」？！？！？？！！喵？？！！Meow...\',\n  \'你好，我是破折号——一个不苟言笑的符号。\',\n  \'核磁共振成像 (NMRI) 是什么原理都不知道? JFGI!\',\n  \'这件蛋糕只卖 １０００ 元。\',\n  \'乔布斯那句话是怎么说的？「Stay hungry，stay foolish。」\',\n  \'推荐你阅读《Hackers＆Painters：Big Ideas from the Computer Age》，非常的有趣。\'\n];\n\ncharCheck(testSpecs.join(\'\'));\n\nfunction charCheck(str) {\n  // 枚举类型的符号\n  var symbols = {\n    full: \'！（）【】『』「」《》“”‘’；：，。？、\',\n    half: \'!-_()[]{}<>&quot;\\\';:,./?\\`\',\n    getRegStr: function(key) {\n      var symbols =\n        typeof key === \'string\'\n          ? this[key]\n          : (function(that) {\n              if (key instanceof Array) {\n                return key.reduce(function(total, cur) {\n                  return (total += that[cur]);\n                }, \'\');\n              }\n\n              return \'\';\n            })(this);\n\n      // 返回符合 regexp 语法的字符串\n      return symbols\n        .split(\'\')\n        .map(function(s) {\n          return \'\\\\\' + s;\n        })\n        .join(\'|\');\n    },\n    getRegRule: function(key, usedAs) {\n      var strs = this.getRegStr.call(this, \'full\');\n      var regArr = [\'(\\\\S+)\', \'([\' + strs + \'])\'];\n      var temp = [].concat(regArr);\n      temp.reverse();\n\n      if (usedAs === \'rule\') {\n        return new RegExp(\'(:?\' + regArr.join(\'\\\\s+\') + \')|\' + \'(:?\' + temp.join(\'\\\\s+\') + \')\', \'g\');\n      } else if (usedAs === \'format\') {\n        return [new RegExp(regArr.join(\'\\\\s+\'), \'g\'), new RegExp(temp.join(\'\\\\s+\'), \'g\')];\n      }\n    }\n  };\n\n  var regExps = [\n    {\n      rule: /([\\u4e00-\\u9fa5]+[a-zA-Z]+)|([a-zA-Z]+[\\u4e00-\\u9fa5]+)/g,\n      format: [/([\\u4e00-\\u9fa5]+)([a-zA-Z]+)/g, /([a-zA-Z]+)([\\u4e00-\\u9fa5]+)/g],\n      matches: \'\\$1 \\$2\',\n      msg: \'中英文之间需要增加空格\'\n    },\n    {\n      rule: /([\\u4e00-\\u9fa5]+\\d+)|(\\d+[\\u4e00-\\u9fa5]+)/g,\n      format: [/([\\u4e00-\\u9fa5]+)(\\d+)/g, /(\\d+)([\\u4e00-\\u9fa5]+)/g],\n      matches: \'\\$1 \\$2\',\n      msg: \'中文与数字之间需要增加空格\'\n    },\n    {\n      rule: /(\\d)([A-Z]+)/g,\n      matches: \'\\$1 \\$2\',\n      msg: \'数字与大写英文单位之间需要增加空格\'\n    },\n    {\n      rule: /(\\d+)\\s+(°|%)/g,\n      matches: \'\\$1\\$2\',\n      msg: \'° 或 % 与数字之间不需要空格\'\n    },\n    {\n      rule: symbols.getRegRule(\'full\', \'rule\'),\n      format: symbols.getRegRule(\'full\', \'format\'),\n      matches: \'\\$1\\$2\',\n      msg: \'全角标点与其他字符之间不加空格\'\n    },\n    {\n      // rule: new RegExp(\'(\' + symbols.getRegStr([\'full\', \'half\']) + \')\\\\1+\', \'g\'),\n      rule: new RegExp(\'(\' + symbols.getRegStr(\'full\') + \')\\\\1+\', \'g\'),\n      matches: \'\\$1\',\n      msg: \'不重复使用中文标点符号\'\n    },\n    {\n      rule: /(\\S)(——)(\\S)/g,\n      matches: \'\\$1 \\$2 \\$3\',\n      msg: \'破折号前后需要增加一个空格\'\n    },\n    {\n      // 这条必须位于“遇到完整的英文整句、特殊名词，其內容使用半角标点”之前\n      rule: new RegExp(\'\\\\s*(\' + symbols.getRegStr(\'half\') + \')\\\\s*\', \'g\'),\n      matches: function(s) {\n        s = s.replace(/(^\\s*)|(\\s*\\$)/g, \'\');\n        return String.fromCharCode(s.charCodeAt() + 65248);\n      },\n      msg: \'使用全角中文标点\'\n    },\n    {\n      rule: /[\\uFF10-\\uFF19]/g,\n      matches: function(s) {\n        // 半角字符与全角字符的 charCode 相差 65248\n        return String.fromCharCode(s.charCodeAt() - 65248);\n      },\n      msg: \'数字使用半角字符\'\n    },\n    {\n      // 中文的句号“。”不是全角字符，需要特殊处理\n      rule: /[《|「](:?\\s*[a-zA-Z]+\\s*(。|[\\uff00-\\uffff])*\\s*[a-zA-Z]*)+[\\.|」|》]/g,\n      matches: function(s) {\n        return s.replace(/。|[\\uff00-\\uffff]/g, function(\\$1) {\n          var half = String.fromCharCode(\\$1.charCodeAt() - 65248);\n\n          if (!!~[\'&\', \'-\', \'+\'].indexOf(half)) {\n            // 需要前后加空格的字符\n            half = \' \' + half + \' \';\n          } else if (!!~[\':\', \',\', \';\'].indexOf(half)) {\n            // 需要后面加空格的字符\n            half += \' \';\n          } else if (half === \'ㄢ\') {\n            half = \'.\';\n          }\n\n          return half;\n        });\n      },\n      msg: \'遇到完整的英文整句、特殊名词，其內容使用半角标点\'\n    }\n  ];\n\n  var result = str;\n\n  regExps.forEach(function(reg, idx) {\n    var format = reg.format;\n    var matches = reg.matches;\n    var tip = str.match(reg.rule);\n\n    if (tip) {\n      console.group(\'%c\' + reg.msg + \' (X)\', \'color: red\');\n      console.log(tip.join(\'\\n\'));\n      console.groupEnd();\n\n      if (!format) {\n        result = result.replace(reg.rule, matches);\n      } else if (format instanceof Array) {\n        format.forEach(function(fmtReg) {\n          result = result.replace(fmtReg, matches);\n        });\n      } else if (Object.prototype.toString.call(format) === \'[object RegExp]\') {\n        result = result.replace(format, matches);\n      }\n    }\n  });\n\n  if (result === str) {\n    console.log(\'%c当前文本符合规范 (√)\', \'color: green\');\n    return;\n  }\n\n  console.group(\'按规范格式化后的文本：\');\n  console.log(\'%c\' + result, \'color: green\');\n  console.groupEnd();\n}`, `73428976314857990000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                js 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">var</span> testSpecs <span class="token operator">=</span> <span class="token punctuation">[</span>\n  <span class="token string">\'在LeanCloud上，数据存储是围绕AVObject进行的。\'</span><span class="token punctuation">,</span>\n  <span class="token string">\'今天出去买菜花了 5000元。\'</span><span class="token punctuation">,</span>\n  <span class="token string">\'我家的光纤入户宽带有 10Gbps，SSD 一共有 10TB。显示器分辨率宽度是1920px。\'</span><span class="token punctuation">,</span>\n  <span class="token string">\'今天是 233 ° 的高温。新 MacBook Pro 有 15 % 的 CPU 性能提升。\'</span><span class="token punctuation">,</span>\n  <span class="token string">\'刚刚买了一部 iPhone ，好开心 ！\'</span><span class="token punctuation">,</span>\n  <span class="token string">\'她竟然对你说「喵」？！？！？？！！喵？？！！Meow...\'</span><span class="token punctuation">,</span>\n  <span class="token string">\'你好，我是破折号——一个不苟言笑的符号。\'</span><span class="token punctuation">,</span>\n  <span class="token string">\'核磁共振成像 (NMRI) 是什么原理都不知道? JFGI!\'</span><span class="token punctuation">,</span>\n  <span class="token string">\'这件蛋糕只卖 １０００ 元。\'</span><span class="token punctuation">,</span>\n  <span class="token string">\'乔布斯那句话是怎么说的？「Stay hungry，stay foolish。」\'</span><span class="token punctuation">,</span>\n  <span class="token string">\'推荐你阅读《Hackers＆Painters：Big Ideas from the Computer Age》，非常的有趣。\'</span>\n<span class="token punctuation">]</span><span class="token punctuation">;</span>\n\n<span class="token function">charCheck</span><span class="token punctuation">(</span>testSpecs<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">\'\'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token keyword">function</span> <span class="token function">charCheck</span><span class="token punctuation">(</span><span class="token parameter">str</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token comment">// 枚举类型的符号</span>\n  <span class="token keyword">var</span> symbols <span class="token operator">=</span> <span class="token punctuation">{</span>\n    full<span class="token punctuation">:</span> <span class="token string">\'！（）【】『』「」《》“”‘’；：，。？、\'</span><span class="token punctuation">,</span>\n    half<span class="token punctuation">:</span> <span class="token string">\'!-_()[]{}&lt;>"\\\';:,./?`\'</span><span class="token punctuation">,</span>\n    <span class="token function-variable function">getRegStr</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">key</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token keyword">var</span> symbols <span class="token operator">=</span>\n        <span class="token keyword">typeof</span> key <span class="token operator">===</span> <span class="token string">\'string\'</span>\n          <span class="token operator">?</span> <span class="token keyword">this</span><span class="token punctuation">[</span>key<span class="token punctuation">]</span>\n          <span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">that</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n              <span class="token keyword">if</span> <span class="token punctuation">(</span>key <span class="token keyword">instanceof</span> <span class="token class-name">Array</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n                <span class="token keyword">return</span> key<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">total<span class="token punctuation">,</span> cur</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n                  <span class="token keyword">return</span> <span class="token punctuation">(</span>total <span class="token operator">+=</span> that<span class="token punctuation">[</span>cur<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n                <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">\'\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n              <span class="token punctuation">}</span>\n\n              <span class="token keyword">return</span> <span class="token string">\'\'</span><span class="token punctuation">;</span>\n            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n      <span class="token comment">// 返回符合 regexp 语法的字符串</span>\n      <span class="token keyword">return</span> symbols\n        <span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">\'\'</span><span class="token punctuation">)</span>\n        <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">s</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n          <span class="token keyword">return</span> <span class="token string">\'\\\\\'</span> <span class="token operator">+</span> s<span class="token punctuation">;</span>\n        <span class="token punctuation">}</span><span class="token punctuation">)</span>\n        <span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">\'|\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span><span class="token punctuation">,</span>\n    <span class="token function-variable function">getRegRule</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">key<span class="token punctuation">,</span> usedAs</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token keyword">var</span> strs <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getRegStr</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token string">\'full\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token keyword">var</span> regArr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">\'(\\\\S+)\'</span><span class="token punctuation">,</span> <span class="token string">\'([\'</span> <span class="token operator">+</span> strs <span class="token operator">+</span> <span class="token string">\'])\'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n      <span class="token keyword">var</span> temp <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>regArr<span class="token punctuation">)</span><span class="token punctuation">;</span>\n      temp<span class="token punctuation">.</span><span class="token function">reverse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n      <span class="token keyword">if</span> <span class="token punctuation">(</span>usedAs <span class="token operator">===</span> <span class="token string">\'rule\'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">RegExp</span><span class="token punctuation">(</span><span class="token string">\'(:?\'</span> <span class="token operator">+</span> regArr<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">\'\\\\s+\'</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">\')|\'</span> <span class="token operator">+</span> <span class="token string">\'(:?\'</span> <span class="token operator">+</span> temp<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">\'\\\\s+\'</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">\')\'</span><span class="token punctuation">,</span> <span class="token string">\'g\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>usedAs <span class="token operator">===</span> <span class="token string">\'format\'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token keyword">new</span> <span class="token class-name">RegExp</span><span class="token punctuation">(</span>regArr<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">\'\\\\s+\'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">\'g\'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">RegExp</span><span class="token punctuation">(</span>temp<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">\'\\\\s+\'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">\'g\'</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span>\n    <span class="token punctuation">}</span>\n  <span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n  <span class="token keyword">var</span> regExps <span class="token operator">=</span> <span class="token punctuation">[</span>\n    <span class="token punctuation">{</span>\n      rule<span class="token punctuation">:</span> <span class="token regex">/([\\u4e00-\\u9fa5]+[a-zA-Z]+)|([a-zA-Z]+[\\u4e00-\\u9fa5]+)/g</span><span class="token punctuation">,</span>\n      format<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token regex">/([\\u4e00-\\u9fa5]+)([a-zA-Z]+)/g</span><span class="token punctuation">,</span> <span class="token regex">/([a-zA-Z]+)([\\u4e00-\\u9fa5]+)/g</span><span class="token punctuation">]</span><span class="token punctuation">,</span>\n      matches<span class="token punctuation">:</span> <span class="token string">\'$1 $2\'</span><span class="token punctuation">,</span>\n      msg<span class="token punctuation">:</span> <span class="token string">\'中英文之间需要增加空格\'</span>\n    <span class="token punctuation">}</span><span class="token punctuation">,</span>\n    <span class="token punctuation">{</span>\n      rule<span class="token punctuation">:</span> <span class="token regex">/([\\u4e00-\\u9fa5]+\\d+)|(\\d+[\\u4e00-\\u9fa5]+)/g</span><span class="token punctuation">,</span>\n      format<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token regex">/([\\u4e00-\\u9fa5]+)(\\d+)/g</span><span class="token punctuation">,</span> <span class="token regex">/(\\d+)([\\u4e00-\\u9fa5]+)/g</span><span class="token punctuation">]</span><span class="token punctuation">,</span>\n      matches<span class="token punctuation">:</span> <span class="token string">\'$1 $2\'</span><span class="token punctuation">,</span>\n      msg<span class="token punctuation">:</span> <span class="token string">\'中文与数字之间需要增加空格\'</span>\n    <span class="token punctuation">}</span><span class="token punctuation">,</span>\n    <span class="token punctuation">{</span>\n      rule<span class="token punctuation">:</span> <span class="token regex">/(\\d)([A-Z]+)/g</span><span class="token punctuation">,</span>\n      matches<span class="token punctuation">:</span> <span class="token string">\'$1 $2\'</span><span class="token punctuation">,</span>\n      msg<span class="token punctuation">:</span> <span class="token string">\'数字与大写英文单位之间需要增加空格\'</span>\n    <span class="token punctuation">}</span><span class="token punctuation">,</span>\n    <span class="token punctuation">{</span>\n      rule<span class="token punctuation">:</span> <span class="token regex">/(\\d+)\\s+(°|%)/g</span><span class="token punctuation">,</span>\n      matches<span class="token punctuation">:</span> <span class="token string">\'$1$2\'</span><span class="token punctuation">,</span>\n      msg<span class="token punctuation">:</span> <span class="token string">\'° 或 % 与数字之间不需要空格\'</span>\n    <span class="token punctuation">}</span><span class="token punctuation">,</span>\n    <span class="token punctuation">{</span>\n      rule<span class="token punctuation">:</span> symbols<span class="token punctuation">.</span><span class="token function">getRegRule</span><span class="token punctuation">(</span><span class="token string">\'full\'</span><span class="token punctuation">,</span> <span class="token string">\'rule\'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n      format<span class="token punctuation">:</span> symbols<span class="token punctuation">.</span><span class="token function">getRegRule</span><span class="token punctuation">(</span><span class="token string">\'full\'</span><span class="token punctuation">,</span> <span class="token string">\'format\'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n      matches<span class="token punctuation">:</span> <span class="token string">\'$1$2\'</span><span class="token punctuation">,</span>\n      msg<span class="token punctuation">:</span> <span class="token string">\'全角标点与其他字符之间不加空格\'</span>\n    <span class="token punctuation">}</span><span class="token punctuation">,</span>\n    <span class="token punctuation">{</span>\n      <span class="token comment">// rule: new RegExp(\'(\' + symbols.getRegStr([\'full\', \'half\']) + \')\\\\1+\', \'g\'),</span>\n      rule<span class="token punctuation">:</span> <span class="token keyword">new</span> <span class="token class-name">RegExp</span><span class="token punctuation">(</span><span class="token string">\'(\'</span> <span class="token operator">+</span> symbols<span class="token punctuation">.</span><span class="token function">getRegStr</span><span class="token punctuation">(</span><span class="token string">\'full\'</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">\')\\\\1+\'</span><span class="token punctuation">,</span> <span class="token string">\'g\'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n      matches<span class="token punctuation">:</span> <span class="token string">\'$1\'</span><span class="token punctuation">,</span>\n      msg<span class="token punctuation">:</span> <span class="token string">\'不重复使用中文标点符号\'</span>\n    <span class="token punctuation">}</span><span class="token punctuation">,</span>\n    <span class="token punctuation">{</span>\n      rule<span class="token punctuation">:</span> <span class="token regex">/(\\S)(——)(\\S)/g</span><span class="token punctuation">,</span>\n      matches<span class="token punctuation">:</span> <span class="token string">\'$1 $2 $3\'</span><span class="token punctuation">,</span>\n      msg<span class="token punctuation">:</span> <span class="token string">\'破折号前后需要增加一个空格\'</span>\n    <span class="token punctuation">}</span><span class="token punctuation">,</span>\n    <span class="token punctuation">{</span>\n      <span class="token comment">// 这条必须位于“遇到完整的英文整句、特殊名词，其內容使用半角标点”之前</span>\n      rule<span class="token punctuation">:</span> <span class="token keyword">new</span> <span class="token class-name">RegExp</span><span class="token punctuation">(</span><span class="token string">\'\\\\s*(\'</span> <span class="token operator">+</span> symbols<span class="token punctuation">.</span><span class="token function">getRegStr</span><span class="token punctuation">(</span><span class="token string">\'half\'</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">\')\\\\s*\'</span><span class="token punctuation">,</span> <span class="token string">\'g\'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n      <span class="token function-variable function">matches</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">s</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        s <span class="token operator">=</span> s<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex">/(^\\s*)|(\\s*$)/g</span><span class="token punctuation">,</span> <span class="token string">\'\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token keyword">return</span> String<span class="token punctuation">.</span><span class="token function">fromCharCode</span><span class="token punctuation">(</span>s<span class="token punctuation">.</span><span class="token function">charCodeAt</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">65248</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span><span class="token punctuation">,</span>\n      msg<span class="token punctuation">:</span> <span class="token string">\'使用全角中文标点\'</span>\n    <span class="token punctuation">}</span><span class="token punctuation">,</span>\n    <span class="token punctuation">{</span>\n      rule<span class="token punctuation">:</span> <span class="token regex">/[\\uFF10-\\uFF19]/g</span><span class="token punctuation">,</span>\n      <span class="token function-variable function">matches</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">s</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        <span class="token comment">// 半角字符与全角字符的 charCode 相差 65248</span>\n        <span class="token keyword">return</span> String<span class="token punctuation">.</span><span class="token function">fromCharCode</span><span class="token punctuation">(</span>s<span class="token punctuation">.</span><span class="token function">charCodeAt</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">65248</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span><span class="token punctuation">,</span>\n      msg<span class="token punctuation">:</span> <span class="token string">\'数字使用半角字符\'</span>\n    <span class="token punctuation">}</span><span class="token punctuation">,</span>\n    <span class="token punctuation">{</span>\n      <span class="token comment">// 中文的句号“。”不是全角字符，需要特殊处理</span>\n      rule<span class="token punctuation">:</span> <span class="token regex">/[《|「](:?\\s*[a-zA-Z]+\\s*(。|[\\uff00-\\uffff])*\\s*[a-zA-Z]*)+[\\.|」|》]/g</span><span class="token punctuation">,</span>\n      <span class="token function-variable function">matches</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">s</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        <span class="token keyword">return</span> s<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex">/。|[\\uff00-\\uffff]/g</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">$<span class="token number">1</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n          <span class="token keyword">var</span> half <span class="token operator">=</span> String<span class="token punctuation">.</span><span class="token function">fromCharCode</span><span class="token punctuation">(</span>$<span class="token number">1.</span><span class="token function">charCodeAt</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">65248</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n          <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token operator">!</span><span class="token operator">~</span><span class="token punctuation">[</span><span class="token string">\'&amp;\'</span><span class="token punctuation">,</span> <span class="token string">\'-\'</span><span class="token punctuation">,</span> <span class="token string">\'+\'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>half<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n            <span class="token comment">// 需要前后加空格的字符</span>\n            half <span class="token operator">=</span> <span class="token string">\' \'</span> <span class="token operator">+</span> half <span class="token operator">+</span> <span class="token string">\' \'</span><span class="token punctuation">;</span>\n          <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token operator">!</span><span class="token operator">~</span><span class="token punctuation">[</span><span class="token string">\':\'</span><span class="token punctuation">,</span> <span class="token string">\',\'</span><span class="token punctuation">,</span> <span class="token string">\';\'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>half<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n            <span class="token comment">// 需要后面加空格的字符</span>\n            half <span class="token operator">+=</span> <span class="token string">\' \'</span><span class="token punctuation">;</span>\n          <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>half <span class="token operator">===</span> <span class="token string">\'ㄢ\'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n            half <span class="token operator">=</span> <span class="token string">\'.\'</span><span class="token punctuation">;</span>\n          <span class="token punctuation">}</span>\n\n          <span class="token keyword">return</span> half<span class="token punctuation">;</span>\n        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span><span class="token punctuation">,</span>\n      msg<span class="token punctuation">:</span> <span class="token string">\'遇到完整的英文整句、特殊名词，其內容使用半角标点\'</span>\n    <span class="token punctuation">}</span>\n  <span class="token punctuation">]</span><span class="token punctuation">;</span>\n\n  <span class="token keyword">var</span> result <span class="token operator">=</span> str<span class="token punctuation">;</span>\n\n  regExps<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">reg<span class="token punctuation">,</span> idx</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">var</span> format <span class="token operator">=</span> reg<span class="token punctuation">.</span>format<span class="token punctuation">;</span>\n    <span class="token keyword">var</span> matches <span class="token operator">=</span> reg<span class="token punctuation">.</span>matches<span class="token punctuation">;</span>\n    <span class="token keyword">var</span> tip <span class="token operator">=</span> str<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span>reg<span class="token punctuation">.</span>rule<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">if</span> <span class="token punctuation">(</span>tip<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      console<span class="token punctuation">.</span><span class="token function">group</span><span class="token punctuation">(</span><span class="token string">\'%c\'</span> <span class="token operator">+</span> reg<span class="token punctuation">.</span>msg <span class="token operator">+</span> <span class="token string">\' (X)\'</span><span class="token punctuation">,</span> <span class="token string">\'color: red\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>tip<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">\'\\n\'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n      console<span class="token punctuation">.</span><span class="token function">groupEnd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>format<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        result <span class="token operator">=</span> result<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span>reg<span class="token punctuation">.</span>rule<span class="token punctuation">,</span> matches<span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>format <span class="token keyword">instanceof</span> <span class="token class-name">Array</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        format<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">fmtReg</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n          result <span class="token operator">=</span> result<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span>fmtReg<span class="token punctuation">,</span> matches<span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">Object</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>format<span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token string">\'[object RegExp]\'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        result <span class="token operator">=</span> result<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span>format<span class="token punctuation">,</span> matches<span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span>\n    <span class="token punctuation">}</span>\n  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n  <span class="token keyword">if</span> <span class="token punctuation">(</span>result <span class="token operator">===</span> str<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">\'%c当前文本符合规范 (√)\'</span><span class="token punctuation">,</span> <span class="token string">\'color: green\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">return</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n\n  console<span class="token punctuation">.</span><span class="token function">group</span><span class="token punctuation">(</span><span class="token string">\'按规范格式化后的文本：\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">\'%c\'</span> <span class="token operator">+</span> result<span class="token punctuation">,</span> <span class="token string">\'color: green\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  console<span class="token punctuation">.</span><span class="token function">groupEnd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h1 id="js-测试六"><a href="#js-%E6%B5%8B%E8%AF%95%E5%85%AD" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>JS 测试六</h1>\n<p>\n  <a\n    class="gatsby-resp-image-link"\n    href="/static/2019-09-09-10-49-16-c994f001e4889020a19320eb4de11a00-92ba0.png"\n    style="display: block"\n    target="_blank"\n    rel="noopener"\n  >\n  \n  <span\n    class="gatsby-resp-image-wrapper"\n    style="position: relative; display: block; ; max-width: 636px; margin-left: auto; margin-right: auto;"\n  >\n    <span\n      class="gatsby-resp-image-background-image"\n      style="padding-bottom: 154.874213836478%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAfCAIAAABoLHqZAAAACXBIWXMAAA7DAAAOwwHHb6hkAAACLUlEQVQ4y7VV25LbIAzN//9MfmD70H3N83amu5nEgME2vhvfjWmPwUnTbJt2m+bMhEHCQtKRUDbf7sAGv3mejTFXB9M0DcMwjqPW+pbxJXAR1qauPz8/b7fbT09P+7e3Sc+/MzaMsbIsIVz5P0dUVVXf9+7Sum6gdD422O12uy8vL6qu8VGaJnEcYwWaplFKtW2Lq2tVy0iW1QKIyGg1VqoSIoiiqCgKmDJKme8HQRgGYZ7nSB5u8TXu6i26vtc2kQ1iXRxmGQIqyyI7AWT9DdsGd8Gy67qmbdUJ4PnqU2Nxi+0P1/le49nC1WBd32uM082z1i7+hW0p4+Px6Pt+lmecg+cA1cJKCEEJshRsZkKI0IJaZFm+GkP4+voaRSHxPEKo53nQhGFEKaG2bCgYId5+v8d1OD0cDkVRrmGDbfgEvWc+l/W00S5gs2ZhlhxXzhfPlarQT2maonUQp+seWN/iyuW8sKU12givx3Kh37+wR5bqXuPL7jvtf/B3lYs55/zvnkFSkeeUsThOwDbaI4kT7nMheCQlVsE5lLGUqAhjNFnOEzc8Nqgfjh1whj36AliUPqeEiEBARM9IKbHhXPiMoW3WsPEecYD3jjrZZ49+GVG8ERu7H+3RYJWDxTqG0Au1UgXiqCo0ndN+gG2MAQyqtmsxaMxPxuZXrWX+Z53NJS7kh3YY7kfKGH1IGEtr81eVgjhO45+NUSqMSwxg/Ja/hFqhjBDd23xU2N8BW9gT6IfltK4AAAAASUVORK5CYII=\'); background-size: cover; display: block;"\n    >\n      <img\n        class="gatsby-resp-image-image"\n        style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;"\n        alt="2019 09 09 10 49 16"\n        title=""\n        src="/static/2019-09-09-10-49-16-c994f001e4889020a19320eb4de11a00-92ba0.png"\n        srcset="/static/2019-09-09-10-49-16-c994f001e4889020a19320eb4de11a00-cf954.png 200w,\n/static/2019-09-09-10-49-16-c994f001e4889020a19320eb4de11a00-955d7.png 400w,\n/static/2019-09-09-10-49-16-c994f001e4889020a19320eb4de11a00-92ba0.png 636w"\n        sizes="(max-width: 636px) 100vw, 636px"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<h2 id="具体实现-5"><a href="#%E5%85%B7%E4%BD%93%E5%AE%9E%E7%8E%B0-5" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>具体实现</h2>\n<h3 id="我的解答-4"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-4" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="2598516078663060000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 第一题\nvar bankCode = \'6222081812002934027\';\nbankCode.replace(/(\\d{4})(?=\\d)/g, \'\\$1 \');\n// 第二题\nvar numberCode = \'57023754\';\nnumberCode.replace(/(\\d)(?=(\\d{3})+\\$)/g, \'\\$1,\');\n// 第三题\nfunction roundNumber(number, n = 2) {\n  return Math.round(number * Math.pow(10, n)) / Math.pow(10, n);\n}\nfunction formatterFilesize(size, n) {\n  var K = 1024;\n  var M = 1024 ** 2;\n  var G = 1024 ** 3;\n\n  if (size < M) {\n    return roundNumber(size / K, n) + \'K\';\n  } else if (size < G) {\n    return roundNumber(size / M, n) + \'M\';\n  }\n  return roundNumber(size / G, n) + \'G\';\n}\nformatterFilesize(2837475);`, `2598516078663060000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                js 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// 第一题</span>\n<span class="token keyword">var</span> bankCode <span class="token operator">=</span> <span class="token string">\'6222081812002934027\'</span><span class="token punctuation">;</span>\nbankCode<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex">/(\\d{4})(?=\\d)/g</span><span class="token punctuation">,</span> <span class="token string">\'$1 \'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token comment">// 第二题</span>\n<span class="token keyword">var</span> numberCode <span class="token operator">=</span> <span class="token string">\'57023754\'</span><span class="token punctuation">;</span>\nnumberCode<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex">/(\\d)(?=(\\d{3})+$)/g</span><span class="token punctuation">,</span> <span class="token string">\'$1,\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token comment">// 第三题</span>\n<span class="token keyword">function</span> <span class="token function">roundNumber</span><span class="token punctuation">(</span><span class="token parameter">number<span class="token punctuation">,</span> n <span class="token operator">=</span> <span class="token number">2</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">return</span> Math<span class="token punctuation">.</span><span class="token function">round</span><span class="token punctuation">(</span>number <span class="token operator">*</span> Math<span class="token punctuation">.</span><span class="token function">pow</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> n<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">/</span> Math<span class="token punctuation">.</span><span class="token function">pow</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> n<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n<span class="token keyword">function</span> <span class="token function">formatterFilesize</span><span class="token punctuation">(</span><span class="token parameter">size<span class="token punctuation">,</span> n</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">var</span> <span class="token constant">K</span> <span class="token operator">=</span> <span class="token number">1024</span><span class="token punctuation">;</span>\n  <span class="token keyword">var</span> <span class="token constant">M</span> <span class="token operator">=</span> <span class="token number">1024</span> <span class="token operator">**</span> <span class="token number">2</span><span class="token punctuation">;</span>\n  <span class="token keyword">var</span> <span class="token constant">G</span> <span class="token operator">=</span> <span class="token number">1024</span> <span class="token operator">**</span> <span class="token number">3</span><span class="token punctuation">;</span>\n\n  <span class="token keyword">if</span> <span class="token punctuation">(</span>size <span class="token operator">&lt;</span> <span class="token constant">M</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">return</span> <span class="token function">roundNumber</span><span class="token punctuation">(</span>size <span class="token operator">/</span> <span class="token constant">K</span><span class="token punctuation">,</span> n<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">\'K\'</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>size <span class="token operator">&lt;</span> <span class="token constant">G</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">return</span> <span class="token function">roundNumber</span><span class="token punctuation">(</span>size <span class="token operator">/</span> <span class="token constant">M</span><span class="token punctuation">,</span> n<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">\'M\'</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n  <span class="token keyword">return</span> <span class="token function">roundNumber</span><span class="token punctuation">(</span>size <span class="token operator">/</span> <span class="token constant">G</span><span class="token punctuation">,</span> n<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">\'G\'</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n<span class="token function">formatterFilesize</span><span class="token punctuation">(</span><span class="token number">2837475</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="最佳解答-5"><a href="#%E6%9C%80%E4%BD%B3%E8%A7%A3%E7%AD%94-5" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>最佳解答</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="8322622747574360000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 第一题\nvar bankCode = \'6222081812002934027\';\nbankCode.replace(/(\\d{4})/g, \'\\$1 \');\n// 第二题\nvar numberCode = \'5702375\';\nNumber(numberCode).toLocaleString(\'en-US\');\n// 第三题\nvar filesize = 2837475;\nfunction format(size) {\n  return (\n    (size > 1024 ** 3 && (size / 1024 ** 3).toFixed(2) + \'G\') ||\n    (size > 1024 ** 2 && (size / 1024 ** 2).toFixed(2) + \'M\') ||\n    (size / 1024).toFixed(2) + \'K\'\n  );\n}\n\nformat(2837475555); //2.64G\nformat(2837475); //2.71M\nformat(28374); //27.71K`, `8322622747574360000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                js 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// 第一题</span>\n<span class="token keyword">var</span> bankCode <span class="token operator">=</span> <span class="token string">\'6222081812002934027\'</span><span class="token punctuation">;</span>\nbankCode<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex">/(\\d{4})/g</span><span class="token punctuation">,</span> <span class="token string">\'$1 \'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token comment">// 第二题</span>\n<span class="token keyword">var</span> numberCode <span class="token operator">=</span> <span class="token string">\'5702375\'</span><span class="token punctuation">;</span>\n<span class="token function">Number</span><span class="token punctuation">(</span>numberCode<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toLocaleString</span><span class="token punctuation">(</span><span class="token string">\'en-US\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token comment">// 第三题</span>\n<span class="token keyword">var</span> filesize <span class="token operator">=</span> <span class="token number">2837475</span><span class="token punctuation">;</span>\n<span class="token keyword">function</span> <span class="token function">format</span><span class="token punctuation">(</span><span class="token parameter">size</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">return</span> <span class="token punctuation">(</span>\n    <span class="token punctuation">(</span>size <span class="token operator">></span> <span class="token number">1024</span> <span class="token operator">**</span> <span class="token number">3</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>size <span class="token operator">/</span> <span class="token number">1024</span> <span class="token operator">**</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toFixed</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">\'G\'</span><span class="token punctuation">)</span> <span class="token operator">||</span>\n    <span class="token punctuation">(</span>size <span class="token operator">></span> <span class="token number">1024</span> <span class="token operator">**</span> <span class="token number">2</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>size <span class="token operator">/</span> <span class="token number">1024</span> <span class="token operator">**</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toFixed</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">\'M\'</span><span class="token punctuation">)</span> <span class="token operator">||</span>\n    <span class="token punctuation">(</span>size <span class="token operator">/</span> <span class="token number">1024</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toFixed</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">\'K\'</span>\n  <span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token function">format</span><span class="token punctuation">(</span><span class="token number">2837475555</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//2.64G</span>\n<span class="token function">format</span><span class="token punctuation">(</span><span class="token number">2837475</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//2.71M</span>\n<span class="token function">format</span><span class="token punctuation">(</span><span class="token number">28374</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//27.71K</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id="实现要点-4"><a href="#%E5%AE%9E%E7%8E%B0%E8%A6%81%E7%82%B9-4" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>实现要点</h2>\n<ol>\n<li>这个匹配值得大家关注：bankCode.match(/\\d{3,4}/g).join(’ ’)。然后“$&#x26;是最后匹配的字符”。</li>\n<li>数字千位分隔符表示语义会更好。<code class="language-text">&lt;meta name=&quot;format-detection&quot; content=&quot;telephone=no&quot;&gt;</code> 这个其实不推荐的。Number(numberCode).toLocaleString()是最佳实现了。toLocaleString 保留三位小数（细节可以关注下）。</li>\n<li>Intl.NumberFormat： <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/NumberFormat" target="_blank" rel="nofollow noreferrer noopener">https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/NumberFormat</a></li>\n<li>最后一题要点：注意取几位小数，最好向上取，然后注意下文件大小的单位是比特。</li>\n</ol>\n<h1 id="js-测试七"><a href="#js-%E6%B5%8B%E8%AF%95%E4%B8%83" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>JS 测试七</h1>\n<p>\n  <a\n    class="gatsby-resp-image-link"\n    href="/static/2019-09-29-17-43-37-3e1aa20cf389d02925b8bc62733f9f63-d60ed.png"\n    style="display: block"\n    target="_blank"\n    rel="noopener"\n  >\n  \n  <span\n    class="gatsby-resp-image-wrapper"\n    style="position: relative; display: block; ; max-width: 613px; margin-left: auto; margin-right: auto;"\n  >\n    <span\n      class="gatsby-resp-image-background-image"\n      style="padding-bottom: 125.28548123980423%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAZCAIAAAC+dZmEAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAB7klEQVQ4y7VU25KiMBDl///JZ9/GKqu0nEGuCaDcAoEAEsA5JI67pezW1Ox6LJMOpDvdJ6cxpmkaxxHj9Td0XWea5na7PRwOpyiSw3BdgrH4tK7rt7fNer3ebDae51Z1NSh/KWXbtjD0YUae56vVijGm32HTQxaAqOu265AgMuKcw9CxjLZrwzDK0qwoCpYzvNMOzyEW0kYQZILYSZJq/zRNeckZUspZMYMVjFVVdfe5xzWaRriu5/s+GPJcz7bt/X7vKdiWRXwfNeslJYTiT2iWIc1ydhZC+ISEYeC6bjCDKgc8I5ZlUUrDMHQcx3acj/d3QvyjZcVx3DStqrltsdmx7aP5sdvtsO9omkgkPscBpdHpdDoDJ0TBBLcoinC+Jtjo+x4XgyI5L9MkwcRYDlZ1bQ8Yp7sipts9g3eEGKTs8ZMSN3G5XBohxj9o4xfb8MRpWZaD0iRObuQqW5//N+frP8BYrO0ZLzh5UApDmbUQKB41QwNlyauZ9hmz0BhrmmZJnorbWkkfDM/XxisoB3alwNWIPS8g7DucvYAw/RkCbXoctKWgvw0DpAdDSr1U86zCm7aTJAnCEG0cn89oBjQQOozQQPMMwaHVcQXoCqxSZYDRW9qQIcjs+zkwOBdf+C5hi3ig7Jm//3FVP8MnGlqtUyFOObEAAAAASUVORK5CYII=\'); background-size: cover; display: block;"\n    >\n      <img\n        class="gatsby-resp-image-image"\n        style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;"\n        alt="2019 09 29 17 43 37"\n        title=""\n        src="/static/2019-09-29-17-43-37-3e1aa20cf389d02925b8bc62733f9f63-d60ed.png"\n        srcset="/static/2019-09-29-17-43-37-3e1aa20cf389d02925b8bc62733f9f63-a256c.png 200w,\n/static/2019-09-29-17-43-37-3e1aa20cf389d02925b8bc62733f9f63-56b73.png 400w,\n/static/2019-09-29-17-43-37-3e1aa20cf389d02925b8bc62733f9f63-d60ed.png 613w"\n        sizes="(max-width: 613px) 100vw, 613px"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<h2 id="具体实现-6"><a href="#%E5%85%B7%E4%BD%93%E5%AE%9E%E7%8E%B0-6" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>具体实现</h2>\n<h3 id="我的解答-5"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-5" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="22136325574183125000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`var str =\n  \'<svg width=&quot;24&quot; height=&quot;24&quot; viewBox=&quot;0 0 24 24&quot; fill=&quot;none&quot; xmlns=&quot;http://www.w3.org/2000/svg&quot;><path fill-rule=&quot;evenodd&quot; clip-rule=&quot;evenodd&quot; d=&quot;M2 2a1 1 0 0 1 1-1h13a1 1 0 0 1 1 1v16a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V2z&quot; fill=&quot;#0067E6&quot;/><path fill-rule=&quot;evenodd&quot; clip-rule=&quot;evenodd&quot; d=&quot;M7 6a1 1 0 0 1 1-1h9l5 5v12a1 1 0 0 1-1 1H8a1 1 0 0 1-1-1V6z&quot; fill=&quot;#FEAEA5&quot;/><path fill-rule=&quot;evenodd&quot; clip-rule=&quot;evenodd&quot; d=&quot;M17 5l5 5h-4a1 1 0 0 1-1-1V5z&quot; fill=&quot;#0067E6&quot;/></svg>\';\n// 第一题，?! 负先行断言-排除\nstr.replace(/fill=&quot;(?!none&quot;)[^&quot;]+&quot;/gi, \'\');\n// 第二题\nbtoa(str.replace(/fill=&quot;(?!none&quot;)[^&quot;]+&quot;/gi, \'\'));\n// 第三题\nencodeURIComponent(str.replace(/fill=&quot;(?!none&quot;)[^&quot;]+&quot;/gi, \'\'));`, `22136325574183125000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                js 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">var</span> str <span class="token operator">=</span>\n  <span class="token string">\'&lt;svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">&lt;path fill-rule="evenodd" clip-rule="evenodd" d="M2 2a1 1 0 0 1 1-1h13a1 1 0 0 1 1 1v16a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V2z" fill="#0067E6"/>&lt;path fill-rule="evenodd" clip-rule="evenodd" d="M7 6a1 1 0 0 1 1-1h9l5 5v12a1 1 0 0 1-1 1H8a1 1 0 0 1-1-1V6z" fill="#FEAEA5"/>&lt;path fill-rule="evenodd" clip-rule="evenodd" d="M17 5l5 5h-4a1 1 0 0 1-1-1V5z" fill="#0067E6"/>&lt;/svg>\'</span><span class="token punctuation">;</span>\n<span class="token comment">// 第一题，?! 负先行断言-排除</span>\nstr<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex">/fill="(?!none")[^"]+"/gi</span><span class="token punctuation">,</span> <span class="token string">\'\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token comment">// 第二题</span>\n<span class="token function">btoa</span><span class="token punctuation">(</span>str<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex">/fill="(?!none")[^"]+"/gi</span><span class="token punctuation">,</span> <span class="token string">\'\'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token comment">// 第三题</span>\n<span class="token function">encodeURIComponent</span><span class="token punctuation">(</span>str<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex">/fill="(?!none")[^"]+"/gi</span><span class="token punctuation">,</span> <span class="token string">\'\'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="最佳解答-6"><a href="#%E6%9C%80%E4%BD%B3%E8%A7%A3%E7%AD%94-6" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>最佳解答</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="215287129182950560"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`var str =\n  \'<svg width=&quot;24&quot; height=&quot;24&quot; viewBox=&quot;0 0 24 24&quot; fill=&quot;none&quot; xmlns=&quot;http://www.w3.org/2000/svg&quot;><path fill-rule=&quot;evenodd&quot; clip-rule=&quot;evenodd&quot; d=&quot;M2 2a1 1 0 0 1 1-1h13a1 1 0 0 1 1 1v16a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V2z&quot; fill=&quot;#0067E6&quot;/><path fill-rule=&quot;evenodd&quot; clip-rule=&quot;evenodd&quot; d=&quot;M7 6a1 1 0 0 1 1-1h9l5 5v12a1 1 0 0 1-1 1H8a1 1 0 0 1-1-1V6z&quot; fill=&quot;#FEAEA5&quot;/><path fill-rule=&quot;evenodd&quot; clip-rule=&quot;evenodd&quot; d=&quot;M17 5l5 5h-4a1 1 0 0 1-1-1V5z&quot; fill=&quot;#0067E6&quot;/></svg>\';\n// 第一题，可用作背景色自定义\nvar str1 = str.replace(/fill=&quot;(?!none&quot;)[^&quot;]+&quot;/gi, \'\');\n// 第二题，unescape返回未被转义的字符串，decodeURIComponent(escape(atob(str)))解码\nbtoa(unescape(encodeURIComponent(str1)));\n// 第三题，兼容IE\nstr1.replace(/[&quot;%#{}<>]/g, encodeURI);`, `215287129182950560`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                js 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">var</span> str <span class="token operator">=</span>\n  <span class="token string">\'&lt;svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">&lt;path fill-rule="evenodd" clip-rule="evenodd" d="M2 2a1 1 0 0 1 1-1h13a1 1 0 0 1 1 1v16a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V2z" fill="#0067E6"/>&lt;path fill-rule="evenodd" clip-rule="evenodd" d="M7 6a1 1 0 0 1 1-1h9l5 5v12a1 1 0 0 1-1 1H8a1 1 0 0 1-1-1V6z" fill="#FEAEA5"/>&lt;path fill-rule="evenodd" clip-rule="evenodd" d="M17 5l5 5h-4a1 1 0 0 1-1-1V5z" fill="#0067E6"/>&lt;/svg>\'</span><span class="token punctuation">;</span>\n<span class="token comment">// 第一题，可用作背景色自定义</span>\n<span class="token keyword">var</span> str1 <span class="token operator">=</span> str<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex">/fill="(?!none")[^"]+"/gi</span><span class="token punctuation">,</span> <span class="token string">\'\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token comment">// 第二题，unescape返回未被转义的字符串，decodeURIComponent(escape(atob(str)))解码</span>\n<span class="token function">btoa</span><span class="token punctuation">(</span><span class="token function">unescape</span><span class="token punctuation">(</span><span class="token function">encodeURIComponent</span><span class="token punctuation">(</span>str1<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token comment">// 第三题，兼容IE</span>\nstr1<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex">/["%#{}&lt;>]/g</span><span class="token punctuation">,</span> encodeURI<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id="实现要点-5"><a href="#%E5%AE%9E%E7%8E%B0%E8%A6%81%E7%82%B9-5" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>实现要点</h2>\n<ol>\n<li>老老实实用一个简单正则，然后 callback 中处理，虽然代码不是很简单，但是看得懂也不出错。简洁用法：<code class="language-text">/fill=&quot;(?!none&quot;)[^&quot;]+&quot;/gi</code>。</li>\n<li>window.btoa(str)可以转 base64。但是如果有中文是会报错的。可以先 encodeURI 下，或者 encodeURIComponent 也可以。可以试试这个：btoa(unescape(encodeURIComponent(str)))。base64 到常规格式 window.atob(str);</li>\n<li>data:image/svg+xml;utf8, 加原始 SVG 代码是可以作为 CSS background 图片的，但是 Chrome 支持，IE 浏览器不支持。我们可以部分转义，”，%，#，{，}，&#x3C;，>。IE 浏览器也支持，包括 IE9。<code class="language-text">str.replace(/[%#{}&lt;&gt;]/g, encodeURI)</code>。</li>\n</ol>\n<h1 id="js-测试八"><a href="#js-%E6%B5%8B%E8%AF%95%E5%85%AB" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>JS 测试八</h1>\n<p>\n  <a\n    class="gatsby-resp-image-link"\n    href="/static/2019-12-26-10-23-22-f637ab247b4e944d16468236ae4d4fd8-4c169.png"\n    style="display: block"\n    target="_blank"\n    rel="noopener"\n  >\n  \n  <span\n    class="gatsby-resp-image-wrapper"\n    style="position: relative; display: block; ; max-width: 666px; margin-left: auto; margin-right: auto;"\n  >\n    <span\n      class="gatsby-resp-image-background-image"\n      style="padding-bottom: 155.85585585585585%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAfCAIAAABoLHqZAAAACXBIWXMAAA7DAAAOwwHHb6hkAAACWUlEQVQ4y62U626jMBCF+/4vlGfIZv+1WqpI4VaSAAaCAXPLkt3Pdm4bNdVGzUhYNjCeOXPOzMufb9gLz+FwmKbp+i3Htm2llEqp/X7/lfO1cRFr0zQ/FovZbDafz9dRdPI/3FykneMkcV333vVkUVXVOOI4kstodjaGdg6DYLH4udvtil2RZVme5/0wPIC5VaqSsq5qKauu66qqruvKGhBYKQH4+76TZn9xzjLx9vrqeb7nuUEQAMFxfoVh6LqeH/jvzrvjOHwNg3C5XHqeFwShLbB2JkoC7iTFNmttqRBFnidxnAkBKN/3hRBd35OCMnZxpgbkVhQFsEspy1ICe7PZgJ/q/DZ2w+Ul7aHviRvH8Xa71RkkKcE912UF+w2R1j7n+WGFkdTeWN/D0dE4kqpl1e4/d4abjTEqTLXJNoqirX6xpRbDOHIXsO/yvD+ZLY/ZEnU8w/svbT+MmRjIC6qEyCALmZblrqpknmWUHsKGO2o1VA0DPxnU61j/LUD98RHBHKqgIrYTru1ZaRuSEGlLlLZTR2vsMDgertoDs8XXzmmSrlYrSNJdWeSmKVkFWJA027IshUgRIEdKgIwv2mYIIcOmUbVpxeZkhKFsvOu6nthExq26aclvYQawHSBkRVfa/dk46U5sFV/JqjZmh5l2Jg0NRmSAj+ME5ADmCl5qtvjVaG4Y+rMQp+nwjLQt75Ox016vVuSs9tt5KvwjEphgEKzXG527SKE3z3JmA4IFMIJVbYtgqQSzyfDSXJzBrP9QysxNycqe6TndaannyfP6sq8b+Jn9/BeqBQoayXTa0AAAAABJRU5ErkJggg==\'); background-size: cover; display: block;"\n    >\n      <img\n        class="gatsby-resp-image-image"\n        style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;"\n        alt="2019 12 26 10 23 22"\n        title=""\n        src="/static/2019-12-26-10-23-22-f637ab247b4e944d16468236ae4d4fd8-4c169.png"\n        srcset="/static/2019-12-26-10-23-22-f637ab247b4e944d16468236ae4d4fd8-76d25.png 200w,\n/static/2019-12-26-10-23-22-f637ab247b4e944d16468236ae4d4fd8-edf88.png 400w,\n/static/2019-12-26-10-23-22-f637ab247b4e944d16468236ae4d4fd8-4c169.png 666w"\n        sizes="(max-width: 666px) 100vw, 666px"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<h2 id="具体实现-7"><a href="#%E5%85%B7%E4%BD%93%E5%AE%9E%E7%8E%B0-7" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>具体实现</h2>\n<h3 id="我的解答-6"><a href="#%E6%88%91%E7%9A%84%E8%A7%A3%E7%AD%94-6" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>我的解答</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="94696066952427100000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 第一题\nvar phone = \'13208033621 \';\nphone.trim();\n// 第二题\nvar phone = \'１３２０８０３３６２１\';\nfunction toSBC(str) {\n  var result = \'\';\n  var len = str.length;\n  for (var i = 0; i < len; i++) {\n    var cCode = str.charCodeAt(i);\n    //全角与半角相差（除空格外）：65248（十进制）\n    cCode = cCode >= 0xff01 && cCode <= 0xff5e ? cCode - 65248 : cCode;\n    //处理空格\n    cCode = cCode === 0x03000 ? 0x0020 : cCode;\n    result += String.fromCharCode(cCode);\n  }\n  return result;\n}\ntoSBC(phone);\n// 第三题\nvar phone = \'+8613208033621\';\nphone.replace(/^\\+86/g, \'\');\n// 第四题\nvar phone = \'1320-8033-621\';\nvar phone2 = \'1320 8033 621\';\nvar trimPhone = phone2.replace(/[-\\s]/g, \'\');\nif (trimPhone.length === 11) {\n  phone = trimPhone;\n}\nconsole.log(phone);\n// 第五题\nvar phone = \'13208033621\';\nvar pattern = /1\\d{10}/;\npattern.test(phone);`, `94696066952427100000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                js 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// 第一题</span>\n<span class="token keyword">var</span> phone <span class="token operator">=</span> <span class="token string">\'13208033621 \'</span><span class="token punctuation">;</span>\nphone<span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token comment">// 第二题</span>\n<span class="token keyword">var</span> phone <span class="token operator">=</span> <span class="token string">\'１３２０８０３３６２１\'</span><span class="token punctuation">;</span>\n<span class="token keyword">function</span> <span class="token function">toSBC</span><span class="token punctuation">(</span><span class="token parameter">str</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">var</span> result <span class="token operator">=</span> <span class="token string">\'\'</span><span class="token punctuation">;</span>\n  <span class="token keyword">var</span> len <span class="token operator">=</span> str<span class="token punctuation">.</span>length<span class="token punctuation">;</span>\n  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> len<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">var</span> cCode <span class="token operator">=</span> str<span class="token punctuation">.</span><span class="token function">charCodeAt</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token comment">//全角与半角相差（除空格外）：65248（十进制）</span>\n    cCode <span class="token operator">=</span> cCode <span class="token operator">>=</span> <span class="token number">0xff01</span> <span class="token operator">&amp;&amp;</span> cCode <span class="token operator">&lt;=</span> <span class="token number">0xff5e</span> <span class="token operator">?</span> cCode <span class="token operator">-</span> <span class="token number">65248</span> <span class="token punctuation">:</span> cCode<span class="token punctuation">;</span>\n    <span class="token comment">//处理空格</span>\n    cCode <span class="token operator">=</span> cCode <span class="token operator">===</span> <span class="token number">0x03000</span> <span class="token operator">?</span> <span class="token number">0x0020</span> <span class="token punctuation">:</span> cCode<span class="token punctuation">;</span>\n    result <span class="token operator">+=</span> String<span class="token punctuation">.</span><span class="token function">fromCharCode</span><span class="token punctuation">(</span>cCode<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n  <span class="token keyword">return</span> result<span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n<span class="token function">toSBC</span><span class="token punctuation">(</span>phone<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token comment">// 第三题</span>\n<span class="token keyword">var</span> phone <span class="token operator">=</span> <span class="token string">\'+8613208033621\'</span><span class="token punctuation">;</span>\nphone<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex">/^\\+86/g</span><span class="token punctuation">,</span> <span class="token string">\'\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token comment">// 第四题</span>\n<span class="token keyword">var</span> phone <span class="token operator">=</span> <span class="token string">\'1320-8033-621\'</span><span class="token punctuation">;</span>\n<span class="token keyword">var</span> phone2 <span class="token operator">=</span> <span class="token string">\'1320 8033 621\'</span><span class="token punctuation">;</span>\n<span class="token keyword">var</span> trimPhone <span class="token operator">=</span> phone2<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex">/[-\\s]/g</span><span class="token punctuation">,</span> <span class="token string">\'\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">if</span> <span class="token punctuation">(</span>trimPhone<span class="token punctuation">.</span>length <span class="token operator">===</span> <span class="token number">11</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  phone <span class="token operator">=</span> trimPhone<span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\nconsole<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>phone<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token comment">// 第五题</span>\n<span class="token keyword">var</span> phone <span class="token operator">=</span> <span class="token string">\'13208033621\'</span><span class="token punctuation">;</span>\n<span class="token keyword">var</span> pattern <span class="token operator">=</span> <span class="token regex">/1\\d{10}/</span><span class="token punctuation">;</span>\npattern<span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>phone<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h3 id="最佳解答-7"><a href="#%E6%9C%80%E4%BD%B3%E8%A7%A3%E7%AD%94-7" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>最佳解答</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="23272147214820450000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 第一题\nvar phone = \'13208033621 \';\n// IE9+\nphone.trim();\n// IE8+，分别去除前导空格和后导空格\nphone.replace(/^\\s*|\\s*\\$/g, \'\');\n// 第二题\n// 方法一\nvar phone = \'１３２０８０３３６２１\';\nfunction toSBC(str) {\n  var result = \'\';\n  var len = str.length;\n  for (var i = 0; i < len; i++) {\n    var cCode = str.charCodeAt(i);\n    //全角与半角相差（除空格外）：65248（十进制）\n    cCode = cCode >= 0xff01 && cCode <= 0xff5e ? cCode - 65248 : cCode;\n    //处理空格\n    cCode = cCode === 0x03000 ? 0x0020 : cCode;\n    result += String.fromCharCode(cCode);\n  }\n  return result;\n}\ntoSBC(phone);\n// 方法二\n[...\'０１２３４５６７８９\'].reduce((acc, cur, idx) => acc.replace(new RegExp(cur, \'g\'), idx), phone);\n// 方法三\nvar doubleByteNums = \'０１２３４５６７８９\';\nphone.replace(/[０-９]/g, (matched) => doubleByteNums.indexOf(matched));\n// 方法四\nvar dict = { \'０\': 0, \'１\': 1, \'２\': 2, \'３\': 3, \'４\': 4, \'５\': 5, \'６\': 6, \'７\': 7, \'８\': 8, \'９\': 9 };\n[...phone].map((item) => dict[item]).join(\'\');\n// 第三题\nvar phone = \'+8613208033621\';\nphone.replace(/^\\+86/g, \'\');\n// 第四题\nvar phone = \'1320-8033-621\';\nvar phone2 = \'1320 8033  621\';\nfunction formatSpace(strTel) {\n  return (strTel.match(/[0-9]/g).length === 11 && strTel.replace(/[-\\s]/g, \'\')) || strTel;\n}\nvar result = formatSpace(phone);\nvar result2 = formatSpace(phone2);\n// 第五题\nvar phone = \'13208033621\';\nvar pattern = /^1\\d{10}\\$/;\npattern.test(phone);`, `23272147214820450000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                js 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// 第一题</span>\n<span class="token keyword">var</span> phone <span class="token operator">=</span> <span class="token string">\'13208033621 \'</span><span class="token punctuation">;</span>\n<span class="token comment">// IE9+</span>\nphone<span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token comment">// IE8+，分别去除前导空格和后导空格</span>\nphone<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex">/^\\s*|\\s*$/g</span><span class="token punctuation">,</span> <span class="token string">\'\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token comment">// 第二题</span>\n<span class="token comment">// 方法一</span>\n<span class="token keyword">var</span> phone <span class="token operator">=</span> <span class="token string">\'１３２０８０３３６２１\'</span><span class="token punctuation">;</span>\n<span class="token keyword">function</span> <span class="token function">toSBC</span><span class="token punctuation">(</span><span class="token parameter">str</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">var</span> result <span class="token operator">=</span> <span class="token string">\'\'</span><span class="token punctuation">;</span>\n  <span class="token keyword">var</span> len <span class="token operator">=</span> str<span class="token punctuation">.</span>length<span class="token punctuation">;</span>\n  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> len<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">var</span> cCode <span class="token operator">=</span> str<span class="token punctuation">.</span><span class="token function">charCodeAt</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token comment">//全角与半角相差（除空格外）：65248（十进制）</span>\n    cCode <span class="token operator">=</span> cCode <span class="token operator">>=</span> <span class="token number">0xff01</span> <span class="token operator">&amp;&amp;</span> cCode <span class="token operator">&lt;=</span> <span class="token number">0xff5e</span> <span class="token operator">?</span> cCode <span class="token operator">-</span> <span class="token number">65248</span> <span class="token punctuation">:</span> cCode<span class="token punctuation">;</span>\n    <span class="token comment">//处理空格</span>\n    cCode <span class="token operator">=</span> cCode <span class="token operator">===</span> <span class="token number">0x03000</span> <span class="token operator">?</span> <span class="token number">0x0020</span> <span class="token punctuation">:</span> cCode<span class="token punctuation">;</span>\n    result <span class="token operator">+=</span> String<span class="token punctuation">.</span><span class="token function">fromCharCode</span><span class="token punctuation">(</span>cCode<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n  <span class="token keyword">return</span> result<span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n<span class="token function">toSBC</span><span class="token punctuation">(</span>phone<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token comment">// 方法二</span>\n<span class="token punctuation">[</span><span class="token operator">...</span><span class="token string">\'０１２３４５６７８９\'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">acc<span class="token punctuation">,</span> cur<span class="token punctuation">,</span> idx</span><span class="token punctuation">)</span> <span class="token operator">=></span> acc<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">RegExp</span><span class="token punctuation">(</span>cur<span class="token punctuation">,</span> <span class="token string">\'g\'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> idx<span class="token punctuation">)</span><span class="token punctuation">,</span> phone<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token comment">// 方法三</span>\n<span class="token keyword">var</span> doubleByteNums <span class="token operator">=</span> <span class="token string">\'０１２３４５６７８９\'</span><span class="token punctuation">;</span>\nphone<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex">/[０-９]/g</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">matched</span><span class="token punctuation">)</span> <span class="token operator">=></span> doubleByteNums<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>matched<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token comment">// 方法四</span>\n<span class="token keyword">var</span> dict <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token string">\'０\'</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">\'１\'</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">\'２\'</span><span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">\'３\'</span><span class="token punctuation">:</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token string">\'４\'</span><span class="token punctuation">:</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token string">\'５\'</span><span class="token punctuation">:</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token string">\'６\'</span><span class="token punctuation">:</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token string">\'７\'</span><span class="token punctuation">:</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token string">\'８\'</span><span class="token punctuation">:</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token string">\'９\'</span><span class="token punctuation">:</span> <span class="token number">9</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>\n<span class="token punctuation">[</span><span class="token operator">...</span>phone<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class="token punctuation">)</span> <span class="token operator">=></span> dict<span class="token punctuation">[</span>item<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">\'\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token comment">// 第三题</span>\n<span class="token keyword">var</span> phone <span class="token operator">=</span> <span class="token string">\'+8613208033621\'</span><span class="token punctuation">;</span>\nphone<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex">/^\\+86/g</span><span class="token punctuation">,</span> <span class="token string">\'\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token comment">// 第四题</span>\n<span class="token keyword">var</span> phone <span class="token operator">=</span> <span class="token string">\'1320-8033-621\'</span><span class="token punctuation">;</span>\n<span class="token keyword">var</span> phone2 <span class="token operator">=</span> <span class="token string">\'1320 8033  621\'</span><span class="token punctuation">;</span>\n<span class="token keyword">function</span> <span class="token function">formatSpace</span><span class="token punctuation">(</span><span class="token parameter">strTel</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">return</span> <span class="token punctuation">(</span>strTel<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span><span class="token regex">/[0-9]/g</span><span class="token punctuation">)</span><span class="token punctuation">.</span>length <span class="token operator">===</span> <span class="token number">11</span> <span class="token operator">&amp;&amp;</span> strTel<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex">/[-\\s]/g</span><span class="token punctuation">,</span> <span class="token string">\'\'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">||</span> strTel<span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n<span class="token keyword">var</span> result <span class="token operator">=</span> <span class="token function">formatSpace</span><span class="token punctuation">(</span>phone<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">var</span> result2 <span class="token operator">=</span> <span class="token function">formatSpace</span><span class="token punctuation">(</span>phone2<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token comment">// 第五题</span>\n<span class="token keyword">var</span> phone <span class="token operator">=</span> <span class="token string">\'13208033621\'</span><span class="token punctuation">;</span>\n<span class="token keyword">var</span> pattern <span class="token operator">=</span> <span class="token regex">/^1\\d{10}$/</span><span class="token punctuation">;</span>\npattern<span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>phone<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id="实现要点-6"><a href="#%E5%AE%9E%E7%8E%B0%E8%A6%81%E7%82%B9-6" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>实现要点</h2>\n<ol>\n<li>去除前后空格：xxx.trim()，trim()不止过滤普通空格（Space 键敲出来的空格），IE9+，如果想要兼容 IE8，xxxx.replace(/^\\s<em>|\\s</em>$/g, "")。</li>\n<li>全角转半角 String.fromCharCode(str.charCodeAt(i)-65248)是常规方法，适用于任何全角字符。本期可以只考虑数值的全角转半角，reduce()是一种方法（参考 Seasonley 的回答），还有 const doubleByteNums = ‘０１２３４５６７８９’;strTel.replace( new RegExp(’[０-９]’, ‘g’), matched => doubleByteNums.indexOf(matched))或者使用映射 dict = { “０”: 0,“１”: 1, “２”: 2,“３”: 3,“４”: 4, “５”: 5, “６”: 6, “７”: 7, “８”: 8, “９”: 9, }进行替换。注意：只有全角才需要 code 减值。</li>\n<li>/^+86/</li>\n<li>需要数字个数匹配。因为输入框可能既支持输入手机号，又支持邮箱。</li>\n<li>/^1\\d{10}$/</li>\n<li>本小测的初衷：一个普通的手机账号输入框体验做好是不容易的事情。大部分的开发，都只是完成字符串前后空格的过滤就结束了，测试同学测试呢，也是可以通过的。啊，但实际上这并不是一个非常好的体验实现，正如我公众号文章（ <a href="https://mp.weixin.qq.com/s/3iYaxKJLjLo_gWgb8lvabw" target="_blank" rel="nofollow noreferrer noopener">https://mp.weixin.qq.com/s/3iYaxKJLjLo_gWgb8lvabw</a> ）所讲的那样，做前端要想交互体验做到非常好，需要扎实的技术和经验积累作为前提的。例如输入框粘贴的时候自动在剪切板层把字符过滤，这个是需要技术积累的，需要对剪切板对象比较了解。 又例如全角半角的转化，以及+86 的过滤这都需要足够多的经验的。讲这个的目的是想让大家知道做前端开发要想做的东西非常好，关键是把技术给好好积累，充分扎实，这个是做小测的目的，也是你竞争力所在。</li>\n</ol>',
id:"/github/workspace/blog/JS练手测试/index.md absPath of file >>> MarkdownRemark",timeToRead:16,frontmatter:{date:"2019-12-26 12:10:05",path:"/js-practice-test/",tags:"前端, JS, 练手测试",title:"JS练手测试",draft:null}},{excerpt:"Chrome 和 Safari 浏览器 preventDefault 报 treated as passive 错误 其实这个问题出现有一段时间了，主要麻烦的是，以前没有，后来，Chrome 和 Safari 浏览器升级了，然后出现这个错误，而且就在一个月前，Chrome 浏览器还只是黄色的警告，现在直接就红色错误献上。 例如，随便新建一个空白页面，写上如下 JavaScript 代码： 然后在移动端模式下页面上点击滑来滑去记下，就可以看到一大堆错误： Intervention  Unable…",html:'<h1 id="chrome-和-safari-浏览器-preventdefault-报-treated-as-passive-错误"><a href="#chrome-%E5%92%8C-safari-%E6%B5%8F%E8%A7%88%E5%99%A8-preventdefault-%E6%8A%A5-treated-as-passive-%E9%94%99%E8%AF%AF" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Chrome 和 Safari 浏览器 preventDefault 报 treated as passive 错误</h1>\n<p>其实这个问题出现有一段时间了，主要麻烦的是，以前没有，后来，Chrome 和 Safari 浏览器升级了，然后出现这个错误，而且就在一个月前，Chrome 浏览器还只是黄色的警告，现在直接就红色错误献上。</p>\n<p>例如，随便新建一个空白页面，写上如下 JavaScript 代码：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="10390007460015727000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`document.addEventListener(\'touchmove\', function(event) {\n  event.preventDefault();\n});`, `10390007460015727000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                js 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js">document<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">\'touchmove\'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  event<span class="token punctuation">.</span><span class="token function">preventDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>然后在移动端模式下页面上点击滑来滑去记下，就可以看到一大堆错误：</p>\n<blockquote>\n<p>[Intervention] Unable to preventDefault inside passive event listener due to target being treated as passive. See…</p>\n</blockquote>\n<p>\n  <a\n    class="gatsby-resp-image-link"\n    href="/static/2019-12-23-19-58-05-0cf0990a12ba2d41e5f21cd200a4cda9-180da.png"\n    style="display: block"\n    target="_blank"\n    rel="noopener"\n  >\n  \n  <span\n    class="gatsby-resp-image-wrapper"\n    style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;"\n  >\n    <span\n      class="gatsby-resp-image-background-image"\n      style="padding-bottom: 40.543881334981464%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAIAAAB2/0i6AAAACXBIWXMAAA7DAAAOwwHHb6hkAAAA5klEQVQY06VOW2rDMBD0/S9W+tnGsaR9SLJzhFLiCsWbWccJlH4WBrE7jx0NX2/v7Rys1C3vmC9b4q3Mx1oXf6HOy6bZZy2u1rnXZVhL7eNkU7SQHInt42Qx2ZRsDMbiEkhW+xwNNU9njzSs89JhJXGImhaXJbsbmVycB1nqcQUrJNEuOqz4wKPQ8+wxfAQzGBzFGsndyKMWM7CbO8mz+Tgp7oYJbs+TaXYJZN6bI7/KO/8z/FPqLcRf4ce3gfg3TC/nDeHv5XINsUVqxC1JY22ncyNtiZ2U7ANL09LGqcXkJBiSK/Edd3KwMAmaJQAAAAAASUVORK5CYII=\'); background-size: cover; display: block;"\n    >\n      <img\n        class="gatsby-resp-image-image"\n        style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;"\n        alt="2019 12 23 19 58 05"\n        title=""\n        src="/static/2019-12-23-19-58-05-0cf0990a12ba2d41e5f21cd200a4cda9-fee1c.png"\n        srcset="/static/2019-12-23-19-58-05-0cf0990a12ba2d41e5f21cd200a4cda9-a67b7.png 200w,\n/static/2019-12-23-19-58-05-0cf0990a12ba2d41e5f21cd200a4cda9-0b187.png 400w,\n/static/2019-12-23-19-58-05-0cf0990a12ba2d41e5f21cd200a4cda9-fee1c.png 800w,\n/static/2019-12-23-19-58-05-0cf0990a12ba2d41e5f21cd200a4cda9-180da.png 809w"\n        sizes="(max-width: 800px) 100vw, 800px"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<p>如果仅仅是错误，不影响功能其实还好，但是，这个报错会影响我们之前运行很 OK 的交互操作，例如，自定义滚动，或者元素拖拽效果等，会触发浏览器原生的滚动，产生不好的交互体验效果。</p>\n<p>有以下 2 种解决方案：</p>\n<h1 id="touch-actionnone-解决-treated-as-passive-错误"><a href="#touch-actionnone-%E8%A7%A3%E5%86%B3-treated-as-passive-%E9%94%99%E8%AF%AF" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>touch-action:none 解决 treated as passive 错误</h1>\n<p>加入如下 CSS：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="42360436851749040000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`html {\n  touch-action: none;\n}`, `42360436851749040000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                css 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">html</span> <span class="token punctuation">{</span>\n  <span class="token property">touch-action</span><span class="token punctuation">:</span> none<span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>报错就会无影无踪。</p>\n<p>touch-action 是移动端一个与手势触摸密切相关的 CSS 属性，原本源自 windows phone 手机，微软系，后来被 Chrome 吸收借鉴，Firefox 浏览器跟上，然后 Safari 也部分支持，目前已经可以说是在移动端可以畅行的 CSS 属性。</p>\n<p>支持的关键字值有：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="72816173147874790000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`touch-action: auto;\ntouch-action: none;\ntouch-action: pan-x;\ntouch-action: pan-left;\ntouch-action: pan-right;\ntouch-action: pan-y;\ntouch-action: pan-up;\ntouch-action: pan-down;\ntouch-action: pinch-zoom;\ntouch-action: manipulation;`, `72816173147874790000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                css 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token property">touch-action</span><span class="token punctuation">:</span> auto<span class="token punctuation">;</span>\n<span class="token property">touch-action</span><span class="token punctuation">:</span> none<span class="token punctuation">;</span>\n<span class="token property">touch-action</span><span class="token punctuation">:</span> pan-x<span class="token punctuation">;</span>\n<span class="token property">touch-action</span><span class="token punctuation">:</span> pan-left<span class="token punctuation">;</span>\n<span class="token property">touch-action</span><span class="token punctuation">:</span> pan-right<span class="token punctuation">;</span>\n<span class="token property">touch-action</span><span class="token punctuation">:</span> pan-y<span class="token punctuation">;</span>\n<span class="token property">touch-action</span><span class="token punctuation">:</span> pan-up<span class="token punctuation">;</span>\n<span class="token property">touch-action</span><span class="token punctuation">:</span> pan-down<span class="token punctuation">;</span>\n<span class="token property">touch-action</span><span class="token punctuation">:</span> pinch-zoom<span class="token punctuation">;</span>\n<span class="token property">touch-action</span><span class="token punctuation">:</span> manipulation<span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>其中：</p>\n<ul>\n<li>auto 是默认值，表示手势操作什么的完全由浏览器自己决定（如<code class="language-text">&lt;meta&gt;</code>元素的 viewport 设置）。</li>\n<li>\n<p>manipulation 表示浏览器只允许进行滚动和持续缩放操作，类似双击缩放这种非标准操作就不可以。想当初，click 事件在移动端有个 300ms 延时，就是因为避免和手机双击行为发生冲突。然而，当我们设置了 touch-action:manipulation 干掉了双击行为，则显然，300ms 延时就不复存在，因此，下面的 CSS 声明可以用来避免浏览器 300ms 延时问题。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="65107558370599300000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`html {\ntouch-action: manipulation;\n}`, `65107558370599300000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                css 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">html</span> <span class="token punctuation">{</span>\n<span class="token property">touch-action</span><span class="token punctuation">:</span> manipulation<span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n</li>\n</ul>\n<p>上面 2 个关键字属性值（auto 和 manipulation）是 Safari 唯一支持的两个 touch-action 属性值，iOS Safari 就是为用户操碎了心，就怕开发者把一些对用户无障碍访问有帮助的东西去掉，例如不支持 touch-action:none 以及 iOS10+中设置 viewport 的 user-scalable=no 已经无法阻止用户手指缩放屏幕了，或许在 Safari 看来，对于一个网页，没有任何理由阻止用户放大看你的网页内容。</p>\n<p>至于其他关键字，正如字面意思，要么只能左移，要么只能左右移动，要么只能右移之类，具体如下：</p>\n<ul>\n<li>none 表示不进行任何 touch 相关默认行为，例如，你想用手指滚动网页就不行，双击放大缩小页面也不可以，所有这些行为要自定义。</li>\n<li>pan-x 表示手指头可以水平移来移去。</li>\n<li>pan-left 表示手指头可以往左移动，移动开始后还是可以往右恢复的。</li>\n<li>pan-right 表示手指头可以可以往右移动，移动开始后还是可以往左恢复的。</li>\n<li>pan-y 表示手指头可以垂直移来移去。</li>\n<li>pan-up 表示手指头可以往上移，移动开始后还是可以往下恢复的。</li>\n<li>pan-down 表示手指头可以往下移，移动开始后还是可以往上恢复的。</li>\n<li>pan-zoom 表示手指头可以用来缩放页面</li>\n</ul>\n<p>上述部分关键字可以组合使用，分 pan-y, pan-up, pan-down 和 pan-x, pan-left, pan-right 以及 pan-zoom 这三组，然后这三组关键字可以任意组合，例如：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="36042282963607097000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`.example {\n  touch-action: pan-left pan-up pan-zoom;\n}`, `36042282963607097000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                css 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">.example</span> <span class="token punctuation">{</span>\n  <span class="token property">touch-action</span><span class="token punctuation">:</span> pan-left pan-up pan-zoom<span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>表示可以左移，上移和缩放。</p>\n<p>此方法不足</p>\n<ol>\n<li>iOS Safari 浏览器不支持；</li>\n<li>干掉了可能需要的原生的 touch 相关行为。</li>\n</ol>\n<p>不过主要问题还是 iOS Safari 浏览器不支持，第 2 点不足我们可以当我们需要阻止时候 JS 设置 touch-action 为 none，不需要在 JS 还原即可，不是大问题。</p>\n<p>iOS Safari 对于传统移动网页可是重要浏览器，不可忽略，怎么办，有没有什么其他方法呢？有！就是下面这个。</p>\n<h1 id="直接传递-passivefalse-解决-treated-as-passive-错误"><a href="#%E7%9B%B4%E6%8E%A5%E4%BC%A0%E9%80%92-passivefalse-%E8%A7%A3%E5%86%B3-treated-as-passive-%E9%94%99%E8%AF%AF" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>直接传递 passive:false 解决 treated as passive 错误</h1>\n<p>问题代码是：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="70914542706724530000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`document.addEventListener(\'touchmove\', function(event) {\n  event.preventDefault();\n});`, `70914542706724530000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                js 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js">document<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">\'touchmove\'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  event<span class="token punctuation">.</span><span class="token function">preventDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>修复后的 JavaScript 代码是：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="34110307230849446000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`document.addEventListener(\n  \'touchmove\',\n  function(event) {\n    event.preventDefault();\n  },\n  {\n    passive: false\n  }\n);`, `34110307230849446000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                js 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js">document<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span>\n  <span class="token string">\'touchmove\'</span><span class="token punctuation">,</span>\n  <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    event<span class="token punctuation">.</span><span class="token function">preventDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span><span class="token punctuation">,</span>\n  <span class="token punctuation">{</span>\n    passive<span class="token punctuation">:</span> <span class="token boolean">false</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>也就是 addEventListener 的第三个参数传递 passive:false，告诉浏览器，我这个事件就是不是消极的，是老子主动要这么做的。浏览器此时也不好说什么，然后，我们以前出问题的代码就能正常运行了。</p>\n<p>如果是 Zepto.js 语法下的事件呢，例如：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="13586276605250892000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`\\$(document).on(\'touchmove\', function(event) {\n  event.preventDefault();\n});`, `13586276605250892000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                js 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token function">$</span><span class="token punctuation">(</span>document<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">\'touchmove\'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  event<span class="token punctuation">.</span><span class="token function">preventDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>根据我查看 Zepto 的源码分析，目前并不支持，请使用原生的 addEventListener 代替。</p>\n<h1 id="结束语"><a href="#%E7%BB%93%E6%9D%9F%E8%AF%AD" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>结束语</h1>\n<p>意外学到了 CSS touch-action 相关的一些知识。有了 touch-action:manipulation，我们可以在网页中放心大胆使用 click 事件了，至于自定义的 touch 事件之流可以退出历史舞台了。</p>',id:"/github/workspace/blog/treated as passive错误解决/index.md absPath of file >>> MarkdownRemark",timeToRead:3,frontmatter:{date:"2019-12-23 19:56:02",path:"/treated-as-passive-error-handle/",tags:"前端, 移动端, JS, JS知识点",title:"treated as passive错误解决",draft:null}},{excerpt:"canvas 实现弹幕性能较好 从技术实现成本角度讲，要实现弹幕效果，最简单的方法就是 DOM+CSS3 控制，如果我们的弹幕效果比较简单，使用 CSS3 动画实现也不失为一个好的方法。 但是如果我们的弹幕数据量比较大，就像下面这种： 使用 DOM 来实现很容易卡成了 80 年代的拖拉机——一顿一顿的。 很显然，面对这种多元素的复杂动画，使用 canvas 实现是更加合适的，动画会流畅很多。 本文就将展示两个案例，使用 canvas…",html:'<h1 id="canvas-实现弹幕性能较好"><a href="#canvas-%E5%AE%9E%E7%8E%B0%E5%BC%B9%E5%B9%95%E6%80%A7%E8%83%BD%E8%BE%83%E5%A5%BD" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>canvas 实现弹幕性能较好</h1>\n<p>从技术实现成本角度讲，要实现弹幕效果，最简单的方法就是 DOM+CSS3 控制，如果我们的弹幕效果比较简单，使用 CSS3 动画实现也不失为一个好的方法。</p>\n<p>但是如果我们的弹幕数据量比较大，就像下面这种：</p>\n<p>\n  <a\n    class="gatsby-resp-image-link"\n    href="/static/2019-12-21-16-34-45-6a0d244cc175c3cf8de761f45b373696-59d2e.png"\n    style="display: block"\n    target="_blank"\n    rel="noopener"\n  >\n  \n  <span\n    class="gatsby-resp-image-wrapper"\n    style="position: relative; display: block; ; max-width: 400px; margin-left: auto; margin-right: auto;"\n  >\n    <span\n      class="gatsby-resp-image-background-image"\n      style="padding-bottom: 62.25000000000001%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAIAAADtbgqsAAAACXBIWXMAAA7DAAAOwwHHb6hkAAACpklEQVQozxXG2U/aAACA8T4sc1OuQi+EXlBoKUcptlBqscVSrGgRaWGoBDxBPMiM25PbMs2yzOxhyZLtZU/7T8eSX758gLq5m9Fc7eBtffpYGn1aO30SBg+prXnx8Itx+7M8+8F1H2H9I7//LA1/mdd/ymd/k+63lez2Eq0Djcsb6Wgi9A7XTia50a0wuaO7V5h5Snbec95D7uw51/uMNz+E60+o/dWY/9am3xOt80DeeklqgOKd8d44sT9Nvbml3DnZv6PNMa92GWPMV4fl3rvazkRqTOT6laBfFzv35YO5Nr4zB7NN5whQGy3F3qUlE8trMbEhmp6t2of6tqe3j6TNU8Nxy812rTMw+0NVN+pGaXtXc7re6bh3PATOZzfucCzvn4jOON8+4ZyLtDXKWh7X6CebQ6E3SztT3p0r7n2ldSHuXwp7U8YcVSWnmLcAp9vrH4zMzmBwceMMz6Wmq9heVt1CuTIuGpRsJRSbkK2cbpcMe63ZEa02p+1Iaq2oaECCLRA0y7AFLlsik3xGkPmizAkKxZYYXmYLykI6J1uO3e7t7nmtnY6tGBu2u2Pt2QDOZGJUik4Xkqzwv5xIpYQkK7LFCltU6WyJ4sVUXlEV19g41s1JrX4mVrvr1aNK9RDA0xzJ8nSaT7DZFJ9PZQSKySc4gSmUyIyAp7M4yxOZPMMU0rxK60NyvU9UnIzUzNpjAI5G0VgcXiXQOIHE8QUUpxCCROJxNE6h+GJwGCdhnIBwMkImwgS9kOBzcs0AfCEwEIoEQDgYhv0gFAjDwQgCQigBQesQYkAoHiNAZDWCxkJINIjEQIyAopQ/HPWHMODF8sqSz+cPgcuB4Cuf77U/tBwIrIDhIIxBESSKxUF4NRhBkRgZgjAfCAciGIThyCrpC0L/ALPSm2eZ8M8uAAAAAElFTkSuQmCC\'); background-size: cover; display: block;"\n    >\n      <img\n        class="gatsby-resp-image-image"\n        style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;"\n        alt="2019 12 21 16 34 45"\n        title=""\n        src="/static/2019-12-21-16-34-45-6a0d244cc175c3cf8de761f45b373696-59d2e.png"\n        srcset="/static/2019-12-21-16-34-45-6a0d244cc175c3cf8de761f45b373696-01f55.png 200w,\n/static/2019-12-21-16-34-45-6a0d244cc175c3cf8de761f45b373696-59d2e.png 400w"\n        sizes="(max-width: 400px) 100vw, 400px"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<p>使用 DOM 来实现很容易卡成了 80 年代的拖拉机——一顿一顿的。</p>\n<p>很显然，面对这种多元素的复杂动画，使用 canvas 实现是更加合适的，动画会流畅很多。</p>\n<p>本文就将展示两个案例，使用 canvas 实现弹幕效果。其中一个效果是静态的弹幕数据固定的无限循环的效果，适合在个人博客或者运营页面，这种非视频场景使用；另外一个效果是动态的弹幕数据可变的和真实 HTML5 <code class="language-text">&lt;video&gt;</code> 交互的弹幕效果，也就是真视频弹幕效果。</p>\n<p>两个高保真 demo 的源代码都是可以免费使用的，使用 MIT 许可，也就是需要保留源代码中的版权声明。</p>\n<p>好，下面我们一个人来看一下。</p>\n<h1 id="canvas-实现的静态循环滚动播放弹幕"><a href="#canvas-%E5%AE%9E%E7%8E%B0%E7%9A%84%E9%9D%99%E6%80%81%E5%BE%AA%E7%8E%AF%E6%BB%9A%E5%8A%A8%E6%92%AD%E6%94%BE%E5%BC%B9%E5%B9%95" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>canvas 实现的静态循环滚动播放弹幕</h1>\n<div>\n          <div\n            class="gatsby-resp-iframe-wrapper"\n            style="padding-bottom: 50%; position: relative; height: 0; overflow: hidden;margin-bottom: 2em"\n          >\n            <iframe src="/examples/html5-canvas-video-barrage/static-barrage.html" style="\n            position: absolute;\n            top: 0;\n            left: 0;\n            width: 100%;\n            height: 100%;\n          "></iframe>\n          </div>\n          </div>\n<p><div class="gatsby-highlight">\n        <pre class="language-html"><code><span class="token doctype">&lt;!DOCTYPE html></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>en<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>UTF-8<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>viewport<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>width=device-width, initial-scale=1.0<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">http-equiv</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>X-UA-Compatible<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>ie=edge<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span>Document<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">></span></span><span class="token style"><span class="token language-css">\n    <span class="token selector">html,\n    body</span> <span class="token punctuation">{</span>\n      <span class="token property">background-color</span><span class="token punctuation">:</span> white<span class="token punctuation">;</span>\n      <span class="token property">margin</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n\n    <span class="token selector">.video-x</span> <span class="token punctuation">{</span>\n      <span class="token property">position</span><span class="token punctuation">:</span> relative<span class="token punctuation">;</span>\n      <span class="token property">width</span><span class="token punctuation">:</span> 640px<span class="token punctuation">;</span>\n      <span class="token property">margin</span><span class="token punctuation">:</span> auto<span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n\n    <span class="token selector">.canvas-barrage</span> <span class="token punctuation">{</span>\n      <span class="token property">position</span><span class="token punctuation">:</span> absolute<span class="token punctuation">;</span>\n      <span class="token property">width</span><span class="token punctuation">:</span> 640px<span class="token punctuation">;</span>\n      <span class="token property">height</span><span class="token punctuation">:</span> 360px<span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n\n    <span class="token selector">.video-placeholder</span> <span class="token punctuation">{</span>\n      <span class="token property">height</span><span class="token punctuation">:</span> 360px<span class="token punctuation">;</span>\n      <span class="token property">background-color</span><span class="token punctuation">:</span> #000<span class="token punctuation">;</span>\n      <span class="token property">animation</span><span class="token punctuation">:</span> bgColor 10s infinite alternate<span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n\n    <span class="token atrule"><span class="token rule">@keyframes</span> bgColor</span> <span class="token punctuation">{</span>\n      <span class="token selector">25%</span> <span class="token punctuation">{</span>\n        <span class="token property">background-color</span><span class="token punctuation">:</span> darkred<span class="token punctuation">;</span>\n      <span class="token punctuation">}</span>\n      <span class="token selector">50%</span> <span class="token punctuation">{</span>\n        <span class="token property">background-color</span><span class="token punctuation">:</span> darkgreen<span class="token punctuation">;</span>\n      <span class="token punctuation">}</span>\n      <span class="token selector">75%</span> <span class="token punctuation">{</span>\n        <span class="token property">background-color</span><span class="token punctuation">:</span> darkblue<span class="token punctuation">;</span>\n      <span class="token punctuation">}</span>\n      <span class="token selector">100%</span> <span class="token punctuation">{</span>\n        <span class="token property">background-color</span><span class="token punctuation">:</span> sliver<span class="token punctuation">;</span>\n      <span class="token punctuation">}</span>\n    <span class="token punctuation">}</span>\n  &lt;/head>\n  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>demo<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>video-x<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>\n      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>canvas</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>canvasBarrage<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>canvas-barrage<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>canvas</span><span class="token punctuation">></span></span>\n      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>video-placeholder<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">\n    <span class="token comment">// 弹幕数据</span>\n    <span class="token keyword">var</span> dataBarrage <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>\n      value<span class="token punctuation">:</span> <span class="token string">\'使用的是静态死数据\'</span><span class="token punctuation">,</span>\n      color<span class="token punctuation">:</span> <span class="token string">\'blue\'</span><span class="token punctuation">,</span>\n      range<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">]</span>\n    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>\n      value<span class="token punctuation">:</span> <span class="token string">\'随机循环播放\'</span><span class="token punctuation">,</span>\n      color<span class="token punctuation">:</span> <span class="token string">\'blue\'</span><span class="token punctuation">,</span>\n      range<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0.6</span><span class="token punctuation">]</span>\n    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>\n      value<span class="token punctuation">:</span> <span class="token string">\'可以控制区域和垂直分布范围\'</span><span class="token punctuation">,</span>\n      color<span class="token punctuation">:</span> <span class="token string">\'blue\'</span><span class="token punctuation">,</span>\n      range<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">]</span>\n    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>\n      value<span class="token punctuation">:</span> <span class="token string">\'字体大小和速度在方法内设置\'</span><span class="token punctuation">,</span>\n      color<span class="token punctuation">:</span> <span class="token string">\'black\'</span><span class="token punctuation">,</span>\n      range<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">0.1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span>\n    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>\n      value<span class="token punctuation">:</span> <span class="token string">\'适合用在一些静态页面上\'</span><span class="token punctuation">,</span>\n      color<span class="token punctuation">:</span> <span class="token string">\'black\'</span><span class="token punctuation">,</span>\n      range<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">0.2</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span>\n    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>\n      value<span class="token punctuation">:</span> <span class="token string">\'基于canvas实现\'</span><span class="token punctuation">,</span>\n      color<span class="token punctuation">:</span> <span class="token string">\'black\'</span><span class="token punctuation">,</span>\n      range<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">0.2</span><span class="token punctuation">,</span> <span class="token number">0.9</span><span class="token punctuation">]</span>\n    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>\n      value<span class="token punctuation">:</span> <span class="token string">\'因此IE9+浏览器才支持\'</span><span class="token punctuation">,</span>\n      color<span class="token punctuation">:</span> <span class="token string">\'black\'</span><span class="token punctuation">,</span>\n      range<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">0.2</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span>\n    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>\n      value<span class="token punctuation">:</span> <span class="token string">\'可以设置边框颜色\'</span><span class="token punctuation">,</span>\n      color<span class="token punctuation">:</span> <span class="token string">\'black\'</span><span class="token punctuation">,</span>\n      range<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">0.2</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span>\n    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>\n      value<span class="token punctuation">:</span> <span class="token string">\'文字颜色默认都是白色\'</span><span class="token punctuation">,</span>\n      color<span class="token punctuation">:</span> <span class="token string">\'black\'</span><span class="token punctuation">,</span>\n      range<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">0.2</span><span class="token punctuation">,</span> <span class="token number">0.9</span><span class="token punctuation">]</span>\n    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>\n      value<span class="token punctuation">:</span> <span class="token string">\'若文字颜色不想白色\'</span><span class="token punctuation">,</span>\n      color<span class="token punctuation">:</span> <span class="token string">\'black\'</span><span class="token punctuation">,</span>\n      range<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">0.2</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span>\n    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>\n      value<span class="token punctuation">:</span> <span class="token string">\'需要自己调整下JS\'</span><span class="token punctuation">,</span>\n      color<span class="token punctuation">:</span> <span class="token string">\'black\'</span><span class="token punctuation">,</span>\n      range<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">0.6</span><span class="token punctuation">,</span> <span class="token number">0.7</span><span class="token punctuation">]</span>\n    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>\n      value<span class="token punctuation">:</span> <span class="token string">\'如果需要的是真实和视频交互的弹幕\'</span><span class="token punctuation">,</span>\n      color<span class="token punctuation">:</span> <span class="token string">\'black\'</span><span class="token punctuation">,</span>\n      range<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">0.2</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span>\n    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>\n      value<span class="token punctuation">:</span> <span class="token string">\'可以回到原文\'</span><span class="token punctuation">,</span>\n      color<span class="token punctuation">:</span> <span class="token string">\'black\'</span><span class="token punctuation">,</span>\n      range<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0.9</span><span class="token punctuation">]</span>\n    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>\n      value<span class="token punctuation">:</span> <span class="token string">\'查看另外一个demo\'</span><span class="token punctuation">,</span>\n      color<span class="token punctuation">:</span> <span class="token string">\'black\'</span><span class="token punctuation">,</span>\n      range<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">0.7</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span>\n    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>\n      value<span class="token punctuation">:</span> <span class="token string">\'下面就是占位弹幕了\'</span><span class="token punctuation">,</span>\n      color<span class="token punctuation">:</span> <span class="token string">\'black\'</span><span class="token punctuation">,</span>\n      range<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">0.7</span><span class="token punctuation">,</span> <span class="token number">0.95</span><span class="token punctuation">]</span>\n    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>\n      value<span class="token punctuation">:</span> <span class="token string">\'前方高能预警！！！\'</span><span class="token punctuation">,</span>\n      color<span class="token punctuation">:</span> <span class="token string">\'orange\'</span><span class="token punctuation">,</span>\n      range<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0.8</span><span class="token punctuation">]</span>\n    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>\n      value<span class="token punctuation">:</span> <span class="token string">\'前方高能预警！！！\'</span><span class="token punctuation">,</span>\n      color<span class="token punctuation">:</span> <span class="token string">\'orange\'</span><span class="token punctuation">,</span>\n      range<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0.9</span><span class="token punctuation">]</span>\n    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>\n      value<span class="token punctuation">:</span> <span class="token string">\'前方高能预警！！！\'</span><span class="token punctuation">,</span>\n      color<span class="token punctuation">:</span> <span class="token string">\'orange\'</span><span class="token punctuation">,</span>\n      range<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span>\n    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>\n      value<span class="token punctuation">:</span> <span class="token string">\'前方高能预警！！！\'</span><span class="token punctuation">,</span>\n      color<span class="token punctuation">:</span> <span class="token string">\'orange\'</span><span class="token punctuation">,</span>\n      range<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span>\n    <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n\n    <span class="token comment">// 弹幕方法</span>\n    <span class="token keyword">var</span> <span class="token function-variable function">canvasBarrage</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">canvas<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>canvas <span class="token operator">||</span> <span class="token operator">!</span>data <span class="token operator">||</span> <span class="token operator">!</span>data<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        <span class="token keyword">return</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span>\n      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> canvas <span class="token operator">==</span> <span class="token string">\'string\'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        canvas <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span>canvas<span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token function">canvasBarrage</span><span class="token punctuation">(</span>canvas<span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token keyword">return</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span>\n      <span class="token keyword">var</span> context <span class="token operator">=</span> canvas<span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token string">\'2d\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n      canvas<span class="token punctuation">.</span>width <span class="token operator">=</span> canvas<span class="token punctuation">.</span>clientWidth<span class="token punctuation">;</span>\n      canvas<span class="token punctuation">.</span>height <span class="token operator">=</span> canvas<span class="token punctuation">.</span>clientHeight<span class="token punctuation">;</span>\n\n      <span class="token comment">// 存储实例</span>\n      <span class="token keyword">var</span> store <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n      <span class="token comment">// 字号大小</span>\n      <span class="token keyword">var</span> fontSize <span class="token operator">=</span> <span class="token number">28</span><span class="token punctuation">;</span>\n\n      <span class="token comment">// 实例方法</span>\n      <span class="token keyword">var</span> <span class="token function-variable function">Barrage</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">obj<span class="token punctuation">,</span> index</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        <span class="token comment">// 随机x坐标也就是横坐标，对于y纵坐标，以及变化量moveX</span>\n        <span class="token keyword">this</span><span class="token punctuation">.</span>x <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">+</span> index <span class="token operator">*</span> <span class="token number">0.1</span> <span class="token operator">/</span> Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">*</span> canvas<span class="token punctuation">.</span>width<span class="token punctuation">;</span>\n        <span class="token keyword">this</span><span class="token punctuation">.</span>y <span class="token operator">=</span> obj<span class="token punctuation">.</span>range<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">*</span> canvas<span class="token punctuation">.</span>height <span class="token operator">+</span> <span class="token punctuation">(</span>obj<span class="token punctuation">.</span>range<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">-</span> obj<span class="token punctuation">.</span>range<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">*</span> canvas<span class="token punctuation">.</span>height <span class="token operator">*</span> Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">36</span><span class="token punctuation">;</span>\n        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>y <span class="token operator">&lt;</span> fontSize<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n          <span class="token keyword">this</span><span class="token punctuation">.</span>y <span class="token operator">=</span> fontSize<span class="token punctuation">;</span>\n        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>y <span class="token operator">></span> canvas<span class="token punctuation">.</span>height <span class="token operator">-</span> fontSize<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n          <span class="token keyword">this</span><span class="token punctuation">.</span>y <span class="token operator">=</span> canvas<span class="token punctuation">.</span>height <span class="token operator">-</span> fontSize<span class="token punctuation">;</span>\n        <span class="token punctuation">}</span>\n        <span class="token keyword">this</span><span class="token punctuation">.</span>moveX <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">+</span> Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">3</span><span class="token punctuation">;</span>\n\n        <span class="token keyword">this</span><span class="token punctuation">.</span>opacity <span class="token operator">=</span> <span class="token number">0.8</span> <span class="token operator">+</span> <span class="token number">0.2</span> <span class="token operator">*</span> Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token keyword">this</span><span class="token punctuation">.</span>params <span class="token operator">=</span> obj<span class="token punctuation">;</span>\n\n        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function-variable function">draw</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n          <span class="token keyword">var</span> params <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>params<span class="token punctuation">;</span>\n          <span class="token comment">// 根据此时x位置绘制文本</span>\n          context<span class="token punctuation">.</span>strokeStyle <span class="token operator">=</span> params<span class="token punctuation">.</span>color<span class="token punctuation">;</span>\n          context<span class="token punctuation">.</span>font <span class="token operator">=</span> <span class="token string">\'bold \'</span> <span class="token operator">+</span> fontSize <span class="token operator">+</span> <span class="token string">\'px "microsoft yahei", sans-serif\'</span><span class="token punctuation">;</span>\n          context<span class="token punctuation">.</span>fillStyle <span class="token operator">=</span> <span class="token string">\'rgba(255,255,255,\'</span><span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>opacity <span class="token operator">+</span><span class="token string">\')\'</span><span class="token punctuation">;</span>\n          context<span class="token punctuation">.</span><span class="token function">fillText</span><span class="token punctuation">(</span>params<span class="token punctuation">.</span>value<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>x<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>y<span class="token punctuation">)</span><span class="token punctuation">;</span>\n          context<span class="token punctuation">.</span><span class="token function">strokeText</span><span class="token punctuation">(</span>params<span class="token punctuation">.</span>value<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>x<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>y<span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token punctuation">}</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n      data<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">obj<span class="token punctuation">,</span> index</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        store<span class="token punctuation">[</span>index<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Barrage</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> index<span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n      <span class="token comment">// 绘制弹幕文本</span>\n      <span class="token keyword">var</span> <span class="token function-variable function">draw</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> index <span class="token keyword">in</span> store<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n          <span class="token keyword">var</span> barrage <span class="token operator">=</span> store<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">;</span>\n          <span class="token comment">// 位置变化</span>\n          barrage<span class="token punctuation">.</span>x <span class="token operator">-=</span> barrage<span class="token punctuation">.</span>moveX<span class="token punctuation">;</span>\n          <span class="token keyword">if</span> <span class="token punctuation">(</span>barrage<span class="token punctuation">.</span>x <span class="token operator">&lt;</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token operator">*</span> canvas<span class="token punctuation">.</span>width <span class="token operator">*</span> <span class="token number">1.5</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n            <span class="token comment">// 移动到画布外部时候从左侧开始继续位移</span>\n            barrage<span class="token punctuation">.</span>x <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">+</span> index <span class="token operator">*</span> <span class="token number">0.1</span> <span class="token operator">/</span> Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">*</span> canvas<span class="token punctuation">.</span>width<span class="token punctuation">;</span>\n            barrage<span class="token punctuation">.</span>y <span class="token operator">=</span> <span class="token punctuation">(</span>barrage<span class="token punctuation">.</span>params<span class="token punctuation">.</span>range<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token punctuation">(</span>barrage<span class="token punctuation">.</span>params<span class="token punctuation">.</span>range<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">-</span> barrage<span class="token punctuation">.</span>params<span class="token punctuation">.</span>range<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">*</span> Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">*</span> canvas<span class="token punctuation">.</span>height<span class="token punctuation">;</span>\n            <span class="token keyword">if</span> <span class="token punctuation">(</span>barrage<span class="token punctuation">.</span>y <span class="token operator">&lt;</span> fontSize<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n              barrage<span class="token punctuation">.</span>y <span class="token operator">=</span> fontSize<span class="token punctuation">;</span>\n            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>barrage<span class="token punctuation">.</span>y <span class="token operator">></span> canvas<span class="token punctuation">.</span>height <span class="token operator">-</span> fontSize<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n              barrage<span class="token punctuation">.</span>y <span class="token operator">=</span> canvas<span class="token punctuation">.</span>height <span class="token operator">-</span> fontSize<span class="token punctuation">;</span>\n            <span class="token punctuation">}</span>\n            barrage<span class="token punctuation">.</span>moveX <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">+</span> Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">3</span><span class="token punctuation">;</span>\n          <span class="token punctuation">}</span>\n          <span class="token comment">// 根据新位置绘制圆圈圈</span>\n          store<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">draw</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token punctuation">}</span>\n      <span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n      <span class="token comment">// 画布渲染</span>\n      <span class="token keyword">var</span> <span class="token function-variable function">render</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        <span class="token comment">// 清除画布</span>\n        context<span class="token punctuation">.</span><span class="token function">clearRect</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> canvas<span class="token punctuation">.</span>width<span class="token punctuation">,</span> canvas<span class="token punctuation">.</span>height<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n        <span class="token comment">// 绘制画布上所有的圆圈圈</span>\n        <span class="token function">draw</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n        <span class="token comment">// 继续渲染</span>\n        <span class="token function">requestAnimationFrame</span><span class="token punctuation">(</span>render<span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n      <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n    <span class="token function">canvasBarrage</span><span class="token punctuation">(</span><span class="token string">\'#canvasBarrage\'</span><span class="token punctuation">,</span> dataBarrage<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></code></pre>\n        </div></p>\n<h2 id="使用方法和-api"><a href="#%E4%BD%BF%E7%94%A8%E6%96%B9%E6%B3%95%E5%92%8C-api" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>使用方法和 API</h2>\n<p>语法如下：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="38827677092137170000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`canvasBarrage(canvas, data);`, `38827677092137170000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                js 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token function">canvasBarrage</span><span class="token punctuation">(</span>canvas<span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>其中：</p>\n<ul>\n<li>canvas<br>\ncanvas 表示我们的<code class="language-text">&lt;canvas&gt;</code>画布元素，可以直接是 DOM 元素，也可以是<code class="language-text">&lt;canvas&gt;</code>画布元素的选择器。</li>\n<li>\n<p>data<br>\ndata 表示弹幕数据，是一个数组。例如下面：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="7600607400437154000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`[\n{\n  value: \'弹幕1\',\n  color: \'blue\',\n  range: [0, 0.5]\n},\n{\n  value: \'弹幕2\',\n  color: \'red\',\n  range: [0.5, 1]\n}\n];`, `7600607400437154000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                js 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token punctuation">[</span>\n<span class="token punctuation">{</span>\n  value<span class="token punctuation">:</span> <span class="token string">\'弹幕1\'</span><span class="token punctuation">,</span>\n  color<span class="token punctuation">:</span> <span class="token string">\'blue\'</span><span class="token punctuation">,</span>\n  range<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">]</span>\n<span class="token punctuation">}</span><span class="token punctuation">,</span>\n<span class="token punctuation">{</span>\n  value<span class="token punctuation">:</span> <span class="token string">\'弹幕2\'</span><span class="token punctuation">,</span>\n  color<span class="token punctuation">:</span> <span class="token string">\'red\'</span><span class="token punctuation">,</span>\n  range<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span>\n<span class="token punctuation">}</span>\n<span class="token punctuation">]</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n</li>\n</ul>\n<p>可以看到数组中的每一个值表示一个弹幕的信息对象。其中 value 表示弹幕的文字内容；color 表示弹幕描边的颜色（弹幕文字本身默认是白色）；range 表示弹幕在画布中的区域范围，例如[0, 0.5]表示弹幕在画布中的上半区域显示，[0.5, 1]表示弹幕在画布中的下半区域显示。</p>\n<p>然后就可以看到无限滚动的弹幕效果了。</p>\n<h3 id="补充说明"><a href="#%E8%A1%A5%E5%85%85%E8%AF%B4%E6%98%8E" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>补充说明</h3>\n<p>此弹幕效果默认文字大小是 28px，并且文字加粗，如果这个效果不符合您的需求，需要在 canvasBarrage()方法中修改源代码。因为本来就是个简单静态效果，因此没有专门设计成 API。</p>\n<p>此弹幕效果默认是白色文字加可变颜色描边，同样的，如果这个效果不符合您的需求，需要在 canvasBarrage()方法中修改源代码。跟真实的弹幕效果有所不同，这里的弹幕出现的速度和时机不是基于特定时间，而是随机产生。所以看到有些文字好像开飞机，而有些文字好像坐着拖拉机。因为是死数据，这样设计会看上去更真实写。</p>\n<h1 id="canvas-实现的-video-真实交互的弹幕"><a href="#canvas-%E5%AE%9E%E7%8E%B0%E7%9A%84-video-%E7%9C%9F%E5%AE%9E%E4%BA%A4%E4%BA%92%E7%9A%84%E5%BC%B9%E5%B9%95" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>canvas 实现的 video 真实交互的弹幕</h1>\n<div>\n          <div\n            class="gatsby-resp-iframe-wrapper"\n            style="padding-bottom: 75%; position: relative; height: 0; overflow: hidden;margin-bottom: 2em"\n          >\n            <iframe src="/examples/html5-canvas-video-barrage/interactive-barrage.html" style="\n            position: absolute;\n            top: 0;\n            left: 0;\n            width: 100%;\n            height: 100%;\n          "></iframe>\n          </div>\n          </div>\n<p><div class="gatsby-highlight">\n        <pre class="language-html"><code><span class="token doctype">&lt;!DOCTYPE html></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>en<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>UTF-8<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>viewport<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>width=device-width, initial-scale=1.0<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">http-equiv</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>X-UA-Compatible<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>ie=edge<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span>Document<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">></span></span><span class="token style"><span class="token language-css">\n    <span class="token selector">html,\n    body</span> <span class="token punctuation">{</span>\n      <span class="token property">background-color</span><span class="token punctuation">:</span> white<span class="token punctuation">;</span>\n      <span class="token property">margin</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n\n    <span class="token selector">.video-x</span> <span class="token punctuation">{</span>\n      <span class="token property">position</span><span class="token punctuation">:</span> relative<span class="token punctuation">;</span>\n      <span class="token property">width</span><span class="token punctuation">:</span> 640px<span class="token punctuation">;</span>\n      <span class="token property">margin</span><span class="token punctuation">:</span> auto<span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n\n    <span class="token selector">.video-x video</span> <span class="token punctuation">{</span>\n      <span class="token property">background-color</span><span class="token punctuation">:</span> black<span class="token punctuation">;</span>\n      <span class="token property">outline</span><span class="token punctuation">:</span> 1px solid #eee<span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n\n    <span class="token selector">.canvas-barrage</span> <span class="token punctuation">{</span>\n      <span class="token property">position</span><span class="token punctuation">:</span> absolute<span class="token punctuation">;</span>\n      <span class="token property">width</span><span class="token punctuation">:</span> 640px<span class="token punctuation">;</span>\n      <span class="token property">height</span><span class="token punctuation">:</span> 360px<span class="token punctuation">;</span>\n      <span class="token property">pointer-events</span><span class="token punctuation">:</span> none<span class="token punctuation">;</span>\n      <span class="token property">z-index</span><span class="token punctuation">:</span> 1<span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n\n    <span class="token selector">input[type="range"]</span> <span class="token punctuation">{</span>\n      <span class="token property">vertical-align</span><span class="token punctuation">:</span> middle<span class="token punctuation">;</span>\n      <span class="token property">margin-right</span><span class="token punctuation">:</span> 50px<span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n\n    <span class="token selector">.ui-radio + label</span> <span class="token punctuation">{</span>\n      <span class="token property">margin-left</span><span class="token punctuation">:</span> 5px<span class="token punctuation">;</span>\n      <span class="token property">margin-right</span><span class="token punctuation">:</span> 20px<span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n\n    <span class="token selector">input[type="submit"]</span> <span class="token punctuation">{</span>\n      <span class="token property">margin-left</span><span class="token punctuation">:</span> 10px<span class="token punctuation">;</span>\n      <span class="token property">margin-right</span><span class="token punctuation">:</span> 50px<span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n\n    <span class="token selector">[disabled]</span> <span class="token punctuation">{</span>\n      <span class="token property">pointer-events</span><span class="token punctuation">:</span> none<span class="token punctuation">;</span>\n      <span class="token property">opacity</span><span class="token punctuation">:</span> .4<span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n\n    <span class="token selector">.last</span> <span class="token punctuation">{</span>\n      <span class="token property">border-top</span><span class="token punctuation">:</span> 1px solid #eee<span class="token punctuation">;</span>\n      <span class="token property">margin-top</span><span class="token punctuation">:</span> 1.5em<span class="token punctuation">;</span>\n      <span class="token property">padding-top</span><span class="token punctuation">:</span> 2em<span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>video-x<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>canvas</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>canvasBarrage<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>canvas-barrage<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>canvas</span><span class="token punctuation">></span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>video</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>videoBarrage<span class="token punctuation">"</span></span> <span class="token attr-name">width</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>640<span class="token punctuation">"</span></span> <span class="token attr-name">height</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>384<span class="token punctuation">"</span></span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>./video.mp4<span class="token punctuation">"</span></span> <span class="token attr-name">controls</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>video</span><span class="token punctuation">></span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>barrageForm<span class="token punctuation">"</span></span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>barrage.php<span class="token punctuation">"</span></span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>post<span class="token punctuation">"</span></span> <span class="token attr-name">autocomplete</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>off<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>\n      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span>透明度(0-100)：<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>range<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>range<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>opacity<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>100<span class="token punctuation">"</span></span> <span class="token attr-name">min</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>0<span class="token punctuation">"</span></span> <span class="token attr-name">max</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>100<span class="token punctuation">"</span></span><span class="token punctuation">></span></span> 文字大小(16-32)：<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>range<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>range<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>fontSize<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>24<span class="token punctuation">"</span></span> <span class="token attr-name">min</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>16<span class="token punctuation">"</span></span> <span class="token attr-name">max</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>32<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>\n        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span>弹幕位置：<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>radio<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>rangeFull<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>range<span class="token punctuation">"</span></span> <span class="token attr-name">checked</span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>0,1<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>label</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>ui-radio<span class="token punctuation">"</span></span> <span class="token attr-name">for</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>rangeFull<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>label</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>label</span> <span class="token attr-name">for</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>rangeFull<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>全部位置<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>label</span><span class="token punctuation">></span></span>\n          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>radio<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>rangeTop<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>range<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>0,0.3<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>label</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>ui-radio<span class="token punctuation">"</span></span> <span class="token attr-name">for</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>rangeTop<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>label</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>label</span> <span class="token attr-name">for</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>rangeTop<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>顶部<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>label</span><span class="token punctuation">></span></span>\n          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>radio<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>rangeBottom<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>range<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>0.7,1<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>label</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>ui-radio<span class="token punctuation">"</span></span> <span class="token attr-name">for</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>rangeBottom<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>label</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>label</span> <span class="token attr-name">for</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>rangeBottom<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>底部<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>label</span><span class="token punctuation">></span></span>\n        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>\n        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>last<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>ui-input<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>input<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>value<span class="token punctuation">"</span></span> <span class="token attr-name">required</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>submit<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>ui-button ui-button-primary<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>发送弹幕<span class="token punctuation">"</span></span> <span class="token attr-name">disabled</span><span class="token punctuation">></span></span>\n        颜色：<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>color<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>color<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>color<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>#ff0000<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">\n    <span class="token keyword">var</span> <span class="token function-variable function">CanvasBarrage</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">canvas<span class="token punctuation">,</span> video<span class="token punctuation">,</span> options</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>canvas <span class="token operator">||</span> <span class="token operator">!</span>video<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        <span class="token keyword">return</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span>\n      <span class="token keyword">var</span> defaults <span class="token operator">=</span> <span class="token punctuation">{</span>\n        opacity<span class="token punctuation">:</span> <span class="token number">100</span><span class="token punctuation">,</span>\n        fontSize<span class="token punctuation">:</span> <span class="token number">24</span><span class="token punctuation">,</span>\n        speed<span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span>\n        range<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>\n        color<span class="token punctuation">:</span> <span class="token string">\'white\'</span><span class="token punctuation">,</span>\n        data<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>\n      <span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n      options <span class="token operator">=</span> options <span class="token operator">||</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n      <span class="token keyword">var</span> params <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>\n      <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> key <span class="token keyword">in</span> defaults<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        <span class="token keyword">if</span> <span class="token punctuation">(</span>options<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n          params<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> options<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">;</span>\n        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>\n          params<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> defaults<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">;</span>\n        <span class="token punctuation">}</span>\n\n        <span class="token keyword">this</span><span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> params<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span>\n      <span class="token keyword">var</span> top <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>\n      <span class="token keyword">var</span> data <span class="token operator">=</span> top<span class="token punctuation">.</span>data<span class="token punctuation">;</span>\n\n      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>data <span class="token operator">||</span> <span class="token operator">!</span>data<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        <span class="token keyword">return</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span>\n\n      <span class="token keyword">var</span> context <span class="token operator">=</span> canvas<span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token string">\'2d\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n      canvas<span class="token punctuation">.</span>width <span class="token operator">=</span> canvas<span class="token punctuation">.</span>clientWidth<span class="token punctuation">;</span>\n      canvas<span class="token punctuation">.</span>height <span class="token operator">=</span> canvas<span class="token punctuation">.</span>clientHeight<span class="token punctuation">;</span>\n\n      <span class="token keyword">var</span> store <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n      <span class="token keyword">var</span> isPause <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>\n      <span class="token keyword">var</span> time <span class="token operator">=</span> video<span class="token punctuation">.</span>currentTime<span class="token punctuation">;</span>\n\n      <span class="token keyword">var</span> fontSize <span class="token operator">=</span> <span class="token number">28</span><span class="token punctuation">;</span>\n\n      <span class="token keyword">var</span> <span class="token function-variable function">Barrage</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">obj</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        <span class="token keyword">this</span><span class="token punctuation">.</span>value <span class="token operator">=</span> obj<span class="token punctuation">.</span>value<span class="token punctuation">;</span>\n        <span class="token keyword">this</span><span class="token punctuation">.</span>time <span class="token operator">=</span> obj<span class="token punctuation">.</span>time<span class="token punctuation">;</span>\n        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function-variable function">init</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n          <span class="token keyword">var</span> speed <span class="token operator">=</span> top<span class="token punctuation">.</span>speed<span class="token punctuation">;</span>\n          <span class="token keyword">if</span> <span class="token punctuation">(</span>obj<span class="token punctuation">.</span><span class="token function">hasOwnProperty</span><span class="token punctuation">(</span><span class="token string">\'speed\'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n            speed <span class="token operator">=</span> obj<span class="token punctuation">.</span>speed<span class="token punctuation">;</span>\n          <span class="token punctuation">}</span>\n          <span class="token keyword">if</span> <span class="token punctuation">(</span>speed <span class="token operator">!==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n            speed <span class="token operator">=</span> speed <span class="token operator">+</span> obj<span class="token punctuation">.</span>value<span class="token punctuation">.</span>length <span class="token operator">/</span> <span class="token number">100</span><span class="token punctuation">;</span>\n          <span class="token punctuation">}</span>\n          <span class="token keyword">var</span> fontSize <span class="token operator">=</span> obj<span class="token punctuation">.</span>fontSize <span class="token operator">||</span> top<span class="token punctuation">.</span>fontSize<span class="token punctuation">;</span>\n\n          <span class="token keyword">var</span> color <span class="token operator">=</span> obj<span class="token punctuation">.</span>color <span class="token operator">||</span> top<span class="token punctuation">.</span>color<span class="token punctuation">;</span>\n          color <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n            <span class="token keyword">var</span> div <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">\'div\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n            div<span class="token punctuation">.</span>style<span class="token punctuation">.</span>backgroundColor <span class="token operator">=</span> color<span class="token punctuation">;</span>\n            document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>div<span class="token punctuation">)</span><span class="token punctuation">;</span>\n            <span class="token keyword">var</span> c <span class="token operator">=</span> window<span class="token punctuation">.</span><span class="token function">getComputedStyle</span><span class="token punctuation">(</span>div<span class="token punctuation">)</span><span class="token punctuation">.</span>backgroundColor<span class="token punctuation">;</span>\n            document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">removeChild</span><span class="token punctuation">(</span>div<span class="token punctuation">)</span><span class="token punctuation">;</span>\n            <span class="token keyword">return</span> c<span class="token punctuation">;</span>\n          <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n          <span class="token keyword">var</span> range <span class="token operator">=</span> obj<span class="token punctuation">.</span>range <span class="token operator">||</span> top<span class="token punctuation">.</span>range<span class="token punctuation">;</span>\n          <span class="token keyword">var</span> opacity <span class="token operator">=</span> obj<span class="token punctuation">.</span>opacity <span class="token operator">||</span> top<span class="token punctuation">.</span>opacity<span class="token punctuation">;</span>\n          opacity <span class="token operator">=</span> opacity <span class="token operator">/</span> <span class="token number">100</span><span class="token punctuation">;</span>\n\n          <span class="token keyword">var</span> span <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">\'span\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n          span<span class="token punctuation">.</span>style<span class="token punctuation">.</span>position <span class="token operator">=</span> <span class="token string">\'absolute\'</span><span class="token punctuation">;</span>\n          span<span class="token punctuation">.</span>style<span class="token punctuation">.</span>whiteSpace <span class="token operator">=</span> <span class="token string">\'nowrap\'</span><span class="token punctuation">;</span>\n          span<span class="token punctuation">.</span>style<span class="token punctuation">.</span>font <span class="token operator">=</span> <span class="token string">\'bold \'</span> <span class="token operator">+</span> fontSize <span class="token operator">+</span> <span class="token string">\'px "microsoft yahei", sans-serif\'</span><span class="token punctuation">;</span>\n          span<span class="token punctuation">.</span>innerText <span class="token operator">=</span> obj<span class="token punctuation">.</span>value<span class="token punctuation">;</span>\n          span<span class="token punctuation">.</span>textContent <span class="token operator">=</span> obj<span class="token punctuation">.</span>value<span class="token punctuation">;</span>\n          document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>span<span class="token punctuation">)</span><span class="token punctuation">;</span>\n          <span class="token keyword">this</span><span class="token punctuation">.</span>width <span class="token operator">=</span> span<span class="token punctuation">.</span>clientWidth<span class="token punctuation">;</span>\n          document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">removeChild</span><span class="token punctuation">(</span>span<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n          <span class="token keyword">this</span><span class="token punctuation">.</span>x <span class="token operator">=</span> canvas<span class="token punctuation">.</span>width<span class="token punctuation">;</span>\n          <span class="token keyword">if</span> <span class="token punctuation">(</span>speed <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n            <span class="token keyword">this</span><span class="token punctuation">.</span>x\t<span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>x <span class="token operator">-</span> <span class="token keyword">this</span><span class="token punctuation">.</span>width<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span>\n          <span class="token punctuation">}</span>\n          <span class="token keyword">this</span><span class="token punctuation">.</span>actualX <span class="token operator">=</span> canvas<span class="token punctuation">.</span>width<span class="token punctuation">;</span>\n          <span class="token keyword">this</span><span class="token punctuation">.</span>y <span class="token operator">=</span> range<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">*</span> canvas<span class="token punctuation">.</span>height <span class="token operator">+</span> <span class="token punctuation">(</span>range<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">-</span> range<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">*</span> canvas<span class="token punctuation">.</span>height <span class="token operator">*</span> Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n          <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>y <span class="token operator">&lt;</span> fontSize<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n            <span class="token keyword">this</span><span class="token punctuation">.</span>y <span class="token operator">=</span> fontSize<span class="token punctuation">;</span>\n          <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>y <span class="token operator">></span> canvas<span class="token punctuation">.</span>height <span class="token operator">-</span> fontSize<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n            <span class="token keyword">this</span><span class="token punctuation">.</span>y <span class="token operator">=</span> canvas<span class="token punctuation">.</span>height <span class="token operator">-</span> fontSize<span class="token punctuation">;</span>\n          <span class="token punctuation">}</span>\n\n          <span class="token keyword">this</span><span class="token punctuation">.</span>moveX <span class="token operator">=</span> speed<span class="token punctuation">;</span>\n          <span class="token keyword">this</span><span class="token punctuation">.</span>opacity <span class="token operator">=</span> opacity<span class="token punctuation">;</span>\n          <span class="token keyword">this</span><span class="token punctuation">.</span>color <span class="token operator">=</span> color<span class="token punctuation">;</span>\n          <span class="token keyword">this</span><span class="token punctuation">.</span>range <span class="token operator">=</span> range<span class="token punctuation">;</span>\n          <span class="token keyword">this</span><span class="token punctuation">.</span>fontSize <span class="token operator">=</span> fontSize<span class="token punctuation">;</span>\n        <span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function-variable function">draw</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n          context<span class="token punctuation">.</span>shadowColor <span class="token operator">=</span> <span class="token string">\'rgba(0,0,0,\'</span><span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>opacity <span class="token operator">+</span><span class="token string">\')\'</span><span class="token punctuation">;</span>\n          context<span class="token punctuation">.</span>shadowBlur <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>\n          context<span class="token punctuation">.</span>font <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>fontSize <span class="token operator">+</span> <span class="token string">\'px "microsoft yahei", sans-serif\'</span><span class="token punctuation">;</span>\n          <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token regex">/rgb\\(/</span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>color<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n            context<span class="token punctuation">.</span>fillStyle <span class="token operator">=</span> <span class="token string">\'rgba(\'</span><span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>color<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">\'(\'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">\')\'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">+</span><span class="token string">\',\'</span><span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>opacity <span class="token operator">+</span><span class="token string">\')\'</span><span class="token punctuation">;</span>\n          <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>\n            context<span class="token punctuation">.</span>fillStyle <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>color<span class="token punctuation">;</span>\n          <span class="token punctuation">}</span>\n          context<span class="token punctuation">.</span><span class="token function">fillText</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>value<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>x<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>y<span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token punctuation">}</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n      data<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">obj<span class="token punctuation">,</span> index</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        store<span class="token punctuation">[</span>index<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Barrage</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n      <span class="token keyword">var</span> <span class="token function-variable function">draw</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> index <span class="token keyword">in</span> store<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n          <span class="token keyword">var</span> barrage <span class="token operator">=</span> store<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">;</span>\n\n          <span class="token keyword">if</span> <span class="token punctuation">(</span>barrage <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>barrage<span class="token punctuation">.</span>disabled <span class="token operator">&amp;&amp;</span> time <span class="token operator">>=</span> barrage<span class="token punctuation">.</span>time<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>barrage<span class="token punctuation">.</span>inited<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n              barrage<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n              barrage<span class="token punctuation">.</span>inited <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>\n            <span class="token punctuation">}</span>\n            barrage<span class="token punctuation">.</span>x <span class="token operator">-=</span> barrage<span class="token punctuation">.</span>moveX<span class="token punctuation">;</span>\n            <span class="token keyword">if</span> <span class="token punctuation">(</span>barrage<span class="token punctuation">.</span>moveX <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n              barrage<span class="token punctuation">.</span>actualX <span class="token operator">-=</span> top<span class="token punctuation">.</span>speed<span class="token punctuation">;</span>\n            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>\n              barrage<span class="token punctuation">.</span>actualX <span class="token operator">=</span> barrage<span class="token punctuation">.</span>x<span class="token punctuation">;</span>\n            <span class="token punctuation">}</span>\n            <span class="token keyword">if</span> <span class="token punctuation">(</span>barrage<span class="token punctuation">.</span>actualX <span class="token operator">&lt;</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token operator">*</span> barrage<span class="token punctuation">.</span>width<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n              barrage<span class="token punctuation">.</span>x <span class="token operator">=</span> barrage<span class="token punctuation">.</span>actualX<span class="token punctuation">;</span>\n              barrage<span class="token punctuation">.</span>disabled <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>\n            <span class="token punctuation">}</span>\n            barrage<span class="token punctuation">.</span><span class="token function">draw</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n          <span class="token punctuation">}</span>\n        <span class="token punctuation">}</span>\n      <span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n      <span class="token keyword">var</span> <span class="token function-variable function">render</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        time <span class="token operator">=</span> video<span class="token punctuation">.</span>currentTime<span class="token punctuation">;</span>\n        context<span class="token punctuation">.</span><span class="token function">clearRect</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> canvas<span class="token punctuation">.</span>width<span class="token punctuation">,</span> canvas<span class="token punctuation">.</span>height<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n        <span class="token function">draw</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n        <span class="token keyword">if</span> <span class="token punctuation">(</span>isPause <span class="token operator">==</span> <span class="token boolean">false</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n          <span class="token function">requestAnimationFrame</span><span class="token punctuation">(</span>render<span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token punctuation">}</span>\n      <span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n      video<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">\'play\'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        isPause <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>\n        <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n      video<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">\'pause\'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        isPause <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n      video<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">\'seeked\'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        top<span class="token punctuation">.</span><span class="token function">reset</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n\n      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function-variable function">add</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">obj</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        store<span class="token punctuation">[</span>Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>store<span class="token punctuation">)</span><span class="token punctuation">.</span>length<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Barrage</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function-variable function">reset</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        time <span class="token operator">=</span> video<span class="token punctuation">.</span>currentTime<span class="token punctuation">;</span>\n        context<span class="token punctuation">.</span><span class="token function">clearRect</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> canvas<span class="token punctuation">.</span>width<span class="token punctuation">,</span> canvas<span class="token punctuation">.</span>height<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> index <span class="token keyword">in</span> store<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n          <span class="token keyword">var</span> barrage <span class="token operator">=</span> store<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">;</span>\n          <span class="token keyword">if</span> <span class="token punctuation">(</span>barrage<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n            barrage<span class="token punctuation">.</span>disabled <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>\n            <span class="token keyword">if</span> <span class="token punctuation">(</span>time <span class="token operator">&lt;</span> barrage<span class="token punctuation">.</span>time<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n              barrage<span class="token punctuation">.</span>inited <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>\n            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>\n              barrage<span class="token punctuation">.</span>disabled <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>\n            <span class="token punctuation">}</span>\n          <span class="token punctuation">}</span>\n        <span class="token punctuation">}</span>\n      <span class="token punctuation">}</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span><span class="token punctuation">;</span>\n  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">\n    <span class="token comment">// 弹幕数据</span>\n    <span class="token keyword">var</span> dataBarrage <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>\n      value<span class="token punctuation">:</span> <span class="token string">\'speed设为0为非滚动\'</span><span class="token punctuation">,</span>\n      time<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token comment">// 单位秒</span>\n      speed<span class="token punctuation">:</span> <span class="token number">0</span>\n    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>\n      value<span class="token punctuation">:</span> <span class="token string">\'time控制弹幕时间，单位秒\'</span><span class="token punctuation">,</span>\n      color<span class="token punctuation">:</span> <span class="token string">\'blue\'</span><span class="token punctuation">,</span>\n      time<span class="token punctuation">:</span> <span class="token number">2</span>\n    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>\n      value<span class="token punctuation">:</span> <span class="token string">\'视频共21秒\'</span><span class="token punctuation">,</span>\n      time<span class="token punctuation">:</span> <span class="token number">3.2</span>\n    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>\n      value<span class="token punctuation">:</span> <span class="token string">\'视频背景为白色\'</span><span class="token punctuation">,</span>\n      time<span class="token punctuation">:</span> <span class="token number">4.5</span>\n    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>\n      value<span class="token punctuation">:</span> <span class="token string">\'视频为录制\'</span><span class="token punctuation">,</span>\n      time<span class="token punctuation">:</span> <span class="token number">5.0</span>\n    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>\n      value<span class="token punctuation">:</span> <span class="token string">\'视频内容简单\'</span><span class="token punctuation">,</span>\n      time<span class="token punctuation">:</span> <span class="token number">6.3</span>\n    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>\n      value<span class="token punctuation">:</span> <span class="token string">\'是为了让视频尺寸不至于过大\'</span><span class="token punctuation">,</span>\n      time<span class="token punctuation">:</span> <span class="token number">7.8</span>\n    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>\n      value<span class="token punctuation">:</span> <span class="token string">\'省流量\'</span><span class="token punctuation">,</span>\n      time<span class="token punctuation">:</span> <span class="token number">8.5</span>\n    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>\n      value<span class="token punctuation">:</span> <span class="token string">\'支持弹幕暂停（视频暂停）\'</span><span class="token punctuation">,</span>\n      time<span class="token punctuation">:</span> <span class="token number">9</span>\n    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>\n      value<span class="token punctuation">:</span> <span class="token string">\'add()方法新增弹幕\'</span><span class="token punctuation">,</span>\n      time<span class="token punctuation">:</span> <span class="token number">11</span>\n    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>\n      value<span class="token punctuation">:</span> <span class="token string">\'reset()方法重置弹幕\'</span><span class="token punctuation">,</span>\n      time<span class="token punctuation">:</span> <span class="token number">11</span>\n    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>\n      value<span class="token punctuation">:</span> <span class="token string">\'颜色，字号，透明度可全局设置\'</span><span class="token punctuation">,</span>\n      time<span class="token punctuation">:</span> <span class="token number">13</span>\n    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>\n      value<span class="token punctuation">:</span> <span class="token string">\'具体交互细节可参考页面源代码\'</span><span class="token punctuation">,</span>\n      time<span class="token punctuation">:</span> <span class="token number">14</span>\n    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>\n      value<span class="token punctuation">:</span> <span class="token string">\'内容不错哦！\'</span><span class="token punctuation">,</span>\n      time<span class="token punctuation">:</span> <span class="token number">18</span><span class="token punctuation">,</span>\n      color<span class="token punctuation">:</span> <span class="token string">\'yellow\'</span>\n    <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n\n    <span class="token comment">// 初始化弹幕方法</span>\n    <span class="token keyword">var</span> eleCanvas <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">\'canvasBarrage\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">var</span> eleVideo <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">\'videoBarrage\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">var</span> demoBarrage <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CanvasBarrage</span><span class="token punctuation">(</span>eleCanvas<span class="token punctuation">,</span> eleVideo<span class="token punctuation">,</span> <span class="token punctuation">{</span>\n      data<span class="token punctuation">:</span> dataBarrage\n    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token comment">// 下面是交互处理，与弹幕方法本身无关，旨在演示如何修改全局设置，新增弹幕等</span>\n    <span class="token comment">// 1. 全局的弹幕大小，位置和透明度处理</span>\n    document<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">"DOMContentLoaded"</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">\'.range\'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">\'change\'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        <span class="token comment">// 改变弹幕的透明度和字号大小</span>\n        demoBarrage<span class="token punctuation">[</span><span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>value <span class="token operator">*</span> <span class="token number">1</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n      <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">\'input[name="range"]\'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">\'click\'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        <span class="token comment">// 改变弹幕在视频显示的区域范围</span>\n        demoBarrage<span class="token punctuation">[</span><span class="token string">\'range\'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>value<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">\',\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n      <span class="token comment">// 发送弹幕</span>\n      <span class="token keyword">var</span> elForm <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">\'#barrageForm\'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> elInput <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">\'#input\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n      elForm<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">\'submit\'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        event<span class="token punctuation">.</span><span class="token function">preventDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token comment">// 新增弹幕</span>\n        demoBarrage<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n          value<span class="token punctuation">:</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">\'#input\'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">val</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n          color<span class="token punctuation">:</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">\'#color\'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">val</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n          time<span class="token punctuation">:</span> eleVideo<span class="token punctuation">.</span>currentTime\n        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n        elInput<span class="token punctuation">.</span><span class="token function">val</span><span class="token punctuation">(</span><span class="token string">\'\'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">trigger</span><span class="token punctuation">(</span><span class="token string">\'input\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token comment">// 提交按钮</span>\n      <span class="token keyword">var</span> elSubmit <span class="token operator">=</span> elForm<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token string">\'input[type="submit"]\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n      <span class="token comment">// 输入框和禁用按钮</span>\n      elInput<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">\'input\'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>value<span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n          elSubmit<span class="token punctuation">.</span><span class="token function">removeAttr</span><span class="token punctuation">(</span><span class="token string">\'disabled\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>\n          elSubmit<span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">\'disabled\'</span><span class="token punctuation">,</span> <span class="token string">\'disabled\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token punctuation">}</span>\n      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>./lulu.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">\n    <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">\'.range\'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">range</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">\'#color\'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">color</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></code></pre>\n        </div></p>\n<p>这个原型就有点厉害了，市面上估计很难找到这么负责任的原型页面了。实现的动机完全兴趣使然，上面实现了个简单的，就想着要不实现一个真实的，万一以后用得到呢？</p>\n<h2 id="使用方法和-api-1"><a href="#%E4%BD%BF%E7%94%A8%E6%96%B9%E6%B3%95%E5%92%8C-api-1" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>使用方法和 API</h2>\n<p>语法如下：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="14271693152778674000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`new CanvasBarrage(canvas, video, options);`, `14271693152778674000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                js 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">new</span> <span class="token class-name">CanvasBarrage</span><span class="token punctuation">(</span>canvas<span class="token punctuation">,</span> video<span class="token punctuation">,</span> options<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>其中：</p>\n<ul>\n<li>canvas<br>\ncanvas 表示我们的<code class="language-text">&lt;canvas&gt;</code>画布元素，只能是 DOM 元素。</li>\n<li>video<br>\nvideo 表示我们播放的视频元素，只能是 DOM 元素。</li>\n<li>options<br>\noptions 为可选参数，包括：</li>\n</ul>\n<p>\n  <a\n    class="gatsby-resp-image-link"\n    href="/static/2019-12-23-01-49-36-8271c7a2ba6f424e1bb7f514a0927a82-5ee9d.png"\n    style="display: block"\n    target="_blank"\n    rel="noopener"\n  >\n  \n  <span\n    class="gatsby-resp-image-wrapper"\n    style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;"\n  >\n    <span\n      class="gatsby-resp-image-background-image"\n      style="padding-bottom: 95.21103896103897%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAATCAIAAAAf7rriAAAACXBIWXMAAA7DAAAOwwHHb6hkAAACPUlEQVQ4y31T2ZKbMBDk//8tVanK0ya2AQskELpv5Je0sHfD5qIaVZfQqGemh+5yG79fhuswKROVjcYX64u2CRyELuLL129Ch5AeLlbAn9Appa0LIebxTmZKV75tm6BskUob45Qy1jrnfa2PD+x7LWUHupnxTRob0kgoZRtlHDtCWW0DVhcy1k1oqR0XGgB3PqXySLl2sgknHOoH0g/3YSRkojNdwKd5WbkYyXztx2lmy4qrV3IQ7IN3QuJ+jxyFkJzj8zLjXfkwjFidD8i5FeA8uDE4G2JKIUYfY+d8RMHG+QkVswUBEMGt4LhumuidTITM0NDaoEJtXEHNB7paKxqw14pMlEYWVhu1CWmbRkAuTx5jfHWr1lzKE92+7+WAtDuXeVN5XlIzLBTjs0u7i7sNWfukXTyQnjA+teBnPIz90fuBBEKDMK9DysUnPmL+HowAusZVRsKCsqlJ/Rev4PIKTpeb7+8ewbhInWQbbMPvygVPC67aFR9LyCXmRlzMx9rwTrI5BJ/AXHUwILUncw57GJ3n/tYvy0Lu5Hq5UEqv19vb29vYpocIIXBMay2l5Bt/WYW+w0hrMQzwxWAYMNOHteaYHzB8dbm0AvMx2CCnmlVmW1pFmhiyyrDqDBMy8I9uF5iZroPviSfUqz+MeZl87nY4dXtT0IyMJ+hDWb/jyY/mf8Inn7UJ+L8w9phL4wKm3XrwoK031vuYQspnxJR/pS0lOsm1Umj1xtujlMImY2xd15xTbX/ACfv+E1LJLzNPKHZ2AAAAAElFTkSuQmCC\'); background-size: cover; display: block;"\n    >\n      <img\n        class="gatsby-resp-image-image"\n        style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;"\n        alt="2019 12 23 01 49 36"\n        title=""\n        src="/static/2019-12-23-01-49-36-8271c7a2ba6f424e1bb7f514a0927a82-fee1c.png"\n        srcset="/static/2019-12-23-01-49-36-8271c7a2ba6f424e1bb7f514a0927a82-a67b7.png 200w,\n/static/2019-12-23-01-49-36-8271c7a2ba6f424e1bb7f514a0927a82-0b187.png 400w,\n/static/2019-12-23-01-49-36-8271c7a2ba6f424e1bb7f514a0927a82-fee1c.png 800w,\n/static/2019-12-23-01-49-36-8271c7a2ba6f424e1bb7f514a0927a82-b1a91.png 1200w,\n/static/2019-12-23-01-49-36-8271c7a2ba6f424e1bb7f514a0927a82-5ee9d.png 1232w"\n        sizes="(max-width: 800px) 100vw, 800px"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<h2 id="如何修改全局设置和添加弹幕？"><a href="#%E5%A6%82%E4%BD%95%E4%BF%AE%E6%94%B9%E5%85%A8%E5%B1%80%E8%AE%BE%E7%BD%AE%E5%92%8C%E6%B7%BB%E5%8A%A0%E5%BC%B9%E5%B9%95%EF%BC%9F" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>如何修改全局设置和添加弹幕？</h2>\n<p>当我们使用 new CanvasBarrage()构造完我们的弹幕方法后，会返回一个弹幕对象，通过调用这个对象暴露的属性和方法，就可以进行全局的设置和添加弹幕等。例如：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="8463013145733633000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`var myBarrage = new CanvasBarrage(canvas, video, options);`, `8463013145733633000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                js 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">var</span> myBarrage <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CanvasBarrage</span><span class="token punctuation">(</span>canvas<span class="token punctuation">,</span> video<span class="token punctuation">,</span> options<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>如果我们想把弹幕透明度改成 50%透明，可以：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="39593934712413010000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`myBarrage.opacity = 50;`, `39593934712413010000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                js 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js">myBarrage<span class="token punctuation">.</span>opacity <span class="token operator">=</span> <span class="token number">50</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>就这么简单，于是新出现的弹幕都会以 50%透明显示，类似的，弹幕文字大小和颜色，弹幕显示的区域范围都可以通过这样设置，例如：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="6185170948728613000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`myBarrage.fontSize = 20;`, `6185170948728613000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                js 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js">myBarrage<span class="token punctuation">.</span>fontSize <span class="token operator">=</span> <span class="token number">20</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>就是把弹幕文字颜色改成 20px 大小。</p>\n<p>如果我们想动态添加弹幕，可以使用暴露的 add()方法，语法如下：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="29009644639896306000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`myBarrage.add(obj);`, `29009644639896306000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                js 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js">myBarrage<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>其中 obj 的参数类型和支持属性和 options-data 数组中对象一模一样。例如：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="33682702526790443000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`myBarrage.add({\n  value: \'new CanvasBarrage()\',\n  color: \'#ff0000\',\n  time: 0\n});`, `33682702526790443000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                js 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js">myBarrage<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n  value<span class="token punctuation">:</span> <span class="token string">\'new CanvasBarrage()\'</span><span class="token punctuation">,</span>\n  color<span class="token punctuation">:</span> <span class="token string">\'#ff0000\'</span><span class="token punctuation">,</span>\n  time<span class="token punctuation">:</span> <span class="token number">0</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>myBarrage 还暴露了一个名为 reset()方法，可以清除屏幕上所有的弹幕，并重新根据视频时间开始运动与显示。视频点击跳转时候的弹幕处理就是调用的此方法。</p>',
id:"/github/workspace/blog/使用canvas实现和HTML5 video交互的弹幕效果/index.md absPath of file >>> MarkdownRemark",timeToRead:10,frontmatter:{date:"2019-12-21 16:33:45",path:"/html5-canvas-video-barrage/",tags:"前端, JS, JS知识点",title:"使用canvas实现和HTML5 video交互的弹幕效果",draft:null}},{excerpt:"简介 Pointer Lock API 可以让你的鼠标无限移动，脱离浏览器窗体的限制！ API 3 个属性 Document.pointerLockElement Document.onpointerlockchange Document.onpointerlockerror 2 个方法 Element.requestPointerLock() Document.exitPointerLock() 2 个事件 pointerlockchange pointerlockerror 其中，…",html:'<h1 id="简介"><a href="#%E7%AE%80%E4%BB%8B" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>简介</h1>\n<p>Pointer Lock API 可以让你的鼠标无限移动，脱离浏览器窗体的限制！</p>\n<h1 id="api"><a href="#api" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>API</h1>\n<ul>\n<li>3 个属性<br>\nDocument.pointerLockElement<br>\nDocument.onpointerlockchange<br>\nDocument.onpointerlockerror</li>\n<li>2 个方法<br>\nElement.requestPointerLock()<br>\nDocument.exitPointerLock()</li>\n<li>2 个事件<br>\npointerlockchange<br>\npointerlockerror</li>\n</ul>\n<p>其中，2 个事件和其中 2 个属性是一一对应的，因此，我们实际上需要了解的知识点是下面这些： Document.pointerLockElement，以及 Element.requestPointerLock()，Document.exitPointerLock()以及 pointerlockchange 和 pointerlockerror 事件。</p>\n<h2 id="documentpointerlockelement"><a href="#documentpointerlockelement" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Document.pointerLockElement</h2>\n<p>指当前页面触发鼠标无限滚动的元素，通常使用语法为：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="15555793902586456000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`var element = document.pointerLockElement;`, `15555793902586456000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                js 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">var</span> element <span class="token operator">=</span> document<span class="token punctuation">.</span>pointerLockElement<span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>返回的是一个 DOM 元素对象，如果当前页面是非鼠标锁定状态，则返回值是 null。</p>\n<h2 id="elementrequestpointerlock"><a href="#elementrequestpointerlock" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Element.requestPointerLock()</h2>\n<p>可以让页面进入鼠标锁定状态（鼠标直接消失），鼠标无限滚动，坐标无限变化。通常使用语法为：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="60382287695027270000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`var element.requestPointerLock();`, `60382287695027270000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                js 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">var</span> element<span class="token punctuation">.</span><span class="token function">requestPointerLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<h2 id="documentexitpointerlock"><a href="#documentexitpointerlock" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Document.exitPointerLock()</h2>\n<p>让页面从鼠标锁定状态退出，通常使用语法为：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="46577644564886290000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`document.exitPointerLock();`, `46577644564886290000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                j 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="j"><pre style="counter-reset: linenumber NaN" class="language-j line-numbers"><code class="language-j">documen<span class="token adverb builtin">t.</span>exitPointerLock<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token verb keyword">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>浏览器默认支持按下 ESC 键退出鼠标锁定状态，但是用户有时候更习惯于点击取消等，此时就可以使用 document.exitPointerLock()进行设置。</p>\n<h2 id="pointerlockchange-事件"><a href="#pointerlockchange-%E4%BA%8B%E4%BB%B6" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>pointerlockchange 事件</h2>\n<p>当页面鼠标锁定状态改变的时候触发。例如：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="25763009683519013000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`document.addEventListener(\n  \'pointerlockchange\',\n  function() {\n    // ...\n  },\n  false\n);`, `25763009683519013000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                js 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js">document<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span>\n  <span class="token string">\'pointerlockchange\'</span><span class="token punctuation">,</span>\n  <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token comment">// ...</span>\n  <span class="token punctuation">}</span><span class="token punctuation">,</span>\n  <span class="token boolean">false</span>\n<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id="pointerlockerror-事件"><a href="#pointerlockerror-%E4%BA%8B%E4%BB%B6" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>pointerlockerror 事件</h2>\n<p>当页面鼠标锁定失败的时候触发。例如当你试图同时锁定同一个页面的多个<code class="language-text">&lt;iframe&gt;</code>时候，就会触发这个出错事件。</p>\n<h2 id="应用"><a href="#%E5%BA%94%E7%94%A8" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>应用</h2>\n<div>\n          <div\n            class="gatsby-resp-iframe-wrapper"\n            style="padding-bottom: 25%; position: relative; height: 0; overflow: hidden;margin-bottom: 2em"\n          >\n            <iframe src="/examples/js-api-pointer-lock/demo.html" style="\n            position: absolute;\n            top: 0;\n            left: 0;\n            width: 100%;\n            height: 100%;\n          "></iframe>\n          </div>\n          </div>\n<p><div class="gatsby-highlight">\n        <pre class="language-html"><code><span class="token doctype">&lt;!DOCTYPE html></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>en<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>UTF-8<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>viewport<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>width=device-width, initial-scale=1.0<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">http-equiv</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>X-UA-Compatible<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>ie=edge<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span>Document<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">></span></span><span class="token style"><span class="token language-css">\n    <span class="token selector">html,\n    body</span> <span class="token punctuation">{</span>\n      <span class="token property">background-color</span><span class="token punctuation">:</span> white<span class="token punctuation">;</span>\n      <span class="token property">margin</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n\n    <span class="token selector">.box</span> <span class="token punctuation">{</span>\n      <span class="token property">line-height</span><span class="token punctuation">:</span> 400px<span class="token punctuation">;</span>\n      <span class="token property">text-align</span><span class="token punctuation">:</span> center<span class="token punctuation">;</span>\n      <span class="token property">position</span><span class="token punctuation">:</span> relative<span class="token punctuation">;</span>\n      <span class="token property">perspective</span><span class="token punctuation">:</span> 200px<span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n\n    <span class="token selector">.box img</span> <span class="token punctuation">{</span>\n      <span class="token property">vertical-align</span><span class="token punctuation">:</span> middle<span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>box<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>image<span class="token punctuation">"</span></span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>./avatar.png<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">\n    <span class="token keyword">var</span> eleImage <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">\'image\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">if</span> <span class="token punctuation">(</span>eleImage<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token comment">// 起始值</span>\n      <span class="token keyword">var</span> moveX <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> moveY <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>\n      <span class="token comment">// 图片无限变换的方法</span>\n      <span class="token keyword">var</span> <span class="token function-variable function">rotate3D</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        moveX <span class="token operator">=</span> moveX <span class="token operator">+</span> event<span class="token punctuation">.</span>movementX<span class="token punctuation">;</span>\n        moveY <span class="token operator">=</span> moveY <span class="token operator">+</span> event<span class="token punctuation">.</span>movementY<span class="token punctuation">;</span>\n\n        eleImage<span class="token punctuation">.</span>style<span class="token punctuation">.</span>transform <span class="token operator">=</span> <span class="token string">\'rotateX(\'</span> <span class="token operator">+</span> moveY <span class="token operator">+</span> <span class="token string">\'deg) rotateY(\'</span> <span class="token operator">+</span> moveX <span class="token operator">+</span> <span class="token string">\'deg)\'</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n      <span class="token comment">// 触发鼠标锁定</span>\n      eleImage<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">\'click\'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        eleImage<span class="token punctuation">.</span><span class="token function">requestPointerLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n      <span class="token comment">// 再次点击页面，取消鼠标锁定处理</span>\n      document<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">\'click\'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        <span class="token keyword">if</span> <span class="token punctuation">(</span>document<span class="token punctuation">.</span>pointerLockElement <span class="token operator">==</span> eleImage<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n            document<span class="token punctuation">.</span><span class="token function">exitPointerLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token punctuation">}</span>\n      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n      <span class="token comment">// 检测鼠标锁定状态变化</span>\n      document<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">\'pointerlockchange\'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        <span class="token keyword">if</span> <span class="token punctuation">(</span>document<span class="token punctuation">.</span>pointerLockElement <span class="token operator">==</span> eleImage<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n            document<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">"mousemove"</span><span class="token punctuation">,</span> rotate3D<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>\n            document<span class="token punctuation">.</span><span class="token function">removeEventListener</span><span class="token punctuation">(</span><span class="token string">"mousemove"</span><span class="token punctuation">,</span> rotate3D<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token punctuation">}</span>\n      <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></code></pre>\n        </div></p>\n<p>原理大致如下：</p>\n<p>点击图片，执行 eleImage.requestPointerLock()让页面进入鼠标锁定状态，此时会触发 pointerlockchange 事件，于是，给页面绑定鼠标移动改变图片旋转的方法，为了避免重复绑定，我们借助 document.pointerLockElement 判断页面的锁定状态。最后，为了方便取消页面的锁定状态，我们在页面上绑定了点击事件，通过 document.exitPointerLock()取消页面的锁定状态。</p>\n<p>需要说明的：</p>\n<p>event.movementX 和 event.movementY 表示每次 mousemove 事件触发时候，距离上次移动的水平和垂直位置大小，而不是具体的某个坐标值。因此，需要和初始坐标不断的累加确定当前移动位置。</p>\n<h1 id="兼容性"><a href="#%E5%85%BC%E5%AE%B9%E6%80%A7" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>兼容性</h1>\n<p>最后说下 Pointer Lock API 的兼容性。</p>\n<p>由于 Pointer Lock API 是与鼠标相关的 API，因此所有移动端都不支持，因为没有必要支持。</p>\n<p>对于桌面浏览器，Chrome，Firefox 以及 Edge 浏览器都是支持的，并且现在使用可以不加私有前缀，直接走起。IE 并不支持，但这并不妨碍我们进行增强使用 Pointer Lock API。</p>',id:"/github/workspace/blog/鼠标无限移动 JS API Pointer Lock简介/index.md absPath of file >>> MarkdownRemark",timeToRead:2,frontmatter:{date:"2019-12-21 15:57:19",path:"/js-api-pointer-lock/",tags:"前端, JS, JS知识点",title:"鼠标无限移动 JS API Pointer Lock简介",draft:null}},{excerpt:"HTML 与文件下载 如果希望在前端侧直接触发某些资源的下载，最方便快捷的方法就是使用 HTML5 原生的 download 属性，例如： 但显然，如果纯粹利用 HTML 属性来实现文件的下载（而不是浏览器打开或浏览），对于动态内容，就无能为力。 例如，我们对页面进行分享的时候，希望分享图片是页面内容的实时截图，此时，这个图片就是动态的，纯 HTML 显然是无法满足我们的需求的，借助 JS 和其它一些 HTML5 特性，例如，将页面元素转换到 canvas…",html:'<h1 id="html-与文件下载"><a href="#html-%E4%B8%8E%E6%96%87%E4%BB%B6%E4%B8%8B%E8%BD%BD" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>HTML 与文件下载</h1>\n<p>如果希望在前端侧直接触发某些资源的下载，最方便快捷的方法就是使用 HTML5 原生的 download 属性，例如：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="35009151183345046000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`<a href=&quot;large.jpg&quot; download>下载</a>`, `35009151183345046000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                html 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="html"><pre style="counter-reset: linenumber NaN" class="language-html line-numbers"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>large.jpg<span class="token punctuation">"</span></span> <span class="token attr-name">download</span><span class="token punctuation">></span></span>下载<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>但显然，如果纯粹利用 HTML 属性来实现文件的下载（而不是浏览器打开或浏览），对于动态内容，就无能为力。</p>\n<p>例如，我们对页面进行分享的时候，希望分享图片是页面内容的实时截图，此时，这个图片就是动态的，纯 HTML 显然是无法满足我们的需求的，借助 JS 和其它一些 HTML5 特性，例如，将页面元素转换到 canvas 上，然后再转成图片进行下载。</p>\n<p>但本文要介绍的下载不是图片的下载，而是文本信息的下载，所需要使用的 HTML 特性不是 canvas，而是其它。</p>\n<h1 id="借助-html5-blob-实现文本信息文件下载"><a href="#%E5%80%9F%E5%8A%A9-html5-blob-%E5%AE%9E%E7%8E%B0%E6%96%87%E6%9C%AC%E4%BF%A1%E6%81%AF%E6%96%87%E4%BB%B6%E4%B8%8B%E8%BD%BD" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>借助 HTML5 Blob 实现文本信息文件下载</h1>\n<p>原理其实很简单，我们可以将文本或者 JS 字符串信息借助 Blob 转换成二进制，然后，作为<code class="language-text">&lt;a&gt;</code>元素的 href 属性，配合 download 属性，实现下载。</p>\n<p>代码也比较简单，如下示意（兼容 Chrome 和 Firefox）：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="78408820319644220000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`var funDownload = function(content, filename) {\n  // 创建隐藏的可下载链接\n  var eleLink = document.createElement(\'a\');\n  eleLink.download = filename;\n  eleLink.style.display = \'none\';\n  // 字符内容转变成blob地址\n  var blob = new Blob([content]);\n  eleLink.href = URL.createObjectURL(blob);\n  // 触发点击\n  document.body.appendChild(eleLink);\n  eleLink.click();\n  // 然后移除\n  document.body.removeChild(eleLink);\n};`, `78408820319644220000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                js 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">var</span> <span class="token function-variable function">funDownload</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">content<span class="token punctuation">,</span> filename</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token comment">// 创建隐藏的可下载链接</span>\n  <span class="token keyword">var</span> eleLink <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">\'a\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  eleLink<span class="token punctuation">.</span>download <span class="token operator">=</span> filename<span class="token punctuation">;</span>\n  eleLink<span class="token punctuation">.</span>style<span class="token punctuation">.</span>display <span class="token operator">=</span> <span class="token string">\'none\'</span><span class="token punctuation">;</span>\n  <span class="token comment">// 字符内容转变成blob地址</span>\n  <span class="token keyword">var</span> blob <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Blob</span><span class="token punctuation">(</span><span class="token punctuation">[</span>content<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  eleLink<span class="token punctuation">.</span>href <span class="token operator">=</span> <span class="token constant">URL</span><span class="token punctuation">.</span><span class="token function">createObjectURL</span><span class="token punctuation">(</span>blob<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token comment">// 触发点击</span>\n  document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>eleLink<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  eleLink<span class="token punctuation">.</span><span class="token function">click</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token comment">// 然后移除</span>\n  document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">removeChild</span><span class="token punctuation">(</span>eleLink<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>其中，content 指需要下载的文本或字符串内容，filename 指下载到系统中的文件名称。</p>\n<h1 id="借助-base64-实现任意文件下载"><a href="#%E5%80%9F%E5%8A%A9-base64-%E5%AE%9E%E7%8E%B0%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E4%B8%8B%E8%BD%BD" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>借助 Base64 实现任意文件下载</h1>\n<p>对于非文本文件，也是可以直接 JS 触发下载的，例如，如果我们想下载一张图片，可以把这张图片转换成 base64 格式，然后下载。</p>\n<p>代码示意：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="58549917742440630000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`var funDownload = function(domImg, filename) {\n  // 创建隐藏的可下载链接\n  var eleLink = document.createElement(\'a\');\n  eleLink.download = filename;\n  eleLink.style.display = \'none\';\n  // 图片转base64地址\n  var canvas = document.createElement(\'canvas\');\n  var context = canvas.getContext(\'2d\');\n  var width = domImg.naturalWidth;\n  var height = domImg.naturalHeight;\n  context.drawImage(domImg, 0, 0);\n  // 如果是PNG图片，则canvas.toDataURL(\'image/png\')\n  eleLink.href = canvas.toDataURL(\'image/jpeg\');\n  // 触发点击，这里为了兼容Firefox加了appendChild方法\n  document.body.appendChild(eleLink);\n  eleLink.click();\n  // 然后移除\n  document.body.removeChild(eleLink);\n};`, `58549917742440630000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                js 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">var</span> <span class="token function-variable function">funDownload</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">domImg<span class="token punctuation">,</span> filename</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token comment">// 创建隐藏的可下载链接</span>\n  <span class="token keyword">var</span> eleLink <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">\'a\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  eleLink<span class="token punctuation">.</span>download <span class="token operator">=</span> filename<span class="token punctuation">;</span>\n  eleLink<span class="token punctuation">.</span>style<span class="token punctuation">.</span>display <span class="token operator">=</span> <span class="token string">\'none\'</span><span class="token punctuation">;</span>\n  <span class="token comment">// 图片转base64地址</span>\n  <span class="token keyword">var</span> canvas <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">\'canvas\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token keyword">var</span> context <span class="token operator">=</span> canvas<span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token string">\'2d\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token keyword">var</span> width <span class="token operator">=</span> domImg<span class="token punctuation">.</span>naturalWidth<span class="token punctuation">;</span>\n  <span class="token keyword">var</span> height <span class="token operator">=</span> domImg<span class="token punctuation">.</span>naturalHeight<span class="token punctuation">;</span>\n  context<span class="token punctuation">.</span><span class="token function">drawImage</span><span class="token punctuation">(</span>domImg<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token comment">// 如果是PNG图片，则canvas.toDataURL(\'image/png\')</span>\n  eleLink<span class="token punctuation">.</span>href <span class="token operator">=</span> canvas<span class="token punctuation">.</span><span class="token function">toDataURL</span><span class="token punctuation">(</span><span class="token string">\'image/jpeg\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token comment">// 触发点击，这里为了兼容Firefox加了appendChild方法</span>\n  document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>eleLink<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  eleLink<span class="token punctuation">.</span><span class="token function">click</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token comment">// 然后移除</span>\n  document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">removeChild</span><span class="token punctuation">(</span>eleLink<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h1 id="总结"><a href="#%E6%80%BB%E7%BB%93" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>总结</h1>\n<p>不止是.html 文件，.txt, .json 等只要内容是文本的文件，都是可以利用这种小技巧实现下载的。</p>\n<p>在 Chrome 浏览器下，模拟点击创建的<code class="language-text">&lt;a&gt;</code>元素即使不 append 到页面中，也是可以触发下载的，但是在 Firefox 浏览器中却不行，因此，上面的 funDownload()方法有一个 appendChild 和 removeChild 的处理，就是为了兼容 Firefox 浏览器。</p>\n<p>当然，有时对 canvas 图片进行 toDataURL 操作时，会存在跨域问题的报错，具体见<a href="/crossorigin-canvas-getimagedata-cors/">解决 canvas 图片 getImageData,toDataURL 跨域问题</a></p>',
id:"/github/workspace/blog/JS前端创建html或json文件并浏览器导出下载/index.md absPath of file >>> MarkdownRemark",timeToRead:2,frontmatter:{date:"2019-12-15 19:55:53",path:"/js-text-string-download-as-html-json-file/",tags:"前端, JS, JS知识点",title:"JS前端创建html或json文件并浏览器导出下载",draft:null}}],length:32,tag:"JS",pagesSum:7,page:4}}}});