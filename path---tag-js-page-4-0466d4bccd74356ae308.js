webpackJsonp([0xe4b0d89fa0ff],{1301:function(n,a){n.exports={data:{site:{siteMetadata:{title:"女王控的博客",description:'前端工程师，黑猫女王控，欢迎勾搭，技术相关<a href="https://github.com/towavephone" target="_blank">@towavephone</a>，QQ闲聊<a href="tencent://AddContact/?fromId=45&fromSubId=1&subcmd=all&uin=634407147&website=www.oicqzone.com">@towave</a>，bili关注<a href="https://space.bilibili.com/11507708#/" target="_blank">@towave</a>',siteUrl:"https://blog.towavephone.com"}}},pathContext:{posts:[{excerpt:"Chrome 和 Safari 浏览器 preventDefault 报 treated as passive 错误 其实这个问题出现有一段时间了，主要麻烦的是，以前没有，后来，Chrome 和 Safari 浏览器升级了，然后出现这个错误，而且就在一个月前，Chrome 浏览器还只是黄色的警告，现在直接就红色错误献上。 例如，随便新建一个空白页面，写上如下 JavaScript 代码： 然后在移动端模式下页面上点击滑来滑去记下，就可以看到一大堆错误： Intervention  Unable…",html:'<h1 id="chrome-和-safari-浏览器-preventdefault-报-treated-as-passive-错误"><a href="#chrome-%E5%92%8C-safari-%E6%B5%8F%E8%A7%88%E5%99%A8-preventdefault-%E6%8A%A5-treated-as-passive-%E9%94%99%E8%AF%AF" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Chrome 和 Safari 浏览器 preventDefault 报 treated as passive 错误</h1>\n<p>其实这个问题出现有一段时间了，主要麻烦的是，以前没有，后来，Chrome 和 Safari 浏览器升级了，然后出现这个错误，而且就在一个月前，Chrome 浏览器还只是黄色的警告，现在直接就红色错误献上。</p>\n<p>例如，随便新建一个空白页面，写上如下 JavaScript 代码：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="10390007460015727000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`document.addEventListener(\'touchmove\', function(event) {\n  event.preventDefault();\n});`, `10390007460015727000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                js 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js">document<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">\'touchmove\'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  event<span class="token punctuation">.</span><span class="token function">preventDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>然后在移动端模式下页面上点击滑来滑去记下，就可以看到一大堆错误：</p>\n<blockquote>\n<p>[Intervention] Unable to preventDefault inside passive event listener due to target being treated as passive. See…</p>\n</blockquote>\n<p>\n  <a\n    class="gatsby-resp-image-link"\n    href="/static/2019-12-23-19-58-05-0cf0990a12ba2d41e5f21cd200a4cda9-180da.png"\n    style="display: block"\n    target="_blank"\n    rel="noopener"\n  >\n  \n  <span\n    class="gatsby-resp-image-wrapper"\n    style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;"\n  >\n    <span\n      class="gatsby-resp-image-background-image"\n      style="padding-bottom: 40.543881334981464%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAIAAAB2/0i6AAAACXBIWXMAAA7DAAAOwwHHb6hkAAAA5klEQVQY06VOW2rDMBD0/S9W+tnGsaR9SLJzhFLiCsWbWccJlH4WBrE7jx0NX2/v7Rys1C3vmC9b4q3Mx1oXf6HOy6bZZy2u1rnXZVhL7eNkU7SQHInt42Qx2ZRsDMbiEkhW+xwNNU9njzSs89JhJXGImhaXJbsbmVycB1nqcQUrJNEuOqz4wKPQ8+wxfAQzGBzFGsndyKMWM7CbO8mz+Tgp7oYJbs+TaXYJZN6bI7/KO/8z/FPqLcRf4ce3gfg3TC/nDeHv5XINsUVqxC1JY22ncyNtiZ2U7ANL09LGqcXkJBiSK/Edd3KwMAmaJQAAAAAASUVORK5CYII=\'); background-size: cover; display: block;"\n    >\n      <img\n        class="gatsby-resp-image-image"\n        style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;"\n        alt="2019 12 23 19 58 05"\n        title=""\n        src="/static/2019-12-23-19-58-05-0cf0990a12ba2d41e5f21cd200a4cda9-fee1c.png"\n        srcset="/static/2019-12-23-19-58-05-0cf0990a12ba2d41e5f21cd200a4cda9-a67b7.png 200w,\n/static/2019-12-23-19-58-05-0cf0990a12ba2d41e5f21cd200a4cda9-0b187.png 400w,\n/static/2019-12-23-19-58-05-0cf0990a12ba2d41e5f21cd200a4cda9-fee1c.png 800w,\n/static/2019-12-23-19-58-05-0cf0990a12ba2d41e5f21cd200a4cda9-180da.png 809w"\n        sizes="(max-width: 800px) 100vw, 800px"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<p>如果仅仅是错误，不影响功能其实还好，但是，这个报错会影响我们之前运行很 OK 的交互操作，例如，自定义滚动，或者元素拖拽效果等，会触发浏览器原生的滚动，产生不好的交互体验效果。</p>\n<p>有以下 2 种解决方案：</p>\n<h1 id="touch-actionnone-解决-treated-as-passive-错误"><a href="#touch-actionnone-%E8%A7%A3%E5%86%B3-treated-as-passive-%E9%94%99%E8%AF%AF" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>touch-action:none 解决 treated as passive 错误</h1>\n<p>加入如下 CSS：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="42360436851749040000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`html {\n  touch-action: none;\n}`, `42360436851749040000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                css 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">html</span> <span class="token punctuation">{</span>\n  <span class="token property">touch-action</span><span class="token punctuation">:</span> none<span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>报错就会无影无踪。</p>\n<p>touch-action 是移动端一个与手势触摸密切相关的 CSS 属性，原本源自 windows phone 手机，微软系，后来被 Chrome 吸收借鉴，Firefox 浏览器跟上，然后 Safari 也部分支持，目前已经可以说是在移动端可以畅行的 CSS 属性。</p>\n<p>支持的关键字值有：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="72816173147874790000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`touch-action: auto;\ntouch-action: none;\ntouch-action: pan-x;\ntouch-action: pan-left;\ntouch-action: pan-right;\ntouch-action: pan-y;\ntouch-action: pan-up;\ntouch-action: pan-down;\ntouch-action: pinch-zoom;\ntouch-action: manipulation;`, `72816173147874790000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                css 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token property">touch-action</span><span class="token punctuation">:</span> auto<span class="token punctuation">;</span>\n<span class="token property">touch-action</span><span class="token punctuation">:</span> none<span class="token punctuation">;</span>\n<span class="token property">touch-action</span><span class="token punctuation">:</span> pan-x<span class="token punctuation">;</span>\n<span class="token property">touch-action</span><span class="token punctuation">:</span> pan-left<span class="token punctuation">;</span>\n<span class="token property">touch-action</span><span class="token punctuation">:</span> pan-right<span class="token punctuation">;</span>\n<span class="token property">touch-action</span><span class="token punctuation">:</span> pan-y<span class="token punctuation">;</span>\n<span class="token property">touch-action</span><span class="token punctuation">:</span> pan-up<span class="token punctuation">;</span>\n<span class="token property">touch-action</span><span class="token punctuation">:</span> pan-down<span class="token punctuation">;</span>\n<span class="token property">touch-action</span><span class="token punctuation">:</span> pinch-zoom<span class="token punctuation">;</span>\n<span class="token property">touch-action</span><span class="token punctuation">:</span> manipulation<span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>其中：</p>\n<ul>\n<li>auto 是默认值，表示手势操作什么的完全由浏览器自己决定（如<code class="language-text">&lt;meta&gt;</code>元素的 viewport 设置）。</li>\n<li>\n<p>manipulation 表示浏览器只允许进行滚动和持续缩放操作，类似双击缩放这种非标准操作就不可以。想当初，click 事件在移动端有个 300ms 延时，就是因为避免和手机双击行为发生冲突。然而，当我们设置了 touch-action:manipulation 干掉了双击行为，则显然，300ms 延时就不复存在，因此，下面的 CSS 声明可以用来避免浏览器 300ms 延时问题。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="65107558370599300000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`html {\ntouch-action: manipulation;\n}`, `65107558370599300000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                css 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">html</span> <span class="token punctuation">{</span>\n<span class="token property">touch-action</span><span class="token punctuation">:</span> manipulation<span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n</li>\n</ul>\n<p>上面 2 个关键字属性值（auto 和 manipulation）是 Safari 唯一支持的两个 touch-action 属性值，iOS Safari 就是为用户操碎了心，就怕开发者把一些对用户无障碍访问有帮助的东西去掉，例如不支持 touch-action:none 以及 iOS10+中设置 viewport 的 user-scalable=no 已经无法阻止用户手指缩放屏幕了，或许在 Safari 看来，对于一个网页，没有任何理由阻止用户放大看你的网页内容。</p>\n<p>至于其他关键字，正如字面意思，要么只能左移，要么只能左右移动，要么只能右移之类，具体如下：</p>\n<ul>\n<li>none 表示不进行任何 touch 相关默认行为，例如，你想用手指滚动网页就不行，双击放大缩小页面也不可以，所有这些行为要自定义。</li>\n<li>pan-x 表示手指头可以水平移来移去。</li>\n<li>pan-left 表示手指头可以往左移动，移动开始后还是可以往右恢复的。</li>\n<li>pan-right 表示手指头可以可以往右移动，移动开始后还是可以往左恢复的。</li>\n<li>pan-y 表示手指头可以垂直移来移去。</li>\n<li>pan-up 表示手指头可以往上移，移动开始后还是可以往下恢复的。</li>\n<li>pan-down 表示手指头可以往下移，移动开始后还是可以往上恢复的。</li>\n<li>pan-zoom 表示手指头可以用来缩放页面</li>\n</ul>\n<p>上述部分关键字可以组合使用，分 pan-y, pan-up, pan-down 和 pan-x, pan-left, pan-right 以及 pan-zoom 这三组，然后这三组关键字可以任意组合，例如：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="36042282963607097000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`.example {\n  touch-action: pan-left pan-up pan-zoom;\n}`, `36042282963607097000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                css 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">.example</span> <span class="token punctuation">{</span>\n  <span class="token property">touch-action</span><span class="token punctuation">:</span> pan-left pan-up pan-zoom<span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>表示可以左移，上移和缩放。</p>\n<p>此方法不足</p>\n<ol>\n<li>iOS Safari 浏览器不支持；</li>\n<li>干掉了可能需要的原生的 touch 相关行为。</li>\n</ol>\n<p>不过主要问题还是 iOS Safari 浏览器不支持，第 2 点不足我们可以当我们需要阻止时候 JS 设置 touch-action 为 none，不需要在 JS 还原即可，不是大问题。</p>\n<p>iOS Safari 对于传统移动网页可是重要浏览器，不可忽略，怎么办，有没有什么其他方法呢？有！就是下面这个。</p>\n<h1 id="直接传递-passivefalse-解决-treated-as-passive-错误"><a href="#%E7%9B%B4%E6%8E%A5%E4%BC%A0%E9%80%92-passivefalse-%E8%A7%A3%E5%86%B3-treated-as-passive-%E9%94%99%E8%AF%AF" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>直接传递 passive:false 解决 treated as passive 错误</h1>\n<p>问题代码是：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="70914542706724530000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`document.addEventListener(\'touchmove\', function(event) {\n  event.preventDefault();\n});`, `70914542706724530000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                js 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js">document<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">\'touchmove\'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  event<span class="token punctuation">.</span><span class="token function">preventDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>修复后的 JavaScript 代码是：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="34110307230849446000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`document.addEventListener(\n  \'touchmove\',\n  function(event) {\n    event.preventDefault();\n  },\n  {\n    passive: false\n  }\n);`, `34110307230849446000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                js 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js">document<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span>\n  <span class="token string">\'touchmove\'</span><span class="token punctuation">,</span>\n  <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    event<span class="token punctuation">.</span><span class="token function">preventDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span><span class="token punctuation">,</span>\n  <span class="token punctuation">{</span>\n    passive<span class="token punctuation">:</span> <span class="token boolean">false</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>也就是 addEventListener 的第三个参数传递 passive:false，告诉浏览器，我这个事件就是不是消极的，是老子主动要这么做的。浏览器此时也不好说什么，然后，我们以前出问题的代码就能正常运行了。</p>\n<p>如果是 Zepto.js 语法下的事件呢，例如：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="13586276605250892000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`\\$(document).on(\'touchmove\', function(event) {\n  event.preventDefault();\n});`, `13586276605250892000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                js 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token function">$</span><span class="token punctuation">(</span>document<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">\'touchmove\'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  event<span class="token punctuation">.</span><span class="token function">preventDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>根据我查看 Zepto 的源码分析，目前并不支持，请使用原生的 addEventListener 代替。</p>\n<h1 id="结束语"><a href="#%E7%BB%93%E6%9D%9F%E8%AF%AD" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>结束语</h1>\n<p>意外学到了 CSS touch-action 相关的一些知识。有了 touch-action:manipulation，我们可以在网页中放心大胆使用 click 事件了，至于自定义的 touch 事件之流可以退出历史舞台了。</p>',id:"/github/workspace/blog/treated as passive错误解决/index.md absPath of file >>> MarkdownRemark",timeToRead:3,frontmatter:{date:"2019-12-23 19:56:02",path:"/treated-as-passive-error-handle/",tags:"前端, 移动端, JS, JS知识点",title:"treated as passive错误解决",draft:null}},{excerpt:"canvas 实现弹幕性能较好 从技术实现成本角度讲，要实现弹幕效果，最简单的方法就是 DOM+CSS3 控制，如果我们的弹幕效果比较简单，使用 CSS3 动画实现也不失为一个好的方法。 但是如果我们的弹幕数据量比较大，就像下面这种： 使用 DOM 来实现很容易卡成了 80 年代的拖拉机——一顿一顿的。 很显然，面对这种多元素的复杂动画，使用 canvas 实现是更加合适的，动画会流畅很多。 本文就将展示两个案例，使用 canvas…",html:'<h1 id="canvas-实现弹幕性能较好"><a href="#canvas-%E5%AE%9E%E7%8E%B0%E5%BC%B9%E5%B9%95%E6%80%A7%E8%83%BD%E8%BE%83%E5%A5%BD" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>canvas 实现弹幕性能较好</h1>\n<p>从技术实现成本角度讲，要实现弹幕效果，最简单的方法就是 DOM+CSS3 控制，如果我们的弹幕效果比较简单，使用 CSS3 动画实现也不失为一个好的方法。</p>\n<p>但是如果我们的弹幕数据量比较大，就像下面这种：</p>\n<p>\n  <a\n    class="gatsby-resp-image-link"\n    href="/static/2019-12-21-16-34-45-6a0d244cc175c3cf8de761f45b373696-59d2e.png"\n    style="display: block"\n    target="_blank"\n    rel="noopener"\n  >\n  \n  <span\n    class="gatsby-resp-image-wrapper"\n    style="position: relative; display: block; ; max-width: 400px; margin-left: auto; margin-right: auto;"\n  >\n    <span\n      class="gatsby-resp-image-background-image"\n      style="padding-bottom: 62.25000000000001%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAIAAADtbgqsAAAACXBIWXMAAA7DAAAOwwHHb6hkAAACpklEQVQozxXG2U/aAACA8T4sc1OuQi+EXlBoKUcptlBqscVSrGgRaWGoBDxBPMiM25PbMs2yzOxhyZLtZU/7T8eSX758gLq5m9Fc7eBtffpYGn1aO30SBg+prXnx8Itx+7M8+8F1H2H9I7//LA1/mdd/ymd/k+63lez2Eq0Djcsb6Wgi9A7XTia50a0wuaO7V5h5Snbec95D7uw51/uMNz+E60+o/dWY/9am3xOt80DeeklqgOKd8d44sT9Nvbml3DnZv6PNMa92GWPMV4fl3rvazkRqTOT6laBfFzv35YO5Nr4zB7NN5whQGy3F3qUlE8trMbEhmp6t2of6tqe3j6TNU8Nxy812rTMw+0NVN+pGaXtXc7re6bh3PATOZzfucCzvn4jOON8+4ZyLtDXKWh7X6CebQ6E3SztT3p0r7n2ldSHuXwp7U8YcVSWnmLcAp9vrH4zMzmBwceMMz6Wmq9heVt1CuTIuGpRsJRSbkK2cbpcMe63ZEa02p+1Iaq2oaECCLRA0y7AFLlsik3xGkPmizAkKxZYYXmYLykI6J1uO3e7t7nmtnY6tGBu2u2Pt2QDOZGJUik4Xkqzwv5xIpYQkK7LFCltU6WyJ4sVUXlEV19g41s1JrX4mVrvr1aNK9RDA0xzJ8nSaT7DZFJ9PZQSKySc4gSmUyIyAp7M4yxOZPMMU0rxK60NyvU9UnIzUzNpjAI5G0VgcXiXQOIHE8QUUpxCCROJxNE6h+GJwGCdhnIBwMkImwgS9kOBzcs0AfCEwEIoEQDgYhv0gFAjDwQgCQigBQesQYkAoHiNAZDWCxkJINIjEQIyAopQ/HPWHMODF8sqSz+cPgcuB4Cuf77U/tBwIrIDhIIxBESSKxUF4NRhBkRgZgjAfCAciGIThyCrpC0L/ALPSm2eZ8M8uAAAAAElFTkSuQmCC\'); background-size: cover; display: block;"\n    >\n      <img\n        class="gatsby-resp-image-image"\n        style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;"\n        alt="2019 12 21 16 34 45"\n        title=""\n        src="/static/2019-12-21-16-34-45-6a0d244cc175c3cf8de761f45b373696-59d2e.png"\n        srcset="/static/2019-12-21-16-34-45-6a0d244cc175c3cf8de761f45b373696-01f55.png 200w,\n/static/2019-12-21-16-34-45-6a0d244cc175c3cf8de761f45b373696-59d2e.png 400w"\n        sizes="(max-width: 400px) 100vw, 400px"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<p>使用 DOM 来实现很容易卡成了 80 年代的拖拉机——一顿一顿的。</p>\n<p>很显然，面对这种多元素的复杂动画，使用 canvas 实现是更加合适的，动画会流畅很多。</p>\n<p>本文就将展示两个案例，使用 canvas 实现弹幕效果。其中一个效果是静态的弹幕数据固定的无限循环的效果，适合在个人博客或者运营页面，这种非视频场景使用；另外一个效果是动态的弹幕数据可变的和真实 HTML5 <code class="language-text">&lt;video&gt;</code> 交互的弹幕效果，也就是真视频弹幕效果。</p>\n<p>两个高保真 demo 的源代码都是可以免费使用的，使用 MIT 许可，也就是需要保留源代码中的版权声明。</p>\n<p>好，下面我们一个人来看一下。</p>\n<h1 id="canvas-实现的静态循环滚动播放弹幕"><a href="#canvas-%E5%AE%9E%E7%8E%B0%E7%9A%84%E9%9D%99%E6%80%81%E5%BE%AA%E7%8E%AF%E6%BB%9A%E5%8A%A8%E6%92%AD%E6%94%BE%E5%BC%B9%E5%B9%95" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>canvas 实现的静态循环滚动播放弹幕</h1>\n<div>\n          <div\n            class="gatsby-resp-iframe-wrapper"\n            style="padding-bottom: 50%; position: relative; height: 0; overflow: hidden;margin-bottom: 2em"\n          >\n            <iframe src="/examples/html5-canvas-video-barrage/static-barrage.html" style="\n            position: absolute;\n            top: 0;\n            left: 0;\n            width: 100%;\n            height: 100%;\n          "></iframe>\n          </div>\n          </div>\n<p><div class="gatsby-highlight">\n        <pre class="language-html"><code><span class="token doctype">&lt;!DOCTYPE html></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>en<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>UTF-8<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>viewport<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>width=device-width, initial-scale=1.0<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">http-equiv</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>X-UA-Compatible<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>ie=edge<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span>Document<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">></span></span><span class="token style"><span class="token language-css">\n    <span class="token selector">html,\n    body</span> <span class="token punctuation">{</span>\n      <span class="token property">background-color</span><span class="token punctuation">:</span> white<span class="token punctuation">;</span>\n      <span class="token property">margin</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n\n    <span class="token selector">.video-x</span> <span class="token punctuation">{</span>\n      <span class="token property">position</span><span class="token punctuation">:</span> relative<span class="token punctuation">;</span>\n      <span class="token property">width</span><span class="token punctuation">:</span> 640px<span class="token punctuation">;</span>\n      <span class="token property">margin</span><span class="token punctuation">:</span> auto<span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n\n    <span class="token selector">.canvas-barrage</span> <span class="token punctuation">{</span>\n      <span class="token property">position</span><span class="token punctuation">:</span> absolute<span class="token punctuation">;</span>\n      <span class="token property">width</span><span class="token punctuation">:</span> 640px<span class="token punctuation">;</span>\n      <span class="token property">height</span><span class="token punctuation">:</span> 360px<span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n\n    <span class="token selector">.video-placeholder</span> <span class="token punctuation">{</span>\n      <span class="token property">height</span><span class="token punctuation">:</span> 360px<span class="token punctuation">;</span>\n      <span class="token property">background-color</span><span class="token punctuation">:</span> #000<span class="token punctuation">;</span>\n      <span class="token property">animation</span><span class="token punctuation">:</span> bgColor 10s infinite alternate<span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n\n    <span class="token atrule"><span class="token rule">@keyframes</span> bgColor</span> <span class="token punctuation">{</span>\n      <span class="token selector">25%</span> <span class="token punctuation">{</span>\n        <span class="token property">background-color</span><span class="token punctuation">:</span> darkred<span class="token punctuation">;</span>\n      <span class="token punctuation">}</span>\n      <span class="token selector">50%</span> <span class="token punctuation">{</span>\n        <span class="token property">background-color</span><span class="token punctuation">:</span> darkgreen<span class="token punctuation">;</span>\n      <span class="token punctuation">}</span>\n      <span class="token selector">75%</span> <span class="token punctuation">{</span>\n        <span class="token property">background-color</span><span class="token punctuation">:</span> darkblue<span class="token punctuation">;</span>\n      <span class="token punctuation">}</span>\n      <span class="token selector">100%</span> <span class="token punctuation">{</span>\n        <span class="token property">background-color</span><span class="token punctuation">:</span> sliver<span class="token punctuation">;</span>\n      <span class="token punctuation">}</span>\n    <span class="token punctuation">}</span>\n  &lt;/head>\n  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>demo<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>video-x<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>\n      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>canvas</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>canvasBarrage<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>canvas-barrage<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>canvas</span><span class="token punctuation">></span></span>\n      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>video-placeholder<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">\n    <span class="token comment">// 弹幕数据</span>\n    <span class="token keyword">var</span> dataBarrage <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>\n      value<span class="token punctuation">:</span> <span class="token string">\'使用的是静态死数据\'</span><span class="token punctuation">,</span>\n      color<span class="token punctuation">:</span> <span class="token string">\'blue\'</span><span class="token punctuation">,</span>\n      range<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">]</span>\n    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>\n      value<span class="token punctuation">:</span> <span class="token string">\'随机循环播放\'</span><span class="token punctuation">,</span>\n      color<span class="token punctuation">:</span> <span class="token string">\'blue\'</span><span class="token punctuation">,</span>\n      range<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0.6</span><span class="token punctuation">]</span>\n    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>\n      value<span class="token punctuation">:</span> <span class="token string">\'可以控制区域和垂直分布范围\'</span><span class="token punctuation">,</span>\n      color<span class="token punctuation">:</span> <span class="token string">\'blue\'</span><span class="token punctuation">,</span>\n      range<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">]</span>\n    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>\n      value<span class="token punctuation">:</span> <span class="token string">\'字体大小和速度在方法内设置\'</span><span class="token punctuation">,</span>\n      color<span class="token punctuation">:</span> <span class="token string">\'black\'</span><span class="token punctuation">,</span>\n      range<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">0.1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span>\n    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>\n      value<span class="token punctuation">:</span> <span class="token string">\'适合用在一些静态页面上\'</span><span class="token punctuation">,</span>\n      color<span class="token punctuation">:</span> <span class="token string">\'black\'</span><span class="token punctuation">,</span>\n      range<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">0.2</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span>\n    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>\n      value<span class="token punctuation">:</span> <span class="token string">\'基于canvas实现\'</span><span class="token punctuation">,</span>\n      color<span class="token punctuation">:</span> <span class="token string">\'black\'</span><span class="token punctuation">,</span>\n      range<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">0.2</span><span class="token punctuation">,</span> <span class="token number">0.9</span><span class="token punctuation">]</span>\n    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>\n      value<span class="token punctuation">:</span> <span class="token string">\'因此IE9+浏览器才支持\'</span><span class="token punctuation">,</span>\n      color<span class="token punctuation">:</span> <span class="token string">\'black\'</span><span class="token punctuation">,</span>\n      range<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">0.2</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span>\n    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>\n      value<span class="token punctuation">:</span> <span class="token string">\'可以设置边框颜色\'</span><span class="token punctuation">,</span>\n      color<span class="token punctuation">:</span> <span class="token string">\'black\'</span><span class="token punctuation">,</span>\n      range<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">0.2</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span>\n    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>\n      value<span class="token punctuation">:</span> <span class="token string">\'文字颜色默认都是白色\'</span><span class="token punctuation">,</span>\n      color<span class="token punctuation">:</span> <span class="token string">\'black\'</span><span class="token punctuation">,</span>\n      range<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">0.2</span><span class="token punctuation">,</span> <span class="token number">0.9</span><span class="token punctuation">]</span>\n    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>\n      value<span class="token punctuation">:</span> <span class="token string">\'若文字颜色不想白色\'</span><span class="token punctuation">,</span>\n      color<span class="token punctuation">:</span> <span class="token string">\'black\'</span><span class="token punctuation">,</span>\n      range<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">0.2</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span>\n    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>\n      value<span class="token punctuation">:</span> <span class="token string">\'需要自己调整下JS\'</span><span class="token punctuation">,</span>\n      color<span class="token punctuation">:</span> <span class="token string">\'black\'</span><span class="token punctuation">,</span>\n      range<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">0.6</span><span class="token punctuation">,</span> <span class="token number">0.7</span><span class="token punctuation">]</span>\n    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>\n      value<span class="token punctuation">:</span> <span class="token string">\'如果需要的是真实和视频交互的弹幕\'</span><span class="token punctuation">,</span>\n      color<span class="token punctuation">:</span> <span class="token string">\'black\'</span><span class="token punctuation">,</span>\n      range<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">0.2</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span>\n    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>\n      value<span class="token punctuation">:</span> <span class="token string">\'可以回到原文\'</span><span class="token punctuation">,</span>\n      color<span class="token punctuation">:</span> <span class="token string">\'black\'</span><span class="token punctuation">,</span>\n      range<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0.9</span><span class="token punctuation">]</span>\n    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>\n      value<span class="token punctuation">:</span> <span class="token string">\'查看另外一个demo\'</span><span class="token punctuation">,</span>\n      color<span class="token punctuation">:</span> <span class="token string">\'black\'</span><span class="token punctuation">,</span>\n      range<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">0.7</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span>\n    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>\n      value<span class="token punctuation">:</span> <span class="token string">\'下面就是占位弹幕了\'</span><span class="token punctuation">,</span>\n      color<span class="token punctuation">:</span> <span class="token string">\'black\'</span><span class="token punctuation">,</span>\n      range<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">0.7</span><span class="token punctuation">,</span> <span class="token number">0.95</span><span class="token punctuation">]</span>\n    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>\n      value<span class="token punctuation">:</span> <span class="token string">\'前方高能预警！！！\'</span><span class="token punctuation">,</span>\n      color<span class="token punctuation">:</span> <span class="token string">\'orange\'</span><span class="token punctuation">,</span>\n      range<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0.8</span><span class="token punctuation">]</span>\n    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>\n      value<span class="token punctuation">:</span> <span class="token string">\'前方高能预警！！！\'</span><span class="token punctuation">,</span>\n      color<span class="token punctuation">:</span> <span class="token string">\'orange\'</span><span class="token punctuation">,</span>\n      range<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0.9</span><span class="token punctuation">]</span>\n    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>\n      value<span class="token punctuation">:</span> <span class="token string">\'前方高能预警！！！\'</span><span class="token punctuation">,</span>\n      color<span class="token punctuation">:</span> <span class="token string">\'orange\'</span><span class="token punctuation">,</span>\n      range<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span>\n    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>\n      value<span class="token punctuation">:</span> <span class="token string">\'前方高能预警！！！\'</span><span class="token punctuation">,</span>\n      color<span class="token punctuation">:</span> <span class="token string">\'orange\'</span><span class="token punctuation">,</span>\n      range<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span>\n    <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n\n    <span class="token comment">// 弹幕方法</span>\n    <span class="token keyword">var</span> <span class="token function-variable function">canvasBarrage</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">canvas<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>canvas <span class="token operator">||</span> <span class="token operator">!</span>data <span class="token operator">||</span> <span class="token operator">!</span>data<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        <span class="token keyword">return</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span>\n      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> canvas <span class="token operator">==</span> <span class="token string">\'string\'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        canvas <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span>canvas<span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token function">canvasBarrage</span><span class="token punctuation">(</span>canvas<span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token keyword">return</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span>\n      <span class="token keyword">var</span> context <span class="token operator">=</span> canvas<span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token string">\'2d\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n      canvas<span class="token punctuation">.</span>width <span class="token operator">=</span> canvas<span class="token punctuation">.</span>clientWidth<span class="token punctuation">;</span>\n      canvas<span class="token punctuation">.</span>height <span class="token operator">=</span> canvas<span class="token punctuation">.</span>clientHeight<span class="token punctuation">;</span>\n\n      <span class="token comment">// 存储实例</span>\n      <span class="token keyword">var</span> store <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n      <span class="token comment">// 字号大小</span>\n      <span class="token keyword">var</span> fontSize <span class="token operator">=</span> <span class="token number">28</span><span class="token punctuation">;</span>\n\n      <span class="token comment">// 实例方法</span>\n      <span class="token keyword">var</span> <span class="token function-variable function">Barrage</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">obj<span class="token punctuation">,</span> index</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        <span class="token comment">// 随机x坐标也就是横坐标，对于y纵坐标，以及变化量moveX</span>\n        <span class="token keyword">this</span><span class="token punctuation">.</span>x <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">+</span> index <span class="token operator">*</span> <span class="token number">0.1</span> <span class="token operator">/</span> Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">*</span> canvas<span class="token punctuation">.</span>width<span class="token punctuation">;</span>\n        <span class="token keyword">this</span><span class="token punctuation">.</span>y <span class="token operator">=</span> obj<span class="token punctuation">.</span>range<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">*</span> canvas<span class="token punctuation">.</span>height <span class="token operator">+</span> <span class="token punctuation">(</span>obj<span class="token punctuation">.</span>range<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">-</span> obj<span class="token punctuation">.</span>range<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">*</span> canvas<span class="token punctuation">.</span>height <span class="token operator">*</span> Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">36</span><span class="token punctuation">;</span>\n        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>y <span class="token operator">&lt;</span> fontSize<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n          <span class="token keyword">this</span><span class="token punctuation">.</span>y <span class="token operator">=</span> fontSize<span class="token punctuation">;</span>\n        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>y <span class="token operator">></span> canvas<span class="token punctuation">.</span>height <span class="token operator">-</span> fontSize<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n          <span class="token keyword">this</span><span class="token punctuation">.</span>y <span class="token operator">=</span> canvas<span class="token punctuation">.</span>height <span class="token operator">-</span> fontSize<span class="token punctuation">;</span>\n        <span class="token punctuation">}</span>\n        <span class="token keyword">this</span><span class="token punctuation">.</span>moveX <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">+</span> Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">3</span><span class="token punctuation">;</span>\n\n        <span class="token keyword">this</span><span class="token punctuation">.</span>opacity <span class="token operator">=</span> <span class="token number">0.8</span> <span class="token operator">+</span> <span class="token number">0.2</span> <span class="token operator">*</span> Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token keyword">this</span><span class="token punctuation">.</span>params <span class="token operator">=</span> obj<span class="token punctuation">;</span>\n\n        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function-variable function">draw</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n          <span class="token keyword">var</span> params <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>params<span class="token punctuation">;</span>\n          <span class="token comment">// 根据此时x位置绘制文本</span>\n          context<span class="token punctuation">.</span>strokeStyle <span class="token operator">=</span> params<span class="token punctuation">.</span>color<span class="token punctuation">;</span>\n          context<span class="token punctuation">.</span>font <span class="token operator">=</span> <span class="token string">\'bold \'</span> <span class="token operator">+</span> fontSize <span class="token operator">+</span> <span class="token string">\'px "microsoft yahei", sans-serif\'</span><span class="token punctuation">;</span>\n          context<span class="token punctuation">.</span>fillStyle <span class="token operator">=</span> <span class="token string">\'rgba(255,255,255,\'</span><span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>opacity <span class="token operator">+</span><span class="token string">\')\'</span><span class="token punctuation">;</span>\n          context<span class="token punctuation">.</span><span class="token function">fillText</span><span class="token punctuation">(</span>params<span class="token punctuation">.</span>value<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>x<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>y<span class="token punctuation">)</span><span class="token punctuation">;</span>\n          context<span class="token punctuation">.</span><span class="token function">strokeText</span><span class="token punctuation">(</span>params<span class="token punctuation">.</span>value<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>x<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>y<span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token punctuation">}</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n      data<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">obj<span class="token punctuation">,</span> index</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        store<span class="token punctuation">[</span>index<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Barrage</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> index<span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n      <span class="token comment">// 绘制弹幕文本</span>\n      <span class="token keyword">var</span> <span class="token function-variable function">draw</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> index <span class="token keyword">in</span> store<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n          <span class="token keyword">var</span> barrage <span class="token operator">=</span> store<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">;</span>\n          <span class="token comment">// 位置变化</span>\n          barrage<span class="token punctuation">.</span>x <span class="token operator">-=</span> barrage<span class="token punctuation">.</span>moveX<span class="token punctuation">;</span>\n          <span class="token keyword">if</span> <span class="token punctuation">(</span>barrage<span class="token punctuation">.</span>x <span class="token operator">&lt;</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token operator">*</span> canvas<span class="token punctuation">.</span>width <span class="token operator">*</span> <span class="token number">1.5</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n            <span class="token comment">// 移动到画布外部时候从左侧开始继续位移</span>\n            barrage<span class="token punctuation">.</span>x <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">+</span> index <span class="token operator">*</span> <span class="token number">0.1</span> <span class="token operator">/</span> Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">*</span> canvas<span class="token punctuation">.</span>width<span class="token punctuation">;</span>\n            barrage<span class="token punctuation">.</span>y <span class="token operator">=</span> <span class="token punctuation">(</span>barrage<span class="token punctuation">.</span>params<span class="token punctuation">.</span>range<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token punctuation">(</span>barrage<span class="token punctuation">.</span>params<span class="token punctuation">.</span>range<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">-</span> barrage<span class="token punctuation">.</span>params<span class="token punctuation">.</span>range<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">*</span> Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">*</span> canvas<span class="token punctuation">.</span>height<span class="token punctuation">;</span>\n            <span class="token keyword">if</span> <span class="token punctuation">(</span>barrage<span class="token punctuation">.</span>y <span class="token operator">&lt;</span> fontSize<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n              barrage<span class="token punctuation">.</span>y <span class="token operator">=</span> fontSize<span class="token punctuation">;</span>\n            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>barrage<span class="token punctuation">.</span>y <span class="token operator">></span> canvas<span class="token punctuation">.</span>height <span class="token operator">-</span> fontSize<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n              barrage<span class="token punctuation">.</span>y <span class="token operator">=</span> canvas<span class="token punctuation">.</span>height <span class="token operator">-</span> fontSize<span class="token punctuation">;</span>\n            <span class="token punctuation">}</span>\n            barrage<span class="token punctuation">.</span>moveX <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">+</span> Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">3</span><span class="token punctuation">;</span>\n          <span class="token punctuation">}</span>\n          <span class="token comment">// 根据新位置绘制圆圈圈</span>\n          store<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">draw</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token punctuation">}</span>\n      <span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n      <span class="token comment">// 画布渲染</span>\n      <span class="token keyword">var</span> <span class="token function-variable function">render</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        <span class="token comment">// 清除画布</span>\n        context<span class="token punctuation">.</span><span class="token function">clearRect</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> canvas<span class="token punctuation">.</span>width<span class="token punctuation">,</span> canvas<span class="token punctuation">.</span>height<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n        <span class="token comment">// 绘制画布上所有的圆圈圈</span>\n        <span class="token function">draw</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n        <span class="token comment">// 继续渲染</span>\n        <span class="token function">requestAnimationFrame</span><span class="token punctuation">(</span>render<span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n      <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n    <span class="token function">canvasBarrage</span><span class="token punctuation">(</span><span class="token string">\'#canvasBarrage\'</span><span class="token punctuation">,</span> dataBarrage<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></code></pre>\n        </div></p>\n<h2 id="使用方法和-api"><a href="#%E4%BD%BF%E7%94%A8%E6%96%B9%E6%B3%95%E5%92%8C-api" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>使用方法和 API</h2>\n<p>语法如下：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="38827677092137170000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`canvasBarrage(canvas, data);`, `38827677092137170000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                js 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token function">canvasBarrage</span><span class="token punctuation">(</span>canvas<span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>其中：</p>\n<ul>\n<li>canvas<br>\ncanvas 表示我们的<code class="language-text">&lt;canvas&gt;</code>画布元素，可以直接是 DOM 元素，也可以是<code class="language-text">&lt;canvas&gt;</code>画布元素的选择器。</li>\n<li>\n<p>data<br>\ndata 表示弹幕数据，是一个数组。例如下面：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="7600607400437154000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`[\n{\n  value: \'弹幕1\',\n  color: \'blue\',\n  range: [0, 0.5]\n},\n{\n  value: \'弹幕2\',\n  color: \'red\',\n  range: [0.5, 1]\n}\n];`, `7600607400437154000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                js 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token punctuation">[</span>\n<span class="token punctuation">{</span>\n  value<span class="token punctuation">:</span> <span class="token string">\'弹幕1\'</span><span class="token punctuation">,</span>\n  color<span class="token punctuation">:</span> <span class="token string">\'blue\'</span><span class="token punctuation">,</span>\n  range<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">]</span>\n<span class="token punctuation">}</span><span class="token punctuation">,</span>\n<span class="token punctuation">{</span>\n  value<span class="token punctuation">:</span> <span class="token string">\'弹幕2\'</span><span class="token punctuation">,</span>\n  color<span class="token punctuation">:</span> <span class="token string">\'red\'</span><span class="token punctuation">,</span>\n  range<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span>\n<span class="token punctuation">}</span>\n<span class="token punctuation">]</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n</li>\n</ul>\n<p>可以看到数组中的每一个值表示一个弹幕的信息对象。其中 value 表示弹幕的文字内容；color 表示弹幕描边的颜色（弹幕文字本身默认是白色）；range 表示弹幕在画布中的区域范围，例如[0, 0.5]表示弹幕在画布中的上半区域显示，[0.5, 1]表示弹幕在画布中的下半区域显示。</p>\n<p>然后就可以看到无限滚动的弹幕效果了。</p>\n<h3 id="补充说明"><a href="#%E8%A1%A5%E5%85%85%E8%AF%B4%E6%98%8E" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>补充说明</h3>\n<p>此弹幕效果默认文字大小是 28px，并且文字加粗，如果这个效果不符合您的需求，需要在 canvasBarrage()方法中修改源代码。因为本来就是个简单静态效果，因此没有专门设计成 API。</p>\n<p>此弹幕效果默认是白色文字加可变颜色描边，同样的，如果这个效果不符合您的需求，需要在 canvasBarrage()方法中修改源代码。跟真实的弹幕效果有所不同，这里的弹幕出现的速度和时机不是基于特定时间，而是随机产生。所以看到有些文字好像开飞机，而有些文字好像坐着拖拉机。因为是死数据，这样设计会看上去更真实写。</p>\n<h1 id="canvas-实现的-video-真实交互的弹幕"><a href="#canvas-%E5%AE%9E%E7%8E%B0%E7%9A%84-video-%E7%9C%9F%E5%AE%9E%E4%BA%A4%E4%BA%92%E7%9A%84%E5%BC%B9%E5%B9%95" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>canvas 实现的 video 真实交互的弹幕</h1>\n<div>\n          <div\n            class="gatsby-resp-iframe-wrapper"\n            style="padding-bottom: 75%; position: relative; height: 0; overflow: hidden;margin-bottom: 2em"\n          >\n            <iframe src="/examples/html5-canvas-video-barrage/interactive-barrage.html" style="\n            position: absolute;\n            top: 0;\n            left: 0;\n            width: 100%;\n            height: 100%;\n          "></iframe>\n          </div>\n          </div>\n<p><div class="gatsby-highlight">\n        <pre class="language-html"><code><span class="token doctype">&lt;!DOCTYPE html></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>en<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>UTF-8<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>viewport<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>width=device-width, initial-scale=1.0<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">http-equiv</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>X-UA-Compatible<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>ie=edge<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span>Document<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">></span></span><span class="token style"><span class="token language-css">\n    <span class="token selector">html,\n    body</span> <span class="token punctuation">{</span>\n      <span class="token property">background-color</span><span class="token punctuation">:</span> white<span class="token punctuation">;</span>\n      <span class="token property">margin</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n\n    <span class="token selector">.video-x</span> <span class="token punctuation">{</span>\n      <span class="token property">position</span><span class="token punctuation">:</span> relative<span class="token punctuation">;</span>\n      <span class="token property">width</span><span class="token punctuation">:</span> 640px<span class="token punctuation">;</span>\n      <span class="token property">margin</span><span class="token punctuation">:</span> auto<span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n\n    <span class="token selector">.video-x video</span> <span class="token punctuation">{</span>\n      <span class="token property">background-color</span><span class="token punctuation">:</span> black<span class="token punctuation">;</span>\n      <span class="token property">outline</span><span class="token punctuation">:</span> 1px solid #eee<span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n\n    <span class="token selector">.canvas-barrage</span> <span class="token punctuation">{</span>\n      <span class="token property">position</span><span class="token punctuation">:</span> absolute<span class="token punctuation">;</span>\n      <span class="token property">width</span><span class="token punctuation">:</span> 640px<span class="token punctuation">;</span>\n      <span class="token property">height</span><span class="token punctuation">:</span> 360px<span class="token punctuation">;</span>\n      <span class="token property">pointer-events</span><span class="token punctuation">:</span> none<span class="token punctuation">;</span>\n      <span class="token property">z-index</span><span class="token punctuation">:</span> 1<span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n\n    <span class="token selector">input[type="range"]</span> <span class="token punctuation">{</span>\n      <span class="token property">vertical-align</span><span class="token punctuation">:</span> middle<span class="token punctuation">;</span>\n      <span class="token property">margin-right</span><span class="token punctuation">:</span> 50px<span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n\n    <span class="token selector">.ui-radio + label</span> <span class="token punctuation">{</span>\n      <span class="token property">margin-left</span><span class="token punctuation">:</span> 5px<span class="token punctuation">;</span>\n      <span class="token property">margin-right</span><span class="token punctuation">:</span> 20px<span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n\n    <span class="token selector">input[type="submit"]</span> <span class="token punctuation">{</span>\n      <span class="token property">margin-left</span><span class="token punctuation">:</span> 10px<span class="token punctuation">;</span>\n      <span class="token property">margin-right</span><span class="token punctuation">:</span> 50px<span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n\n    <span class="token selector">[disabled]</span> <span class="token punctuation">{</span>\n      <span class="token property">pointer-events</span><span class="token punctuation">:</span> none<span class="token punctuation">;</span>\n      <span class="token property">opacity</span><span class="token punctuation">:</span> .4<span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n\n    <span class="token selector">.last</span> <span class="token punctuation">{</span>\n      <span class="token property">border-top</span><span class="token punctuation">:</span> 1px solid #eee<span class="token punctuation">;</span>\n      <span class="token property">margin-top</span><span class="token punctuation">:</span> 1.5em<span class="token punctuation">;</span>\n      <span class="token property">padding-top</span><span class="token punctuation">:</span> 2em<span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>video-x<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>canvas</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>canvasBarrage<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>canvas-barrage<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>canvas</span><span class="token punctuation">></span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>video</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>videoBarrage<span class="token punctuation">"</span></span> <span class="token attr-name">width</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>640<span class="token punctuation">"</span></span> <span class="token attr-name">height</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>384<span class="token punctuation">"</span></span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>./video.mp4<span class="token punctuation">"</span></span> <span class="token attr-name">controls</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>video</span><span class="token punctuation">></span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>barrageForm<span class="token punctuation">"</span></span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>barrage.php<span class="token punctuation">"</span></span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>post<span class="token punctuation">"</span></span> <span class="token attr-name">autocomplete</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>off<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>\n      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span>透明度(0-100)：<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>range<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>range<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>opacity<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>100<span class="token punctuation">"</span></span> <span class="token attr-name">min</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>0<span class="token punctuation">"</span></span> <span class="token attr-name">max</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>100<span class="token punctuation">"</span></span><span class="token punctuation">></span></span> 文字大小(16-32)：<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>range<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>range<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>fontSize<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>24<span class="token punctuation">"</span></span> <span class="token attr-name">min</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>16<span class="token punctuation">"</span></span> <span class="token attr-name">max</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>32<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>\n        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span>弹幕位置：<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>radio<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>rangeFull<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>range<span class="token punctuation">"</span></span> <span class="token attr-name">checked</span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>0,1<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>label</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>ui-radio<span class="token punctuation">"</span></span> <span class="token attr-name">for</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>rangeFull<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>label</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>label</span> <span class="token attr-name">for</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>rangeFull<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>全部位置<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>label</span><span class="token punctuation">></span></span>\n          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>radio<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>rangeTop<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>range<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>0,0.3<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>label</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>ui-radio<span class="token punctuation">"</span></span> <span class="token attr-name">for</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>rangeTop<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>label</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>label</span> <span class="token attr-name">for</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>rangeTop<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>顶部<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>label</span><span class="token punctuation">></span></span>\n          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>radio<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>rangeBottom<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>range<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>0.7,1<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>label</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>ui-radio<span class="token punctuation">"</span></span> <span class="token attr-name">for</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>rangeBottom<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>label</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>label</span> <span class="token attr-name">for</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>rangeBottom<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>底部<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>label</span><span class="token punctuation">></span></span>\n        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>\n        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>last<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>ui-input<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>input<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>value<span class="token punctuation">"</span></span> <span class="token attr-name">required</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>submit<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>ui-button ui-button-primary<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>发送弹幕<span class="token punctuation">"</span></span> <span class="token attr-name">disabled</span><span class="token punctuation">></span></span>\n        颜色：<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>color<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>color<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>color<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>#ff0000<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">\n    <span class="token keyword">var</span> <span class="token function-variable function">CanvasBarrage</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">canvas<span class="token punctuation">,</span> video<span class="token punctuation">,</span> options</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>canvas <span class="token operator">||</span> <span class="token operator">!</span>video<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        <span class="token keyword">return</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span>\n      <span class="token keyword">var</span> defaults <span class="token operator">=</span> <span class="token punctuation">{</span>\n        opacity<span class="token punctuation">:</span> <span class="token number">100</span><span class="token punctuation">,</span>\n        fontSize<span class="token punctuation">:</span> <span class="token number">24</span><span class="token punctuation">,</span>\n        speed<span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span>\n        range<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>\n        color<span class="token punctuation">:</span> <span class="token string">\'white\'</span><span class="token punctuation">,</span>\n        data<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>\n      <span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n      options <span class="token operator">=</span> options <span class="token operator">||</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n      <span class="token keyword">var</span> params <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>\n      <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> key <span class="token keyword">in</span> defaults<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        <span class="token keyword">if</span> <span class="token punctuation">(</span>options<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n          params<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> options<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">;</span>\n        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>\n          params<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> defaults<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">;</span>\n        <span class="token punctuation">}</span>\n\n        <span class="token keyword">this</span><span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> params<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span>\n      <span class="token keyword">var</span> top <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>\n      <span class="token keyword">var</span> data <span class="token operator">=</span> top<span class="token punctuation">.</span>data<span class="token punctuation">;</span>\n\n      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>data <span class="token operator">||</span> <span class="token operator">!</span>data<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        <span class="token keyword">return</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span>\n\n      <span class="token keyword">var</span> context <span class="token operator">=</span> canvas<span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token string">\'2d\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n      canvas<span class="token punctuation">.</span>width <span class="token operator">=</span> canvas<span class="token punctuation">.</span>clientWidth<span class="token punctuation">;</span>\n      canvas<span class="token punctuation">.</span>height <span class="token operator">=</span> canvas<span class="token punctuation">.</span>clientHeight<span class="token punctuation">;</span>\n\n      <span class="token keyword">var</span> store <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n      <span class="token keyword">var</span> isPause <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>\n      <span class="token keyword">var</span> time <span class="token operator">=</span> video<span class="token punctuation">.</span>currentTime<span class="token punctuation">;</span>\n\n      <span class="token keyword">var</span> fontSize <span class="token operator">=</span> <span class="token number">28</span><span class="token punctuation">;</span>\n\n      <span class="token keyword">var</span> <span class="token function-variable function">Barrage</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">obj</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        <span class="token keyword">this</span><span class="token punctuation">.</span>value <span class="token operator">=</span> obj<span class="token punctuation">.</span>value<span class="token punctuation">;</span>\n        <span class="token keyword">this</span><span class="token punctuation">.</span>time <span class="token operator">=</span> obj<span class="token punctuation">.</span>time<span class="token punctuation">;</span>\n        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function-variable function">init</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n          <span class="token keyword">var</span> speed <span class="token operator">=</span> top<span class="token punctuation">.</span>speed<span class="token punctuation">;</span>\n          <span class="token keyword">if</span> <span class="token punctuation">(</span>obj<span class="token punctuation">.</span><span class="token function">hasOwnProperty</span><span class="token punctuation">(</span><span class="token string">\'speed\'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n            speed <span class="token operator">=</span> obj<span class="token punctuation">.</span>speed<span class="token punctuation">;</span>\n          <span class="token punctuation">}</span>\n          <span class="token keyword">if</span> <span class="token punctuation">(</span>speed <span class="token operator">!==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n            speed <span class="token operator">=</span> speed <span class="token operator">+</span> obj<span class="token punctuation">.</span>value<span class="token punctuation">.</span>length <span class="token operator">/</span> <span class="token number">100</span><span class="token punctuation">;</span>\n          <span class="token punctuation">}</span>\n          <span class="token keyword">var</span> fontSize <span class="token operator">=</span> obj<span class="token punctuation">.</span>fontSize <span class="token operator">||</span> top<span class="token punctuation">.</span>fontSize<span class="token punctuation">;</span>\n\n          <span class="token keyword">var</span> color <span class="token operator">=</span> obj<span class="token punctuation">.</span>color <span class="token operator">||</span> top<span class="token punctuation">.</span>color<span class="token punctuation">;</span>\n          color <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n            <span class="token keyword">var</span> div <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">\'div\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n            div<span class="token punctuation">.</span>style<span class="token punctuation">.</span>backgroundColor <span class="token operator">=</span> color<span class="token punctuation">;</span>\n            document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>div<span class="token punctuation">)</span><span class="token punctuation">;</span>\n            <span class="token keyword">var</span> c <span class="token operator">=</span> window<span class="token punctuation">.</span><span class="token function">getComputedStyle</span><span class="token punctuation">(</span>div<span class="token punctuation">)</span><span class="token punctuation">.</span>backgroundColor<span class="token punctuation">;</span>\n            document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">removeChild</span><span class="token punctuation">(</span>div<span class="token punctuation">)</span><span class="token punctuation">;</span>\n            <span class="token keyword">return</span> c<span class="token punctuation">;</span>\n          <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n          <span class="token keyword">var</span> range <span class="token operator">=</span> obj<span class="token punctuation">.</span>range <span class="token operator">||</span> top<span class="token punctuation">.</span>range<span class="token punctuation">;</span>\n          <span class="token keyword">var</span> opacity <span class="token operator">=</span> obj<span class="token punctuation">.</span>opacity <span class="token operator">||</span> top<span class="token punctuation">.</span>opacity<span class="token punctuation">;</span>\n          opacity <span class="token operator">=</span> opacity <span class="token operator">/</span> <span class="token number">100</span><span class="token punctuation">;</span>\n\n          <span class="token keyword">var</span> span <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">\'span\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n          span<span class="token punctuation">.</span>style<span class="token punctuation">.</span>position <span class="token operator">=</span> <span class="token string">\'absolute\'</span><span class="token punctuation">;</span>\n          span<span class="token punctuation">.</span>style<span class="token punctuation">.</span>whiteSpace <span class="token operator">=</span> <span class="token string">\'nowrap\'</span><span class="token punctuation">;</span>\n          span<span class="token punctuation">.</span>style<span class="token punctuation">.</span>font <span class="token operator">=</span> <span class="token string">\'bold \'</span> <span class="token operator">+</span> fontSize <span class="token operator">+</span> <span class="token string">\'px "microsoft yahei", sans-serif\'</span><span class="token punctuation">;</span>\n          span<span class="token punctuation">.</span>innerText <span class="token operator">=</span> obj<span class="token punctuation">.</span>value<span class="token punctuation">;</span>\n          span<span class="token punctuation">.</span>textContent <span class="token operator">=</span> obj<span class="token punctuation">.</span>value<span class="token punctuation">;</span>\n          document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>span<span class="token punctuation">)</span><span class="token punctuation">;</span>\n          <span class="token keyword">this</span><span class="token punctuation">.</span>width <span class="token operator">=</span> span<span class="token punctuation">.</span>clientWidth<span class="token punctuation">;</span>\n          document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">removeChild</span><span class="token punctuation">(</span>span<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n          <span class="token keyword">this</span><span class="token punctuation">.</span>x <span class="token operator">=</span> canvas<span class="token punctuation">.</span>width<span class="token punctuation">;</span>\n          <span class="token keyword">if</span> <span class="token punctuation">(</span>speed <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n            <span class="token keyword">this</span><span class="token punctuation">.</span>x\t<span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>x <span class="token operator">-</span> <span class="token keyword">this</span><span class="token punctuation">.</span>width<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span>\n          <span class="token punctuation">}</span>\n          <span class="token keyword">this</span><span class="token punctuation">.</span>actualX <span class="token operator">=</span> canvas<span class="token punctuation">.</span>width<span class="token punctuation">;</span>\n          <span class="token keyword">this</span><span class="token punctuation">.</span>y <span class="token operator">=</span> range<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">*</span> canvas<span class="token punctuation">.</span>height <span class="token operator">+</span> <span class="token punctuation">(</span>range<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">-</span> range<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">*</span> canvas<span class="token punctuation">.</span>height <span class="token operator">*</span> Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n          <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>y <span class="token operator">&lt;</span> fontSize<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n            <span class="token keyword">this</span><span class="token punctuation">.</span>y <span class="token operator">=</span> fontSize<span class="token punctuation">;</span>\n          <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>y <span class="token operator">></span> canvas<span class="token punctuation">.</span>height <span class="token operator">-</span> fontSize<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n            <span class="token keyword">this</span><span class="token punctuation">.</span>y <span class="token operator">=</span> canvas<span class="token punctuation">.</span>height <span class="token operator">-</span> fontSize<span class="token punctuation">;</span>\n          <span class="token punctuation">}</span>\n\n          <span class="token keyword">this</span><span class="token punctuation">.</span>moveX <span class="token operator">=</span> speed<span class="token punctuation">;</span>\n          <span class="token keyword">this</span><span class="token punctuation">.</span>opacity <span class="token operator">=</span> opacity<span class="token punctuation">;</span>\n          <span class="token keyword">this</span><span class="token punctuation">.</span>color <span class="token operator">=</span> color<span class="token punctuation">;</span>\n          <span class="token keyword">this</span><span class="token punctuation">.</span>range <span class="token operator">=</span> range<span class="token punctuation">;</span>\n          <span class="token keyword">this</span><span class="token punctuation">.</span>fontSize <span class="token operator">=</span> fontSize<span class="token punctuation">;</span>\n        <span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function-variable function">draw</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n          context<span class="token punctuation">.</span>shadowColor <span class="token operator">=</span> <span class="token string">\'rgba(0,0,0,\'</span><span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>opacity <span class="token operator">+</span><span class="token string">\')\'</span><span class="token punctuation">;</span>\n          context<span class="token punctuation">.</span>shadowBlur <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>\n          context<span class="token punctuation">.</span>font <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>fontSize <span class="token operator">+</span> <span class="token string">\'px "microsoft yahei", sans-serif\'</span><span class="token punctuation">;</span>\n          <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token regex">/rgb\\(/</span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>color<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n            context<span class="token punctuation">.</span>fillStyle <span class="token operator">=</span> <span class="token string">\'rgba(\'</span><span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>color<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">\'(\'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">\')\'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">+</span><span class="token string">\',\'</span><span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>opacity <span class="token operator">+</span><span class="token string">\')\'</span><span class="token punctuation">;</span>\n          <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>\n            context<span class="token punctuation">.</span>fillStyle <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>color<span class="token punctuation">;</span>\n          <span class="token punctuation">}</span>\n          context<span class="token punctuation">.</span><span class="token function">fillText</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>value<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>x<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>y<span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token punctuation">}</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n      data<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">obj<span class="token punctuation">,</span> index</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        store<span class="token punctuation">[</span>index<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Barrage</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n      <span class="token keyword">var</span> <span class="token function-variable function">draw</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> index <span class="token keyword">in</span> store<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n          <span class="token keyword">var</span> barrage <span class="token operator">=</span> store<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">;</span>\n\n          <span class="token keyword">if</span> <span class="token punctuation">(</span>barrage <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>barrage<span class="token punctuation">.</span>disabled <span class="token operator">&amp;&amp;</span> time <span class="token operator">>=</span> barrage<span class="token punctuation">.</span>time<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>barrage<span class="token punctuation">.</span>inited<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n              barrage<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n              barrage<span class="token punctuation">.</span>inited <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>\n            <span class="token punctuation">}</span>\n            barrage<span class="token punctuation">.</span>x <span class="token operator">-=</span> barrage<span class="token punctuation">.</span>moveX<span class="token punctuation">;</span>\n            <span class="token keyword">if</span> <span class="token punctuation">(</span>barrage<span class="token punctuation">.</span>moveX <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n              barrage<span class="token punctuation">.</span>actualX <span class="token operator">-=</span> top<span class="token punctuation">.</span>speed<span class="token punctuation">;</span>\n            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>\n              barrage<span class="token punctuation">.</span>actualX <span class="token operator">=</span> barrage<span class="token punctuation">.</span>x<span class="token punctuation">;</span>\n            <span class="token punctuation">}</span>\n            <span class="token keyword">if</span> <span class="token punctuation">(</span>barrage<span class="token punctuation">.</span>actualX <span class="token operator">&lt;</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token operator">*</span> barrage<span class="token punctuation">.</span>width<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n              barrage<span class="token punctuation">.</span>x <span class="token operator">=</span> barrage<span class="token punctuation">.</span>actualX<span class="token punctuation">;</span>\n              barrage<span class="token punctuation">.</span>disabled <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>\n            <span class="token punctuation">}</span>\n            barrage<span class="token punctuation">.</span><span class="token function">draw</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n          <span class="token punctuation">}</span>\n        <span class="token punctuation">}</span>\n      <span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n      <span class="token keyword">var</span> <span class="token function-variable function">render</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        time <span class="token operator">=</span> video<span class="token punctuation">.</span>currentTime<span class="token punctuation">;</span>\n        context<span class="token punctuation">.</span><span class="token function">clearRect</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> canvas<span class="token punctuation">.</span>width<span class="token punctuation">,</span> canvas<span class="token punctuation">.</span>height<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n        <span class="token function">draw</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n        <span class="token keyword">if</span> <span class="token punctuation">(</span>isPause <span class="token operator">==</span> <span class="token boolean">false</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n          <span class="token function">requestAnimationFrame</span><span class="token punctuation">(</span>render<span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token punctuation">}</span>\n      <span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n      video<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">\'play\'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        isPause <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>\n        <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n      video<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">\'pause\'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        isPause <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n      video<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">\'seeked\'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        top<span class="token punctuation">.</span><span class="token function">reset</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n\n      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function-variable function">add</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">obj</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        store<span class="token punctuation">[</span>Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>store<span class="token punctuation">)</span><span class="token punctuation">.</span>length<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Barrage</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function-variable function">reset</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        time <span class="token operator">=</span> video<span class="token punctuation">.</span>currentTime<span class="token punctuation">;</span>\n        context<span class="token punctuation">.</span><span class="token function">clearRect</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> canvas<span class="token punctuation">.</span>width<span class="token punctuation">,</span> canvas<span class="token punctuation">.</span>height<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> index <span class="token keyword">in</span> store<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n          <span class="token keyword">var</span> barrage <span class="token operator">=</span> store<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">;</span>\n          <span class="token keyword">if</span> <span class="token punctuation">(</span>barrage<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n            barrage<span class="token punctuation">.</span>disabled <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>\n            <span class="token keyword">if</span> <span class="token punctuation">(</span>time <span class="token operator">&lt;</span> barrage<span class="token punctuation">.</span>time<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n              barrage<span class="token punctuation">.</span>inited <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>\n            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>\n              barrage<span class="token punctuation">.</span>disabled <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>\n            <span class="token punctuation">}</span>\n          <span class="token punctuation">}</span>\n        <span class="token punctuation">}</span>\n      <span class="token punctuation">}</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span><span class="token punctuation">;</span>\n  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">\n    <span class="token comment">// 弹幕数据</span>\n    <span class="token keyword">var</span> dataBarrage <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>\n      value<span class="token punctuation">:</span> <span class="token string">\'speed设为0为非滚动\'</span><span class="token punctuation">,</span>\n      time<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token comment">// 单位秒</span>\n      speed<span class="token punctuation">:</span> <span class="token number">0</span>\n    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>\n      value<span class="token punctuation">:</span> <span class="token string">\'time控制弹幕时间，单位秒\'</span><span class="token punctuation">,</span>\n      color<span class="token punctuation">:</span> <span class="token string">\'blue\'</span><span class="token punctuation">,</span>\n      time<span class="token punctuation">:</span> <span class="token number">2</span>\n    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>\n      value<span class="token punctuation">:</span> <span class="token string">\'视频共21秒\'</span><span class="token punctuation">,</span>\n      time<span class="token punctuation">:</span> <span class="token number">3.2</span>\n    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>\n      value<span class="token punctuation">:</span> <span class="token string">\'视频背景为白色\'</span><span class="token punctuation">,</span>\n      time<span class="token punctuation">:</span> <span class="token number">4.5</span>\n    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>\n      value<span class="token punctuation">:</span> <span class="token string">\'视频为录制\'</span><span class="token punctuation">,</span>\n      time<span class="token punctuation">:</span> <span class="token number">5.0</span>\n    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>\n      value<span class="token punctuation">:</span> <span class="token string">\'视频内容简单\'</span><span class="token punctuation">,</span>\n      time<span class="token punctuation">:</span> <span class="token number">6.3</span>\n    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>\n      value<span class="token punctuation">:</span> <span class="token string">\'是为了让视频尺寸不至于过大\'</span><span class="token punctuation">,</span>\n      time<span class="token punctuation">:</span> <span class="token number">7.8</span>\n    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>\n      value<span class="token punctuation">:</span> <span class="token string">\'省流量\'</span><span class="token punctuation">,</span>\n      time<span class="token punctuation">:</span> <span class="token number">8.5</span>\n    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>\n      value<span class="token punctuation">:</span> <span class="token string">\'支持弹幕暂停（视频暂停）\'</span><span class="token punctuation">,</span>\n      time<span class="token punctuation">:</span> <span class="token number">9</span>\n    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>\n      value<span class="token punctuation">:</span> <span class="token string">\'add()方法新增弹幕\'</span><span class="token punctuation">,</span>\n      time<span class="token punctuation">:</span> <span class="token number">11</span>\n    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>\n      value<span class="token punctuation">:</span> <span class="token string">\'reset()方法重置弹幕\'</span><span class="token punctuation">,</span>\n      time<span class="token punctuation">:</span> <span class="token number">11</span>\n    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>\n      value<span class="token punctuation">:</span> <span class="token string">\'颜色，字号，透明度可全局设置\'</span><span class="token punctuation">,</span>\n      time<span class="token punctuation">:</span> <span class="token number">13</span>\n    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>\n      value<span class="token punctuation">:</span> <span class="token string">\'具体交互细节可参考页面源代码\'</span><span class="token punctuation">,</span>\n      time<span class="token punctuation">:</span> <span class="token number">14</span>\n    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>\n      value<span class="token punctuation">:</span> <span class="token string">\'内容不错哦！\'</span><span class="token punctuation">,</span>\n      time<span class="token punctuation">:</span> <span class="token number">18</span><span class="token punctuation">,</span>\n      color<span class="token punctuation">:</span> <span class="token string">\'yellow\'</span>\n    <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n\n    <span class="token comment">// 初始化弹幕方法</span>\n    <span class="token keyword">var</span> eleCanvas <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">\'canvasBarrage\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">var</span> eleVideo <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">\'videoBarrage\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token keyword">var</span> demoBarrage <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CanvasBarrage</span><span class="token punctuation">(</span>eleCanvas<span class="token punctuation">,</span> eleVideo<span class="token punctuation">,</span> <span class="token punctuation">{</span>\n      data<span class="token punctuation">:</span> dataBarrage\n    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token comment">// 下面是交互处理，与弹幕方法本身无关，旨在演示如何修改全局设置，新增弹幕等</span>\n    <span class="token comment">// 1. 全局的弹幕大小，位置和透明度处理</span>\n    document<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">"DOMContentLoaded"</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">\'.range\'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">\'change\'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        <span class="token comment">// 改变弹幕的透明度和字号大小</span>\n        demoBarrage<span class="token punctuation">[</span><span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>value <span class="token operator">*</span> <span class="token number">1</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n      <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">\'input[name="range"]\'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">\'click\'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        <span class="token comment">// 改变弹幕在视频显示的区域范围</span>\n        demoBarrage<span class="token punctuation">[</span><span class="token string">\'range\'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>value<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">\',\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n      <span class="token comment">// 发送弹幕</span>\n      <span class="token keyword">var</span> elForm <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">\'#barrageForm\'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> elInput <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">\'#input\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n      elForm<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">\'submit\'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        event<span class="token punctuation">.</span><span class="token function">preventDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token comment">// 新增弹幕</span>\n        demoBarrage<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n          value<span class="token punctuation">:</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">\'#input\'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">val</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n          color<span class="token punctuation">:</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">\'#color\'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">val</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n          time<span class="token punctuation">:</span> eleVideo<span class="token punctuation">.</span>currentTime\n        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n        elInput<span class="token punctuation">.</span><span class="token function">val</span><span class="token punctuation">(</span><span class="token string">\'\'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">trigger</span><span class="token punctuation">(</span><span class="token string">\'input\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token comment">// 提交按钮</span>\n      <span class="token keyword">var</span> elSubmit <span class="token operator">=</span> elForm<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token string">\'input[type="submit"]\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n      <span class="token comment">// 输入框和禁用按钮</span>\n      elInput<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">\'input\'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>value<span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n          elSubmit<span class="token punctuation">.</span><span class="token function">removeAttr</span><span class="token punctuation">(</span><span class="token string">\'disabled\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>\n          elSubmit<span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">\'disabled\'</span><span class="token punctuation">,</span> <span class="token string">\'disabled\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token punctuation">}</span>\n      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>./lulu.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">\n    <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">\'.range\'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">range</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">\'#color\'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">color</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></code></pre>\n        </div></p>\n<p>这个原型就有点厉害了，市面上估计很难找到这么负责任的原型页面了。实现的动机完全兴趣使然，上面实现了个简单的，就想着要不实现一个真实的，万一以后用得到呢？</p>\n<h2 id="使用方法和-api-1"><a href="#%E4%BD%BF%E7%94%A8%E6%96%B9%E6%B3%95%E5%92%8C-api-1" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>使用方法和 API</h2>\n<p>语法如下：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="14271693152778674000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`new CanvasBarrage(canvas, video, options);`, `14271693152778674000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                js 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">new</span> <span class="token class-name">CanvasBarrage</span><span class="token punctuation">(</span>canvas<span class="token punctuation">,</span> video<span class="token punctuation">,</span> options<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>其中：</p>\n<ul>\n<li>canvas<br>\ncanvas 表示我们的<code class="language-text">&lt;canvas&gt;</code>画布元素，只能是 DOM 元素。</li>\n<li>video<br>\nvideo 表示我们播放的视频元素，只能是 DOM 元素。</li>\n<li>options<br>\noptions 为可选参数，包括：</li>\n</ul>\n<p>\n  <a\n    class="gatsby-resp-image-link"\n    href="/static/2019-12-23-01-49-36-8271c7a2ba6f424e1bb7f514a0927a82-5ee9d.png"\n    style="display: block"\n    target="_blank"\n    rel="noopener"\n  >\n  \n  <span\n    class="gatsby-resp-image-wrapper"\n    style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;"\n  >\n    <span\n      class="gatsby-resp-image-background-image"\n      style="padding-bottom: 95.21103896103897%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAATCAIAAAAf7rriAAAACXBIWXMAAA7DAAAOwwHHb6hkAAACPUlEQVQ4y31T2ZKbMBDk//8tVanK0ya2AQskELpv5Je0sHfD5qIaVZfQqGemh+5yG79fhuswKROVjcYX64u2CRyELuLL129Ch5AeLlbAn9Appa0LIebxTmZKV75tm6BskUob45Qy1jrnfa2PD+x7LWUHupnxTRob0kgoZRtlHDtCWW0DVhcy1k1oqR0XGgB3PqXySLl2sgknHOoH0g/3YSRkojNdwKd5WbkYyXztx2lmy4qrV3IQ7IN3QuJ+jxyFkJzj8zLjXfkwjFidD8i5FeA8uDE4G2JKIUYfY+d8RMHG+QkVswUBEMGt4LhumuidTITM0NDaoEJtXEHNB7paKxqw14pMlEYWVhu1CWmbRkAuTx5jfHWr1lzKE92+7+WAtDuXeVN5XlIzLBTjs0u7i7sNWfukXTyQnjA+teBnPIz90fuBBEKDMK9DysUnPmL+HowAusZVRsKCsqlJ/Rev4PIKTpeb7+8ewbhInWQbbMPvygVPC67aFR9LyCXmRlzMx9rwTrI5BJ/AXHUwILUncw57GJ3n/tYvy0Lu5Hq5UEqv19vb29vYpocIIXBMay2l5Bt/WYW+w0hrMQzwxWAYMNOHteaYHzB8dbm0AvMx2CCnmlVmW1pFmhiyyrDqDBMy8I9uF5iZroPviSfUqz+MeZl87nY4dXtT0IyMJ+hDWb/jyY/mf8Inn7UJ+L8w9phL4wKm3XrwoK031vuYQspnxJR/pS0lOsm1Umj1xtujlMImY2xd15xTbX/ACfv+E1LJLzNPKHZ2AAAAAElFTkSuQmCC\'); background-size: cover; display: block;"\n    >\n      <img\n        class="gatsby-resp-image-image"\n        style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;"\n        alt="2019 12 23 01 49 36"\n        title=""\n        src="/static/2019-12-23-01-49-36-8271c7a2ba6f424e1bb7f514a0927a82-fee1c.png"\n        srcset="/static/2019-12-23-01-49-36-8271c7a2ba6f424e1bb7f514a0927a82-a67b7.png 200w,\n/static/2019-12-23-01-49-36-8271c7a2ba6f424e1bb7f514a0927a82-0b187.png 400w,\n/static/2019-12-23-01-49-36-8271c7a2ba6f424e1bb7f514a0927a82-fee1c.png 800w,\n/static/2019-12-23-01-49-36-8271c7a2ba6f424e1bb7f514a0927a82-b1a91.png 1200w,\n/static/2019-12-23-01-49-36-8271c7a2ba6f424e1bb7f514a0927a82-5ee9d.png 1232w"\n        sizes="(max-width: 800px) 100vw, 800px"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<h2 id="如何修改全局设置和添加弹幕？"><a href="#%E5%A6%82%E4%BD%95%E4%BF%AE%E6%94%B9%E5%85%A8%E5%B1%80%E8%AE%BE%E7%BD%AE%E5%92%8C%E6%B7%BB%E5%8A%A0%E5%BC%B9%E5%B9%95%EF%BC%9F" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>如何修改全局设置和添加弹幕？</h2>\n<p>当我们使用 new CanvasBarrage()构造完我们的弹幕方法后，会返回一个弹幕对象，通过调用这个对象暴露的属性和方法，就可以进行全局的设置和添加弹幕等。例如：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="8463013145733633000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`var myBarrage = new CanvasBarrage(canvas, video, options);`, `8463013145733633000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                js 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">var</span> myBarrage <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CanvasBarrage</span><span class="token punctuation">(</span>canvas<span class="token punctuation">,</span> video<span class="token punctuation">,</span> options<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>如果我们想把弹幕透明度改成 50%透明，可以：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="39593934712413010000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`myBarrage.opacity = 50;`, `39593934712413010000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                js 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js">myBarrage<span class="token punctuation">.</span>opacity <span class="token operator">=</span> <span class="token number">50</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>就这么简单，于是新出现的弹幕都会以 50%透明显示，类似的，弹幕文字大小和颜色，弹幕显示的区域范围都可以通过这样设置，例如：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="6185170948728613000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`myBarrage.fontSize = 20;`, `6185170948728613000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                js 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js">myBarrage<span class="token punctuation">.</span>fontSize <span class="token operator">=</span> <span class="token number">20</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>就是把弹幕文字颜色改成 20px 大小。</p>\n<p>如果我们想动态添加弹幕，可以使用暴露的 add()方法，语法如下：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="29009644639896306000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`myBarrage.add(obj);`, `29009644639896306000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                js 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js">myBarrage<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>其中 obj 的参数类型和支持属性和 options-data 数组中对象一模一样。例如：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="33682702526790443000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`myBarrage.add({\n  value: \'new CanvasBarrage()\',\n  color: \'#ff0000\',\n  time: 0\n});`, `33682702526790443000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                js 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js">myBarrage<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n  value<span class="token punctuation">:</span> <span class="token string">\'new CanvasBarrage()\'</span><span class="token punctuation">,</span>\n  color<span class="token punctuation">:</span> <span class="token string">\'#ff0000\'</span><span class="token punctuation">,</span>\n  time<span class="token punctuation">:</span> <span class="token number">0</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>myBarrage 还暴露了一个名为 reset()方法，可以清除屏幕上所有的弹幕，并重新根据视频时间开始运动与显示。视频点击跳转时候的弹幕处理就是调用的此方法。</p>',
id:"/github/workspace/blog/使用canvas实现和HTML5 video交互的弹幕效果/index.md absPath of file >>> MarkdownRemark",timeToRead:10,frontmatter:{date:"2019-12-21 16:33:45",path:"/html5-canvas-video-barrage/",tags:"前端, JS, JS知识点",title:"使用canvas实现和HTML5 video交互的弹幕效果",draft:null}},{excerpt:"简介 Pointer Lock API 可以让你的鼠标无限移动，脱离浏览器窗体的限制！ API 3 个属性 Document.pointerLockElement Document.onpointerlockchange Document.onpointerlockerror 2 个方法 Element.requestPointerLock() Document.exitPointerLock() 2 个事件 pointerlockchange pointerlockerror 其中，…",html:'<h1 id="简介"><a href="#%E7%AE%80%E4%BB%8B" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>简介</h1>\n<p>Pointer Lock API 可以让你的鼠标无限移动，脱离浏览器窗体的限制！</p>\n<h1 id="api"><a href="#api" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>API</h1>\n<ul>\n<li>3 个属性<br>\nDocument.pointerLockElement<br>\nDocument.onpointerlockchange<br>\nDocument.onpointerlockerror</li>\n<li>2 个方法<br>\nElement.requestPointerLock()<br>\nDocument.exitPointerLock()</li>\n<li>2 个事件<br>\npointerlockchange<br>\npointerlockerror</li>\n</ul>\n<p>其中，2 个事件和其中 2 个属性是一一对应的，因此，我们实际上需要了解的知识点是下面这些： Document.pointerLockElement，以及 Element.requestPointerLock()，Document.exitPointerLock()以及 pointerlockchange 和 pointerlockerror 事件。</p>\n<h2 id="documentpointerlockelement"><a href="#documentpointerlockelement" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Document.pointerLockElement</h2>\n<p>指当前页面触发鼠标无限滚动的元素，通常使用语法为：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="15555793902586456000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`var element = document.pointerLockElement;`, `15555793902586456000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                js 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">var</span> element <span class="token operator">=</span> document<span class="token punctuation">.</span>pointerLockElement<span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>返回的是一个 DOM 元素对象，如果当前页面是非鼠标锁定状态，则返回值是 null。</p>\n<h2 id="elementrequestpointerlock"><a href="#elementrequestpointerlock" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Element.requestPointerLock()</h2>\n<p>可以让页面进入鼠标锁定状态（鼠标直接消失），鼠标无限滚动，坐标无限变化。通常使用语法为：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="60382287695027270000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`var element.requestPointerLock();`, `60382287695027270000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                js 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">var</span> element<span class="token punctuation">.</span><span class="token function">requestPointerLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<h2 id="documentexitpointerlock"><a href="#documentexitpointerlock" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Document.exitPointerLock()</h2>\n<p>让页面从鼠标锁定状态退出，通常使用语法为：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="46577644564886290000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`document.exitPointerLock();`, `46577644564886290000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                j 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="j"><pre style="counter-reset: linenumber NaN" class="language-j line-numbers"><code class="language-j">documen<span class="token adverb builtin">t.</span>exitPointerLock<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token verb keyword">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>浏览器默认支持按下 ESC 键退出鼠标锁定状态，但是用户有时候更习惯于点击取消等，此时就可以使用 document.exitPointerLock()进行设置。</p>\n<h2 id="pointerlockchange-事件"><a href="#pointerlockchange-%E4%BA%8B%E4%BB%B6" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>pointerlockchange 事件</h2>\n<p>当页面鼠标锁定状态改变的时候触发。例如：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="25763009683519013000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`document.addEventListener(\n  \'pointerlockchange\',\n  function() {\n    // ...\n  },\n  false\n);`, `25763009683519013000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                js 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js">document<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span>\n  <span class="token string">\'pointerlockchange\'</span><span class="token punctuation">,</span>\n  <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token comment">// ...</span>\n  <span class="token punctuation">}</span><span class="token punctuation">,</span>\n  <span class="token boolean">false</span>\n<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id="pointerlockerror-事件"><a href="#pointerlockerror-%E4%BA%8B%E4%BB%B6" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>pointerlockerror 事件</h2>\n<p>当页面鼠标锁定失败的时候触发。例如当你试图同时锁定同一个页面的多个<code class="language-text">&lt;iframe&gt;</code>时候，就会触发这个出错事件。</p>\n<h2 id="应用"><a href="#%E5%BA%94%E7%94%A8" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>应用</h2>\n<div>\n          <div\n            class="gatsby-resp-iframe-wrapper"\n            style="padding-bottom: 25%; position: relative; height: 0; overflow: hidden;margin-bottom: 2em"\n          >\n            <iframe src="/examples/js-api-pointer-lock/demo.html" style="\n            position: absolute;\n            top: 0;\n            left: 0;\n            width: 100%;\n            height: 100%;\n          "></iframe>\n          </div>\n          </div>\n<p><div class="gatsby-highlight">\n        <pre class="language-html"><code><span class="token doctype">&lt;!DOCTYPE html></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>en<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>UTF-8<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>viewport<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>width=device-width, initial-scale=1.0<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">http-equiv</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>X-UA-Compatible<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>ie=edge<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span>Document<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">></span></span><span class="token style"><span class="token language-css">\n    <span class="token selector">html,\n    body</span> <span class="token punctuation">{</span>\n      <span class="token property">background-color</span><span class="token punctuation">:</span> white<span class="token punctuation">;</span>\n      <span class="token property">margin</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n\n    <span class="token selector">.box</span> <span class="token punctuation">{</span>\n      <span class="token property">line-height</span><span class="token punctuation">:</span> 400px<span class="token punctuation">;</span>\n      <span class="token property">text-align</span><span class="token punctuation">:</span> center<span class="token punctuation">;</span>\n      <span class="token property">position</span><span class="token punctuation">:</span> relative<span class="token punctuation">;</span>\n      <span class="token property">perspective</span><span class="token punctuation">:</span> 200px<span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n\n    <span class="token selector">.box img</span> <span class="token punctuation">{</span>\n      <span class="token property">vertical-align</span><span class="token punctuation">:</span> middle<span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>box<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>image<span class="token punctuation">"</span></span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>./avatar.png<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">\n    <span class="token keyword">var</span> eleImage <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">\'image\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">if</span> <span class="token punctuation">(</span>eleImage<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token comment">// 起始值</span>\n      <span class="token keyword">var</span> moveX <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> moveY <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>\n      <span class="token comment">// 图片无限变换的方法</span>\n      <span class="token keyword">var</span> <span class="token function-variable function">rotate3D</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        moveX <span class="token operator">=</span> moveX <span class="token operator">+</span> event<span class="token punctuation">.</span>movementX<span class="token punctuation">;</span>\n        moveY <span class="token operator">=</span> moveY <span class="token operator">+</span> event<span class="token punctuation">.</span>movementY<span class="token punctuation">;</span>\n\n        eleImage<span class="token punctuation">.</span>style<span class="token punctuation">.</span>transform <span class="token operator">=</span> <span class="token string">\'rotateX(\'</span> <span class="token operator">+</span> moveY <span class="token operator">+</span> <span class="token string">\'deg) rotateY(\'</span> <span class="token operator">+</span> moveX <span class="token operator">+</span> <span class="token string">\'deg)\'</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n      <span class="token comment">// 触发鼠标锁定</span>\n      eleImage<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">\'click\'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        eleImage<span class="token punctuation">.</span><span class="token function">requestPointerLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n      <span class="token comment">// 再次点击页面，取消鼠标锁定处理</span>\n      document<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">\'click\'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        <span class="token keyword">if</span> <span class="token punctuation">(</span>document<span class="token punctuation">.</span>pointerLockElement <span class="token operator">==</span> eleImage<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n            document<span class="token punctuation">.</span><span class="token function">exitPointerLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token punctuation">}</span>\n      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n      <span class="token comment">// 检测鼠标锁定状态变化</span>\n      document<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">\'pointerlockchange\'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        <span class="token keyword">if</span> <span class="token punctuation">(</span>document<span class="token punctuation">.</span>pointerLockElement <span class="token operator">==</span> eleImage<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n            document<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">"mousemove"</span><span class="token punctuation">,</span> rotate3D<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>\n            document<span class="token punctuation">.</span><span class="token function">removeEventListener</span><span class="token punctuation">(</span><span class="token string">"mousemove"</span><span class="token punctuation">,</span> rotate3D<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token punctuation">}</span>\n      <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></code></pre>\n        </div></p>\n<p>原理大致如下：</p>\n<p>点击图片，执行 eleImage.requestPointerLock()让页面进入鼠标锁定状态，此时会触发 pointerlockchange 事件，于是，给页面绑定鼠标移动改变图片旋转的方法，为了避免重复绑定，我们借助 document.pointerLockElement 判断页面的锁定状态。最后，为了方便取消页面的锁定状态，我们在页面上绑定了点击事件，通过 document.exitPointerLock()取消页面的锁定状态。</p>\n<p>需要说明的：</p>\n<p>event.movementX 和 event.movementY 表示每次 mousemove 事件触发时候，距离上次移动的水平和垂直位置大小，而不是具体的某个坐标值。因此，需要和初始坐标不断的累加确定当前移动位置。</p>\n<h1 id="兼容性"><a href="#%E5%85%BC%E5%AE%B9%E6%80%A7" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>兼容性</h1>\n<p>最后说下 Pointer Lock API 的兼容性。</p>\n<p>由于 Pointer Lock API 是与鼠标相关的 API，因此所有移动端都不支持，因为没有必要支持。</p>\n<p>对于桌面浏览器，Chrome，Firefox 以及 Edge 浏览器都是支持的，并且现在使用可以不加私有前缀，直接走起。IE 并不支持，但这并不妨碍我们进行增强使用 Pointer Lock API。</p>',id:"/github/workspace/blog/鼠标无限移动 JS API Pointer Lock简介/index.md absPath of file >>> MarkdownRemark",timeToRead:2,frontmatter:{date:"2019-12-21 15:57:19",path:"/js-api-pointer-lock/",tags:"前端, JS, JS知识点",title:"鼠标无限移动 JS API Pointer Lock简介",draft:null}},{excerpt:"HTML 与文件下载 如果希望在前端侧直接触发某些资源的下载，最方便快捷的方法就是使用 HTML5 原生的 download 属性，例如： 但显然，如果纯粹利用 HTML 属性来实现文件的下载（而不是浏览器打开或浏览），对于动态内容，就无能为力。 例如，我们对页面进行分享的时候，希望分享图片是页面内容的实时截图，此时，这个图片就是动态的，纯 HTML 显然是无法满足我们的需求的，借助 JS 和其它一些 HTML5 特性，例如，将页面元素转换到 canvas…",html:'<h1 id="html-与文件下载"><a href="#html-%E4%B8%8E%E6%96%87%E4%BB%B6%E4%B8%8B%E8%BD%BD" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>HTML 与文件下载</h1>\n<p>如果希望在前端侧直接触发某些资源的下载，最方便快捷的方法就是使用 HTML5 原生的 download 属性，例如：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="35009151183345046000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`<a href=&quot;large.jpg&quot; download>下载</a>`, `35009151183345046000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                html 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="html"><pre style="counter-reset: linenumber NaN" class="language-html line-numbers"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>large.jpg<span class="token punctuation">"</span></span> <span class="token attr-name">download</span><span class="token punctuation">></span></span>下载<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>但显然，如果纯粹利用 HTML 属性来实现文件的下载（而不是浏览器打开或浏览），对于动态内容，就无能为力。</p>\n<p>例如，我们对页面进行分享的时候，希望分享图片是页面内容的实时截图，此时，这个图片就是动态的，纯 HTML 显然是无法满足我们的需求的，借助 JS 和其它一些 HTML5 特性，例如，将页面元素转换到 canvas 上，然后再转成图片进行下载。</p>\n<p>但本文要介绍的下载不是图片的下载，而是文本信息的下载，所需要使用的 HTML 特性不是 canvas，而是其它。</p>\n<h1 id="借助-html5-blob-实现文本信息文件下载"><a href="#%E5%80%9F%E5%8A%A9-html5-blob-%E5%AE%9E%E7%8E%B0%E6%96%87%E6%9C%AC%E4%BF%A1%E6%81%AF%E6%96%87%E4%BB%B6%E4%B8%8B%E8%BD%BD" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>借助 HTML5 Blob 实现文本信息文件下载</h1>\n<p>原理其实很简单，我们可以将文本或者 JS 字符串信息借助 Blob 转换成二进制，然后，作为<code class="language-text">&lt;a&gt;</code>元素的 href 属性，配合 download 属性，实现下载。</p>\n<p>代码也比较简单，如下示意（兼容 Chrome 和 Firefox）：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="78408820319644220000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`var funDownload = function(content, filename) {\n  // 创建隐藏的可下载链接\n  var eleLink = document.createElement(\'a\');\n  eleLink.download = filename;\n  eleLink.style.display = \'none\';\n  // 字符内容转变成blob地址\n  var blob = new Blob([content]);\n  eleLink.href = URL.createObjectURL(blob);\n  // 触发点击\n  document.body.appendChild(eleLink);\n  eleLink.click();\n  // 然后移除\n  document.body.removeChild(eleLink);\n};`, `78408820319644220000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                js 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">var</span> <span class="token function-variable function">funDownload</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">content<span class="token punctuation">,</span> filename</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token comment">// 创建隐藏的可下载链接</span>\n  <span class="token keyword">var</span> eleLink <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">\'a\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  eleLink<span class="token punctuation">.</span>download <span class="token operator">=</span> filename<span class="token punctuation">;</span>\n  eleLink<span class="token punctuation">.</span>style<span class="token punctuation">.</span>display <span class="token operator">=</span> <span class="token string">\'none\'</span><span class="token punctuation">;</span>\n  <span class="token comment">// 字符内容转变成blob地址</span>\n  <span class="token keyword">var</span> blob <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Blob</span><span class="token punctuation">(</span><span class="token punctuation">[</span>content<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  eleLink<span class="token punctuation">.</span>href <span class="token operator">=</span> <span class="token constant">URL</span><span class="token punctuation">.</span><span class="token function">createObjectURL</span><span class="token punctuation">(</span>blob<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token comment">// 触发点击</span>\n  document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>eleLink<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  eleLink<span class="token punctuation">.</span><span class="token function">click</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token comment">// 然后移除</span>\n  document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">removeChild</span><span class="token punctuation">(</span>eleLink<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>其中，content 指需要下载的文本或字符串内容，filename 指下载到系统中的文件名称。</p>\n<h1 id="借助-base64-实现任意文件下载"><a href="#%E5%80%9F%E5%8A%A9-base64-%E5%AE%9E%E7%8E%B0%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E4%B8%8B%E8%BD%BD" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>借助 Base64 实现任意文件下载</h1>\n<p>对于非文本文件，也是可以直接 JS 触发下载的，例如，如果我们想下载一张图片，可以把这张图片转换成 base64 格式，然后下载。</p>\n<p>代码示意：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="58549917742440630000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`var funDownload = function(domImg, filename) {\n  // 创建隐藏的可下载链接\n  var eleLink = document.createElement(\'a\');\n  eleLink.download = filename;\n  eleLink.style.display = \'none\';\n  // 图片转base64地址\n  var canvas = document.createElement(\'canvas\');\n  var context = canvas.getContext(\'2d\');\n  var width = domImg.naturalWidth;\n  var height = domImg.naturalHeight;\n  context.drawImage(domImg, 0, 0);\n  // 如果是PNG图片，则canvas.toDataURL(\'image/png\')\n  eleLink.href = canvas.toDataURL(\'image/jpeg\');\n  // 触发点击，这里为了兼容Firefox加了appendChild方法\n  document.body.appendChild(eleLink);\n  eleLink.click();\n  // 然后移除\n  document.body.removeChild(eleLink);\n};`, `58549917742440630000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                js 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">var</span> <span class="token function-variable function">funDownload</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">domImg<span class="token punctuation">,</span> filename</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token comment">// 创建隐藏的可下载链接</span>\n  <span class="token keyword">var</span> eleLink <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">\'a\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  eleLink<span class="token punctuation">.</span>download <span class="token operator">=</span> filename<span class="token punctuation">;</span>\n  eleLink<span class="token punctuation">.</span>style<span class="token punctuation">.</span>display <span class="token operator">=</span> <span class="token string">\'none\'</span><span class="token punctuation">;</span>\n  <span class="token comment">// 图片转base64地址</span>\n  <span class="token keyword">var</span> canvas <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">\'canvas\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token keyword">var</span> context <span class="token operator">=</span> canvas<span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token string">\'2d\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token keyword">var</span> width <span class="token operator">=</span> domImg<span class="token punctuation">.</span>naturalWidth<span class="token punctuation">;</span>\n  <span class="token keyword">var</span> height <span class="token operator">=</span> domImg<span class="token punctuation">.</span>naturalHeight<span class="token punctuation">;</span>\n  context<span class="token punctuation">.</span><span class="token function">drawImage</span><span class="token punctuation">(</span>domImg<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token comment">// 如果是PNG图片，则canvas.toDataURL(\'image/png\')</span>\n  eleLink<span class="token punctuation">.</span>href <span class="token operator">=</span> canvas<span class="token punctuation">.</span><span class="token function">toDataURL</span><span class="token punctuation">(</span><span class="token string">\'image/jpeg\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token comment">// 触发点击，这里为了兼容Firefox加了appendChild方法</span>\n  document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>eleLink<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  eleLink<span class="token punctuation">.</span><span class="token function">click</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token comment">// 然后移除</span>\n  document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">removeChild</span><span class="token punctuation">(</span>eleLink<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h1 id="总结"><a href="#%E6%80%BB%E7%BB%93" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>总结</h1>\n<p>不止是.html 文件，.txt, .json 等只要内容是文本的文件，都是可以利用这种小技巧实现下载的。</p>\n<p>在 Chrome 浏览器下，模拟点击创建的<code class="language-text">&lt;a&gt;</code>元素即使不 append 到页面中，也是可以触发下载的，但是在 Firefox 浏览器中却不行，因此，上面的 funDownload()方法有一个 appendChild 和 removeChild 的处理，就是为了兼容 Firefox 浏览器。</p>\n<p>当然，有时对 canvas 图片进行 toDataURL 操作时，会存在跨域问题的报错，具体见<a href="/crossorigin-canvas-getimagedata-cors/">解决 canvas 图片 getImageData,toDataURL 跨域问题</a></p>',
id:"/github/workspace/blog/JS前端创建html或json文件并浏览器导出下载/index.md absPath of file >>> MarkdownRemark",timeToRead:2,frontmatter:{date:"2019-12-15 19:55:53",path:"/js-text-string-download-as-html-json-file/",tags:"前端, JS, JS知识点",title:"JS前端创建html或json文件并浏览器导出下载",draft:null}},{excerpt:"简介 innerText IE6 就开始支持，那个时候，Firefox 浏览器是不支持这个 API 的，一直到 2016 年 3 月份 Firefox 45+才开始支持。 而 textContent IE9 浏览器才开始支持： 由于存在兼容性，因此在开发 PC 端项目的时候获取元素的文本内容都是下面的语句： 久而久之，就误认为 innerText 和 textContent 作用是一样的。 innerText 和 textContent 的不同 调用对象不同 innerText 只有 HTML…",html:'<h1 id="简介"><a href="#%E7%AE%80%E4%BB%8B" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>简介</h1>\n<p>innerText IE6 就开始支持，那个时候，Firefox 浏览器是不支持这个 API 的，一直到 2016 年 3 月份 Firefox 45+才开始支持。</p>\n<p>\n  <a\n    class="gatsby-resp-image-link"\n    href="/static/2019-12-15-19-12-27-712915a13da25a914564f6da376fa683-87f29.png"\n    style="display: block"\n    target="_blank"\n    rel="noopener"\n  >\n  \n  <span\n    class="gatsby-resp-image-wrapper"\n    style="position: relative; display: block; ; max-width: 602px; margin-left: auto; margin-right: auto;"\n  >\n    <span\n      class="gatsby-resp-image-background-image"\n      style="padding-bottom: 43.52159468438538%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAIAAAC9o5sfAAAACXBIWXMAAA7DAAAOwwHHb6hkAAACLklEQVQozyWO609SAQDF79/TFjBapZRDXipv7KGAVl9orWK5sq2PfXSrtWpSG/NRyCSIutCFy+UtT+Mtl+vlfXWgyMsIMKu5PkS5nZ3t/M7OdoBSLlkubBHFVCUXJjD/Dh7cxEyHB+leA+81tvsN/KiZHah3uNvvVHvNXK+eGfDTCmgHFtqh5+2vi/WdZK0cOyhFibyvtZvs7mG/WoV+De9UM91q+ji1fBx5+Xs/cdKt/2zmBtWPZhboxFVH6Eovo9kvR1rVVKOOf2sWUGIDyegDJWgjB7qxz97tT4HQ05DvyWbOsFnxBormYBGqVeMAhmJEsVDOZ9PR0B4axvWvifU3C8ijMzCDCrFpiIDrljKd1+meWY5PwXBOnYNYVCuHArJAswpIFOxYyYOXvemKPxXWr4nIH8ZIyhccmveqyDXLdclGbMJhmDeKiAUuGd8lG3dOX0IEw1+4/rgREFtk990PHnrmJdaZx955BXLvJqxgWyfZjmsSzw2W/coQzJ1wSf/PpDyXfOATbinDKoaDWuCicZz9nsdbEvKt05zFMdKrC6S3Q+dX6SMO0WWb4FRTPoUiPCcP3Blc+EfsIhrEY2tFAJzQ2iJrc5Dylu22ErwrfjfJXRVy9MKzplEyyKSATDLIoFslAoecb5+hmtiDSDYxKR8ZKscz4E+bOGmXwoTFnjeEyhYY05nTGgdm0EXVhtiyKaFZj6mNsZUAagqiZj8K6mNLupjamTJ8r2b+AgVEVYuG4Gm1AAAAAElFTkSuQmCC\'); background-size: cover; display: block;"\n    >\n      <img\n        class="gatsby-resp-image-image"\n        style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;"\n        alt="2019 12 15 19 12 27"\n        title=""\n        src="/static/2019-12-15-19-12-27-712915a13da25a914564f6da376fa683-87f29.png"\n        srcset="/static/2019-12-15-19-12-27-712915a13da25a914564f6da376fa683-38577.png 200w,\n/static/2019-12-15-19-12-27-712915a13da25a914564f6da376fa683-26124.png 400w,\n/static/2019-12-15-19-12-27-712915a13da25a914564f6da376fa683-87f29.png 602w"\n        sizes="(max-width: 602px) 100vw, 602px"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<p>而 textContent IE9 浏览器才开始支持：</p>\n<p>\n  <a\n    class="gatsby-resp-image-link"\n    href="/static/2019-12-15-19-12-49-f4456f037ba86ad459557fc808f78deb-a484c.png"\n    style="display: block"\n    target="_blank"\n    rel="noopener"\n  >\n  \n  <span\n    class="gatsby-resp-image-wrapper"\n    style="position: relative; display: block; ; max-width: 577px; margin-left: auto; margin-right: auto;"\n  >\n    <span\n      class="gatsby-resp-image-background-image"\n      style="padding-bottom: 45.233968804159446%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAIAAAC9o5sfAAAACXBIWXMAAA7DAAAOwwHHb6hkAAACMElEQVQozwElAtr9AObfztjTxdrTxt3WyNzTw9/Vw9rSwODUxczSstndwPPo1fLo1fPp1vPp1vLq2fLr3PLp2fHn0/Lo1fLo1QDw38Pt063u1rHt1rLr38nq4tDp4M3s4dDl38rm4Mvw59Tx59Tt5NDt5NPw3sHx1q/y4MP17d7y6NXx6NUA8tar8sB58sWF88eH69zA59/P6N/N6+PR6eDP6N7M8ujT8ObS5t7M6OHR7tGk8cB28taq+PPr9OrW9OnVAO3k0tzSxOPZyeff0NfQw+bdzOfbxt3QvOvgzN/azdjTxurj0tjQv97WxezgztvNvefayN3Vw9DJuN3SwQDbq5u7UkrCYljZwrbZ1cvd1Mnn18Lk0rzl18Tb1s/f2tHGwbmLh4iQjIzSw7bkzr7jz7+jnJiFgoScl5QAvcufaZ1Mgqlhk8yJcch2i8+HjtGNc8h7k9KQhMyCfct8kMyMXbBoZLNulNCSecx+idCJg8KFVrBkfr+BAJ7Jli6rRkarVEueT0GuUEmhTk2fUEavUUydTkekT0WqUFGcUUuxVEytVEyaTj2rS0GhSVOhVEq0VVOiVAC7zKd3tHOFsntioF1Xsl9apFlfolxbs2BcoFlbqF1cr19enFparl5Yqlt0o2qGvoF/sXden1tZsl9doFoA9enX9+jY/+zftdioh8qFndGVptSdjcuKpdObm9CUk86OrNahks2Oks6O4eTJ++rc+eraqtWgiMqFpNOaLZt8mUJHhnMAAAAASUVORK5CYII=\'); background-size: cover; display: block;"\n    >\n      <img\n        class="gatsby-resp-image-image"\n        style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;"\n        alt="2019 12 15 19 12 49"\n        title=""\n        src="/static/2019-12-15-19-12-49-f4456f037ba86ad459557fc808f78deb-a484c.png"\n        srcset="/static/2019-12-15-19-12-49-f4456f037ba86ad459557fc808f78deb-64be4.png 200w,\n/static/2019-12-15-19-12-49-f4456f037ba86ad459557fc808f78deb-6870d.png 400w,\n/static/2019-12-15-19-12-49-f4456f037ba86ad459557fc808f78deb-a484c.png 577w"\n        sizes="(max-width: 577px) 100vw, 577px"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<p>由于存在兼容性，因此在开发 PC 端项目的时候获取元素的文本内容都是下面的语句：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="26220912472831582000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`var text = dom.innerText || dom.textContent;`, `26220912472831582000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                js 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">var</span> text <span class="token operator">=</span> dom<span class="token punctuation">.</span>innerText <span class="token operator">||</span> dom<span class="token punctuation">.</span>textContent<span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>久而久之，就误认为 innerText 和 textContent 作用是一样的。</p>\n<h1 id="innertext-和-textcontent-的不同"><a href="#innertext-%E5%92%8C-textcontent-%E7%9A%84%E4%B8%8D%E5%90%8C" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>innerText 和 textContent 的不同</h1>\n<h2 id="调用对象不同"><a href="#%E8%B0%83%E7%94%A8%E5%AF%B9%E8%B1%A1%E4%B8%8D%E5%90%8C" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>调用对象不同</h2>\n<p>innerText 只有 HTML 元素才可以调用，但是 textContent 任意 Node 节点都可以：HTMLElement.innerText 和 Node.textContent。</p>\n<h2 id="值获取规则不同"><a href="#%E5%80%BC%E8%8E%B7%E5%8F%96%E8%A7%84%E5%88%99%E4%B8%8D%E5%90%8C" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>值获取规则不同</h2>\n<h3 id="规则差异之块级元素与换行符"><a href="#%E8%A7%84%E5%88%99%E5%B7%AE%E5%BC%82%E4%B9%8B%E5%9D%97%E7%BA%A7%E5%85%83%E7%B4%A0%E4%B8%8E%E6%8D%A2%E8%A1%8C%E7%AC%A6" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>规则差异之块级元素与换行符</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="59264772432051590000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`<p id=&quot;dom&quot;>一段文字内容<span style=&quot;position:absolute;&quot;>...</span></p>`, `59264772432051590000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                html 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="html"><pre style="counter-reset: linenumber NaN" class="language-html line-numbers"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>dom<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>一段文字内容<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span><span class="token style-attr language-css"><span class="token attr-name"> <span class="token attr-name">style</span></span><span class="token punctuation">="</span><span class="token attr-value"><span class="token property">position</span><span class="token punctuation">:</span>absolute<span class="token punctuation">;</span></span><span class="token punctuation">"</span></span><span class="token punctuation">></span></span>...<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>实时效果如下：</p>\n<p>一段文字内容…</p>\n<p>可以看到设置了 position:absolute 的<code class="language-text">&lt;span&gt;</code>元素里面的点点点…和前面的文字内容是紧密连接在一起的，前后没有任何空格。</p>\n<p>但是，当我们分别获取 id=“dom”的<code class="language-text">&lt;p&gt;</code>元素的 innerText 和 textContent 值的时候，有意思的事情发生了，innerText 的返回值居然在点点点前面出现了一个空格。</p>\n<p>如下截图所示：</p>\n<p>\n  <a\n    class="gatsby-resp-image-link"\n    href="/static/2019-12-15-19-14-52-d030d60bd6948b7084102abb379d2560-acb24.png"\n    style="display: block"\n    target="_blank"\n    rel="noopener"\n  >\n  \n  <span\n    class="gatsby-resp-image-wrapper"\n    style="position: relative; display: block; ; max-width: 399px; margin-left: auto; margin-right: auto;"\n  >\n    <span\n      class="gatsby-resp-image-background-image"\n      style="padding-bottom: 44.3609022556391%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAIAAAC9o5sfAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABIklEQVQoz41Q247CIBT0/3/Jh22y3VfrZWPimigKtXhptbW2cCiwI41ZfTDZyUAPE+YMpwNrbasMUUfmQXpHQxpfi2WMbZp24O7mruvQxBqDwoQDZNfDPui8d0Quz62/43Q6DaCTcefzeb1apUIwtq6q0r9DFHkpXSjzPIfZKd21Sl2vFXi5XKAeDoeyLIlIa30D6vqqlBbCD4ewhUcEM+qmJdxeLn/G4wSM468o+pjP58fjcb/f73Y7KSXnvAgP7mf5S251h0ApM9xDF+yLxWKz2RRFgVTsGAoT1vXNB9urWZlMyulk8j2bJeNkNBp9xvF0OsmyDB7E9vlFXrgnM5qGmck65/+P3nz/201zY2zLueBP2G6hcCFexF7pkaYpY+wX4/L92KjoN1AAAAAASUVORK5CYII=\'); background-size: cover; display: block;"\n    >\n      <img\n        class="gatsby-resp-image-image"\n        style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;"\n        alt="2019 12 15 19 14 52"\n        title=""\n        src="/static/2019-12-15-19-14-52-d030d60bd6948b7084102abb379d2560-acb24.png"\n        srcset="/static/2019-12-15-19-14-52-d030d60bd6948b7084102abb379d2560-ff279.png 200w,\n/static/2019-12-15-19-14-52-d030d60bd6948b7084102abb379d2560-acb24.png 399w"\n        sizes="(max-width: 399px) 100vw, 399px"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<h4 id="差异的原因"><a href="#%E5%B7%AE%E5%BC%82%E7%9A%84%E5%8E%9F%E5%9B%A0" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>差异的原因</h4>\n<p>实际上是 innerText 会保留块级元素的换行特性，以换行符形式呈现。在 HTML 中，如果 white-space 不是 pre 或 pre-wrap 则会表现为空格。也就是下图中的空格实际上是换行符：</p>\n<p>\n  <a\n    class="gatsby-resp-image-link"\n    href="/static/2019-12-15-19-15-46-d030d60bd6948b7084102abb379d2560-acb24.png"\n    style="display: block"\n    target="_blank"\n    rel="noopener"\n  >\n  \n  <span\n    class="gatsby-resp-image-wrapper"\n    style="position: relative; display: block; ; max-width: 399px; margin-left: auto; margin-right: auto;"\n  >\n    <span\n      class="gatsby-resp-image-background-image"\n      style="padding-bottom: 44.3609022556391%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAIAAAC9o5sfAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABIklEQVQoz41Q247CIBT0/3/Jh22y3VfrZWPimigKtXhptbW2cCiwI41ZfTDZyUAPE+YMpwNrbasMUUfmQXpHQxpfi2WMbZp24O7mruvQxBqDwoQDZNfDPui8d0Quz62/43Q6DaCTcefzeb1apUIwtq6q0r9DFHkpXSjzPIfZKd21Sl2vFXi5XKAeDoeyLIlIa30D6vqqlBbCD4ewhUcEM+qmJdxeLn/G4wSM468o+pjP58fjcb/f73Y7KSXnvAgP7mf5S251h0ApM9xDF+yLxWKz2RRFgVTsGAoT1vXNB9urWZlMyulk8j2bJeNkNBp9xvF0OsmyDB7E9vlFXrgnM5qGmck65/+P3nz/201zY2zLueBP2G6hcCFexF7pkaYpY+wX4/L92KjoN1AAAAAASUVORK5CYII=\'); background-size: cover; display: block;"\n    >\n      <img\n        class="gatsby-resp-image-image"\n        style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;"\n        alt="2019 12 15 19 15 46"\n        title=""\n        src="/static/2019-12-15-19-15-46-d030d60bd6948b7084102abb379d2560-acb24.png"\n        srcset="/static/2019-12-15-19-15-46-d030d60bd6948b7084102abb379d2560-ff279.png 200w,\n/static/2019-12-15-19-15-46-d030d60bd6948b7084102abb379d2560-acb24.png 399w"\n        sizes="(max-width: 399px) 100vw, 399px"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<p>例如，我们设置呈现结果的父元素 white-space:pre，则会出现下图所示的效果：</p>\n<p>\n  <a\n    class="gatsby-resp-image-link"\n    href="/static/2019-12-15-19-16-09-7ba098ddd5899f48eb349b85f05022d4-a3cb3.png"\n    style="display: block"\n    target="_blank"\n    rel="noopener"\n  >\n  \n  <span\n    class="gatsby-resp-image-wrapper"\n    style="position: relative; display: block; ; max-width: 336px; margin-left: auto; margin-right: auto;"\n  >\n    <span\n      class="gatsby-resp-image-background-image"\n      style="padding-bottom: 52.976190476190474%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABb0lEQVQoz42RbW+CMBSF/f//xcRNJSEkxBn9wABj5E3xZXNTRCIgRQRKobvAdM4t2Z6QG9qb03Nu2yCEZIRQSosKWpH/BcY4juNGRvI4yTBOYZGmZU2S5HrWT0AJXYTQarVqEJKnuNhuNqZpLpfLxWKhqmpGsmuKO+r9MAwrcV7EaZkd4yyDgjE4R9E5iqI6C/RAUPegkmrGTzEc5PnIcfaGpgyfRUEYPvUHD+1Os9USRHG33zuHw2q9nlVMp1NN077EeV6czilCge+5h/WbjwJ3tzs4jmvbR8c5um7oulkQ5DBeBZh/i52k0KjCDAYhw1BdpyxLJYkKQsFxVJaj8difz29f5OJcUHSKPc+dL0zz5VVuP77zfNBsejzv93qo0zlPJraiWONxKYacd+IARZa1HY1kAwbSdYnjRJYVGUbqdpVeb9bvW7IMd/jbbROIndN/cxXDuzbASlWh6JVriQbry1fu1j83GIYxgVls+wPqMWI43OL0OgAAAABJRU5ErkJggg==\'); background-size: cover; display: block;"\n    >\n      <img\n        class="gatsby-resp-image-image"\n        style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;"\n        alt="2019 12 15 19 16 09"\n        title=""\n        src="/static/2019-12-15-19-16-09-7ba098ddd5899f48eb349b85f05022d4-a3cb3.png"\n        srcset="/static/2019-12-15-19-16-09-7ba098ddd5899f48eb349b85f05022d4-d9b8e.png 200w,\n/static/2019-12-15-19-16-09-7ba098ddd5899f48eb349b85f05022d4-a3cb3.png 336w"\n        sizes="(max-width: 336px) 100vw, 336px"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<p>在本例中，虽然<code class="language-text">&lt;span&gt;</code>元素是内联元素，但由于设置了 position:absolute 使其 display 计算值变成了 block，因此，虽然视觉上没有换行，但 innerText 获取的时候依旧产生了换行，导致空格出现。</p>\n<h3 id="规则差异之隐藏元素的获取与否"><a href="#%E8%A7%84%E5%88%99%E5%B7%AE%E5%BC%82%E4%B9%8B%E9%9A%90%E8%97%8F%E5%85%83%E7%B4%A0%E7%9A%84%E8%8E%B7%E5%8F%96%E4%B8%8E%E5%90%A6" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>规则差异之隐藏元素的获取与否</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="90505618899037340000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`<p id=&quot;dom2&quot;>我后面有一段隐藏文字<span hidden>，就是我啦！</span></p>`, `90505618899037340000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                html 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="html"><pre style="counter-reset: linenumber NaN" class="language-html line-numbers"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>dom2<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>我后面有一段隐藏文字<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">hidden</span><span class="token punctuation">></span></span>，就是我啦！<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>\n  <a\n    class="gatsby-resp-image-link"\n    href="/static/2019-12-15-19-17-21-c6525c2a0f382a1b4efa2de20a5a85e0-1857e.png"\n    style="display: block"\n    target="_blank"\n    rel="noopener"\n  >\n  \n  <span\n    class="gatsby-resp-image-wrapper"\n    style="position: relative; display: block; ; max-width: 448px; margin-left: auto; margin-right: auto;"\n  >\n    <span\n      class="gatsby-resp-image-background-image"\n      style="padding-bottom: 38.839285714285715%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAIAAAB2/0i6AAAACXBIWXMAAA7DAAAOwwHHb6hkAAABF0lEQVQY052Py26DMBBF/f+/kx/IIhsWoSUPAi4YPwgQSGrCw3bjgusmLULprkej0ZVm5mou0Howd8ZxNL8Mf7F7s7op1XUdkErXdV2WpRD9QzRNo7We2819HwgpKWOgF4oQgjFu2jbLMgihvVdKPW2bpjHn809dLpIxRikQ6natOaEkRpHv+67rhmHIObd2VuR5XlWVHwRssbj6vimKMctMWcrVikEIhLydqxITTAlBcRwEgX3kcqcoChukbdv8dOLr9QeEGiEZhkOSCNdlSQK6XhKSvLx6293O22yWy6XjOJRShNDhcEjT1Fp4nveG0DvnCOPtfh8jxOs6PR7B52D+gZTfqUEIrWk8EUXRXE9Mo0e36exTX3riuySRUlyhAAAAAElFTkSuQmCC\'); background-size: cover; display: block;"\n    >\n      <img\n        class="gatsby-resp-image-image"\n        style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;"\n        alt="2019 12 15 19 17 21"\n        title=""\n        src="/static/2019-12-15-19-17-21-c6525c2a0f382a1b4efa2de20a5a85e0-1857e.png"\n        srcset="/static/2019-12-15-19-17-21-c6525c2a0f382a1b4efa2de20a5a85e0-15195.png 200w,\n/static/2019-12-15-19-17-21-c6525c2a0f382a1b4efa2de20a5a85e0-82e6d.png 400w,\n/static/2019-12-15-19-17-21-c6525c2a0f382a1b4efa2de20a5a85e0-1857e.png 448w"\n        sizes="(max-width: 448px) 100vw, 448px"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<p>可以看到，display:none 元素是无法使用 innerText 获取的，但是 textContent 却可以，无论元素隐藏与否。</p>\n<h3 id="规则差异之性能与回流"><a href="#%E8%A7%84%E5%88%99%E5%B7%AE%E5%BC%82%E4%B9%8B%E6%80%A7%E8%83%BD%E4%B8%8E%E5%9B%9E%E6%B5%81" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>规则差异之性能与回流</h3>\n<p>此外，由于 innerText 属性值的获取会考虑 CSS 样式，因此读取 innerText 的值将触发回流以确保计算出的样式是最新的，而回流在计算上很昂贵，会降低性能，因此应尽可能避免回流。而 textContent 只是单纯读取文本内容，因此性能更高。</p>\n<h3 id="ie-浏览器不符合上面规则"><a href="#ie-%E6%B5%8F%E8%A7%88%E5%99%A8%E4%B8%8D%E7%AC%A6%E5%90%88%E4%B8%8A%E9%9D%A2%E8%A7%84%E5%88%99" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>IE 浏览器不符合上面规则</h3>\n<p>但是在 IE 浏览器下，innerText 的表现和规范是不符的，最终表现为 textContent 属性一样的效果，也就是没有空格，也不会不显示隐藏元素，例如下面 IE11 下的效果截图：</p>\n<p>\n  <a\n    class="gatsby-resp-image-link"\n    href="/static/2019-12-15-19-19-22-573fe8c5406b0174c2679e9f75079781-0208c.png"\n    style="display: block"\n    target="_blank"\n    rel="noopener"\n  >\n  \n  <span\n    class="gatsby-resp-image-wrapper"\n    style="position: relative; display: block; ; max-width: 493px; margin-left: auto; margin-right: auto;"\n  >\n    <span\n      class="gatsby-resp-image-background-image"\n      style="padding-bottom: 74.2393509127789%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAIAAABr+ngCAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAB6UlEQVQoz4VS23KbMBT0//9MHtrHPNZPcVMXgwsECgaBQFgCxMXc6WIyiZ2m0x2NZjmw56xWbPKyI0l1oqnPCsrrz5e40Kylsl/WSvKeJnJT1l3E6+97zT7RvBqEbHjeiNslW87L7Lef63aumbnl5aqZ2r5D4s00jl2H1Xdd17btMAzjFdMKkHkepGwUpX18bB8emv2+//ol234LGNvg/TDOsijO53NEaVEU8zxDNd9immQc8yAQlIowBCk5T7MM4qntBsYYIb7rnnRdPxwOhARCiCzLOOdo2vf9faulNd5uQJtu8H1i6L80Tft5heM4URTBhZQSH+FE0w1wqFfxdfLoOg40qqru9z+2261yOECMmXEcgyCLzycv4n7kXERxFDOGT4MAWTCMba64XC5I8Z/ibpjGDwn9hVXw5vz9zAiMBAHOiXgIISAw/N9G77YZS+A2jpnnnWzbPp85bNd1XVUV0qquQObYy7JE5S5tTH4xTVXTnp+fd09PuDPA8zwYQeBoF4Yh2mF3XRcViNM0fU0bF2sYhmW9GIauKIplWUgOUcM/5oPj2pEc9iRJULm7Kt/3j8ejbhiaqu52O9M0MZNSChnmwAUawTAeUV//wmUySkFI0U/wBeiNKshSEWIlbxUYWQnuEhn9AVlFSfB2gZz+AAAAAElFTkSuQmCC\'); background-size: cover; display: block;"\n    >\n      <img\n        class="gatsby-resp-image-image"\n        style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;"\n        alt="2019 12 15 19 19 22"\n        title=""\n        src="/static/2019-12-15-19-19-22-573fe8c5406b0174c2679e9f75079781-0208c.png"\n        srcset="/static/2019-12-15-19-19-22-573fe8c5406b0174c2679e9f75079781-1777c.png 200w,\n/static/2019-12-15-19-19-22-573fe8c5406b0174c2679e9f75079781-1db89.png 400w,\n/static/2019-12-15-19-19-22-573fe8c5406b0174c2679e9f75079781-0208c.png 493w"\n        sizes="(max-width: 493px) 100vw, 493px"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<p>另外，与 textContent 不同，在 Internet Explorer（版本 11 及以下）中更改 innerText 将从元素中移除子节点，并永久销毁所有子文本节点。不可能再将节点插入任何其他元素或同一元素中。</p>\n<h1 id="结论"><a href="#%E7%BB%93%E8%AE%BA" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>结论</h1>\n<p>innerText 由于存在诸多特别的特性、以及兼容性差异，以及性能方面问题，以及实际开发的需求的考量，不推荐使用，推荐使用 textContent 获取文本内容。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="70136623397014340000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`var text = dom.textContent;`, `70136623397014340000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                js 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">var</span> text <span class="token operator">=</span> dom<span class="token punctuation">.</span>textContent<span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>如果你的项目还需要兼容 IE8 浏览器，则使用下面的代码：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="74935961409333920000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`var text = dom.textContent || dom.innerText;`, `74935961409333920000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                js 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">var</span> text <span class="token operator">=</span> dom<span class="token punctuation">.</span>textContent <span class="token operator">||</span> dom<span class="token punctuation">.</span>innerText<span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>另外，如果你要在一个 DOM 元素中改变文字内容，推荐使用 textContent，而不是 innerHTML，性能会更高一点。</p>',id:"/github/workspace/blog/JS DOM innerText和textContent的区别/index.md absPath of file >>> MarkdownRemark",timeToRead:4,frontmatter:{date:"2019-12-15 19:11:45",path:"/js-dom-innertext-textcontent/",tags:"前端, JS, JS知识点",title:"JS DOM innerText和textContent的区别",draft:null}}],length:31,tag:"JS",pagesSum:7,page:4}}}});