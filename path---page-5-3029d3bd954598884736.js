webpackJsonp([0x9e7fb4e3147],{1214:function(n,s){n.exports={data:{site:{siteMetadata:{description:'前端工程师，黑猫女王控，欢迎勾搭，技术相关<a href="https://github.com/towavephone" target="_blank">@towavephone</a>，QQ闲聊<a href="tencent://AddContact/?fromId=45&fromSubId=1&subcmd=all&uin=634407147&website=www.oicqzone.com">@towave</a>，bili关注<a href="https://space.bilibili.com/11507708#/" target="_blank">@towave</a>',siteUrl:"https://blog.towavephone.com"}}},pathContext:{posts:[{excerpt:"示例 思路 对于这个简单的案例来说，如果我们把它用 generator 函数表达，会是怎么样的呢？ 我们知道，generator 函数是不会自动执行的，每一次调用它的 next 方法，会停留在下一个 yield 的位置。 利用这个特性，我们只要编写一个自动执行的函数，就可以让这个 generator 函数完全实现 async 函数的功能。 那么大体上的思路已经确定了，asyncToGenerator 接受一个 generator 函数，返回一个 promise， 关键就在于，里面用 yield…",html:'<h1 id="示例"><a href="#%E7%A4%BA%E4%BE%8B" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>示例</h1>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="66293425011830284000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`const getData = () => new Promise((resolve) => setTimeout(() => resolve(\'data\'), 1000));\n\nasync function test() {\n  const data = await getData();\n  console.log(\'data: \', data);\n  const data2 = await getData();\n  console.log(\'data2: \', data2);\n  return \'success\';\n}\n\n// 这样的一个函数 应该再1秒后打印data 再过一秒打印data2 最后打印success\ntest().then((res) => console.log(res));`, `66293425011830284000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                js 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">const</span> <span class="token function-variable function">getData</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">\'data\'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">const</span> data <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">getData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">\'data: \'</span><span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token keyword">const</span> data2 <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">getData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">\'data2: \'</span><span class="token punctuation">,</span> data2<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token keyword">return</span> <span class="token string">\'success\'</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token comment">// 这样的一个函数 应该再1秒后打印data 再过一秒打印data2 最后打印success</span>\n<span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=></span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h1 id="思路"><a href="#%E6%80%9D%E8%B7%AF" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>思路</h1>\n<p>对于这个简单的案例来说，如果我们把它用 generator 函数表达，会是怎么样的呢？</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="2638640449816454000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`function* testG() {\n  // await被编译成了yield\n  const data = yield getData();\n  console.log(\'data: \', data);\n  const data2 = yield getData();\n  console.log(\'data2: \', data2);\n  return \'success\';\n}`, `2638640449816454000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                js 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">function</span><span class="token operator">*</span> <span class="token function">testG</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token comment">// await被编译成了yield</span>\n  <span class="token keyword">const</span> data <span class="token operator">=</span> <span class="token keyword">yield</span> <span class="token function">getData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">\'data: \'</span><span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token keyword">const</span> data2 <span class="token operator">=</span> <span class="token keyword">yield</span> <span class="token function">getData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">\'data2: \'</span><span class="token punctuation">,</span> data2<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token keyword">return</span> <span class="token string">\'success\'</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>我们知道，generator 函数是不会自动执行的，每一次调用它的 next 方法，会停留在下一个 yield 的位置。</p>\n<p>利用这个特性，我们只要编写一个自动执行的函数，就可以让这个 generator 函数完全实现 async 函数的功能。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="88266867712384190000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`const getData = () => new Promise((resolve) => setTimeout(() => resolve(\'data\'), 1000));\n\nvar test = asyncToGenerator(function* testG() {\n  // await被编译成了yield\n  const data = yield getData();\n  console.log(\'data: \', data);\n  const data2 = yield getData();\n  console.log(\'data2: \', data2);\n  return \'success\';\n});\n\ntest().then((res) => console.log(res));`, `88266867712384190000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                js 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">const</span> <span class="token function-variable function">getData</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">\'data\'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token keyword">var</span> test <span class="token operator">=</span> <span class="token function">asyncToGenerator</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token operator">*</span> <span class="token function">testG</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token comment">// await被编译成了yield</span>\n  <span class="token keyword">const</span> data <span class="token operator">=</span> <span class="token keyword">yield</span> <span class="token function">getData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">\'data: \'</span><span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token keyword">const</span> data2 <span class="token operator">=</span> <span class="token keyword">yield</span> <span class="token function">getData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">\'data2: \'</span><span class="token punctuation">,</span> data2<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token keyword">return</span> <span class="token string">\'success\'</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=></span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>那么大体上的思路已经确定了，asyncToGenerator 接受一个 generator 函数，返回一个 promise，</p>\n<p>关键就在于，里面用 yield 来划分的异步流程，应该如何自动执行。</p>\n<h1 id="如果是手动执行"><a href="#%E5%A6%82%E6%9E%9C%E6%98%AF%E6%89%8B%E5%8A%A8%E6%89%A7%E8%A1%8C" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>如果是手动执行</h1>\n<p>在编写这个函数之前，我们先模拟手动去调用这个 generator 函数去一步步的把流程走完，有助于后面的思考。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="8338890657421838000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`function* testG() {\n  // await被编译成了yield\n  const data = yield getData();\n  console.log(\'data: \', data);\n  const data2 = yield getData();\n  console.log(\'data2: \', data2);\n  return \'success\';\n}`, `8338890657421838000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                js 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">function</span><span class="token operator">*</span> <span class="token function">testG</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token comment">// await被编译成了yield</span>\n  <span class="token keyword">const</span> data <span class="token operator">=</span> <span class="token keyword">yield</span> <span class="token function">getData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">\'data: \'</span><span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token keyword">const</span> data2 <span class="token operator">=</span> <span class="token keyword">yield</span> <span class="token function">getData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">\'data2: \'</span><span class="token punctuation">,</span> data2<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token keyword">return</span> <span class="token string">\'success\'</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>我们先调用 testG 生成一个迭代器</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="85246272894734100000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 返回了一个迭代器\nvar gen = testG();`, `85246272894734100000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                js 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// 返回了一个迭代器</span>\n<span class="token keyword">var</span> gen <span class="token operator">=</span> <span class="token function">testG</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p>然后开始执行第一次 next</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="68276249754620854000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// 第一次调用next 停留在第一个yield的位置\n// 返回的promise里 包含了data需要的数据\nvar dataPromise = gen.next();`, `68276249754620854000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                js 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// 第一次调用next 停留在第一个yield的位置</span>\n<span class="token comment">// 返回的promise里 包含了data需要的数据</span>\n<span class="token keyword">var</span> dataPromise <span class="token operator">=</span> gen<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>这里返回了一个 promise，就是第一次 getData()所返回的 promise，注意</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="77692531911542930000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`const data = yield getData()`, `77692531911542930000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                js 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">const</span> data <span class="token operator">=</span> <span class="token keyword">yield</span> <span class="token function">getData</span><span class="token punctuation">(</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>这段代码要切割成左右两部分来看，第一次调用 next，其实只是停留在了 yield getData()这里，data 的值并没有被确定。</p>\n<p>那么什么时候 data 的值会被确定呢？</p>\n<p>下一次调用 next 的时候，传的参数会被作为上一个 yield 前面接受的值，也就是说，我们再次调用 gen.next(‘这个参数才会被赋给 data 变量’)的时候，data 的值才会被确定为’这个参数才会被赋给 data 变量’</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="41170302742017340000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`gen.next(\'这个参数才会被赋给data变量\')\n\n// 然后这里的data才有值\nconst data = yield getData()\n\n// 然后打印出data\nconsole.log(\'data: \', data);\n\n// 然后继续走到下一个yield\nconst data2 = yield getData()`, `41170302742017340000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                js 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js">gen<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token string">\'这个参数才会被赋给data变量\'</span><span class="token punctuation">)</span>\n\n<span class="token comment">// 然后这里的data才有值</span>\n<span class="token keyword">const</span> data <span class="token operator">=</span> <span class="token keyword">yield</span> <span class="token function">getData</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n\n<span class="token comment">// 然后打印出data</span>\nconsole<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">\'data: \'</span><span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token comment">// 然后继续走到下一个yield</span>\n<span class="token keyword">const</span> data2 <span class="token operator">=</span> <span class="token keyword">yield</span> <span class="token function">getData</span><span class="token punctuation">(</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>然后往下执行，直到遇到下一个 yield，继续这样的流程…</p>\n<p>这是 generator 函数设计的一个比较难理解的点，但是为了实现我们的目标，还是得去学习它~</p>\n<p>借助这个特性，如果我们这样去控制 yield 的流程，是不是就能实现异步串行了？</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="12057620139573477000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`function* testG() {\n  // await被编译成了yield\n  const data = yield getData();\n  console.log(\'data: \', data);\n  const data2 = yield getData();\n  console.log(\'data2: \', data2);\n  return \'success\';\n}\n\nvar gen = testG();\n\nvar dataPromise = gen.next();\n\ndataPromise.then((value1) => {\n  // data1的value被拿到了 继续调用next并且传递给data\n  var data2Promise = gen.next(value1);\n\n  // console.log(\'data: \', data);\n  // 此时就会打印出data\n\n  data2Promise.value.then((value2) => {\n    // data2的value拿到了 继续调用next并且传递value2\n    gen.next(value2);\n\n    // console.log(\'data2: \', data2);\n    // 此时就会打印出data2\n  });\n});`, `12057620139573477000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                js 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">function</span><span class="token operator">*</span> <span class="token function">testG</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token comment">// await被编译成了yield</span>\n  <span class="token keyword">const</span> data <span class="token operator">=</span> <span class="token keyword">yield</span> <span class="token function">getData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">\'data: \'</span><span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token keyword">const</span> data2 <span class="token operator">=</span> <span class="token keyword">yield</span> <span class="token function">getData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">\'data2: \'</span><span class="token punctuation">,</span> data2<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token keyword">return</span> <span class="token string">\'success\'</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">var</span> gen <span class="token operator">=</span> <span class="token function">testG</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token keyword">var</span> dataPromise <span class="token operator">=</span> gen<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\ndataPromise<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">value1</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n  <span class="token comment">// data1的value被拿到了 继续调用next并且传递给data</span>\n  <span class="token keyword">var</span> data2Promise <span class="token operator">=</span> gen<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span>value1<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n  <span class="token comment">// console.log(\'data: \', data);</span>\n  <span class="token comment">// 此时就会打印出data</span>\n\n  data2Promise<span class="token punctuation">.</span>value<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">value2</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n    <span class="token comment">// data2的value拿到了 继续调用next并且传递value2</span>\n    gen<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span>value2<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token comment">// console.log(\'data2: \', data2);</span>\n    <span class="token comment">// 此时就会打印出data2</span>\n  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>这样的一个看着像 callback hell 的调用，就可以让我们的 generator 函数把异步安排的明明白白。</p>\n<h1 id="实现"><a href="#%E5%AE%9E%E7%8E%B0" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>实现</h1>\n<p>有了这样的思路，实现这个高阶函数就变得很简单了。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="58058999523536680000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`function asyncToGenerator(generatorFunc) {\n  // 返回的是一个新的函数\n  return function() {\n    // 先调用 generator 函数 生成迭代器\n    // 对应 var gen = testG()\n    const gen = generatorFunc.apply(this, arguments);\n\n    // 返回一个 promise 因为外部是用 .then 的方式 或者 await 的方式去使用这个函数的返回值的\n    // var test = asyncToGenerator(testG)\n    // test().then(res => console.log(res))\n    return new Promise((resolve, reject) => {\n      // 内部定义一个 step 函数，用来一步一步的跨过 yield 的阻碍\n      // key 有 next 和 throw 两种取值，分别对应了 gen 的 next 和 throw 方法\n      // arg 参数则是用来把 promise resolve 出来的值交给下一个 yield\n      function step(key, arg) {\n        let generatorResult;\n\n        // 这个方法需要包裹在 try catch 中\n        // 如果报错了 就把 promise 给 reject 掉 外部通过 .catch 可以获取到错误\n        try {\n          generatorResult = gen[key](arg);\n        } catch (error) {\n          return reject(error);\n        }\n\n        // gen.next() 得到的结果是一个 { value, done } 的结构\n        const { value, done } = generatorResult;\n\n        if (done) {\n          // 如果已经完成了，就直接 resolve 这个 promise\n          // 这个 done 是在最后一次调用 next 后才会为 true\n          // 以本文的例子来说，此时的结果是 { done: true, value: \'success\' }\n          // 这个 value 也就是 generator 函数最后的返回值\n          return resolve(value);\n        } else {\n          // 除了最后结束的时候外，每次调用 gen.next()\n          // 其实是返回 { value: Promise, done: false } 的结构\n          // 这里要注意的是 Promise.resolve 可以接受一个 promise 为参数\n          // 并且这个 promise 参数被 resolve 的时候，这个 then 才会被调用\n          return Promise.resolve(\n            // 这个 value 对应的是 yield 后面的 promise\n            value\n          ).then(\n            // value 这个 promise 被 resolve 的时候，就会执行 next\n            // 并且只要 done 不是 true 的时候，就会递归的往下解开 promise，对应\n            // gen.next().value.then(value => {\n            //    gen.next(value).value.then(value2 => {\n            //       gen.next()\n            //\n            //      // 此时 done 为 true 了，整个 promise 被 resolve 了\n            //      // 最外部的 test().then(res => console.log(res)) 的 then 就开始执行了\n            //    })\n            // })\n            function onResolve(val) {\n              step(\'next\', val);\n            },\n            // 如果 promise 被 reject 了，就再次进入 step 函数\n            // 不同的是，这次的 try catch 中调用的是 gen.throw(err)\n            // 那么自然就被 catch 到，然后把 promise 给 reject 掉啦\n            function onReject(err) {\n              step(\'throw\', err);\n            }\n          );\n        }\n      }\n      step(\'next\');\n    });\n  };\n}`, `58058999523536680000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                js 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">function</span> <span class="token function">asyncToGenerator</span><span class="token punctuation">(</span><span class="token parameter">generatorFunc</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token comment">// 返回的是一个新的函数</span>\n  <span class="token keyword">return</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token comment">// 先调用 generator 函数 生成迭代器</span>\n    <span class="token comment">// 对应 var gen = testG()</span>\n    <span class="token keyword">const</span> gen <span class="token operator">=</span> <span class="token function">generatorFunc</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> arguments<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n    <span class="token comment">// 返回一个 promise 因为外部是用 .then 的方式 或者 await 的方式去使用这个函数的返回值的</span>\n    <span class="token comment">// var test = asyncToGenerator(testG)</span>\n    <span class="token comment">// test().then(res => console.log(res))</span>\n    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n      <span class="token comment">// 内部定义一个 step 函数，用来一步一步的跨过 yield 的阻碍</span>\n      <span class="token comment">// key 有 next 和 throw 两种取值，分别对应了 gen 的 next 和 throw 方法</span>\n      <span class="token comment">// arg 参数则是用来把 promise resolve 出来的值交给下一个 yield</span>\n      <span class="token keyword">function</span> <span class="token function">step</span><span class="token punctuation">(</span><span class="token parameter">key<span class="token punctuation">,</span> arg</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        <span class="token keyword">let</span> generatorResult<span class="token punctuation">;</span>\n\n        <span class="token comment">// 这个方法需要包裹在 try catch 中</span>\n        <span class="token comment">// 如果报错了 就把 promise 给 reject 掉 外部通过 .catch 可以获取到错误</span>\n        <span class="token keyword">try</span> <span class="token punctuation">{</span>\n          generatorResult <span class="token operator">=</span> gen<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">(</span>arg<span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n          <span class="token keyword">return</span> <span class="token function">reject</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token punctuation">}</span>\n\n        <span class="token comment">// gen.next() 得到的结果是一个 { value, done } 的结构</span>\n        <span class="token keyword">const</span> <span class="token punctuation">{</span> value<span class="token punctuation">,</span> done <span class="token punctuation">}</span> <span class="token operator">=</span> generatorResult<span class="token punctuation">;</span>\n\n        <span class="token keyword">if</span> <span class="token punctuation">(</span>done<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n          <span class="token comment">// 如果已经完成了，就直接 resolve 这个 promise</span>\n          <span class="token comment">// 这个 done 是在最后一次调用 next 后才会为 true</span>\n          <span class="token comment">// 以本文的例子来说，此时的结果是 { done: true, value: \'success\' }</span>\n          <span class="token comment">// 这个 value 也就是 generator 函数最后的返回值</span>\n          <span class="token keyword">return</span> <span class="token function">resolve</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>\n          <span class="token comment">// 除了最后结束的时候外，每次调用 gen.next()</span>\n          <span class="token comment">// 其实是返回 { value: Promise, done: false } 的结构</span>\n          <span class="token comment">// 这里要注意的是 Promise.resolve 可以接受一个 promise 为参数</span>\n          <span class="token comment">// 并且这个 promise 参数被 resolve 的时候，这个 then 才会被调用</span>\n          <span class="token keyword">return</span> Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>\n            <span class="token comment">// 这个 value 对应的是 yield 后面的 promise</span>\n            value\n          <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>\n            <span class="token comment">// value 这个 promise 被 resolve 的时候，就会执行 next</span>\n            <span class="token comment">// 并且只要 done 不是 true 的时候，就会递归的往下解开 promise，对应</span>\n            <span class="token comment">// gen.next().value.then(value => {</span>\n            <span class="token comment">//    gen.next(value).value.then(value2 => {</span>\n            <span class="token comment">//       gen.next()</span>\n            <span class="token comment">//</span>\n            <span class="token comment">//      // 此时 done 为 true 了，整个 promise 被 resolve 了</span>\n            <span class="token comment">//      // 最外部的 test().then(res => console.log(res)) 的 then 就开始执行了</span>\n            <span class="token comment">//    })</span>\n            <span class="token comment">// })</span>\n            <span class="token keyword">function</span> <span class="token function">onResolve</span><span class="token punctuation">(</span><span class="token parameter">val</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n              <span class="token function">step</span><span class="token punctuation">(</span><span class="token string">\'next\'</span><span class="token punctuation">,</span> val<span class="token punctuation">)</span><span class="token punctuation">;</span>\n            <span class="token punctuation">}</span><span class="token punctuation">,</span>\n            <span class="token comment">// 如果 promise 被 reject 了，就再次进入 step 函数</span>\n            <span class="token comment">// 不同的是，这次的 try catch 中调用的是 gen.throw(err)</span>\n            <span class="token comment">// 那么自然就被 catch 到，然后把 promise 给 reject 掉啦</span>\n            <span class="token keyword">function</span> <span class="token function">onReject</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n              <span class="token function">step</span><span class="token punctuation">(</span><span class="token string">\'throw\'</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span><span class="token punctuation">;</span>\n            <span class="token punctuation">}</span>\n          <span class="token punctuation">)</span><span class="token punctuation">;</span>\n        <span class="token punctuation">}</span>\n      <span class="token punctuation">}</span>\n      <span class="token function">step</span><span class="token punctuation">(</span><span class="token string">\'next\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>',
id:"/github/workspace/blog/手写async await的最简实现/index.md absPath of file >>> MarkdownRemark",timeToRead:3,frontmatter:{date:"2021-01-10 11:30:16",path:"/async-await-simplest-implementation/",tags:"前端, JS, 高级前端",title:"手写 async await 的最简实现",draft:null}},{excerpt:"前置知识 需求背景 已知始发站、终点站，如何查出满足条件的方案线路？即根据一个表关联多个表时如何查询相关字段？ sql 语句 根据以上的前置知识可得出一对多下的查询应该这样写： Sequelize 下的解决方案 从表的设计上考虑：将始发站、终点站写在主表中，无需考虑一对多的问题 根据以上的 sql 语句利用 Sequelize 去关联 最终为了实现上的简便，直接使用方案 1",html:'<h1 id="前置知识"><a href="#%E5%89%8D%E7%BD%AE%E7%9F%A5%E8%AF%86" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>前置知识</h1>\n<p><div class="gatsby-highlight">\n        <pre class="language-sql"><code><span class="token keyword">drop</span> <span class="token keyword">database</span>  <span class="token keyword">if</span> <span class="token keyword">exists</span> Student_Course_Database <span class="token punctuation">;</span>\r\n<span class="token keyword">create</span> <span class="token keyword">database</span> Student_Course_Database<span class="token punctuation">;</span>\r\n<span class="token keyword">alter</span> <span class="token keyword">database</span> Student_Course_Database <span class="token keyword">character</span> <span class="token keyword">set</span> utf8<span class="token punctuation">;</span>\r\n<span class="token keyword">use</span> Student_Course_Database<span class="token punctuation">;</span>\r\n\r\n<span class="token keyword">create</span> <span class="token keyword">table</span> student\r\n<span class="token punctuation">(</span>sno <span class="token keyword">char</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">)</span> <span class="token keyword">primary</span> <span class="token keyword">key</span><span class="token punctuation">,</span>\r\n sname <span class="token keyword">char</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> <span class="token keyword">unique</span><span class="token punctuation">,</span>\r\n ssex <span class="token keyword">char</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\r\n sage <span class="token keyword">smallint</span><span class="token punctuation">,</span>\r\n sdept <span class="token keyword">char</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span>\r\n<span class="token punctuation">)</span><span class="token punctuation">;</span>\r\n<span class="token keyword">create</span> <span class="token keyword">table</span> course\r\n<span class="token punctuation">(</span>cno <span class="token keyword">char</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span> <span class="token keyword">primary</span> <span class="token keyword">key</span><span class="token punctuation">,</span>\r\n cname <span class="token keyword">char</span><span class="token punctuation">(</span><span class="token number">40</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\r\n cpno <span class="token keyword">char</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\r\n ccredit <span class="token keyword">smallint</span><span class="token punctuation">,</span>\r\n <span class="token keyword">foreign</span> <span class="token keyword">key</span> <span class="token punctuation">(</span>cpno<span class="token punctuation">)</span> <span class="token keyword">references</span> course<span class="token punctuation">(</span>cno<span class="token punctuation">)</span>\r\n<span class="token punctuation">)</span><span class="token punctuation">;</span>\r\n<span class="token keyword">create</span> <span class="token keyword">table</span> sc\r\n<span class="token punctuation">(</span>sno <span class="token keyword">char</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\r\ncno <span class="token keyword">char</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\r\ngrade <span class="token keyword">smallint</span> <span class="token punctuation">,</span>\r\n<span class="token keyword">primary</span> <span class="token keyword">key</span> <span class="token punctuation">(</span>sno<span class="token punctuation">,</span>cno<span class="token punctuation">)</span><span class="token punctuation">,</span>\r\n<span class="token keyword">foreign</span> <span class="token keyword">key</span> <span class="token punctuation">(</span>sno<span class="token punctuation">)</span> <span class="token keyword">references</span> student<span class="token punctuation">(</span>sno<span class="token punctuation">)</span><span class="token punctuation">,</span>\r\n<span class="token keyword">foreign</span> <span class="token keyword">key</span> <span class="token punctuation">(</span>cno<span class="token punctuation">)</span> <span class="token keyword">references</span> course<span class="token punctuation">(</span>cno<span class="token punctuation">)</span>\r\n<span class="token punctuation">)</span><span class="token punctuation">;</span>\r\n\r\n<span class="token keyword">insert</span> <span class="token keyword">into</span> student <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token string">\'200215121\'</span><span class="token punctuation">,</span><span class="token string">\'李勇\'</span><span class="token punctuation">,</span><span class="token string">\'男\'</span><span class="token punctuation">,</span><span class="token number">20</span><span class="token punctuation">,</span><span class="token string">\'CS\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\r\n<span class="token keyword">insert</span> <span class="token keyword">into</span> student <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token string">\'200215122\'</span><span class="token punctuation">,</span><span class="token string">\'刘晨\'</span><span class="token punctuation">,</span><span class="token string">\'女\'</span><span class="token punctuation">,</span><span class="token number">19</span><span class="token punctuation">,</span><span class="token string">\'CS\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\r\n<span class="token keyword">insert</span> <span class="token keyword">into</span> student <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token string">\'200215123\'</span><span class="token punctuation">,</span><span class="token string">\'王敏\'</span><span class="token punctuation">,</span><span class="token string">\'女\'</span><span class="token punctuation">,</span><span class="token number">18</span><span class="token punctuation">,</span><span class="token string">\'MA\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\r\n<span class="token keyword">insert</span> <span class="token keyword">into</span> student <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token string">\'200215125\'</span><span class="token punctuation">,</span><span class="token string">\'张立\'</span><span class="token punctuation">,</span><span class="token string">\'男\'</span><span class="token punctuation">,</span><span class="token number">19</span><span class="token punctuation">,</span><span class="token string">\'IS\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\r\n<span class="token keyword">insert</span> <span class="token keyword">into</span> student <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token string">\'200215124\'</span><span class="token punctuation">,</span><span class="token string">\'刘武汉\'</span><span class="token punctuation">,</span><span class="token string">\'男\'</span><span class="token punctuation">,</span><span class="token number">21</span><span class="token punctuation">,</span><span class="token string">\'PE\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\r\n<span class="token keyword">insert</span> <span class="token keyword">into</span> student <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token string">\'200215126\'</span><span class="token punctuation">,</span><span class="token string">\'李四\'</span><span class="token punctuation">,</span><span class="token string">\'男\'</span><span class="token punctuation">,</span><span class="token number">16</span><span class="token punctuation">,</span><span class="token string">\'MA\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\r\n<span class="token keyword">insert</span> <span class="token keyword">into</span> student <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token string">\'200215128\'</span><span class="token punctuation">,</span><span class="token string">\'欧阳雨\'</span><span class="token punctuation">,</span><span class="token string">\'女\'</span><span class="token punctuation">,</span><span class="token number">17</span><span class="token punctuation">,</span><span class="token string">\'CS\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\r\n<span class="token keyword">insert</span> <span class="token keyword">into</span> student <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token string">\'200215127\'</span><span class="token punctuation">,</span><span class="token string">\'欧阳杰\'</span><span class="token punctuation">,</span><span class="token string">\'男\'</span><span class="token punctuation">,</span><span class="token number">14</span><span class="token punctuation">,</span><span class="token string">\'PY\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\r\n\r\n<span class="token keyword">insert</span> <span class="token keyword">into</span> course<span class="token punctuation">(</span>Cno<span class="token punctuation">,</span>Cname<span class="token punctuation">,</span>Ccredit<span class="token punctuation">)</span> <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token string">\'6\'</span><span class="token punctuation">,</span><span class="token string">\'数据处理\'</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\r\n<span class="token keyword">insert</span> <span class="token keyword">into</span> course<span class="token punctuation">(</span>Cno<span class="token punctuation">,</span>Cname<span class="token punctuation">,</span>Ccredit<span class="token punctuation">)</span> <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token string">\'2\'</span><span class="token punctuation">,</span><span class="token string">\'数学\'</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\r\n<span class="token keyword">insert</span> <span class="token keyword">into</span> course <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token string">\'8\'</span><span class="token punctuation">,</span><span class="token string">\'数字系统设计\'</span><span class="token punctuation">,</span><span class="token string">\'2\'</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\r\n<span class="token keyword">insert</span> <span class="token keyword">into</span> course <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token string">\'7\'</span><span class="token punctuation">,</span><span class="token string">\'PASCAL语言\'</span><span class="token punctuation">,</span><span class="token string">\'6\'</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\r\n<span class="token keyword">insert</span> <span class="token keyword">into</span> course <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token string">\'5\'</span><span class="token punctuation">,</span><span class="token string">\'数据结构\'</span><span class="token punctuation">,</span><span class="token string">\'7\'</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\r\n<span class="token keyword">insert</span> <span class="token keyword">into</span> course <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token string">\'4\'</span><span class="token punctuation">,</span><span class="token string">\'操作系统\'</span><span class="token punctuation">,</span><span class="token string">\'6\'</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\r\n<span class="token keyword">insert</span> <span class="token keyword">into</span> course <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token string">\'1\'</span><span class="token punctuation">,</span><span class="token string">\'数据库\'</span><span class="token punctuation">,</span><span class="token string">\'5\'</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\r\n<span class="token keyword">insert</span> <span class="token keyword">into</span> course <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token string">\'3\'</span><span class="token punctuation">,</span><span class="token string">\'信息系统\'</span><span class="token punctuation">,</span><span class="token string">\'1\'</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\r\n<span class="token keyword">insert</span> <span class="token keyword">into</span> course <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token string">\'9\'</span><span class="token punctuation">,</span><span class="token string">\'DB_Design\'</span><span class="token punctuation">,</span><span class="token string">\'1\'</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\r\n\r\n<span class="token keyword">insert</span> <span class="token keyword">into</span> sc <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token string">\'200215121\'</span><span class="token punctuation">,</span><span class="token string">\'1\'</span><span class="token punctuation">,</span><span class="token number">92</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\r\n<span class="token keyword">insert</span> <span class="token keyword">into</span> sc <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token string">\'200215121\'</span><span class="token punctuation">,</span><span class="token string">\'2\'</span><span class="token punctuation">,</span><span class="token number">85</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\r\n<span class="token keyword">insert</span> <span class="token keyword">into</span> sc <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token string">\'200215121\'</span><span class="token punctuation">,</span><span class="token string">\'3\'</span><span class="token punctuation">,</span><span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\r\n<span class="token keyword">insert</span> <span class="token keyword">into</span> sc <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token string">\'200215121\'</span><span class="token punctuation">,</span><span class="token string">\'4\'</span><span class="token punctuation">,</span><span class="token number">97</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\r\n<span class="token keyword">insert</span> <span class="token keyword">into</span> sc <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token string">\'200215121\'</span><span class="token punctuation">,</span><span class="token string">\'6\'</span><span class="token punctuation">,</span><span class="token number">59</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\r\n<span class="token keyword">insert</span> <span class="token keyword">into</span> sc <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token string">\'200215121\'</span><span class="token punctuation">,</span><span class="token string">\'5\'</span><span class="token punctuation">,</span><span class="token number">54</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\r\n<span class="token keyword">insert</span> <span class="token keyword">into</span> sc <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token string">\'200215122\'</span><span class="token punctuation">,</span><span class="token string">\'2\'</span><span class="token punctuation">,</span><span class="token number">90</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\r\n<span class="token keyword">insert</span> <span class="token keyword">into</span> sc <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token string">\'200215122\'</span><span class="token punctuation">,</span><span class="token string">\'4\'</span><span class="token punctuation">,</span><span class="token number">96</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\r\n<span class="token keyword">insert</span> <span class="token keyword">into</span> sc <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token string">\'200215122\'</span><span class="token punctuation">,</span><span class="token string">\'3\'</span><span class="token punctuation">,</span><span class="token number">80</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\r\n<span class="token keyword">insert</span> <span class="token keyword">into</span> sc <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token string">\'200215123\'</span><span class="token punctuation">,</span><span class="token string">\'6\'</span><span class="token punctuation">,</span><span class="token number">65</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\r\n<span class="token keyword">insert</span> <span class="token keyword">into</span> sc <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token string">\'200215123\'</span><span class="token punctuation">,</span><span class="token string">\'5\'</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\r\n<span class="token keyword">insert</span> <span class="token keyword">into</span> sc<span class="token punctuation">(</span>sno<span class="token punctuation">,</span>cno<span class="token punctuation">)</span> <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token string">\'200215127\'</span><span class="token punctuation">,</span><span class="token string">\'2\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\r\n\r\n<span class="token comment">#1</span>\r\n<span class="token keyword">select</span> sno<span class="token punctuation">,</span>sname <span class="token keyword">from</span> student<span class="token punctuation">;</span>\r\n<span class="token comment">#2</span>\r\n<span class="token keyword">select</span> sname<span class="token punctuation">,</span>sno<span class="token punctuation">,</span>sdept <span class="token keyword">from</span> student<span class="token punctuation">;</span>\r\n<span class="token comment">#3</span>\r\n<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> student<span class="token punctuation">;</span>\r\n<span class="token comment">#4</span>\r\n<span class="token keyword">select</span> sname<span class="token punctuation">,</span><span class="token number">2004</span><span class="token operator">-</span>sage <span class="token keyword">from</span> student<span class="token punctuation">;</span>\r\n<span class="token comment">#5</span>\r\n<span class="token keyword">select</span> sname<span class="token punctuation">,</span><span class="token string">\'Year of Birth:\'</span><span class="token punctuation">,</span><span class="token number">2004</span><span class="token operator">-</span>sage<span class="token punctuation">,</span>lower<span class="token punctuation">(</span>sdept<span class="token punctuation">)</span> <span class="token keyword">from</span> student<span class="token punctuation">;</span>\r\n<span class="token keyword">select</span> sname NAME<span class="token punctuation">,</span><span class="token string">\'Year of Birth:\'</span> BIRTH<span class="token punctuation">,</span><span class="token number">2004</span><span class="token operator">-</span>sage BIRTHDAY<span class="token punctuation">,</span>lower<span class="token punctuation">(</span>sdept<span class="token punctuation">)</span> DEPARTMENT <span class="token keyword">from</span> student<span class="token punctuation">;</span>\r\n<span class="token comment">#6</span>\r\n<span class="token keyword">select</span> <span class="token keyword">all</span> sno <span class="token keyword">from</span> sc<span class="token punctuation">;</span>\r\n<span class="token keyword">select</span> <span class="token keyword">distinct</span> sno <span class="token keyword">from</span> sc<span class="token punctuation">;</span>\r\n<span class="token comment">#7</span>\r\n<span class="token keyword">select</span> sname <span class="token keyword">from</span> student <span class="token keyword">where</span> sdept<span class="token operator">=</span><span class="token string">\'CS\'</span><span class="token punctuation">;</span>\r\n<span class="token comment">#8</span>\r\n<span class="token keyword">select</span> sname<span class="token punctuation">,</span>sage <span class="token keyword">from</span> student <span class="token keyword">where</span> sage<span class="token operator">&lt;</span><span class="token number">20</span><span class="token punctuation">;</span>\r\n<span class="token comment">#9</span>\r\n<span class="token keyword">select</span> <span class="token keyword">distinct</span> sno <span class="token keyword">from</span> sc <span class="token keyword">where</span> grade<span class="token operator">&lt;</span><span class="token number">60</span><span class="token punctuation">;</span>\r\n<span class="token comment">#10</span>\r\n<span class="token keyword">select</span> sname<span class="token punctuation">,</span>sdept<span class="token punctuation">,</span>sage <span class="token keyword">from</span> student <span class="token keyword">where</span> sage <span class="token operator">between</span> <span class="token number">20</span> <span class="token operator">and</span> <span class="token number">23</span><span class="token punctuation">;</span>\r\n<span class="token comment">#11</span>\r\n<span class="token keyword">select</span> sname<span class="token punctuation">,</span>sdept<span class="token punctuation">,</span>sage <span class="token keyword">from</span> student <span class="token keyword">where</span> sage <span class="token operator">not</span> <span class="token operator">between</span> <span class="token number">20</span> <span class="token operator">and</span> <span class="token number">23</span><span class="token punctuation">;</span>\r\n<span class="token comment">#12</span>\r\n<span class="token keyword">select</span> sname<span class="token punctuation">,</span>ssex<span class="token punctuation">,</span>sdept <span class="token keyword">from</span> student <span class="token keyword">where</span> sdept <span class="token operator">in</span><span class="token punctuation">(</span><span class="token string">\'CS\'</span><span class="token punctuation">,</span><span class="token string">\'MA\'</span><span class="token punctuation">,</span><span class="token string">\'IS\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\r\n<span class="token comment">#13</span>\r\n<span class="token keyword">select</span> sname<span class="token punctuation">,</span>ssex<span class="token punctuation">,</span>sdept <span class="token keyword">from</span> student <span class="token keyword">where</span> sdept <span class="token operator">not</span> <span class="token operator">in</span> <span class="token punctuation">(</span><span class="token string">\'CS\'</span><span class="token punctuation">,</span><span class="token string">\'MA\'</span><span class="token punctuation">,</span><span class="token string">\'IS\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\r\n<span class="token comment">#14</span>\r\n<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> student <span class="token keyword">where</span> sno <span class="token operator">like</span> <span class="token string">\'200215121\'</span><span class="token punctuation">;</span>\r\n<span class="token comment">#15</span>\r\n<span class="token keyword">select</span> sname<span class="token punctuation">,</span>sno<span class="token punctuation">,</span>ssex <span class="token keyword">from</span> student <span class="token keyword">where</span> sname <span class="token operator">like</span> <span class="token string">\'刘%\'</span><span class="token punctuation">;</span>\r\n<span class="token comment">#16</span>\r\n<span class="token keyword">select</span> sname <span class="token keyword">from</span> student <span class="token keyword">where</span> sname <span class="token operator">like</span> <span class="token string">\'欧阳_\'</span><span class="token punctuation">;</span>\r\n<span class="token comment">#17</span>\r\n<span class="token keyword">select</span> sname<span class="token punctuation">,</span>sno <span class="token keyword">from</span> student <span class="token keyword">where</span> sname <span class="token operator">like</span> <span class="token string">\'_阳%\'</span><span class="token punctuation">;</span>\r\n<span class="token comment">#18</span>\r\n<span class="token keyword">select</span> sname<span class="token punctuation">,</span>sno<span class="token punctuation">,</span>ssex <span class="token keyword">from</span> student <span class="token keyword">where</span> sname <span class="token operator">not</span> <span class="token operator">like</span> <span class="token string">\'刘%\'</span><span class="token punctuation">;</span>\r\n<span class="token comment">#19</span>\r\n<span class="token keyword">select</span> cno<span class="token punctuation">,</span>ccredit <span class="token keyword">from</span> course <span class="token keyword">where</span> cname <span class="token operator">like</span> <span class="token string">\'DB@_Design\'</span> <span class="token keyword">escape</span> <span class="token string">\'@\'</span><span class="token punctuation">;</span>\r\n<span class="token keyword">select</span> cno<span class="token punctuation">,</span>ccredit <span class="token keyword">from</span> course <span class="token keyword">where</span> cname <span class="token operator">=</span> <span class="token string">\'DB_Design\'</span> <span class="token punctuation">;</span>\r\n<span class="token comment">#20</span>\r\n<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> course <span class="token keyword">where</span> cname <span class="token operator">like</span> <span class="token string">\'DB@_%i__\'</span><span class="token keyword">escape</span> <span class="token string">\'@\'</span><span class="token punctuation">;</span>\r\n<span class="token comment">#21</span>\r\n<span class="token keyword">select</span> sno<span class="token punctuation">,</span>cno <span class="token keyword">from</span> sc <span class="token keyword">where</span> grade <span class="token operator">is</span> <span class="token boolean">null</span><span class="token punctuation">;</span>\r\n#<span class="token number">22</span>\r\n<span class="token keyword">select</span> sno<span class="token punctuation">,</span>cno <span class="token keyword">from</span> sc <span class="token keyword">where</span> grade <span class="token operator">is</span> <span class="token operator">not</span> <span class="token boolean">null</span><span class="token punctuation">;</span>\r\n#<span class="token number">23</span>\r\n<span class="token keyword">select</span> sname<span class="token punctuation">,</span>sdept<span class="token punctuation">,</span>sage <span class="token keyword">from</span> student <span class="token keyword">where</span> sdept<span class="token operator">=</span><span class="token string">\'CS\'</span> <span class="token operator">and</span> sage<span class="token operator">&lt;</span><span class="token number">20</span><span class="token punctuation">;</span>\r\n<span class="token keyword">select</span> sname<span class="token punctuation">,</span>ssex<span class="token punctuation">,</span>sdept <span class="token keyword">from</span> student <span class="token keyword">where</span> sdept <span class="token operator">=</span><span class="token string">\'CS\'</span> <span class="token operator">or</span> sdept<span class="token operator">=</span><span class="token string">\'MA\'</span> <span class="token operator">or</span> sdept<span class="token operator">=</span><span class="token string">\'IS\'</span><span class="token punctuation">;</span>\r\n<span class="token comment">#24</span>\r\n<span class="token keyword">select</span> sno<span class="token punctuation">,</span>grade <span class="token keyword">from</span> sc <span class="token keyword">where</span> cno<span class="token operator">=</span><span class="token string">\'2\'</span> <span class="token keyword">order</span> <span class="token keyword">by</span> grade <span class="token keyword">desc</span><span class="token punctuation">;</span>\r\n<span class="token comment">#25</span>\r\n<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> student <span class="token keyword">order</span> <span class="token keyword">by</span> sdept<span class="token punctuation">,</span>sage <span class="token keyword">desc</span><span class="token punctuation">;</span>\r\n<span class="token comment">#26</span>\r\n<span class="token keyword">select</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">from</span> student<span class="token punctuation">;</span>\r\n<span class="token comment">#27</span>\r\n<span class="token keyword">select</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token keyword">distinct</span> sno<span class="token punctuation">)</span> <span class="token keyword">from</span> sc<span class="token punctuation">;</span>\r\n<span class="token comment">#28</span>\r\n<span class="token keyword">select</span> <span class="token function">avg</span><span class="token punctuation">(</span>grade<span class="token punctuation">)</span> <span class="token keyword">from</span> sc <span class="token keyword">where</span> cno<span class="token operator">=</span><span class="token string">\'3\'</span><span class="token punctuation">;</span>\r\n<span class="token comment">#29</span>\r\n<span class="token keyword">select</span> <span class="token function">max</span><span class="token punctuation">(</span>grade<span class="token punctuation">)</span><span class="token keyword">from</span> sc <span class="token keyword">where</span> cno<span class="token operator">=</span><span class="token string">\'3\'</span><span class="token punctuation">;</span>\r\n<span class="token comment">#30</span>\r\n<span class="token keyword">select</span> <span class="token function">sum</span><span class="token punctuation">(</span>ccredit<span class="token punctuation">)</span> <span class="token keyword">from</span> sc<span class="token punctuation">,</span>course <span class="token keyword">where</span> sno<span class="token operator">=</span><span class="token string">\'200215122\'</span> <span class="token operator">and</span> sc<span class="token punctuation">.</span>cno<span class="token operator">=</span>course<span class="token punctuation">.</span>cno<span class="token punctuation">;</span>\r\n<span class="token comment">#31</span>\r\n<span class="token keyword">select</span> cno<span class="token punctuation">,</span><span class="token function">count</span><span class="token punctuation">(</span>sno<span class="token punctuation">)</span> <span class="token keyword">from</span> sc <span class="token keyword">group</span> <span class="token keyword">by</span> cno<span class="token punctuation">;</span>\r\n<span class="token comment">#32</span>\r\n<span class="token keyword">select</span> sno <span class="token keyword">from</span> sc <span class="token keyword">group</span> <span class="token keyword">by</span> sno <span class="token keyword">having</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">></span><span class="token number">3</span><span class="token punctuation">;</span>\r\n<span class="token comment">#33 在使用 join 时，on 和 where 条件的区别: on 条件是在生成临时表时使用的条件，它不管 on 中的条件是否为真，都会返回左边表中的记录。where 条件是在临时表生成好后，再对临时表进行过滤的条件。</span>\r\n<span class="token comment"># 同 join</span>\r\n<span class="token keyword">select</span> student<span class="token punctuation">.</span><span class="token operator">*</span><span class="token punctuation">,</span>sc<span class="token punctuation">.</span><span class="token operator">*</span> <span class="token keyword">from</span> student<span class="token punctuation">,</span>sc <span class="token keyword">where</span> student<span class="token punctuation">.</span>sno<span class="token operator">=</span>sc<span class="token punctuation">.</span>sno<span class="token punctuation">;</span>\r\n<span class="token comment"># 在表中存在至少一个匹配时返回行，即求交集</span>\r\n<span class="token keyword">select</span> student<span class="token punctuation">.</span><span class="token operator">*</span><span class="token punctuation">,</span>sc<span class="token punctuation">.</span><span class="token operator">*</span> <span class="token keyword">from</span> student <span class="token keyword">join</span> sc <span class="token keyword">on</span> student<span class="token punctuation">.</span>sno<span class="token operator">=</span>sc<span class="token punctuation">.</span>sno<span class="token punctuation">;</span>\r\n<span class="token comment"># 同 join</span>\r\n<span class="token keyword">select</span> student<span class="token punctuation">.</span><span class="token operator">*</span><span class="token punctuation">,</span>sc<span class="token punctuation">.</span><span class="token operator">*</span> <span class="token keyword">from</span> student <span class="token keyword">inner</span> <span class="token keyword">join</span> sc <span class="token keyword">on</span> student<span class="token punctuation">.</span>sno<span class="token operator">=</span>sc<span class="token punctuation">.</span>sno<span class="token punctuation">;</span>\r\n<span class="token comment"># 即使右表中没有匹配，也从左表返回所有的行</span>\r\n<span class="token keyword">select</span> student<span class="token punctuation">.</span><span class="token operator">*</span><span class="token punctuation">,</span>sc<span class="token punctuation">.</span><span class="token operator">*</span> <span class="token keyword">from</span> student <span class="token keyword">left</span> <span class="token keyword">join</span> sc <span class="token keyword">on</span> student<span class="token punctuation">.</span>sno<span class="token operator">=</span>sc<span class="token punctuation">.</span>sno<span class="token punctuation">;</span>\r\n<span class="token comment"># 即使左表中没有匹配，也从右表返回所有的行</span>\r\n<span class="token keyword">select</span> student<span class="token punctuation">.</span><span class="token operator">*</span><span class="token punctuation">,</span>sc<span class="token punctuation">.</span><span class="token operator">*</span> <span class="token keyword">from</span> student <span class="token keyword">right</span> <span class="token keyword">join</span> sc <span class="token keyword">on</span> student<span class="token punctuation">.</span>sno<span class="token operator">=</span>sc<span class="token punctuation">.</span>sno<span class="token punctuation">;</span>\r\n<span class="token comment"># 只要其中一个表中存在匹配，就返回行，mysql 不支持</span>\r\n<span class="token keyword">select</span> student<span class="token punctuation">.</span><span class="token operator">*</span><span class="token punctuation">,</span>sc<span class="token punctuation">.</span><span class="token operator">*</span> <span class="token keyword">from</span> student <span class="token keyword">full</span> <span class="token keyword">outer</span> <span class="token keyword">join</span> sc <span class="token keyword">on</span> student<span class="token punctuation">.</span>sno<span class="token operator">=</span>sc<span class="token punctuation">.</span>sno<span class="token punctuation">;</span>\r\n<span class="token comment">#34</span>\r\n<span class="token keyword">select</span> student<span class="token punctuation">.</span>sno<span class="token punctuation">,</span>sname<span class="token punctuation">,</span>ssex<span class="token punctuation">,</span>sage<span class="token punctuation">,</span>sdept<span class="token punctuation">,</span>cno<span class="token punctuation">,</span>grade <span class="token keyword">from</span> student<span class="token punctuation">,</span>sc <span class="token keyword">where</span> student<span class="token punctuation">.</span>sno<span class="token operator">=</span>sc<span class="token punctuation">.</span>sno<span class="token punctuation">;</span>\r\n<span class="token keyword">select</span> student<span class="token punctuation">.</span>sno<span class="token punctuation">,</span>sname<span class="token punctuation">,</span>ssex<span class="token punctuation">,</span>sage<span class="token punctuation">,</span>sdept<span class="token punctuation">,</span>cno<span class="token punctuation">,</span>grade <span class="token keyword">from</span> student<span class="token punctuation">,</span>sc <span class="token keyword">where</span> student<span class="token punctuation">.</span>sno<span class="token operator">=</span>sc<span class="token punctuation">.</span>sno<span class="token punctuation">;</span>\r\n<span class="token comment">#35</span>\r\n<span class="token keyword">select</span> <span class="token keyword">first</span><span class="token punctuation">.</span>cno<span class="token punctuation">,</span><span class="token keyword">second</span><span class="token punctuation">.</span>cpno <span class="token keyword">from</span> course <span class="token keyword">first</span><span class="token punctuation">,</span>course <span class="token keyword">second</span> <span class="token keyword">where</span> <span class="token keyword">first</span><span class="token punctuation">.</span>cpno<span class="token operator">=</span><span class="token keyword">second</span><span class="token punctuation">.</span>cno<span class="token punctuation">;</span>\r\n<span class="token keyword">select</span> <span class="token keyword">first</span><span class="token punctuation">.</span>cno<span class="token punctuation">,</span><span class="token keyword">second</span><span class="token punctuation">.</span>cpno <span class="token keyword">from</span> course <span class="token keyword">first</span><span class="token punctuation">,</span>course <span class="token keyword">second</span> <span class="token keyword">where</span> <span class="token keyword">first</span><span class="token punctuation">.</span>cpno<span class="token operator">=</span><span class="token keyword">second</span><span class="token punctuation">.</span>cno <span class="token operator">and</span> <span class="token keyword">second</span><span class="token punctuation">.</span>cpno <span class="token operator">is</span> <span class="token operator">not</span> <span class="token boolean">null</span><span class="token punctuation">;</span>\r\n<span class="token comment">#36</span>\r\n<span class="token keyword">select</span> student<span class="token punctuation">.</span>sno<span class="token punctuation">,</span>sname<span class="token punctuation">,</span>ssex<span class="token punctuation">,</span>sage<span class="token punctuation">,</span>sdept<span class="token punctuation">,</span>cno<span class="token punctuation">,</span>grade <span class="token keyword">from</span> student <span class="token keyword">left</span> <span class="token keyword">join</span> sc <span class="token keyword">on</span><span class="token punctuation">(</span>student<span class="token punctuation">.</span>sno<span class="token operator">=</span>sc<span class="token punctuation">.</span>sno<span class="token punctuation">)</span><span class="token punctuation">;</span>\r\n<span class="token keyword">select</span> student<span class="token punctuation">.</span>sno<span class="token punctuation">,</span>sname<span class="token punctuation">,</span>ssex<span class="token punctuation">,</span>sage<span class="token punctuation">,</span>sdept<span class="token punctuation">,</span>cno<span class="token punctuation">,</span>grade <span class="token keyword">from</span> student <span class="token keyword">left</span> <span class="token keyword">join</span> sc <span class="token keyword">using</span><span class="token punctuation">(</span>sno<span class="token punctuation">)</span><span class="token punctuation">;</span>\r\n<span class="token keyword">select</span> student<span class="token punctuation">.</span>sno<span class="token punctuation">,</span>sname<span class="token punctuation">,</span>ssex<span class="token punctuation">,</span>sage<span class="token punctuation">,</span>sdept<span class="token punctuation">,</span>cno<span class="token punctuation">,</span>grade <span class="token keyword">from</span> student <span class="token keyword">right</span> <span class="token keyword">join</span> sc <span class="token keyword">on</span><span class="token punctuation">(</span>student<span class="token punctuation">.</span>sno<span class="token operator">=</span>sc<span class="token punctuation">.</span>sno<span class="token punctuation">)</span><span class="token punctuation">;</span>\r\n<span class="token keyword">select</span> student<span class="token punctuation">.</span>sno<span class="token punctuation">,</span>sname<span class="token punctuation">,</span>ssex<span class="token punctuation">,</span>sage<span class="token punctuation">,</span>sdept<span class="token punctuation">,</span>cno<span class="token punctuation">,</span>grade <span class="token keyword">from</span> student <span class="token keyword">right</span> <span class="token keyword">join</span> sc <span class="token keyword">on</span><span class="token punctuation">(</span>student<span class="token punctuation">.</span>sno<span class="token operator">=</span>sc<span class="token punctuation">.</span>sno<span class="token punctuation">)</span><span class="token punctuation">;</span>\r\n<span class="token comment">#37</span>\r\n<span class="token keyword">select</span> student<span class="token punctuation">.</span>sno<span class="token punctuation">,</span>sname <span class="token keyword">from</span> student<span class="token punctuation">,</span>sc <span class="token keyword">where</span> student<span class="token punctuation">.</span>sno<span class="token operator">=</span>sc<span class="token punctuation">.</span>sno <span class="token operator">and</span> cno<span class="token operator">=</span><span class="token string">\'1\'</span> <span class="token operator">and</span> grade<span class="token operator">></span><span class="token number">90</span><span class="token punctuation">;</span>\r\n<span class="token comment">#38</span>\r\n<span class="token keyword">select</span> student<span class="token punctuation">.</span>sno<span class="token punctuation">,</span>sname<span class="token punctuation">,</span>cname<span class="token punctuation">,</span>grade <span class="token keyword">from</span> student<span class="token punctuation">,</span>sc<span class="token punctuation">,</span>course <span class="token keyword">where</span> student<span class="token punctuation">.</span>sno<span class="token operator">=</span>sc<span class="token punctuation">.</span>sno <span class="token operator">and</span> sc<span class="token punctuation">.</span>cno<span class="token operator">=</span>course<span class="token punctuation">.</span>cno<span class="token punctuation">;</span>\r\n<span class="token comment">#39 和刘晨是相同专业的同学，一对多查询模板</span>\r\n<span class="token keyword">select</span> sname<span class="token punctuation">,</span>sname<span class="token punctuation">,</span>sdept <span class="token keyword">from</span> student <span class="token keyword">where</span> sdept <span class="token operator">in</span> <span class="token punctuation">(</span><span class="token keyword">select</span> sdept <span class="token keyword">from</span> student <span class="token keyword">where</span> sname<span class="token operator">=</span><span class="token string">\'刘晨\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\r\n<span class="token keyword">select</span> s1<span class="token punctuation">.</span>sno<span class="token punctuation">,</span>s1<span class="token punctuation">.</span>sname<span class="token punctuation">,</span>s1<span class="token punctuation">.</span>sdept <span class="token keyword">from</span> student s1<span class="token punctuation">,</span>student s2 <span class="token keyword">where</span> s1<span class="token punctuation">.</span>sdept<span class="token operator">=</span>s2<span class="token punctuation">.</span>sdept <span class="token operator">and</span> s2<span class="token punctuation">.</span>sname<span class="token operator">=</span><span class="token string">\'刘晨\'</span><span class="token punctuation">;</span>\r\n<span class="token keyword">select</span> sno<span class="token punctuation">,</span>sname<span class="token punctuation">,</span>sdept <span class="token keyword">from</span> student s1 <span class="token keyword">where</span> <span class="token keyword">exists</span> <span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> student s2 <span class="token keyword">where</span> s2<span class="token punctuation">.</span>sdept<span class="token operator">=</span>s1<span class="token punctuation">.</span>sdept <span class="token operator">and</span> s2<span class="token punctuation">.</span>sname<span class="token operator">=</span><span class="token string">\'刘晨\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\r\n<span class="token comment">#40 学信息系统课程的有谁</span>\r\n<span class="token keyword">select</span> sno<span class="token punctuation">,</span>sname <span class="token keyword">from</span> student <span class="token keyword">where</span> sno <span class="token operator">in</span> <span class="token punctuation">(</span><span class="token keyword">select</span> sno <span class="token keyword">from</span> sc <span class="token keyword">where</span> cno <span class="token operator">in</span> <span class="token punctuation">(</span><span class="token keyword">select</span> cno <span class="token keyword">from</span> course <span class="token keyword">where</span> cname<span class="token operator">=</span><span class="token string">\'信息系统\'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\r\n<span class="token keyword">select</span> student<span class="token punctuation">.</span>sno<span class="token punctuation">,</span>sname <span class="token keyword">from</span> student<span class="token punctuation">,</span>sc<span class="token punctuation">,</span>course <span class="token keyword">where</span> student<span class="token punctuation">.</span>sno<span class="token operator">=</span>sc<span class="token punctuation">.</span>sno <span class="token operator">and</span> sc<span class="token punctuation">.</span>cno<span class="token operator">=</span>course<span class="token punctuation">.</span>cno <span class="token operator">and</span> cname<span class="token operator">=</span><span class="token string">\'信息系统\'</span><span class="token punctuation">;</span>\r\n<span class="token comment">#41 每位同学成绩大于所选课程平均分的课程</span>\r\n<span class="token keyword">select</span> sno<span class="token punctuation">,</span>cno <span class="token keyword">from</span> sc x <span class="token keyword">where</span> grade<span class="token operator">>=</span><span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token function">avg</span><span class="token punctuation">(</span>grade<span class="token punctuation">)</span> <span class="token keyword">from</span> sc y <span class="token keyword">where</span> y<span class="token punctuation">.</span>sno<span class="token operator">=</span>x<span class="token punctuation">.</span>sno<span class="token punctuation">)</span><span class="token punctuation">;</span>\r\n<span class="token keyword">select</span> sc<span class="token punctuation">.</span>sno<span class="token punctuation">,</span>cno <span class="token keyword">from</span> sc<span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token keyword">select</span> sno<span class="token punctuation">,</span><span class="token function">avg</span><span class="token punctuation">(</span>grade<span class="token punctuation">)</span> A_G <span class="token keyword">from</span> sc <span class="token keyword">group</span> <span class="token keyword">by</span> sno<span class="token punctuation">)</span> y <span class="token keyword">where</span> sc<span class="token punctuation">.</span>sno<span class="token operator">=</span>y<span class="token punctuation">.</span>sno <span class="token operator">and</span> sc<span class="token punctuation">.</span>grade<span class="token operator">>=</span>y<span class="token punctuation">.</span>A_G<span class="token punctuation">;</span>\r\n<span class="token comment">#42 非 CS 专业下年龄小于 CS 的最大年龄的</span>\r\n<span class="token keyword">select</span> sname<span class="token punctuation">,</span>sage <span class="token keyword">from</span> student <span class="token keyword">where</span> sage<span class="token operator">&lt;</span><span class="token keyword">any</span><span class="token punctuation">(</span><span class="token keyword">select</span> sage <span class="token keyword">from</span> student <span class="token keyword">where</span> sdept<span class="token operator">=</span><span class="token string">\'CS\'</span><span class="token punctuation">)</span> <span class="token operator">and</span> sdept<span class="token operator">&lt;></span><span class="token string">\'CS\'</span><span class="token punctuation">;</span>\r\n<span class="token keyword">select</span> sname<span class="token punctuation">,</span>sage <span class="token keyword">from</span> student <span class="token keyword">where</span> sage<span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token function">max</span><span class="token punctuation">(</span>sage<span class="token punctuation">)</span> <span class="token keyword">from</span> student <span class="token keyword">where</span> sdept<span class="token operator">=</span><span class="token string">\'CS\'</span><span class="token punctuation">)</span><span class="token operator">and</span> sdept<span class="token operator">&lt;></span><span class="token string">\'CS\'</span><span class="token punctuation">;</span>\r\n<span class="token comment">#43 非 CS 专业下年龄小于 CS 的最小年龄的</span>\r\n<span class="token keyword">select</span> sname<span class="token punctuation">,</span>sage <span class="token keyword">from</span> student <span class="token keyword">where</span> sage<span class="token operator">&lt;</span><span class="token keyword">all</span><span class="token punctuation">(</span><span class="token keyword">select</span> sage <span class="token keyword">from</span> student <span class="token keyword">where</span> sdept<span class="token operator">=</span><span class="token string">\'CS\'</span><span class="token punctuation">)</span><span class="token operator">and</span> sdept<span class="token operator">&lt;></span><span class="token string">\'CS\'</span><span class="token punctuation">;</span>\r\n<span class="token keyword">select</span> sname<span class="token punctuation">,</span>sage <span class="token keyword">from</span> student <span class="token keyword">where</span> sage<span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token function">min</span><span class="token punctuation">(</span>sage<span class="token punctuation">)</span> <span class="token keyword">from</span> student <span class="token keyword">where</span> sdept<span class="token operator">=</span><span class="token string">\'CS\'</span><span class="token punctuation">)</span><span class="token operator">and</span> sdept<span class="token operator">&lt;></span><span class="token string">\'CS\'</span><span class="token punctuation">;</span>\r\n<span class="token comment">#44 学数据库的同学有谁</span>\r\n<span class="token keyword">select</span> sname <span class="token keyword">from</span> student <span class="token keyword">where</span> <span class="token keyword">exists</span> <span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> sc <span class="token keyword">where</span> sno<span class="token operator">=</span>student<span class="token punctuation">.</span>sno <span class="token operator">and</span> cno<span class="token operator">=</span><span class="token string">\'1\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\r\n<span class="token keyword">select</span> sname <span class="token keyword">from</span> student <span class="token keyword">where</span> sno <span class="token operator">in</span> <span class="token punctuation">(</span><span class="token keyword">select</span> sno <span class="token keyword">from</span> sc <span class="token keyword">where</span> cno<span class="token operator">=</span><span class="token string">\'1\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\r\n<span class="token keyword">select</span> sname <span class="token keyword">from</span> student<span class="token punctuation">,</span> sc <span class="token keyword">where</span> sc<span class="token punctuation">.</span>sno<span class="token operator">=</span>student<span class="token punctuation">.</span>sno <span class="token operator">and</span> cno<span class="token operator">=</span><span class="token string">\'1\'</span><span class="token punctuation">;</span>\r\n<span class="token comment">#45 不学数据库的同学有谁</span>\r\n<span class="token keyword">select</span> sname <span class="token keyword">from</span> student <span class="token keyword">where</span> <span class="token operator">not</span> <span class="token keyword">exists</span> <span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> sc <span class="token keyword">where</span> sno<span class="token operator">=</span>student<span class="token punctuation">.</span>sno <span class="token operator">and</span> cno<span class="token operator">=</span><span class="token string">\'1\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\r\n<span class="token comment">#46 </span>\r\n<span class="token comment"># 查询选修了全部课程的学生姓名</span>\r\n<span class="token keyword">select</span> sname <span class="token keyword">from</span> student <span class="token keyword">where</span> <span class="token operator">not</span> <span class="token keyword">exists</span> <span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> course <span class="token keyword">where</span> <span class="token operator">not</span> <span class="token keyword">exists</span> <span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> sc <span class="token keyword">where</span> sno<span class="token operator">=</span>student<span class="token punctuation">.</span>sno <span class="token operator">and</span> cno<span class="token operator">=</span>course<span class="token punctuation">.</span>cno<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\r\n<span class="token comment"># 查询选修了全部已开课程的学生姓名</span>\r\n<span class="token keyword">select</span> sname <span class="token keyword">from</span> student <span class="token keyword">where</span> <span class="token operator">not</span> <span class="token keyword">exists</span> <span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> sc x <span class="token keyword">where</span> <span class="token operator">not</span> <span class="token keyword">exists</span> <span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> sc y <span class="token keyword">where</span> sno<span class="token operator">=</span>student<span class="token punctuation">.</span>sno <span class="token operator">and</span> x<span class="token punctuation">.</span>cno<span class="token operator">=</span>y<span class="token punctuation">.</span>cno<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\r\n<span class="token comment">#47</span>\r\n<span class="token comment"># 查询至少选修了学生200215122选修的全部课程的学生号码</span>\r\n<span class="token keyword">select</span> <span class="token keyword">distinct</span> sno <span class="token keyword">from</span> sc scx <span class="token keyword">where</span> <span class="token operator">not</span> <span class="token keyword">exists</span><span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> sc scy <span class="token keyword">where</span> sno<span class="token operator">=</span><span class="token string">\'200215122\'</span> <span class="token operator">and</span> <span class="token operator">not</span> <span class="token keyword">exists</span><span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> sc scz <span class="token keyword">where</span> scz<span class="token punctuation">.</span>sno<span class="token operator">=</span>scx<span class="token punctuation">.</span>sno <span class="token operator">and</span> scz<span class="token punctuation">.</span>cno<span class="token operator">=</span>scy<span class="token punctuation">.</span>cno<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\r\n<span class="token comment">#48</span>\r\n<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> student <span class="token keyword">where</span> sdept<span class="token operator">=</span><span class="token string">\'CS\'</span> <span class="token keyword">union</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> student <span class="token keyword">where</span> sage<span class="token operator">&lt;=</span><span class="token number">19</span><span class="token punctuation">;</span>\r\n<span class="token comment">#49</span>\r\n<span class="token keyword">select</span> sno <span class="token keyword">from</span> sc <span class="token keyword">where</span> cno<span class="token operator">=</span><span class="token string">\'1\'</span> <span class="token keyword">union</span> <span class="token keyword">select</span> sno <span class="token keyword">from</span> sc <span class="token keyword">where</span> cno<span class="token operator">=</span><span class="token string">\'2\'</span><span class="token punctuation">;</span>\r\n<span class="token comment">#50 学cs同时不小于19岁的</span>\r\n<span class="token comment">-- select * from student where sdept=\'CS\' intersect select * from student where sage&lt;=19;</span>\r\n<span class="token keyword">select</span> s1<span class="token punctuation">.</span><span class="token operator">*</span> <span class="token keyword">from</span> student s1 <span class="token keyword">left</span> <span class="token keyword">join</span> student s2 <span class="token keyword">on</span> s1<span class="token punctuation">.</span>sno<span class="token operator">=</span>s2<span class="token punctuation">.</span>sno <span class="token keyword">where</span> s1<span class="token punctuation">.</span>sdept<span class="token operator">=</span><span class="token string">\'CS\'</span> <span class="token operator">and</span> s1<span class="token punctuation">.</span>sage<span class="token operator">&lt;=</span><span class="token number">19</span><span class="token punctuation">;</span>\r\n<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> student <span class="token keyword">where</span> sdept<span class="token operator">=</span><span class="token string">\'CS\'</span> <span class="token operator">and</span> sage<span class="token operator">&lt;=</span><span class="token number">19</span><span class="token punctuation">;</span>\r\n<span class="token comment">#51</span>\r\n<span class="token comment">#select sno from sc where cno=\'1\' intersect select sno from sc where cno=\'2\';</span>\r\n<span class="token keyword">select</span> sno <span class="token keyword">from</span> sc <span class="token keyword">where</span> cno<span class="token operator">=</span><span class="token string">\'1\'</span> <span class="token operator">and</span> sno <span class="token operator">in</span> <span class="token punctuation">(</span><span class="token keyword">select</span> sno <span class="token keyword">from</span> sc <span class="token keyword">where</span> cno<span class="token operator">=</span><span class="token string">\'2\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\r\n<span class="token keyword">select</span> scx<span class="token punctuation">.</span>sno <span class="token keyword">from</span> sc scx<span class="token punctuation">,</span>sc scy <span class="token keyword">where</span> scx<span class="token punctuation">.</span>sno<span class="token operator">=</span>scy<span class="token punctuation">.</span>sno <span class="token operator">and</span> scx<span class="token punctuation">.</span>cno<span class="token operator">=</span><span class="token string">\'1\'</span> <span class="token operator">and</span> scy<span class="token punctuation">.</span>cno<span class="token operator">=</span><span class="token string">\'2\'</span><span class="token punctuation">;</span>\r\n<span class="token comment">#52</span>\r\n<span class="token comment">#select * from student where sdept=\'CS\' except select * from student where sage&lt;=19;</span>\r\n<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> student <span class="token keyword">where</span> sdept<span class="token operator">=</span><span class="token string">\'CS\'</span> <span class="token operator">and</span> sage<span class="token operator">></span><span class="token number">19</span><span class="token punctuation">;</span>\r\n<span class="token comment">#53</span>\r\n<span class="token keyword">insert</span> <span class="token keyword">into</span> student <span class="token punctuation">(</span>sno<span class="token punctuation">,</span>sname<span class="token punctuation">,</span>ssex<span class="token punctuation">,</span>sdept<span class="token punctuation">,</span>sage<span class="token punctuation">)</span> <span class="token keyword">values</span> <span class="token punctuation">(</span><span class="token string">\'200215129\'</span><span class="token punctuation">,</span><span class="token string">\'陈东\'</span><span class="token punctuation">,</span><span class="token string">\'男\'</span><span class="token punctuation">,</span><span class="token string">\'IS\'</span><span class="token punctuation">,</span><span class="token number">18</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\r\n<span class="token comment">#54</span>\r\n<span class="token keyword">insert</span> <span class="token keyword">into</span> student <span class="token keyword">values</span> <span class="token punctuation">(</span><span class="token string">\'200215130\'</span><span class="token punctuation">,</span><span class="token string">\'张成民\'</span><span class="token punctuation">,</span><span class="token string">\'男\'</span><span class="token punctuation">,</span><span class="token number">18</span><span class="token punctuation">,</span><span class="token string">\'CS\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\r\n<span class="token comment">#55</span>\r\n<span class="token keyword">insert</span> <span class="token keyword">into</span> sc <span class="token punctuation">(</span>sno<span class="token punctuation">,</span>cno<span class="token punctuation">)</span> <span class="token keyword">values</span> <span class="token punctuation">(</span><span class="token string">\'200215128\'</span><span class="token punctuation">,</span><span class="token string">\'1\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\r\n<span class="token keyword">insert</span> <span class="token keyword">into</span> sc <span class="token keyword">values</span> <span class="token punctuation">(</span><span class="token string">\'200215129\'</span><span class="token punctuation">,</span><span class="token string">\'1\'</span><span class="token punctuation">,</span><span class="token boolean">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\r\n<span class="token comment">#56</span>\r\n<span class="token keyword">create</span> <span class="token keyword">table</span> dept_age\r\n<span class="token punctuation">(</span>\r\n sdept <span class="token keyword">char</span><span class="token punctuation">(</span><span class="token number">15</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\r\n avg_age <span class="token keyword">smallint</span>\r\n<span class="token punctuation">)</span><span class="token punctuation">;</span>\r\n<span class="token keyword">insert</span> <span class="token keyword">into</span> dept_age <span class="token punctuation">(</span>sdept<span class="token punctuation">,</span>avg_age<span class="token punctuation">)</span> <span class="token keyword">select</span> sdept<span class="token punctuation">,</span><span class="token function">avg</span><span class="token punctuation">(</span>sage<span class="token punctuation">)</span> <span class="token keyword">from</span> student <span class="token keyword">group</span> <span class="token keyword">by</span> sdept<span class="token punctuation">;</span>\r\n<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> dept_age<span class="token punctuation">;</span>\r\n<span class="token comment">#57</span>\r\n<span class="token keyword">update</span> student <span class="token keyword">set</span> sage<span class="token operator">=</span><span class="token number">22</span> <span class="token keyword">where</span> sno<span class="token operator">=</span><span class="token string">\'200215121\'</span><span class="token punctuation">;</span>\r\n<span class="token comment">#58</span>\r\n<span class="token keyword">update</span> student <span class="token keyword">set</span> sage<span class="token operator">=</span>sage<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">;</span>\r\n<span class="token comment">#59</span>\r\n<span class="token keyword">update</span> sc <span class="token keyword">set</span> grade<span class="token operator">=</span><span class="token number">0</span> <span class="token keyword">where</span> <span class="token string">\'CS\'</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token keyword">select</span> sdept <span class="token keyword">from</span> student <span class="token keyword">where</span> student<span class="token punctuation">.</span>sno<span class="token operator">=</span>sc<span class="token punctuation">.</span>sno<span class="token punctuation">)</span><span class="token punctuation">;</span>\r\n<span class="token keyword">update</span> sc <span class="token keyword">set</span> grade<span class="token operator">=</span><span class="token number">100</span> <span class="token keyword">where</span> sno <span class="token operator">in</span> <span class="token punctuation">(</span><span class="token keyword">select</span> sno <span class="token keyword">from</span>  student <span class="token keyword">where</span> sdept<span class="token operator">=</span><span class="token string">\'CS\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\r\n<span class="token comment">#60\t建立计算机系学生的视图</span>\r\n<span class="token keyword">create</span> <span class="token keyword">view</span> CS_Student <span class="token keyword">as</span> <span class="token keyword">select</span> sno<span class="token punctuation">,</span>sname<span class="token punctuation">,</span>sage <span class="token keyword">from</span> student <span class="token keyword">where</span> sdept<span class="token operator">=</span><span class="token string">\'CS\'</span><span class="token punctuation">;</span>\r\n<span class="token comment">#61\t建立计算机系学生的视图，并按要求进行修改和插入时仍需保证该视图只有计算机系的学生</span>\r\n<span class="token keyword">create</span> <span class="token keyword">view</span> CS_Student_Check <span class="token keyword">as</span> <span class="token keyword">select</span> sno<span class="token punctuation">,</span>sname<span class="token punctuation">,</span>sage <span class="token keyword">from</span> student <span class="token keyword">where</span> sdept<span class="token operator">=</span><span class="token string">\'CS\'</span> <span class="token keyword">with</span> <span class="token keyword">check</span> <span class="token keyword">option</span><span class="token punctuation">;</span>\r\n<span class="token comment">#62\t建立计算机系选修了1号课程的学生的视图</span>\r\n<span class="token keyword">create</span> <span class="token keyword">view</span> CS_S1<span class="token punctuation">(</span>sno<span class="token punctuation">,</span>sname<span class="token punctuation">,</span>grade<span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token keyword">select</span> student<span class="token punctuation">.</span>sno<span class="token punctuation">,</span>sname<span class="token punctuation">,</span>grade <span class="token keyword">from</span> student<span class="token punctuation">,</span>sc <span class="token keyword">where</span> sdept<span class="token operator">=</span><span class="token string">\'CS\'</span> <span class="token operator">and</span> student<span class="token punctuation">.</span>sno<span class="token operator">=</span>sc<span class="token punctuation">.</span>sno <span class="token operator">and</span> sc<span class="token punctuation">.</span>cno<span class="token operator">=</span><span class="token string">\'1\'</span><span class="token punctuation">;</span>\r\n<span class="token comment">#63\t建立计算机系选修了1号课程且成绩在90分以上的学生的视图</span>\r\n<span class="token keyword">create</span> <span class="token keyword">view</span> CS_S2 <span class="token keyword">as</span> <span class="token keyword">select</span> sno<span class="token punctuation">,</span>sname<span class="token punctuation">,</span>grade <span class="token keyword">from</span> CS_S1 <span class="token keyword">where</span> grade<span class="token operator">>=</span><span class="token number">90</span><span class="token punctuation">;</span>\r\n<span class="token comment">#64\t定义一个反映学生出生年份的视图</span>\r\n<span class="token keyword">create</span> <span class="token keyword">view</span> BT_S<span class="token punctuation">(</span>sno<span class="token punctuation">,</span>sname<span class="token punctuation">,</span>sbirth<span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token keyword">select</span> sno<span class="token punctuation">,</span>sname<span class="token punctuation">,</span><span class="token number">2004</span><span class="token operator">-</span>sage <span class="token keyword">from</span> student<span class="token punctuation">;</span>\r\n<span class="token comment">#65 将学生的学号及他的平均成绩定义为一个视图</span>\r\n<span class="token keyword">create</span> <span class="token keyword">view</span> S_G<span class="token punctuation">(</span>sno<span class="token punctuation">,</span>gavg<span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token keyword">select</span> sno<span class="token punctuation">,</span><span class="token function">avg</span><span class="token punctuation">(</span>grade<span class="token punctuation">)</span> <span class="token keyword">from</span> sc <span class="token keyword">group</span> <span class="token keyword">by</span> sno<span class="token punctuation">;</span>\r\n<span class="token comment">#66\t将student表中的所有女生记录定义为一个视图</span>\r\n<span class="token keyword">create</span> <span class="token keyword">view</span> F_Student <span class="token keyword">as</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> student <span class="token keyword">where</span> ssex<span class="token operator">=</span><span class="token string">\'女\'</span><span class="token punctuation">;</span>\r\n<span class="token comment">#67\t在计算机系学生的视图中找出年龄小于20岁的学生</span>\r\n<span class="token keyword">select</span> sno<span class="token punctuation">,</span>sage <span class="token keyword">from</span> CS_Student <span class="token keyword">where</span> sage<span class="token operator">&lt;=</span><span class="token number">20</span><span class="token punctuation">;</span>\r\n<span class="token comment">#68\t查询选修了1号课程的计算机系的学生</span>\r\n<span class="token keyword">select</span> CS_Student<span class="token punctuation">.</span>sno<span class="token punctuation">,</span>sname <span class="token keyword">from</span> CS_Student<span class="token punctuation">,</span>sc <span class="token keyword">where</span> CS_Student<span class="token punctuation">.</span>sno<span class="token operator">=</span>sc<span class="token punctuation">.</span>sno <span class="token operator">and</span> sc<span class="token punctuation">.</span>cno<span class="token operator">=</span><span class="token string">\'1\'</span><span class="token punctuation">;</span>\r\n<span class="token comment">#69\t在S_G视图中查询平均成绩在90分以上的学生学号和平均成绩</span>\r\n<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> S_G <span class="token keyword">where</span> gavg<span class="token operator">>=</span><span class="token number">90</span><span class="token punctuation">;</span>\r\n<span class="token keyword">select</span> sno<span class="token punctuation">,</span><span class="token function">avg</span><span class="token punctuation">(</span>grade<span class="token punctuation">)</span> <span class="token keyword">from</span> sc <span class="token keyword">group</span> <span class="token keyword">by</span> sno <span class="token keyword">having</span> <span class="token function">avg</span><span class="token punctuation">(</span>grade<span class="token punctuation">)</span><span class="token operator">>=</span><span class="token number">90</span><span class="token punctuation">;</span>\r\n<span class="token comment">#70\t将计算机系学生视图CS_Student中学号为200215122的学生姓名改为刘辰</span>\r\n<span class="token keyword">update</span> CS_Student <span class="token keyword">set</span> sname<span class="token operator">=</span><span class="token string">\'刘辰\'</span> <span class="token keyword">where</span> sno<span class="token operator">=</span><span class="token string">\'200215122\'</span><span class="token punctuation">;</span>\r\n<span class="token keyword">update</span> student <span class="token keyword">set</span> sname<span class="token operator">=</span><span class="token string">\'刘辰\'</span> <span class="token keyword">where</span> sno<span class="token operator">=</span><span class="token string">\'200215122\'</span> <span class="token operator">and</span> sdept<span class="token operator">=</span><span class="token string">\'CS\'</span><span class="token punctuation">;</span>\r\n<span class="token comment">#71\t向计算机系的学生视图CS_Student中插入一个新的学生记录，其中学号为200215129，姓名为赵新，年龄为20岁</span>\r\n<span class="token keyword">insert</span> <span class="token keyword">into</span> CS_Student <span class="token keyword">values</span> <span class="token punctuation">(</span><span class="token string">\'200215131\'</span><span class="token punctuation">,</span><span class="token string">\'赵新\'</span><span class="token punctuation">,</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\r\n<span class="token keyword">insert</span> <span class="token keyword">into</span> student<span class="token punctuation">(</span>sno<span class="token punctuation">,</span>sname<span class="token punctuation">,</span>sage<span class="token punctuation">,</span>sdept<span class="token punctuation">)</span> <span class="token keyword">values</span> <span class="token punctuation">(</span><span class="token string">\'200215131\'</span><span class="token punctuation">,</span><span class="token string">\'赵新\'</span><span class="token punctuation">,</span><span class="token number">20</span><span class="token punctuation">,</span><span class="token string">\'CS\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\r\n<span class="token comment">#72\t删除计算机学生视图CS_Student中学号为200215129的记录</span>\r\n<span class="token keyword">delete</span> <span class="token keyword">from</span> CS_Student <span class="token keyword">where</span> sno<span class="token operator">=</span><span class="token string">\'200215131\'</span><span class="token punctuation">;</span>\r\n<span class="token keyword">delete</span> <span class="token keyword">from</span> student <span class="token keyword">where</span> sno<span class="token operator">=</span><span class="token string">\'200215131\'</span> <span class="token operator">and</span> sdept<span class="token operator">=</span><span class="token string">\'CS\'</span><span class="token punctuation">;</span>\r\n<span class="token comment">#60</span>\r\n<span class="token keyword">delete</span> <span class="token keyword">from</span> sc <span class="token keyword">where</span> sno<span class="token operator">=</span><span class="token string">\'200215128\'</span><span class="token punctuation">;</span>\r\n<span class="token keyword">delete</span> <span class="token keyword">from</span> student <span class="token keyword">where</span> sno<span class="token operator">=</span><span class="token string">\'200215128\'</span><span class="token punctuation">;</span>\r\n<span class="token comment">#61</span>\r\n<span class="token keyword">delete</span> <span class="token keyword">from</span> sc <span class="token keyword">where</span> <span class="token string">\'CS\'</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token keyword">select</span> sdept <span class="token keyword">from</span> student <span class="token keyword">where</span> student<span class="token punctuation">.</span>sno<span class="token operator">=</span>sc<span class="token punctuation">.</span>sno<span class="token punctuation">)</span><span class="token punctuation">;</span>\r\n<span class="token comment">#62</span>\r\n<span class="token keyword">delete</span> <span class="token keyword">from</span> sc<span class="token punctuation">;</span>\r\n<span class="token comment">#67 删除视图</span>\r\n<span class="token keyword">drop</span> <span class="token keyword">view</span>\tBT_S<span class="token punctuation">;</span>\r\n<span class="token keyword">drop</span> <span class="token keyword">view</span> CS_S1 <span class="token keyword">cascade</span><span class="token punctuation">;</span></code></pre>\n        </div></p>\n<h1 id="需求背景"><a href="#%E9%9C%80%E6%B1%82%E8%83%8C%E6%99%AF" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>需求背景</h1>\n<p>已知始发站、终点站，如何查出满足条件的方案线路？即根据一个表关联多个表时如何查询相关字段？</p>\n<h1 id="sql-语句"><a href="#sql-%E8%AF%AD%E5%8F%A5" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>sql 语句</h1>\n<p>根据以上的前置知识可得出一对多下的查询应该这样写：</p>\n<p><div class="gatsby-highlight">\n        <pre class="language-sql"><code><span class="token keyword">DROP</span> <span class="token keyword">TABLE</span> <span class="token keyword">IF</span> <span class="token keyword">EXISTS</span> <span class="token punctuation">`</span>sugo_train_scheme<span class="token punctuation">`</span><span class="token punctuation">;</span>\r\n<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token punctuation">`</span>sugo_train_scheme<span class="token punctuation">`</span>  <span class="token punctuation">(</span>\r\n  <span class="token punctuation">`</span>created_at<span class="token punctuation">`</span> <span class="token keyword">datetime</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">\'创建时间\'</span><span class="token punctuation">,</span>\r\n  <span class="token punctuation">`</span>updated_at<span class="token punctuation">`</span> <span class="token keyword">datetime</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">\'更新时间\'</span><span class="token punctuation">,</span>\r\n  <span class="token punctuation">`</span>deleted_at<span class="token punctuation">`</span> <span class="token keyword">datetime</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">\'删除时间\'</span><span class="token punctuation">,</span>\r\n  <span class="token punctuation">`</span>id<span class="token punctuation">`</span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">)</span> <span class="token keyword">CHARACTER</span> <span class="token keyword">SET</span> utf8 <span class="token keyword">COLLATE</span> utf8_general_ci <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">\'主键ID\'</span><span class="token punctuation">,</span>\r\n  <span class="token punctuation">`</span>name<span class="token punctuation">`</span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">512</span><span class="token punctuation">)</span> <span class="token keyword">CHARACTER</span> <span class="token keyword">SET</span> utf8 <span class="token keyword">COLLATE</span> utf8_general_ci <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">\'方案名称\'</span><span class="token punctuation">,</span>\r\n  <span class="token punctuation">`</span><span class="token keyword">status</span><span class="token punctuation">`</span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">)</span> <span class="token keyword">CHARACTER</span> <span class="token keyword">SET</span> utf8 <span class="token keyword">COLLATE</span> utf8_general_ci <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">\'方案报告状态，生成中：generating，已生成：generated\'</span><span class="token punctuation">,</span>\r\n  <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token punctuation">`</span>id<span class="token punctuation">`</span><span class="token punctuation">)</span> <span class="token keyword">USING</span> <span class="token keyword">BTREE</span>\r\n<span class="token punctuation">)</span> <span class="token keyword">ENGINE</span> <span class="token operator">=</span> <span class="token keyword">InnoDB</span> <span class="token keyword">CHARACTER</span> <span class="token keyword">SET</span> <span class="token operator">=</span> utf8 <span class="token keyword">COLLATE</span> <span class="token operator">=</span> utf8_general_ci <span class="token keyword">COMMENT</span> <span class="token operator">=</span> <span class="token string">\'车次方案列表 \'</span> ROW_FORMAT <span class="token operator">=</span> Dynamic<span class="token punctuation">;</span>\r\n\r\n<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token punctuation">`</span>sugo_train_scheme<span class="token punctuation">`</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token boolean">NULL</span><span class="token punctuation">,</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span> <span class="token string">\'1\'</span><span class="token punctuation">,</span> <span class="token string">\'32\'</span><span class="token punctuation">,</span> <span class="token boolean">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\r\n<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token punctuation">`</span>sugo_train_scheme<span class="token punctuation">`</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token boolean">NULL</span><span class="token punctuation">,</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span> <span class="token string">\'2\'</span><span class="token punctuation">,</span> <span class="token string">\'sfaf\'</span><span class="token punctuation">,</span> <span class="token string">\'\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\r\n\r\n<span class="token keyword">DROP</span> <span class="token keyword">TABLE</span> <span class="token keyword">IF</span> <span class="token keyword">EXISTS</span> <span class="token punctuation">`</span>sugo_train_scheme_ponit_info<span class="token punctuation">`</span><span class="token punctuation">;</span>\r\n<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token punctuation">`</span>sugo_train_scheme_ponit_info<span class="token punctuation">`</span>  <span class="token punctuation">(</span>\r\n  <span class="token punctuation">`</span>created_at<span class="token punctuation">`</span> <span class="token keyword">datetime</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">\'创建时间\'</span><span class="token punctuation">,</span>\r\n  <span class="token punctuation">`</span>updated_at<span class="token punctuation">`</span> <span class="token keyword">datetime</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">\'更新时间\'</span><span class="token punctuation">,</span>\r\n  <span class="token punctuation">`</span>deleted_at<span class="token punctuation">`</span> <span class="token keyword">datetime</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">\'删除时间\'</span><span class="token punctuation">,</span>\r\n  <span class="token punctuation">`</span>id<span class="token punctuation">`</span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">)</span> <span class="token keyword">CHARACTER</span> <span class="token keyword">SET</span> utf8 <span class="token keyword">COLLATE</span> utf8_general_ci <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">\'主键ID\'</span><span class="token punctuation">,</span>\r\n  <span class="token punctuation">`</span>scheme_id<span class="token punctuation">`</span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">)</span> <span class="token keyword">CHARACTER</span> <span class="token keyword">SET</span> utf8 <span class="token keyword">COLLATE</span> utf8_general_ci <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">\'方案ID\'</span><span class="token punctuation">,</span>\r\n  <span class="token punctuation">`</span>zm<span class="token punctuation">`</span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">64</span><span class="token punctuation">)</span> <span class="token keyword">CHARACTER</span> <span class="token keyword">SET</span> utf8 <span class="token keyword">COLLATE</span> utf8_general_ci <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">\'站名\'</span><span class="token punctuation">,</span>\r\n  <span class="token punctuation">`</span>zmdm<span class="token punctuation">`</span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">64</span><span class="token punctuation">)</span> <span class="token keyword">CHARACTER</span> <span class="token keyword">SET</span> utf8 <span class="token keyword">COLLATE</span> utf8_general_ci <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">\'站名代码\'</span><span class="token punctuation">,</span>\r\n  <span class="token punctuation">`</span>zmlx<span class="token punctuation">`</span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">)</span> <span class="token keyword">CHARACTER</span> <span class="token keyword">SET</span> utf8 <span class="token keyword">COLLATE</span> utf8_general_ci <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">\'站名类型\'</span><span class="token punctuation">,</span>\r\n  <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token punctuation">`</span>id<span class="token punctuation">`</span><span class="token punctuation">)</span> <span class="token keyword">USING</span> <span class="token keyword">BTREE</span>\r\n<span class="token punctuation">)</span> <span class="token keyword">ENGINE</span> <span class="token operator">=</span> <span class="token keyword">InnoDB</span> <span class="token keyword">CHARACTER</span> <span class="token keyword">SET</span> <span class="token operator">=</span> utf8 <span class="token keyword">COLLATE</span> <span class="token operator">=</span> utf8_general_ci <span class="token keyword">COMMENT</span> <span class="token operator">=</span> <span class="token string">\'车次方案查询条件站点信息 \'</span> ROW_FORMAT <span class="token operator">=</span> Dynamic<span class="token punctuation">;</span>\r\n\r\n<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token punctuation">`</span>sugo_train_scheme_ponit_info<span class="token punctuation">`</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token boolean">NULL</span><span class="token punctuation">,</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span> <span class="token string">\'23\'</span><span class="token punctuation">,</span> <span class="token string">\'1\'</span><span class="token punctuation">,</span> <span class="token string">\'长沙\'</span><span class="token punctuation">,</span> <span class="token string">\'23\'</span><span class="token punctuation">,</span> <span class="token string">\'start\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\r\n<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token punctuation">`</span>sugo_train_scheme_ponit_info<span class="token punctuation">`</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token boolean">NULL</span><span class="token punctuation">,</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span> <span class="token string">\'24\'</span><span class="token punctuation">,</span> <span class="token string">\'1\'</span><span class="token punctuation">,</span> <span class="token string">\'武汉\'</span><span class="token punctuation">,</span> <span class="token string">\'555\'</span><span class="token punctuation">,</span> <span class="token string">\'pass\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\r\n<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token punctuation">`</span>sugo_train_scheme_ponit_info<span class="token punctuation">`</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token boolean">NULL</span><span class="token punctuation">,</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span> <span class="token string">\'25\'</span><span class="token punctuation">,</span> <span class="token string">\'1\'</span><span class="token punctuation">,</span> <span class="token string">\'湘潭\'</span><span class="token punctuation">,</span> <span class="token string">\'666\'</span><span class="token punctuation">,</span> <span class="token string">\'end\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\r\n<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token punctuation">`</span>sugo_train_scheme_ponit_info<span class="token punctuation">`</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token boolean">NULL</span><span class="token punctuation">,</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span> <span class="token string">\'3\'</span><span class="token punctuation">,</span> <span class="token string">\'2\'</span><span class="token punctuation">,</span> <span class="token string">\'武汉\'</span><span class="token punctuation">,</span> <span class="token string">\'555\'</span><span class="token punctuation">,</span> <span class="token string">\'start\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\r\n<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token punctuation">`</span>sugo_train_scheme_ponit_info<span class="token punctuation">`</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token boolean">NULL</span><span class="token punctuation">,</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span> <span class="token string">\'4\'</span><span class="token punctuation">,</span> <span class="token string">\'2\'</span><span class="token punctuation">,</span> <span class="token string">\'湘潭\'</span><span class="token punctuation">,</span> <span class="token string">\'666\'</span><span class="token punctuation">,</span> <span class="token string">\'end\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\r\n\r\n<span class="token comment"># 查一对多的方法，使用 in</span>\r\n<span class="token keyword">SELECT</span>\r\n\t<span class="token operator">*</span> \r\n<span class="token keyword">FROM</span>\r\n\tsugo_train_scheme a<span class="token punctuation">,</span>\r\n\tsugo_train_scheme_ponit_info b \r\n<span class="token keyword">WHERE</span>\r\n\ta<span class="token punctuation">.</span>id <span class="token operator">=</span> b<span class="token punctuation">.</span>scheme_id \r\n\t<span class="token operator">AND</span> a<span class="token punctuation">.</span>id <span class="token operator">IN</span> <span class="token punctuation">(</span> <span class="token keyword">SELECT</span> scheme_id <span class="token keyword">FROM</span> sugo_train_scheme_ponit_info <span class="token keyword">WHERE</span> zmdm <span class="token operator">=</span> <span class="token string">\'23\'</span> <span class="token operator">AND</span> zmlx <span class="token operator">=</span> <span class="token string">\'start\'</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>\r\n\r\n<span class="token comment"># 查一对多的方法，使用自连接</span>\r\n<span class="token keyword">SELECT</span>\r\n\ta<span class="token punctuation">.</span><span class="token operator">*</span><span class="token punctuation">,</span>\r\n\tb<span class="token punctuation">.</span><span class="token operator">*</span> \r\n<span class="token keyword">FROM</span>\r\n\tsugo_train_scheme a<span class="token punctuation">,</span>\r\n\tsugo_train_scheme_ponit_info b<span class="token punctuation">,</span>\r\n\tsugo_train_scheme_ponit_info c \r\n<span class="token keyword">WHERE</span>\r\n\ta<span class="token punctuation">.</span>id <span class="token operator">=</span> b<span class="token punctuation">.</span>scheme_id \r\n\t<span class="token operator">AND</span> b<span class="token punctuation">.</span>scheme_id <span class="token operator">=</span> c<span class="token punctuation">.</span>scheme_id \r\n\t<span class="token operator">AND</span> c<span class="token punctuation">.</span>zmdm <span class="token operator">=</span> <span class="token string">\'23\'</span> \r\n\t<span class="token operator">AND</span> c<span class="token punctuation">.</span>zmlx <span class="token operator">=</span> <span class="token string">\'start\'</span><span class="token punctuation">;</span>\r\n\r\n<span class="token comment"># 查一对多的方法，使用 exists，一次查询不能顺带查出线路表</span>\r\n<span class="token keyword">SELECT</span>\r\n\t<span class="token operator">*</span> \r\n<span class="token keyword">FROM</span>\r\n\tsugo_train_scheme a\r\n<span class="token keyword">WHERE</span>\r\n\t<span class="token keyword">EXISTS</span> <span class="token punctuation">(</span> <span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> sugo_train_scheme_ponit_info b <span class="token keyword">WHERE</span> b<span class="token punctuation">.</span>scheme_id<span class="token operator">=</span>a<span class="token punctuation">.</span>id <span class="token operator">and</span> b<span class="token punctuation">.</span>zmdm <span class="token operator">=</span> <span class="token string">\'23\'</span> <span class="token operator">AND</span> b<span class="token punctuation">.</span>zmlx <span class="token operator">=</span> <span class="token string">\'start\'</span> <span class="token punctuation">)</span></code></pre>\n        </div></p>\n<h1 id="sequelize-下的解决方案"><a href="#sequelize-%E4%B8%8B%E7%9A%84%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Sequelize 下的解决方案</h1>\n<ol>\n<li>从表的设计上考虑：将始发站、终点站写在主表中，无需考虑一对多的问题</li>\n<li>根据以上的 sql 语句利用 Sequelize 去关联</li>\n</ol>\n<p>最终为了实现上的简便，直接使用方案 1</p>',
id:"/github/workspace/blog/Sequelize一对多查询解决方案/index.md absPath of file >>> MarkdownRemark",timeToRead:10,frontmatter:{date:"2021-01-05 13:55:57",path:"/sequelize-one-to-many-find-solution/",tags:"后端, nodejs, Sequelize, SQL",title:"Sequelize一对多查询解决方案",draft:null}},{excerpt:"项目架构 公司项目分为以下几种架构： 主项目-扩展项目：扩展项目前端独立，是以 npm 包的形式安装到主项目，后端可以独立编译，但不能独立运行，即后端与主项目共用一套，主项目需要对扩展项目编译出的后端代码进行监听来实现增量编译 主项目-子项目：微前端架构，子项目前、后端独立可运行 需求背景 需要解决主项目-扩展项目架构下主项目的后端不能增量编译的问题 技术选型 选型 优点 缺点 直接在 node_modules 目录下开发 主项目已实现对 node_modules 下扩展项目的监听 每次 npm…",html:'<h1 id="项目架构"><a href="#%E9%A1%B9%E7%9B%AE%E6%9E%B6%E6%9E%84" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>项目架构</h1>\n<p>公司项目分为以下几种架构：</p>\n<ol>\n<li>主项目-扩展项目：扩展项目前端独立，是以 npm 包的形式安装到主项目，后端可以独立编译，但不能独立运行，即后端与主项目共用一套，主项目需要对扩展项目编译出的后端代码进行监听来实现增量编译</li>\n<li>主项目-子项目：微前端架构，子项目前、后端独立可运行</li>\n</ol>\n<h1 id="需求背景"><a href="#%E9%9C%80%E6%B1%82%E8%83%8C%E6%99%AF" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>需求背景</h1>\n<p>需要解决主项目-扩展项目架构下主项目的后端不能增量编译的问题</p>\n<h1 id="技术选型"><a href="#%E6%8A%80%E6%9C%AF%E9%80%89%E5%9E%8B" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>技术选型</h1>\n<table>\n<thead>\n<tr>\n<th align="center">选型</th>\n<th align="center">优点</th>\n<th align="center">缺点</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td align="center">直接在 node_modules 目录下开发</td>\n<td align="center">主项目已实现对 node_modules 下扩展项目的监听</td>\n<td align="center">每次 npm install 都要重新新建项目</td>\n</tr>\n<tr>\n<td align="center">gulp 文件同步</td>\n<td align="center">有第三方插件</td>\n<td align="center">需要多运行一个文件同步脚本</td>\n</tr>\n<tr>\n<td align="center">npm link</td>\n<td align="center">不需要多运行一个脚本</td>\n<td align="center">需要每次手动重启主项目来让后端代码生效</td>\n</tr>\n<tr>\n<td align="center">nodemon + npm link</td>\n<td align="center">监听到扩展项目变化自动重启</td>\n<td align="center">每次 npm install 都要重新 npm link</td>\n</tr>\n</tbody>\n</table>\n<h1 id="解决过程"><a href="#%E8%A7%A3%E5%86%B3%E8%BF%87%E7%A8%8B" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>解决过程</h1>\n<h2 id="gulp-文件同步"><a href="#gulp-%E6%96%87%E4%BB%B6%E5%90%8C%E6%AD%A5" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>gulp 文件同步</h2>\n<p>核心逻辑：监听扩展项目编译出来的后端代码，发现改动时同步到 node_modules 下扩展项目的位置</p>\n<p>./config.js</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="54127023807999890000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`module.exports = {\n  //同步文件更改到指定目录\n  syncTo: \'../主项目/node_modules/扩展项目/extend\'\n};`, `54127023807999890000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                js 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>\n  <span class="token comment">//同步文件更改到指定目录</span>\n  syncTo<span class="token punctuation">:</span> <span class="token string">\'../主项目/node_modules/扩展项目/extend\'</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>./gulpfile.js</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="93685592944135080000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`const gulp = require(\'gulp\');\nconst fileSync = require(\'gulp-file-sync\');\nconst { syncTo } = require(\'./config\');\nconst mkdirp = require(\'mkdirp\');\nconst fs = require(\'fs\');\nconst watch = require(\'gulp-watch\');\nconst run = require(\'run-sequence\');\n\ngulp.task(\'sync\', function() {\n  try {\n    let state = fs.statSync(syncTo);\n    if (!state.isDirectory()) {\n      mkdirp(syncTo);\n    }\n  } catch (e) {\n    console.log(e);\n    mkdirp(syncTo);\n  }\n\n  fileSync(\'extend\', syncTo);\n});\n\ngulp.task(\'watch-extend\', function() {\n  watch([\'./extend/**\'], function() {\n    run(\'sync\');\n  });\n});\n\ngulp.task(\'watch\', [\'watch-extend\']);\n\ngulp.task(\'default\', [\'sync\', \'watch\']);`, `93685592944135080000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                js 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">const</span> gulp <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'gulp\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">const</span> fileSync <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'gulp-file-sync\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">const</span> <span class="token punctuation">{</span> syncTo <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'./config\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">const</span> mkdirp <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'mkdirp\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'fs\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">const</span> watch <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'gulp-watch\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">const</span> run <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'run-sequence\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\ngulp<span class="token punctuation">.</span><span class="token function">task</span><span class="token punctuation">(</span><span class="token string">\'sync\'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">try</span> <span class="token punctuation">{</span>\n    <span class="token keyword">let</span> state <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">statSync</span><span class="token punctuation">(</span>syncTo<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>state<span class="token punctuation">.</span><span class="token function">isDirectory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token function">mkdirp</span><span class="token punctuation">(</span>syncTo<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token function">mkdirp</span><span class="token punctuation">(</span>syncTo<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n\n  <span class="token function">fileSync</span><span class="token punctuation">(</span><span class="token string">\'extend\'</span><span class="token punctuation">,</span> syncTo<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\ngulp<span class="token punctuation">.</span><span class="token function">task</span><span class="token punctuation">(</span><span class="token string">\'watch-extend\'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token function">watch</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">\'./extend/**\'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token function">run</span><span class="token punctuation">(</span><span class="token string">\'sync\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\ngulp<span class="token punctuation">.</span><span class="token function">task</span><span class="token punctuation">(</span><span class="token string">\'watch\'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">\'watch-extend\'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\ngulp<span class="token punctuation">.</span><span class="token function">task</span><span class="token punctuation">(</span><span class="token string">\'default\'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">\'sync\'</span><span class="token punctuation">,</span> <span class="token string">\'watch\'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id="nodemon--npm-link"><a href="#nodemon--npm-link" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>nodemon + npm link</h2>\n<ol>\n<li>对扩展项目进行 npm link 操作，然后在主项目中 npm link 扩展项目，可以在主项目的 node_modules 下看到指向扩展项目的软链接</li>\n<li>主项目使用了 nodemon 来监听 node_modules 文件变化，鉴于每次重启主项目之后扩展项目的代码才会生效的问题，需要解决 nodemon 不能监听软链接下文件变化的问题</li>\n</ol>\n<p>核心逻辑：</p>\n<ol>\n<li>在不影响 nodemon 脚本调用逻辑的情况下，在 nodemon.json 添加 <code class="language-text">watchSymbolLink</code> 属性，明确监听软链接的文件位置</li>\n<li>利用 glob 三方库读取 watchSymbolLink 下的文件，当判断读到的文件是软链接文件时（isSymbolicLink），读取真实的文件路径（realpathSync）</li>\n<li>在监听原来文件的基础上，调用 nodemon 监听另外真实的文件路径</li>\n</ol>\n<p>package.json</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="77159057648057090000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`{\n  &quot;scripts&quot;: {\n    &quot;dev:server&quot;: &quot;node bin/nodemon.js --config nodemon.json ./bin/www&quot;\n  }\n}`, `77159057648057090000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                json 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="json"><pre style="counter-reset: linenumber NaN" class="language-json line-numbers"><code class="language-json"><span class="token punctuation">{</span>\n  <span class="token property">"scripts"</span><span class="token operator">:</span> <span class="token punctuation">{</span>\n    <span class="token property">"dev:server"</span><span class="token operator">:</span> <span class="token string">"node bin/nodemon.js --config nodemon.json ./bin/www"</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>bin\\nodemon.js</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="43835257051347500000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`const nodemon = require(\'nodemon\');\nconst nodemonCli = require(\'nodemon/lib/cli\');\nconst options = nodemonCli.parse(process.argv);\nconst glob = require(\'glob\');\nconst fs = require(\'fs\');\nconst lodash = require(\'lodash\');\nconst path = require(\'path\');\n\n// &quot;watchSymbolLink&quot;: [\n//   {\n//     &quot;url&quot;: &quot;node_modules/sugo-analytics-extend-*&quot;,\n//     &quot;path&quot;: &quot;/extend/app/**/*&quot;\n//   },\n// ],\n// 或\n// &quot;watchSymbolLink&quot;: [\n//    &quot;node_modules/sugo-analytics-extend-*&quot;,\n// ],\nconst { configFile, ...optionsRest } = options;\n\nconst nodemonJsonPath = path.join(process.cwd(), configFile);\n\nconst nodemonJson = require(nodemonJsonPath);\n\nconst { watch, watchSymbolLink = [], ...nodemonJsonRest } = nodemonJson;\n\nconst dirs = [];\n\nwatchSymbolLink.forEach((item) => {\n  const { url, path: linkPath = \'\' } = lodash.isObject(item) ? item : { url: item };\n  const paths = glob\n    .sync(url)\n    .filter((a) => fs.lstatSync(a).isSymbolicLink())\n    .map((a) => path.join(fs.realpathSync(a), linkPath));\n  dirs.push(...paths);\n});\n\nconst opts = {\n  ...optionsRest,\n  ...nodemonJsonRest,\n  watch: [...watch, ...dirs]\n};\n\n// console.log(opts)\n\nnodemon(opts);\n\nnodemon.on(\'quit\', function() {\n  process.exit();\n});\n\nconst packageJsonPath = path.join(process.cwd(), \'package.json\');\n\n// checks for available update and returns an instance\nconst pkg = JSON.parse(fs.readFileSync(packageJsonPath));\n\nif (pkg.version.indexOf(\'0.0.0\') !== 0 && options.noUpdateNotifier !== true) {\n  require(\'update-notifier\')({ pkg }).notify();\n}`, `43835257051347500000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                js 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">const</span> nodemon <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'nodemon\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">const</span> nodemonCli <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'nodemon/lib/cli\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">const</span> options <span class="token operator">=</span> nodemonCli<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span>argv<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">const</span> glob <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'glob\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'fs\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">const</span> lodash <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'lodash\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'path\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token comment">// "watchSymbolLink": [</span>\n<span class="token comment">//   {</span>\n<span class="token comment">//     "url": "node_modules/sugo-analytics-extend-*",</span>\n<span class="token comment">//     "path": "/extend/app/**/*"</span>\n<span class="token comment">//   },</span>\n<span class="token comment">// ],</span>\n<span class="token comment">// 或</span>\n<span class="token comment">// "watchSymbolLink": [</span>\n<span class="token comment">//    "node_modules/sugo-analytics-extend-*",</span>\n<span class="token comment">// ],</span>\n<span class="token keyword">const</span> <span class="token punctuation">{</span> configFile<span class="token punctuation">,</span> <span class="token operator">...</span>optionsRest <span class="token punctuation">}</span> <span class="token operator">=</span> options<span class="token punctuation">;</span>\n\n<span class="token keyword">const</span> nodemonJsonPath <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span><span class="token function">cwd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> configFile<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token keyword">const</span> nodemonJson <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span>nodemonJsonPath<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token keyword">const</span> <span class="token punctuation">{</span> watch<span class="token punctuation">,</span> watchSymbolLink <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token operator">...</span>nodemonJsonRest <span class="token punctuation">}</span> <span class="token operator">=</span> nodemonJson<span class="token punctuation">;</span>\n\n<span class="token keyword">const</span> dirs <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n\nwatchSymbolLink<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n  <span class="token keyword">const</span> <span class="token punctuation">{</span> url<span class="token punctuation">,</span> path<span class="token punctuation">:</span> linkPath <span class="token operator">=</span> <span class="token string">\'\'</span> <span class="token punctuation">}</span> <span class="token operator">=</span> lodash<span class="token punctuation">.</span><span class="token function">isObject</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span> <span class="token operator">?</span> item <span class="token punctuation">:</span> <span class="token punctuation">{</span> url<span class="token punctuation">:</span> item <span class="token punctuation">}</span><span class="token punctuation">;</span>\n  <span class="token keyword">const</span> paths <span class="token operator">=</span> glob\n    <span class="token punctuation">.</span><span class="token function">sync</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span>\n    <span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">a</span><span class="token punctuation">)</span> <span class="token operator">=></span> fs<span class="token punctuation">.</span><span class="token function">lstatSync</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isSymbolicLink</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n    <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">a</span><span class="token punctuation">)</span> <span class="token operator">=></span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>fs<span class="token punctuation">.</span><span class="token function">realpathSync</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">,</span> linkPath<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  dirs<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token operator">...</span>paths<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token keyword">const</span> opts <span class="token operator">=</span> <span class="token punctuation">{</span>\n  <span class="token operator">...</span>optionsRest<span class="token punctuation">,</span>\n  <span class="token operator">...</span>nodemonJsonRest<span class="token punctuation">,</span>\n  watch<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token operator">...</span>watch<span class="token punctuation">,</span> <span class="token operator">...</span>dirs<span class="token punctuation">]</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n<span class="token comment">// console.log(opts)</span>\n\n<span class="token function">nodemon</span><span class="token punctuation">(</span>opts<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\nnodemon<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">\'quit\'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  process<span class="token punctuation">.</span><span class="token function">exit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token keyword">const</span> packageJsonPath <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span><span class="token function">cwd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">\'package.json\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token comment">// checks for available update and returns an instance</span>\n<span class="token keyword">const</span> pkg <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>fs<span class="token punctuation">.</span><span class="token function">readFileSync</span><span class="token punctuation">(</span>packageJsonPath<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token keyword">if</span> <span class="token punctuation">(</span>pkg<span class="token punctuation">.</span>version<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">\'0.0.0\'</span><span class="token punctuation">)</span> <span class="token operator">!==</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> options<span class="token punctuation">.</span>noUpdateNotifier <span class="token operator">!==</span> <span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'update-notifier\'</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">{</span> pkg <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">notify</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>nodemon.json</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="99655733007392850000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`{\n  &quot;restartable&quot;: &quot;rs&quot;,\n  &quot;ignore&quot;: [&quot;.git&quot;, &quot;node_modules&quot;, &quot;node_modules/**/node_modules&quot;],\n  &quot;verbose&quot;: true,\n  &quot;execMap&quot;: {\n    &quot;js&quot;: &quot;node --harmony&quot;\n  },\n  &quot;events&quot;: {\n    &quot;restart&quot;: &quot;osascript -e \'display notification \\&quot;App restarted due to:\\n\'\\$FILENAME\'\\&quot; with title \\&quot;nodemon\\&quot;\'&quot;\n  },\n  &quot;watch&quot;: [\n    &quot;src/server&quot;,\n    &quot;src/common&quot;,\n    &quot;config.default.js&quot;,\n    &quot;node_modules/sugo-analytics-extend-*/extend/app/**/*&quot;,\n    &quot;config.js&quot;\n  ],\n  &quot;watchSymbolLink&quot;: [\n    {\n      &quot;url&quot;: &quot;node_modules/sugo-analytics-extend-*&quot;,\n      &quot;path&quot;: &quot;extend/app/**/*&quot;\n    }\n  ],\n  &quot;env&quot;: {\n    &quot;NODE_ENV&quot;: &quot;development&quot;\n  },\n  &quot;delay&quot;: &quot;1000&quot;,\n  &quot;ext&quot;: &quot;js,json&quot;\n}`, `99655733007392850000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                json{12-17} 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight has-highlighted-lines" data-language="json"><pre style="counter-reset: linenumber NaN" class="language-json line-numbers"><code class="language-json"><span class="token punctuation">{</span>\n  <span class="token property">"restartable"</span><span class="token operator">:</span> <span class="token string">"rs"</span><span class="token punctuation">,</span>\n  <span class="token property">"ignore"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">".git"</span><span class="token punctuation">,</span> <span class="token string">"node_modules"</span><span class="token punctuation">,</span> <span class="token string">"node_modules/**/node_modules"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>\n  <span class="token property">"verbose"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>\n  <span class="token property">"execMap"</span><span class="token operator">:</span> <span class="token punctuation">{</span>\n    <span class="token property">"js"</span><span class="token operator">:</span> <span class="token string">"node --harmony"</span>\n  <span class="token punctuation">}</span><span class="token punctuation">,</span>\n  <span class="token property">"events"</span><span class="token operator">:</span> <span class="token punctuation">{</span>\n    <span class="token property">"restart"</span><span class="token operator">:</span> <span class="token string">"osascript -e \'display notification \\"App restarted due to:\\n\'$FILENAME\'\\" with title \\"nodemon\\"\'"</span>\n  <span class="token punctuation">}</span><span class="token punctuation">,</span>\n  <span class="token property">"watch"</span><span class="token operator">:</span> <span class="token punctuation">[</span>\n<span class="gatsby-highlight-code-line">    <span class="token string">"src/server"</span><span class="token punctuation">,</span></span><span class="gatsby-highlight-code-line">    <span class="token string">"src/common"</span><span class="token punctuation">,</span></span><span class="gatsby-highlight-code-line">    <span class="token string">"config.default.js"</span><span class="token punctuation">,</span></span><span class="gatsby-highlight-code-line">    <span class="token string">"node_modules/sugo-analytics-extend-*/extend/app/**/*"</span><span class="token punctuation">,</span></span><span class="gatsby-highlight-code-line">    <span class="token string">"config.js"</span></span><span class="gatsby-highlight-code-line">  <span class="token punctuation">]</span><span class="token punctuation">,</span></span>  <span class="token property">"watchSymbolLink"</span><span class="token operator">:</span> <span class="token punctuation">[</span>\n    <span class="token punctuation">{</span>\n      <span class="token property">"url"</span><span class="token operator">:</span> <span class="token string">"node_modules/sugo-analytics-extend-*"</span><span class="token punctuation">,</span>\n      <span class="token property">"path"</span><span class="token operator">:</span> <span class="token string">"extend/app/**/*"</span>\n    <span class="token punctuation">}</span>\n  <span class="token punctuation">]</span><span class="token punctuation">,</span>\n  <span class="token property">"env"</span><span class="token operator">:</span> <span class="token punctuation">{</span>\n    <span class="token property">"NODE_ENV"</span><span class="token operator">:</span> <span class="token string">"development"</span>\n  <span class="token punctuation">}</span><span class="token punctuation">,</span>\n  <span class="token property">"delay"</span><span class="token operator">:</span> <span class="token string">"1000"</span><span class="token punctuation">,</span>\n  <span class="token property">"ext"</span><span class="token operator">:</span> <span class="token string">"js,json"</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>',
id:"/github/workspace/blog/基于nodemon实现监听文件链接变化/index.md absPath of file >>> MarkdownRemark",timeToRead:3,frontmatter:{date:"2021-01-05 10:02:54",path:"/nodemon-monitor-link-changes/",tags:"后端, nodejs, nodemon, 预研",title:"基于nodemon实现监听文件链接变化",draft:null}},{excerpt:"简化版 代码 这个 Promise 的实现不考虑任何异常情况，只考虑代码最简短，从而便于读者理解核心的异步链式调用原理。 核心案例 本文将围绕这个最核心的案例来讲，这段代码的表现如下： 500ms 后输出 1 500ms 后输出 2 实现 构造函数 首先来实现 Promise 构造函数 好，写到这里先回过头来看案例 分开来看，fn 就是用户传的函数，这个函数内部调用了 resolve 函数后，就会把 promise 实例上的 cbs 全部执行一遍。 到此为止我们还不知道 cbs…",html:'<h1 id="简化版"><a href="#%E7%AE%80%E5%8C%96%E7%89%88" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>简化版</h1>\n<h2 id="代码"><a href="#%E4%BB%A3%E7%A0%81" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>代码</h2>\n<p>这个 Promise 的实现不考虑任何异常情况，只考虑代码最简短，从而便于读者理解核心的异步链式调用原理。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="72452054326807570000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`function Promise(fn) {\n  this.cbs = [];\n\n  const resolve = (value) => {\n    setTimeout(() => {\n      this.data = value;\n      this.cbs.forEach((cb) => cb(value));\n    });\n  };\n\n  fn(resolve);\n}\n\nPromise.prototype.then = function(onResolved) {\n  return new Promise((resolve) => {\n    this.cbs.push(() => {\n      const res = onResolved(this.data);\n      if (res instanceof Promise) {\n        res.then(resolve);\n      } else {\n        resolve(res);\n      }\n    });\n  });\n};`, `72452054326807570000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                js 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">function</span> <span class="token function">Promise</span><span class="token punctuation">(</span><span class="token parameter">fn</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">this</span><span class="token punctuation">.</span>cbs <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n\n  <span class="token keyword">const</span> <span class="token function-variable function">resolve</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n      <span class="token keyword">this</span><span class="token punctuation">.</span>data <span class="token operator">=</span> value<span class="token punctuation">;</span>\n      <span class="token keyword">this</span><span class="token punctuation">.</span>cbs<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">cb</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">cb</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n  <span class="token function">fn</span><span class="token punctuation">(</span>resolve<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n\n<span class="token class-name">Promise</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">then</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">onResolved</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n    <span class="token keyword">this</span><span class="token punctuation">.</span>cbs<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n      <span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token function">onResolved</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token keyword">if</span> <span class="token punctuation">(</span>res <span class="token keyword">instanceof</span> <span class="token class-name">Promise</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        res<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>resolve<span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>\n        <span class="token function">resolve</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span>\n    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h2 id="核心案例"><a href="#%E6%A0%B8%E5%BF%83%E6%A1%88%E4%BE%8B" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>核心案例</h2>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="9140498801815821000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`new Promise((resolve) => {\n  setTimeout(() => {\n    resolve(1);\n  }, 500);\n})\n  .then((res) => {\n    console.log(res);\n    return new Promise((resolve) => {\n      setTimeout(() => {\n        resolve(2);\n      }, 500);\n    });\n  })\n  .then(console.log);`, `9140498801815821000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                js 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n  <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n    <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span>\n  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n      <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n        <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span><span class="token punctuation">)</span>\n  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>console<span class="token punctuation">.</span>log<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>本文将围绕这个最核心的案例来讲，这段代码的表现如下：</p>\n<ol>\n<li>500ms 后输出 1</li>\n<li>500ms 后输出 2</li>\n</ol>\n<h2 id="实现"><a href="#%E5%AE%9E%E7%8E%B0" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>实现</h2>\n<h3 id="构造函数"><a href="#%E6%9E%84%E9%80%A0%E5%87%BD%E6%95%B0" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>构造函数</h3>\n<p>首先来实现 Promise 构造函数</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="45192717753265520000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`function Promise(fn) {\n  // Promise resolve 时的回调函数集\n  this.cbs = [];\n\n  // 传递给 Promise 处理函数的 resolve\n  // 这里直接往实例上挂个 data\n  // 然后把 onResolvedCallback 数组里的函数依次执行一遍就可以\n  const resolve = (value) => {\n    // 注意 promise 的 then 函数需要异步执行\n    setTimeout(() => {\n      this.data = value;\n      this.cbs.forEach((cb) => cb(value));\n    });\n  };\n\n  // 执行用户传入的函数\n  // 并且把 resolve 方法交给用户执行\n  fn(resolve);\n}`, `45192717753265520000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                js 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">function</span> <span class="token function">Promise</span><span class="token punctuation">(</span><span class="token parameter">fn</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token comment">// Promise resolve 时的回调函数集</span>\n  <span class="token keyword">this</span><span class="token punctuation">.</span>cbs <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n\n  <span class="token comment">// 传递给 Promise 处理函数的 resolve</span>\n  <span class="token comment">// 这里直接往实例上挂个 data</span>\n  <span class="token comment">// 然后把 onResolvedCallback 数组里的函数依次执行一遍就可以</span>\n  <span class="token keyword">const</span> <span class="token function-variable function">resolve</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n    <span class="token comment">// 注意 promise 的 then 函数需要异步执行</span>\n    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n      <span class="token keyword">this</span><span class="token punctuation">.</span>data <span class="token operator">=</span> value<span class="token punctuation">;</span>\n      <span class="token keyword">this</span><span class="token punctuation">.</span>cbs<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">cb</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">cb</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n  <span class="token comment">// 执行用户传入的函数</span>\n  <span class="token comment">// 并且把 resolve 方法交给用户执行</span>\n  <span class="token function">fn</span><span class="token punctuation">(</span>resolve<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>好，写到这里先回过头来看案例</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="12544272637825470000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`const fn = (resolve) => {\n  setTimeout(() => {\n    resolve(1);\n  }, 500);\n};\n\nnew Promise(fn);`, `12544272637825470000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                js 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">const</span> <span class="token function-variable function">fn</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">resolve</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n  <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n    <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n<span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span>fn<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>分开来看，fn 就是用户传的函数，这个函数内部调用了 resolve 函数后，就会把 promise 实例上的 cbs 全部执行一遍。</p>\n<p>到此为止我们还不知道 cbs 这个数组里的函数是从哪里来的，接着往下看。</p>\n<h3 id="then"><a href="#then" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>then</h3>\n<p>这里是最重要的 then 实现，链式调用全靠它：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="9657589634058695000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`Promise.prototype.then = function(onResolved) {\n  // 这里叫做 promise2\n  return new Promise((resolve) => {\n    this.cbs.push(() => {\n      const res = onResolved(this.data);\n      if (res instanceof Promise) {\n        // resolve 的权力被交给了 user promise\n        res.then(resolve);\n      } else {\n        // 如果是普通值就直接 resolve\n        // 依次执行 cbs 里的函数，并且把值传递给 cbs\n        resolve(res);\n      }\n    });\n  });\n};`, `9657589634058695000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                js 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token class-name">Promise</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">then</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">onResolved</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token comment">// 这里叫做 promise2</span>\n  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n    <span class="token keyword">this</span><span class="token punctuation">.</span>cbs<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n      <span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token function">onResolved</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token keyword">if</span> <span class="token punctuation">(</span>res <span class="token keyword">instanceof</span> <span class="token class-name">Promise</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        <span class="token comment">// resolve 的权力被交给了 user promise</span>\n        res<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>resolve<span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>\n        <span class="token comment">// 如果是普通值就直接 resolve</span>\n        <span class="token comment">// 依次执行 cbs 里的函数，并且把值传递给 cbs</span>\n        <span class="token function">resolve</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span>\n    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>再回到案例里</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="55963259301711400000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`const fn = (resolve) => {\n  setTimeout(() => {\n    resolve(1);\n  }, 500);\n};\n\nconst promise1 = new Promise(fn);\n\npromise1.then((res) => {\n  console.log(res);\n  // user promise\n  return new Promise((resolve) => {\n    setTimeout(() => {\n      resolve(2);\n    }, 500);\n  });\n});`, `55963259301711400000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                js 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">const</span> <span class="token function-variable function">fn</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">resolve</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n  <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n    <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n<span class="token keyword">const</span> promise1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span>fn<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\npromise1<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token comment">// user promise</span>\n  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n      <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>注意这里的命名：</p>\n<ol>\n<li>我们把 new Promise 返回的实例叫做 promise1</li>\n<li>在 Promise.prototype.then 的实现中，我们构造了一个新的 promise 返回，叫它 promise2</li>\n<li>在用户调用 then 方法的时候，用户手动构造了一个 promise 并且返回，用来做异步的操作，叫它 user promise</li>\n</ol>\n<p>那么在 then 的实现中，内部的 this 其实就指向 promise1</p>\n<p>而 promise2 的传入的 fn 函数执行了一个 this.cbs.push()，其实是往 promise1 的 cbs 数组中 push 了一个函数，等待后续执行。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="70812269820991540000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`Promise.prototype.then = function(onResolved) {\n  // 这里叫做promise2\n  return new Promise((resolve) => {\n    // 这里的this其实是promise1\n    this.cbs.push(() => {});\n  });\n};`, `70812269820991540000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                js 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token class-name">Promise</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">then</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">onResolved</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token comment">// 这里叫做promise2</span>\n  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n    <span class="token comment">// 这里的this其实是promise1</span>\n    <span class="token keyword">this</span><span class="token punctuation">.</span>cbs<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>那么重点看这个 push 的函数，注意，这个函数在 promise1 被 resolve 了以后才会执行。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="29653615760433640000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// promise2\nreturn new Promise((resolve) => {\n  this.cbs.push(() => {\n    // onResolved 就对应 then 传入的函数\n    const res = onResolved(this.data);\n    // 例子中的情况 用户自己返回了一个user promise\n    if (res instanceof Promise) {\n      // user promise 的情况\n      // 用户会自己决定何时 resolve promise2\n      // 只有 promise2 被 resolve 以后\n      // then 下面的链式调用函数才会继续执行\n      res.then(resolve);\n    } else {\n      resolve(res);\n    }\n  });\n});`, `29653615760433640000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                js 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// promise2</span>\n<span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n  <span class="token keyword">this</span><span class="token punctuation">.</span>cbs<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n    <span class="token comment">// onResolved 就对应 then 传入的函数</span>\n    <span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token function">onResolved</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token comment">// 例子中的情况 用户自己返回了一个user promise</span>\n    <span class="token keyword">if</span> <span class="token punctuation">(</span>res <span class="token keyword">instanceof</span> <span class="token class-name">Promise</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token comment">// user promise 的情况</span>\n      <span class="token comment">// 用户会自己决定何时 resolve promise2</span>\n      <span class="token comment">// 只有 promise2 被 resolve 以后</span>\n      <span class="token comment">// then 下面的链式调用函数才会继续执行</span>\n      res<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>resolve<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>\n      <span class="token function">resolve</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>如果用户传入给 then 的 onResolved 方法返回的是个 user promise，那么这个 user promise 里用户会自己去在合适的时机 resolve promise2，那么进而这里的 res.then(resolve) 中的 resolve 就会被执行：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="62499903570392260000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`if (res instanceof Promise) {\n  res.then(resolve);\n}`, `62499903570392260000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                js 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">if</span> <span class="token punctuation">(</span>res <span class="token keyword">instanceof</span> <span class="token class-name">Promise</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  res<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>resolve<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>结合下面这个例子来看：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="35644995839104987000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`new Promise((resolve) => {\n  setTimeout(() => {\n    // resolve1\n    resolve(1);\n  }, 500);\n})\n  // then1\n  .then((res) => {\n    console.log(res);\n    // user promise\n    return new Promise((resolve) => {\n      setTimeout(() => {\n        // resolve2\n        resolve(2);\n      }, 500);\n    });\n  })\n  // then2\n  .then(console.log);`, `35644995839104987000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                js 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n  <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n    <span class="token comment">// resolve1</span>\n    <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span>\n  <span class="token comment">// then1</span>\n  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token comment">// user promise</span>\n    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n      <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>\n        <span class="token comment">// resolve2</span>\n        <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span><span class="token punctuation">)</span>\n  <span class="token comment">// then2</span>\n  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>console<span class="token punctuation">.</span>log<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>then1 这一整块其实返回的是 promise2，那么 then2 其实本质上是 promise2.then(console.log)，也就是说 then2 注册的回调函数，其实进入了 promise2 的 cbs 回调数组里，又因为我们刚刚知道，resolve2 调用了之后，user promise 会被 resolve，进而触发 promise2 被 resolve，进而 promise2 里的 cbs 数组被依次触发。</p>\n<p>这样就实现了用户自己写的 resolve2 执行完毕后，then2 里的逻辑才会继续执行，也就是异步链式调用。</p>\n<h1 id="完整版"><a href="#%E5%AE%8C%E6%95%B4%E7%89%88" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>完整版</h1>\n<h2 id="promise-标准解读"><a href="#promise-%E6%A0%87%E5%87%86%E8%A7%A3%E8%AF%BB" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Promise 标准解读</h2>\n<ol>\n<li>\n<p>只有一个 then 方法，没有 catch，race，all 等方法，甚至没有构造函数</p>\n<p>Promise 标准中仅指定了 Promise 对象的 then 方法的行为，其它一切我们常见的方法/函数都并没有指定，包括 catch，race，all 等常用方法，甚至也没有指定该如何构造出一个 Promise 对象，另外 then 也没有一般实现中（Q, $q 等）所支持的第三个参数，一般称 onProgress</p>\n</li>\n<li>\n<p>then 方法返回一个新的 Promise</p>\n<p>Promise 的 then 方法返回一个新的 Promise，而不是返回 this，此处在下文会有更多解释</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="6552963768481535000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`promise2 = promise1.then(alert);\npromise2 != promise1; // true`, `6552963768481535000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                js 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js">promise2 <span class="token operator">=</span> promise1<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>alert<span class="token punctuation">)</span><span class="token punctuation">;</span>\npromise2 <span class="token operator">!=</span> promise1<span class="token punctuation">;</span> <span class="token comment">// true</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n</li>\n<li>\n<p>不同 Promise 的实现需要可以相互调用(interoperable)</p>\n</li>\n<li>\n<p>Promise 的初始状态为 pending，它可以由此状态转换为 fulfilled（本文为了一致把此状态叫做 resolved）或者 rejected，一旦状态确定，就不可以再次转换为其它状态，状态确定的过程称为 settle</p>\n</li>\n</ol>\n<h2 id="构造函数-1"><a href="#%E6%9E%84%E9%80%A0%E5%87%BD%E6%95%B0-1" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>构造函数</h2>\n<p>因为标准并没有指定如何构造一个 Promise 对象，所以我们同样以目前一般 Promise 实现中通用的方法来构造一个 Promise 对象，也是 ES6 原生 Promise 里所使用的方式，即：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="25328106307749510000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`// Promise 构造函数接收一个 executor 函数，executor 函数执行完同步或异步操作后，调用它的两个参数 resolve 和 reject\nvar promise = new Promise(function(resolve, reject) {\n  /*\n    如果操作成功，调用 resolve 并传入 value\n    如果操作失败，调用 reject 并传入 reason\n  */\n});`, `25328106307749510000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                js 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// Promise 构造函数接收一个 executor 函数，executor 函数执行完同步或异步操作后，调用它的两个参数 resolve 和 reject</span>\n<span class="token keyword">var</span> promise <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token comment">/*\n    如果操作成功，调用 resolve 并传入 value\n    如果操作失败，调用 reject 并传入 reason\n  */</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>我们先实现构造函数的框架如下：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="60987431376188500000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`function Promise(executor) {\n  var self = this;\n  self.status = \'pending\'; // Promise 当前的状态\n  self.data = undefined; // Promise 的值\n  self.onResolvedCallback = []; // Promise resolve 时的回调函数集，因为在 Promise 结束之前有可能有多个回调添加到它上面\n  self.onRejectedCallback = []; // Promise reject 时的回调函数集，因为在 Promise 结束之前有可能有多个回调添加到它上面\n\n  executor(resolve, reject); // 执行 executor 并传入相应的参数\n}`, `60987431376188500000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                js 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">function</span> <span class="token function">Promise</span><span class="token punctuation">(</span><span class="token parameter">executor</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">var</span> self <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>\n  self<span class="token punctuation">.</span>status <span class="token operator">=</span> <span class="token string">\'pending\'</span><span class="token punctuation">;</span> <span class="token comment">// Promise 当前的状态</span>\n  self<span class="token punctuation">.</span>data <span class="token operator">=</span> <span class="token keyword">undefined</span><span class="token punctuation">;</span> <span class="token comment">// Promise 的值</span>\n  self<span class="token punctuation">.</span>onResolvedCallback <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// Promise resolve 时的回调函数集，因为在 Promise 结束之前有可能有多个回调添加到它上面</span>\n  self<span class="token punctuation">.</span>onRejectedCallback <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// Promise reject 时的回调函数集，因为在 Promise 结束之前有可能有多个回调添加到它上面</span>\n\n  <span class="token function">executor</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 执行 executor 并传入相应的参数</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>上面的代码基本实现了 Promise 构造函数的主体，但目前还有两个问题：</p>\n<ol>\n<li>\n<p>我们给 executor 函数传了两个参数：resolve 和 reject，这两个参数目前还没有定义</p>\n</li>\n<li>\n<p>executor 有可能会出错（throw），类似下面这样，而如果 executor 出错，Promise 应该被其 throw 出的值 reject：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="82234830369678200000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`new Promise(function(resolve, reject) {\n throw 2;\n});`, `82234830369678200000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                js 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n <span class="token keyword">throw</span> <span class="token number">2</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n</li>\n</ol>\n<p>所以我们需要在构造函数里定义 resolve 和 reject 这两个函数：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="64313583693639795000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`function Promise(executor) {\n  var self = this;\n  self.status = \'pending\'; // Promise 当前的状态\n  self.data = undefined; // Promise 的值\n  self.onResolvedCallback = []; // Promise resolve 时的回调函数集，因为在 Promise 结束之前有可能有多个回调添加到它上面\n  self.onRejectedCallback = []; // Promise reject 时的回调函数集，因为在 Promise 结束之前有可能有多个回调添加到它上面\n\n  function resolve(value) {}\n\n  function reject(reason) {}\n\n  try {\n    // 考虑到执行 executor 的过程中有可能出错，所以我们用 try/catch 块给包起来，并且在出错后以 catch 到的值 reject 掉这个 Promise\n    executor(resolve, reject); // 执行executor\n  } catch (e) {\n    reject(e);\n  }\n}`, `64313583693639795000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                js 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">function</span> <span class="token function">Promise</span><span class="token punctuation">(</span><span class="token parameter">executor</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">var</span> self <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>\n  self<span class="token punctuation">.</span>status <span class="token operator">=</span> <span class="token string">\'pending\'</span><span class="token punctuation">;</span> <span class="token comment">// Promise 当前的状态</span>\n  self<span class="token punctuation">.</span>data <span class="token operator">=</span> <span class="token keyword">undefined</span><span class="token punctuation">;</span> <span class="token comment">// Promise 的值</span>\n  self<span class="token punctuation">.</span>onResolvedCallback <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// Promise resolve 时的回调函数集，因为在 Promise 结束之前有可能有多个回调添加到它上面</span>\n  self<span class="token punctuation">.</span>onRejectedCallback <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// Promise reject 时的回调函数集，因为在 Promise 结束之前有可能有多个回调添加到它上面</span>\n\n  <span class="token keyword">function</span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>\n\n  <span class="token keyword">function</span> <span class="token function">reject</span><span class="token punctuation">(</span><span class="token parameter">reason</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>\n\n  <span class="token keyword">try</span> <span class="token punctuation">{</span>\n    <span class="token comment">// 考虑到执行 executor 的过程中有可能出错，所以我们用 try/catch 块给包起来，并且在出错后以 catch 到的值 reject 掉这个 Promise</span>\n    <span class="token function">executor</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 执行executor</span>\n  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token function">reject</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>有人可能会问，resolve 和 reject 这两个函数能不能不定义在构造函数里呢？考虑到我们在 executor 函数里是以 resolve(value)，reject(reason) 的形式调用的这两个函数，而不是以 resolve.call(promise, value)，reject.call(promise, reason) 这种形式调用的，所以这两个函数在调用时的内部也必然有一个隐含的 this，也就是说，要么这两个函数是经过 bind 后传给了 executor，要么它们定义在构造函数的内部，使用 self 来访问所属的 Promise 对象。所以如果我们想把这两个函数定义在构造函数的外部，确实是可以这么写的：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="84241583637220050000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`function resolve() {}\nfunction reject() {}\nfunction Promise(executor) {\n  try {\n    executor(resolve.bind(this), reject.bind(this));\n  } catch (e) {\n    reject.bind(this)(e);\n  }\n}`, `84241583637220050000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                js 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">function</span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>\n<span class="token keyword">function</span> <span class="token function">reject</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>\n<span class="token keyword">function</span> <span class="token function">Promise</span><span class="token punctuation">(</span><span class="token parameter">executor</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">try</span> <span class="token punctuation">{</span>\n    <span class="token function">executor</span><span class="token punctuation">(</span><span class="token function">resolve</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">reject</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token function">reject</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>但是众所周知，bind 也会返回一个新的函数，这么一来还是相当于每个 Promise 对象都有一对属于自己的 resolve 和 reject 函数，就跟写在构造函数内部没什么区别了，所以我们就直接把这两个函数定义在构造函数里面了。不过话说回来，如果浏览器对 bind 有优化，使用后一种形式应该可以提升一下内存使用效率。</p>\n<p>另外我们这里的实现并没有考虑隐藏 this 上的变量，这使得这个 Promise 的状态可以在 executor 函数外部被改变，在一个靠谱的实现里，构造出的 Promise 对象的状态和最终结果应当是无法从外部更改的。</p>\n<p>接下来，我们实现 resolve 和 reject 这两个函数</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="97034724869028040000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`function Promise(executor) {\n  // ...\n\n  function resolve(value) {\n    if (self.status === \'pending\') {\n      self.status = \'resolved\';\n      self.data = value;\n      for (var i = 0; i < self.onResolvedCallback.length; i++) {\n        self.onResolvedCallback[i](value);\n      }\n    }\n  }\n\n  function reject(reason) {\n    if (self.status === \'pending\') {\n      self.status = \'rejected\';\n      self.data = reason;\n      for (var i = 0; i < self.onRejectedCallback.length; i++) {\n        self.onRejectedCallback[i](reason);\n      }\n    }\n  }\n\n  // ...\n}`, `97034724869028040000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                \n              >\n                js 复制代码\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">function</span> <span class="token function">Promise</span><span class="token punctuation">(</span><span class="token parameter">executor</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token comment">// ...</span>\n\n  <span class="token keyword">function</span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">if</span> <span class="token punctuation">(</span>self<span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token string">\'pending\'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      self<span class="token punctuation">.</span>status <span class="token operator">=</span> <span class="token string">\'resolved\'</span><span class="token punctuation">;</span>\n      self<span class="token punctuation">.</span>data <span class="token operator">=</span> value<span class="token punctuation">;</span>\n      <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> self<span class="token punctuation">.</span>onResolvedCallback<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        self<span class="token punctuation">.</span>onResolvedCallback<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span>\n    <span class="token punctuation">}</span>\n  <span class="token punctuation">}</span>\n\n  <span class="token keyword">function</span> <span class="token function">reject</span><span class="token punctuation">(</span><span class="token parameter">reason</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">if</span> <span class="token punctuation">(</span>self<span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token string">\'pending\'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      self<span class="token punctuation">.</span>status <span class="token operator">=</span> <span class="token string">\'rejected\'</span><span class="token punctuation">;</span>\n      self<span class="token punctuation">.</span>data <span class="token operator">=</span> reason<span class="token punctuation">;</span>\n      <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> self<span class="token punctuation">.</span>onRejectedCallback<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        self<span class="token punctuation">.</span>onRejectedCallback<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">(</span>reason<span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span>\n    <span class="token punctuation">}</span>\n  <span class="token punctuation">}</span>\n\n  <span class="token comment">// ...</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>基本上就是在判断状态为 pending 之后把状态改为相应的值，并把对应的 value 和 reason 存在 self 的 data 属性上面，之后执行相应的回调函数，逻辑很简单，这里就不多解释了。</p>\n<p>// TODO <a href="https://github.com/xieranmaya/blog/issues/3" target="_blank" rel="nofollow noreferrer noopener">https://github.com/xieranmaya/blog/issues/3</a></p>',
id:"/github/workspace/blog/Promise 实现原理/index.md absPath of file >>> MarkdownRemark",timeToRead:5,frontmatter:{date:"2020-12-25 10:59:33",path:"/promise-implementation-principle/",tags:"前端, JS, 高级前端",title:"Promise 实现原理",draft:null}},{excerpt:"预览 i Insert 模式，按 ESC 回到 Normal 模式，反正如果不知道现在是在什么模式下，就一直按 ESC，回到 Normal 模式，下面功能键都是在 Normal 模式触发的 此时 Insert 模式跟记事本一样 操作 vim 会经常在这两个模式下切换，就如同在记事本中你在选项卡和编辑内容窗口中切换一样 x Normal 模式下，按 x 删除当前光标向后所在的一个字符，大写字母 X 删除当前光标向前的字符 :wq 保存+退出 vim(:w 保存 :q…",html:'<h1 id="预览"><a href="#%E9%A2%84%E8%A7%88" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>预览</h1>\n<p>\n  <a\n    class="gatsby-resp-image-link"\n    href="/static/2020-11-24-18-23-22-cc419605af55f580f4689b98910d6971-7f274.png"\n    style="display: block"\n    target="_blank"\n    rel="noopener"\n  >\n  \n  <span\n    class="gatsby-resp-image-wrapper"\n    style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;"\n  >\n    <span\n      class="gatsby-resp-image-background-image"\n      style="padding-bottom: 104.95689655172413%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAVCAIAAADJt1n/AAAACXBIWXMAAA7DAAAOwwHHb6hkAAACyUlEQVQ4y22UZ3LqQBCEdf8D+YddBpwAIxFFkFBAYZUj2Ad4H1oMxvW2ClVtmO6Z7hmUuq6rqirLUtO0l5eX0WgcBB4H9f9W0zTH47FtW7lV+LHhCIjVavn5+Xnw7CxP/4bVTVVWQgjTNIMggOwcXBTFfr9fLper1WoymUAuorAo8qq6CyYXIULLsgaDgaqqaXpGV/I83+12w+Gw1+t9fHz0+wPbMZM0qn5FQ5ukwj3YhmGCvt1uT6cTD5TmZ4GyWCyenp6Ab+o/tAA1SZKQ3dvbG2nGcXypWV5TOUekZBhbT4Sh8Jv6h7yqUcG2bTiJp0yZl3KVkTKoGcFM04iASeKqU4VXeVEkaby39vP5HH7UvaktF8rNZrNer+8dfISV/rWAZsXScKNI+L43Ho85hOkWzDv22DDVppZt+pEhokAGS1CYRew7rjOZqNfIu7SzLENzMucdSV6DLzmUZRRFm80GUeT5XdqojRKqqtmugTGcGMbu/f3dMIymaUG0He4tHEW5i1W/BXMcEpu4BysvUu7QhnT4QtU1iQAIq3Rdv6uZizAMdX3d7/fD0C9LOqwiF/wj/gydCT84zGbzrv9HuMHhuUkABnI6naL2YrmkPbM8i5NUhiVpkuUFUm82a1Kjt33fl5TK4XBABux9fHw8q0Wo8Pww8IJzh3fBaSAi0CHE4e/v76+vr7ZbSldP5Xne8/Mz14gBrQTGJOlClOWeH8xmUxRzXZdZoGxeKlItnsKvqRpqrU0t7HymZtnzbhi7nk/n4xNfJv/h4QGgm9p8qYfWZbZcx2mbi1TwA4QXzAO0UbegRePbYHDE3URVmVh9a/CXUHY1U5XpCcv1sH2z3a51/XQ64vO5ZhmMmZS9Xq+10Wj4+urYNkNclsXPPJ+bFOg9Q2M5Vd3cTZUkT+LYI+/x2Db3YZJd21AitG2Tl9XU8IO0KMqqKIt/ADFcpYsrp20AAAAASUVORK5CYII=\'); background-size: cover; display: block;"\n    >\n      <img\n        class="gatsby-resp-image-image"\n        style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;"\n        alt="2020 11 24 18 23 22"\n        title=""\n        src="/static/2020-11-24-18-23-22-cc419605af55f580f4689b98910d6971-fee1c.png"\n        srcset="/static/2020-11-24-18-23-22-cc419605af55f580f4689b98910d6971-a67b7.png 200w,\n/static/2020-11-24-18-23-22-cc419605af55f580f4689b98910d6971-0b187.png 400w,\n/static/2020-11-24-18-23-22-cc419605af55f580f4689b98910d6971-fee1c.png 800w,\n/static/2020-11-24-18-23-22-cc419605af55f580f4689b98910d6971-7f274.png 928w"\n        sizes="(max-width: 800px) 100vw, 800px"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<h1 id="i"><a href="#i" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>i</h1>\n<p>Insert 模式，按 ESC 回到 Normal 模式，反正如果不知道现在是在什么模式下，就一直按 ESC，回到 Normal 模式，下面功能键都是在 Normal 模式触发的</p>\n<p>\n  <a\n    class="gatsby-resp-image-link"\n    href="/static/2020-11-24-17-27-22-346f01a215e11a8a6398dc3e9b5d45b4-88eb7.png"\n    style="display: block"\n    target="_blank"\n    rel="noopener"\n  >\n  \n  <span\n    class="gatsby-resp-image-wrapper"\n    style="position: relative; display: block; ; max-width: 411px; margin-left: auto; margin-right: auto;"\n  >\n    <span\n      class="gatsby-resp-image-background-image"\n      style="padding-bottom: 38.44282238442822%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAIAAAB2/0i6AAAACXBIWXMAAA7DAAAOwwHHb6hkAAABH0lEQVQY03VR2Y7DIAxMRCEJEAwECDlaSnppW2n3//9unW6VPlQ7D4YRHo9timJFWXxAa922LaNUGxt8cM4hXVPLcovFf2JKqRSS86apG9W21hhKd59przKEkKZpMAopYxxTSvev++Nxv11v18s159z3EVpZVTV/4mW+iZVSdVV1nUWA1tAKAIVMgzZIQaM/ALiuQ7p1vh5oyBijrDqm/TjGlLJ3yxDzEAdsW4Fecj6fTrGPXCA256fYOS+lwAdQXgjNuaDM7IgsS7KugDGsIKXE7vDyFv85n88X5zrbuXT4NuaH8z0hlPOaUk6pRcE0z+MQsWEcGP8CN/l2znmxOJOxx8Ps/BD7FMJgTAJ1q+uAu/Q+YO15GkMfp2kyGn4BuwwWpsSaYi0AAAAASUVORK5CYII=\'); background-size: cover; display: block;"\n    >\n      <img\n        class="gatsby-resp-image-image"\n        style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;"\n        alt="2020 11 24 17 27 22"\n        title=""\n        src="/static/2020-11-24-17-27-22-346f01a215e11a8a6398dc3e9b5d45b4-88eb7.png"\n        srcset="/static/2020-11-24-17-27-22-346f01a215e11a8a6398dc3e9b5d45b4-e0906.png 200w,\n/static/2020-11-24-17-27-22-346f01a215e11a8a6398dc3e9b5d45b4-4c29a.png 400w,\n/static/2020-11-24-17-27-22-346f01a215e11a8a6398dc3e9b5d45b4-88eb7.png 411w"\n        sizes="(max-width: 411px) 100vw, 411px"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<p>此时 Insert 模式跟记事本一样</p>\n<p>\n  <a\n    class="gatsby-resp-image-link"\n    href="/static/2020-11-24-17-28-14-d5cb209d16e061f9fb63728140baf835-ff6e4.png"\n    style="display: block"\n    target="_blank"\n    rel="noopener"\n  >\n  \n  <span\n    class="gatsby-resp-image-wrapper"\n    style="position: relative; display: block; ; max-width: 479px; margin-left: auto; margin-right: auto;"\n  >\n    <span\n      class="gatsby-resp-image-background-image"\n      style="padding-bottom: 18.37160751565762%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAIAAAABPYjBAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAAcUlEQVQI12OQkJBkZ+dgZWMnAzFQBCwszExNTS0sLKwsLYEkkDAzM7cwNzcDAxNjYwcHBydU4Ozs7OBgb2try1BUWJydkxMVHR0WFh4cEhIRERESGh4SGhoUHBIcHBoUFByfkJSckgrEyCg6Ojo8PBwA6KolW/aEcxgAAAAASUVORK5CYII=\'); background-size: cover; display: block;"\n    >\n      <img\n        class="gatsby-resp-image-image"\n        style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;"\n        alt="2020 11 24 17 28 14"\n        title=""\n        src="/static/2020-11-24-17-28-14-d5cb209d16e061f9fb63728140baf835-ff6e4.png"\n        srcset="/static/2020-11-24-17-28-14-d5cb209d16e061f9fb63728140baf835-d5807.png 200w,\n/static/2020-11-24-17-28-14-d5cb209d16e061f9fb63728140baf835-dba8d.png 400w,\n/static/2020-11-24-17-28-14-d5cb209d16e061f9fb63728140baf835-ff6e4.png 479w"\n        sizes="(max-width: 479px) 100vw, 479px"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<p>操作 vim 会经常在这两个模式下切换，就如同在记事本中你在选项卡和编辑内容窗口中切换一样</p>\n<h1 id="x"><a href="#x" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>x</h1>\n<p>Normal 模式下，按 x 删除当前光标向后所在的一个字符，大写字母 X 删除当前光标向前的字符</p>\n<h1 id="wq"><a href="#wq" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>:wq</h1>\n<p>保存+退出 vim(:w 保存 :q 退出) 后面跟文件名</p>\n<p>\n  <a\n    class="gatsby-resp-image-link"\n    href="/static/2020-11-24-17-41-01-82a7362c6b37a492eee1e5e442e34c7d-4c7f3.png"\n    style="display: block"\n    target="_blank"\n    rel="noopener"\n  >\n  \n  <span\n    class="gatsby-resp-image-wrapper"\n    style="position: relative; display: block; ; max-width: 384px; margin-left: auto; margin-right: auto;"\n  >\n    <span\n      class="gatsby-resp-image-background-image"\n      style="padding-bottom: 28.125%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAIAAABM9SnKAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAAdElEQVQY06XLQQqDMBCF4TFd6glyHIUkM1NCVppmIGSpFGrb3B/UtTv9Fj9v80Br3bUt3NBc/TWg1ENdAregs/0wGGO898xMRCEERPfkAzpkYmssIqUT+P++87x81rXWuu9pnEopIpJzTkleMUqSuFfkfbIBUEQq5/iKn7cAAAAASUVORK5CYII=\'); background-size: cover; display: block;"\n    >\n      <img\n        class="gatsby-resp-image-image"\n        style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;"\n        alt="2020 11 24 17 41 01"\n        title=""\n        src="/static/2020-11-24-17-41-01-82a7362c6b37a492eee1e5e442e34c7d-4c7f3.png"\n        srcset="/static/2020-11-24-17-41-01-82a7362c6b37a492eee1e5e442e34c7d-370ca.png 200w,\n/static/2020-11-24-17-41-01-82a7362c6b37a492eee1e5e442e34c7d-4c7f3.png 384w"\n        sizes="(max-width: 384px) 100vw, 384px"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<p>这个相当于记事本中的文件->（保存）另存为</p>\n<h1 id="dd"><a href="#dd" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>dd</h1>\n<p>删除当前行，并把删除的行保存到剪贴板里面，也是 IDE 里面常用的，快速删除一行代码，不用长按退格了。</p>\n<p>大写字母 D 删除当前行当前及之后的字符，如果当前以及当前之后的字符没有，则按一次删除之前的一个字符</p>\n<h1 id="p"><a href="#p" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>p</h1>\n<p>粘贴剪切板，这个功能挺常用的，如果在外面复制完东西，直接在 vim 界面按 p 就可以粘贴了</p>\n<h1 id="yy"><a href="#yy" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>yy</h1>\n<p>复制当前行到剪切板</p>\n<h1 id="help"><a href="#help" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>help</h1>\n<p>显示相关命令的帮助</p>\n<h1 id="q"><a href="#q" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>:q</h1>\n<p>退出</p>\n<h1 id="q-1"><a href="#q-1" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>:q!</h1>\n<p>不保存直接退出</p>\n<h1 id="a"><a href="#a" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>a</h1>\n<p>在光标后插入，如果本来光标不在最后就会自动帮你定格到最后输入</p>\n<p>\n  <a\n    class="gatsby-resp-image-link"\n    href="/static/2020-11-24-17-53-35-73614a01ebf3eba98768e20ce501bd02-891f5.png"\n    style="display: block"\n    target="_blank"\n    rel="noopener"\n  >\n  \n  <span\n    class="gatsby-resp-image-wrapper"\n    style="position: relative; display: block; ; max-width: 162px; margin-left: auto; margin-right: auto;"\n  >\n    <span\n      class="gatsby-resp-image-background-image"\n      style="padding-bottom: 30.864197530864196%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAIAAABM9SnKAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABEklEQVQY02PQ0DNQVVGSl1dQUlExMjJWU5RjZGJiIBIoqeqJiYoKCAiKS0pJSUgICfAxMjISq5lfUImRgZmdnQ3IZmZh4ebh4eXlZWFhYWJmZmNjYwIDNjZ2bh5uDiBg5wBymZmZgSTIjnnz5qxds+rwsePXL5xetnz5ipVr165bvX3b5uMnTuzed+Da9WtPH97Zd/DYwV17Dh46duTArkvXbj56/GjdmnX79+1jKKuo6mhvbW5u3b5jz6K5M2dMm7V46dIVSxZ2d3V39fROnjxp6uQJlVU1DbV1ra0dDbVV3b19U6ZMqamp7e3vZxAQFmNlZuZgZ9MzsrC2MLOxtDK3sNJQVWBkYmZjZ2dlY8PjZQAa51d7N4OXhAAAAABJRU5ErkJggg==\'); background-size: cover; display: block;"\n    >\n      <img\n        class="gatsby-resp-image-image"\n        style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;"\n        alt="2020 11 24 17 53 35"\n        title=""\n        src="/static/2020-11-24-17-53-35-73614a01ebf3eba98768e20ce501bd02-891f5.png"\n        srcset="/static/2020-11-24-17-53-35-73614a01ebf3eba98768e20ce501bd02-891f5.png 162w"\n        sizes="(max-width: 162px) 100vw, 162px"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<p>大写字母 A 在行尾插入</p>\n<h1 id="o"><a href="#o" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>o</h1>\n<p>在当前行后面插入一个新行，相当于记事本一行的最后敲回车键</p>\n<p>\n  <a\n    class="gatsby-resp-image-link"\n    href="/static/2020-11-24-17-54-30-d5328d16c350b3e76c0c6854f00a78ab-6144b.png"\n    style="display: block"\n    target="_blank"\n    rel="noopener"\n  >\n  \n  <span\n    class="gatsby-resp-image-wrapper"\n    style="position: relative; display: block; ; max-width: 232px; margin-left: auto; margin-right: auto;"\n  >\n    <span\n      class="gatsby-resp-image-background-image"\n      style="padding-bottom: 21.982758620689655%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAIAAAABPYjBAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAArUlEQVQI153LTQqCQAAF4BFd2yVEXXiOZP4cC6ldBB2jzCtUVBcQZUYnpzFokbTwZkUuat23eDwePOB6vu97QRC4jgMAsCzLNM0hBz/9Ow6AbY/eH8MwwB/OxwMX4t6q3f6U53l9kY1Sff/UqhW8lrJ6dN21aTgXWmvBq1urylIURSFrCTDGk2mSbrIsXW/TbLVcMBbPZ0k4DjEmGEHyQSmNGaOEsChCEGFCIEQvHws+lfYnAWEAAAAASUVORK5CYII=\'); background-size: cover; display: block;"\n    >\n      <img\n        class="gatsby-resp-image-image"\n        style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;"\n        alt="2020 11 24 17 54 30"\n        title=""\n        src="/static/2020-11-24-17-54-30-d5328d16c350b3e76c0c6854f00a78ab-6144b.png"\n        srcset="/static/2020-11-24-17-54-30-d5328d16c350b3e76c0c6854f00a78ab-b0d34.png 200w,\n/static/2020-11-24-17-54-30-d5328d16c350b3e76c0c6854f00a78ab-6144b.png 232w"\n        sizes="(max-width: 232px) 100vw, 232px"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<p>大写字母 O 在当前行前面插入</p>\n<h1 id="0"><a href="#0" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>0</h1>\n<p>按数字 0 就是到行头，跟 $ 是相反的</p>\n<h1 id="-符号"><a href="#-%E7%AC%A6%E5%8F%B7" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>^ 符号</h1>\n<p>这个是要结合 shift+6，到本行第一个非 blank 字符的位置（所谓 blank 字符就是空格，tab，换行，回车等）</p>\n<h1 id="-符号-1"><a href="#-%E7%AC%A6%E5%8F%B7-1" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>$ 符号</h1>\n<p>光标切换到本行行尾</p>\n<h1 id="pattern"><a href="#pattern" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>/pattern</h1>\n<p>搜索 pattern 的字符串</p>\n<p>如果搜索出多个匹配，按 n 可以定位到下一个</p>\n<h1 id="u"><a href="#u" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>u</h1>\n<p>撤销就是 Undo，这个功能基本 IDE 都是有的，挺常用的，如同我用 PS 时候 ctrl+z 那样方便</p>\n<h1 id="ctrlr"><a href="#ctrlr" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>ctrl+r</h1>\n<p>重做也就是 Redo</p>\n<h1 id="e-文件路径文件名"><a href="#e-%E6%96%87%E4%BB%B6%E8%B7%AF%E5%BE%84%E6%96%87%E4%BB%B6%E5%90%8D" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>:e &#x3C;文件路径/文件名></h1>\n<p>打开一个文件，直接在 Vim 中打开某文件</p>\n<h1 id="w"><a href="#w" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>:w</h1>\n<p>保存</p>\n<h1 id="saveas-文件路径文件名"><a href="#saveas-%E6%96%87%E4%BB%B6%E8%B7%AF%E5%BE%84%E6%96%87%E4%BB%B6%E5%90%8D" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>:saveas &#x3C;文件路径/文件名></h1>\n<p>另存为</p>\n<h1 id="x、zz、shiftz、wq"><a href="#x%E3%80%81zz%E3%80%81shiftz%E3%80%81wq" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>:x、ZZ、shift+z、:wq</h1>\n<p>上面这三个都是保存并退出，注意 ZZ 是不需要输入冒号和回车的</p>\n<h1 id="q-2"><a href="#q-2" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>q!</h1>\n<p>退出但不保存</p>\n<h1 id="qa"><a href="#qa" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>:qa</h1>\n<p>强行退出所有的正在编辑的文件，就算别的文件有更改</p>\n<h1 id="bn-bq"><a href="#bn-bq" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>:bn, :bq</h1>\n<p>有时候我们需要打开多个文件，就是在一个文件已经打开的情况下我们可以继续用:e 来打开其他文件，当打开多个文件的时候，可以使用上面这两个命令来切换下一个或者上一个文件</p>\n<p>\n  <a\n    class="gatsby-resp-image-link"\n    href="/static/2020-11-24-19-44-06-829c03fdbbcb0a8012add7dc031d3815-8b0e1.png"\n    style="display: block"\n    target="_blank"\n    rel="noopener"\n  >\n  \n  <span\n    class="gatsby-resp-image-wrapper"\n    style="position: relative; display: block; ; max-width: 294px; margin-left: auto; margin-right: auto;"\n  >\n    <span\n      class="gatsby-resp-image-background-image"\n      style="padding-bottom: 21.088435374149658%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAIAAAABPYjBAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAA80lEQVQI12NgZGBgYmbmVFPjFhVT19BQUVZWUlSWlZXl4+Pj19ERMtDlVVcV19dWVVTQUddQUpTikhRk5WBgYWVm5+BggAMmdnZ2XT1OfgE1VTVFBQUxEVFWNlYNHQ51NUYVAxYJdSYBeUYlFVY1SR4tSQE+DnYBIWEGe3t7BwdHSzMzUysr16RkW2fXkOCgiPBwX28fC3MrP3/b5vrUzMqMoinF+b0FVc2V5anlnbldJXkl2Tk5DLGxsXGxsS7Oztra2mpqahoaGqqqqjY2Nra2tjbW1kCjIyNj4mPik2KTkuKSszKz4uPjYhJjMzIz0lJTAYCyMXZEUaGuAAAAAElFTkSuQmCC\'); background-size: cover; display: block;"\n    >\n      <img\n        class="gatsby-resp-image-image"\n        style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;"\n        alt="2020 11 24 19 44 06"\n        title=""\n        src="/static/2020-11-24-19-44-06-829c03fdbbcb0a8012add7dc031d3815-8b0e1.png"\n        srcset="/static/2020-11-24-19-44-06-829c03fdbbcb0a8012add7dc031d3815-2d2ea.png 200w,\n/static/2020-11-24-19-44-06-829c03fdbbcb0a8012add7dc031d3815-8b0e1.png 294w"\n        sizes="(max-width: 294px) 100vw, 294px"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<h1 id="-符号-2"><a href="#-%E7%AC%A6%E5%8F%B7-2" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>. 符号</h1>\n<p>这个命令可以重复执行自己运行的上一个命令</p>\n<h1 id="n命令"><a href="#n%E5%91%BD%E4%BB%A4" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>N&#x3C;命令></h1>\n<p>打这个的时候是不可见的，也就是盲打，N 就是输入一个数字，比如我输入 9p，就会出现下图这个</p>\n<p>\n  <a\n    class="gatsby-resp-image-link"\n    href="/static/2020-11-24-19-44-46-43e2012d3a9708aee02badd820ed59df-b1313.png"\n    style="display: block"\n    target="_blank"\n    rel="noopener"\n  >\n  \n  <span\n    class="gatsby-resp-image-wrapper"\n    style="position: relative; display: block; ; max-width: 488px; margin-left: auto; margin-right: auto;"\n  >\n    <span\n      class="gatsby-resp-image-background-image"\n      style="padding-bottom: 7.377049180327869%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAABCAIAAABR8BlyAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAAQ0lEQVQI12Mws7CWlpaWk5fX0NBUVlYBMqSkpUXFxCUkJAUFBQUEhSQlpcXExPj4+EVFxSQkJUVERfn4+cUlJEVERADS1AYJDorNIgAAAABJRU5ErkJggg==\'); background-size: cover; display: block;"\n    >\n      <img\n        class="gatsby-resp-image-image"\n        style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;"\n        alt="2020 11 24 19 44 46"\n        title=""\n        src="/static/2020-11-24-19-44-46-43e2012d3a9708aee02badd820ed59df-b1313.png"\n        srcset="/static/2020-11-24-19-44-46-43e2012d3a9708aee02badd820ed59df-152e1.png 200w,\n/static/2020-11-24-19-44-46-43e2012d3a9708aee02badd820ed59df-4a935.png 400w,\n/static/2020-11-24-19-44-46-43e2012d3a9708aee02badd820ed59df-b1313.png 488w"\n        sizes="(max-width: 488px) 100vw, 488px"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<h1 id="g"><a href="#g" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>G</h1>\n<p>将光标定位到最后一行的头部</p>\n<p>\n  <a\n    class="gatsby-resp-image-link"\n    href="/static/2020-11-24-19-45-04-5f5a9cab1f5590a669395a72feb9b087-c66a8.png"\n    style="display: block"\n    target="_blank"\n    rel="noopener"\n  >\n  \n  <span\n    class="gatsby-resp-image-wrapper"\n    style="position: relative; display: block; ; max-width: 359px; margin-left: auto; margin-right: auto;"\n  >\n    <span\n      class="gatsby-resp-image-background-image"\n      style="padding-bottom: 36.49025069637884%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAIAAACHqfpvAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABIklEQVQY02WP246CMBiEuaN1pdAK2tKCtp4T99Ewe2cQPERd38DN7tvulMR44eRPoZN+mX+C5Xpj3cw5q7Wezhabzadz06Ica20w5XiCfylVzIXKtbU2h29KLoQcyWC+XCmlisKUhXF2ul6vdK6kUjhjFnEuOOdRvx+GIWMsHYiYxRCuMIPFcoXMsgBurPNwYbRCSq54kqSdYsYIpQnnwyxL8BGC9ijMJ4xcg61ecN7BgzTFJDGjlPLkDUZJPOzYJ6w1SmJ3nzzwySyKQkL4Mxk4IQRmMLFzgfZSGmNyrbG9f55lcjSkhPQ/vHoIIgQTRWjqBdN3rrZfl/NpW1W7uv6+Xc/n025X3+/3Zt8cj6fb9VLX+/ZwaJumbdvH4+fv96V/Dy4+XfxrgPgAAAAASUVORK5CYII=\'); background-size: cover; display: block;"\n    >\n      <img\n        class="gatsby-resp-image-image"\n        style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;"\n        alt="2020 11 24 19 45 04"\n        title=""\n        src="/static/2020-11-24-19-45-04-5f5a9cab1f5590a669395a72feb9b087-c66a8.png"\n        srcset="/static/2020-11-24-19-45-04-5f5a9cab1f5590a669395a72feb9b087-8bdaf.png 200w,\n/static/2020-11-24-19-45-04-5f5a9cab1f5590a669395a72feb9b087-c66a8.png 359w"\n        sizes="(max-width: 359px) 100vw, 359px"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<h1 id="w-1"><a href="#w-1" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>w</h1>\n<p>到下一个单词的开头。</p>\n<h1 id="e"><a href="#e" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>e</h1>\n<p>到下一个单词的结尾。</p>\n<ul>\n<li>如果你认为单词是由默认方式，那么就用小写的 e 和 w。默认上来说，一个单词由字母，数字和下划线组成</li>\n<li>如果你认为单词是由 blank 字符分隔符，那么你需要使用大写的 E 和 W。</li>\n</ul>\n<h1 id="-和-"><a href="#-%E5%92%8C-" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>* 和 <code class="language-text">#</code></h1>\n<p>当你把光标放到 catwsscat 上的时候按 * 或者 # 就会移动到匹配该单词的上一个或者下一个</p>\n<ul>\n<li><code class="language-text">*</code> 在键盘左边是匹配上一个单词</li>\n<li><code class="language-text">#</code> 在键盘右边是匹配下一个单词</li>\n</ul>\n<p>\n  <a\n    class="gatsby-resp-image-link"\n    href="/static/2020-11-24-19-48-58-c945057bccde320b778979c895d8cb6e-220d5.png"\n    style="display: block"\n    target="_blank"\n    rel="noopener"\n  >\n  \n  <span\n    class="gatsby-resp-image-wrapper"\n    style="position: relative; display: block; ; max-width: 442px; margin-left: auto; margin-right: auto;"\n  >\n    <span\n      class="gatsby-resp-image-background-image"\n      style="padding-bottom: 20.361990950226243%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAIAAAABPYjBAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAA10lEQVQI10XNQW+CMBgG4KKrgFaGtF0C6AIeCBpCi0TN/BXuwsXRRZNZL7oNDvz9ffPikzff4c2bfCiK4mkYQuJ4Po+j4G7iuowxz6OEjBzH4fyFMWpbVpqm7/t9VVVJkuAnjHzfp5Ryzqez1zAIqOfBjowAnGG/3xuYJiHjoW33DANj7D67Y0Is0zQQQuVqned5WZab7QYUstjt3qQQy7vFAp6lUhZACAF9If8JKbMsQ+evc9s01+ut67qL1kqp0/Go1Ceo61rV6uNwuH3/NA+/kLZttdZ/hQMtzQbF0PUAAAAASUVORK5CYII=\'); background-size: cover; display: block;"\n    >\n      <img\n        class="gatsby-resp-image-image"\n        style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;"\n        alt="2020 11 24 19 48 58"\n        title=""\n        src="/static/2020-11-24-19-48-58-c945057bccde320b778979c895d8cb6e-220d5.png"\n        srcset="/static/2020-11-24-19-48-58-c945057bccde320b778979c895d8cb6e-c979e.png 200w,\n/static/2020-11-24-19-48-58-c945057bccde320b778979c895d8cb6e-cb981.png 400w,\n/static/2020-11-24-19-48-58-c945057bccde320b778979c895d8cb6e-220d5.png 442w"\n        sizes="(max-width: 442px) 100vw, 442px"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<h1 id="-符号-3"><a href="#-%E7%AC%A6%E5%8F%B7-3" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><code class="language-text">%</code> 符号</h1>\n<p>匹配括号移动，支持(，{， [，你需要把光标先移到括号上</p>\n<h1 id="v"><a href="#v" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>v</h1>\n<p>进入可视化选择后按键盘的上下左右的方向键都会帮你自动选择</p>\n<p>\n  <a\n    class="gatsby-resp-image-link"\n    href="/static/2020-11-24-19-51-40-c7421e3b9fae7e71133f5eec6dc915d2-713d5.png"\n    style="display: block"\n    target="_blank"\n    rel="noopener"\n  >\n  \n  <span\n    class="gatsby-resp-image-wrapper"\n    style="position: relative; display: block; ; max-width: 163px; margin-left: auto; margin-right: auto;"\n  >\n    <span\n      class="gatsby-resp-image-background-image"\n      style="padding-bottom: 29.447852760736193%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAIAAABM9SnKAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABCUlEQVQY02PQ1lBTVVFVUVMLDAySFRNmYGBgZGRkIBII8PFzc/Pw8PJJy0hzsLMxkATY2Ti5ebg5OTnY2dn5+PgF+AW4uLg4ODh4+Xg5OTm5gRxubj4+PiANtAEkwsPDAQZMzCwM+/ftuXz12usnD3bu3LFr98H9B/aePnXy9u1bF69cv//w4d/vHy9evXn5zJmLF29cv3L+9r17P37/O3Lw8JnTp+88eslQXlZWWl65ZNHCaVOmtLe0zZgzr6m+Ni83p6y8srKqqqm+JiMzu6igsLysqrAgt6CwqKGxKTcnp7SsvL29jYGJgYGNnV1ZRUVTXUNfV8fQ1EpfWxPoHSYWNlY2VvxeBgAhYFdyldT5CwAAAABJRU5ErkJggg==\'); background-size: cover; display: block;"\n    >\n      <img\n        class="gatsby-resp-image-image"\n        style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;"\n        alt="2020 11 24 19 51 40"\n        title=""\n        src="/static/2020-11-24-19-51-40-c7421e3b9fae7e71133f5eec6dc915d2-713d5.png"\n        srcset="/static/2020-11-24-19-51-40-c7421e3b9fae7e71133f5eec6dc915d2-713d5.png 163w"\n        sizes="(max-width: 163px) 100vw, 163px"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<p>可视化选择下</p>\n<ul>\n<li>J → 把所有的行连接起来（变成一行）</li>\n<li>&#x3C; 或 > → 左右缩进</li>\n<li>= → 自动给缩进 （这个确实挺方便的）</li>\n</ul>',
id:"/github/workspace/blog/Vim快捷键入门/index.md absPath of file >>> MarkdownRemark",timeToRead:4,frontmatter:{date:"2020-11-24 17:16:25",path:"/vim-shortcut-key-practice-learn/",tags:"后端, Vim",title:"Vim快捷键入门",draft:null}}],page:5,pagesSum:38,length:187,prevPath:"/page/4",nextPath:"/page/6"}}}});