webpackJsonp([0x933979e8822b],{1179:function(n,a){n.exports={data:{site:{siteMetadata:{description:'前端工程师，黑猫女王控，欢迎勾搭，技术相关<a href="https://github.com/towavephone" target="_blank">@towavephone</a>，QQ闲聊<a href="tencent://AddContact/?fromId=45&fromSubId=1&subcmd=all&uin=634407147&website=www.oicqzone.com">@towave</a>，bili关注<a href="https://space.bilibili.com/11507708#/" target="_blank">@towave</a>',siteUrl:"https://blog.towavephone.com"}}},pathContext:{posts:[{excerpt:"HTML 与文件下载 如果希望在前端侧直接触发某些资源的下载，最方便快捷的方法就是使用 HTML5 原生的 download 属性，例如： 但显然，如果纯粹利用 HTML 属性来实现文件的下载（而不是浏览器打开或浏览），对于动态内容，就无能为力。 例如，我们对页面进行分享的时候，希望分享图片是页面内容的实时截图，此时，这个图片就是动态的，纯 HTML 显然是无法满足我们的需求的，借助 JS 和其它一些 HTML5 特性，例如，将页面元素转换到 canvas…",html:'<h1 id="html-与文件下载"><a href="#html-%E4%B8%8E%E6%96%87%E4%BB%B6%E4%B8%8B%E8%BD%BD" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>HTML 与文件下载</h1>\n<p>如果希望在前端侧直接触发某些资源的下载，最方便快捷的方法就是使用 HTML5 原生的 download 属性，例如：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="45848888699217500000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`<a href=&quot;large.jpg&quot; download>下载</a>`, `45848888699217500000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                data-tooltip="复制"\n              >\n                <svg class="gatsby-code-button-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0V0z"/><path d="M16 1H2v16h2V3h12V1zm-1 4l6 6v12H6V5h9zm-1 7h5.5L14 6.5V12z"/></svg>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="html"><pre style="counter-reset: linenumber NaN" class="language-html line-numbers"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>large.jpg<span class="token punctuation">"</span></span> <span class="token attr-name">download</span><span class="token punctuation">></span></span>下载<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>但显然，如果纯粹利用 HTML 属性来实现文件的下载（而不是浏览器打开或浏览），对于动态内容，就无能为力。</p>\n<p>例如，我们对页面进行分享的时候，希望分享图片是页面内容的实时截图，此时，这个图片就是动态的，纯 HTML 显然是无法满足我们的需求的，借助 JS 和其它一些 HTML5 特性，例如，将页面元素转换到 canvas 上，然后再转成图片进行下载。</p>\n<p>但本文要介绍的下载不是图片的下载，而是文本信息的下载，所需要使用的 HTML 特性不是 canvas，而是其它。</p>\n<h1 id="借助-html5-blob-实现文本信息文件下载"><a href="#%E5%80%9F%E5%8A%A9-html5-blob-%E5%AE%9E%E7%8E%B0%E6%96%87%E6%9C%AC%E4%BF%A1%E6%81%AF%E6%96%87%E4%BB%B6%E4%B8%8B%E8%BD%BD" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>借助 HTML5 Blob 实现文本信息文件下载</h1>\n<p>原理其实很简单，我们可以将文本或者 JS 字符串信息借助 Blob 转换成二进制，然后，作为<code class="language-text">&lt;a&gt;</code>元素的 href 属性，配合 download 属性，实现下载。</p>\n<p>代码也比较简单，如下示意（兼容 Chrome 和 Firefox）：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="15206866352125004000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`var funDownload = function(content, filename) {\n  // 创建隐藏的可下载链接\n  var eleLink = document.createElement(\'a\');\n  eleLink.download = filename;\n  eleLink.style.display = \'none\';\n  // 字符内容转变成blob地址\n  var blob = new Blob([content]);\n  eleLink.href = URL.createObjectURL(blob);\n  // 触发点击\n  document.body.appendChild(eleLink);\n  eleLink.click();\n  // 然后移除\n  document.body.removeChild(eleLink);\n};`, `15206866352125004000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                data-tooltip="复制"\n              >\n                <svg class="gatsby-code-button-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0V0z"/><path d="M16 1H2v16h2V3h12V1zm-1 4l6 6v12H6V5h9zm-1 7h5.5L14 6.5V12z"/></svg>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">var</span> <span class="token function-variable function">funDownload</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">content<span class="token punctuation">,</span> filename</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token comment">// 创建隐藏的可下载链接</span>\n  <span class="token keyword">var</span> eleLink <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">\'a\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  eleLink<span class="token punctuation">.</span>download <span class="token operator">=</span> filename<span class="token punctuation">;</span>\n  eleLink<span class="token punctuation">.</span>style<span class="token punctuation">.</span>display <span class="token operator">=</span> <span class="token string">\'none\'</span><span class="token punctuation">;</span>\n  <span class="token comment">// 字符内容转变成blob地址</span>\n  <span class="token keyword">var</span> blob <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Blob</span><span class="token punctuation">(</span><span class="token punctuation">[</span>content<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  eleLink<span class="token punctuation">.</span>href <span class="token operator">=</span> <span class="token constant">URL</span><span class="token punctuation">.</span><span class="token function">createObjectURL</span><span class="token punctuation">(</span>blob<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token comment">// 触发点击</span>\n  document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>eleLink<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  eleLink<span class="token punctuation">.</span><span class="token function">click</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token comment">// 然后移除</span>\n  document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">removeChild</span><span class="token punctuation">(</span>eleLink<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>其中，content 指需要下载的文本或字符串内容，filename 指下载到系统中的文件名称。</p>\n<h1 id="借助-base64-实现任意文件下载"><a href="#%E5%80%9F%E5%8A%A9-base64-%E5%AE%9E%E7%8E%B0%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E4%B8%8B%E8%BD%BD" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>借助 Base64 实现任意文件下载</h1>\n<p>对于非文本文件，也是可以直接 JS 触发下载的，例如，如果我们想下载一张图片，可以把这张图片转换成 base64 格式，然后下载。</p>\n<p>代码示意：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="33111043334898647000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`var funDownload = function(domImg, filename) {\n  // 创建隐藏的可下载链接\n  var eleLink = document.createElement(\'a\');\n  eleLink.download = filename;\n  eleLink.style.display = \'none\';\n  // 图片转base64地址\n  var canvas = document.createElement(\'canvas\');\n  var context = canvas.getContext(\'2d\');\n  var width = domImg.naturalWidth;\n  var height = domImg.naturalHeight;\n  context.drawImage(domImg, 0, 0);\n  // 如果是PNG图片，则canvas.toDataURL(\'image/png\')\n  eleLink.href = canvas.toDataURL(\'image/jpeg\');\n  // 触发点击，这里为了兼容Firefox加了appendChild方法\n  document.body.appendChild(eleLink);\n  eleLink.click();\n  // 然后移除\n  document.body.removeChild(eleLink);\n};`, `33111043334898647000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                data-tooltip="复制"\n              >\n                <svg class="gatsby-code-button-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0V0z"/><path d="M16 1H2v16h2V3h12V1zm-1 4l6 6v12H6V5h9zm-1 7h5.5L14 6.5V12z"/></svg>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">var</span> <span class="token function-variable function">funDownload</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">domImg<span class="token punctuation">,</span> filename</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token comment">// 创建隐藏的可下载链接</span>\n  <span class="token keyword">var</span> eleLink <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">\'a\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  eleLink<span class="token punctuation">.</span>download <span class="token operator">=</span> filename<span class="token punctuation">;</span>\n  eleLink<span class="token punctuation">.</span>style<span class="token punctuation">.</span>display <span class="token operator">=</span> <span class="token string">\'none\'</span><span class="token punctuation">;</span>\n  <span class="token comment">// 图片转base64地址</span>\n  <span class="token keyword">var</span> canvas <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">\'canvas\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token keyword">var</span> context <span class="token operator">=</span> canvas<span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token string">\'2d\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token keyword">var</span> width <span class="token operator">=</span> domImg<span class="token punctuation">.</span>naturalWidth<span class="token punctuation">;</span>\n  <span class="token keyword">var</span> height <span class="token operator">=</span> domImg<span class="token punctuation">.</span>naturalHeight<span class="token punctuation">;</span>\n  context<span class="token punctuation">.</span><span class="token function">drawImage</span><span class="token punctuation">(</span>domImg<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token comment">// 如果是PNG图片，则canvas.toDataURL(\'image/png\')</span>\n  eleLink<span class="token punctuation">.</span>href <span class="token operator">=</span> canvas<span class="token punctuation">.</span><span class="token function">toDataURL</span><span class="token punctuation">(</span><span class="token string">\'image/jpeg\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token comment">// 触发点击，这里为了兼容Firefox加了appendChild方法</span>\n  document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>eleLink<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  eleLink<span class="token punctuation">.</span><span class="token function">click</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token comment">// 然后移除</span>\n  document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">removeChild</span><span class="token punctuation">(</span>eleLink<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<h1 id="总结"><a href="#%E6%80%BB%E7%BB%93" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>总结</h1>\n<p>不止是.html 文件，.txt, .json 等只要内容是文本的文件，都是可以利用这种小技巧实现下载的。</p>\n<p>在 Chrome 浏览器下，模拟点击创建的<code class="language-text">&lt;a&gt;</code>元素即使不 append 到页面中，也是可以触发下载的，但是在 Firefox 浏览器中却不行，因此，上面的 funDownload()方法有一个 appendChild 和 removeChild 的处理，就是为了兼容 Firefox 浏览器。</p>\n<p>当然，有时对 canvas 图片进行 toDataURL 操作时，会存在跨域问题的报错，具体见<a href="/crossorigin-canvas-getimagedata-cors/">解决 canvas 图片 getImageData,toDataURL 跨域问题</a></p>',id:"/github/workspace/blog/JS前端创建html或json文件并浏览器导出下载/index.md absPath of file >>> MarkdownRemark",timeToRead:2,frontmatter:{date:"2019-12-15 19:55:53",path:"/js-text-string-download-as-html-json-file/",tags:"前端, JS, JS知识点",title:"JS前端创建html或json文件并浏览器导出下载",draft:null}},{excerpt:"简介 首先看下面这种截图： 如果我们想实现点击上面的下载按钮下载一张图片，你会如何实现？ 我们可能会想到一个最简单的方法，就是直接按钮 a 标签链接一张图片，类似下面这样： 但是，想法虽好，实际效果却不是我们想要的，因为浏览器可以直接浏览图片，因此，我们点击下面的“下载”链接，并是不下载图片，而是在新窗口直接浏览图片。 于是，基本上，目前的实现都是放弃 HTML 策略，而是使用，例如 php 这样的后端语言，通过告知浏览器 header…",html:'<h1 id="简介"><a href="#%E7%AE%80%E4%BB%8B" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>简介</h1>\n<p>首先看下面这种截图：</p>\n<p>\n  <a\n    class="gatsby-resp-image-link"\n    href="/static/2019-12-15-19-38-16-bc69524afbdb107d9c10b146d548251e-84da0.png"\n    style="display: block"\n    target="_blank"\n    rel="noopener"\n  >\n  \n  <span\n    class="gatsby-resp-image-wrapper"\n    style="position: relative; display: block; ; max-width: 295px; margin-left: auto; margin-right: auto;"\n  >\n    <span\n      class="gatsby-resp-image-background-image"\n      style="padding-bottom: 47.45762711864407%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAIAAAC9o5sfAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABJ0lEQVQoz4VRy27CMBDM//8WB269UAKEVBGQN0nsJODXrk3XMaKtWqmrOXhnZ9bxJHLO2f/KLfWdQUStdRRmj5/leyIXDx3Z0J/OZzI8R48HAKRpGiFaXBa8QPqwjxAYbYyQ+tXSQWl9SJJIAXIJo8IArnAQyAT0d+juwKUnmTDXSbSTCJpJ226W8f7gzYNEpuyg7GRcelX7Rq4z8XaRm0Iyabl25TC+H7Ptx7kXXklMO6stmTXgTeFd24DZ34M50zUX/SxnBUQKcPTRhKARxvGb2pHZv9faEM+SkKU8lJLH5Lhareu68a0UQ991Xf9UUmDGJPTmP9MGwDyvN5td217DLkbFR/clAG+m31UURf6rqqpqmrqqysslJwG1VVmGEbVZlsVx/Alx+wP+qS+dhQAAAABJRU5ErkJggg==\'); background-size: cover; display: block;"\n    >\n      <img\n        class="gatsby-resp-image-image"\n        style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;"\n        alt="2019 12 15 19 38 16"\n        title=""\n        src="/static/2019-12-15-19-38-16-bc69524afbdb107d9c10b146d548251e-84da0.png"\n        srcset="/static/2019-12-15-19-38-16-bc69524afbdb107d9c10b146d548251e-38392.png 200w,\n/static/2019-12-15-19-38-16-bc69524afbdb107d9c10b146d548251e-84da0.png 295w"\n        sizes="(max-width: 295px) 100vw, 295px"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<p>如果我们想实现点击上面的下载按钮下载一张图片，你会如何实现？</p>\n<p>我们可能会想到一个最简单的方法，就是直接按钮 a 标签链接一张图片，类似下面这样：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="12258943180037108000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`<a href=&quot;large.jpg&quot;>下载</a>`, `12258943180037108000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                data-tooltip="复制"\n              >\n                <svg class="gatsby-code-button-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0V0z"/><path d="M16 1H2v16h2V3h12V1zm-1 4l6 6v12H6V5h9zm-1 7h5.5L14 6.5V12z"/></svg>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="html"><pre style="counter-reset: linenumber NaN" class="language-html line-numbers"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>large.jpg<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>下载<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>但是，想法虽好，实际效果却不是我们想要的，因为浏览器可以直接浏览图片，因此，我们点击下面的“下载”链接，并是不下载图片，而是在新窗口直接浏览图片。</p>\n<p>于是，基本上，目前的实现都是放弃 HTML 策略，而是使用，例如 php 这样的后端语言，通过告知浏览器 header 信息，来实现下载。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="29287532153232744000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`header(\'Content-type: image/jpeg\');\nheader(&quot;Content-Disposition: attachment; filename=\'download.jpg\'&quot;);`, `29287532153232744000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                data-tooltip="复制"\n              >\n                <svg class="gatsby-code-button-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0V0z"/><path d="M16 1H2v16h2V3h12V1zm-1 4l6 6v12H6V5h9zm-1 7h5.5L14 6.5V12z"/></svg>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token function">header</span><span class="token punctuation">(</span><span class="token string">\'Content-type: image/jpeg\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token function">header</span><span class="token punctuation">(</span><span class="token string">"Content-Disposition: attachment; filename=\'download.jpg\'"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p>然而，这种前后端都要操心的方式神烦，现在都流行前后端分离，还搅在一起太累了，感觉不会再爱了。</p>\n<p>那有没有什么只需要前端动动指头就能实现下载的方式呢？有，就是本文要介绍的 download 属性。</p>\n<p>例如，我们希望点击“下载”链接下载图片而不是浏览，直接增加一个 download 属性就可以：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="73132724100262750000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`<a href=&quot;large.jpg&quot; download>下载</a>`, `73132724100262750000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                data-tooltip="复制"\n              >\n                <svg class="gatsby-code-button-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0V0z"/><path d="M16 1H2v16h2V3h12V1zm-1 4l6 6v12H6V5h9zm-1 7h5.5L14 6.5V12z"/></svg>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="html"><pre style="counter-reset: linenumber NaN" class="language-html line-numbers"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>large.jpg<span class="token punctuation">"</span></span> <span class="token attr-name">download</span><span class="token punctuation">></span></span>下载<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>结果在 Chrome 浏览器下（FireFox 浏览器因为跨域限制无效）：</p>\n<p>\n  <a\n    class="gatsby-resp-image-link"\n    href="/static/2019-12-15-19-41-40-b92ceb830196ef971df752c384fbf534-ab1e0.png"\n    style="display: block"\n    target="_blank"\n    rel="noopener"\n  >\n  \n  <span\n    class="gatsby-resp-image-wrapper"\n    style="position: relative; display: block; ; max-width: 530px; margin-left: auto; margin-right: auto;"\n  >\n    <span\n      class="gatsby-resp-image-background-image"\n      style="padding-bottom: 32.264150943396224%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAIAAABM9SnKAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABLElEQVQY01WP3U7CQBCF+/6PYKLiLTES4gUXCDGIFEshSCVAVChtsdvd7bJt2Z8WtmvVeMHJl0lmJpMzxyiKQgguc5Hncut5NOMQIc/zFstVmmaUUs65Uup0rmqSZZkhpSRximBKCLPseRARiODMcQbmEIAIx7GQsixLdS6tNULIqHZhmLjrBCE2tFbuDgIQjuxRp/vo+7skPRTHyqj8Rf1xrJpSY4wNxhhGUfVgTJBpjb4Q5YwBAHw/EJyLA1UnoXWh9ekf9VerdMY+Sd/et9mBVTfjqbP2w1wKhLG72bhBVJ8VV7a8HueXJq0N4I2JawN08QSbU+IHgcG4gDGVP8HUx9r93O72JJ5MJr1e35mvbruvjf6iZW3qbbveem48WHdts9l5ue+Yy8XyG0rRRfKjXLiKAAAAAElFTkSuQmCC\'); background-size: cover; display: block;"\n    >\n      <img\n        class="gatsby-resp-image-image"\n        style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;"\n        alt="2019 12 15 19 41 40"\n        title=""\n        src="/static/2019-12-15-19-41-40-b92ceb830196ef971df752c384fbf534-ab1e0.png"\n        srcset="/static/2019-12-15-19-41-40-b92ceb830196ef971df752c384fbf534-8e92d.png 200w,\n/static/2019-12-15-19-41-40-b92ceb830196ef971df752c384fbf534-d963f.png 400w,\n/static/2019-12-15-19-41-40-b92ceb830196ef971df752c384fbf534-ab1e0.png 530w"\n        sizes="(max-width: 530px) 100vw, 530px"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<p>不仅如此，我们还可以指定下载图片的文件名：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="27747203116093755000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`<a href=\'index_logo.gif\' download=\'_5332_.gif\'>\n  下载\n</a>`, `27747203116093755000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                data-tooltip="复制"\n              >\n                <svg class="gatsby-code-button-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0V0z"/><path d="M16 1H2v16h2V3h12V1zm-1 4l6 6v12H6V5h9zm-1 7h5.5L14 6.5V12z"/></svg>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token operator">&lt;</span>a href<span class="token operator">=</span><span class="token string">\'index_logo.gif\'</span> download<span class="token operator">=</span><span class="token string">\'_5332_.gif\'</span><span class="token operator">></span>\n  下载\n<span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">></span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>如果后缀名一样，我们还可以缺省，直接文件名：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="40452432650573810000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`<a href=\'index_logo.gif\' download=\'_5332_\'>\n  下载\n</a>`, `40452432650573810000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                data-tooltip="复制"\n              >\n                <svg class="gatsby-code-button-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0V0z"/><path d="M16 1H2v16h2V3h12V1zm-1 4l6 6v12H6V5h9zm-1 7h5.5L14 6.5V12z"/></svg>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token operator">&lt;</span>a href<span class="token operator">=</span><span class="token string">\'index_logo.gif\'</span> download<span class="token operator">=</span><span class="token string">\'_5332_\'</span><span class="token operator">></span>\n  下载\n<span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">></span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>\n  <a\n    class="gatsby-resp-image-link"\n    href="/static/2019-12-15-19-48-37-d9e590b8682cc8449b0ad563f5010f77-bc7e0.png"\n    style="display: block"\n    target="_blank"\n    rel="noopener"\n  >\n  \n  <span\n    class="gatsby-resp-image-wrapper"\n    style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;"\n  >\n    <span\n      class="gatsby-resp-image-background-image"\n      style="padding-bottom: 9.685641461342396%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAACCAIAAADXZGvcAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAARElEQVQI12N4+/bt3du3Lt+6377r8frzrz5++vLu47f3nwijl+8+M7x48eLatWs3bt4+du7aqQtXbt+69ez5c6LQs+cAwblsAFe4tFsAAAAASUVORK5CYII=\'); background-size: cover; display: block;"\n    >\n      <img\n        class="gatsby-resp-image-image"\n        style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;"\n        alt="2019 12 15 19 48 37"\n        title=""\n        src="/static/2019-12-15-19-48-37-d9e590b8682cc8449b0ad563f5010f77-fee1c.png"\n        srcset="/static/2019-12-15-19-48-37-d9e590b8682cc8449b0ad563f5010f77-a67b7.png 200w,\n/static/2019-12-15-19-48-37-d9e590b8682cc8449b0ad563f5010f77-0b187.png 400w,\n/static/2019-12-15-19-48-37-d9e590b8682cc8449b0ad563f5010f77-fee1c.png 800w,\n/static/2019-12-15-19-48-37-d9e590b8682cc8449b0ad563f5010f77-bc7e0.png 1177w"\n        sizes="(max-width: 800px) 100vw, 800px"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<h1 id="浏览器兼容性和跨域策略"><a href="#%E6%B5%8F%E8%A7%88%E5%99%A8%E5%85%BC%E5%AE%B9%E6%80%A7%E5%92%8C%E8%B7%A8%E5%9F%9F%E7%AD%96%E7%95%A5" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>浏览器兼容性和跨域策略</h1>\n<p>\n  <a\n    class="gatsby-resp-image-link"\n    href="/static/2019-12-15-19-49-10-1a1d9ea1fe5d4b3821691aa36e9f193d-a76b9.png"\n    style="display: block"\n    target="_blank"\n    rel="noopener"\n  >\n  \n  <span\n    class="gatsby-resp-image-wrapper"\n    style="position: relative; display: block; ; max-width: 559px; margin-left: auto; margin-right: auto;"\n  >\n    <span\n      class="gatsby-resp-image-background-image"\n      style="padding-bottom: 47.406082289803216%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAIAAAC9o5sfAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAB6klEQVQoz3WO20/TcBzF++f54AP6QPDBC5iZEM0gATc7F3erYxtNDDC3RRQURcSEZS/swljCuq7rvR2lt41hpY61G8NsjAff/Pmg8UGTz8M5yfme84UUbl+oFQQiJxI5gcxLVJGrZsVqVuKLjLxrnwpDS/kfUN+sd044gNXiLCAMzjKAZTsGa36l++3DX7mO/O/jS1u96mqjrnZ1rg/PFEth7CbXa/K2zo4sbWRrA5DrqUNbGfxVATQA+m2OLttys1VOlYLb1cQSvpYk3nXN+sCS20eEhhf6hggG/rwA9KingWUFcGYIdLmY43fGDxwuwnO3/MhRmZX4PYUpbRIpb9bN6/lzA3SBsHrxTTrVKbNBQV9UqkFVtumN2/vOAI44MVeQCM5W3PMYLHic6tQdJP/kBjmdJl5jO5utw/KP78edFl3bXWeKnyApsUCOXX/70X2LmfFXfTDmDWMhb+VZEA9klmcyz6dihacPGDi96iYnxvStxPDi2JQPMhFHNj4HNV4i0s1rW+/h+/jjCI5E2cUkvxxlYii96KkFHNhcFA/7uOjeRkCdnDhJr4lMia3np/F5PxmAlFcx9t54+nPIx0WS1IsYj6bEeIxFURZdIlEER1bZFVSJFz8gwsNJcSXEIjD2Juwi/AvV8E8tL5CujTY5TAAAAABJRU5ErkJggg==\'); background-size: cover; display: block;"\n    >\n      <img\n        class="gatsby-resp-image-image"\n        style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;"\n        alt="2019 12 15 19 49 10"\n        title=""\n        src="/static/2019-12-15-19-49-10-1a1d9ea1fe5d4b3821691aa36e9f193d-a76b9.png"\n        srcset="/static/2019-12-15-19-49-10-1a1d9ea1fe5d4b3821691aa36e9f193d-8c77e.png 200w,\n/static/2019-12-15-19-49-10-1a1d9ea1fe5d4b3821691aa36e9f193d-f1700.png 400w,\n/static/2019-12-15-19-49-10-1a1d9ea1fe5d4b3821691aa36e9f193d-a76b9.png 559w"\n        sizes="(max-width: 559px) 100vw, 559px"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<p>然而，caniuse 展示的兼容性不是很准确，主要表现在跨域策略的处理上，由于我手上没有 IE13，所以，只能对比 Chrome 浏览器和 FireFox 浏览器：</p>\n<p>如果需要下载的资源是跨域的，包括跨子域，在 Chrome 浏览器下，使用 download 属性是可以下载的，但是，并不能重置下载的文件的命名；而 FireFox 浏览器下，则 download 属性是无效的，也就是 FireFox 浏览器无论如何都不支持跨域资源的 download 属性下载。</p>\n<p>而如果资源是同域名的，则两个浏览器都是畅通无阻的下载，不会出现下载变浏览的情况。</p>\n<p>\n  <a\n    class="gatsby-resp-image-link"\n    href="/static/2019-12-15-19-50-48-9c5da267a1471fc9757ee3601258ef12-6566f.png"\n    style="display: block"\n    target="_blank"\n    rel="noopener"\n  >\n  \n  <span\n    class="gatsby-resp-image-wrapper"\n    style="position: relative; display: block; ; max-width: 462px; margin-left: auto; margin-right: auto;"\n  >\n    <span\n      class="gatsby-resp-image-background-image"\n      style="padding-bottom: 77.92207792207792%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAIAAACZeshMAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAChUlEQVQoz3VSaXObMBD1//8pmUnzsWnaJiVtDsxlMKckbhsQh4SA2GmnabrYSScf0p03OwOr9/ZcBBlNaL9px7zbpf0z7v54zRvUTwDUPkXsKWW/8/E5z5v88lN2870oyoWke6qfLZ1YRVRJd9dklPD07R+ivRQ/StH+Ntmr+d4ofhl+oZ1fqFc38lJZuI6ta6rveWmSDoL3rBM9m8HB8zGJBA6GiAxROEXhmMR8GMbHnyWfFFVbOEmpOFiW74qqmqZpHMcBwuMohJgedsxYXZye6pJk3d5GmrbzfSAPPS9pO5OLuiVxcnfzw1o7hBDLsqIoiuM4yzJMSBUgkSQ9IE1FHA9ZxkFV9LTpVCA/TFOWJveyHBLieS5gvbZN0zJXpu/7Def9NPXjyMfx6DnngxBb2i2BDHnk+3vIlec5CgLLNA3DQAhTSsUwQBv9WwOtvh8GkVedrGgLKM+2bYxxECBI5UFq10MYl1VV0YrWNWMMsrFXtF0HGi/kXoisqIAZhuGhhMTQtfPz85OTk7OzD5+/fIX6QxISDBMI4yR2Xbcotpuaz2RQorRaW5ZpWRgRSiMUBtBzx1jbdm3b1rM1ZVk5tn0tXSNMmprmlB3JDIJRGAYIkVkdYdCP4812s9luoXZQ59Ar52maIoTSNOOMvZQNMXiBMTLn3KaqqIauO64DXlUUx3FBD2jzdoWAG4CBjYPIXslMHGw42nwjgzgcyvFrDsHMYbkHOzx8nTbMUvTvG/xvGU9ou/IxKaqi6cpyC53VDU2LZqnpi6bp5k2wdwCdFg1bk/jj5TfdCYKsgFVeSRJGAU6LO1lZmC52gtD+DyC08oiJE8MPbZ8AXBTZHja9EJPwL74DTOExAzPqAAAAAElFTkSuQmCC\'); background-size: cover; display: block;"\n    >\n      <img\n        class="gatsby-resp-image-image"\n        style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;"\n        alt="2019 12 15 19 50 48"\n        title=""\n        src="/static/2019-12-15-19-50-48-9c5da267a1471fc9757ee3601258ef12-6566f.png"\n        srcset="/static/2019-12-15-19-50-48-9c5da267a1471fc9757ee3601258ef12-c4b43.png 200w,\n/static/2019-12-15-19-50-48-9c5da267a1471fc9757ee3601258ef12-5dba5.png 400w,\n/static/2019-12-15-19-50-48-9c5da267a1471fc9757ee3601258ef12-6566f.png 462w"\n        sizes="(max-width: 462px) 100vw, 462px"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<h2 id="是否支持-download-属性的监测"><a href="#%E6%98%AF%E5%90%A6%E6%94%AF%E6%8C%81-download-%E5%B1%9E%E6%80%A7%E7%9A%84%E7%9B%91%E6%B5%8B" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>是否支持 download 属性的监测</h2>\n<p>要监测当前浏览器是否支持 download 属性，一行 JS 代码就可以了，如下：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="51199214839966860000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`var isSupportDownload = \'download\' in document.createElement(\'a\');`, `51199214839966860000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                data-tooltip="复制"\n              >\n                <svg class="gatsby-code-button-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0V0z"/><path d="M16 1H2v16h2V3h12V1zm-1 4l6 6v12H6V5h9zm-1 7h5.5L14 6.5V12z"/></svg>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">var</span> isSupportDownload <span class="token operator">=</span> <span class="token string">\'download\'</span> <span class="token keyword">in</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">\'a\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<h1 id="总结"><a href="#%E6%80%BB%E7%BB%93" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>总结</h1>\n<p>除了图片资源，我们还可以是 PDF 资源，或者 txt 资源等等。尤其 Chrome 等浏览器可以直接打开 PDF 文件，使得此文件格式需要 download 处理的场景越来越普遍。</p>\n<p>此 HTML 属性虽然非常实用和方便，但是兼容性制约了我们的大规模应用。</p>\n<p>同时考虑到很多时候，需要进行一些下载的统计，纯前端的方式想要保存下载量数据，还是有些吃紧，需要跟开发的同学配合才行，还不如使用传统方法。</p>\n<p>所以，download 属性的未来前景在哪里？当下是否可以直接加入到实际项目？还需要我们一起好好想想。其实使用 JS 实现 download 属性的 polyfill 并不难，但是，考虑到为何不所有浏览器都使用 polyfill 的方法，又觉得为了技术而技术是不太妥当的。</p>\n<p>如果是需要用 JS 触发下载，见下一篇文章<a href="/js-text-string-download-as-html-json-file/">使用 JS 让文本字符串作为 html 或 JSON 文件下载</a></p>',
id:"/github/workspace/blog/HTML5中的download属性/index.md absPath of file >>> MarkdownRemark",timeToRead:2,frontmatter:{date:"2019-12-15 19:36:41",path:"/html-download-attribute/",tags:"前端, DOM, DOM知识点",title:"HTML5中的download属性",draft:null}},{excerpt:"简介 innerText IE6 就开始支持，那个时候，Firefox 浏览器是不支持这个 API 的，一直到 2016 年 3 月份 Firefox 45+才开始支持。 而 textContent IE9 浏览器才开始支持： 由于存在兼容性，因此在开发 PC 端项目的时候获取元素的文本内容都是下面的语句： 久而久之，就误认为 innerText 和 textContent 作用是一样的。 innerText 和 textContent 的不同 调用对象不同 innerText 只有 HTML…",html:'<h1 id="简介"><a href="#%E7%AE%80%E4%BB%8B" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>简介</h1>\n<p>innerText IE6 就开始支持，那个时候，Firefox 浏览器是不支持这个 API 的，一直到 2016 年 3 月份 Firefox 45+才开始支持。</p>\n<p>\n  <a\n    class="gatsby-resp-image-link"\n    href="/static/2019-12-15-19-12-27-712915a13da25a914564f6da376fa683-87f29.png"\n    style="display: block"\n    target="_blank"\n    rel="noopener"\n  >\n  \n  <span\n    class="gatsby-resp-image-wrapper"\n    style="position: relative; display: block; ; max-width: 602px; margin-left: auto; margin-right: auto;"\n  >\n    <span\n      class="gatsby-resp-image-background-image"\n      style="padding-bottom: 43.52159468438538%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAIAAAC9o5sfAAAACXBIWXMAAA7DAAAOwwHHb6hkAAACLklEQVQozyWO609SAQDF79/TFjBapZRDXipv7KGAVl9orWK5sq2PfXSrtWpSG/NRyCSIutCFy+UtT+Mtl+vlfXWgyMsIMKu5PkS5nZ3t/M7OdoBSLlkubBHFVCUXJjD/Dh7cxEyHB+leA+81tvsN/KiZHah3uNvvVHvNXK+eGfDTCmgHFtqh5+2vi/WdZK0cOyhFibyvtZvs7mG/WoV+De9UM91q+ji1fBx5+Xs/cdKt/2zmBtWPZhboxFVH6Eovo9kvR1rVVKOOf2sWUGIDyegDJWgjB7qxz97tT4HQ05DvyWbOsFnxBormYBGqVeMAhmJEsVDOZ9PR0B4axvWvifU3C8ijMzCDCrFpiIDrljKd1+meWY5PwXBOnYNYVCuHArJAswpIFOxYyYOXvemKPxXWr4nIH8ZIyhccmveqyDXLdclGbMJhmDeKiAUuGd8lG3dOX0IEw1+4/rgREFtk990PHnrmJdaZx955BXLvJqxgWyfZjmsSzw2W/coQzJ1wSf/PpDyXfOATbinDKoaDWuCicZz9nsdbEvKt05zFMdKrC6S3Q+dX6SMO0WWb4FRTPoUiPCcP3Blc+EfsIhrEY2tFAJzQ2iJrc5Dylu22ErwrfjfJXRVy9MKzplEyyKSATDLIoFslAoecb5+hmtiDSDYxKR8ZKscz4E+bOGmXwoTFnjeEyhYY05nTGgdm0EXVhtiyKaFZj6mNsZUAagqiZj8K6mNLupjamTJ8r2b+AgVEVYuG4Gm1AAAAAElFTkSuQmCC\'); background-size: cover; display: block;"\n    >\n      <img\n        class="gatsby-resp-image-image"\n        style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;"\n        alt="2019 12 15 19 12 27"\n        title=""\n        src="/static/2019-12-15-19-12-27-712915a13da25a914564f6da376fa683-87f29.png"\n        srcset="/static/2019-12-15-19-12-27-712915a13da25a914564f6da376fa683-38577.png 200w,\n/static/2019-12-15-19-12-27-712915a13da25a914564f6da376fa683-26124.png 400w,\n/static/2019-12-15-19-12-27-712915a13da25a914564f6da376fa683-87f29.png 602w"\n        sizes="(max-width: 602px) 100vw, 602px"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<p>而 textContent IE9 浏览器才开始支持：</p>\n<p>\n  <a\n    class="gatsby-resp-image-link"\n    href="/static/2019-12-15-19-12-49-f4456f037ba86ad459557fc808f78deb-a484c.png"\n    style="display: block"\n    target="_blank"\n    rel="noopener"\n  >\n  \n  <span\n    class="gatsby-resp-image-wrapper"\n    style="position: relative; display: block; ; max-width: 577px; margin-left: auto; margin-right: auto;"\n  >\n    <span\n      class="gatsby-resp-image-background-image"\n      style="padding-bottom: 45.233968804159446%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAIAAAC9o5sfAAAACXBIWXMAAA7DAAAOwwHHb6hkAAACMElEQVQozwElAtr9AObfztjTxdrTxt3WyNzTw9/Vw9rSwODUxczSstndwPPo1fLo1fPp1vPp1vLq2fLr3PLp2fHn0/Lo1fLo1QDw38Pt063u1rHt1rLr38nq4tDp4M3s4dDl38rm4Mvw59Tx59Tt5NDt5NPw3sHx1q/y4MP17d7y6NXx6NUA8tar8sB58sWF88eH69zA59/P6N/N6+PR6eDP6N7M8ujT8ObS5t7M6OHR7tGk8cB28taq+PPr9OrW9OnVAO3k0tzSxOPZyeff0NfQw+bdzOfbxt3QvOvgzN/azdjTxurj0tjQv97WxezgztvNvefayN3Vw9DJuN3SwQDbq5u7UkrCYljZwrbZ1cvd1Mnn18Lk0rzl18Tb1s/f2tHGwbmLh4iQjIzSw7bkzr7jz7+jnJiFgoScl5QAvcufaZ1Mgqlhk8yJcch2i8+HjtGNc8h7k9KQhMyCfct8kMyMXbBoZLNulNCSecx+idCJg8KFVrBkfr+BAJ7Jli6rRkarVEueT0GuUEmhTk2fUEavUUydTkekT0WqUFGcUUuxVEytVEyaTj2rS0GhSVOhVEq0VVOiVAC7zKd3tHOFsntioF1Xsl9apFlfolxbs2BcoFlbqF1cr19enFparl5Yqlt0o2qGvoF/sXden1tZsl9doFoA9enX9+jY/+zftdioh8qFndGVptSdjcuKpdObm9CUk86OrNahks2Oks6O4eTJ++rc+eraqtWgiMqFpNOaLZt8mUJHhnMAAAAASUVORK5CYII=\'); background-size: cover; display: block;"\n    >\n      <img\n        class="gatsby-resp-image-image"\n        style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;"\n        alt="2019 12 15 19 12 49"\n        title=""\n        src="/static/2019-12-15-19-12-49-f4456f037ba86ad459557fc808f78deb-a484c.png"\n        srcset="/static/2019-12-15-19-12-49-f4456f037ba86ad459557fc808f78deb-64be4.png 200w,\n/static/2019-12-15-19-12-49-f4456f037ba86ad459557fc808f78deb-6870d.png 400w,\n/static/2019-12-15-19-12-49-f4456f037ba86ad459557fc808f78deb-a484c.png 577w"\n        sizes="(max-width: 577px) 100vw, 577px"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<p>由于存在兼容性，因此在开发 PC 端项目的时候获取元素的文本内容都是下面的语句：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="34786984170647585000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`var text = dom.innerText || dom.textContent;`, `34786984170647585000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                data-tooltip="复制"\n              >\n                <svg class="gatsby-code-button-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0V0z"/><path d="M16 1H2v16h2V3h12V1zm-1 4l6 6v12H6V5h9zm-1 7h5.5L14 6.5V12z"/></svg>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">var</span> text <span class="token operator">=</span> dom<span class="token punctuation">.</span>innerText <span class="token operator">||</span> dom<span class="token punctuation">.</span>textContent<span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>久而久之，就误认为 innerText 和 textContent 作用是一样的。</p>\n<h1 id="innertext-和-textcontent-的不同"><a href="#innertext-%E5%92%8C-textcontent-%E7%9A%84%E4%B8%8D%E5%90%8C" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>innerText 和 textContent 的不同</h1>\n<h2 id="调用对象不同"><a href="#%E8%B0%83%E7%94%A8%E5%AF%B9%E8%B1%A1%E4%B8%8D%E5%90%8C" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>调用对象不同</h2>\n<p>innerText 只有 HTML 元素才可以调用，但是 textContent 任意 Node 节点都可以：HTMLElement.innerText 和 Node.textContent。</p>\n<h2 id="值获取规则不同"><a href="#%E5%80%BC%E8%8E%B7%E5%8F%96%E8%A7%84%E5%88%99%E4%B8%8D%E5%90%8C" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>值获取规则不同</h2>\n<h3 id="规则差异之块级元素与换行符"><a href="#%E8%A7%84%E5%88%99%E5%B7%AE%E5%BC%82%E4%B9%8B%E5%9D%97%E7%BA%A7%E5%85%83%E7%B4%A0%E4%B8%8E%E6%8D%A2%E8%A1%8C%E7%AC%A6" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>规则差异之块级元素与换行符</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="56935090715409280000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`<p id=&quot;dom&quot;>一段文字内容<span style=&quot;position:absolute;&quot;>...</span></p>`, `56935090715409280000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                data-tooltip="复制"\n              >\n                <svg class="gatsby-code-button-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0V0z"/><path d="M16 1H2v16h2V3h12V1zm-1 4l6 6v12H6V5h9zm-1 7h5.5L14 6.5V12z"/></svg>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="html"><pre style="counter-reset: linenumber NaN" class="language-html line-numbers"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>dom<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>一段文字内容<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span><span class="token style-attr language-css"><span class="token attr-name"> <span class="token attr-name">style</span></span><span class="token punctuation">="</span><span class="token attr-value"><span class="token property">position</span><span class="token punctuation">:</span>absolute<span class="token punctuation">;</span></span><span class="token punctuation">"</span></span><span class="token punctuation">></span></span>...<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>实时效果如下：</p>\n<p>一段文字内容…</p>\n<p>可以看到设置了 position:absolute 的<code class="language-text">&lt;span&gt;</code>元素里面的点点点…和前面的文字内容是紧密连接在一起的，前后没有任何空格。</p>\n<p>但是，当我们分别获取 id=“dom”的<code class="language-text">&lt;p&gt;</code>元素的 innerText 和 textContent 值的时候，有意思的事情发生了，innerText 的返回值居然在点点点前面出现了一个空格。</p>\n<p>如下截图所示：</p>\n<p>\n  <a\n    class="gatsby-resp-image-link"\n    href="/static/2019-12-15-19-14-52-d030d60bd6948b7084102abb379d2560-acb24.png"\n    style="display: block"\n    target="_blank"\n    rel="noopener"\n  >\n  \n  <span\n    class="gatsby-resp-image-wrapper"\n    style="position: relative; display: block; ; max-width: 399px; margin-left: auto; margin-right: auto;"\n  >\n    <span\n      class="gatsby-resp-image-background-image"\n      style="padding-bottom: 44.3609022556391%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAIAAAC9o5sfAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABIklEQVQoz41Q247CIBT0/3/Jh22y3VfrZWPimigKtXhptbW2cCiwI41ZfTDZyUAPE+YMpwNrbasMUUfmQXpHQxpfi2WMbZp24O7mruvQxBqDwoQDZNfDPui8d0Quz62/43Q6DaCTcefzeb1apUIwtq6q0r9DFHkpXSjzPIfZKd21Sl2vFXi5XKAeDoeyLIlIa30D6vqqlBbCD4ewhUcEM+qmJdxeLn/G4wSM468o+pjP58fjcb/f73Y7KSXnvAgP7mf5S251h0ApM9xDF+yLxWKz2RRFgVTsGAoT1vXNB9urWZlMyulk8j2bJeNkNBp9xvF0OsmyDB7E9vlFXrgnM5qGmck65/+P3nz/201zY2zLueBP2G6hcCFexF7pkaYpY+wX4/L92KjoN1AAAAAASUVORK5CYII=\'); background-size: cover; display: block;"\n    >\n      <img\n        class="gatsby-resp-image-image"\n        style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;"\n        alt="2019 12 15 19 14 52"\n        title=""\n        src="/static/2019-12-15-19-14-52-d030d60bd6948b7084102abb379d2560-acb24.png"\n        srcset="/static/2019-12-15-19-14-52-d030d60bd6948b7084102abb379d2560-ff279.png 200w,\n/static/2019-12-15-19-14-52-d030d60bd6948b7084102abb379d2560-acb24.png 399w"\n        sizes="(max-width: 399px) 100vw, 399px"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<h4 id="差异的原因"><a href="#%E5%B7%AE%E5%BC%82%E7%9A%84%E5%8E%9F%E5%9B%A0" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>差异的原因</h4>\n<p>实际上是 innerText 会保留块级元素的换行特性，以换行符形式呈现。在 HTML 中，如果 white-space 不是 pre 或 pre-wrap 则会表现为空格。也就是下图中的空格实际上是换行符：</p>\n<p>\n  <a\n    class="gatsby-resp-image-link"\n    href="/static/2019-12-15-19-15-46-d030d60bd6948b7084102abb379d2560-acb24.png"\n    style="display: block"\n    target="_blank"\n    rel="noopener"\n  >\n  \n  <span\n    class="gatsby-resp-image-wrapper"\n    style="position: relative; display: block; ; max-width: 399px; margin-left: auto; margin-right: auto;"\n  >\n    <span\n      class="gatsby-resp-image-background-image"\n      style="padding-bottom: 44.3609022556391%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAIAAAC9o5sfAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABIklEQVQoz41Q247CIBT0/3/Jh22y3VfrZWPimigKtXhptbW2cCiwI41ZfTDZyUAPE+YMpwNrbasMUUfmQXpHQxpfi2WMbZp24O7mruvQxBqDwoQDZNfDPui8d0Quz62/43Q6DaCTcefzeb1apUIwtq6q0r9DFHkpXSjzPIfZKd21Sl2vFXi5XKAeDoeyLIlIa30D6vqqlBbCD4ewhUcEM+qmJdxeLn/G4wSM468o+pjP58fjcb/f73Y7KSXnvAgP7mf5S251h0ApM9xDF+yLxWKz2RRFgVTsGAoT1vXNB9urWZlMyulk8j2bJeNkNBp9xvF0OsmyDB7E9vlFXrgnM5qGmck65/+P3nz/201zY2zLueBP2G6hcCFexF7pkaYpY+wX4/L92KjoN1AAAAAASUVORK5CYII=\'); background-size: cover; display: block;"\n    >\n      <img\n        class="gatsby-resp-image-image"\n        style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;"\n        alt="2019 12 15 19 15 46"\n        title=""\n        src="/static/2019-12-15-19-15-46-d030d60bd6948b7084102abb379d2560-acb24.png"\n        srcset="/static/2019-12-15-19-15-46-d030d60bd6948b7084102abb379d2560-ff279.png 200w,\n/static/2019-12-15-19-15-46-d030d60bd6948b7084102abb379d2560-acb24.png 399w"\n        sizes="(max-width: 399px) 100vw, 399px"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<p>例如，我们设置呈现结果的父元素 white-space:pre，则会出现下图所示的效果：</p>\n<p>\n  <a\n    class="gatsby-resp-image-link"\n    href="/static/2019-12-15-19-16-09-7ba098ddd5899f48eb349b85f05022d4-a3cb3.png"\n    style="display: block"\n    target="_blank"\n    rel="noopener"\n  >\n  \n  <span\n    class="gatsby-resp-image-wrapper"\n    style="position: relative; display: block; ; max-width: 336px; margin-left: auto; margin-right: auto;"\n  >\n    <span\n      class="gatsby-resp-image-background-image"\n      style="padding-bottom: 52.976190476190474%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABb0lEQVQoz42RbW+CMBSF/f//xcRNJSEkxBn9wABj5E3xZXNTRCIgRQRKobvAdM4t2Z6QG9qb03Nu2yCEZIRQSosKWpH/BcY4juNGRvI4yTBOYZGmZU2S5HrWT0AJXYTQarVqEJKnuNhuNqZpLpfLxWKhqmpGsmuKO+r9MAwrcV7EaZkd4yyDgjE4R9E5iqI6C/RAUPegkmrGTzEc5PnIcfaGpgyfRUEYPvUHD+1Os9USRHG33zuHw2q9nlVMp1NN077EeV6czilCge+5h/WbjwJ3tzs4jmvbR8c5um7oulkQ5DBeBZh/i52k0KjCDAYhw1BdpyxLJYkKQsFxVJaj8difz29f5OJcUHSKPc+dL0zz5VVuP77zfNBsejzv93qo0zlPJraiWONxKYacd+IARZa1HY1kAwbSdYnjRJYVGUbqdpVeb9bvW7IMd/jbbROIndN/cxXDuzbASlWh6JVriQbry1fu1j83GIYxgVls+wPqMWI43OL0OgAAAABJRU5ErkJggg==\'); background-size: cover; display: block;"\n    >\n      <img\n        class="gatsby-resp-image-image"\n        style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;"\n        alt="2019 12 15 19 16 09"\n        title=""\n        src="/static/2019-12-15-19-16-09-7ba098ddd5899f48eb349b85f05022d4-a3cb3.png"\n        srcset="/static/2019-12-15-19-16-09-7ba098ddd5899f48eb349b85f05022d4-d9b8e.png 200w,\n/static/2019-12-15-19-16-09-7ba098ddd5899f48eb349b85f05022d4-a3cb3.png 336w"\n        sizes="(max-width: 336px) 100vw, 336px"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<p>在本例中，虽然<code class="language-text">&lt;span&gt;</code>元素是内联元素，但由于设置了 position:absolute 使其 display 计算值变成了 block，因此，虽然视觉上没有换行，但 innerText 获取的时候依旧产生了换行，导致空格出现。</p>\n<h3 id="规则差异之隐藏元素的获取与否"><a href="#%E8%A7%84%E5%88%99%E5%B7%AE%E5%BC%82%E4%B9%8B%E9%9A%90%E8%97%8F%E5%85%83%E7%B4%A0%E7%9A%84%E8%8E%B7%E5%8F%96%E4%B8%8E%E5%90%A6" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>规则差异之隐藏元素的获取与否</h3>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="21816301420594917000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`<p id=&quot;dom2&quot;>我后面有一段隐藏文字<span hidden>，就是我啦！</span></p>`, `21816301420594917000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                data-tooltip="复制"\n              >\n                <svg class="gatsby-code-button-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0V0z"/><path d="M16 1H2v16h2V3h12V1zm-1 4l6 6v12H6V5h9zm-1 7h5.5L14 6.5V12z"/></svg>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="html"><pre style="counter-reset: linenumber NaN" class="language-html line-numbers"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>dom2<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>我后面有一段隐藏文字<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">hidden</span><span class="token punctuation">></span></span>，就是我啦！<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>\n  <a\n    class="gatsby-resp-image-link"\n    href="/static/2019-12-15-19-17-21-c6525c2a0f382a1b4efa2de20a5a85e0-1857e.png"\n    style="display: block"\n    target="_blank"\n    rel="noopener"\n  >\n  \n  <span\n    class="gatsby-resp-image-wrapper"\n    style="position: relative; display: block; ; max-width: 448px; margin-left: auto; margin-right: auto;"\n  >\n    <span\n      class="gatsby-resp-image-background-image"\n      style="padding-bottom: 38.839285714285715%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAIAAAB2/0i6AAAACXBIWXMAAA7DAAAOwwHHb6hkAAABF0lEQVQY052Py26DMBBF/f+/kx/IIhsWoSUPAi4YPwgQSGrCw3bjgusmLULprkej0ZVm5mou0Howd8ZxNL8Mf7F7s7op1XUdkErXdV2WpRD9QzRNo7We2819HwgpKWOgF4oQgjFu2jbLMgihvVdKPW2bpjHn809dLpIxRikQ6natOaEkRpHv+67rhmHIObd2VuR5XlWVHwRssbj6vimKMctMWcrVikEIhLydqxITTAlBcRwEgX3kcqcoChukbdv8dOLr9QeEGiEZhkOSCNdlSQK6XhKSvLx6293O22yWy6XjOJRShNDhcEjT1Fp4nveG0DvnCOPtfh8jxOs6PR7B52D+gZTfqUEIrWk8EUXRXE9Mo0e36exTX3riuySRUlyhAAAAAElFTkSuQmCC\'); background-size: cover; display: block;"\n    >\n      <img\n        class="gatsby-resp-image-image"\n        style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;"\n        alt="2019 12 15 19 17 21"\n        title=""\n        src="/static/2019-12-15-19-17-21-c6525c2a0f382a1b4efa2de20a5a85e0-1857e.png"\n        srcset="/static/2019-12-15-19-17-21-c6525c2a0f382a1b4efa2de20a5a85e0-15195.png 200w,\n/static/2019-12-15-19-17-21-c6525c2a0f382a1b4efa2de20a5a85e0-82e6d.png 400w,\n/static/2019-12-15-19-17-21-c6525c2a0f382a1b4efa2de20a5a85e0-1857e.png 448w"\n        sizes="(max-width: 448px) 100vw, 448px"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<p>可以看到，display:none 元素是无法使用 innerText 获取的，但是 textContent 却可以，无论元素隐藏与否。</p>\n<h3 id="规则差异之性能与回流"><a href="#%E8%A7%84%E5%88%99%E5%B7%AE%E5%BC%82%E4%B9%8B%E6%80%A7%E8%83%BD%E4%B8%8E%E5%9B%9E%E6%B5%81" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>规则差异之性能与回流</h3>\n<p>此外，由于 innerText 属性值的获取会考虑 CSS 样式，因此读取 innerText 的值将触发回流以确保计算出的样式是最新的，而回流在计算上很昂贵，会降低性能，因此应尽可能避免回流。而 textContent 只是单纯读取文本内容，因此性能更高。</p>\n<h3 id="ie-浏览器不符合上面规则"><a href="#ie-%E6%B5%8F%E8%A7%88%E5%99%A8%E4%B8%8D%E7%AC%A6%E5%90%88%E4%B8%8A%E9%9D%A2%E8%A7%84%E5%88%99" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>IE 浏览器不符合上面规则</h3>\n<p>但是在 IE 浏览器下，innerText 的表现和规范是不符的，最终表现为 textContent 属性一样的效果，也就是没有空格，也不会不显示隐藏元素，例如下面 IE11 下的效果截图：</p>\n<p>\n  <a\n    class="gatsby-resp-image-link"\n    href="/static/2019-12-15-19-19-22-573fe8c5406b0174c2679e9f75079781-0208c.png"\n    style="display: block"\n    target="_blank"\n    rel="noopener"\n  >\n  \n  <span\n    class="gatsby-resp-image-wrapper"\n    style="position: relative; display: block; ; max-width: 493px; margin-left: auto; margin-right: auto;"\n  >\n    <span\n      class="gatsby-resp-image-background-image"\n      style="padding-bottom: 74.2393509127789%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAIAAABr+ngCAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAB6UlEQVQoz4VS23KbMBT0//9MHtrHPNZPcVMXgwsECgaBQFgCxMXc6WIyiZ2m0x2NZjmw56xWbPKyI0l1oqnPCsrrz5e40Kylsl/WSvKeJnJT1l3E6+97zT7RvBqEbHjeiNslW87L7Lef63aumbnl5aqZ2r5D4s00jl2H1Xdd17btMAzjFdMKkHkepGwUpX18bB8emv2+//ol234LGNvg/TDOsijO53NEaVEU8zxDNd9immQc8yAQlIowBCk5T7MM4qntBsYYIb7rnnRdPxwOhARCiCzLOOdo2vf9faulNd5uQJtu8H1i6L80Tft5heM4URTBhZQSH+FE0w1wqFfxdfLoOg40qqru9z+2261yOECMmXEcgyCLzycv4n7kXERxFDOGT4MAWTCMba64XC5I8Z/ibpjGDwn9hVXw5vz9zAiMBAHOiXgIISAw/N9G77YZS+A2jpnnnWzbPp85bNd1XVUV0qquQObYy7JE5S5tTH4xTVXTnp+fd09PuDPA8zwYQeBoF4Yh2mF3XRcViNM0fU0bF2sYhmW9GIauKIplWUgOUcM/5oPj2pEc9iRJULm7Kt/3j8ejbhiaqu52O9M0MZNSChnmwAUawTAeUV//wmUySkFI0U/wBeiNKshSEWIlbxUYWQnuEhn9AVlFSfB2gZz+AAAAAElFTkSuQmCC\'); background-size: cover; display: block;"\n    >\n      <img\n        class="gatsby-resp-image-image"\n        style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;"\n        alt="2019 12 15 19 19 22"\n        title=""\n        src="/static/2019-12-15-19-19-22-573fe8c5406b0174c2679e9f75079781-0208c.png"\n        srcset="/static/2019-12-15-19-19-22-573fe8c5406b0174c2679e9f75079781-1777c.png 200w,\n/static/2019-12-15-19-19-22-573fe8c5406b0174c2679e9f75079781-1db89.png 400w,\n/static/2019-12-15-19-19-22-573fe8c5406b0174c2679e9f75079781-0208c.png 493w"\n        sizes="(max-width: 493px) 100vw, 493px"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<p>另外，与 textContent 不同，在 Internet Explorer（版本 11 及以下）中更改 innerText 将从元素中移除子节点，并永久销毁所有子文本节点。不可能再将节点插入任何其他元素或同一元素中。</p>\n<h1 id="结论"><a href="#%E7%BB%93%E8%AE%BA" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>结论</h1>\n<p>innerText 由于存在诸多特别的特性、以及兼容性差异，以及性能方面问题，以及实际开发的需求的考量，不推荐使用，推荐使用 textContent 获取文本内容。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="50425670908803610000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`var text = dom.textContent;`, `50425670908803610000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                data-tooltip="复制"\n              >\n                <svg class="gatsby-code-button-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0V0z"/><path d="M16 1H2v16h2V3h12V1zm-1 4l6 6v12H6V5h9zm-1 7h5.5L14 6.5V12z"/></svg>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">var</span> text <span class="token operator">=</span> dom<span class="token punctuation">.</span>textContent<span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>如果你的项目还需要兼容 IE8 浏览器，则使用下面的代码：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="24518287867318268000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`var text = dom.textContent || dom.innerText;`, `24518287867318268000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                data-tooltip="复制"\n              >\n                <svg class="gatsby-code-button-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0V0z"/><path d="M16 1H2v16h2V3h12V1zm-1 4l6 6v12H6V5h9zm-1 7h5.5L14 6.5V12z"/></svg>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">var</span> text <span class="token operator">=</span> dom<span class="token punctuation">.</span>textContent <span class="token operator">||</span> dom<span class="token punctuation">.</span>innerText<span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>另外，如果你要在一个 DOM 元素中改变文字内容，推荐使用 textContent，而不是 innerHTML，性能会更高一点。</p>',id:"/github/workspace/blog/JS DOM innerText和textContent的区别/index.md absPath of file >>> MarkdownRemark",timeToRead:4,frontmatter:{date:"2019-12-15 19:11:45",path:"/js-dom-innertext-textcontent/",tags:"前端, JS, JS知识点",title:"JS DOM innerText和textContent的区别",draft:null}},{excerpt:"简介 document.readyState 是一个只读属性，可以返回当前文档的准备状态。 语法 其中 state 值包含下面三个值： loading 表示文档正在加载中。 interactive 表示文档已完成加载，文档已被解析，但图像、样式表和框架等子资源仍在加载。 complete 表示文档和所有子资源已完成加载。如果状态变成这个，表明 load 事件即将触发。 DOM 事件绑定没必要等 domready 对于 web 页面开发，JavaScript 最主要的功能之一就是页面上 DOM…",html:'<h1 id="简介"><a href="#%E7%AE%80%E4%BB%8B" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>简介</h1>\n<p>document.readyState 是一个只读属性，可以返回当前文档的准备状态。</p>\n<p>语法</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="97420671841095800000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`var state = document.readyState;`, `97420671841095800000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                data-tooltip="复制"\n              >\n                <svg class="gatsby-code-button-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0V0z"/><path d="M16 1H2v16h2V3h12V1zm-1 4l6 6v12H6V5h9zm-1 7h5.5L14 6.5V12z"/></svg>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">var</span> state <span class="token operator">=</span> document<span class="token punctuation">.</span>readyState<span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>其中 state 值包含下面三个值：</p>\n<ul>\n<li>loading<br>\n表示文档正在加载中。</li>\n<li>interactive<br>\n表示文档已完成加载，文档已被解析，但图像、样式表和框架等子资源仍在加载。</li>\n<li>complete<br>\n表示文档和所有子资源已完成加载。如果状态变成这个，表明 load 事件即将触发。</li>\n</ul>\n<h1 id="dom-事件绑定没必要等-domready"><a href="#dom-%E4%BA%8B%E4%BB%B6%E7%BB%91%E5%AE%9A%E6%B2%A1%E5%BF%85%E8%A6%81%E7%AD%89-domready" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>DOM 事件绑定没必要等 domready</h1>\n<p>对于 web 页面开发，JavaScript 最主要的功能之一就是页面上 DOM 元素的交互实现，如果 DOM 元素还没有加载也没有被解析，自然这些 DOM 操作难以为继。于是，JS 初始化的时机就变得很重要。</p>\n<p>实际上，如果我们的 JS 文件以及 script 代码都放在页面的底部，我们不用考虑 JS 初始化时机，因为 JS 放在底部，等到要执行的时候，上面 DOM 都已经解析好了。也就是什么 readyState，什么 DOMContentLoaded 都不需要考虑。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="69275475769293185000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`\\$(document).ready(function() {});\n// \\$(document).ready这一戳东西删掉，只要你的JS代码是在页面底部的，这些都完全不需要\n(function() {})();`, `69275475769293185000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                data-tooltip="复制"\n              >\n                <svg class="gatsby-code-button-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0V0z"/><path d="M16 1H2v16h2V3h12V1zm-1 4l6 6v12H6V5h9zm-1 7h5.5L14 6.5V12z"/></svg>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token function">$</span><span class="token punctuation">(</span>document<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ready</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token comment">// $(document).ready这一戳东西删掉，只要你的JS代码是在页面底部的，这些都完全不需要</span>\n<span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<h1 id="domcontentloaded-事件"><a href="#domcontentloaded-%E4%BA%8B%E4%BB%B6" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>DOMContentLoaded 事件</h1>\n<p>document.readyState 越来越少用到的另外一个原因，就是半路上杀出一个程咬金——‘DOMContentLoaded’事件。</p>\n<p>DOMContentLoaded 事件是 DOM Level 3 新增的一个事件类型，IE9+浏览器支持，表示 DOM 节点内容加载完毕。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="61029888858062670000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`document.addEventListener(\'DOMContentLoaded\', function() {});\n\nwindow.addEventListener(\'DOMContentLoaded\', function() {});`, `61029888858062670000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                data-tooltip="复制"\n              >\n                <svg class="gatsby-code-button-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0V0z"/><path d="M16 1H2v16h2V3h12V1zm-1 4l6 6v12H6V5h9zm-1 7h5.5L14 6.5V12z"/></svg>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js">document<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">\'DOMContentLoaded\'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\nwindow<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">\'DOMContentLoaded\'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>DOMContentLoaded 设计初衷就是为了方便 JS 代码的初始化，要比记得记不住的 interactive 状态容易理解，也容易使用的多。</p>\n<p>因此，如果为了提防我们的 JavaScript 代码不小心跑到了页面的顶部，需要确保在 DOM 加载完毕之后执行，推荐使用下面代码：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="923789779350015000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`window.addEventListener(\'DOMContentLoaded\', function() {});`, `923789779350015000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                data-tooltip="复制"\n              >\n                <svg class="gatsby-code-button-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0V0z"/><path d="M16 1H2v16h2V3h12V1zm-1 4l6 6v12H6V5h9zm-1 7h5.5L14 6.5V12z"/></svg>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js">window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">\'DOMContentLoaded\'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>由于<code class="language-text">&lt;script&gt;</code>元素本身也是 DOM 元素，因此，只要脚本不是异步加载的，无论放在页面什么位置，DOMContentLoaded 事件一定会触发。</p>\n<p>假设有一个名为 insert.js 的文件，里面的 JS 代码如下：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="59996996230781100000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`console.log(\'zxx被加载了~\' + document.readyState);\nwindow.addEventListener(\'DOMContentLoaded\', function() {\n  console.log(\'CSS选择器这本书很赞哦！\' + document.readyState);\n});`, `59996996230781100000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                data-tooltip="复制"\n              >\n                <svg class="gatsby-code-button-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0V0z"/><path d="M16 1H2v16h2V3h12V1zm-1 4l6 6v12H6V5h9zm-1 7h5.5L14 6.5V12z"/></svg>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">\'zxx被加载了~\'</span> <span class="token operator">+</span> document<span class="token punctuation">.</span>readyState<span class="token punctuation">)</span><span class="token punctuation">;</span>\nwindow<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">\'DOMContentLoaded\'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">\'CSS选择器这本书很赞哦！\'</span> <span class="token operator">+</span> document<span class="token punctuation">.</span>readyState<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>然后还有一个名为 load-test.html 的页面，里面代码这样：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="75504406088455630000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`<body>\n  <script src=&quot;./insert.js&quot;></script>\n</body>`, `75504406088455630000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                data-tooltip="复制"\n              >\n                <svg class="gatsby-code-button-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0V0z"/><path d="M16 1H2v16h2V3h12V1zm-1 4l6 6v12H6V5h9zm-1 7h5.5L14 6.5V12z"/></svg>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="html"><pre style="counter-reset: linenumber NaN" class="language-html line-numbers"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>./insert.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>结果页面进入，控制台出现了下图所示的结果：</p>\n<p>\n  <a\n    class="gatsby-resp-image-link"\n    href="/static/2019-12-15-19-06-23-0eefa5efdc36f511ae56222efc4e6954-4493b.png"\n    style="display: block"\n    target="_blank"\n    rel="noopener"\n  >\n  \n  <span\n    class="gatsby-resp-image-wrapper"\n    style="position: relative; display: block; ; max-width: 320px; margin-left: auto; margin-right: auto;"\n  >\n    <span\n      class="gatsby-resp-image-background-image"\n      style="padding-bottom: 46.5625%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAIAAAC9o5sfAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABSUlEQVQoz3WR6W6DMBCE8/7PFYkcKoQoB4FcJTLYEMBcAmwDHUzVP1FHCC3WfrszZjEMQ9u2hBBK6f1+T9P0/X6HYUiCIGKURNz22O5CvhziU84Yfb1ejDG0ua67ANx1neM4APAuigJT4jhumqaua15UcVYmvA6jlMUALtC87HQ6Lfq+F0JUVQXM933w1+s1y7JUqyhyKTo8SgopRaOF/rIsp82AlVLYD9jzPMMwLMuC88fjgSXoQLeUEu6EFvrHccTJ7XabYFRK9diDb9u2AZ/PZ+Q3TXO5XAZBkCRJFEWYiLTwCBhTfmEhZNWqvsf64c/I7CXjHCRSUH1JuA6MyPMcs2BzgtE3fgg+jdVqp4U+ODocDsfjcb/fIw6uZsqMSM/n8/tDyGxpbTYbMOv1GinAbLdbFDifYJjk/6jUmn8E3qjnotIFrP0AZMTt3j2EvYsAAAAASUVORK5CYII=\'); background-size: cover; display: block;"\n    >\n      <img\n        class="gatsby-resp-image-image"\n        style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;"\n        alt="2019 12 15 19 06 23"\n        title=""\n        src="/static/2019-12-15-19-06-23-0eefa5efdc36f511ae56222efc4e6954-4493b.png"\n        srcset="/static/2019-12-15-19-06-23-0eefa5efdc36f511ae56222efc4e6954-102e5.png 200w,\n/static/2019-12-15-19-06-23-0eefa5efdc36f511ae56222efc4e6954-4493b.png 320w"\n        sizes="(max-width: 320px) 100vw, 320px"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<p>可以看到，“DOMContentLoaded”事件绑定时候文档状态是’loading’，执行的时候文档状态是可交互的’interactive’。</p>\n<p>配合其他测试（这里不展示），我们可以得出一个网页文档几个加载状态变化和事件触发顺序是这样子的：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="50961126592320815000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`document.readyState = \'loading\'\n↓\ndocument.readyState变成\'interactive\'\n↓\n\'DOMContentLoaded\'事件执行\n↓\ndocument.readyState变成\'complete\'\n↓\n\'load\'事件执行`, `50961126592320815000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                data-tooltip="复制"\n              >\n                <svg class="gatsby-code-button-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0V0z"/><path d="M16 1H2v16h2V3h12V1zm-1 4l6 6v12H6V5h9zm-1 7h5.5L14 6.5V12z"/></svg>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="bash"><pre style="counter-reset: linenumber NaN" class="language-bash line-numbers"><code class="language-bash">document.readyState <span class="token operator">=</span> <span class="token string">\'loading\'</span>\n↓\ndocument.readyState变成<span class="token string">\'interactive\'</span>\n↓\n<span class="token string">\'DOMContentLoaded\'</span>事件执行\n↓\ndocument.readyState变成<span class="token string">\'complete\'</span>\n↓\n<span class="token string">\'load\'</span>事件执行</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>以及可以推测出一个结论：</p>\n<p><strong>DOMContentLoaded 事件必须在文档状态为 loading 时候绑定才有效。</strong></p>\n<p>正是由于上面推论，才使得 document.readyState 有了应用场景。</p>\n<h1 id="应用"><a href="#%E5%BA%94%E7%94%A8" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>应用</h1>\n<p>由于 DOMContentLoaded 事件绑定后可能并不会执行，于是出现了需要用到 document.readyState 的场景。</p>\n<p>什么时候 DOMContentLoaded 事件不会执行呢？</p>\n<p>那就是相关脚本是在页面 DOM 加载完毕后执行的场景下。</p>\n<p>假设有一个名为 insert.js 的文件，里面的 JS 代码如下：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="88670645469942140000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`console.log(\'zxx被加载了~\' + document.readyState);\nwindow.addEventListener(\'DOMContentLoaded\', function() {\n  console.log(\'CSS选择器这本书很赞哦！\');\n});`, `88670645469942140000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                data-tooltip="复制"\n              >\n                <svg class="gatsby-code-button-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0V0z"/><path d="M16 1H2v16h2V3h12V1zm-1 4l6 6v12H6V5h9zm-1 7h5.5L14 6.5V12z"/></svg>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">\'zxx被加载了~\'</span> <span class="token operator">+</span> document<span class="token punctuation">.</span>readyState<span class="token punctuation">)</span><span class="token punctuation">;</span>\nwindow<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">\'DOMContentLoaded\'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">\'CSS选择器这本书很赞哦！\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>然后还有一个名为 load-test.html 的页面，里面代码这样：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="72462929919641895000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`<body>\n  <script>\n    var eleScript = document.createElement(\'script\');\n    eleScript.src = \'./insert.js\';\n    document.head.appendChild(eleScript);\n  </script>\n</body>`, `72462929919641895000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                data-tooltip="复制"\n              >\n                <svg class="gatsby-code-button-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0V0z"/><path d="M16 1H2v16h2V3h12V1zm-1 4l6 6v12H6V5h9zm-1 7h5.5L14 6.5V12z"/></svg>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="html"><pre style="counter-reset: linenumber NaN" class="language-html line-numbers"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">\n    <span class="token keyword">var</span> eleScript <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">\'script\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    eleScript<span class="token punctuation">.</span>src <span class="token operator">=</span> <span class="token string">\'./insert.js\'</span><span class="token punctuation">;</span>\n    document<span class="token punctuation">.</span>head<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>eleScript<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>结果页面进入，控制台只有’zxx 被加载了~‘的文案，并没有 DOMContentLoaded 事件中的 console.log 输出，如下图所示：</p>\n<p>\n  <a\n    class="gatsby-resp-image-link"\n    href="/static/2019-12-15-19-09-13-44cbe95141bdf16813be7c2440147caf-bd67d.png"\n    style="display: block"\n    target="_blank"\n    rel="noopener"\n  >\n  \n  <span\n    class="gatsby-resp-image-wrapper"\n    style="position: relative; display: block; ; max-width: 250px; margin-left: auto; margin-right: auto;"\n  >\n    <span\n      class="gatsby-resp-image-background-image"\n      style="padding-bottom: 57.599999999999994%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAIAAADtbgqsAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABXElEQVQoz5VSa4+CMBDs//9XF01MTAxGkZdygOCDd6Gl8tQbaEzuzH3QSWjZzcxud1rSNE37RDMBP8Mw9H2Ptes6mUPU9UgObdtJDgiEUqqqapqmWH3fZ4zleX44HDzPc103CALOWEmzk+8Fvuu5dhJd6/pmmqbjOKMYW5Iktm2HYVgUBTJQotDxeDwFQZwWazubrb2Z4n6tvldWElNhmoZhmiSKIpBkCQjKskQGYfUELcowY3EuElolVDh+WDCua5qu6+R8Pm82myzLdrsd9BjGmyCVfMJNcFHxijPOyii8iqpSFEXTNCKEgAFgYOz9fo96hmGgFppjlvwJZMCRvsJIDAhfCPx8PB5xHKPtYrGYz+fL5RJU6YI8xeVywUQoB+b9fpd8dCJV3VIxxuP3Bv6Ip2udchN+k17wj1ge+31IMYYaxbgb/gnwiuq6xu1alkVQYLvdqh8CEjynH+3XnM2FRsFyAAAAAElFTkSuQmCC\'); background-size: cover; display: block;"\n    >\n      <img\n        class="gatsby-resp-image-image"\n        style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #fafafa;"\n        alt="2019 12 15 19 09 13"\n        title=""\n        src="/static/2019-12-15-19-09-13-44cbe95141bdf16813be7c2440147caf-bd67d.png"\n        srcset="/static/2019-12-15-19-09-13-44cbe95141bdf16813be7c2440147caf-30978.png 200w,\n/static/2019-12-15-19-09-13-44cbe95141bdf16813be7c2440147caf-bd67d.png 250w"\n        sizes="(max-width: 250px) 100vw, 250px"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<p>因为 DOMContentLoaded 事件绑定的时候，页面的准备状态已经是’interactive’而不是’loading’了。</p>\n<p>如果 insert.js 是一个公用组件，尤其以后会开源的那种，那势必要考虑到各种加载场景，页面的头部，页面底部，或者异步动态加载，此时，单纯靠 DOMContentLoaded 事件只能覆盖前两种情况，异步动态加载无能为力。</p>\n<p>此时，一直认为没什么锤子用的 document.readyState 倒是排上了用场，假设组件的初始方法名为 init，则好的实现方法是这样的：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="78350853274713650000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`if (document.readyState != \'loading\') {\n  init();\n} else {\n  window.addEventListener(\'DOMContentLoaded\', function() {\n    init();\n  });\n}`, `78350853274713650000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                data-tooltip="复制"\n              >\n                <svg class="gatsby-code-button-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0V0z"/><path d="M16 1H2v16h2V3h12V1zm-1 4l6 6v12H6V5h9zm-1 7h5.5L14 6.5V12z"/></svg>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">if</span> <span class="token punctuation">(</span>document<span class="token punctuation">.</span>readyState <span class="token operator">!=</span> <span class="token string">\'loading\'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>\n  window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">\'DOMContentLoaded\'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>这是当下实际开发中，唯一需要使用 document.readyState 的场景，在开源或者大规模使用的框架或组件中精准初始化使用。</p>',
id:"/github/workspace/blog/document.readyState的作用/index.md absPath of file >>> MarkdownRemark",timeToRead:3,frontmatter:{date:"2019-12-15 18:59:10",path:"/document-readystate/",tags:"前端, JS, JS知识点",title:"document.readyState的作用",draft:null}},{excerpt:"HTMLUnknownElement 元素 在网页中，随便写一个标签，例如： 这个 就是一个 HTMLUnknownElement 元素。 在 HTML 规范中，HTMLUnknownElement 元素是一个被认可的合法的元素，CSS 可以无障碍使用，例如： 则实时效果如下（用户名大写）： ZHANGXINXU HTMLUnknownElement 继承 HTMLElement 中的方法，因此，基本上，常用的 HTML 方法都是可以畅快使用的，例如，文字变红色，可以直接： 不同点 在 HTML…",html:'<h1 id="htmlunknownelement-元素"><a href="#htmlunknownelement-%E5%85%83%E7%B4%A0" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>HTMLUnknownElement 元素</h1>\n<p>在网页中，随便写一个标签，例如：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="5872033573477498000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`<username>zhangxinxu</username>`, `5872033573477498000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                data-tooltip="复制"\n              >\n                <svg class="gatsby-code-button-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0V0z"/><path d="M16 1H2v16h2V3h12V1zm-1 4l6 6v12H6V5h9zm-1 7h5.5L14 6.5V12z"/></svg>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="html"><pre style="counter-reset: linenumber NaN" class="language-html line-numbers"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>username</span><span class="token punctuation">></span></span>zhangxinxu<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>username</span><span class="token punctuation">></span></span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>这个<code class="language-text">&lt;username&gt;</code>就是一个 HTMLUnknownElement 元素。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="60524772126252890000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`document.querySelector(\'username\') instanceof HTMLUnknownElement; // 返回值是true`, `60524772126252890000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                data-tooltip="复制"\n              >\n                <svg class="gatsby-code-button-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0V0z"/><path d="M16 1H2v16h2V3h12V1zm-1 4l6 6v12H6V5h9zm-1 7h5.5L14 6.5V12z"/></svg>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js">document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">\'username\'</span><span class="token punctuation">)</span> <span class="token keyword">instanceof</span> <span class="token class-name">HTMLUnknownElement</span><span class="token punctuation">;</span> <span class="token comment">// 返回值是true</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>在 HTML 规范中，HTMLUnknownElement 元素是一个被认可的合法的元素，CSS 可以无障碍使用，例如：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="52572858729338300000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`username {\n  text-transform: uppercase;\n}`, `52572858729338300000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                data-tooltip="复制"\n              >\n                <svg class="gatsby-code-button-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0V0z"/><path d="M16 1H2v16h2V3h12V1zm-1 4l6 6v12H6V5h9zm-1 7h5.5L14 6.5V12z"/></svg>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="css"><pre style="counter-reset: linenumber NaN" class="language-css line-numbers"><code class="language-css"><span class="token selector">username</span> <span class="token punctuation">{</span>\n  <span class="token property">text-transform</span><span class="token punctuation">:</span> uppercase<span class="token punctuation">;</span>\n<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>则实时效果如下（用户名大写）：</p>\n<p>ZHANGXINXU</p>\n<p>HTMLUnknownElement 继承 HTMLElement 中的方法，因此，基本上，常用的 HTML 方法都是可以畅快使用的，例如，文字变红色，可以直接：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="24753792306851950000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`document.querySelector(\'username\').style.color = \'red\';`, `24753792306851950000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                data-tooltip="复制"\n              >\n                <svg class="gatsby-code-button-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0V0z"/><path d="M16 1H2v16h2V3h12V1zm-1 4l6 6v12H6V5h9zm-1 7h5.5L14 6.5V12z"/></svg>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js">document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">\'username\'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>style<span class="token punctuation">.</span>color <span class="token operator">=</span> <span class="token string">\'red\'</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<h2 id="不同点"><a href="#%E4%B8%8D%E5%90%8C%E7%82%B9" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>不同点</h2>\n<p>在 HTML 世界中，HTMLUnknownElement 和 HTMLDivElement，HTMLSpanElement 等等都是平级的，平起平坐，都是 HTMLElement 的子集。那其中有没有什么不一样的地方呢？</p>\n<p>区别在于，规范中的一部分 HTML 元素自己带有一些特殊的属性或者方法，例如，表单元素 HTMLFormElement 元素有 reset()方法，novalidate 属性。然而，HTMLUnknownElement 自己是没有携带任何属性和方法。</p>\n<p>这使其是一件好事，我们就可以为 HTMLUnknownElement 扩展非常私有的方法，而不用担心会影响其他元素。例如来说，默认所有 HTMLUnknownElement 元素的 display 计算值都是 inline，我们可以扩展了 block()方法使其块状化。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="39619026351150600000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`HTMLUnknownElement.prototype.block = function() {\n  this.style.display = \'block\';\n};`, `39619026351150600000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                data-tooltip="复制"\n              >\n                <svg class="gatsby-code-button-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0V0z"/><path d="M16 1H2v16h2V3h12V1zm-1 4l6 6v12H6V5h9zm-1 7h5.5L14 6.5V12z"/></svg>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token class-name">HTMLUnknownElement</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">block</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">this</span><span class="token punctuation">.</span>style<span class="token punctuation">.</span>display <span class="token operator">=</span> <span class="token string">\'block\'</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>\n<p>此时执行 document.querySelector(‘username’).block()就可以让<code class="language-text">&lt;username&gt;</code>元素块状化了。</p>\n<p>基于原型扩展的方法，还不算太智能，要是可以针对不同标签类型进行扩展就更好了，以下方法就可以做到</p>\n<h1 id="htmlunknownelement-与自定义元素（custom-elements）"><a href="#htmlunknownelement-%E4%B8%8E%E8%87%AA%E5%AE%9A%E4%B9%89%E5%85%83%E7%B4%A0%EF%BC%88custom-elements%EF%BC%89" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>HTMLUnknownElement 与自定义元素（Custom Elements）</h1>\n<p>W3 规范中，对自定义元素的定义是中间必须要有短横线（就是键盘上的减号）连接，并且浏览器也是这么认为的，例如：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="29241229490532760000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`document.createElement(\'username\') instanceof HTMLUnknownElement; // 返回值是true\ndocument.createElement(\'user-name\') instanceof HTMLUnknownElement; // 返回值是false`, `29241229490532760000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                data-tooltip="复制"\n              >\n                <svg class="gatsby-code-button-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0V0z"/><path d="M16 1H2v16h2V3h12V1zm-1 4l6 6v12H6V5h9zm-1 7h5.5L14 6.5V12z"/></svg>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js">document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">\'username\'</span><span class="token punctuation">)</span> <span class="token keyword">instanceof</span> <span class="token class-name">HTMLUnknownElement</span><span class="token punctuation">;</span> <span class="token comment">// 返回值是true</span>\ndocument<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">\'user-name\'</span><span class="token punctuation">)</span> <span class="token keyword">instanceof</span> <span class="token class-name">HTMLUnknownElement</span><span class="token punctuation">;</span> <span class="token comment">// 返回值是false</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>\n<p>从这一点看，HTMLUnknownElement 一定不是自定义元素，换句通俗的话解释就是“自定义元素不等于随便定义元素”。</p>\n<h1 id="自定义元素（custom-elements）"><a href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E5%85%83%E7%B4%A0%EF%BC%88custom-elements%EF%BC%89" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>自定义元素（Custom Elements）</h1>\n<h2 id="es6-下的继承与自定义-html-元素类型"><a href="#es6-%E4%B8%8B%E7%9A%84%E7%BB%A7%E6%89%BF%E4%B8%8E%E8%87%AA%E5%AE%9A%E4%B9%89-html-%E5%85%83%E7%B4%A0%E7%B1%BB%E5%9E%8B" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>ES6 下的继承与自定义 HTML 元素类型</h2>\n<p>对于自定义元素，规范提供了一套各种 HTML 特性可继承可扩展的机制，通常使用套路如下：</p>\n<ol>\n<li>ES6 class 继承；</li>\n<li>customElements 定义元素；</li>\n</ol>\n<p>先说说目前支持相对较好的匿名自定义元素（Autonomous custom elements），也就是继承自 HTMElement 的用法。</p>\n<p>例如，我们实现一个基于 rows 属性多行打点效果的小组件。</p>\n<p>注意，下面的演示代码基本上可以作为各类自定义元素（甚至 Web Components）使用的模板，很有用，例如，对于学习类似 Vue 的实时刷新很有帮助，对于学习 Shadow DOM 和 Web Components 也是非常好的案例。以后要实现类似功能，代码拷贝过去，修改修改即可！</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="30662043845078467000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`class HTMLEllElement extends HTMLElement {\n  // 指定观察的属性，这样attributeChangedCallback才会起作用\n  static get observedAttributes() {\n    return [\'rows\'];\n  }\n\n  constructor() {\n    // constructor中首先第一件事情就是调用 super\n    // super指代了整个prototype或者__proto__指向的对象\n    // 这一步免不了的\n    super();\n    // 创建shadow元素，实际上，从本例要实现的效果讲，\n    // 直接元素上设置也可以，就是HTML丑了点，CSS要放在外部\n    // 且目前火狐并不支持shadow dom可以不用，\n    // 但一切为了学习，还是展现下现代web组件的实现方式\n    var shadow = this.attachShadow({\n      // open外部可访问（通过element.shadowRoot），closed则不能\n      mode: \'open\'\n    });\n    // 文本内容移动到shadow dom元素中\n    var div = document.createElement(\'div\');\n    div.innerHTML = this.innerHTML;\n    this.innerHTML = \'\';\n    var style = document.createElement(\'style\');\n    shadow.appendChild(style);\n    shadow.appendChild(div);\n  }\n\n  // 下面4个方法为常用生命周期\n  connectedCallback() {\n    console.log(\'自定义元素加入页面\');\n    // 执行渲染更新\n    this._updateRendering();\n  }\n\n  disconnectedCallback() {\n    // 本例子该生命周期未使用，占位示意\n    console.log(\'自定义元素从页面移除\');\n  }\n\n  adoptedCallback() {\n    // 本例子该生命周期未使用，占位示意\n    console.log(\'自定义元素转移到新页面\');\n  }\n\n  attributeChangedCallback(name, oldValue, newValue) {\n    console.log(\'自定义元素属性发生变化\');\n    this._rows = newValue;\n    // 执行渲染更新\n    this._updateRendering();\n  }\n\n  // 设置直接get/set rows属性的方法\n  get rows() {\n    return this._rows;\n  }\n\n  set rows(v) {\n    this.setAttribute(\'rows\', v);\n  }\n\n  _updateRendering() {\n    // 根据变化的属性，改变组件的UI\n    var shadow = this.shadowRoot;\n    var childNodes = shadow.childNodes;\n    var rows = this._rows;\n    for (var i = 0; i < childNodes.length; i++) {\n      if (childNodes[i].nodeName === \'STYLE\') {\n        childNodes[i].textContent = \\`div {\n          display: -webkit-box;\n          -webkit-line-clamp: \\${rows};\n          -webkit-box-orient: vertical;\n          overflow: hidden;\n        }\\`;\n      }\n    }\n  }\n}\n// 定义x-ell标签元素为多行打点元素\ncustomElements.define(\'x-ell\', HTMLEllElement);`, `30662043845078467000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                data-tooltip="复制"\n              >\n                <svg class="gatsby-code-button-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0V0z"/><path d="M16 1H2v16h2V3h12V1zm-1 4l6 6v12H6V5h9zm-1 7h5.5L14 6.5V12z"/></svg>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">class</span> <span class="token class-name">HTMLEllElement</span> <span class="token keyword">extends</span> <span class="token class-name">HTMLElement</span> <span class="token punctuation">{</span>\n  <span class="token comment">// 指定观察的属性，这样attributeChangedCallback才会起作用</span>\n  <span class="token keyword">static</span> <span class="token keyword">get</span> <span class="token function">observedAttributes</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token string">\'rows\'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n\n  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token comment">// constructor中首先第一件事情就是调用 super</span>\n    <span class="token comment">// super指代了整个prototype或者__proto__指向的对象</span>\n    <span class="token comment">// 这一步免不了的</span>\n    <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token comment">// 创建shadow元素，实际上，从本例要实现的效果讲，</span>\n    <span class="token comment">// 直接元素上设置也可以，就是HTML丑了点，CSS要放在外部</span>\n    <span class="token comment">// 且目前火狐并不支持shadow dom可以不用，</span>\n    <span class="token comment">// 但一切为了学习，还是展现下现代web组件的实现方式</span>\n    <span class="token keyword">var</span> shadow <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">attachShadow</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n      <span class="token comment">// open外部可访问（通过element.shadowRoot），closed则不能</span>\n      mode<span class="token punctuation">:</span> <span class="token string">\'open\'</span>\n    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token comment">// 文本内容移动到shadow dom元素中</span>\n    <span class="token keyword">var</span> div <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">\'div\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    div<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>innerHTML<span class="token punctuation">;</span>\n    <span class="token keyword">this</span><span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> <span class="token string">\'\'</span><span class="token punctuation">;</span>\n    <span class="token keyword">var</span> style <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">\'style\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    shadow<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>style<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    shadow<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>div<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n\n  <span class="token comment">// 下面4个方法为常用生命周期</span>\n  <span class="token function">connectedCallback</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">\'自定义元素加入页面\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token comment">// 执行渲染更新</span>\n    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_updateRendering</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n\n  <span class="token function">disconnectedCallback</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token comment">// 本例子该生命周期未使用，占位示意</span>\n    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">\'自定义元素从页面移除\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n\n  <span class="token function">adoptedCallback</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token comment">// 本例子该生命周期未使用，占位示意</span>\n    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">\'自定义元素转移到新页面\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n\n  <span class="token function">attributeChangedCallback</span><span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span> oldValue<span class="token punctuation">,</span> newValue</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">\'自定义元素属性发生变化\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">this</span><span class="token punctuation">.</span>_rows <span class="token operator">=</span> newValue<span class="token punctuation">;</span>\n    <span class="token comment">// 执行渲染更新</span>\n    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_updateRendering</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n\n  <span class="token comment">// 设置直接get/set rows属性的方法</span>\n  <span class="token keyword">get</span> <span class="token function">rows</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_rows<span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n\n  <span class="token keyword">set</span> <span class="token function">rows</span><span class="token punctuation">(</span><span class="token parameter">v</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">\'rows\'</span><span class="token punctuation">,</span> v<span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n\n  <span class="token function">_updateRendering</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token comment">// 根据变化的属性，改变组件的UI</span>\n    <span class="token keyword">var</span> shadow <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>shadowRoot<span class="token punctuation">;</span>\n    <span class="token keyword">var</span> childNodes <span class="token operator">=</span> shadow<span class="token punctuation">.</span>childNodes<span class="token punctuation">;</span>\n    <span class="token keyword">var</span> rows <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_rows<span class="token punctuation">;</span>\n    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> childNodes<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token keyword">if</span> <span class="token punctuation">(</span>childNodes<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>nodeName <span class="token operator">===</span> <span class="token string">\'STYLE\'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n        childNodes<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>textContent <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">div {\n          display: -webkit-box;\n          -webkit-line-clamp: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>rows<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">;\n          -webkit-box-orient: vertical;\n          overflow: hidden;\n        }</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>\n      <span class="token punctuation">}</span>\n    <span class="token punctuation">}</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n<span class="token comment">// 定义x-ell标签元素为多行打点元素</span>\ncustomElements<span class="token punctuation">.</span><span class="token function">define</span><span class="token punctuation">(</span><span class="token string">\'x-ell\'</span><span class="token punctuation">,</span> HTMLEllElement<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>这段文字如果超过 2 行，就会自动在末尾打点</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="26784971343700128000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`<style>\n  x-ell {\n    display: block;\n  }\n</style>\n<x-ell rows=&quot;2&quot;>对于现代浏览器，例如webkit内核的浏...组合如下。</x-ell>`, `26784971343700128000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                data-tooltip="复制"\n              >\n                <svg class="gatsby-code-button-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0V0z"/><path d="M16 1H2v16h2V3h12V1zm-1 4l6 6v12H6V5h9zm-1 7h5.5L14 6.5V12z"/></svg>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="html"><pre style="counter-reset: linenumber NaN" class="language-html line-numbers"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">></span></span><span class="token style"><span class="token language-css">\n  <span class="token selector">x-ell</span> <span class="token punctuation">{</span>\n    <span class="token property">display</span><span class="token punctuation">:</span> block<span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>x-ell</span> <span class="token attr-name">rows</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>2<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>对于现代浏览器，例如webkit内核的浏...组合如下。<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>x-ell</span><span class="token punctuation">></span></span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>如果想要 3 行打点，也非常简单，直接设置 rows 为 3 即可。我们可以直接手动修改：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="43397885717664915000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`<x-ell rows=&quot;3&quot;></x-ell>`, `43397885717664915000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                data-tooltip="复制"\n              >\n                <svg class="gatsby-code-button-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0V0z"/><path d="M16 1H2v16h2V3h12V1zm-1 4l6 6v12H6V5h9zm-1 7h5.5L14 6.5V12z"/></svg>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="html"><pre style="counter-reset: linenumber NaN" class="language-html line-numbers"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>x-ell</span> <span class="token attr-name">rows</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>3<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>x-ell</span><span class="token punctuation">></span></span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>也可以直接一行 JS 直接修改属性：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="11547448531886938000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`document.querySelector(\'x-ell\').rows = \'3\';`, `11547448531886938000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                data-tooltip="复制"\n              >\n                <svg class="gatsby-code-button-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0V0z"/><path d="M16 1H2v16h2V3h12V1zm-1 4l6 6v12H6V5h9zm-1 7h5.5L14 6.5V12z"/></svg>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js">document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">\'x-ell\'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>rows <span class="token operator">=</span> <span class="token string">\'3\'</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>rows 属性的表现就好像<code class="language-text">&lt;textarea&gt;</code>元素的 rows 属性一样，修改后直接触发了元素本身 UI 的变化，而且是实时的。这就是自定义元素，自己定义一个元素，可以和原生元素一样的行为和特性。</p>\n<p>然而兼容性问题不容忽视，如果只考虑 ES6 继承特性，Firefox，Safari 等浏览器也是可以用的，也就是移动端冒进下也是可以使用的。但是自定义元素注册，以及 Shadow DOM 等特性目前就 Chrome，Android 以及 UC 等浏览器支持，因此，只能用在一些内部产品（如中后台管理系统、内部工具）上。Firefox 目前想要支持可以开启实验功能，about:config，然后设置 dom.webcomponents.customelements.enabled 为 true，以及 dom.webcomponents.shadowdom.enabled 为 true。</p>\n<h1 id="自定义元素与-html-import-引入"><a href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E5%85%83%E7%B4%A0%E4%B8%8E-html-import-%E5%BC%95%E5%85%A5" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>自定义元素与 HTML import 引入</h1>\n<p>自定义元素还可以在 HTML 模块中使用，目前仅 Chrome 支持。</p>\n<p>大致套路这样的：</p>\n<ol>\n<li>HTML 模块注册与构建自定义元素；</li>\n<li>母页面引入模块；</li>\n<li>母页面自定义标签自动组件呈现；</li>\n</ol>\n<p>例如下面 HTML：</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="10032312378918218000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`<link rel=&quot;import&quot; href=&quot;module.html&quot; /> <zxx-info />`, `10032312378918218000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                data-tooltip="复制"\n              >\n                <svg class="gatsby-code-button-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0V0z"/><path d="M16 1H2v16h2V3h12V1zm-1 4l6 6v12H6V5h9zm-1 7h5.5L14 6.5V12z"/></svg>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="html"><pre style="counter-reset: linenumber NaN" class="language-html line-numbers"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>import<span class="token punctuation">"</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>module.html<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>zxx-info</span> <span class="token punctuation">/></span></span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>\n<p>此时<code class="language-text">&lt;zxx-info&gt;</code>这个元素在页面上呈现出来的效果就是自定义元素</p>\n<p>那这个 module.html 究竟做了什么事情呢？就是自定义<code class="language-text">&lt;zxx-info&gt;</code>这个元素。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="9210668664157451000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`<template id=&quot;tpl&quot;>\n  <style>\n    .scope {\n      contain: content;\n    }\n\n    .scope > img {\n      float: left;\n      margin-right: 10px;\n    }\n\n    .scope > p {\n      margin: 0;\n      overflow: hidden;\n    }\n  </style>\n  <div class=&quot;scope&quot;>\n    <img src=&quot;zxx.jpg&quot; />\n    <p>帅哥一枚！</p>\n  </div>\n</template>\n<script>\n  // 定义<zxx-info>\n  class HTMLZxxInfoElement extends HTMLElement {\n    constructor() {\n      super();\n      // 内部显示信息\n      this.innerHTML = document.currentScript.ownerDocument.querySelector(\'#tpl\').innerHTML;\n    }\n  }\n  // 注册\n  customElements.define(\'zxx-info\', HTMLZxxInfoElement);\n</script>`, `9210668664157451000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                data-tooltip="复制"\n              >\n                <svg class="gatsby-code-button-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0V0z"/><path d="M16 1H2v16h2V3h12V1zm-1 4l6 6v12H6V5h9zm-1 7h5.5L14 6.5V12z"/></svg>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="html"><pre style="counter-reset: linenumber NaN" class="language-html line-numbers"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>tpl<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">></span></span><span class="token style"><span class="token language-css">\n    <span class="token selector">.scope</span> <span class="token punctuation">{</span>\n      <span class="token property">contain</span><span class="token punctuation">:</span> content<span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n\n    <span class="token selector">.scope > img</span> <span class="token punctuation">{</span>\n      <span class="token property">float</span><span class="token punctuation">:</span> left<span class="token punctuation">;</span>\n      <span class="token property">margin-right</span><span class="token punctuation">:</span> 10px<span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n\n    <span class="token selector">.scope > p</span> <span class="token punctuation">{</span>\n      <span class="token property">margin</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>\n      <span class="token property">overflow</span><span class="token punctuation">:</span> hidden<span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>scope<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>zxx.jpg<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>\n    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span>帅哥一枚！<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">\n  <span class="token comment">// 定义&lt;zxx-info></span>\n  <span class="token keyword">class</span> <span class="token class-name">HTMLZxxInfoElement</span> <span class="token keyword">extends</span> <span class="token class-name">HTMLElement</span> <span class="token punctuation">{</span>\n    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token comment">// 内部显示信息</span>\n      <span class="token keyword">this</span><span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> document<span class="token punctuation">.</span>currentScript<span class="token punctuation">.</span>ownerDocument<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">\'#tpl\'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerHTML<span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n  <span class="token punctuation">}</span>\n  <span class="token comment">// 注册</span>\n  customElements<span class="token punctuation">.</span><span class="token function">define</span><span class="token punctuation">(</span><span class="token string">\'zxx-info\'</span><span class="token punctuation">,</span> HTMLZxxInfoElement<span class="token punctuation">)</span><span class="token punctuation">;</span>\n</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>两部分，一部分模板，一部分自定义元素定义和注册。都是 Web Components 中的概念。</p>\n<h1 id="即将支持的定制内置元素（customized-built-in-elements）"><a href="#%E5%8D%B3%E5%B0%86%E6%94%AF%E6%8C%81%E7%9A%84%E5%AE%9A%E5%88%B6%E5%86%85%E7%BD%AE%E5%85%83%E7%B4%A0%EF%BC%88customized-built-in-elements%EF%BC%89" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>即将支持的定制内置元素（Customized built-in elements）</h1>\n<p>上面自定义元素我们都是继承于 HTMLElement，实际上，HTMLElement 还有非常非常多的内置子集元素，例如上面提到的 HTMLDivElement，HTMLSpanElement，HTMLFormElement 元素等，每一种类型标签几乎都对应一种内置元素。</p>\n<p>所谓“定制内置元素”，指的就是我们的自定义元素继承自这些内置元素。</p>\n<div\n              class="gatsby-code-button-container"\n              data-toaster-id="39540203300905220000"\n              data-toaster-class="gatsby-code-button-toaster"\n              data-toaster-text-class="gatsby-code-button-toaster-text"\n              data-toaster-text="复制成功"\n              data-toaster-duration="3500"\n              onClick="copyToClipboard(`class HTMLCustomFormElement extends HTMLFormElement {\n  /* 略 */\n}\ncustomElements.define(\'custom-form\', HTMLCustomFormElement);`, `39540203300905220000`)"\n            >\n              <div\n                class="gatsby-code-button"\n                data-tooltip="复制"\n              >\n                <svg class="gatsby-code-button-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0V0z"/><path d="M16 1H2v16h2V3h12V1zm-1 4l6 6v12H6V5h9zm-1 7h5.5L14 6.5V12z"/></svg>\n              </div>\n            </div>\n<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">class</span> <span class="token class-name">HTMLCustomFormElement</span> <span class="token keyword">extends</span> <span class="token class-name">HTMLFormElement</span> <span class="token punctuation">{</span>\n  <span class="token comment">/* 略 */</span>\n<span class="token punctuation">}</span>\ncustomElements<span class="token punctuation">.</span><span class="token function">define</span><span class="token punctuation">(</span><span class="token string">\'custom-form\'</span><span class="token punctuation">,</span> HTMLCustomFormElement<span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>\n<p>此时，元素<code class="language-text">&lt;custom-form&gt;</code>就有了原生<code class="language-text">&lt;form&gt;</code>的各种属性和方法，例如直接可以使用 reset()方法重置内部表单元素的值。</p>\n<h2 id="应用"><a href="#%E5%BA%94%E7%94%A8" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>应用</h2>\n<p>在 HTML 标准中，<code class="language-text">&lt;form&gt;</code>元素是不能相互嵌套的，这就导致一个问题，当我们需要局部重置表单内的某些属性值的时候，就不能使用 reset()方法，因为会误伤其他可能已经输入的值。</p>\n<p>例如表单中有很多输入信息，外加一个图片上传。需求是图片选择即上传完毕，此时需要在图片 Ajax 上传完毕后重置 file 类型 input 的值，IE 下值重置不像 Chrome，可以直接设置 value 为空，最佳做法直接<code class="language-text">&lt;form&gt;</code>元素的 reset()方法，此时，我们就可以在 file 类型 input 外面包一层<code class="language-text">&lt;custom-form&gt;</code>标签，这样，HTML 解析时候既没有嵌套问题，又可以使用 reset()方法对表单元素进行重置。</p>',
id:"/github/workspace/blog/HTMLUnknownElement与HTML5自定义元素/index.md absPath of file >>> MarkdownRemark",timeToRead:5,frontmatter:{date:"2019-12-12 19:33:01",path:"/htmlunknownelement-html5-custom-elements/",tags:"前端, DOM, DOM知识点",title:"HTMLUnknownElement与HTML5自定义元素",draft:null}}],page:16,pagesSum:37,length:184,prevPath:"/page/15",nextPath:"/page/17"}}}});